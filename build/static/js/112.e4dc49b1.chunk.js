"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[112],{4454:(e,o,r)=>{r.d(o,{A:()=>s});r(9950);var t=r(6491),n=r(2053),i=r(5277),l=r(4414);const s=e=>{let{links:o}=e;return o&&0!==o.length?(0,l.jsxs)(t.A,{mt:1,children:[(0,l.jsx)(n.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,l.jsx)(t.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,l.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},7112:(e,o,r)=>{r.r(o),r.d(o,{default:()=>Ge});var t=r(9379),n=r(9950),i=r(8429),l=r(2074),s=r(1367),a=r(330),d=r(6220),c=r(5887),u=r(6491),m=r(4857),h=r(3274),p=r(5333),g=r(2053),v=r(1413),x=r(7591),f=r(3266),b=r(4195),y=r(226),C=r(6639),A=r(3174),w=r(899),j=r(2235),S=r(6583),k=r(33),R=r(8170),I=r(8145),E=r(9739),F=r(249),P=r(6050),U=r(5277),T=r(5979),D=r(3788),O=r(6101),z=r(6497),H=r(7324),W=r(9325),M=r(8614),L=r(3563),B=r(2236),G=r(4142),_=r(4447),N=r(7497),V=r(7443),Y=r(5965),J=r(2682),X=r(9316),Z=r(227),K=r(6904),q=r(9575),Q=r(1679),$=r(7341),ee=r(5204),oe=r(6281),re=r(379),te=r(1300),ne=r(760),ie=r(7319),le=r(4756),se=r(4767),ae=r(492),de=r(8008),ce=r(1902),ue=r(5855),me=r(9939),he=r(9404),pe=r(5379),ge=r(361),ve=r(1675),xe=r(9715),fe=r(6164),be=r(6835),ye=r(1311),Ce=r(1673),Ae=r(6487),we=r(9460),je=r(2600),Se=r(1770),ke=r(7565),Re=r(4414);const Ie=e=>{var o;let{open:r,onClose:i,onSubmit:l,initialData:s,title:a="Create Room",submitButtonText:d="Create"}=e;const[c,m]=(0,n.useState)({name:(null===s||void 0===s?void 0:s.name)||"",description:(null===s||void 0===s?void 0:s.description)||"",isPrivate:(null===s||void 0===s?void 0:s.isPrivate)||!1,password:(null===s||void 0===s?void 0:s.password)||"",tags:(null===s||void 0===s?void 0:s.tags)||[]}),[h,p]=(0,n.useState)(null);return(0,Re.jsx)(S.A,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,Re.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(c,h)},children:[(0,Re.jsx)(k.A,{children:a}),(0,Re.jsx)(R.A,{children:(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Re.jsx)(I.A,{label:"Name",value:c.name,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,Re.jsx)(I.A,{label:"Description",value:c.description,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,Re.jsx)(z.A,{control:(0,Re.jsx)(H.A,{checked:c.isPrivate,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,Re.jsx)(I.A,{label:"Password",type:"password",value:c.password,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,Re.jsxs)(u.A,{sx:{mt:1},children:[(0,Re.jsxs)(y.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,Re.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?p(e.target.files[0]):p(null)}})]}),h&&(0,Re.jsxs)(g.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",h.name]}),!h&&(null===s||void 0===s?void 0:s.thumbnailUrl)&&(0,Re.jsxs)(g.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",s.thumbnailUrl.substring(s.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,Re.jsx)(I.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:i,children:"Cancel"}),(0,Re.jsx)(y.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var Ee=r(7493),Fe=r(9317),Pe=r(6932),Ue=r(9751),Te=r(2856),De=r(1397),Oe=r(3422),ze=r(4454);const He=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],We=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],Me=[12,14,16,18,20,24,28,32],Le=e=>{let{icon:o,color:r}=e;const[i,l]=(0,n.useState)({left:"".concat(80*Math.random()+10,"%"),top:"".concat(20*Math.random()+40,"%"),animationDuration:"".concat(3*Math.random()+2,"s"),opacity:1});return(0,n.useEffect)((()=>{const e=setTimeout((()=>{l((e=>(0,t.A)((0,t.A)({},e),{},{opacity:0})))}),2e3);return()=>clearTimeout(e)}),[]),(0,Re.jsx)(u.A,{sx:(0,t.A)({position:"fixed",fontSize:"28px",color:r,pointerEvents:"none",zIndex:1e3,transition:"opacity 1s ease-out",animation:"float-around 3s ease-out forwards","@keyframes float-around":{"0%":{transform:"scale(0.5) rotate(0deg) translate(0, 0)"},"25%":{transform:"scale(1.2) rotate(10deg) translate(20px, -30px)"},"50%":{transform:"scale(1.4) rotate(-5deg) translate(-15px, -60px)"},"75%":{transform:"scale(1.1) rotate(15deg) translate(25px, -90px)"},"100%":{transform:"scale(0.8) rotate(-10deg) translate(0, -120px)"}}},i),children:o})},Be=e=>{let{handleHeartRoom:o,handleHeartbreakRoom:r,currentUserHearted:t,currentUserHeartbroken:n,roomHeartCount:i,roomHeartbreakCount:l,isHearting:s,isHeartbreaking:a,accentColor:d,textColor:c}=e;const v=(0,m.A)();return(0,Re.jsxs)(u.A,{sx:{position:"fixed",right:20,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:1,backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)",borderRadius:2,padding:1,zIndex:100,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Re.jsx)(h.A,{title:t?"Unheart Room":"Heart Room",children:(0,Re.jsx)(p.A,{onClick:o,color:t?"error":"inherit",sx:{color:t?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:s,children:t?(0,Re.jsx)(V.A,{}):(0,Re.jsx)(Y.A,{})})}),(0,Re.jsx)(g.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:i||0})]}),(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Re.jsx)(h.A,{title:n?"Remove Heartbreak":"Heartbreak Room",children:(0,Re.jsx)(p.A,{onClick:r,color:n?"error":"inherit",sx:{color:n?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:a,children:n?(0,Re.jsx)(J.A,{}):(0,Re.jsx)(X.A,{})})}),(0,Re.jsx)(g.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:l||0})]})]})},Ge=()=>{var e,o,r,l,B,G,_,N;const{roomId:Y}=(0,i.g)(),X=(0,i.Zp)(),{currentUser:be,blockUser:ye}=(0,s.As)(),Ce=(0,m.A)(),[Ae,we]=(0,n.useState)(null),[je,Se]=(0,n.useState)(!0),[ke,Pe]=(0,n.useState)(null),[Ge,Ne]=(0,n.useState)(!1),[Ve,Ye]=(0,n.useState)(!1),[Je,Xe]=(0,n.useState)(""),[Ze,Ke]=(0,n.useState)(!1),[qe,Qe]=(0,n.useState)(!1),[$e,eo]=(0,n.useState)(!1),[oo,ro]=(0,n.useState)(!1),[to,no]=(0,n.useState)(null),[io,lo]=(0,n.useState)([]),[so,ao]=(0,n.useState)(null),[co,uo]=((0,n.useRef)(null),(0,n.useState)(null)),[mo,ho]=(0,n.useState)(null),[po,go]=(0,n.useState)(null),[vo,xo]=(0,n.useState)(!1),[fo,bo]=(0,n.useState)(!1),[yo,Co]=(0,n.useState)(0),[Ao,wo]=(0,n.useState)(!1),[jo,So]=(0,n.useState)(null),ko=(0,n.useRef)(null),[Ro,Io]=(0,n.useState)(0),[Eo,Fo]=(0,n.useState)(!1),[Po,Uo]=(0,n.useState)(!1),[To,Do]=(0,n.useState)(!1),[Oo,zo]=(0,n.useState)(""),[Ho,Wo]=(0,n.useState)(null),[Mo,Lo]=(0,n.useState)(""),[Bo,Go]=(0,n.useState)([]),[_o,No]=(0,n.useState)(!1),[Vo,Yo]=(0,n.useState)(null),[Jo,Xo]=(0,n.useState)(!1),Zo=(0,n.useRef)(null),[Ko,qo]=(0,n.useState)(null),[Qo,$o]=(0,n.useState)(!1),[er,or]=(0,n.useState)([]),[rr,tr]=(0,n.useState)(""),[nr,ir]=(0,n.useState)(!1),lr=(0,n.useRef)(null),[sr,ar]=(0,n.useState)(""),[dr,cr]=(0,n.useState)(!1),[ur,mr]=(0,n.useState)(30),[hr,pr]=(0,n.useState)(!1),[gr,vr]=(0,n.useState)(He[0].name),[xr,fr]=(0,n.useState)(!1),[br,yr]=(0,n.useState)(!1),[Cr,Ar]=(0,n.useState)(We[0]),[wr,jr]=(0,n.useState)(Me[2]),[Sr,kr]=((0,n.useRef)(null),(0,n.useState)(!1)),[Rr,Ir]=(0,n.useState)(!1),[Er,Fr]=(0,n.useState)(window.innerWidth>1024),[Pr,Ur]=(0,n.useState)(null),[Tr,Dr]=(0,n.useState)(!1),[Or,zr]=(0,n.useState)(null),[Hr,Wr]=(0,n.useState)(null),Mr=(0,n.useRef)([]),[Lr,Br]=(0,n.useState)(!1),[Gr,_r]=(0,n.useState)(null),Nr="youtube-player-placeholder",[Vr,Yr]=(0,n.useState)(!1),[Jr,Xr]=(0,n.useState)(null),[Zr,Kr]=(0,n.useState)([]),[qr,Qr]=(0,n.useState)([]),$r=(0,n.useCallback)((()=>{po&&(console.log("Camera state before toggle:",po.camera.state),"enabled"!==po.camera.state.status?(c.oR.loading("Enabling camera..."),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((e=>(console.log("Camera access granted:",e),e.getTracks().forEach((e=>e.stop())),po.camera.enable()))).then((()=>{Br(!0),c.oR.dismiss(),c.oR.success("Camera enabled")})).catch((e=>{console.error("Error enabling camera:",e),c.oR.dismiss(),c.oR.error("Could not enable camera. Please check camera permissions in your browser settings.")}))):po.camera.disable().then((()=>{Br(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)})))}),[po]),et=(0,n.useRef)(0),ot=(0,n.useRef)(0),rt=(0,n.useRef)(0);(0,n.useEffect)((()=>{const e=()=>{Fr(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,n.useEffect)((()=>{if(po){const e="enabled"===po.camera.state.status;Br(e);const o=setInterval((()=>{const e="enabled"===po.camera.state.status;Br(e)}),1e3);return()=>{clearInterval(o)}}}),[po]),(0,n.useEffect)((()=>{po&&navigator.mediaDevices.getUserMedia({video:!0}).then((()=>{console.log("Camera permissions granted")})).catch((e=>{console.error("Camera permission denied:",e),c.oR.error("Camera permissions denied. You won't be able to share video.")}))}),[po]),(0,n.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,Oe.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),qo(o)})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),qo(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),qo(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),qo(null)}}),[]),(0,n.useEffect)((()=>{if($e)if(null!==Ae&&void 0!==Ae&&Ae.style){const e=Ae.style,o=He.find((o=>o.name===e.themeName));vr(o?e.themeName:He[0].name);const r=o||He[0];fr(void 0!==e.headerGradient?e.headerGradient:r.headerGradient||!1),yr(void 0!==e.backgroundGradient?e.backgroundGradient:r.backgroundGradient||!1),Ar(We.includes(e.font)?e.font:We[0]),jr(Me.includes(e.headerFontSize)?e.headerFontSize:Me[2])}else vr(He[0].name),fr(He[0].headerGradient||!1),yr(He[0].backgroundGradient||!1),Ar(We[0]),jr(Me[2])}),[$e,Ae]),(0,n.useEffect)((()=>{if(!Y||!a.db||0===io.length)return;const e=io.filter((e=>e.isOnline)).length,o=Date.now(),r=o-ot.current;if(e!==et.current&&r>1e4){console.log("[Active Users Update] Updating count from ".concat(et.current," to ").concat(e));const r=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(r,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{et.current=e,ot.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}et.current=e}),[Y,a.db,io.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===be||void 0===be?void 0:be.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===Ae||void 0===Ae?void 0:Ae.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===Ae||void 0===Ae?void 0:Ae.viewers)||"null/undefined");const tt=(0,n.useMemo)((()=>{if(null===be||void 0===be||!be.uid||null===Ae||void 0===Ae||!Ae.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=be.uid===Ae.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===be||void 0===be?void 0:be.uid,null===Ae||void 0===Ae?void 0:Ae.ownerId]),nt=(0,n.useMemo)((()=>{if(null===Ae||void 0===Ae||!Ae.viewers||null===be||void 0===be||!be.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=Ae.viewers.some((e=>e.userId===be.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===Ae||void 0===Ae?void 0:Ae.viewers,null===be||void 0===be?void 0:be.uid]),it=!!Ae&&(tt||!0),lt=(0,n.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",io);const e=new Map;io.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[io]),st=(0,n.useMemo)((()=>{if(!Ae||!Ae.viewers||!Array.isArray(Ae.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(Ae.viewers,null,2));const e=Ae.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[Ae]),at=(0,n.useCallback)((async(e,o,r,t,n)=>{if(!e||null===o||void 0===o||!o.uid||!n)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var l,s;const a=(0,d.H9)(r,"users",i),c=await(0,d.x7)(a);let u="",m="",h=(null===(l=o.email)||void 0===l?void 0:l.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let p="viewer";t?p="owner":null!==(s=n.viewers)&&void 0!==s&&s.some((e=>e.userId===i&&"guest"===e.role))&&(p="guest");const g=(0,d.H9)(r,"sideRooms",e,"presence",i),v={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:p,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(v,null,2)),await(0,d.BN)(g,v,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(a){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),a)}}),[]);(0,n.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(it,", CurrentUserUID: ").concat(null===be||void 0===be?void 0:be.uid,", IsRoomOwner: ").concat(tt,", RoomExists: ").concat(!!Ae)),it&&Y&&be&&Ae?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(be.uid," in room ").concat(Y,".")),at(Y,be,a.db,tt,Ae)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(it,", RoomId: ").concat(!!Y,", CurrentUser: ").concat(!!be,", Room: ").concat(!!Ae))}),[Y,be,a.db,tt,Ae,it,at]),(0,n.useEffect)((()=>{const e=null===be||void 0===be?void 0:be.uid,o=Y;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const r=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[Y,null===be||void 0===be?void 0:be.uid,a.db]);const dt=()=>{Do(!0)},ct=()=>{Do(!1),zo("")},ut=()=>{if(!Y)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!tt)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),Wo(null),c.oR.success("Shared video cleared.")};(0,n.useEffect)((()=>{if(null===be||void 0===be||!be.uid||!Y||!it||co)return;(async()=>{try{console.log("[Stream] Fetching token for user:",be.uid),console.log("[Stream] Data being sent - User ID:",be.uid),console.log("[Stream] Data being sent - Display Name:",be.displayName),console.log("[Stream] Data being sent - Photo URL:",be.photoURL);const r="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(r));const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:be.uid,userName:be.displayName||be.email||"UnknownUser",userImage:be.photoURL||void 0})});console.log("[Stream] Response status: ".concat(t.status));const n={};if(t.headers.forEach(((e,o)=>{n[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(n,null,2)),!t.ok){var e;let r={error:"HTTP error! Status: ".concat(t.status)};try{const e=await t.text();console.log("[Stream] Non-OK response body (text):",e),r=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),r.error=t.statusText||r.error}throw new Error((null===(e=r)||void 0===e?void 0:e.error)||"HTTP status ".concat(t.status))}const{token:i}=await t.json();if(!i)throw new Error("Stream token was not provided by backend.");uo(i),console.log("[Stream] Token fetched successfully.")}catch(ke){console.error("[Stream] Error fetching token:",ke),c.oR.error("Stream Token Error: ".concat(ke.message||"Load failed")),uo(null)}})()}),[be,Y,it,co]),(0,n.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!co||null===be||void 0===be||!be.uid||mo)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!co,", currentUser=").concat(!(null===be||void 0===be||!be.uid),", apiKey=").concat(!0,", clientExists=").concat(!!mo));console.log("[Stream] Initializing StreamVideoClient with token.");const r=(null===(e=be.profile)||void 0===e?void 0:e.name)||be.displayName||be.email||be.uid,t=(null===(o=be.profile)||void 0===o?void 0:o.profilePic)||be.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(r,", photoURL: ").concat(t));const n={id:be.uid,name:r,image:t};try{const e=new Ee.Hq({apiKey:"2nufecjmzmzh",user:n,token:co});ho(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(ke){console.error("[Stream] Error initializing StreamVideoClient:",ke),c.oR.error("Failed to initialize Stream video client: ".concat(ke instanceof Error?ke.message:String(ke)))}return()=>{mo&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),ho(null))}}),[co,be,mo]),(0,n.useEffect)((()=>{if(!fo||!mo||!Y||null===be||void 0===be||!be.uid)return void(fo&&bo(!1));if(po)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void bo(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(Y)),xo(!0);try{const e=mo.call("default",Y);if(await e.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(e.cid)),go(e),tt&&Y&&a.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(ke){console.error("[Stream Call] Error joining or creating call:",ke),c.oR.error("Failed to connect to audio: ".concat(ke.message||"Unknown error")),go(null)}finally{xo(!1),bo(!1)}})(),()=>{bo(!1)}}),[fo,mo,Y,null===be||void 0===be?void 0:be.uid,po]),(0,n.useEffect)((()=>()=>{po&&(console.log("[Stream Call] Leaving active call ".concat(po.cid," on component unmount or room change.")),po.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(po.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(po.cid,":"),e))).finally((()=>{if(go(null),tt&&Y&&a.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[po,Y,tt,a.db]),(0,n.useEffect)((()=>{if(!Y||!be)return;const e=(0,d.H9)(a.db,"sideRooms",Y),o=(0,d.aQ)(e,(e=>{if(e.exists()){const r=(0,t.A)({id:e.id},e.data());if(we(r),Co(r.heartCount||0),Se(!1),r.isPrivate&&r.password&&r.ownerId!==be.uid){var o;(null===(o=r.viewers)||void 0===o?void 0:o.some((e=>e.userId===be.uid&&"guest"!==e.role)))||Ye(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(Y,"' reported as non-existent. Current error: '").concat(ke,"'. Setting room state to null.")),Pe("Room not found"),we(null),Se(!1)}));let r;if(null!==be&&void 0!==be&&be.uid){const e=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",be.uid);r=(0,d.aQ)(e,(e=>{wo(e.exists())}))}const n=(0,d.P)((0,d.rJ)(a.db,"sideRooms",Y,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(n,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===be||void 0===be?void 0:be.uid)&&o.username&&(So("".concat(o.username," hearted the room!")),ko.current&&clearTimeout(ko.current),ko.current=setTimeout((()=>{So(null)}),3e3))}}))}));return()=>{o(),r&&r(),i(),ko.current&&clearTimeout(ko.current)}}),[Y,be]),(0,n.useEffect)((()=>{if(!Y||!a.db||null===be||void 0===be||!be.uid)return;const e=(0,d.H9)(a.db,"sideRooms",Y),o=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",be.uid),r=(0,d.aQ)(e,(e=>{if(e.exists()){const o=e.data();Io(o.heartbreakCount||0)}})),t=(0,d.aQ)(o,(e=>{Fo(e.exists())}));return()=>{r(),t()}}),[Y,a.db,null===be||void 0===be?void 0:be.uid]),(0,n.useEffect)((()=>{if(Zr.length>0){const e=setTimeout((()=>{Kr((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[Zr]),(0,n.useEffect)((()=>{if(qr.length>0){const e=setTimeout((()=>{Qr((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[qr]);const mt=async e=>{if(!a.db||!e)return null;try{const o=(0,d.rJ)(a.db,"rooms"),r=(0,d.P)(o,(0,d._M)("createdBy","==",e),(0,d._M)("type","==","public")),t=await(0,d.GG)(r);if(!t.empty){const e=t.docs[0];return{id:e.id,name:e.data().name||"Chat Room"}}return null}catch(ke){return console.error("[SideRoomComponent] Error checking for server chat room:",ke),null}};(0,n.useEffect)((()=>{if(null===be||void 0===be||!be.uid||null===Ae||void 0===Ae||!Ae.ownerId)return;(async()=>{try{const e=(0,d.H9)(a.db,"users",Ae.ownerId),o=await(0,d.x7)(e);if(!(o.exists()&&!0===o.data().isPrivate))return;const r=(0,d.H9)(a.db,"users",be.uid,"following",Ae.ownerId),t=(0,d.H9)(a.db,"users",Ae.ownerId,"followRequests",be.uid),[n,i]=await Promise.all([(0,d.x7)(r),(0,d.x7)(t)]);if(n.exists()&&!i.exists()){const e=await mt(Ae.ownerId);e&&(Xr(e),Yr(!0))}}catch(ke){console.error("Error checking follow status:",ke)}})();const e=(0,d.H9)(a.db,"users",be.uid,"following",Ae.ownerId),o=(0,d.aQ)(e,(e=>{e.exists()&&mt(Ae.ownerId).then((e=>{e&&(Xr(e),Yr(!0))}))}));return()=>o()}),[be,Ae,a.db,X,mt]),(0,n.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(it,", CurrentUserUID: ").concat(null===be||void 0===be?void 0:be.uid)),!Y||!it||null===be||void 0===be||!be.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(Y,", HasAccess: ").concat(it,", UserUID: ").concat(null===be||void 0===be?void 0:be.uid)),void lo([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(Y));const e=(0,d.rJ)(a.db,"sideRooms",Y,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,t.A)({userId:e.id},e.data()))),r=Date.now();let n=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&r-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((r-e.lastSeen)/1e3)," seconds old).")),!n&&a.db&&e.userId!==(null===be||void 0===be?void 0:be.uid)){const o=(0,d.H9)(a.db,"sideRooms",Y,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),n=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),lo(i);const l=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(l))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),lo([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(Y,".")),o()}}),[Y,it,null===be||void 0===be?void 0:be.uid,a.db]),(0,n.useEffect)((()=>{const e=null===be||void 0===be?void 0:be.uid,o=Y;return()=>{if(e&&o&&a.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const r=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[Y,null===be||void 0===be?void 0:be.uid,a.db]),(0,n.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(it,", CurrentUserUID: ").concat(null===be||void 0===be?void 0:be.uid,", IsRoomOwner: ").concat(tt,", RoomExists: ").concat(!!Ae)),!Y||null===be||void 0===be||!be.uid||!Ae||!it){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(Y,", UserUID: ").concat(null===be||void 0===be?void 0:be.uid,", HasAccess: ").concat(it,", RoomExists: ").concat(!!Ae)),null!==be&&void 0!==be&&be.uid&&Y){const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",be.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(be.uid," in room ").concat(Y)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(be.uid,":"),e)}))}return}const e=be.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(Y,"."));let o=null;return(async()=>{try{var r,t;const n=(0,d.H9)(a.db,"users",e),i=await(0,d.x7)(n);let l="",s="",c=(null===(r=be.email)||void 0===r?void 0:r.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();l=o.name||o.username||"",s=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(l,"', Pic='").concat(s,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),l=be.displayName||"",s=be.photoURL||"";let u="viewer";tt?u="owner":null!==(t=Ae.viewers)&&void 0!==t&&t.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(a.db,"sideRooms",Y,"presence",e),h={userId:e,username:c,avatar:s,lastSeen:Date.now(),isOnline:!0,role:u,displayName:l,photoURL:s},p="sideRooms/".concat(Y,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",p,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-rt.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),rt.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(ke){console.error("[Presence Heartbeat] Error updating heartbeat:",ke)}}),6e4))}catch(n){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),n)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(Y,". Setting offline."));const r=(0,d.H9)(a.db,"sideRooms",Y,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[Y,be,a.db,tt,Ae,it]),(0,n.useEffect)((()=>{if(Y)return()=>{}}),[Y]),(0,n.useEffect)((()=>{Ae&&Ae.currentSharedVideoUrl?Wo(Ae.currentSharedVideoUrl):Ae&&!Ae.currentSharedVideoUrl&&Wo(null)}),[Ae]),(0,n.useEffect)((()=>{if(!Ko)return;const e=e=>{c.oR.success(e.message),Xo(!1),Lo(""),Yo(null),Go([]),Qe(!1)},o=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),Xo(!1)},r=e=>{e.roomId===Y&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},t=e=>{e.error?(c.oR.error(e.error),Go([])):Go(e.users)},n=e=>{e===Y&&null!==be&&void 0!==be&&be.uid&&((0,c.oR)("The host has removed you from the room."),null===po||void 0===po||po.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{X("/side-rooms")})))};return Ko.on("invite-success",e),Ko.on("invite-failed",o),Ko.on("guest-joined",r),Ko.on("user-search-results-for-invite",t),Ko.on("force-remove",n),()=>{Ko.off("invite-success",e),Ko.off("invite-failed",o),Ko.off("guest-joined",r),Ko.off("user-search-results-for-invite",t),Ko.off("force-remove",n)}}),[Ko,Y,X,po,null===be||void 0===be?void 0:be.uid]);const ht=(0,n.useCallback)((0,De.debounce)((e=>{e.trim().length>=2&&(Ko?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),Ko.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[Ko]),pt=(0,n.useCallback)((()=>{ro(!0)}),[]),gt=(0,n.useCallback)((e=>{no(e.currentTarget)}),[]),vt=(0,n.useCallback)((()=>{no(null)}),[]),xt=(0,n.useCallback)((()=>{Ke(!0),vt()}),[vt]),ft=(0,n.useCallback)((()=>{eo(!0),vt()}),[vt]),bt=(0,n.useCallback)((()=>{Qe(!0),Lo(""),Yo(null),Go([]),No(!1),vt()}),[vt]),yt=(0,n.useCallback)((async()=>{if(Xo(!0),Ko&&null!==be&&void 0!==be&&be.uid&&Y&&null!==Vo&&void 0!==Vo&&Vo.username){console.log("Emitting invite-user-to-room: ".concat(Vo.username));try{var e;const o=(0,d.P)((0,d.rJ)(a.db,"users"),(0,d._M)("username","==",Vo.username)),r=await(0,d.GG)(o);if(r.empty)return c.oR.error("User not found."),void Xo(!1);r.docs[0].data();const t=r.docs[0].id,n=(0,d.H9)(a.db,"sideRooms",Y),i=await(0,d.x7)(n);if(!i.exists())return c.oR.error("Room not found."),void Xo(!1);const l=i.data();if(null===(e=l.viewers)||void 0===e?void 0:e.some((e=>e.userId===t)))return c.oR.error("".concat(Vo.username," is already in this room.")),void Xo(!1);Ko.emit("invite-user-to-room",{roomId:Y,inviterId:be.uid,inviteeUsername:Vo.username})}catch(ke){console.error("Error checking if user is in room:",ke),Ko.emit("invite-user-to-room",{roomId:Y,inviterId:be.uid,inviteeUsername:Vo.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!Ko,currentUser:!(null===be||void 0===be||!be.uid),roomId:Y,selectedInviteeForInvite:Vo}),c.oR.error("Cannot send invite: connection or user data issue."),Xo(!1)}),[null===be||void 0===be?void 0:be.uid,Y,Vo,Ko,a.db]),Ct=(0,n.useCallback)((async()=>{if(Y&&tt&&(vt(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){Ne(!0);try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),X("/side-rooms")}catch(ke){console.error("Error deleting room:",ke),c.oR.error("Failed to delete room")}finally{Ne(!1)}}}),[Y,tt,X]),At=(0,n.useCallback)((async(e,o)=>{if(!tt||!Y||e===(null===be||void 0===be?void 0:be.uid))return;console.log("Owner toggling mute for ".concat(e,". Currently muted: ").concat(o));const r=!o,t=(0,d.H9)(a.db,"sideRooms",Y,"presence",e);try{await(0,d.mZ)(t,{isMuted:r}),console.warn("[SideRoomComponent] handleForceMuteToggle needs to be connected to the correct signaling (e.g., general Socket.IO emit)"),c.oR.success("User ".concat(r?"muted":"unmuted","."))}catch(ke){console.error("Error toggling mute for ".concat(e,":"),ke),c.oR.error("Failed to update mute status.")}}),[tt,Y,null===be||void 0===be?void 0:be.uid,a.db]),wt=(0,n.useCallback)(((e,o)=>{if(!tt||!Y||e===(null===be||void 0===be?void 0:be.uid)||!Ko)return;const r=o||"this user";window.confirm("Are you sure you want to remove ".concat(r," from the room?"))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(Y)),Ko.emit("force-remove",{roomId:Y,targetUserId:e}),c.oR.success("Removing ".concat(r,"...")))}),[tt,Y,null===be||void 0===be?void 0:be.uid,Ko]),jt=(0,n.useCallback)(((e,o)=>{if(!tt||!Y||e===(null===be||void 0===be?void 0:be.uid))return;const r=o||"this user";if(window.confirm("Are you sure you want to block ".concat(r,"? They will be removed from the room.")))try{ye(e).then((()=>{c.oR.success("Blocked ".concat(r)),console.log("User ".concat(e," has been blocked"))})).catch((e=>{console.error("Error blocking user:",e),c.oR.error("Failed to block user")}))}catch(ke){console.error("Error initiating block:",ke),c.oR.error("Failed to block user")}}),[tt,Y,null===be||void 0===be?void 0:be.uid,ye]),St=()=>{setTimeout((()=>{var e;null===(e=lr.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,n.useEffect)((()=>{Qo&&St()}),[er,Qo,sr]),(0,n.useEffect)((()=>{if(!dr||!sr)return;let e=0;const o=sr,r=()=>{e<o.length?(or((r=>{const n=[...r];if(n.length>0&&"ai"===n[n.length-1].sender){const r=n[n.length-1];n[n.length-1]=(0,t.A)((0,t.A)({},r),{},{text:o.substring(0,e+1)})}return n})),e++,setTimeout(r,ur)):(cr(!1),ar(""))};return r(),()=>{cr(!1)}}),[dr,sr,ur]);const kt=e=>{or((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,r)=>r===e.length-1?(0,t.A)((0,t.A)({},o),{},{text:""}):o))})),ar(e),cr(!0)};(0,n.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?or(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(ke){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",ke),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,n.useEffect)((()=>{(er.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(er))}),[er]);const Rt=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:rr).trim();if(!o)return;const r={sender:"user",text:o};or((e=>[...e,r])),tr(""),ir(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const r="https://sideeye-backend-production.up.railway.app";if(!r)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),kt("Configuration error: Backend URL not set."),void ir(!1);const n="".concat(r,"/api/sade-ai");if(null===be||void 0===be||!be.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),kt("Error: Could not identify user."),void ir(!1);or((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),l=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),s={message:o,forceSearch:e,userId:be.uid,contextFlags:{avoidAppInstructions:i&&!l,isGreeting:i,isInstructionQuery:l,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",s);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},d=await fetch(n,a);if(or((e=>e.filter(((o,r)=>r!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(t){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(or((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),kt(c.response)):kt(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),kt("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),kt("Sorry, I got a bit confused there."))}catch(n){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",n),or((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),kt("Sorry, there was an error: ".concat(n.message||"Unknown error"))}finally{ir(!1),St()}};(0,n.useEffect)((()=>{const e=Ho?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(Ho):null,o=()=>{if(Gr&&(Gr.destroy(),_r(null)),e&&document.getElementById(Nr)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(Nr,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});_r(o)}else!e&&Gr&&(Gr.destroy(),_r(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{Gr&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),Gr.destroy(),_r(null))}}),[Ho]);const It=e=>(0,Re.jsx)("div",{id:Nr,style:{width:"100%",height:"100%"}}),Et=Ae?"".concat(Ae.name," - SideEye"):je?"Loading Room...":"Room Not Found - SideEye",Ft=Ae&&Ae.description||"Join the conversation on SideEye.",Pt="".concat(window.location.origin,"/default-app-logo.png"),Ut=(null===Ae||void 0===Ae?void 0:Ae.thumbnailUrl)||Pt,Tt="".concat(window.location.origin,"/side-room/").concat(Y||"");if(je&&!Ae)return(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(Te.mg,{children:(0,Re.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,Re.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,Re.jsx)(C.A,{})})]});if(ke&&!Ae)return(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(Te.mg,{children:(0,Re.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,Re.jsxs)(u.A,{sx:{p:3,textAlign:"center"},children:[(0,Re.jsx)(A.A,{severity:"error",children:ke}),(0,Re.jsxs)(y.A,{onClick:()=>X("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const Dt=async()=>{if(po)if(Er)try{await po.screenShare.toggle();const e=po.screenShare.enabled;Ir(e),e?(c.oR.success("Screen sharing started. All participants will see your screen automatically."),Ko&&null!==Ae&&void 0!==Ae&&Ae.id&&null!==be&&void 0!==be&&be.uid&&Ko.emit("start-screen-share",{roomId:Ae.id,userId:be.uid})):(c.oR.success("Screen sharing stopped."),Ko&&null!==Ae&&void 0!==Ae&&Ae.id&&null!==be&&void 0!==be&&be.uid&&Ko.emit("stop-screen-share",{roomId:Ae.id,userId:be.uid}))}catch(ke){var e,o,r,t;console.error("Error toggling screen share:",ke),"NotAllowedError"===ke.name||null!==(e=ke.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=ke.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(r=ke.message)&&void 0!==r&&r.includes("getDisplayMedia is not supported")||null!==(t=ke.message)&&void 0!==t&&t.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(ke.message||"Unknown error")),po.screenShare&&Ir(po.screenShare.enabled)}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")},Ot=async()=>{if(Ae&&Je&&be){Ne(!0);try{if(Ae.password===Je){const e=(0,d.H9)(a.db,"sideRooms",Y),o=await(0,d.x7)(e),r=o.data().viewers||[];r.some((e=>e.userId===be.uid))||await(0,d.mZ)(e,{viewers:[...r,{userId:be.uid,username:be.displayName||be.email||"User",role:"viewer",joinedAt:(0,d.O5)()}]}),c.oR.success("Password correct. Welcome to the room!"),Ye(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(ke){console.error("Error verifying password:",ke),c.oR.error("An error occurred. Please try again.")}finally{Ne(!1)}}else c.oR.error("Missing information. Please try again.")},zt=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))c.oR.error("Screen recording is not fully supported on mobile devices. Please use a desktop browser for this feature.");else try{var e;if(null===(e=navigator.mediaDevices)||void 0===e||!e.getDisplayMedia)return void c.oR.error("Screen recording is not supported in your browser.");const o=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),r=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaStream;o.getVideoTracks().forEach((e=>{t.addTrack(e)})),o.getAudioTracks().forEach((e=>{t.addTrack(e)})),r.getAudioTracks().forEach((e=>{t.addTrack(e)}));const n=new MediaRecorder(t,{mimeType:"video/webm"});n.ondataavailable=e=>{e.data.size>0&&Mr.current.push(e.data)},n.onstop=()=>{const e=new Blob(Mr.current,{type:"video/webm"}),o=URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=o,r.download="sideeye-room-recording-".concat((new Date).toISOString(),".webm"),document.body.appendChild(r),r.click(),setTimeout((()=>{document.body.removeChild(r),window.URL.revokeObjectURL(o),Mr.current=[]}),100),t.getTracks().forEach((e=>e.stop())),zr(null),Wr(null),Dr(!1),c.oR.success("Recording saved to your device")},n.start(),zr(t),Wr(n),Dr(!0),c.oR.success("Screen recording started with audio"),o.getVideoTracks()[0].onended=()=>{"inactive"!==n.state&&n.stop()}}catch(ke){console.error("Error starting screen recording:",ke),c.oR.error("Could not start screen recording. Please make sure you've granted the necessary permissions.")}},Ht=()=>{Hr&&"inactive"!==Hr.state&&Hr.stop(),Or&&Or.getTracks().forEach((e=>e.stop()))},Wt=()=>{Yr(!1)};return(0,Re.jsxs)(Re.Fragment,{children:[Zr.map((e=>(0,Re.jsx)(Le,{icon:(0,Re.jsx)(V.A,{}),color:Ce.palette.error.main},"heart-".concat(e)))),qr.map((e=>(0,Re.jsx)(Le,{icon:(0,Re.jsx)(J.A,{}),color:Ce.palette.error.main},"heartbreak-".concat(e)))),Ae&&(0,Re.jsx)(Be,{handleHeartRoom:async()=>{if(!be||!be.uid||!Y||!Ae)return;Kr((e=>[...e,Date.now()])),pr(!0);const e=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",be.uid),o=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",be.uid),r=(0,d.H9)(a.db,"sideRooms",Y);try{await(0,d.c4)(a.db,(async t=>{var n;const i=await t.get(e),l=await t.get(o);if(!(await t.get(r)).exists())throw"Room does not exist!";const s=await(0,d.x7)((0,d.H9)(a.db,"users",be.uid)),c=s.exists()?(null===(n=s.data())||void 0===n?void 0:n.username)||be.displayName:"Someone";l.exists()&&(t.delete(o),t.update(r,{heartbreakCount:(0,d.GV)(-1)}),Fo(!1)),i.exists()?(t.delete(e),t.update(r,{heartCount:(0,d.GV)(-1)})):(t.set(e,{userId:be.uid,username:c,timestamp:(0,d.O5)()}),t.update(r,{heartCount:(0,d.GV)(1)}))}))}catch(ke){console.error("Error hearting room:",ke),c.oR.error("Failed to update heart status.")}finally{pr(!1)}},handleHeartbreakRoom:async()=>{if(!be||!be.uid||!Y||!Ae)return;Qr((e=>[...e,Date.now()])),Uo(!0);const e=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",be.uid),o=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",be.uid),r=(0,d.H9)(a.db,"sideRooms",Y);try{await(0,d.c4)(a.db,(async t=>{var n;const i=await t.get(e),l=await t.get(o);if(!(await t.get(r)).exists())throw"Room does not exist!";const s=await(0,d.x7)((0,d.H9)(a.db,"users",be.uid)),c=s.exists()?(null===(n=s.data())||void 0===n?void 0:n.username)||be.displayName:"Someone";l.exists()&&(t.delete(o),t.update(r,{heartCount:(0,d.GV)(-1)}),wo(!1)),i.exists()?(t.delete(e),t.update(r,{heartbreakCount:(0,d.GV)(-1)})):(t.set(e,{userId:be.uid,username:c,timestamp:(0,d.O5)()}),t.update(r,{heartbreakCount:(0,d.GV)(1)}))}))}catch(ke){console.error("Error heartbreaking room:",ke),c.oR.error("Failed to update heartbreak status.")}finally{Uo(!1)}},currentUserHearted:Ao,currentUserHeartbroken:Eo,roomHeartCount:yo,roomHeartbreakCount:Ro,isHearting:hr,isHeartbreaking:Po,accentColor:null===Ae||void 0===Ae||null===(e=Ae.style)||void 0===e?void 0:e.accentColor,textColor:null===Ae||void 0===Ae||null===(o=Ae.style)||void 0===o?void 0:o.textColor}),(0,Re.jsxs)(Te.mg,{children:[(0,Re.jsx)("title",{children:Et}),(0,Re.jsx)("meta",{name:"description",content:Ft}),(0,Re.jsx)("meta",{property:"og:type",content:"website"}),(0,Re.jsx)("meta",{property:"og:url",content:Tt}),(0,Re.jsx)("meta",{property:"og:title",content:Et}),(0,Re.jsx)("meta",{property:"og:description",content:Ft}),(0,Re.jsx)("meta",{property:"og:image",content:Ut}),(0,Re.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,Re.jsx)("meta",{property:"og:image:height",content:"630"}),(0,Re.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,Re.jsx)("meta",{name:"twitter:url",content:Tt}),(0,Re.jsx)("meta",{name:"twitter:title",content:Et}),(0,Re.jsx)("meta",{name:"twitter:description",content:Ft}),(0,Re.jsx)("meta",{name:"twitter:image",content:Ut})]}),(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===Ae||void 0===Ae||null===(r=Ae.style)||void 0===r?void 0:r.font)||We[0],backgroundColor:null!==Ae&&void 0!==Ae&&null!==(l=Ae.style)&&void 0!==l&&l.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Ae||void 0===Ae||null===(B=Ae.style)||void 0===B?void 0:B.backgroundColor)||Ce.palette.background.default,", ").concat((null===Ae||void 0===Ae||null===(G=Ae.style)||void 0===G?void 0:G.accentColor)||Ce.palette.secondary.main,")"):(null===Ae||void 0===Ae||null===(_=Ae.style)||void 0===_?void 0:_.backgroundColor)||Ce.palette.background.default,color:(null===Ae||void 0===Ae||null===(N=Ae.style)||void 0===N?void 0:N.textColor)||Ce.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[Ae&&(()=>{var e,o,r,t,n,i,l,s,m,A,w,j,S,k,R,I,E,F,P,U,T,D;return(0,Re.jsxs)(u.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==Ae&&void 0!==Ae&&null!==(e=Ae.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Ae||void 0===Ae||null===(o=Ae.style)||void 0===o?void 0:o.headerColor)||Ce.palette.primary.main,", ").concat((null===Ae||void 0===Ae||null===(r=Ae.style)||void 0===r?void 0:r.accentColor)||Ce.palette.secondary.light,")"):(null===Ae||void 0===Ae||null===(t=Ae.style)||void 0===t?void 0:t.headerColor)||Ce.palette.background.paper,color:(null===Ae||void 0===Ae||null===(n=Ae.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,Re.jsx)(g.A,{variant:"h6",sx:{fontFamily:(null===Ae||void 0===Ae||null===(i=Ae.style)||void 0===i?void 0:i.font)||We[0],fontSize:null!==Ae&&void 0!==Ae&&null!==(l=Ae.style)&&void 0!==l&&l.headerFontSize?"".concat(Ae.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===Ae||void 0===Ae?void 0:Ae.name}),st&&(0,Re.jsxs)(g.A,{variant:"caption",sx:{opacity:null!==Ae&&void 0!==Ae&&null!==(s=Ae.style)&&void 0!==s&&s.textColor?.85:1,fontFamily:(null===Ae||void 0===Ae||null===(m=Ae.style)||void 0===m?void 0:m.font)||We[0]},children:["Host: ",st.username]})]}),(0,Re.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===be||void 0===be?void 0:be.uid)&&(null===Ae||void 0===Ae?void 0:Ae.ownerId)&&be.uid!==Ae.ownerId&&st&&(0,Re.jsx)(h.A,{title:"Follow ".concat(st.username),children:(0,Re.jsx)(p.A,{onClick:async()=>{if(null!==be&&void 0!==be&&be.uid&&null!==Ae&&void 0!==Ae&&Ae.ownerId&&a.db)try{const e=(0,d.H9)(a.db,"users",be.uid,"following",Ae.ownerId),o=await(0,d.x7)(e),r=(0,d.H9)(a.db,"users",Ae.ownerId,"followRequests",be.uid),t=await(0,d.x7)(r),n=(0,d.H9)(a.db,"users",Ae.ownerId),i=await(0,d.x7)(n),l=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(a.db,"users",Ae.ownerId,"followers",be.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(st.username))}else if(t.exists())await(0,d.kd)(r),c.oR.success("Canceled follow request to ".concat(st.username));else if(l)await(0,d.BN)(r,{userId:be.uid,username:be.displayName||be.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(st.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(a.db,"users",Ae.ownerId,"followers",be.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(st.username));const r=await mt(Ae.ownerId);r&&(Xr(r),Yr(!0))}}catch(ke){console.error("Error toggling follow:",ke),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===Ae||void 0===Ae||null===(A=Ae.style)||void 0===A?void 0:A.accentColor)||"inherit"},children:(0,Re.jsx)(Z.A,{})})}),(0,Re.jsx)(h.A,{title:"Share",children:(0,Re.jsx)(p.A,{onClick:pt,sx:{color:(null===Ae||void 0===Ae||null===(w=Ae.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,Re.jsx)(K.A,{})})}),tt&&(0,Re.jsx)(h.A,{title:"Share Video Link",children:(0,Re.jsx)(p.A,{onClick:dt,size:"small",color:"secondary",children:(0,Re.jsx)(q.A,{})})}),(0,Re.jsx)(h.A,{title:"Chat with Sade AI",children:(0,Re.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>$o(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===Ae||void 0===Ae||null===(j=Ae.style)||void 0===j?void 0:j.accentColor)||Ce.palette.primary.light)}})}),Er&&(0,Re.jsx)(h.A,{title:Tr?"Stop Recording":"Record Room (Desktop Only)",children:(0,Re.jsx)(p.A,{onClick:Tr?Ht:zt,color:Tr?"error":"inherit",sx:{color:Tr?Ce.palette.error.main:(null===Ae||void 0===Ae||null===(S=Ae.style)||void 0===S?void 0:S.accentColor)||"inherit"},children:Tr?(0,Re.jsx)(Q.A,{}):(0,Re.jsx)($.A,{})})}),po&&(0,Re.jsx)(h.A,{title:Lr?"Turn Camera Off":"Turn Camera On",children:(0,Re.jsx)(p.A,{onClick:$r,sx:{color:Lr?(null===Ae||void 0===Ae||null===(k=Ae.style)||void 0===k?void 0:k.accentColor)||Ce.palette.primary.main:"inherit"},children:Lr?(0,Re.jsx)($.A,{}):(0,Re.jsx)(ee.A,{})})}),tt&&(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(h.A,{title:"Room Settings",children:(0,Re.jsx)(p.A,{onClick:gt,sx:{color:(null===Ae||void 0===Ae||null===(R=Ae.style)||void 0===R?void 0:R.accentColor)||"inherit"},children:(0,Re.jsx)(oe.A,{})})}),(0,Re.jsxs)(x.A,{anchorEl:to,open:Boolean(to),onClose:vt,children:[(0,Re.jsxs)(f.A,{onClick:xt,children:[" ",(0,Re.jsx)(b.A,{children:(0,Re.jsx)(re.A,{fontSize:"small"})}),"Edit Room"]}),(0,Re.jsxs)(f.A,{onClick:ft,children:[" ",(0,Re.jsx)(b.A,{children:(0,Re.jsx)(te.A,{fontSize:"small"})}),"Customize"]}),(0,Re.jsxs)(f.A,{onClick:bt,children:[" ",(0,Re.jsx)(b.A,{children:(0,Re.jsx)(Z.A,{fontSize:"small"})}),"Invite"]}),(0,Re.jsxs)(f.A,{onClick:Ct,sx:{color:"error.main"},children:[(0,Re.jsx)(b.A,{children:(0,Re.jsx)(ne.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,Re.jsx)(h.A,{title:"Leave Room",children:(0,Re.jsx)(p.A,{onClick:()=>{tt?kr(!0):X("/side-rooms")},disabled:Ge,sx:{color:(null===Ae||void 0===Ae||null===(I=Ae.style)||void 0===I?void 0:I.accentColor)||"inherit"},children:(0,Re.jsx)(ie.A,{})})}),tt&&Er&&po&&(0,Re.jsx)(h.A,{title:Rr?"Stop Sharing Screen":"Share Screen (Desktop Only)",children:(0,Re.jsx)(p.A,{onClick:Dt,sx:{color:(null===Ae||void 0===Ae||null===(E=Ae.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:Rr?(0,Re.jsx)(le.A,{}):(0,Re.jsx)(se.A,{})})})]})]}),(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Re.jsxs)(g.A,{variant:"caption",sx:{fontFamily:(null===Ae||void 0===Ae||null===(F=Ae.style)||void 0===F?void 0:F.font)||We[0]},children:[lt.length," Online"]}),(0,Re.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!po&&mo&&it&&(0,Re.jsx)(y.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),po?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):bo(!0)},startIcon:vo?(0,Re.jsx)(C.A,{size:20,color:"inherit"}):(0,Re.jsx)(ae.A,{}),disabled:vo||!mo,sx:{backgroundColor:null===Ae||void 0===Ae||null===(P=Ae.style)||void 0===P?void 0:P.accentColor,fontFamily:(null===Ae||void 0===Ae||null===(U=Ae.style)||void 0===U?void 0:U.font)||We[0],color:null!==Ae&&void 0!==Ae&&null!==(T=Ae.style)&&void 0!==T&&T.accentColor?Ce.palette.getContrastText(Ae.style.accentColor):void 0},children:vo?"Connecting...":"Connect Audio (Stream)"}),po&&(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(h.A,{title:"Toggle Microphone",children:(0,Re.jsxs)(p.A,{onClick:async()=>{var e;if(null===po||void 0===po||!po.microphone||null===be||void 0===be||!be.uid||!Y)return;const o=io.find((e=>e.userId===be.uid)),r=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await po.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(r));const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",be.uid);await(0,d.mZ)(e,{isMuted:r}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(be.uid," to ").concat(r))}catch(ke){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",ke),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==po&&void 0!==po&&po.microphone)||!(null!==be&&void 0!==be&&be.uid)||!Y,children:[(0,Re.jsx)(de.A,{})," "]})}),(0,Re.jsx)(g.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,Re.jsx)(y.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===po||void 0===po||po.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),X("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:vo,sx:{fontFamily:(null===Ae||void 0===Ae||null===(D=Ae.style)||void 0===D?void 0:D.font)||We[0]},children:"Leave Audio"})]}),!mo&&je&&(0,Re.jsx)(C.A,{size:24})]})]})]})})(),(0,Re.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto"},children:Ae?mo?po?(0,Re.jsx)(Fe.Mf9,{client:mo,children:(0,Re.jsx)(Fe.xwR,{call:po,children:(0,Re.jsx)(_e,{room:Ae,isRoomOwner:tt,isGuest:nt,handleOpenShareVideoDialog:dt,handleClearSharedVideo:ut,currentVideoUrl:Ho,renderVideoPlayer:It,onForceMuteToggle:At,onForceRemove:wt,onForceBan:jt,theme:Ce,navigate:X})})}):(0,Re.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[Ho&&(0,Re.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Re.jsx)(g.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),tt&&(0,Re.jsx)(h.A,{title:"Clear Shared Video",children:(0,Re.jsx)(p.A,{onClick:ut,size:"small",children:(0,Re.jsx)(ce.A,{})})})]}),(0,Re.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:It()})]}),(0,Re.jsxs)(g.A,{variant:"h6",gutterBottom:!0,children:["Participants (",lt.length,")"]}),(0,Re.jsx)(w.Ay,{container:!0,spacing:2,children:lt.map((e=>(0,Re.jsx)(w.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,Re.jsxs)(j.A,{sx:{p:1,textAlign:"center"},children:[(0,Re.jsx)(v.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,Re.jsx)(g.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,Re.jsx)(ue.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!po&&!vo&&it&&(0,Re.jsx)(A.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),vo&&(0,Re.jsx)(A.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===co&&it&&null!==be&&void 0!==be&&be.uid&&Y||null!==co&&!mo?(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(C.A,{sx:{mb:2}}),(0,Re.jsx)(g.A,{children:"Initializing audio components..."}),(0,Re.jsx)(g.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!it&&null!==be&&void 0!==be&&be.uid?(0,Re.jsx)(A.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,Re.jsx)(A.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,Re.jsx)(y.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[je&&(0,Re.jsx)(C.A,{}),!je&&(0,Re.jsxs)(A.A,{severity:"error",children:["Room not found. ",(0,Re.jsx)(y.A,{onClick:()=>X("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,Re.jsxs)(S.A,{open:To,onClose:ct,fullWidth:!0,maxWidth:"sm",children:[(0,Re.jsx)(k.A,{children:"Share a Video"}),(0,Re.jsx)(R.A,{children:(0,Re.jsx)(I.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:Oo,onChange:e=>zo(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:ct,children:"Cancel"}),(0,Re.jsx)(y.A,{onClick:()=>{if(!Y)return void c.oR.error("Cannot share video: Room ID is missing.");if(!Oo.trim())return void c.oR.error("Please enter a video URL.");if(!Oo.startsWith("http://")&&!Oo.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{currentSharedVideoUrl:Oo,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),Wo(Oo),c.oR.success("Video shared!"),ct()},variant:"contained",children:"Share Video"})]})]}),(0,Re.jsxs)(S.A,{open:oo,onClose:()=>ro(!1),fullWidth:!0,maxWidth:"xs",children:[(0,Re.jsx)(k.A,{children:"Share this Room"}),(0,Re.jsxs)(R.A,{sx:{textAlign:"center"},children:[(0,Re.jsx)(g.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,Re.jsx)(I.A,{fullWidth:!0,variant:"outlined",value:Tt,InputProps:{readOnly:!0},sx:{mb:2}}),(0,Re.jsx)(y.A,{variant:"contained",startIcon:(0,Re.jsx)(me.A,{}),onClick:()=>{navigator.clipboard.writeText(Tt),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,Re.jsx)(g.A,{variant:"subtitle2",gutterBottom:!0,children:"Or share on:"}),(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,Re.jsx)(p.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(Tt),"&text=").concat(encodeURIComponent((null===Ae||void 0===Ae?void 0:Ae.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,Re.jsx)(he.A,{})}),(0,Re.jsx)(p.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(Tt)),"_blank"),title:"Share on Facebook",children:(0,Re.jsx)(pe.A,{})}),(0,Re.jsx)(p.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===Ae||void 0===Ae?void 0:Ae.name)||"Join my SideEye Room!")+" "+Tt)),"_blank"),title:"Share on WhatsApp",children:(0,Re.jsx)(ge.A,{})}),(0,Re.jsx)(p.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText(Tt),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,Re.jsx)(ve.A,{})})]})]}),(0,Re.jsx)(E.A,{children:(0,Re.jsx)(y.A,{onClick:()=>ro(!1),children:"Close"})})]}),(0,Re.jsxs)(S.A,{open:Qo,onClose:()=>$o(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,Re.jsxs)(k.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,Re.jsx)(h.A,{title:"Clear Chat History",children:(0,Re.jsx)(p.A,{onClick:()=>{or([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,Re.jsx)(ne.A,{})})})]}),(0,Re.jsx)(R.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:Ce.palette.background.default},children:(0,Re.jsxs)(F.A,{sx:{p:0},children:[er.map(((e,o)=>(0,Re.jsxs)(P.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,Re.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,Re.jsx)(j.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,Re.jsx)(ze.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),nr&&(0,Re.jsxs)(P.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,Re.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Re.jsx)(j.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,Re.jsx)("div",{ref:lr})]})}),(0,Re.jsxs)(E.A,{sx:{p:1,borderTop:"1px solid ".concat(Ce.palette.divider),flexDirection:"column"},children:[er.length<=1&&!nr&&(0,Re.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,Re.jsx)(U.A,{label:e,onClick:()=>Rt(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,Re.jsxs)(u.A,{sx:{display:"flex",width:"100%"},children:[(0,Re.jsx)(I.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:rr,onChange:e=>tr(e.target.value),onKeyPress:e=>"Enter"===e.key&&!nr&&Rt(),sx:{mr:1},disabled:nr}),(0,Re.jsxs)(p.A,{onClick:()=>!nr&&Rt(rr,!1),disabled:nr||!rr.trim(),color:"primary",children:[(0,Re.jsx)(K.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,Re.jsxs)(p.A,{onClick:()=>!nr&&Rt(rr,!0),disabled:nr||!rr.trim(),color:"secondary",title:"Search the web",children:[(0,Re.jsx)(xe.A,{})," "]})]})]})]}),Ze&&Ae&&(0,Re.jsx)(Ie,{open:Ze,onClose:()=>Ke(!1),onSubmit:async(e,o)=>{if(Y&&be){Ne(!0);try{let r=Ae.thumbnailUrl||"";if(o){const e=(0,Ue.KR)(a.IG,"room-thumbnails/".concat(Y,"_").concat(Date.now(),"_").concat(o.name));await(0,Ue.D)(e,o),r=await(0,Ue.qk)(e)}const t=(0,d.H9)(a.db,"sideRooms",Y),n={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:r,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?n.password=e.password:e.isPrivate||(n.password=(0,d.CL)()),await(0,d.mZ)(t,n),c.oR.success("Room details updated successfully!"),Ke(!1)}catch(r){console.error("Error updating room:",r),c.oR.error("Failed to update room details.")}finally{Ne(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:Ae,title:"Edit Room",submitButtonText:"Save Changes"}),(0,Re.jsxs)(S.A,{open:$e,onClose:()=>eo(!1),fullWidth:!0,maxWidth:"sm",children:[(0,Re.jsx)(k.A,{children:"Customize Room Appearance"}),(0,Re.jsx)(R.A,{children:(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Re.jsxs)(T.A,{fullWidth:!0,children:[(0,Re.jsx)(D.A,{id:"theme-select-label",children:"Theme"}),(0,Re.jsx)(O.A,{labelId:"theme-select-label",value:gr,label:"Theme",onChange:e=>vr(e.target.value),children:He.map((e=>(0,Re.jsx)(f.A,{value:e.name,children:e.name},e.name)))})]}),(0,Re.jsxs)(T.A,{fullWidth:!0,children:[(0,Re.jsx)(D.A,{id:"font-select-label",children:"Font"}),(0,Re.jsx)(O.A,{labelId:"font-select-label",value:Cr,label:"Font",onChange:e=>Ar(e.target.value),children:We.map((e=>(0,Re.jsx)(f.A,{value:e,children:e},e)))})]}),(0,Re.jsxs)(T.A,{fullWidth:!0,children:[(0,Re.jsx)(D.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,Re.jsx)(O.A,{labelId:"text-size-select-label",value:wr.toString(),label:"Header Text Size (px)",onChange:e=>jr(Number(e.target.value)),children:Me.map((e=>(0,Re.jsx)(f.A,{value:e.toString(),children:e},e)))})]}),(0,Re.jsx)(z.A,{control:(0,Re.jsx)(H.A,{checked:xr,onChange:e=>fr(e.target.checked)}),label:"Use Header Gradient"}),(0,Re.jsx)(z.A,{control:(0,Re.jsx)(H.A,{checked:br,onChange:e=>yr(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:()=>eo(!1),children:"Cancel"}),(0,Re.jsx)(y.A,{onClick:async()=>{var e,o,r,t,n;if(!Y||!Ae)return void c.oR.error("Cannot save style: Room data is missing.");if(!be)return void c.oR.error("You must be logged in to change the style.");if(!tt)return void c.oR.error("Only the room owner can change the style.");const i=He.find((e=>e.name===gr));if(!i){var l,s,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=He[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:Cr,headerFontSize:wr,headerGradient:xr,backgroundGradient:br,customCss:(null===(l=Ae.style)||void 0===l?void 0:l.customCss)||"",bannerUrl:(null===(s=Ae.style)||void 0===s?void 0:s.bannerUrl)||"",stickers:(null===(u=Ae.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=Ae.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=Ae.style)||void 0===h?void 0:h.thumbnailUrl)||Ae.thumbnailUrl||""};try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),eo(!1)}catch(ke){console.error("Error updating room style with default theme:",ke),c.oR.error("Failed to update room style.")}finally{Ne(!1)}return}const p={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:Cr,headerFontSize:wr,headerGradient:xr,backgroundGradient:br,customCss:(null===(e=Ae.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=Ae.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(r=Ae.style)||void 0===r?void 0:r.stickers)||[],glitterEffect:(null===(t=Ae.style)||void 0===t?void 0:t.glitterEffect)||!1,thumbnailUrl:(null===(n=Ae.style)||void 0===n?void 0:n.thumbnailUrl)||Ae.thumbnailUrl||""};Ne(!0);try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{style:p,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),eo(!1)}catch(ke){console.error("Error updating room style:",ke),c.oR.error("Failed to update room style.")}finally{Ne(!1)}},variant:"contained",disabled:Ge,children:Ge?(0,Re.jsx)(C.A,{size:24}):"Save Style"})]})]}),(0,Re.jsxs)(S.A,{open:qe,onClose:()=>{Qe(!1),Lo(""),Yo(null),Go([]),No(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,Re.jsx)(k.A,{children:"Invite User to Room"}),(0,Re.jsxs)(R.A,{children:[(0,Re.jsx)(g.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,Re.jsxs)(u.A,{ref:Zo,sx:{position:"relative"},children:[(0,Re.jsx)(I.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:Mo,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Lo(o),Yo(null),o.trim().length>=2?(No(!0),ht(o)):(No(!1),Go([]))},sx:{mb:1}}),_o&&Bo.length>0&&(0,Re.jsx)(j.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:Ce.zIndex.modal+1,mt:.5},children:(0,Re.jsx)(W.x,{onClickAway:()=>{No(!1)},children:(0,Re.jsx)(F.A,{dense:!0,children:Bo.map((e=>(0,Re.jsxs)(P.Ay,{button:!0,onClick:()=>{return Yo(o=e),Lo(o.username),No(!1),void Go([]);var o},children:[(0,Re.jsx)(M.A,{children:(0,Re.jsx)(v.A,{src:e.profilePic,alt:e.username})}),(0,Re.jsx)(L.A,{primary:(0,Re.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,Re.jsx)(fe.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),_o&&0===Bo.length&&Mo.length>=2&&(0,Re.jsxs)(g.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',Mo,'".']})]}),Vo&&(0,Re.jsxs)(g.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",Vo.username,(0,Re.jsx)(fe.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:()=>{Qe(!1),Lo(""),Yo(null),Go([]),No(!1)},children:"Cancel"}),(0,Re.jsx)(y.A,{onClick:yt,variant:"contained",disabled:Jo||!Vo||!Ko,children:Jo?(0,Re.jsx)(C.A,{size:24}):"Send Invite"})]})]}),(0,Re.jsxs)(S.A,{open:Sr,onClose:()=>kr(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,Re.jsx)(k.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,Re.jsxs)(R.A,{children:[(0,Re.jsx)(g.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,Re.jsx)(g.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:()=>kr(!1),disabled:Ge,children:"Cancel"}),(0,Re.jsx)(y.A,{onClick:()=>{kr(!1),Ct()},color:"error",variant:"contained",disabled:Ge,autoFocus:!0,children:Ge?(0,Re.jsx)(C.A,{size:24}):"End and Delete"})]})]}),(0,Re.jsxs)(S.A,{open:Ve,onClose:()=>{tt||it||X("/side-rooms")},children:[(0,Re.jsx)(k.A,{children:"Password Required"}),(0,Re.jsxs)(R.A,{children:[(0,Re.jsx)(g.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,Re.jsx)(I.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Je,onChange:e=>Xe(e.target.value),onKeyPress:e=>"Enter"===e.key&&Ot()})]}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:()=>X("/side-rooms"),disabled:Ge,children:"Cancel"}),(0,Re.jsx)(y.A,{onClick:Ot,disabled:Ge||!Je,variant:"contained",children:Ge?(0,Re.jsx)(C.A,{size:24}):"Submit"})]})]}),(0,Re.jsxs)(S.A,{open:Vr,onClose:Wt,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,Re.jsx)(k.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,Re.jsx)(R.A,{children:(0,Re.jsxs)(g.A,{variant:"body1",children:[(null===st||void 0===st?void 0:st.username)||"This creator",' has a server chat room: "',null===Jr||void 0===Jr?void 0:Jr.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,Re.jsxs)(E.A,{children:[(0,Re.jsx)(y.A,{onClick:Wt,children:"Not Now"}),(0,Re.jsx)(y.A,{onClick:()=>{Jr&&X("/chat/room/".concat(Jr.id)),Yr(!1)},variant:"contained",color:"primary",children:"Join Chat Room"})]})]})]})]})},_e=e=>{var o,r,i,l,m,x,f,b,A,S,k,R,E,F,P,T,D,O,z,H,W,M,L,V,Y,J,X,Z,K,Q,oe,re,te,ne,se,ae,me,he,pe,ge,ve,xe,fe,we,je,Se,ke,Ie,Ee,Ue,Te;let{room:De,isRoomOwner:Oe,isGuest:ze,handleOpenShareVideoDialog:He,handleClearSharedVideo:We,currentVideoUrl:Me,renderVideoPlayer:Le,onForceMuteToggle:Be,onForceRemove:Ge,onForceBan:_e,theme:Ve,navigate:Ye}=e;const Je=(0,Pe.Gc)(),{useParticipants:Xe,useCallState:Ze,useMicrophoneState:Ke,useCameraState:qe}=(0,Pe.R3)(),Qe=Xe(),{localParticipant:$e}=Ze(),{isMute:eo}=Ke(),{isEnabled:oo,isTogglePending:ro}=qe();(0,n.useEffect)((()=>{Je&&Je.camera.disable().catch((e=>{console.error("Error disabling camera:",e)}))}),[Je]);const{currentUser:to}=(0,s.As)(),[no,io]=(0,n.useState)(window.innerWidth>1024),[lo,so]=(0,n.useState)(!0),[ao,co]=(0,n.useState)(!1),[uo,mo]=(0,n.useState)([]),[ho,po]=(0,n.useState)([]),[go,vo]=(0,n.useState)("participants"),[xo,fo]=(0,n.useState)([]),[bo,yo]=(0,n.useState)(""),Co=(0,n.useRef)(null),Ao=Qe.find((e=>e.screenShareStream)),wo=(null===Ao||void 0===Ao?void 0:Ao.userId)===De.ownerId;(0,n.useEffect)((()=>{Ao&&(console.log("Screen sharing detected from participant ".concat(Ao.name||Ao.userId)),wo&&console.log("Room owner is sharing their screen - should be visible to ALL participants"))}),[Ao,wo]);(0,n.useEffect)((()=>{wo&&Ao&&console.log("Room owner is sharing screen - should be visible to all participants")}),[wo,Ao]),(0,n.useEffect)((()=>{Ao&&console.log("Screen sharing available from participant: ".concat(Ao.name||Ao.userId))}),[Ao]);const[jo,So]=(0,n.useState)({}),ko=(0,n.useCallback)((async e=>{if(jo[e])return jo[e];try{const o=(0,d.H9)(a.db,"users",e),r=await(0,d.x7)(o);if(r.exists()){const o=r.data(),n={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return So((o=>(0,t.A)((0,t.A)({},o),{},{[e]:n}))),n}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return So((r=>(0,t.A)((0,t.A)({},r),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[jo,a.db]),Ro=(0,n.useCallback)((async()=>{if(!bo.trim()||null===to||void 0===to||!to.uid||null===De||void 0===De||!De.id||!a.db)return;const e=await ko(to.uid),o={id:"".concat(Date.now(),"-").concat(to.uid),userId:to.uid,userName:e.username,message:bo.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(a.db,"sideRooms",De.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(r){console.error("[Chat] Error sending message to Firestore:",r),fo((e=>[...e,o]))}yo("")}),[bo,null===to||void 0===to?void 0:to.uid,null===De||void 0===De?void 0:De.id,a.db,ko]);(0,n.useEffect)((()=>{if(null===De||void 0===De||!De.id||!a.db)return;console.log("[Chat] Setting up chat listener for room ".concat(De.id));const e=(0,d.P)((0,d.rJ)(a.db,"sideRooms",De.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const r=e.data();o.push({id:e.id,userId:r.userId,userName:r.userName,message:r.message,timestamp:r.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),fo(o),Co.current&&Co.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===De||void 0===De?void 0:De.id,a.db]);const Io=(0,n.useCallback)((async()=>{if(Je)if(no)try{await Je.screenShare.toggle(),Je.screenShare.enabled?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(n){var e,o,r,t;console.error("Error toggling screen share:",n),"NotAllowedError"===n.name||null!==(e=n.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=n.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(r=n.message)&&void 0!==r&&r.includes("getDisplayMedia is not supported")||null!==(t=n.message)&&void 0!==t&&t.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(n.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[Je,no]);(0,n.useEffect)((()=>{const e=()=>{io(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const Eo=e=>{po((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))},Fo=()=>{Je&&("enabled"!==Je.camera.state.status?navigator.mediaDevices.getUserMedia({video:!0}).then((e=>(e.getTracks().forEach((e=>e.stop())),Je.camera.enable()))).then((()=>{so(!0)})).catch((e=>{console.error("Error enabling camera:",e),c.oR.error("Could not enable camera. Please check permissions.")})):Je.camera.disable().catch((e=>{console.error("Error disabling camera:",e)})))};(0,n.useEffect)((()=>{var e;null===(e=Co.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[xo]);const Po=(0,n.useMemo)((()=>{if(!Qe||null===De||void 0===De||!De.ownerId)return[];const e=Qe.find((e=>e.userId===De.ownerId));return[...e?[e]:[],...Qe.filter((e=>ho.includes(e.userId)&&e.userId!==De.ownerId)),...Qe.filter((e=>e.userId!==De.ownerId&&!ho.includes(e.userId)))].filter(Boolean)}),[Qe,null===De||void 0===De?void 0:De.ownerId,ho]);(0,n.useEffect)((()=>{oo&&so(!0)}),[oo]);const Uo=Po;(0,n.useEffect)((()=>{if(null===Qe||void 0===Qe||!Qe.length)return;(async()=>{const e=Qe.filter((e=>!jo[e.userId])).map((e=>ko(e.userId)));await Promise.all(e)})()}),[Qe,ko,jo]);return(0,n.useEffect)((()=>{if(Je&&null!==to&&void 0!==to&&to.uid&&null!==De&&void 0!==De&&De.id&&"boolean"===typeof eo&&a.db){const e=(0,d.H9)(a.db,"sideRooms",De.id,"presence",to.uid),o="sideRooms/".concat(De.id,"/presence/").concat(to.uid);console.log("[DEBUG Mute Sync] Attempting updateDoc to path:",o,"with data:",JSON.stringify({isMuted:eo},null,2)),(0,d.mZ)(e,{isMuted:eo}).then((()=>{console.log("[InsideStreamCallContent] Synced local mute state (".concat(eo,") to Firestore for ").concat(to.uid))})).catch((e=>{console.error("[InsideStreamCallContent] Error syncing local mute state to Firestore for ".concat(to.uid,":"),e)}))}}),[eo,Je,null===to||void 0===to?void 0:to.uid,null===De||void 0===De?void 0:De.id,a.db]),(0,n.useEffect)((()=>{if(!Je||!Qe||0===Qe.length)return;const e=Qe.find((e=>e.screenShareStream));e&&(console.log("Screen sharing detected from: ".concat(e.name||e.userId)),console.log("Screen share stream should be visible to ALL participants"))}),[Je,Qe]),Je?(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==De&&void 0!==De&&null!==(r=De.style)&&void 0!==r&&r.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.backgroundColor)||Ve.palette.background.default,", ").concat((null===De||void 0===De||null===(l=De.style)||void 0===l?void 0:l.accentColor)||Ve.palette.secondary.main,")"):(null===De||void 0===De||null===(m=De.style)||void 0===m?void 0:m.backgroundColor)||Ve.palette.background.default,color:(null===De||void 0===De||null===(x=De.style)||void 0===x?void 0:x.textColor)||Ve.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[(()=>{var e,o,r,t,n,i,l,s,a;return(0,Re.jsxs)(u.A,{sx:{p:1,borderBottom:1,borderColor:"divider",textAlign:"center",flexShrink:0,backgroundColor:null!==De&&void 0!==De&&null!==(e=De.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.headerColor)||Ve.palette.primary.main,", ").concat((null===De||void 0===De||null===(r=De.style)||void 0===r?void 0:r.accentColor)||Ve.palette.secondary.light,")"):(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.headerColor)||(0,N.X4)(Ve.palette.background.paper,.95),color:(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Re.jsx)(g.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.font)||"inherit"},children:De.name}),(0,Re.jsxs)(g.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(l=De.style)&&void 0!==l&&l.textColor?(0,N.X4)(null===De||void 0===De||null===(s=De.style)||void 0===s?void 0:s.textColor,.8):"text.secondary",sx:{fontFamily:(null===De||void 0===De||null===(a=De.style)||void 0===a?void 0:a.font)||"inherit"},children:["(Mic: ",eo?"Muted":"On",")"]})]})})(),(0,Re.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[!Ao&&(0,Re.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Re.jsx)(g.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===De||void 0===De||null===(f=De.style)||void 0===f?void 0:f.accentColor)||Ve.palette.primary.main},children:"Live Video"}),(0,Re.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"},mb:2},children:[oo?(0,Re.jsxs)(u.A,{sx:{border:"3px solid",borderColor:Ve.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(0,Re.jsx)(p.A,{onClick:Fo,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Re.jsx)(be.A,{fontSize:"small"})}),$e&&(0,Re.jsx)(Fe.fSl,{participant:$e,trackType:"videoTrack"}),(0,Re.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Re.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Re.jsx)(v.A,{sx:{width:40,height:40,mr:1},children:(null===to||void 0===to||null===(b=to.displayName)||void 0===b?void 0:b[0])||"U"}),(0,Re.jsxs)(u.A,{children:[(0,Re.jsx)(g.A,{variant:"subtitle2",fontWeight:"bold",children:(null===to||void 0===to?void 0:to.displayName)||"You"}),(0,Re.jsx)(g.A,{variant:"caption",children:(null===De||void 0===De?void 0:De.name)||"Live Room"})]})]})}),(0,Re.jsx)(u.A,{sx:{position:"absolute",right:12,bottom:70,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:(0,Re.jsx)(h.A,{title:eo?"Unmute":"Mute",children:(0,Re.jsx)(p.A,{onClick:()=>null===Je||void 0===Je?void 0:Je.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:44,height:44,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:eo?(0,Re.jsx)(ue.A,{}):(0,Re.jsx)(de.A,{})})})})]}):(0,Re.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Re.jsx)(y.A,{variant:"contained",color:"primary",onClick:Fo,startIcon:(0,Re.jsx)($.A,{}),children:"Enable Camera"})}),Qe&&Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid))).length>0&&(lo?(0,Re.jsxs)(u.A,{sx:{border:"3px solid",borderColor:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(()=>{const e=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===to||void 0===to?void 0:to.uid))),o=Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid)))[0],r=e||o;return r?(0,Re.jsx)(Fe.fSl,{participant:r,trackType:"videoTrack"}):null})(),(0,Re.jsx)(p.A,{onClick:()=>{so(!1),c.oR.success("Video view closed")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Re.jsx)(be.A,{fontSize:"small"})}),(0,Re.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(e=>{const o=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===to||void 0===to?void 0:to.uid))),r=Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid)))[0],t=o||r;return t&&(0,Re.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Re.jsx)(v.A,{src:null===(e=jo[t.userId])||void 0===e?void 0:e.avatar,sx:{width:40,height:40,mr:1}}),(0,Re.jsx)(u.A,{children:(0,Re.jsxs)(g.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===t||void 0===t?void 0:t.name)||"User",t.userId===De.ownerId&&" (Host)"]})})]})})()})]}):(0,Re.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Re.jsx)(y.A,{variant:"outlined",color:"primary",onClick:()=>so(!0),startIcon:(0,Re.jsx)($.A,{}),children:"Show Partner Video"})}))]}),Qe&&Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid))).length>1&&(0,Re.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:1,mt:2,width:"100%",maxWidth:"600px"},children:Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid))).filter((e=>{const o=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===to||void 0===to?void 0:to.uid)));return!(e.userId===De.ownerId&&o===Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid)))[0])})).filter((e=>!uo.includes(e.userId))).map((e=>(0,Re.jsxs)(u.A,{sx:{width:"100px",height:"150px",borderRadius:"10px",overflow:"hidden",position:"relative",border:"2px solid",borderColor:"divider",backgroundColor:"#000","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[(0,Re.jsx)(Fe.fSl,{participant:e,trackType:"videoTrack"}),(0,Re.jsx)(p.A,{onClick:()=>{const o=[...uo||[]];if(o.includes(e.userId)){const r=o.indexOf(e.userId);r>-1&&o.splice(r,1)}else o.push(e.userId);mo(o),c.oR.success("Video view toggled")},sx:{position:"absolute",top:2,right:2,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:20,height:20,zIndex:10,padding:"2px","& .MuiSvgIcon-root":{fontSize:"14px"},"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Re.jsx)(be.A,{})}),(0,Re.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"2px 4px",background:"rgba(0,0,0,0.7)",color:"white",fontSize:"10px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name||"User ".concat(e.userId.substring(0,5))})]},e.userId)))})]}),Ao&&(0,Re.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Re.jsxs)(g.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===De||void 0===De||null===(A=De.style)||void 0===A?void 0:A.accentColor)||Ve.palette.primary.main},children:[Ao.userId===(null===to||void 0===to?void 0:to.uid)?"You are sharing your screen":"".concat(Ao.name||"Someone"," is sharing their screen"),wo&&Ao.userId!==(null===to||void 0===to?void 0:to.uid)&&" (Room Owner)"]}),(0,Re.jsxs)(u.A,{sx:{m:0,p:0,border:"1px solid",borderColor:"divider",borderRadius:"8px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:"auto",width:"90%",maxWidth:"1200px",margin:"0 auto",marginTop:2,marginBottom:2,overflow:"hidden",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:[!ao&&(0,Re.jsx)(u.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none","& .str-video__screen-share-info":{display:"none !important",visibility:"hidden !important",opacity:0,height:0,overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:-9999},'& .str-video__participant-details, & .str-video__participant-bar, & .str-video__loading-indicator, & .str-video__screen-share-text, & .str-video__screen-share-status, & .str-video__participant__name, & .str-video__participant__info, & .str-video__participant-flag, & div[class*="screen-share"], & span[class*="presentation"]':{display:"none !important",visibility:"hidden !important",opacity:0,height:0,width:0,overflow:"hidden",pointerEvents:"none"},"& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"contain",background:"#000"},"& .str-video__participant-details":{display:"none !important"},"& .str-video__participant-status":{display:"none !important"},"& .str-video__participant-flag-container":{display:"none !important"}}},children:(0,Re.jsx)(Fe.fSl,{participant:Ao,trackType:"screenShareTrack"})}),Ao&&!ao&&(0,Re.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:-1,opacity:0,pointerEvents:"none"},children:(0,Re.jsx)("video",{autoPlay:!0,playsInline:!0,ref:e=>{e&&null!==Ao&&void 0!==Ao&&Ao.screenShareStream&&e.srcObject!==Ao.screenShareStream&&(e.srcObject=Ao.screenShareStream,e.play().catch((e=>console.error("Error playing screen share:",e))))}})}),ao&&lo&&$e&&(0,Re.jsxs)(u.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none",backgroundColor:"#000","& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[oo?(0,Re.jsx)(Fe.fSl,{participant:$e,trackType:"videoTrack"}):(0,Re.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Re.jsx)(ee.A,{sx:{fontSize:"5rem"}})}),(0,Re.jsx)(p.A,{size:"medium",onClick:Fo,sx:{position:"absolute",top:16,right:80,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:oo?(0,Re.jsx)($.A,{}):(0,Re.jsx)(ee.A,{})}),(0,Re.jsx)(p.A,{size:"medium",onClick:()=>co(!1),sx:{position:"absolute",top:16,right:16,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Re.jsx)(be.A,{})})]}),(0,Re.jsx)(u.A,{sx:{position:"absolute",top:10,right:10,zIndex:10},children:Oe&&(0,Re.jsx)(y.A,{variant:"contained",color:"error",size:"small",startIcon:(0,Re.jsx)(le.A,{}),onClick:Io,sx:{borderRadius:"20px",textTransform:"none",py:.5,px:1.5,bgcolor:"error.main",fontWeight:"bold",minWidth:0,boxShadow:"0 2px 5px rgba(0,0,0,0.3)",fontFamily:(null===De||void 0===De||null===(S=De.style)||void 0===S?void 0:S.font)||"inherit"},children:"Stop"})}),!ao&&lo&&$e&&(0,Re.jsxs)(u.A,{sx:{position:"absolute",bottom:16,right:16,width:"160px",height:"90px",borderRadius:"8px",overflow:"hidden",border:"2px solid",borderColor:"primary.main",backgroundColor:"#000",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[oo?(0,Re.jsx)(Fe.fSl,{participant:$e,trackType:"videoTrack"}):(0,Re.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Re.jsx)(ee.A,{sx:{fontSize:"1.5rem"}})}),(0,Re.jsx)(p.A,{size:"small",onClick:Fo,sx:{position:"absolute",top:2,right:26,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:oo?(0,Re.jsx)($.A,{sx:{fontSize:"0.9rem"}}):(0,Re.jsx)(ee.A,{sx:{fontSize:"0.9rem"}})}),(0,Re.jsx)(p.A,{size:"small",onClick:()=>co(!0),sx:{position:"absolute",top:2,right:2,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Re.jsx)(ye.A,{sx:{fontSize:"0.9rem"}})})]})]})]}),Me&&(0,Re.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Re.jsx)(g.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===De||void 0===De||null===(k=De.style)||void 0===k?void 0:k.font)||"inherit",color:(null===De||void 0===De||null===(R=De.style)||void 0===R?void 0:R.textColor)||"inherit"},children:"Shared Video"}),Oe&&(0,Re.jsx)(h.A,{title:"Clear Shared Video",children:(0,Re.jsx)(p.A,{onClick:()=>We(),size:"small",sx:{color:(null===De||void 0===De||null===(E=De.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:(0,Re.jsx)(ce.A,{})})})]}),(0,Re.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Le(Me)})]}),(0,Re.jsx)(u.A,{sx:{mb:2,borderBottom:1,borderColor:"divider"},children:(0,Re.jsxs)(B.A,{value:go,onChange:(e,o)=>vo(o),"aria-label":"room content tabs",sx:{"& .MuiTab-root":{fontFamily:(null===De||void 0===De||null===(F=De.style)||void 0===F?void 0:F.font)||"inherit",color:(null===De||void 0===De||null===(P=De.style)||void 0===P?void 0:P.textColor)||"inherit",opacity:.7},"& .Mui-selected":{color:"".concat((null===De||void 0===De||null===(T=De.style)||void 0===T?void 0:T.accentColor)||Ve.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===De||void 0===De||null===(D=De.style)||void 0===D?void 0:D.accentColor)||Ve.palette.primary.main}},children:[(0,Re.jsx)(G.A,{label:"Participants (".concat(Uo.length,")"),value:"participants"}),(0,Re.jsx)(G.A,{label:"Chat",value:"chat",icon:(0,Re.jsx)(_.A,{color:"primary",variant:"dot",invisible:"chat"===go||0===xo.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===De||void 0===De||null===(O=De.style)||void 0===O?void 0:O.accentColor)||Ve.palette.primary.main}}}),iconPosition:"end"})]})}),"participants"===go&&(0,Re.jsxs)(Re.Fragment,{children:[Uo.length>0&&(0,Re.jsx)(Fe.ncL,{participants:Uo}),(0,Re.jsx)(w.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Uo.map((e=>{const o=e.userId===De.ownerId;return(0,Re.jsx)(w.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,Re.jsx)(Ne,{participant:e,isRoomOwner:Oe,isLocalParticipant:e.userId===(null===to||void 0===to?void 0:to.uid),localUserAuthData:to,onForceMuteToggle:Be,onForceRemove:Ge,onForceBan:_e,call:Je,localUserIsMute:eo,isDesignatedHost:o,onPinToggle:Eo,isPinned:ho.includes(e.userId),roomStyle:null===De||void 0===De?void 0:De.style,navigate:Ye})},e.userId)}))}),0===Uo.length&&(0,Re.jsx)(g.A,{sx:{width:"100%",textAlign:"center",color:null!==De&&void 0!==De&&null!==(z=De.style)&&void 0!==z&&z.textColor?(0,N.X4)(null===De||void 0===De||null===(H=De.style)||void 0===H?void 0:H.textColor,.7):Ve.palette.text.secondary,mt:4,fontFamily:(null===De||void 0===De||null===(W=De.style)||void 0===W?void 0:W.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===go&&(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==De&&void 0!==De&&null!==(M=De.style)&&void 0!==M&&M.accentColor?(0,N.X4)(null===De||void 0===De||null===(L=De.style)||void 0===L?void 0:L.accentColor,.3):Ve.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Re.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==De&&void 0!==De&&null!==(V=De.style)&&void 0!==V&&V.accentColor?(0,N.X4)(null===De||void 0===De||null===(Y=De.style)||void 0===Y?void 0:Y.accentColor,.3):Ve.palette.divider),bgcolor:null!==De&&void 0!==De&&null!==(J=De.style)&&void 0!==J&&J.headerColor?(0,N.X4)(null===De||void 0===De||null===(X=De.style)||void 0===X?void 0:X.headerColor,.1):(0,N.X4)(Ve.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Re.jsxs)(g.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===De||void 0===De||null===(Z=De.style)||void 0===Z?void 0:Z.font)||"inherit",color:(null===De||void 0===De||null===(K=De.style)||void 0===K?void 0:K.textColor)||"inherit"},children:["Users in Room (",Uo.length,")"]}),(0,Re.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Uo.map((e=>{var o,r,t,n,i,l;const s=jo[e.userId],a=(null===s||void 0===s?void 0:s.username)||e.name||e.userId.substring(0,8),d=(null===s||void 0===s?void 0:s.avatar)||e.image;return(0,Re.jsx)(U.A,{size:"small",label:a,avatar:(0,Re.jsx)(v.A,{src:d,alt:a,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===De.ownerId?(0,N.X4)((null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.accentColor)||Ve.palette.secondary.main,.1):(0,N.X4)((null===De||void 0===De||null===(r=De.style)||void 0===r?void 0:r.headerColor)||Ve.palette.primary.main,.05),borderColor:e.userId===De.ownerId?(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.accentColor)||Ve.palette.secondary.main:(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.headerColor)||Ve.palette.primary.main,border:"1px solid",color:(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===De||void 0===De||null===(l=De.style)||void 0===l?void 0:l.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,Re.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==De&&void 0!==De&&null!==(Q=De.style)&&void 0!==Q&&Q.backgroundGradient?(0,N.X4)((null===De||void 0===De||null===(oe=De.style)||void 0===oe?void 0:oe.backgroundColor)||Ve.palette.background.default,.3):(0,N.X4)(Ve.palette.background.paper,.5)},children:0===xo.length?(0,Re.jsx)(g.A,{variant:"body2",color:null!==De&&void 0!==De&&null!==(re=De.style)&&void 0!==re&&re.textColor?(0,N.X4)(null===De||void 0===De||null===(te=De.style)||void 0===te?void 0:te.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===De||void 0===De||null===(ne=De.style)||void 0===ne?void 0:ne.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,Re.jsxs)(Re.Fragment,{children:[xo.map((e=>{var o,r,t,n,i,l,s,a,d,c,m;return(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:e.userId===(null===to||void 0===to?void 0:to.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===to||void 0===to?void 0:to.uid)&&(0,Re.jsx)(v.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=jo[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,Re.jsxs)(u.A,{children:[(0,Re.jsx)(g.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(r=De.style)&&void 0!==r&&r.textColor?(0,N.X4)(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===to||void 0===to?void 0:to.uid)?"right":"left",fontFamily:(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.font)||"inherit"},children:e.userName}),(0,Re.jsx)(j.A,{sx:{p:1,bgcolor:e.userId===(null===to||void 0===to?void 0:to.uid)?(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===to||void 0===to?void 0:to.uid)?null!==De&&void 0!==De&&null!==(l=De.style)&&void 0!==l&&l.accentColor?Ve.palette.getContrastText(De.style.accentColor):"primary.contrastText":(null===De||void 0===De||null===(s=De.style)||void 0===s?void 0:s.textColor)||"text.primary",borderRadius:e.userId===(null===to||void 0===to?void 0:to.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===De||void 0===De||null===(a=De.style)||void 0===a?void 0:a.font)||"inherit"},children:(0,Re.jsx)(g.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,Re.jsx)(g.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(d=De.style)&&void 0!==d&&d.textColor?(0,N.X4)(null===De||void 0===De||null===(c=De.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===to||void 0===to?void 0:to.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===De||void 0===De||null===(m=De.style)||void 0===m?void 0:m.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,Re.jsx)("div",{ref:Co})]})}),(0,Re.jsx)(u.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==De&&void 0!==De&&null!==(se=De.style)&&void 0!==se&&se.accentColor?(0,N.X4)(null===De||void 0===De||null===(ae=De.style)||void 0===ae?void 0:ae.accentColor,.3):Ve.palette.divider),bgcolor:(null===De||void 0===De||null===(me=De.style)||void 0===me?void 0:me.headerColor)||Ve.palette.background.paper,display:"flex"},children:(0,Re.jsx)(I.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:bo,onChange:e=>yo(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Ro())},InputProps:{sx:{fontFamily:(null===De||void 0===De||null===(he=De.style)||void 0===he?void 0:he.font)||"inherit",color:(null===De||void 0===De||null===(pe=De.style)||void 0===pe?void 0:pe.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==De&&void 0!==De&&null!==(ge=De.style)&&void 0!==ge&&ge.accentColor?(0,N.X4)(null===De||void 0===De||null===(ve=De.style)||void 0===ve?void 0:ve.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==De&&void 0!==De&&null!==(xe=De.style)&&void 0!==xe&&xe.accentColor?(0,N.X4)(null===De||void 0===De||null===(fe=De.style)||void 0===fe?void 0:fe.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===De||void 0===De||null===(we=De.style)||void 0===we?void 0:we.accentColor)||Ve.palette.primary.main}},endAdornment:(0,Re.jsx)(p.A,{size:"small",onClick:Ro,disabled:!bo.trim(),color:"primary",sx:{color:(null===De||void 0===De||null===(je=De.style)||void 0===je?void 0:je.accentColor)||"primary"},children:(0,Re.jsx)(Ce.A,{fontSize:"small"})})}})})]})]}),(0,Re.jsxs)(u.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(Ve.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===De||void 0===De||null===(Se=De.style)||void 0===Se?void 0:Se.headerColor)||Ve.palette.background.paper},children:[(0,Re.jsx)(y.A,{variant:"outlined",color:"error",startIcon:(0,Re.jsx)(ie.A,{}),onClick:()=>{null===Je||void 0===Je||Je.leave().then((()=>Ye("/side-rooms")))},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===De||void 0===De||null===(ke=De.style)||void 0===ke?void 0:ke.font)||"inherit"},children:"Leave quietly"}),Oe&&(0,Re.jsx)(h.A,{title:eo?"Unmute Microphone":"Mute Microphone",children:(0,Re.jsx)(p.A,{onClick:()=>null===Je||void 0===Je?void 0:Je.microphone.toggle(),color:eo?"default":"primary",sx:{ml:2,color:eo?"default":(null===De||void 0===De||null===(Ie=De.style)||void 0===Ie?void 0:Ie.accentColor)||"primary.main"},disabled:!Je,children:eo?(0,Re.jsx)(ue.A,{}):(0,Re.jsx)(de.A,{})})}),Oe&&(0,Re.jsx)(h.A,{title:oo?"Turn Camera Off":"Turn Camera On",children:(0,Re.jsx)(p.A,{onClick:Fo,color:oo?"primary":"default",sx:{ml:1,color:oo?(null===De||void 0===De||null===(Ee=De.style)||void 0===Ee?void 0:Ee.accentColor)||"primary.main":"default"},disabled:!Je,children:oo?(0,Re.jsx)($.A,{}):(0,Re.jsx)(ee.A,{})})}),Oe&&(0,Re.jsx)(h.A,{title:lo?"Hide Camera Window":"Show Camera Window",children:(0,Re.jsx)(p.A,{onClick:()=>so(!lo),color:lo?"primary":"default",sx:{ml:1,color:lo?(null===De||void 0===De||null===(Ue=De.style)||void 0===Ue?void 0:Ue.accentColor)||"primary.main":"default"},disabled:!Je||!oo,children:(0,Re.jsx)(Ae.A,{})})}),Oe&&(0,Re.jsx)(h.A,{title:"Share Video Link",children:(0,Re.jsx)("span",{children:(0,Re.jsx)(p.A,{onClick:()=>He(),color:"secondary",sx:{ml:2,color:(null===De||void 0===De||null===(Te=De.style)||void 0===Te?void 0:Te.accentColor)||Ve.palette.secondary.main},children:(0,Re.jsx)(q.A,{})})})})]})]}):(0,Re.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,Re.jsx)(C.A,{}),(0,Re.jsx)(g.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},Ne=n.memo((e=>{let{participant:o,isRoomOwner:r,isLocalParticipant:t,onForceMuteToggle:i,onForceRemove:C,onForceBan:A,call:w,localUserAuthData:j,localUserIsMute:I,isDesignatedHost:T,onPinToggle:D,isPinned:O,roomStyle:z,navigate:H}=e;const W=(0,m.A)(),{isSpeaking:M,publishedTracks:B}=o,{blockUser:G,currentUser:_}=(0,s.As)(),V=!B.includes("audio")&&!M,[Y,J]=(0,n.useState)(null),X=Boolean(Y),Z=e=>J(e.currentTarget),K=()=>J(null),q=async()=>{if(t&&w)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",I),await w.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),r&&null!==j&&void 0!==j&&j.uid){const e=w.cid,o=(0,d.aU)(),r=(0,d.H9)(o,"sideRooms",e),t=!w.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!t)),await(0,d.mZ)(r,{isLive:!t,lastActive:(0,d.O5)()})}}catch(e){console.error("[StreamParticipantCard] Error toggling local microphone:",e),c.oR.error("Failed to toggle microphone. See console.")}};let Q,$;const ee=o.custom;t&&j?(Q=j.displayName||j.email||o.userId,$=j.photoURL||o.image||void 0):ee&&"string"===typeof ee.displayName&&""!==ee.displayName.trim()?(Q=ee.displayName,$=ee.customAvatarUrl&&"string"===typeof ee.customAvatarUrl&&""!==ee.customAvatarUrl.trim()?ee.customAvatarUrl:o.image||void 0):(Q=o.name||o.userId,$=o.image||void 0),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:r,isLocalParticipant:t,localUserAuthData:j}),console.log("[StreamParticipantCard] Determined values - displayName:",Q,"avatarUrl:",$,"isSpeaking:",M,"participantIsMuted:",V),t&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",j,"Stream participant.userId:",o.userId);const[re,te]=(0,n.useState)(!1);return(0,Re.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{const e=(0,Re.jsx)(v.A,{src:$,alt:Q,sx:{width:64,height:64,mb:.5,border:M?"3px solid ".concat(W.palette.success.main):"2px solid ".concat((0,N.X4)(W.palette.divider,.5)),boxShadow:M?"0 0 8px ".concat(W.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer"}});return t?(0,Re.jsx)(u.A,{onClick:q,sx:{cursor:"pointer"},children:e}):(0,Re.jsx)(l.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:e})})(),T&&(0,Re.jsx)(U.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(t?null===I||void 0===I||I:V)&&(0,Re.jsx)(ue.A,{sx:{fontSize:"1rem",color:W.palette.error.contrastText,backgroundColor:(0,N.X4)(W.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),t&&!I&&(0,Re.jsx)(de.A,{sx:{fontSize:"1rem",color:W.palette.success.contrastText,backgroundColor:(0,N.X4)(W.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,Re.jsx)(g.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:W.palette.text.primary},children:Q}),r&&!t&&(0,Re.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Re.jsx)(h.A,{title:"Manage User",children:(0,Re.jsx)(p.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,N.X4)(W.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Re.jsx)(oe.A,{fontSize:"small"})})}),(0,Re.jsxs)(x.A,{anchorEl:Y,open:X,onClose:K,MenuListProps:{dense:!0},children:[(0,Re.jsxs)(f.A,{onClick:async()=>{K(),i&&i(o.userId,!o.publishedTracks.includes("audio"))},sx:{fontSize:"0.8rem"},children:[(0,Re.jsx)(b.A,{sx:{minWidth:"30px"},children:V?(0,Re.jsx)(ae.A,{fontSize:"small"}):(0,Re.jsx)(we.A,{fontSize:"small"})}),V?"Unmute":"Mute"]}),(0,Re.jsxs)(f.A,{onClick:()=>{K(),D(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,Re.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Re.jsx)(je.A,{fontSize:"small",color:O?"primary":"inherit"})}),O?"Unpin from top":"Pin to top"]}),(0,Re.jsxs)(f.A,{onClick:async()=>{if(K(),window.confirm("Are you sure you want to block ".concat(o.name||o.userId,"?")))try{await G(o.userId),c.oR.success("Blocked ".concat(o.name||o.userId)),C&&C(o.userId,o.name||o.userId)}catch(e){console.error("Error blocking user:",e),c.oR.error("Failed to block user")}},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Re.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Re.jsx)(Se.A,{fontSize:"small",color:"error"})}),"Block"]})]})]}),!r&&!t&&(0,Re.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Re.jsx)(h.A,{title:"Options",children:(0,Re.jsx)(p.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,N.X4)(W.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Re.jsx)(oe.A,{fontSize:"small"})})}),(0,Re.jsx)(x.A,{anchorEl:Y,open:X,onClose:K,MenuListProps:{dense:!0},children:(0,Re.jsxs)(f.A,{onClick:()=>{K(),te(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Re.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Re.jsx)(ke.A,{fontSize:"small",color:"warning"})}),"Report User"]})})]}),O&&!T&&(0,Re.jsx)(h.A,{title:"Pinned",children:(0,Re.jsx)(je.A,{sx:{fontSize:"1rem",color:W.palette.primary.contrastText,backgroundColor:(0,N.X4)(W.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,Re.jsxs)(S.A,{open:re,onClose:()=>te(!1),children:[(0,Re.jsx)(k.A,{children:"Report User"}),(0,Re.jsxs)(R.A,{children:[(0,Re.jsxs)(g.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,Re.jsx)(F.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,Re.jsx)(P.Ay,{onClick:()=>(async e=>{try{const r={reportedUserId:o.userId,reportedBy:null===_||void 0===_?void 0:_.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)(a.db,"reports"),r),c.oR.success("Report submitted for ".concat(o.name||o.userId)),te(!1)}catch(r){console.error("Error submitting report:",r),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,N.X4)(W.palette.primary.main,.1)}},children:(0,Re.jsx)(L.A,{primary:e})},e)))})]}),(0,Re.jsx)(E.A,{children:(0,Re.jsx)(y.A,{onClick:()=>te(!1),children:"Cancel"})})]})]})}))}}]);