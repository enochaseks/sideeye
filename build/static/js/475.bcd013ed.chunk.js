"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[475],{4454:(e,o,r)=>{r.d(o,{A:()=>l});r(9950);var t=r(6491),n=r(2053),i=r(5277),s=r(4414);const l=e=>{let{links:o}=e;return o&&0!==o.length?(0,s.jsxs)(t.A,{mt:1,children:[(0,s.jsx)(n.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,s.jsx)(t.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,s.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},7475:(e,o,r)=>{r.r(o),r.d(o,{default:()=>Ze});var t=r(9379),n=r(9950),i=r(8429),s=r(2074),l=r(1367),a=r(330),d=r(6220),c=r(5887),u=r(6491),m=r(4857),h=r(3274),p=r(5333),v=r(2053),x=r(1413),g=r(7591),f=r(3266),b=r(4195),y=r(226),C=r(6639),A=r(3174),w=r(899),j=r(2235),S=r(6583),k=r(33),R=r(8170),I=r(8145),E=r(9739),F=r(4745),P=r(5277),U=r(249),T=r(6050),D=r(5979),O=r(3788),H=r(6101),z=r(6497),W=r(7324),M=r(9325),L=r(8614),B=r(3563),G=r(2236),N=r(4142),_=r(4447),V=r(7497),J=r(7443),Y=r(5965),Z=r(2682),X=r(9316),q=r(227),K=r(6904),Q=r(7565),$=r(9575),ee=r(1679),oe=r(7341),re=r(5204),te=r(6281),ne=r(379),ie=r(1300),se=r(760),le=r(7319),ae=r(4756),de=r(4767),ce=r(492),ue=r(8008),me=r(1902),he=r(5855),pe=r(9939),ve=r(529),xe=r(9404),ge=r(5379),fe=r(361),be=r(1675),ye=r(9715),Ce=r(6164),Ae=r(6835),we=r(1311),je=r(1673),Se=r(6487),ke=r(9460),Re=r(2600),Ie=r(1770),Ee=r(4414);const Fe=e=>{var o;let{open:r,onClose:i,onSubmit:s,initialData:l,title:a="Create Room",submitButtonText:d="Create"}=e;const[c,m]=(0,n.useState)({name:(null===l||void 0===l?void 0:l.name)||"",description:(null===l||void 0===l?void 0:l.description)||"",isPrivate:(null===l||void 0===l?void 0:l.isPrivate)||!1,password:(null===l||void 0===l?void 0:l.password)||"",tags:(null===l||void 0===l?void 0:l.tags)||[]}),[h,p]=(0,n.useState)(null);return(0,Ee.jsx)(S.A,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,Ee.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(c,h)},children:[(0,Ee.jsx)(k.A,{children:a}),(0,Ee.jsx)(R.A,{children:(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Ee.jsx)(I.A,{label:"Name",value:c.name,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,Ee.jsx)(I.A,{label:"Description",value:c.description,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,Ee.jsx)(z.A,{control:(0,Ee.jsx)(W.A,{checked:c.isPrivate,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,Ee.jsx)(I.A,{label:"Password",type:"password",value:c.password,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,Ee.jsxs)(u.A,{sx:{mt:1},children:[(0,Ee.jsxs)(y.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,Ee.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?p(e.target.files[0]):p(null)}})]}),h&&(0,Ee.jsxs)(v.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",h.name]}),!h&&(null===l||void 0===l?void 0:l.thumbnailUrl)&&(0,Ee.jsxs)(v.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",l.thumbnailUrl.substring(l.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,Ee.jsx)(I.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:i,children:"Cancel"}),(0,Ee.jsx)(y.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var Pe=r(7493),Ue=r(9317),Te=r(6932),De=r(9751),Oe=r(2856),He=r(1397),ze=r(3422),We=r(4454),Me=r(4862);const Le=[{value:"harassment",label:"Harassment"},{value:"hate_speech",label:"Hate Speech"},{value:"spam",label:"Spam"},{value:"inappropriate",label:"Inappropriate Content"},{value:"misinformation",label:"Misinformation"},{value:"copyright",label:"Copyright Violation"},{value:"privacy",label:"Privacy Violation"},{value:"other",label:"Other"}],Be=e=>{let{contentId:o,contentType:r,onClose:i,open:s,ownerUsername:c}=e;const{currentUser:m}=(0,l.As)(),[h,p]=(0,n.useState)(null),[x,g]=(0,n.useState)(""),[b,w]=(0,n.useState)(""),[P,U]=(0,n.useState)(null),[T,D]=(0,n.useState)(!1),[O,H]=(0,n.useState)({open:!1,message:""});(0,n.useEffect)((()=>{s&&z()}),[s]);const z=async()=>{try{let s="";switch(r){case"sideRoom":s="sideRooms";break;case"message":s="messages";break;case"chatRoom":s="chatRooms";break;case"sadeAI":s="sadeAIChats";break;case"user":s="users";break;default:s="unknown"}if("unknown"===s)return console.error("Unknown content type:",r),void U("Failed to determine content type");const l=(0,d.H9)(a.db,s,o),u=await(0,d.x7)(l);if(u.exists()){var e,t,n,i;const o=u.data();p({title:(null===o||void 0===o?void 0:o.title)||(null===o||void 0===o?void 0:o.name)||(null===o||void 0===o?void 0:o.username),content:(null===o||void 0===o?void 0:o.content)||(null===o||void 0===o?void 0:o.text)||(null===o||void 0===o?void 0:o.description),author:c||(null===o||void 0===o?void 0:o.authorName)||(null===o||void 0===o?void 0:o.username)||"Unknown",timestamp:null!==o&&void 0!==o&&null!==(e=o.timestamp)&&void 0!==e&&null!==(t=e.toDate)&&void 0!==t&&t.call(e)?o.timestamp.toDate().toISOString():null!==o&&void 0!==o&&null!==(n=o.createdAt)&&void 0!==n&&null!==(i=n.toDate)&&void 0!==i&&i.call(n)?o.createdAt.toDate().toISOString():(new Date).toISOString()})}else console.log("Preview document does not exist!"),p(null)}catch(P){console.error("Error fetching content:",P),U("Failed to fetch content")}};return(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsxs)(S.A,{open:s,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,Ee.jsxs)(k.A,{children:["Report ",(()=>{switch(r){case"sideRoom":return"Side Room";case"message":return"Message";case"chatRoom":return"Chat Room";case"sadeAI":return"Sade AI Chat";case"user":return"User";default:return"Content"}})()]}),(0,Ee.jsx)(R.A,{children:(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:3,pt:2},children:[h&&(0,Ee.jsxs)(j.A,{elevation:1,sx:{p:2},children:[(0,Ee.jsx)(v.A,{variant:"h6",gutterBottom:!0,children:"Content Preview"}),h.title&&(0,Ee.jsx)(v.A,{variant:"subtitle1",gutterBottom:!0,children:h.title}),h.content&&(0,Ee.jsx)(v.A,{variant:"body1",gutterBottom:!0,children:h.content}),h.author&&(0,Ee.jsxs)(v.A,{variant:"caption",color:"text.secondary",children:["By: ",h.author]})]}),(0,Ee.jsx)(F.A,{}),(0,Ee.jsx)(I.A,{select:!0,label:"Report Type",value:x,onChange:e=>g(e.target.value),fullWidth:!0,required:!0,children:Le.map((e=>(0,Ee.jsx)(f.A,{value:e.value,children:e.label},e.value)))}),(0,Ee.jsx)(I.A,{label:"Description",value:b,onChange:e=>w(e.target.value),multiline:!0,rows:4,fullWidth:!0,required:!0,placeholder:"Please provide details about why you are reporting this content..."}),P&&(0,Ee.jsx)(A.A,{severity:"error",sx:{mt:2},children:P})]})}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:i,disabled:T,children:"Cancel"}),(0,Ee.jsx)(y.A,{onClick:async()=>{if(m&&a.db)try{D(!0),U("");let e="";switch(r){case"sideRoom":e="sideRooms";break;case"message":e="messages";break;case"chatRoom":e="chatRooms";break;case"sadeAI":e="sadeAIChats";break;case"user":e="users";break;default:e="unknown"}const t=(0,d.rJ)(a.db,"reports");await(0,d.gS)(t,{type:x,description:b,reporterId:m.uid,contentId:o,contentType:r,collectionName:e,timestamp:(0,d.O5)()});const n=(0,d.rJ)(a.db,"notifications","admin","reports");await(0,d.gS)(n,{contentId:o,contentType:r,collectionName:e,reporterId:m.uid,timestamp:(0,d.O5)()}),H({open:!0,message:"Report submitted successfully. Our team will review it shortly."}),i()}catch(P){console.error("Error submitting report:",P),U("Failed to submit report")}finally{D(!1)}},variant:"contained",color:"primary",disabled:T,children:T?(0,Ee.jsx)(C.A,{size:24}):"Submit Report"})]})]}),(0,Ee.jsx)(Me.A,{open:O.open,autoHideDuration:6e3,onClose:()=>H((0,t.A)((0,t.A)({},O),{},{open:!1})),children:(0,Ee.jsx)(A.A,{onClose:()=>H((0,t.A)((0,t.A)({},O),{},{open:!1})),severity:"success",sx:{width:"100%"},children:O.message})})]})},Ge=e=>{var o;let{open:r,onClose:t,roomName:i,roomLink:s,onSend:l,currentUserId:m}=e;const[h,p]=(0,n.useState)(""),[g,f]=(0,n.useState)([]),[b,A]=(0,n.useState)(!1),[w,j]=(0,n.useState)(null),[D,O]=(0,n.useState)([]),[H,z]=(0,n.useState)(!1),W=(0,n.useCallback)((async()=>{if(m&&a.db){z(!0);try{const e=(0,d.rJ)(a.db,"rooms"),o=(0,d.P)(e,(0,d._M)("members","array-contains",m)),r=await(0,d.GG)(o),t=[];r.forEach((e=>{const o=e.data();t.push({id:e.id,name:o.name||"Chat Room"})})),O(t)}catch(e){console.error("Error fetching server chat rooms:",e),c.oR.error("Failed to load server chat rooms")}finally{z(!1)}}}),[m]);(0,n.useEffect)((()=>{r&&W()}),[r,W]);const M=(0,n.useCallback)((async e=>{if(!e.trim()||e.length<2)f([]);else{A(!0);try{const o=(0,d.rJ)(a.db,"users"),r=(0,d.P)(o,(0,d.AB)(50)),t=await(0,d.GG)(r),n=[],i=e.toLowerCase();t.forEach((e=>{if(e.id!==m){var o;const r=e.data();null!==(o=r.username)&&void 0!==o&&o.toLowerCase().includes(i)&&n.push({id:e.id,username:r.username||"",displayName:r.displayName,photoURL:r.photoURL||r.profilePic,email:r.email})}})),f(n)}catch(o){console.error("Error searching users:",o),c.oR.error("Failed to search users"),f([])}finally{A(!1)}}}),[m]);(0,n.useEffect)((()=>{const e=setTimeout((()=>{M(h)}),500);return()=>clearTimeout(e)}),[h,M]);return(0,Ee.jsxs)(S.A,{open:r,onClose:t,fullWidth:!0,maxWidth:"xs",children:[(0,Ee.jsx)(k.A,{children:"Share Room via Message"}),(0,Ee.jsx)(R.A,{children:(0,Ee.jsxs)(u.A,{sx:{mt:2},children:[(0,Ee.jsx)(I.A,{fullWidth:!0,label:"Search Users",variant:"outlined",value:h,onChange:e=>p(e.target.value),placeholder:"Type username to search...",disabled:!!w}),b&&(0,Ee.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Ee.jsx)(C.A,{size:24})}),!b&&g.length>0&&!w&&(0,Ee.jsx)(U.A,{sx:{mt:2,maxHeight:300,overflow:"auto"},children:g.map((e=>{var o;return(0,Ee.jsxs)(T.Ay,{button:!0,onClick:()=>(e=>{j(e),p(""),f([])})(e),children:[(0,Ee.jsx)(L.A,{children:(0,Ee.jsx)(x.A,{src:e.photoURL||void 0,alt:e.username,sx:{width:40,height:40},children:null===(o=e.username[0])||void 0===o?void 0:o.toUpperCase()})}),(0,Ee.jsx)(B.A,{primary:e.username,secondary:e.displayName||e.email})]},e.id)}))}),w&&(0,Ee.jsxs)(u.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,Ee.jsx)(v.A,{variant:"subtitle2",children:"Selected User:"}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,Ee.jsx)(x.A,{src:w.photoURL||void 0,alt:w.username,sx:{width:40,height:40},children:null===(o=w.username[0])||void 0===o?void 0:o.toUpperCase()}),(0,Ee.jsx)(v.A,{sx:{ml:1},children:w.username}),(0,Ee.jsx)(y.A,{size:"small",onClick:()=>j(null),sx:{ml:"auto"},children:"Change"})]})]}),!b&&h.length>=2&&0===g.length&&(0,Ee.jsx)(v.A,{color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"No users found"}),(0,Ee.jsx)(F.A,{sx:{mt:3,mb:2},children:(0,Ee.jsx)(P.A,{label:"Room + Server Chat"})}),H?(0,Ee.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Ee.jsx)(C.A,{size:24})}):D.length>0?(0,Ee.jsx)(U.A,{sx:{mt:2},children:D.map((e=>(0,Ee.jsx)(T.Ay,{button:!0,onClick:()=>(async(e,o)=>{try{const r=(0,d.H9)(a.db,"rooms",e);if(!(await(0,d.x7)(r)).exists())return void c.oR.error("Room not found");const n="Check out this room".concat(o?": ".concat(o):"","! ").concat(s);await l(e,n),c.oR.success("Message sent to ".concat(o)),t()}catch(r){console.error("Error sending message to server chat:",r),c.oR.error("Failed to send message to server chat")}})(e.id,e.name),sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover"}},children:(0,Ee.jsx)(B.A,{primary:e.name,secondary:"Room + Server Chat"})},e.id)))}):(0,Ee.jsx)(v.A,{color:"text.secondary",sx:{textAlign:"center"},children:"No Room + Server Chats available"})]})}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:t,children:"Cancel"}),(0,Ee.jsx)(y.A,{variant:"contained",onClick:async()=>{if(w)try{const e="Check out this room".concat(i?": ".concat(i):"","! ").concat(s);await l(w.id,e),c.oR.success("Message sent to ".concat(w.username)),t()}catch(e){console.error("Error sending message:",e),c.oR.error("Failed to send message")}else c.oR.error("Please select a user first")},disabled:!w,children:"Send"})]})]})},Ne=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],_e=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],Ve=[12,14,16,18,20,24,28,32],Je=e=>{let{icon:o,color:r}=e;const[i,s]=(0,n.useState)({left:"".concat(80*Math.random()+10,"%"),top:"".concat(20*Math.random()+40,"%"),animationDuration:"".concat(3*Math.random()+2,"s"),opacity:1});return(0,n.useEffect)((()=>{const e=setTimeout((()=>{s((e=>(0,t.A)((0,t.A)({},e),{},{opacity:0})))}),2e3);return()=>clearTimeout(e)}),[]),(0,Ee.jsx)(u.A,{sx:(0,t.A)({position:"fixed",fontSize:"28px",color:r,pointerEvents:"none",zIndex:1e3,transition:"opacity 1s ease-out",animation:"float-around 3s ease-out forwards","@keyframes float-around":{"0%":{transform:"scale(0.5) rotate(0deg) translate(0, 0)"},"25%":{transform:"scale(1.2) rotate(10deg) translate(20px, -30px)"},"50%":{transform:"scale(1.4) rotate(-5deg) translate(-15px, -60px)"},"75%":{transform:"scale(1.1) rotate(15deg) translate(25px, -90px)"},"100%":{transform:"scale(0.8) rotate(-10deg) translate(0, -120px)"}}},i),children:o})},Ye=e=>{let{handleHeartRoom:o,handleHeartbreakRoom:r,currentUserHearted:t,currentUserHeartbroken:n,roomHeartCount:i,roomHeartbreakCount:s,isHearting:l,isHeartbreaking:a,accentColor:d,textColor:c}=e;const x=(0,m.A)();return(0,Ee.jsxs)(u.A,{sx:{position:"fixed",right:20,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:1,backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)",borderRadius:2,padding:1,zIndex:100,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ee.jsx)(h.A,{title:t?"Unheart Room":"Heart Room",children:(0,Ee.jsx)(p.A,{onClick:o,color:t?"error":"inherit",sx:{color:t?x.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:l,children:t?(0,Ee.jsx)(J.A,{}):(0,Ee.jsx)(Y.A,{})})}),(0,Ee.jsx)(v.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:i||0})]}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ee.jsx)(h.A,{title:n?"Remove Heartbreak":"Heartbreak Room",children:(0,Ee.jsx)(p.A,{onClick:r,color:n?"error":"inherit",sx:{color:n?x.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:a,children:n?(0,Ee.jsx)(Z.A,{}):(0,Ee.jsx)(X.A,{})})}),(0,Ee.jsx)(v.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:s||0})]})]})},Ze=()=>{var e,o,r,s,G,N,_,V;const{roomId:Y}=(0,i.g)(),X=(0,i.Zp)(),{currentUser:Ae,blockUser:we}=(0,l.As)(),je=(0,m.A)(),[Se,ke]=(0,n.useState)(null),[Re,Ie]=(0,n.useState)(!1),[Te,Me]=(0,n.useState)(!0),[Le,Ze]=(0,n.useState)(null),[qe,Ke]=(0,n.useState)(!1),[Qe,$e]=(0,n.useState)(!1),[eo,oo]=(0,n.useState)(""),[ro,to]=(0,n.useState)(!1),[no,io]=(0,n.useState)(!1),[so,lo]=(0,n.useState)(!1),[ao,co]=(0,n.useState)(!1),[uo,mo]=(0,n.useState)(null),[ho,po]=(0,n.useState)([]),[vo,xo]=(0,n.useState)(null),[go,fo]=((0,n.useRef)(null),(0,n.useState)(null)),[bo,yo]=(0,n.useState)(null),[Co,Ao]=(0,n.useState)(null),[wo,jo]=(0,n.useState)(!1),[So,ko]=(0,n.useState)(!1),[Ro,Io]=(0,n.useState)(0),[Eo,Fo]=(0,n.useState)(!1),[Po,Uo]=(0,n.useState)(null),To=(0,n.useRef)(null),[Do,Oo]=(0,n.useState)(0),[Ho,zo]=(0,n.useState)(!1),[Wo,Mo]=(0,n.useState)(!1),[Lo,Bo]=(0,n.useState)(!1),[Go,No]=(0,n.useState)(""),[_o,Vo]=(0,n.useState)(null),[Jo,Yo]=(0,n.useState)(""),[Zo,Xo]=(0,n.useState)([]),[qo,Ko]=(0,n.useState)(!1),[Qo,$o]=(0,n.useState)(null),[er,or]=(0,n.useState)(!1),rr=(0,n.useRef)(null),[tr,nr]=(0,n.useState)(null),[ir,sr]=(0,n.useState)(!1),[lr,ar]=(0,n.useState)([]),[dr,cr]=(0,n.useState)(""),[ur,mr]=(0,n.useState)(!1),hr=(0,n.useRef)(null),[pr,vr]=(0,n.useState)(""),[xr,gr]=(0,n.useState)(!1),[fr,br]=(0,n.useState)(30),[yr,Cr]=(0,n.useState)(!1),[Ar,wr]=(0,n.useState)(Ne[0].name),[jr,Sr]=(0,n.useState)(!1),[kr,Rr]=(0,n.useState)(!1),[Ir,Er]=(0,n.useState)(_e[0]),[Fr,Pr]=(0,n.useState)(Ve[2]),[Ur,Tr]=((0,n.useRef)(null),(0,n.useState)(!1)),[Dr,Or]=(0,n.useState)(!1),[Hr,zr]=(0,n.useState)(window.innerWidth>1024),[Wr,Mr]=(0,n.useState)(null),[Lr,Br]=(0,n.useState)(!1),[Gr,Nr]=(0,n.useState)(null),[_r,Vr]=(0,n.useState)(null),Jr=(0,n.useRef)([]),[Yr,Zr]=(0,n.useState)(!1),[Xr,qr]=(0,n.useState)(null),Kr="youtube-player-placeholder",[Qr,$r]=(0,n.useState)(!1),[et,ot]=(0,n.useState)(null),[rt,tt]=(0,n.useState)([]),[nt,it]=(0,n.useState)([]),[st,lt]=(0,n.useState)(!1),at=(0,n.useCallback)((()=>{Co&&(console.log("Camera state before toggle:",Co.camera.state),"enabled"!==Co.camera.state.status?(c.oR.loading("Enabling camera..."),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((e=>(console.log("Camera access granted:",e),e.getTracks().forEach((e=>e.stop())),Co.camera.enable()))).then((()=>{Zr(!0),c.oR.dismiss(),c.oR.success("Camera enabled")})).catch((e=>{console.error("Error enabling camera:",e),c.oR.dismiss(),c.oR.error("Could not enable camera. Please check camera permissions in your browser settings.")}))):Co.camera.disable().then((()=>{Zr(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)})))}),[Co]),dt=(0,n.useRef)(0),ct=(0,n.useRef)(0),ut=(0,n.useRef)(0);(0,n.useEffect)((()=>{const e=()=>{zr(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,n.useEffect)((()=>{if(Co){const e="enabled"===Co.camera.state.status;Zr(e);const o=setInterval((()=>{const e="enabled"===Co.camera.state.status;Zr(e)}),1e3);return()=>{clearInterval(o)}}}),[Co]),(0,n.useEffect)((()=>{Co&&navigator.mediaDevices.getUserMedia({video:!0}).then((()=>{console.log("Camera permissions granted")})).catch((e=>{console.error("Camera permission denied:",e),c.oR.error("Camera permissions denied. You won't be able to share video.")}))}),[Co]),(0,n.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,ze.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),nr(o)})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),nr(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),nr(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),nr(null)}}),[]),(0,n.useEffect)((()=>{if(so)if(null!==Se&&void 0!==Se&&Se.style){const e=Se.style,o=Ne.find((o=>o.name===e.themeName));wr(o?e.themeName:Ne[0].name);const r=o||Ne[0];Sr(void 0!==e.headerGradient?e.headerGradient:r.headerGradient||!1),Rr(void 0!==e.backgroundGradient?e.backgroundGradient:r.backgroundGradient||!1),Er(_e.includes(e.font)?e.font:_e[0]),Pr(Ve.includes(e.headerFontSize)?e.headerFontSize:Ve[2])}else wr(Ne[0].name),Sr(Ne[0].headerGradient||!1),Rr(Ne[0].backgroundGradient||!1),Er(_e[0]),Pr(Ve[2])}),[so,Se]),(0,n.useEffect)((()=>{if(!Y||!a.db||0===ho.length)return;const e=ho.filter((e=>e.isOnline)).length,o=Date.now(),r=o-ct.current;if(e!==dt.current&&r>1e4){console.log("[Active Users Update] Updating count from ".concat(dt.current," to ").concat(e));const r=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(r,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{dt.current=e,ct.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}dt.current=e}),[Y,a.db,ho.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===Ae||void 0===Ae?void 0:Ae.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===Se||void 0===Se?void 0:Se.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===Se||void 0===Se?void 0:Se.viewers)||"null/undefined");const mt=(0,n.useMemo)((()=>{if(null===Ae||void 0===Ae||!Ae.uid||null===Se||void 0===Se||!Se.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=Ae.uid===Se.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===Ae||void 0===Ae?void 0:Ae.uid,null===Se||void 0===Se?void 0:Se.ownerId]),ht=(0,n.useMemo)((()=>{if(null===Se||void 0===Se||!Se.viewers||null===Ae||void 0===Ae||!Ae.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=Se.viewers.some((e=>e.userId===Ae.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===Se||void 0===Se?void 0:Se.viewers,null===Ae||void 0===Ae?void 0:Ae.uid]),pt=!!Se&&(mt||!0),vt=(0,n.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",ho);const e=new Map;ho.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[ho]),xt=(0,n.useMemo)((()=>{if(!Se||!Se.viewers||!Array.isArray(Se.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(Se.viewers,null,2));const e=Se.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[Se]),gt=(0,n.useCallback)((async(e,o,r,t,n)=>{if(!e||null===o||void 0===o||!o.uid||!n)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var s,l;const a=(0,d.H9)(r,"users",i),c=await(0,d.x7)(a);let u="",m="",h=(null===(s=o.email)||void 0===s?void 0:s.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let p="viewer";t?p="owner":null!==(l=n.viewers)&&void 0!==l&&l.some((e=>e.userId===i&&"guest"===e.role))&&(p="guest");const v=(0,d.H9)(r,"sideRooms",e,"presence",i),x={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:p,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(x,null,2)),await(0,d.BN)(v,x,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(a){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),a)}}),[]);(0,n.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(pt,", CurrentUserUID: ").concat(null===Ae||void 0===Ae?void 0:Ae.uid,", IsRoomOwner: ").concat(mt,", RoomExists: ").concat(!!Se)),pt&&Y&&Ae&&Se?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(Ae.uid," in room ").concat(Y,".")),gt(Y,Ae,a.db,mt,Se)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(pt,", RoomId: ").concat(!!Y,", CurrentUser: ").concat(!!Ae,", Room: ").concat(!!Se))}),[Y,Ae,a.db,mt,Se,pt,gt]),(0,n.useEffect)((()=>{const e=null===Ae||void 0===Ae?void 0:Ae.uid,o=Y;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const r=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[Y,null===Ae||void 0===Ae?void 0:Ae.uid,a.db]);const ft=()=>{Bo(!0)},bt=()=>{Bo(!1),No("")},yt=()=>{if(!Y)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!mt)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),Vo(null),c.oR.success("Shared video cleared.")};(0,n.useEffect)((()=>{if(null===Ae||void 0===Ae||!Ae.uid||!Y||!pt||go)return;(async()=>{try{console.log("[Stream] Fetching token for user:",Ae.uid),console.log("[Stream] Data being sent - User ID:",Ae.uid),console.log("[Stream] Data being sent - Display Name:",Ae.displayName),console.log("[Stream] Data being sent - Photo URL:",Ae.photoURL);const r="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(r));const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:Ae.uid,userName:Ae.displayName||Ae.email||"UnknownUser",userImage:Ae.photoURL||void 0})});console.log("[Stream] Response status: ".concat(t.status));const n={};if(t.headers.forEach(((e,o)=>{n[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(n,null,2)),!t.ok){var e;let r={error:"HTTP error! Status: ".concat(t.status)};try{const e=await t.text();console.log("[Stream] Non-OK response body (text):",e),r=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),r.error=t.statusText||r.error}throw new Error((null===(e=r)||void 0===e?void 0:e.error)||"HTTP status ".concat(t.status))}const{token:i}=await t.json();if(!i)throw new Error("Stream token was not provided by backend.");fo(i),console.log("[Stream] Token fetched successfully.")}catch(Le){console.error("[Stream] Error fetching token:",Le),c.oR.error("Stream Token Error: ".concat(Le.message||"Load failed")),fo(null)}})()}),[Ae,Y,pt,go]),(0,n.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!go||null===Ae||void 0===Ae||!Ae.uid||bo)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!go,", currentUser=").concat(!(null===Ae||void 0===Ae||!Ae.uid),", apiKey=").concat(!0,", clientExists=").concat(!!bo));console.log("[Stream] Initializing StreamVideoClient with token.");const r=(null===(e=Ae.profile)||void 0===e?void 0:e.name)||Ae.displayName||Ae.email||Ae.uid,t=(null===(o=Ae.profile)||void 0===o?void 0:o.profilePic)||Ae.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(r,", photoURL: ").concat(t));const n={id:Ae.uid,name:r,image:t};try{const e=new Pe.Hq({apiKey:"2nufecjmzmzh",user:n,token:go});yo(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(Le){console.error("[Stream] Error initializing StreamVideoClient:",Le),c.oR.error("Failed to initialize Stream video client: ".concat(Le instanceof Error?Le.message:String(Le)))}return()=>{bo&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),yo(null))}}),[go,Ae,bo]),(0,n.useEffect)((()=>{if(!So||!bo||!Y||null===Ae||void 0===Ae||!Ae.uid)return void(So&&ko(!1));if(Co)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void ko(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(Y)),jo(!0);try{const e=bo.call("default",Y);if(await e.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(e.cid)),Ao(e),mt&&Y&&a.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(Le){console.error("[Stream Call] Error joining or creating call:",Le),c.oR.error("Failed to connect to audio: ".concat(Le.message||"Unknown error")),Ao(null)}finally{jo(!1),ko(!1)}})(),()=>{ko(!1)}}),[So,bo,Y,null===Ae||void 0===Ae?void 0:Ae.uid,Co]),(0,n.useEffect)((()=>()=>{Co&&(console.log("[Stream Call] Leaving active call ".concat(Co.cid," on component unmount or room change.")),Co.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(Co.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(Co.cid,":"),e))).finally((()=>{if(Ao(null),mt&&Y&&a.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[Co,Y,mt,a.db]),(0,n.useEffect)((()=>{if(!Y||!Ae)return;const e=(0,d.H9)(a.db,"sideRooms",Y),o=(0,d.aQ)(e,(e=>{if(e.exists()){const r=(0,t.A)({id:e.id},e.data());if(ke(r),Io(r.heartCount||0),Me(!1),r.isPrivate&&r.password&&r.ownerId!==Ae.uid){var o;(null===(o=r.viewers)||void 0===o?void 0:o.some((e=>e.userId===Ae.uid&&"guest"!==e.role)))||$e(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(Y,"' reported as non-existent. Current error: '").concat(Le,"'. Setting room state to null.")),Ze("Room not found"),ke(null),Me(!1)}));let r;if(null!==Ae&&void 0!==Ae&&Ae.uid){const e=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",Ae.uid);r=(0,d.aQ)(e,(e=>{Fo(e.exists())}))}const n=(0,d.P)((0,d.rJ)(a.db,"sideRooms",Y,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(n,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===Ae||void 0===Ae?void 0:Ae.uid)&&o.username&&(Uo("".concat(o.username," hearted the room!")),To.current&&clearTimeout(To.current),To.current=setTimeout((()=>{Uo(null)}),3e3))}}))}));return()=>{o(),r&&r(),i(),To.current&&clearTimeout(To.current)}}),[Y,Ae]),(0,n.useEffect)((()=>{if(!Y||!a.db||null===Ae||void 0===Ae||!Ae.uid)return;const e=(0,d.H9)(a.db,"sideRooms",Y),o=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",Ae.uid),r=(0,d.aQ)(e,(e=>{if(e.exists()){const o=e.data();Oo(o.heartbreakCount||0)}})),t=(0,d.aQ)(o,(e=>{zo(e.exists())}));return()=>{r(),t()}}),[Y,a.db,null===Ae||void 0===Ae?void 0:Ae.uid]),(0,n.useEffect)((()=>{if(rt.length>0){const e=setTimeout((()=>{tt((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[rt]),(0,n.useEffect)((()=>{if(nt.length>0){const e=setTimeout((()=>{it((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[nt]);const Ct=async e=>{if(!a.db||!e)return null;try{const o=(0,d.rJ)(a.db,"rooms"),r=(0,d.P)(o,(0,d._M)("createdBy","==",e),(0,d._M)("type","==","public")),t=await(0,d.GG)(r);if(!t.empty){const e=t.docs[0];return{id:e.id,name:e.data().name||"Chat Room"}}return null}catch(Le){return console.error("[SideRoomComponent] Error checking for server chat room:",Le),null}};(0,n.useEffect)((()=>{if(null===Ae||void 0===Ae||!Ae.uid||null===Se||void 0===Se||!Se.ownerId)return;(async()=>{try{const e=(0,d.H9)(a.db,"users",Se.ownerId),o=await(0,d.x7)(e);if(!(o.exists()&&!0===o.data().isPrivate))return;const r=(0,d.H9)(a.db,"users",Ae.uid,"following",Se.ownerId),t=(0,d.H9)(a.db,"users",Se.ownerId,"followRequests",Ae.uid),[n,i]=await Promise.all([(0,d.x7)(r),(0,d.x7)(t)]);if(n.exists()&&!i.exists()){const e=await Ct(Se.ownerId);e&&(ot(e),$r(!0))}}catch(Le){console.error("Error checking follow status:",Le)}})();const e=(0,d.H9)(a.db,"users",Ae.uid,"following",Se.ownerId),o=(0,d.aQ)(e,(e=>{e.exists()&&Ct(Se.ownerId).then((e=>{e&&(ot(e),$r(!0))}))}));return()=>o()}),[Ae,Se,a.db,X,Ct]),(0,n.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(pt,", CurrentUserUID: ").concat(null===Ae||void 0===Ae?void 0:Ae.uid)),!Y||!pt||null===Ae||void 0===Ae||!Ae.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(Y,", HasAccess: ").concat(pt,", UserUID: ").concat(null===Ae||void 0===Ae?void 0:Ae.uid)),void po([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(Y));const e=(0,d.rJ)(a.db,"sideRooms",Y,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,t.A)({userId:e.id},e.data()))),r=Date.now();let n=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&r-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((r-e.lastSeen)/1e3)," seconds old).")),!n&&a.db&&e.userId!==(null===Ae||void 0===Ae?void 0:Ae.uid)){const o=(0,d.H9)(a.db,"sideRooms",Y,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),n=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),po(i);const s=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(s))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),po([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(Y,".")),o()}}),[Y,pt,null===Ae||void 0===Ae?void 0:Ae.uid,a.db]),(0,n.useEffect)((()=>{const e=null===Ae||void 0===Ae?void 0:Ae.uid,o=Y;return()=>{if(e&&o&&a.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const r=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[Y,null===Ae||void 0===Ae?void 0:Ae.uid,a.db]),(0,n.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(pt,", CurrentUserUID: ").concat(null===Ae||void 0===Ae?void 0:Ae.uid,", IsRoomOwner: ").concat(mt,", RoomExists: ").concat(!!Se)),!Y||null===Ae||void 0===Ae||!Ae.uid||!Se||!pt){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(Y,", UserUID: ").concat(null===Ae||void 0===Ae?void 0:Ae.uid,", HasAccess: ").concat(pt,", RoomExists: ").concat(!!Se)),null!==Ae&&void 0!==Ae&&Ae.uid&&Y){const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",Ae.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(Ae.uid," in room ").concat(Y)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(Ae.uid,":"),e)}))}return}const e=Ae.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(Y,"."));let o=null;return(async()=>{try{var r,t;const n=(0,d.H9)(a.db,"users",e),i=await(0,d.x7)(n);let s="",l="",c=(null===(r=Ae.email)||void 0===r?void 0:r.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();s=o.name||o.username||"",l=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(s,"', Pic='").concat(l,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),s=Ae.displayName||"",l=Ae.photoURL||"";let u="viewer";mt?u="owner":null!==(t=Se.viewers)&&void 0!==t&&t.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(a.db,"sideRooms",Y,"presence",e),h={userId:e,username:c,avatar:l,lastSeen:Date.now(),isOnline:!0,role:u,displayName:s,photoURL:l},p="sideRooms/".concat(Y,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",p,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-ut.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),ut.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(Le){console.error("[Presence Heartbeat] Error updating heartbeat:",Le)}}),6e4))}catch(n){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),n)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(Y,". Setting offline."));const r=(0,d.H9)(a.db,"sideRooms",Y,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[Y,Ae,a.db,mt,Se,pt]),(0,n.useEffect)((()=>{if(Y)return()=>{}}),[Y]),(0,n.useEffect)((()=>{Se&&Se.currentSharedVideoUrl?Vo(Se.currentSharedVideoUrl):Se&&!Se.currentSharedVideoUrl&&Vo(null)}),[Se]),(0,n.useEffect)((()=>{if(!tr)return;const e=e=>{c.oR.success(e.message),or(!1),Yo(""),$o(null),Xo([]),io(!1)},o=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),or(!1)},r=e=>{e.roomId===Y&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},t=e=>{e.error?(c.oR.error(e.error),Xo([])):Xo(e.users)},n=e=>{e===Y&&null!==Ae&&void 0!==Ae&&Ae.uid&&((0,c.oR)("The host has removed you from the room."),null===Co||void 0===Co||Co.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{X("/side-rooms")})))};return tr.on("invite-success",e),tr.on("invite-failed",o),tr.on("guest-joined",r),tr.on("user-search-results-for-invite",t),tr.on("force-remove",n),()=>{tr.off("invite-success",e),tr.off("invite-failed",o),tr.off("guest-joined",r),tr.off("user-search-results-for-invite",t),tr.off("force-remove",n)}}),[tr,Y,X,Co,null===Ae||void 0===Ae?void 0:Ae.uid]);const At=(0,n.useCallback)((0,He.debounce)((e=>{e.trim().length>=2&&(tr?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),tr.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[tr]),wt=(0,n.useCallback)((()=>{co(!0)}),[]),jt=(0,n.useCallback)((e=>{mo(e.currentTarget)}),[]),St=(0,n.useCallback)((()=>{mo(null)}),[]),kt=(0,n.useCallback)((()=>{to(!0),St()}),[St]),Rt=(0,n.useCallback)((()=>{lo(!0),St()}),[St]),It=(0,n.useCallback)((()=>{io(!0),Yo(""),$o(null),Xo([]),Ko(!1),St()}),[St]),Et=(0,n.useCallback)((async()=>{if(or(!0),tr&&null!==Ae&&void 0!==Ae&&Ae.uid&&Y&&null!==Qo&&void 0!==Qo&&Qo.username){console.log("Emitting invite-user-to-room: ".concat(Qo.username));try{var e;const o=(0,d.P)((0,d.rJ)(a.db,"users"),(0,d._M)("username","==",Qo.username)),r=await(0,d.GG)(o);if(r.empty)return c.oR.error("User not found."),void or(!1);r.docs[0].data();const t=r.docs[0].id,n=(0,d.H9)(a.db,"sideRooms",Y),i=await(0,d.x7)(n);if(!i.exists())return c.oR.error("Room not found."),void or(!1);const s=i.data();if(null===(e=s.viewers)||void 0===e?void 0:e.some((e=>e.userId===t)))return c.oR.error("".concat(Qo.username," is already in this room.")),void or(!1);tr.emit("invite-user-to-room",{roomId:Y,inviterId:Ae.uid,inviteeUsername:Qo.username})}catch(Le){console.error("Error checking if user is in room:",Le),tr.emit("invite-user-to-room",{roomId:Y,inviterId:Ae.uid,inviteeUsername:Qo.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!tr,currentUser:!(null===Ae||void 0===Ae||!Ae.uid),roomId:Y,selectedInviteeForInvite:Qo}),c.oR.error("Cannot send invite: connection or user data issue."),or(!1)}),[null===Ae||void 0===Ae?void 0:Ae.uid,Y,Qo,tr,a.db]),Ft=(0,n.useCallback)((async()=>{if(Y&&mt&&(St(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){Ke(!0);try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),X("/side-rooms")}catch(Le){console.error("Error deleting room:",Le),c.oR.error("Failed to delete room")}finally{Ke(!1)}}}),[Y,mt,X]),Pt=(0,n.useCallback)((async(e,o)=>{if(!mt||!Y||e===(null===Ae||void 0===Ae?void 0:Ae.uid))return;console.log("Owner toggling mute for ".concat(e,". Currently muted: ").concat(o));const r=!o,t=(0,d.H9)(a.db,"sideRooms",Y,"presence",e);try{await(0,d.mZ)(t,{isMuted:r}),console.warn("[SideRoomComponent] handleForceMuteToggle needs to be connected to the correct signaling (e.g., general Socket.IO emit)"),c.oR.success("User ".concat(r?"muted":"unmuted","."))}catch(Le){console.error("Error toggling mute for ".concat(e,":"),Le),c.oR.error("Failed to update mute status.")}}),[mt,Y,null===Ae||void 0===Ae?void 0:Ae.uid,a.db]),Ut=(0,n.useCallback)(((e,o)=>{if(!mt||!Y||e===(null===Ae||void 0===Ae?void 0:Ae.uid)||!tr)return;const r=o||"this user";window.confirm("Are you sure you want to remove ".concat(r," from the room?"))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(Y)),tr.emit("force-remove",{roomId:Y,targetUserId:e}),c.oR.success("Removing ".concat(r,"...")))}),[mt,Y,null===Ae||void 0===Ae?void 0:Ae.uid,tr]),Tt=(0,n.useCallback)(((e,o)=>{if(!mt||!Y||e===(null===Ae||void 0===Ae?void 0:Ae.uid))return;const r=o||"this user";if(window.confirm("Are you sure you want to block ".concat(r,"? They will be removed from the room.")))try{we(e).then((()=>{c.oR.success("Blocked ".concat(r)),console.log("User ".concat(e," has been blocked"))})).catch((e=>{console.error("Error blocking user:",e),c.oR.error("Failed to block user")}))}catch(Le){console.error("Error initiating block:",Le),c.oR.error("Failed to block user")}}),[mt,Y,null===Ae||void 0===Ae?void 0:Ae.uid,we]),Dt=()=>{setTimeout((()=>{var e;null===(e=hr.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,n.useEffect)((()=>{ir&&Dt()}),[lr,ir,pr]),(0,n.useEffect)((()=>{if(!xr||!pr)return;let e=0;const o=pr,r=()=>{e<o.length?(ar((r=>{const n=[...r];if(n.length>0&&"ai"===n[n.length-1].sender){const r=n[n.length-1];n[n.length-1]=(0,t.A)((0,t.A)({},r),{},{text:o.substring(0,e+1)})}return n})),e++,setTimeout(r,fr)):(gr(!1),vr(""))};return r(),()=>{gr(!1)}}),[xr,pr,fr]);const Ot=e=>{ar((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,r)=>r===e.length-1?(0,t.A)((0,t.A)({},o),{},{text:""}):o))})),vr(e),gr(!0)};(0,n.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?ar(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(Le){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",Le),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,n.useEffect)((()=>{(lr.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(lr))}),[lr]);const Ht=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr).trim();if(!o)return;const r={sender:"user",text:o};ar((e=>[...e,r])),cr(""),mr(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const r="https://sideeye-backend-production.up.railway.app";if(!r)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),Ot("Configuration error: Backend URL not set."),void mr(!1);const n="".concat(r,"/api/sade-ai");if(null===Ae||void 0===Ae||!Ae.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),Ot("Error: Could not identify user."),void mr(!1);ar((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),s=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),l={message:o,forceSearch:e,userId:Ae.uid,contextFlags:{avoidAppInstructions:i&&!s,isGreeting:i,isInstructionQuery:s,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",l);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)},d=await fetch(n,a);if(ar((e=>e.filter(((o,r)=>r!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(t){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(ar((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),Ot(c.response)):Ot(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),Ot("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),Ot("Sorry, I got a bit confused there."))}catch(n){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",n),ar((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),Ot("Sorry, there was an error: ".concat(n.message||"Unknown error"))}finally{mr(!1),Dt()}};(0,n.useEffect)((()=>{const e=_o?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(_o):null,o=()=>{if(Xr&&(Xr.destroy(),qr(null)),e&&document.getElementById(Kr)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(Kr,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});qr(o)}else!e&&Xr&&(Xr.destroy(),qr(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{Xr&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),Xr.destroy(),qr(null))}}),[_o]);const zt=e=>(0,Ee.jsx)("div",{id:Kr,style:{width:"100%",height:"100%"}}),Wt=Se?"".concat(Se.name," - SideEye"):Te?"Loading Room...":"Room Not Found - SideEye",Mt=Se&&Se.description||"Join the conversation on SideEye.",Lt="".concat(window.location.origin,"/default-app-logo.png"),Bt=(null===Se||void 0===Se?void 0:Se.thumbnailUrl)||Lt,Gt="".concat(window.location.origin,"/side-room/").concat(Y||"");if(Te&&!Se)return(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Oe.mg,{children:(0,Ee.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,Ee.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,Ee.jsx)(C.A,{})})]});if(Le&&!Se)return(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Oe.mg,{children:(0,Ee.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,Ee.jsxs)(u.A,{sx:{p:3,textAlign:"center"},children:[(0,Ee.jsx)(A.A,{severity:"error",children:Le}),(0,Ee.jsxs)(y.A,{onClick:()=>X("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const Nt=async()=>{if(Co)if(Hr)try{await Co.screenShare.toggle();const e=Co.screenShare.enabled;Or(e),e?(c.oR.success("Screen sharing started. All participants will see your screen automatically."),tr&&null!==Se&&void 0!==Se&&Se.id&&null!==Ae&&void 0!==Ae&&Ae.uid&&tr.emit("start-screen-share",{roomId:Se.id,userId:Ae.uid})):(c.oR.success("Screen sharing stopped."),tr&&null!==Se&&void 0!==Se&&Se.id&&null!==Ae&&void 0!==Ae&&Ae.uid&&tr.emit("stop-screen-share",{roomId:Se.id,userId:Ae.uid}))}catch(Le){var e,o,r,t;console.error("Error toggling screen share:",Le),"NotAllowedError"===Le.name||null!==(e=Le.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=Le.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(r=Le.message)&&void 0!==r&&r.includes("getDisplayMedia is not supported")||null!==(t=Le.message)&&void 0!==t&&t.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(Le.message||"Unknown error")),Co.screenShare&&Or(Co.screenShare.enabled)}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")},_t=async()=>{if(Se&&eo&&Ae){Ke(!0);try{if(Se.password===eo){const e=(0,d.H9)(a.db,"sideRooms",Y),o=await(0,d.x7)(e),r=o.data().viewers||[];r.some((e=>e.userId===Ae.uid))||await(0,d.mZ)(e,{viewers:[...r,{userId:Ae.uid,username:Ae.displayName||Ae.email||"User",role:"viewer",joinedAt:(0,d.O5)()}]}),c.oR.success("Password correct. Welcome to the room!"),$e(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(Le){console.error("Error verifying password:",Le),c.oR.error("An error occurred. Please try again.")}finally{Ke(!1)}}else c.oR.error("Missing information. Please try again.")},Vt=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))c.oR.error("Screen recording is not fully supported on mobile devices. Please use a desktop browser for this feature.");else try{var e;if(null===(e=navigator.mediaDevices)||void 0===e||!e.getDisplayMedia)return void c.oR.error("Screen recording is not supported in your browser.");const o=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),r=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaStream;o.getVideoTracks().forEach((e=>{t.addTrack(e)})),o.getAudioTracks().forEach((e=>{t.addTrack(e)})),r.getAudioTracks().forEach((e=>{t.addTrack(e)}));const n=new MediaRecorder(t,{mimeType:"video/webm"});n.ondataavailable=e=>{e.data.size>0&&Jr.current.push(e.data)},n.onstop=()=>{const e=new Blob(Jr.current,{type:"video/webm"}),o=URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=o,r.download="sideeye-room-recording-".concat((new Date).toISOString(),".webm"),document.body.appendChild(r),r.click(),setTimeout((()=>{document.body.removeChild(r),window.URL.revokeObjectURL(o),Jr.current=[]}),100),t.getTracks().forEach((e=>e.stop())),Nr(null),Vr(null),Br(!1),c.oR.success("Recording saved to your device")},n.start(),Nr(t),Vr(n),Br(!0),c.oR.success("Screen recording started with audio"),o.getVideoTracks()[0].onended=()=>{"inactive"!==n.state&&n.stop()}}catch(Le){console.error("Error starting screen recording:",Le),c.oR.error("Could not start screen recording. Please make sure you've granted the necessary permissions.")}},Jt=()=>{_r&&"inactive"!==_r.state&&_r.stop(),Gr&&Gr.getTracks().forEach((e=>e.stop()))},Yt=()=>{$r(!1)},Zt=()=>{lt(!0)};return(0,Ee.jsxs)(Ee.Fragment,{children:[rt.map((e=>(0,Ee.jsx)(Je,{icon:(0,Ee.jsx)(J.A,{}),color:je.palette.error.main},"heart-".concat(e)))),nt.map((e=>(0,Ee.jsx)(Je,{icon:(0,Ee.jsx)(Z.A,{}),color:je.palette.error.main},"heartbreak-".concat(e)))),Se&&(0,Ee.jsx)(Ye,{handleHeartRoom:async()=>{if(!Ae||!Ae.uid||!Y||!Se)return;tt((e=>[...e,Date.now()])),Cr(!0);const e=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",Ae.uid),o=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",Ae.uid),r=(0,d.H9)(a.db,"sideRooms",Y);try{await(0,d.c4)(a.db,(async t=>{var n;const i=await t.get(e),s=await t.get(o);if(!(await t.get(r)).exists())throw"Room does not exist!";const l=await(0,d.x7)((0,d.H9)(a.db,"users",Ae.uid)),c=l.exists()?(null===(n=l.data())||void 0===n?void 0:n.username)||Ae.displayName:"Someone";s.exists()&&(t.delete(o),t.update(r,{heartbreakCount:(0,d.GV)(-1)}),zo(!1)),i.exists()?(t.delete(e),t.update(r,{heartCount:(0,d.GV)(-1)})):(t.set(e,{userId:Ae.uid,username:c,timestamp:(0,d.O5)()}),t.update(r,{heartCount:(0,d.GV)(1)}))}))}catch(Le){console.error("Error hearting room:",Le),c.oR.error("Failed to update heart status.")}finally{Cr(!1)}},handleHeartbreakRoom:async()=>{if(!Ae||!Ae.uid||!Y||!Se)return;it((e=>[...e,Date.now()])),Mo(!0);const e=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",Ae.uid),o=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",Ae.uid),r=(0,d.H9)(a.db,"sideRooms",Y);try{await(0,d.c4)(a.db,(async t=>{var n;const i=await t.get(e),s=await t.get(o);if(!(await t.get(r)).exists())throw"Room does not exist!";const l=await(0,d.x7)((0,d.H9)(a.db,"users",Ae.uid)),c=l.exists()?(null===(n=l.data())||void 0===n?void 0:n.username)||Ae.displayName:"Someone";s.exists()&&(t.delete(o),t.update(r,{heartCount:(0,d.GV)(-1)}),Fo(!1)),i.exists()?(t.delete(e),t.update(r,{heartbreakCount:(0,d.GV)(-1)})):(t.set(e,{userId:Ae.uid,username:c,timestamp:(0,d.O5)()}),t.update(r,{heartbreakCount:(0,d.GV)(1)}))}))}catch(Le){console.error("Error heartbreaking room:",Le),c.oR.error("Failed to update heartbreak status.")}finally{Mo(!1)}},currentUserHearted:Eo,currentUserHeartbroken:Ho,roomHeartCount:Ro,roomHeartbreakCount:Do,isHearting:yr,isHeartbreaking:Wo,accentColor:null===Se||void 0===Se||null===(e=Se.style)||void 0===e?void 0:e.accentColor,textColor:null===Se||void 0===Se||null===(o=Se.style)||void 0===o?void 0:o.textColor}),(0,Ee.jsxs)(Oe.mg,{children:[(0,Ee.jsx)("title",{children:Wt}),(0,Ee.jsx)("meta",{name:"description",content:Mt}),(0,Ee.jsx)("meta",{property:"og:type",content:"website"}),(0,Ee.jsx)("meta",{property:"og:url",content:Gt}),(0,Ee.jsx)("meta",{property:"og:title",content:Wt}),(0,Ee.jsx)("meta",{property:"og:description",content:Mt}),(0,Ee.jsx)("meta",{property:"og:image",content:Bt}),(0,Ee.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,Ee.jsx)("meta",{property:"og:image:height",content:"630"}),(0,Ee.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,Ee.jsx)("meta",{name:"twitter:url",content:Gt}),(0,Ee.jsx)("meta",{name:"twitter:title",content:Wt}),(0,Ee.jsx)("meta",{name:"twitter:description",content:Mt}),(0,Ee.jsx)("meta",{name:"twitter:image",content:Bt})]}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===Se||void 0===Se||null===(r=Se.style)||void 0===r?void 0:r.font)||_e[0],backgroundColor:null!==Se&&void 0!==Se&&null!==(s=Se.style)&&void 0!==s&&s.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Se||void 0===Se||null===(G=Se.style)||void 0===G?void 0:G.backgroundColor)||je.palette.background.default,", ").concat((null===Se||void 0===Se||null===(N=Se.style)||void 0===N?void 0:N.accentColor)||je.palette.secondary.main,")"):(null===Se||void 0===Se||null===(_=Se.style)||void 0===_?void 0:_.backgroundColor)||je.palette.background.default,color:(null===Se||void 0===Se||null===(V=Se.style)||void 0===V?void 0:V.textColor)||je.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[Se&&(()=>{var e,o,r,t,n,i,s,l,m,A,w,j,S,k,R,I,E,F,P,U,T,D,O;return(0,Ee.jsxs)(u.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==Se&&void 0!==Se&&null!==(e=Se.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Se||void 0===Se||null===(o=Se.style)||void 0===o?void 0:o.headerColor)||je.palette.primary.main,", ").concat((null===Se||void 0===Se||null===(r=Se.style)||void 0===r?void 0:r.accentColor)||je.palette.secondary.light,")"):(null===Se||void 0===Se||null===(t=Se.style)||void 0===t?void 0:t.headerColor)||je.palette.background.paper,color:(null===Se||void 0===Se||null===(n=Se.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,Ee.jsx)(v.A,{variant:"h6",sx:{fontFamily:(null===Se||void 0===Se||null===(i=Se.style)||void 0===i?void 0:i.font)||_e[0],fontSize:null!==Se&&void 0!==Se&&null!==(s=Se.style)&&void 0!==s&&s.headerFontSize?"".concat(Se.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===Se||void 0===Se?void 0:Se.name}),xt&&(0,Ee.jsxs)(v.A,{variant:"caption",sx:{opacity:null!==Se&&void 0!==Se&&null!==(l=Se.style)&&void 0!==l&&l.textColor?.85:1,fontFamily:(null===Se||void 0===Se||null===(m=Se.style)||void 0===m?void 0:m.font)||_e[0]},children:["Host: ",xt.username]})]}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===Ae||void 0===Ae?void 0:Ae.uid)&&(null===Se||void 0===Se?void 0:Se.ownerId)&&Ae.uid!==Se.ownerId&&xt&&(0,Ee.jsx)(h.A,{title:"Follow ".concat(xt.username),children:(0,Ee.jsx)(p.A,{onClick:async()=>{if(null!==Ae&&void 0!==Ae&&Ae.uid&&null!==Se&&void 0!==Se&&Se.ownerId&&a.db)try{const e=(0,d.H9)(a.db,"users",Ae.uid,"following",Se.ownerId),o=await(0,d.x7)(e),r=(0,d.H9)(a.db,"users",Se.ownerId,"followRequests",Ae.uid),t=await(0,d.x7)(r),n=(0,d.H9)(a.db,"users",Se.ownerId),i=await(0,d.x7)(n),s=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(a.db,"users",Se.ownerId,"followers",Ae.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(xt.username))}else if(t.exists())await(0,d.kd)(r),c.oR.success("Canceled follow request to ".concat(xt.username));else if(s)await(0,d.BN)(r,{userId:Ae.uid,username:Ae.displayName||Ae.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(xt.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(a.db,"users",Se.ownerId,"followers",Ae.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(xt.username));const r=await Ct(Se.ownerId);r&&(ot(r),$r(!0))}}catch(Le){console.error("Error toggling follow:",Le),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===Se||void 0===Se||null===(A=Se.style)||void 0===A?void 0:A.accentColor)||"inherit"},children:(0,Ee.jsx)(q.A,{})})}),(0,Ee.jsx)(h.A,{title:"Share",children:(0,Ee.jsx)(p.A,{onClick:wt,sx:{color:(null===Se||void 0===Se||null===(w=Se.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,Ee.jsx)(K.A,{})})}),(null===Ae||void 0===Ae?void 0:Ae.uid)&&(null===Se||void 0===Se?void 0:Se.ownerId)&&Ae.uid!==Se.ownerId&&(0,Ee.jsx)(h.A,{title:"Report Room",children:(0,Ee.jsx)(p.A,{onClick:Zt,sx:{color:(null===Se||void 0===Se||null===(j=Se.style)||void 0===j?void 0:j.accentColor)||"inherit"},children:(0,Ee.jsx)(Q.A,{})})}),mt&&(0,Ee.jsx)(h.A,{title:"Share Video Link",children:(0,Ee.jsx)(p.A,{onClick:ft,size:"small",color:"secondary",children:(0,Ee.jsx)($.A,{})})}),(0,Ee.jsx)(h.A,{title:"Chat with Sade AI",children:(0,Ee.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>sr(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===Se||void 0===Se||null===(S=Se.style)||void 0===S?void 0:S.accentColor)||je.palette.primary.light)}})}),Hr&&(0,Ee.jsx)(h.A,{title:Lr?"Stop Recording":"Record Room (Desktop Only)",children:(0,Ee.jsx)(p.A,{onClick:Lr?Jt:Vt,color:Lr?"error":"inherit",sx:{color:Lr?je.palette.error.main:(null===Se||void 0===Se||null===(k=Se.style)||void 0===k?void 0:k.accentColor)||"inherit"},children:Lr?(0,Ee.jsx)(ee.A,{}):(0,Ee.jsx)(oe.A,{})})}),Co&&(0,Ee.jsx)(h.A,{title:Yr?"Turn Camera Off":"Turn Camera On",children:(0,Ee.jsx)(p.A,{onClick:at,sx:{color:Yr?(null===Se||void 0===Se||null===(R=Se.style)||void 0===R?void 0:R.accentColor)||je.palette.primary.main:"inherit"},children:Yr?(0,Ee.jsx)(oe.A,{}):(0,Ee.jsx)(re.A,{})})}),mt&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(h.A,{title:"Room Settings",children:(0,Ee.jsx)(p.A,{onClick:jt,sx:{color:(null===Se||void 0===Se||null===(I=Se.style)||void 0===I?void 0:I.accentColor)||"inherit"},children:(0,Ee.jsx)(te.A,{})})}),(0,Ee.jsxs)(g.A,{anchorEl:uo,open:Boolean(uo),onClose:St,children:[(0,Ee.jsxs)(f.A,{onClick:kt,children:[" ",(0,Ee.jsx)(b.A,{children:(0,Ee.jsx)(ne.A,{fontSize:"small"})}),"Edit Room"]}),(0,Ee.jsxs)(f.A,{onClick:Rt,children:[" ",(0,Ee.jsx)(b.A,{children:(0,Ee.jsx)(ie.A,{fontSize:"small"})}),"Customize"]}),(0,Ee.jsxs)(f.A,{onClick:It,children:[" ",(0,Ee.jsx)(b.A,{children:(0,Ee.jsx)(q.A,{fontSize:"small"})}),"Invite"]}),(0,Ee.jsxs)(f.A,{onClick:Ft,sx:{color:"error.main"},children:[(0,Ee.jsx)(b.A,{children:(0,Ee.jsx)(se.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,Ee.jsx)(h.A,{title:"Leave Room",children:(0,Ee.jsx)(p.A,{onClick:()=>{mt?Tr(!0):X("/side-rooms")},disabled:qe,sx:{color:(null===Se||void 0===Se||null===(E=Se.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:(0,Ee.jsx)(le.A,{})})}),mt&&Hr&&Co&&(0,Ee.jsx)(h.A,{title:Dr?"Stop Sharing Screen":"Share Screen (Desktop Only)",children:(0,Ee.jsx)(p.A,{onClick:Nt,sx:{color:(null===Se||void 0===Se||null===(F=Se.style)||void 0===F?void 0:F.accentColor)||"inherit"},children:Dr?(0,Ee.jsx)(ae.A,{}):(0,Ee.jsx)(de.A,{})})})]})]}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ee.jsxs)(v.A,{variant:"caption",sx:{fontFamily:(null===Se||void 0===Se||null===(P=Se.style)||void 0===P?void 0:P.font)||_e[0]},children:[vt.length," Online"]}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!Co&&bo&&pt&&(0,Ee.jsx)(y.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),Co?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):ko(!0)},startIcon:wo?(0,Ee.jsx)(C.A,{size:20,color:"inherit"}):(0,Ee.jsx)(ce.A,{}),disabled:wo||!bo,sx:{backgroundColor:null===Se||void 0===Se||null===(U=Se.style)||void 0===U?void 0:U.accentColor,fontFamily:(null===Se||void 0===Se||null===(T=Se.style)||void 0===T?void 0:T.font)||_e[0],color:null!==Se&&void 0!==Se&&null!==(D=Se.style)&&void 0!==D&&D.accentColor?je.palette.getContrastText(Se.style.accentColor):void 0},children:wo?"Connecting...":"Connect Audio (Stream)"}),Co&&(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(h.A,{title:"Toggle Microphone",children:(0,Ee.jsxs)(p.A,{onClick:async()=>{var e;if(null===Co||void 0===Co||!Co.microphone||null===Ae||void 0===Ae||!Ae.uid||!Y)return;const o=ho.find((e=>e.userId===Ae.uid)),r=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await Co.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(r));const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",Ae.uid);await(0,d.mZ)(e,{isMuted:r}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(Ae.uid," to ").concat(r))}catch(Le){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",Le),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==Co&&void 0!==Co&&Co.microphone)||!(null!==Ae&&void 0!==Ae&&Ae.uid)||!Y,children:[(0,Ee.jsx)(ue.A,{})," "]})}),(0,Ee.jsx)(v.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,Ee.jsx)(y.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===Co||void 0===Co||Co.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),X("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:wo,sx:{fontFamily:(null===Se||void 0===Se||null===(O=Se.style)||void 0===O?void 0:O.font)||_e[0]},children:"Leave Audio"})]}),!bo&&Te&&(0,Ee.jsx)(C.A,{size:24})]})]})]})})(),(0,Ee.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto"},children:Se?bo?Co?(0,Ee.jsx)(Ue.Mf9,{client:bo,children:(0,Ee.jsx)(Ue.xwR,{call:Co,children:(0,Ee.jsx)(Xe,{room:Se,isRoomOwner:mt,isGuest:ht,handleOpenShareVideoDialog:ft,handleClearSharedVideo:yt,currentVideoUrl:_o,renderVideoPlayer:zt,onForceMuteToggle:Pt,onForceRemove:Ut,onForceBan:Tt,theme:je,navigate:X})})}):(0,Ee.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[_o&&(0,Ee.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ee.jsx)(v.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),mt&&(0,Ee.jsx)(h.A,{title:"Clear Shared Video",children:(0,Ee.jsx)(p.A,{onClick:yt,size:"small",children:(0,Ee.jsx)(me.A,{})})})]}),(0,Ee.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:zt()})]}),(0,Ee.jsxs)(v.A,{variant:"h6",gutterBottom:!0,children:["Participants (",vt.length,")"]}),(0,Ee.jsx)(w.Ay,{container:!0,spacing:2,children:vt.map((e=>(0,Ee.jsx)(w.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,Ee.jsxs)(j.A,{sx:{p:1,textAlign:"center"},children:[(0,Ee.jsx)(x.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,Ee.jsx)(v.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,Ee.jsx)(he.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!Co&&!wo&&pt&&(0,Ee.jsx)(A.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),wo&&(0,Ee.jsx)(A.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===go&&pt&&null!==Ae&&void 0!==Ae&&Ae.uid&&Y||null!==go&&!bo?(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(C.A,{sx:{mb:2}}),(0,Ee.jsx)(v.A,{children:"Initializing audio components..."}),(0,Ee.jsx)(v.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!pt&&null!==Ae&&void 0!==Ae&&Ae.uid?(0,Ee.jsx)(A.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,Ee.jsx)(A.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,Ee.jsx)(y.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[Te&&(0,Ee.jsx)(C.A,{}),!Te&&(0,Ee.jsxs)(A.A,{severity:"error",children:["Room not found. ",(0,Ee.jsx)(y.A,{onClick:()=>X("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,Ee.jsxs)(S.A,{open:Lo,onClose:bt,fullWidth:!0,maxWidth:"sm",children:[(0,Ee.jsx)(k.A,{children:"Share a Video"}),(0,Ee.jsx)(R.A,{children:(0,Ee.jsx)(I.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:Go,onChange:e=>No(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:bt,children:"Cancel"}),(0,Ee.jsx)(y.A,{onClick:()=>{if(!Y)return void c.oR.error("Cannot share video: Room ID is missing.");if(!Go.trim())return void c.oR.error("Please enter a video URL.");if(!Go.startsWith("http://")&&!Go.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{currentSharedVideoUrl:Go,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),Vo(Go),c.oR.success("Video shared!"),bt()},variant:"contained",children:"Share Video"})]})]}),(0,Ee.jsxs)(S.A,{open:ao,onClose:()=>co(!1),fullWidth:!0,maxWidth:"xs",children:[(0,Ee.jsx)(k.A,{children:"Share this Room"}),(0,Ee.jsxs)(R.A,{sx:{textAlign:"center"},children:[(0,Ee.jsx)(v.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,Ee.jsx)(I.A,{fullWidth:!0,variant:"outlined",value:"".concat(window.location.origin,"/side-room/").concat(Y),InputProps:{readOnly:!0},sx:{mb:2}}),(0,Ee.jsx)(y.A,{variant:"contained",startIcon:(0,Ee.jsx)(pe.A,{}),onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(Y)),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,Ee.jsx)(F.A,{sx:{my:2},children:(0,Ee.jsx)(P.A,{label:"OR"})}),(0,Ee.jsx)(v.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share via Direct Message:"}),(0,Ee.jsx)(y.A,{variant:"outlined",startIcon:(0,Ee.jsx)(ve.A,{}),onClick:()=>{co(!1),Ie(!0)},sx:{mb:2,width:"100%"},children:"Send to a Friend"}),(0,Ee.jsx)(F.A,{sx:{my:2},children:(0,Ee.jsx)(P.A,{label:"OR"})}),(0,Ee.jsx)(v.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share on social media:"}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,Ee.jsx)(p.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(Y)),"&text=").concat(encodeURIComponent((null===Se||void 0===Se?void 0:Se.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,Ee.jsx)(xe.A,{})}),(0,Ee.jsx)(p.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(Y))),"_blank"),title:"Share on Facebook",children:(0,Ee.jsx)(ge.A,{})}),(0,Ee.jsx)(p.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===Se||void 0===Se?void 0:Se.name)||"Join my SideEye Room!")+" "+"".concat(window.location.origin,"/side-room/").concat(Y))),"_blank"),title:"Share on WhatsApp",children:(0,Ee.jsx)(fe.A,{})}),(0,Ee.jsx)(p.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(Y)),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,Ee.jsx)(be.A,{})})]})]}),(0,Ee.jsx)(E.A,{children:(0,Ee.jsx)(y.A,{onClick:()=>co(!1),children:"Close"})})]}),(0,Ee.jsxs)(S.A,{open:ir,onClose:()=>sr(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,Ee.jsxs)(k.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,Ee.jsx)(h.A,{title:"Clear Chat History",children:(0,Ee.jsx)(p.A,{onClick:()=>{ar([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,Ee.jsx)(se.A,{})})})]}),(0,Ee.jsx)(R.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:je.palette.background.default},children:(0,Ee.jsxs)(U.A,{sx:{p:0},children:[lr.map(((e,o)=>(0,Ee.jsxs)(T.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,Ee.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,Ee.jsx)(j.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,Ee.jsx)(We.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),ur&&(0,Ee.jsxs)(T.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,Ee.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Ee.jsx)(j.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,Ee.jsx)("div",{ref:hr})]})}),(0,Ee.jsxs)(E.A,{sx:{p:1,borderTop:"1px solid ".concat(je.palette.divider),flexDirection:"column"},children:[lr.length<=1&&!ur&&(0,Ee.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,Ee.jsx)(P.A,{label:e,onClick:()=>Ht(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,Ee.jsxs)(u.A,{sx:{display:"flex",width:"100%"},children:[(0,Ee.jsx)(I.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:dr,onChange:e=>cr(e.target.value),onKeyPress:e=>"Enter"===e.key&&!ur&&Ht(),sx:{mr:1},disabled:ur}),(0,Ee.jsxs)(p.A,{onClick:()=>!ur&&Ht(dr,!1),disabled:ur||!dr.trim(),color:"primary",children:[(0,Ee.jsx)(K.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,Ee.jsxs)(p.A,{onClick:()=>!ur&&Ht(dr,!0),disabled:ur||!dr.trim(),color:"secondary",title:"Search the web",children:[(0,Ee.jsx)(ye.A,{})," "]})]})]})]}),ro&&Se&&(0,Ee.jsx)(Fe,{open:ro,onClose:()=>to(!1),onSubmit:async(e,o)=>{if(Y&&Ae){Ke(!0);try{let r=Se.thumbnailUrl||"";if(o){const e=(0,De.KR)(a.IG,"room-thumbnails/".concat(Y,"_").concat(Date.now(),"_").concat(o.name));await(0,De.D)(e,o),r=await(0,De.qk)(e)}const t=(0,d.H9)(a.db,"sideRooms",Y),n={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:r,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?n.password=e.password:e.isPrivate||(n.password=(0,d.CL)()),await(0,d.mZ)(t,n),c.oR.success("Room details updated successfully!"),to(!1)}catch(r){console.error("Error updating room:",r),c.oR.error("Failed to update room details.")}finally{Ke(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:Se,title:"Edit Room",submitButtonText:"Save Changes"}),(0,Ee.jsxs)(S.A,{open:so,onClose:()=>lo(!1),fullWidth:!0,maxWidth:"sm",children:[(0,Ee.jsx)(k.A,{children:"Customize Room Appearance"}),(0,Ee.jsx)(R.A,{children:(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Ee.jsxs)(D.A,{fullWidth:!0,children:[(0,Ee.jsx)(O.A,{id:"theme-select-label",children:"Theme"}),(0,Ee.jsx)(H.A,{labelId:"theme-select-label",value:Ar,label:"Theme",onChange:e=>wr(e.target.value),children:Ne.map((e=>(0,Ee.jsx)(f.A,{value:e.name,children:e.name},e.name)))})]}),(0,Ee.jsxs)(D.A,{fullWidth:!0,children:[(0,Ee.jsx)(O.A,{id:"font-select-label",children:"Font"}),(0,Ee.jsx)(H.A,{labelId:"font-select-label",value:Ir,label:"Font",onChange:e=>Er(e.target.value),children:_e.map((e=>(0,Ee.jsx)(f.A,{value:e,children:e},e)))})]}),(0,Ee.jsxs)(D.A,{fullWidth:!0,children:[(0,Ee.jsx)(O.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,Ee.jsx)(H.A,{labelId:"text-size-select-label",value:Fr.toString(),label:"Header Text Size (px)",onChange:e=>Pr(Number(e.target.value)),children:Ve.map((e=>(0,Ee.jsx)(f.A,{value:e.toString(),children:e},e)))})]}),(0,Ee.jsx)(z.A,{control:(0,Ee.jsx)(W.A,{checked:jr,onChange:e=>Sr(e.target.checked)}),label:"Use Header Gradient"}),(0,Ee.jsx)(z.A,{control:(0,Ee.jsx)(W.A,{checked:kr,onChange:e=>Rr(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:()=>lo(!1),children:"Cancel"}),(0,Ee.jsx)(y.A,{onClick:async()=>{var e,o,r,t,n;if(!Y||!Se)return void c.oR.error("Cannot save style: Room data is missing.");if(!Ae)return void c.oR.error("You must be logged in to change the style.");if(!mt)return void c.oR.error("Only the room owner can change the style.");const i=Ne.find((e=>e.name===Ar));if(!i){var s,l,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=Ne[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:Ir,headerFontSize:Fr,headerGradient:jr,backgroundGradient:kr,customCss:(null===(s=Se.style)||void 0===s?void 0:s.customCss)||"",bannerUrl:(null===(l=Se.style)||void 0===l?void 0:l.bannerUrl)||"",stickers:(null===(u=Se.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=Se.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=Se.style)||void 0===h?void 0:h.thumbnailUrl)||Se.thumbnailUrl||""};try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),lo(!1)}catch(Le){console.error("Error updating room style with default theme:",Le),c.oR.error("Failed to update room style.")}finally{Ke(!1)}return}const p={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:Ir,headerFontSize:Fr,headerGradient:jr,backgroundGradient:kr,customCss:(null===(e=Se.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=Se.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(r=Se.style)||void 0===r?void 0:r.stickers)||[],glitterEffect:(null===(t=Se.style)||void 0===t?void 0:t.glitterEffect)||!1,thumbnailUrl:(null===(n=Se.style)||void 0===n?void 0:n.thumbnailUrl)||Se.thumbnailUrl||""};Ke(!0);try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{style:p,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),lo(!1)}catch(Le){console.error("Error updating room style:",Le),c.oR.error("Failed to update room style.")}finally{Ke(!1)}},variant:"contained",disabled:qe,children:qe?(0,Ee.jsx)(C.A,{size:24}):"Save Style"})]})]}),(0,Ee.jsxs)(S.A,{open:no,onClose:()=>{io(!1),Yo(""),$o(null),Xo([]),Ko(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,Ee.jsx)(k.A,{children:"Invite User to Room"}),(0,Ee.jsxs)(R.A,{children:[(0,Ee.jsx)(v.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,Ee.jsxs)(u.A,{ref:rr,sx:{position:"relative"},children:[(0,Ee.jsx)(I.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:Jo,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Yo(o),$o(null),o.trim().length>=2?(Ko(!0),At(o)):(Ko(!1),Xo([]))},sx:{mb:1}}),qo&&Zo.length>0&&(0,Ee.jsx)(j.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:je.zIndex.modal+1,mt:.5},children:(0,Ee.jsx)(M.x,{onClickAway:()=>{Ko(!1)},children:(0,Ee.jsx)(U.A,{dense:!0,children:Zo.map((e=>(0,Ee.jsxs)(T.Ay,{button:!0,onClick:()=>{return $o(o=e),Yo(o.username),Ko(!1),void Xo([]);var o},children:[(0,Ee.jsx)(L.A,{children:(0,Ee.jsx)(x.A,{src:e.profilePic,alt:e.username})}),(0,Ee.jsx)(B.A,{primary:(0,Ee.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,Ee.jsx)(Ce.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),qo&&0===Zo.length&&Jo.length>=2&&(0,Ee.jsxs)(v.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',Jo,'".']})]}),Qo&&(0,Ee.jsxs)(v.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",Qo.username,(0,Ee.jsx)(Ce.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:()=>{io(!1),Yo(""),$o(null),Xo([]),Ko(!1)},children:"Cancel"}),(0,Ee.jsx)(y.A,{onClick:Et,variant:"contained",disabled:er||!Qo||!tr,children:er?(0,Ee.jsx)(C.A,{size:24}):"Send Invite"})]})]}),(0,Ee.jsxs)(S.A,{open:Ur,onClose:()=>Tr(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,Ee.jsx)(k.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,Ee.jsxs)(R.A,{children:[(0,Ee.jsx)(v.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,Ee.jsx)(v.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:()=>Tr(!1),disabled:qe,children:"Cancel"}),(0,Ee.jsx)(y.A,{onClick:()=>{Tr(!1),Ft()},color:"error",variant:"contained",disabled:qe,autoFocus:!0,children:qe?(0,Ee.jsx)(C.A,{size:24}):"End and Delete"})]})]}),(0,Ee.jsxs)(S.A,{open:Qe,onClose:()=>{mt||pt||X("/side-rooms")},children:[(0,Ee.jsx)(k.A,{children:"Password Required"}),(0,Ee.jsxs)(R.A,{children:[(0,Ee.jsx)(v.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,Ee.jsx)(I.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:eo,onChange:e=>oo(e.target.value),onKeyPress:e=>"Enter"===e.key&&_t()})]}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:()=>X("/side-rooms"),disabled:qe,children:"Cancel"}),(0,Ee.jsx)(y.A,{onClick:_t,disabled:qe||!eo,variant:"contained",children:qe?(0,Ee.jsx)(C.A,{size:24}):"Submit"})]})]}),(0,Ee.jsxs)(S.A,{open:Qr,onClose:Yt,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,Ee.jsx)(k.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,Ee.jsx)(R.A,{children:(0,Ee.jsxs)(v.A,{variant:"body1",children:[(null===xt||void 0===xt?void 0:xt.username)||"This creator",' has a server chat room: "',null===et||void 0===et?void 0:et.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,Ee.jsxs)(E.A,{children:[(0,Ee.jsx)(y.A,{onClick:Yt,children:"Not Now"}),(0,Ee.jsx)(y.A,{onClick:()=>{et&&X("/chat/room/".concat(et.id)),$r(!1)},variant:"contained",color:"primary",children:"Join Chat Room"})]})]}),Se&&(0,Ee.jsx)(Be,{contentId:Se.id,contentType:"sideRoom",onClose:()=>{lt(!1)},open:st,ownerUsername:null===xt||void 0===xt?void 0:xt.username}),(0,Ee.jsx)(Ge,{open:Re,onClose:()=>{Ie(!1)},roomName:null===Se||void 0===Se?void 0:Se.name,roomLink:Gt,onSend:async(e,o)=>{if(null!==Ae&&void 0!==Ae&&Ae.uid&&a.db)try{const t=(0,d.H9)(a.db,"rooms",e);if((await(0,d.x7)(t)).exists()){const r=(0,d.rJ)(a.db,"rooms",e,"messages");return void await(0,d.gS)(r,{text:o,sender:Ae.uid,senderName:Ae.displayName||"Unknown User",senderPhoto:Ae.photoURL,timestamp:(0,d.O5)(),type:"chat"})}const n=(0,d.rJ)(a.db,"conversations"),i=(0,d.P)(n,(0,d._M)("participants","array-contains",Ae.uid)),s=await(0,d.GG)(i);let l=null;if(s.docs.forEach((o=>{o.data().participants.includes(e)&&(l=o.id)})),!l){var r;const o=(0,d.H9)(a.db,"users",e),t=await(0,d.x7)(o);if(!t.exists())throw new Error("Recipient user not found");const n=(null===(r=t.data().following)||void 0===r?void 0:r.includes(Ae.uid))||!1,i=(0,d.H9)((0,d.rJ)(a.db,"conversations"));await(0,d.BN)(i,{participants:[Ae.uid,e],createdAt:(0,d.O5)(),lastUpdated:(0,d.O5)(),unreadCount:{[Ae.uid]:0,[e]:1},status:n?"accepted":"pending"}),l=i.id}const c=(0,d.rJ)(a.db,"conversations",l,"messages");await(0,d.gS)(c,{text:o,sender:Ae.uid,timestamp:(0,d.O5)(),read:!1,reactions:[]});const u=(0,d.H9)(a.db,"conversations",l);await(0,d.mZ)(u,{lastMessage:{text:o,sender:Ae.uid,timestamp:(0,d.O5)()},lastUpdated:(0,d.O5)(),["unreadCount.".concat(e)]:(0,d.GV)(1)})}catch(Le){throw console.error("Error sending message:",Le),Le}else c.oR.error("Cannot send message: User not authenticated.")},currentUserId:null===Ae||void 0===Ae?void 0:Ae.uid})]})]})},Xe=e=>{var o,r,i,s,m,g,f,b,A,S,k,R,E,F,U,T,D,O,H,z,W,M,L,B,J,Y,Z,X,q,K,Q,ee,te,ne,ie,se,de,ce,pe,ve,xe,ge,fe,be,ye,Ce,ke,Re,Ie,Fe,Pe;let{room:De,isRoomOwner:Oe,isGuest:He,handleOpenShareVideoDialog:ze,handleClearSharedVideo:We,currentVideoUrl:Me,renderVideoPlayer:Le,onForceMuteToggle:Be,onForceRemove:Ge,onForceBan:Ne,theme:_e,navigate:Ve}=e;const Je=(0,Te.Gc)(),{useParticipants:Ye,useCallState:Ze,useMicrophoneState:Xe,useCameraState:Ke}=(0,Te.R3)(),Qe=Ye(),{localParticipant:$e}=Ze(),{isMute:eo}=Xe(),{isEnabled:oo,isTogglePending:ro}=Ke();(0,n.useEffect)((()=>{Je&&Je.camera.disable().catch((e=>{console.error("Error disabling camera:",e)}))}),[Je]);const{currentUser:to}=(0,l.As)(),[no,io]=(0,n.useState)(window.innerWidth>1024),[so,lo]=(0,n.useState)(!0),[ao,co]=(0,n.useState)(!1),[uo,mo]=(0,n.useState)([]),[ho,po]=(0,n.useState)([]),[vo,xo]=(0,n.useState)("participants"),[go,fo]=(0,n.useState)([]),[bo,yo]=(0,n.useState)(""),Co=(0,n.useRef)(null),Ao=Qe.find((e=>e.screenShareStream)),wo=(null===Ao||void 0===Ao?void 0:Ao.userId)===De.ownerId;(0,n.useEffect)((()=>{Ao&&(console.log("Screen sharing detected from participant ".concat(Ao.name||Ao.userId)),wo&&console.log("Room owner is sharing their screen - should be visible to ALL participants"))}),[Ao,wo]);(0,n.useEffect)((()=>{wo&&Ao&&console.log("Room owner is sharing screen - should be visible to all participants")}),[wo,Ao]),(0,n.useEffect)((()=>{Ao&&console.log("Screen sharing available from participant: ".concat(Ao.name||Ao.userId))}),[Ao]);const[jo,So]=(0,n.useState)({}),ko=(0,n.useCallback)((async e=>{if(jo[e])return jo[e];try{const o=(0,d.H9)(a.db,"users",e),r=await(0,d.x7)(o);if(r.exists()){const o=r.data(),n={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return So((o=>(0,t.A)((0,t.A)({},o),{},{[e]:n}))),n}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return So((r=>(0,t.A)((0,t.A)({},r),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[jo,a.db]),Ro=(0,n.useCallback)((async()=>{if(!bo.trim()||null===to||void 0===to||!to.uid||null===De||void 0===De||!De.id||!a.db)return;const e=await ko(to.uid),o={id:"".concat(Date.now(),"-").concat(to.uid),userId:to.uid,userName:e.username,message:bo.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(a.db,"sideRooms",De.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(r){console.error("[Chat] Error sending message to Firestore:",r),fo((e=>[...e,o]))}yo("")}),[bo,null===to||void 0===to?void 0:to.uid,null===De||void 0===De?void 0:De.id,a.db,ko]);(0,n.useEffect)((()=>{if(null===De||void 0===De||!De.id||!a.db)return;console.log("[Chat] Setting up chat listener for room ".concat(De.id));const e=(0,d.P)((0,d.rJ)(a.db,"sideRooms",De.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const r=e.data();o.push({id:e.id,userId:r.userId,userName:r.userName,message:r.message,timestamp:r.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),fo(o),Co.current&&Co.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===De||void 0===De?void 0:De.id,a.db]);const Io=(0,n.useCallback)((async()=>{if(Je)if(no)try{await Je.screenShare.toggle(),Je.screenShare.enabled?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(n){var e,o,r,t;console.error("Error toggling screen share:",n),"NotAllowedError"===n.name||null!==(e=n.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=n.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(r=n.message)&&void 0!==r&&r.includes("getDisplayMedia is not supported")||null!==(t=n.message)&&void 0!==t&&t.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(n.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[Je,no]);(0,n.useEffect)((()=>{const e=()=>{io(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const Eo=e=>{po((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))},Fo=()=>{Je&&("enabled"!==Je.camera.state.status?navigator.mediaDevices.getUserMedia({video:!0}).then((e=>(e.getTracks().forEach((e=>e.stop())),Je.camera.enable()))).then((()=>{lo(!0)})).catch((e=>{console.error("Error enabling camera:",e),c.oR.error("Could not enable camera. Please check permissions.")})):Je.camera.disable().catch((e=>{console.error("Error disabling camera:",e)})))};(0,n.useEffect)((()=>{var e;null===(e=Co.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[go]);const Po=(0,n.useMemo)((()=>{if(!Qe||null===De||void 0===De||!De.ownerId)return[];const e=Qe.find((e=>e.userId===De.ownerId));return[...e?[e]:[],...Qe.filter((e=>ho.includes(e.userId)&&e.userId!==De.ownerId)),...Qe.filter((e=>e.userId!==De.ownerId&&!ho.includes(e.userId)))].filter(Boolean)}),[Qe,null===De||void 0===De?void 0:De.ownerId,ho]);(0,n.useEffect)((()=>{oo&&lo(!0)}),[oo]);const Uo=Po;(0,n.useEffect)((()=>{if(null===Qe||void 0===Qe||!Qe.length)return;(async()=>{const e=Qe.filter((e=>!jo[e.userId])).map((e=>ko(e.userId)));await Promise.all(e)})()}),[Qe,ko,jo]);return(0,n.useEffect)((()=>{if(Je&&null!==to&&void 0!==to&&to.uid&&null!==De&&void 0!==De&&De.id&&"boolean"===typeof eo&&a.db){const e=(0,d.H9)(a.db,"sideRooms",De.id,"presence",to.uid),o="sideRooms/".concat(De.id,"/presence/").concat(to.uid);console.log("[DEBUG Mute Sync] Attempting updateDoc to path:",o,"with data:",JSON.stringify({isMuted:eo},null,2)),(0,d.mZ)(e,{isMuted:eo}).then((()=>{console.log("[InsideStreamCallContent] Synced local mute state (".concat(eo,") to Firestore for ").concat(to.uid))})).catch((e=>{console.error("[InsideStreamCallContent] Error syncing local mute state to Firestore for ".concat(to.uid,":"),e)}))}}),[eo,Je,null===to||void 0===to?void 0:to.uid,null===De||void 0===De?void 0:De.id,a.db]),(0,n.useEffect)((()=>{if(!Je||!Qe||0===Qe.length)return;const e=Qe.find((e=>e.screenShareStream));e&&(console.log("Screen sharing detected from: ".concat(e.name||e.userId)),console.log("Screen share stream should be visible to ALL participants"))}),[Je,Qe]),Je?(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==De&&void 0!==De&&null!==(r=De.style)&&void 0!==r&&r.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.backgroundColor)||_e.palette.background.default,", ").concat((null===De||void 0===De||null===(s=De.style)||void 0===s?void 0:s.accentColor)||_e.palette.secondary.main,")"):(null===De||void 0===De||null===(m=De.style)||void 0===m?void 0:m.backgroundColor)||_e.palette.background.default,color:(null===De||void 0===De||null===(g=De.style)||void 0===g?void 0:g.textColor)||_e.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[(()=>{var e,o,r,t,n,i,s,l,a;return(0,Ee.jsxs)(u.A,{sx:{p:1,borderBottom:1,borderColor:"divider",textAlign:"center",flexShrink:0,backgroundColor:null!==De&&void 0!==De&&null!==(e=De.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.headerColor)||_e.palette.primary.main,", ").concat((null===De||void 0===De||null===(r=De.style)||void 0===r?void 0:r.accentColor)||_e.palette.secondary.light,")"):(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.headerColor)||(0,V.X4)(_e.palette.background.paper,.95),color:(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Ee.jsx)(v.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.font)||"inherit"},children:De.name}),(0,Ee.jsxs)(v.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(s=De.style)&&void 0!==s&&s.textColor?(0,V.X4)(null===De||void 0===De||null===(l=De.style)||void 0===l?void 0:l.textColor,.8):"text.secondary",sx:{fontFamily:(null===De||void 0===De||null===(a=De.style)||void 0===a?void 0:a.font)||"inherit"},children:["(Mic: ",eo?"Muted":"On",")"]})]})})(),(0,Ee.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[!Ao&&(0,Ee.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ee.jsx)(v.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===De||void 0===De||null===(f=De.style)||void 0===f?void 0:f.accentColor)||_e.palette.primary.main},children:"Live Video"}),(0,Ee.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"},mb:2},children:[oo?(0,Ee.jsxs)(u.A,{sx:{border:"3px solid",borderColor:_e.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(0,Ee.jsx)(p.A,{onClick:Fo,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ee.jsx)(Ae.A,{fontSize:"small"})}),$e&&(0,Ee.jsx)(Ue.fSl,{participant:$e,trackType:"videoTrack"}),(0,Ee.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ee.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ee.jsx)(x.A,{sx:{width:40,height:40,mr:1},children:(null===to||void 0===to||null===(b=to.displayName)||void 0===b?void 0:b[0])||"U"}),(0,Ee.jsxs)(u.A,{children:[(0,Ee.jsx)(v.A,{variant:"subtitle2",fontWeight:"bold",children:(null===to||void 0===to?void 0:to.displayName)||"You"}),(0,Ee.jsx)(v.A,{variant:"caption",children:(null===De||void 0===De?void 0:De.name)||"Live Room"})]})]})}),(0,Ee.jsx)(u.A,{sx:{position:"absolute",right:12,bottom:70,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:(0,Ee.jsx)(h.A,{title:eo?"Unmute":"Mute",children:(0,Ee.jsx)(p.A,{onClick:()=>null===Je||void 0===Je?void 0:Je.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:44,height:44,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:eo?(0,Ee.jsx)(he.A,{}):(0,Ee.jsx)(ue.A,{})})})})]}):(0,Ee.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Ee.jsx)(y.A,{variant:"contained",color:"primary",onClick:Fo,startIcon:(0,Ee.jsx)(oe.A,{}),children:"Enable Camera"})}),Qe&&Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid))).length>0&&(so?(0,Ee.jsxs)(u.A,{sx:{border:"3px solid",borderColor:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(()=>{const e=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===to||void 0===to?void 0:to.uid))),o=Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid)))[0],r=e||o;return r?(0,Ee.jsx)(Ue.fSl,{participant:r,trackType:"videoTrack"}):null})(),(0,Ee.jsx)(p.A,{onClick:()=>{lo(!1),c.oR.success("Video view closed")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ee.jsx)(Ae.A,{fontSize:"small"})}),(0,Ee.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(e=>{const o=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===to||void 0===to?void 0:to.uid))),r=Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid)))[0],t=o||r;return t&&(0,Ee.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ee.jsx)(x.A,{src:null===(e=jo[t.userId])||void 0===e?void 0:e.avatar,sx:{width:40,height:40,mr:1}}),(0,Ee.jsx)(u.A,{children:(0,Ee.jsxs)(v.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===t||void 0===t?void 0:t.name)||"User",t.userId===De.ownerId&&" (Host)"]})})]})})()})]}):(0,Ee.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Ee.jsx)(y.A,{variant:"outlined",color:"primary",onClick:()=>lo(!0),startIcon:(0,Ee.jsx)(oe.A,{}),children:"Show Partner Video"})}))]}),Qe&&Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid))).length>1&&(0,Ee.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:1,mt:2,width:"100%",maxWidth:"600px"},children:Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid))).filter((e=>{const o=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===to||void 0===to?void 0:to.uid)));return!(e.userId===De.ownerId&&o===Qe.filter((e=>e.userId!==(null===to||void 0===to?void 0:to.uid)))[0])})).filter((e=>!uo.includes(e.userId))).map((e=>(0,Ee.jsxs)(u.A,{sx:{width:"100px",height:"150px",borderRadius:"10px",overflow:"hidden",position:"relative",border:"2px solid",borderColor:"divider",backgroundColor:"#000","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[(0,Ee.jsx)(Ue.fSl,{participant:e,trackType:"videoTrack"}),(0,Ee.jsx)(p.A,{onClick:()=>{const o=[...uo||[]];if(o.includes(e.userId)){const r=o.indexOf(e.userId);r>-1&&o.splice(r,1)}else o.push(e.userId);mo(o),c.oR.success("Video view toggled")},sx:{position:"absolute",top:2,right:2,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:20,height:20,zIndex:10,padding:"2px","& .MuiSvgIcon-root":{fontSize:"14px"},"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ee.jsx)(Ae.A,{})}),(0,Ee.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"2px 4px",background:"rgba(0,0,0,0.7)",color:"white",fontSize:"10px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name||"User ".concat(e.userId.substring(0,5))})]},e.userId)))})]}),Ao&&(0,Ee.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ee.jsxs)(v.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===De||void 0===De||null===(A=De.style)||void 0===A?void 0:A.accentColor)||_e.palette.primary.main},children:[Ao.userId===(null===to||void 0===to?void 0:to.uid)?"You are sharing your screen":"".concat(Ao.name||"Someone"," is sharing their screen"),wo&&Ao.userId!==(null===to||void 0===to?void 0:to.uid)&&" (Room Owner)"]}),(0,Ee.jsxs)(u.A,{sx:{m:0,p:0,border:"1px solid",borderColor:"divider",borderRadius:"8px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:"auto",width:"90%",maxWidth:"1200px",margin:"0 auto",marginTop:2,marginBottom:2,overflow:"hidden",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:[!ao&&(0,Ee.jsx)(u.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none","& .str-video__screen-share-info":{display:"none !important",visibility:"hidden !important",opacity:0,height:0,overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:-9999},'& .str-video__participant-details, & .str-video__participant-bar, & .str-video__loading-indicator, & .str-video__screen-share-text, & .str-video__screen-share-status, & .str-video__participant__name, & .str-video__participant__info, & .str-video__participant-flag, & div[class*="screen-share"], & span[class*="presentation"]':{display:"none !important",visibility:"hidden !important",opacity:0,height:0,width:0,overflow:"hidden",pointerEvents:"none"},"& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"contain",background:"#000"},"& .str-video__participant-details":{display:"none !important"},"& .str-video__participant-status":{display:"none !important"},"& .str-video__participant-flag-container":{display:"none !important"}}},children:(0,Ee.jsx)(Ue.fSl,{participant:Ao,trackType:"screenShareTrack"})}),Ao&&!ao&&(0,Ee.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:-1,opacity:0,pointerEvents:"none"},children:(0,Ee.jsx)("video",{autoPlay:!0,playsInline:!0,ref:e=>{e&&null!==Ao&&void 0!==Ao&&Ao.screenShareStream&&e.srcObject!==Ao.screenShareStream&&(e.srcObject=Ao.screenShareStream,e.play().catch((e=>console.error("Error playing screen share:",e))))}})}),ao&&so&&$e&&(0,Ee.jsxs)(u.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none",backgroundColor:"#000","& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[oo?(0,Ee.jsx)(Ue.fSl,{participant:$e,trackType:"videoTrack"}):(0,Ee.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Ee.jsx)(re.A,{sx:{fontSize:"5rem"}})}),(0,Ee.jsx)(p.A,{size:"medium",onClick:Fo,sx:{position:"absolute",top:16,right:80,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:oo?(0,Ee.jsx)(oe.A,{}):(0,Ee.jsx)(re.A,{})}),(0,Ee.jsx)(p.A,{size:"medium",onClick:()=>co(!1),sx:{position:"absolute",top:16,right:16,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Ee.jsx)(Ae.A,{})})]}),(0,Ee.jsx)(u.A,{sx:{position:"absolute",top:10,right:10,zIndex:10},children:Oe&&(0,Ee.jsx)(y.A,{variant:"contained",color:"error",size:"small",startIcon:(0,Ee.jsx)(ae.A,{}),onClick:Io,sx:{borderRadius:"20px",textTransform:"none",py:.5,px:1.5,bgcolor:"error.main",fontWeight:"bold",minWidth:0,boxShadow:"0 2px 5px rgba(0,0,0,0.3)",fontFamily:(null===De||void 0===De||null===(S=De.style)||void 0===S?void 0:S.font)||"inherit"},children:"Stop"})}),!ao&&so&&$e&&(0,Ee.jsxs)(u.A,{sx:{position:"absolute",bottom:16,right:16,width:"160px",height:"90px",borderRadius:"8px",overflow:"hidden",border:"2px solid",borderColor:"primary.main",backgroundColor:"#000",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[oo?(0,Ee.jsx)(Ue.fSl,{participant:$e,trackType:"videoTrack"}):(0,Ee.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Ee.jsx)(re.A,{sx:{fontSize:"1.5rem"}})}),(0,Ee.jsx)(p.A,{size:"small",onClick:Fo,sx:{position:"absolute",top:2,right:26,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:oo?(0,Ee.jsx)(oe.A,{sx:{fontSize:"0.9rem"}}):(0,Ee.jsx)(re.A,{sx:{fontSize:"0.9rem"}})}),(0,Ee.jsx)(p.A,{size:"small",onClick:()=>co(!0),sx:{position:"absolute",top:2,right:2,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Ee.jsx)(we.A,{sx:{fontSize:"0.9rem"}})})]})]})]}),Me&&(0,Ee.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ee.jsx)(v.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===De||void 0===De||null===(k=De.style)||void 0===k?void 0:k.font)||"inherit",color:(null===De||void 0===De||null===(R=De.style)||void 0===R?void 0:R.textColor)||"inherit"},children:"Shared Video"}),Oe&&(0,Ee.jsx)(h.A,{title:"Clear Shared Video",children:(0,Ee.jsx)(p.A,{onClick:()=>We(),size:"small",sx:{color:(null===De||void 0===De||null===(E=De.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:(0,Ee.jsx)(me.A,{})})})]}),(0,Ee.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Le(Me)})]}),(0,Ee.jsx)(u.A,{sx:{mb:2,borderBottom:1,borderColor:"divider"},children:(0,Ee.jsxs)(G.A,{value:vo,onChange:(e,o)=>xo(o),"aria-label":"room content tabs",sx:{"& .MuiTab-root":{fontFamily:(null===De||void 0===De||null===(F=De.style)||void 0===F?void 0:F.font)||"inherit",color:(null===De||void 0===De||null===(U=De.style)||void 0===U?void 0:U.textColor)||"inherit",opacity:.7},"& .Mui-selected":{color:"".concat((null===De||void 0===De||null===(T=De.style)||void 0===T?void 0:T.accentColor)||_e.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===De||void 0===De||null===(D=De.style)||void 0===D?void 0:D.accentColor)||_e.palette.primary.main}},children:[(0,Ee.jsx)(N.A,{label:"Participants (".concat(Uo.length,")"),value:"participants"}),(0,Ee.jsx)(N.A,{label:"Chat",value:"chat",icon:(0,Ee.jsx)(_.A,{color:"primary",variant:"dot",invisible:"chat"===vo||0===go.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===De||void 0===De||null===(O=De.style)||void 0===O?void 0:O.accentColor)||_e.palette.primary.main}}}),iconPosition:"end"})]})}),"participants"===vo&&(0,Ee.jsxs)(Ee.Fragment,{children:[Uo.length>0&&(0,Ee.jsx)(Ue.ncL,{participants:Uo}),(0,Ee.jsx)(w.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Uo.map((e=>{const o=e.userId===De.ownerId;return(0,Ee.jsx)(w.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,Ee.jsx)(qe,{participant:e,isRoomOwner:Oe,isLocalParticipant:e.userId===(null===to||void 0===to?void 0:to.uid),localUserAuthData:to,onForceMuteToggle:Be,onForceRemove:Ge,onForceBan:Ne,call:Je,localUserIsMute:eo,isDesignatedHost:o,onPinToggle:Eo,isPinned:ho.includes(e.userId),roomStyle:null===De||void 0===De?void 0:De.style,navigate:Ve})},e.userId)}))}),0===Uo.length&&(0,Ee.jsx)(v.A,{sx:{width:"100%",textAlign:"center",color:null!==De&&void 0!==De&&null!==(H=De.style)&&void 0!==H&&H.textColor?(0,V.X4)(null===De||void 0===De||null===(z=De.style)||void 0===z?void 0:z.textColor,.7):_e.palette.text.secondary,mt:4,fontFamily:(null===De||void 0===De||null===(W=De.style)||void 0===W?void 0:W.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===vo&&(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==De&&void 0!==De&&null!==(M=De.style)&&void 0!==M&&M.accentColor?(0,V.X4)(null===De||void 0===De||null===(L=De.style)||void 0===L?void 0:L.accentColor,.3):_e.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Ee.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==De&&void 0!==De&&null!==(B=De.style)&&void 0!==B&&B.accentColor?(0,V.X4)(null===De||void 0===De||null===(J=De.style)||void 0===J?void 0:J.accentColor,.3):_e.palette.divider),bgcolor:null!==De&&void 0!==De&&null!==(Y=De.style)&&void 0!==Y&&Y.headerColor?(0,V.X4)(null===De||void 0===De||null===(Z=De.style)||void 0===Z?void 0:Z.headerColor,.1):(0,V.X4)(_e.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ee.jsxs)(v.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===De||void 0===De||null===(X=De.style)||void 0===X?void 0:X.font)||"inherit",color:(null===De||void 0===De||null===(q=De.style)||void 0===q?void 0:q.textColor)||"inherit"},children:["Users in Room (",Uo.length,")"]}),(0,Ee.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Uo.map((e=>{var o,r,t,n,i,s;const l=jo[e.userId],a=(null===l||void 0===l?void 0:l.username)||e.name||e.userId.substring(0,8),d=(null===l||void 0===l?void 0:l.avatar)||e.image;return(0,Ee.jsx)(P.A,{size:"small",label:a,avatar:(0,Ee.jsx)(x.A,{src:d,alt:a,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===De.ownerId?(0,V.X4)((null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.accentColor)||_e.palette.secondary.main,.1):(0,V.X4)((null===De||void 0===De||null===(r=De.style)||void 0===r?void 0:r.headerColor)||_e.palette.primary.main,.05),borderColor:e.userId===De.ownerId?(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.accentColor)||_e.palette.secondary.main:(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.headerColor)||_e.palette.primary.main,border:"1px solid",color:(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===De||void 0===De||null===(s=De.style)||void 0===s?void 0:s.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,Ee.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==De&&void 0!==De&&null!==(K=De.style)&&void 0!==K&&K.backgroundGradient?(0,V.X4)((null===De||void 0===De||null===(Q=De.style)||void 0===Q?void 0:Q.backgroundColor)||_e.palette.background.default,.3):(0,V.X4)(_e.palette.background.paper,.5)},children:0===go.length?(0,Ee.jsx)(v.A,{variant:"body2",color:null!==De&&void 0!==De&&null!==(ee=De.style)&&void 0!==ee&&ee.textColor?(0,V.X4)(null===De||void 0===De||null===(te=De.style)||void 0===te?void 0:te.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===De||void 0===De||null===(ne=De.style)||void 0===ne?void 0:ne.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,Ee.jsxs)(Ee.Fragment,{children:[go.map((e=>{var o,r,t,n,i,s,l,a,d,c,m;return(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:e.userId===(null===to||void 0===to?void 0:to.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===to||void 0===to?void 0:to.uid)&&(0,Ee.jsx)(x.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=jo[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,Ee.jsxs)(u.A,{children:[(0,Ee.jsx)(v.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(r=De.style)&&void 0!==r&&r.textColor?(0,V.X4)(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===to||void 0===to?void 0:to.uid)?"right":"left",fontFamily:(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.font)||"inherit"},children:e.userName}),(0,Ee.jsx)(j.A,{sx:{p:1,bgcolor:e.userId===(null===to||void 0===to?void 0:to.uid)?(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===to||void 0===to?void 0:to.uid)?null!==De&&void 0!==De&&null!==(s=De.style)&&void 0!==s&&s.accentColor?_e.palette.getContrastText(De.style.accentColor):"primary.contrastText":(null===De||void 0===De||null===(l=De.style)||void 0===l?void 0:l.textColor)||"text.primary",borderRadius:e.userId===(null===to||void 0===to?void 0:to.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===De||void 0===De||null===(a=De.style)||void 0===a?void 0:a.font)||"inherit"},children:(0,Ee.jsx)(v.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,Ee.jsx)(v.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(d=De.style)&&void 0!==d&&d.textColor?(0,V.X4)(null===De||void 0===De||null===(c=De.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===to||void 0===to?void 0:to.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===De||void 0===De||null===(m=De.style)||void 0===m?void 0:m.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,Ee.jsx)("div",{ref:Co})]})}),(0,Ee.jsx)(u.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==De&&void 0!==De&&null!==(ie=De.style)&&void 0!==ie&&ie.accentColor?(0,V.X4)(null===De||void 0===De||null===(se=De.style)||void 0===se?void 0:se.accentColor,.3):_e.palette.divider),bgcolor:(null===De||void 0===De||null===(de=De.style)||void 0===de?void 0:de.headerColor)||_e.palette.background.paper,display:"flex"},children:(0,Ee.jsx)(I.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:bo,onChange:e=>yo(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Ro())},InputProps:{sx:{fontFamily:(null===De||void 0===De||null===(ce=De.style)||void 0===ce?void 0:ce.font)||"inherit",color:(null===De||void 0===De||null===(pe=De.style)||void 0===pe?void 0:pe.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==De&&void 0!==De&&null!==(ve=De.style)&&void 0!==ve&&ve.accentColor?(0,V.X4)(null===De||void 0===De||null===(xe=De.style)||void 0===xe?void 0:xe.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==De&&void 0!==De&&null!==(ge=De.style)&&void 0!==ge&&ge.accentColor?(0,V.X4)(null===De||void 0===De||null===(fe=De.style)||void 0===fe?void 0:fe.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===De||void 0===De||null===(be=De.style)||void 0===be?void 0:be.accentColor)||_e.palette.primary.main}},endAdornment:(0,Ee.jsx)(p.A,{size:"small",onClick:Ro,disabled:!bo.trim(),color:"primary",sx:{color:(null===De||void 0===De||null===(ye=De.style)||void 0===ye?void 0:ye.accentColor)||"primary"},children:(0,Ee.jsx)(je.A,{fontSize:"small"})})}})})]})]}),(0,Ee.jsxs)(u.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(_e.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===De||void 0===De||null===(Ce=De.style)||void 0===Ce?void 0:Ce.headerColor)||_e.palette.background.paper},children:[(0,Ee.jsx)(y.A,{variant:"outlined",color:"error",startIcon:(0,Ee.jsx)(le.A,{}),onClick:()=>{null===Je||void 0===Je||Je.leave().then((()=>Ve("/side-rooms")))},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===De||void 0===De||null===(ke=De.style)||void 0===ke?void 0:ke.font)||"inherit"},children:"Leave quietly"}),Oe&&(0,Ee.jsx)(h.A,{title:eo?"Unmute Microphone":"Mute Microphone",children:(0,Ee.jsx)(p.A,{onClick:()=>null===Je||void 0===Je?void 0:Je.microphone.toggle(),color:eo?"default":"primary",sx:{ml:2,color:eo?"default":(null===De||void 0===De||null===(Re=De.style)||void 0===Re?void 0:Re.accentColor)||"primary.main"},disabled:!Je,children:eo?(0,Ee.jsx)(he.A,{}):(0,Ee.jsx)(ue.A,{})})}),Oe&&(0,Ee.jsx)(h.A,{title:oo?"Turn Camera Off":"Turn Camera On",children:(0,Ee.jsx)(p.A,{onClick:Fo,color:oo?"primary":"default",sx:{ml:1,color:oo?(null===De||void 0===De||null===(Ie=De.style)||void 0===Ie?void 0:Ie.accentColor)||"primary.main":"default"},disabled:!Je,children:oo?(0,Ee.jsx)(oe.A,{}):(0,Ee.jsx)(re.A,{})})}),Oe&&(0,Ee.jsx)(h.A,{title:so?"Hide Camera Window":"Show Camera Window",children:(0,Ee.jsx)(p.A,{onClick:()=>lo(!so),color:so?"primary":"default",sx:{ml:1,color:so?(null===De||void 0===De||null===(Fe=De.style)||void 0===Fe?void 0:Fe.accentColor)||"primary.main":"default"},disabled:!Je||!oo,children:(0,Ee.jsx)(Se.A,{})})}),Oe&&(0,Ee.jsx)(h.A,{title:"Share Video Link",children:(0,Ee.jsx)("span",{children:(0,Ee.jsx)(p.A,{onClick:()=>ze(),color:"secondary",sx:{ml:2,color:(null===De||void 0===De||null===(Pe=De.style)||void 0===Pe?void 0:Pe.accentColor)||_e.palette.secondary.main},children:(0,Ee.jsx)($.A,{})})})})]})]}):(0,Ee.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,Ee.jsx)(C.A,{}),(0,Ee.jsx)(v.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},qe=n.memo((e=>{let{participant:o,isRoomOwner:r,isLocalParticipant:t,onForceMuteToggle:i,onForceRemove:C,onForceBan:A,call:w,localUserAuthData:j,localUserIsMute:I,isDesignatedHost:F,onPinToggle:D,isPinned:O,roomStyle:H,navigate:z}=e;const W=(0,m.A)(),{isSpeaking:M,publishedTracks:L}=o,{blockUser:G,currentUser:N}=(0,l.As)(),_=!L.includes("audio")&&!M,[J,Y]=(0,n.useState)(null),Z=Boolean(J),X=e=>Y(e.currentTarget),q=()=>Y(null),K=async()=>{if(t&&w)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",I),await w.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),r&&null!==j&&void 0!==j&&j.uid){const e=w.cid,o=(0,d.aU)(),r=(0,d.H9)(o,"sideRooms",e),t=!w.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!t)),await(0,d.mZ)(r,{isLive:!t,lastActive:(0,d.O5)()})}}catch(e){console.error("[StreamParticipantCard] Error toggling local microphone:",e),c.oR.error("Failed to toggle microphone. See console.")}};let $,ee;const oe=o.custom;t&&j?($=j.displayName||j.email||o.userId,ee=j.photoURL||o.image||void 0):oe&&"string"===typeof oe.displayName&&""!==oe.displayName.trim()?($=oe.displayName,ee=oe.customAvatarUrl&&"string"===typeof oe.customAvatarUrl&&""!==oe.customAvatarUrl.trim()?oe.customAvatarUrl:o.image||void 0):($=o.name||o.userId,ee=o.image||void 0),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:r,isLocalParticipant:t,localUserAuthData:j}),console.log("[StreamParticipantCard] Determined values - displayName:",$,"avatarUrl:",ee,"isSpeaking:",M,"participantIsMuted:",_),t&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",j,"Stream participant.userId:",o.userId);const[re,ne]=(0,n.useState)(!1);return(0,Ee.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{const e=(0,Ee.jsx)(x.A,{src:ee,alt:$,sx:{width:64,height:64,mb:.5,border:M?"3px solid ".concat(W.palette.success.main):"2px solid ".concat((0,V.X4)(W.palette.divider,.5)),boxShadow:M?"0 0 8px ".concat(W.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer"}});return t?(0,Ee.jsx)(u.A,{onClick:K,sx:{cursor:"pointer"},children:e}):(0,Ee.jsx)(s.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:e})})(),F&&(0,Ee.jsx)(P.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(t?null===I||void 0===I||I:_)&&(0,Ee.jsx)(he.A,{sx:{fontSize:"1rem",color:W.palette.error.contrastText,backgroundColor:(0,V.X4)(W.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),t&&!I&&(0,Ee.jsx)(ue.A,{sx:{fontSize:"1rem",color:W.palette.success.contrastText,backgroundColor:(0,V.X4)(W.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,Ee.jsx)(v.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:W.palette.text.primary},children:$}),r&&!t&&(0,Ee.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Ee.jsx)(h.A,{title:"Manage User",children:(0,Ee.jsx)(p.A,{onClick:X,size:"small",sx:{backgroundColor:(0,V.X4)(W.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Ee.jsx)(te.A,{fontSize:"small"})})}),(0,Ee.jsxs)(g.A,{anchorEl:J,open:Z,onClose:q,MenuListProps:{dense:!0},children:[(0,Ee.jsxs)(f.A,{onClick:async()=>{q(),i&&i(o.userId,!o.publishedTracks.includes("audio"))},sx:{fontSize:"0.8rem"},children:[(0,Ee.jsx)(b.A,{sx:{minWidth:"30px"},children:_?(0,Ee.jsx)(ce.A,{fontSize:"small"}):(0,Ee.jsx)(ke.A,{fontSize:"small"})}),_?"Unmute":"Mute"]}),(0,Ee.jsxs)(f.A,{onClick:()=>{q(),D(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,Ee.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ee.jsx)(Re.A,{fontSize:"small",color:O?"primary":"inherit"})}),O?"Unpin from top":"Pin to top"]}),(0,Ee.jsxs)(f.A,{onClick:async()=>{if(q(),window.confirm("Are you sure you want to block ".concat(o.name||o.userId,"?")))try{await G(o.userId),c.oR.success("Blocked ".concat(o.name||o.userId)),C&&C(o.userId,o.name||o.userId)}catch(e){console.error("Error blocking user:",e),c.oR.error("Failed to block user")}},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ee.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ee.jsx)(Ie.A,{fontSize:"small",color:"error"})}),"Block"]})]})]}),!r&&!t&&(0,Ee.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Ee.jsx)(h.A,{title:"Options",children:(0,Ee.jsx)(p.A,{onClick:X,size:"small",sx:{backgroundColor:(0,V.X4)(W.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Ee.jsx)(te.A,{fontSize:"small"})})}),(0,Ee.jsx)(g.A,{anchorEl:J,open:Z,onClose:q,MenuListProps:{dense:!0},children:(0,Ee.jsxs)(f.A,{onClick:()=>{q(),ne(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Ee.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ee.jsx)(Q.A,{fontSize:"small",color:"warning"})}),"Report User"]})})]}),O&&!F&&(0,Ee.jsx)(h.A,{title:"Pinned",children:(0,Ee.jsx)(Re.A,{sx:{fontSize:"1rem",color:W.palette.primary.contrastText,backgroundColor:(0,V.X4)(W.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,Ee.jsxs)(S.A,{open:re,onClose:()=>ne(!1),children:[(0,Ee.jsx)(k.A,{children:"Report User"}),(0,Ee.jsxs)(R.A,{children:[(0,Ee.jsxs)(v.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,Ee.jsx)(U.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,Ee.jsx)(T.Ay,{onClick:()=>(async e=>{try{const r={reportedUserId:o.userId,reportedBy:null===N||void 0===N?void 0:N.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)(a.db,"reports"),r),c.oR.success("Report submitted for ".concat(o.name||o.userId)),ne(!1)}catch(r){console.error("Error submitting report:",r),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,V.X4)(W.palette.primary.main,.1)}},children:(0,Ee.jsx)(B.A,{primary:e})},e)))})]}),(0,Ee.jsx)(E.A,{children:(0,Ee.jsx)(y.A,{onClick:()=>ne(!1),children:"Cancel"})})]})]})}))}}]);