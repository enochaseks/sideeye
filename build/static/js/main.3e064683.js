/*! For license information please see main.3e064683.js.LICENSE.txt */
(()=>{var e={86:(e,t,n)=>{"use strict";function r(e,t){const n=this;if(n.vars&&"function"===typeof n.getColorSchemeSelector){const r=n.getColorSchemeSelector(e).replace(/(\[[^\]]+\])/,"*:where($1)");return{[r]:t}}return n.palette.mode===e?t:{}}n.d(t,{A:()=>r})},116:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalStyles:()=>w.A,StyledEngineProvider:()=>b,ThemeContext:()=>i.T,css:()=>v.AH,default:()=>S,internal_processStyles:()=>T,keyframes:()=>v.i7});var r=n(8168),i=n(7370),o=n(9015),s=n(6477),a=n(1783),c=n(9950),l=n(7923),u=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,d=(0,l.A)((function(e){return u.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),h=function(e){return"theme"!==e},p=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?d:h},f=function(e,t,n){var r;if(t){var i=t.shouldForwardProp;r=e.__emotion_forwardProp&&i?function(t){return e.__emotion_forwardProp(t)&&i(t)}:i}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},m=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return(0,a.SF)(t,n,r),(0,s.s)((function(){return(0,a.sk)(t,n,r)})),null},g=function e(t,n){var s,l,u=t.__emotion_real===t,d=u&&t.__emotion_base||t;void 0!==n&&(s=n.label,l=n.target);var h=f(t,n,u),g=h||p(d),v=!g("as");return function(){var y=arguments,_=u&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==s&&_.push("label:"+s+";"),null==y[0]||void 0===y[0].raw)_.push.apply(_,y);else{var E=y[0];_.push(E[0]);for(var b=y.length,w=1;w<b;w++)_.push(y[w],E[w])}var S=(0,i.w)((function(e,t,n){var r=v&&e.as||d,s="",u=[],f=e;if(null==e.theme){for(var y in f={},e)f[y]=e[y];f.theme=c.useContext(i.T)}"string"===typeof e.className?s=(0,a.Rk)(t.registered,u,e.className):null!=e.className&&(s=e.className+" ");var E=(0,o.J)(_.concat(u),t.registered,f);s+=t.key+"-"+E.name,void 0!==l&&(s+=" "+l);var b=v&&void 0===h?p(r):g,w={};for(var S in e)v&&"as"===S||b(S)&&(w[S]=e[S]);return w.className=s,n&&(w.ref=n),c.createElement(c.Fragment,null,c.createElement(m,{cache:t,serialized:E,isStringTag:"string"===typeof r}),c.createElement(r,w))}));return S.displayName=void 0!==s?s:"Styled("+("string"===typeof d?d:d.displayName||d.name||"Component")+")",S.defaultProps=t.defaultProps,S.__emotion_real=S,S.__emotion_base=d,S.__emotion_styles=_,S.__emotion_forwardProp=h,Object.defineProperty(S,"toString",{value:function(){return"."+l}}),S.withComponent=function(t,i){return e(t,(0,r.A)({},n,i,{shouldForwardProp:f(S,i,!0)})).apply(void 0,_)},S}}.bind(null);["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){g[e]=g(e)}));var v=n(8283),y=n(8603),_=n(4414);let E;function b(e){const{injectFirst:t,children:n}=e;return t&&E?(0,_.jsx)(i.C,{value:E,children:n}):n}"object"===typeof document&&(E=(0,y.A)({key:"css",prepend:!0}));var w=n(3158);function S(e,t){return g(e,t)}const T=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},185:function(e,t,n){var r,i,o;e=n.nmd(e),i=[],void 0===(o="function"===typeof(r=function(){"use strict";var t={},n=null;function r(t){if(e&&e.exports)try{return Object(function(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}())(t)}catch(i){}try{var r;return(self.crypto||self.msCrypto).getRandomValues(r=new Uint32Array(t)),Array.prototype.slice.call(r)}catch(i){}if(!n)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return n(t)}try{r(1)}catch(A){}function i(e,t){for(var n=0,r=0,i=0,o=e.length;i<o;++i)e.charCodeAt(i)===t.charCodeAt(i)?++n:++r;return!(n<0)&&0===r}n=null,t.setRandomFallback=function(e){n=e},t.genSaltSync=function(e,t){if("number"!==typeof(e=e||f))throw Error("Illegal arguments: "+typeof e+", "+typeof t);e<4?e=4:e>31&&(e=31);var n=[];return n.push("$2a$"),e<10&&n.push("0"),n.push(e.toString()),n.push("$"),n.push(u(r(p),p)),n.join("")},t.genSalt=function(e,n,r){if("function"===typeof n&&(r=n,n=void 0),"function"===typeof e&&(r=e,e=void 0),"undefined"===typeof e)e=f;else if("number"!==typeof e)throw Error("illegal arguments: "+typeof e);function i(n){o((function(){try{n(null,t.genSaltSync(e))}catch(r){n(r)}}))}if(!r)return new Promise((function(e,t){i((function(n,r){n?t(n):e(r)}))}));if("function"!==typeof r)throw Error("Illegal callback: "+typeof r);i(r)},t.hashSync=function(e,n){if("undefined"===typeof n&&(n=f),"number"===typeof n&&(n=t.genSaltSync(n)),"string"!==typeof e||"string"!==typeof n)throw Error("Illegal arguments: "+typeof e+", "+typeof n);return C(e,n)},t.hash=function(e,n,r,i){function s(r){"string"===typeof e&&"number"===typeof n?t.genSalt(n,(function(t,n){C(e,n,r,i)})):"string"===typeof e&&"string"===typeof n?C(e,n,r,i):o(r.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof n)))}if(!r)return new Promise((function(e,t){s((function(n,r){n?t(n):e(r)}))}));if("function"!==typeof r)throw Error("Illegal callback: "+typeof r);s(r)},t.compareSync=function(e,n){if("string"!==typeof e||"string"!==typeof n)throw Error("Illegal arguments: "+typeof e+", "+typeof n);return 60===n.length&&i(t.hashSync(e,n.substr(0,n.length-31)),n)},t.compare=function(e,n,r,s){function a(r){"string"===typeof e&&"string"===typeof n?60===n.length?t.hash(e,n.substr(0,29),(function(e,t){e?r(e):r(null,i(t,n))}),s):o(r.bind(this,null,!1)):o(r.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof n)))}if(!r)return new Promise((function(e,t){a((function(n,r){n?t(n):e(r)}))}));if("function"!==typeof r)throw Error("Illegal callback: "+typeof r);a(r)},t.getRounds=function(e){if("string"!==typeof e)throw Error("Illegal arguments: "+typeof e);return parseInt(e.split("$")[2],10)},t.getSalt=function(e){if("string"!==typeof e)throw Error("Illegal arguments: "+typeof e);if(60!==e.length)throw Error("Illegal hash length: "+e.length+" != 60");return e.substring(0,29)};var o="undefined"!==typeof process&&process&&"function"===typeof process.nextTick?"function"===typeof setImmediate?setImmediate:process.nextTick:setTimeout;function s(e){var t=[],n=0;return h.encodeUTF16toUTF8((function(){return n>=e.length?null:e.charCodeAt(n++)}),(function(e){t.push(e)})),t}var a="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),c=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1],l=String.fromCharCode;function u(e,t){var n,r,i=0,o=[];if(t<=0||t>e.length)throw Error("Illegal len: "+t);for(;i<t;){if(n=255&e[i++],o.push(a[n>>2&63]),n=(3&n)<<4,i>=t){o.push(a[63&n]);break}if(n|=(r=255&e[i++])>>4&15,o.push(a[63&n]),n=(15&r)<<2,i>=t){o.push(a[63&n]);break}n|=(r=255&e[i++])>>6&3,o.push(a[63&n]),o.push(a[63&r])}return o.join("")}function d(e,t){var n,r,i,o,s,a=0,u=e.length,d=0,h=[];if(t<=0)throw Error("Illegal len: "+t);for(;a<u-1&&d<t&&(n=(s=e.charCodeAt(a++))<c.length?c[s]:-1,r=(s=e.charCodeAt(a++))<c.length?c[s]:-1,-1!=n&&-1!=r)&&(o=n<<2>>>0,o|=(48&r)>>4,h.push(l(o)),!(++d>=t||a>=u))&&-1!=(i=(s=e.charCodeAt(a++))<c.length?c[s]:-1)&&(o=(15&r)<<4>>>0,o|=(60&i)>>2,h.push(l(o)),!(++d>=t||a>=u));)o=(3&i)<<6>>>0,o|=(s=e.charCodeAt(a++))<c.length?c[s]:-1,h.push(l(o)),++d;var p=[];for(a=0;a<d;a++)p.push(h[a].charCodeAt(0));return p}var h=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var n=null;for("number"===typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(n>>6&31|192),t(63&n|128)):n<65536?(t(n>>12&15|224),t(n>>6&63|128),t(63&n|128)):(t(n>>18&7|240),t(n>>12&63|128),t(n>>6&63|128),t(63&n|128)),n=null},decodeUTF8:function(e,t){for(var n,r,i,o,s=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(n=e());)if(0===(128&n))t(n);else if(192===(224&n))null===(r=e())&&s([n,r]),t((31&n)<<6|63&r);else if(224===(240&n))(null===(r=e())||null===(i=e()))&&s([n,r,i]),t((15&n)<<12|(63&r)<<6|63&i);else{if(240!==(248&n))throw RangeError("Illegal starting byte: "+n);(null===(r=e())||null===(i=e())||null===(o=e()))&&s([n,r,i,o]),t((7&n)<<18|(63&r)<<12|(63&i)<<6|63&o)}},UTF16toUTF8:function(e,t){for(var n,r=null;null!==(n=null!==r?r:e());)n>=55296&&n<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(n-55296)+r-56320+65536),r=null):t(n);null!==r&&t(r)},UTF8toUTF16:function(e,t){var n=null;for("number"===typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<=65535?t(n):(t(55296+((n-=65536)>>10)),t(n%1024+56320)),n=null},encodeUTF16toUTF8:function(t,n){e.UTF16toUTF8(t,(function(t){e.encodeUTF8(t,n)}))},decodeUTF8toUTF16:function(t,n){e.decodeUTF8(t,(function(t){e.UTF8toUTF16(t,n)}))},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(t){for(var n,r=0;null!==(n=t());)r+=e.calculateCodePoint(n);return r},calculateUTF16asUTF8:function(t){var n=0,r=0;return e.UTF16toUTF8(t,(function(t){++n,r+=e.calculateCodePoint(t)})),[n,r]}};return e}();Date.now=Date.now||function(){return+new Date};var p=16,f=10,m=16,g=100,v=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],y=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],_=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function E(e,t,n,r){var i,o=e[t],s=e[t+1];return i=r[(o^=n[0])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[1])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[2])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[3])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[4])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[5])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[6])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[7])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[8])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[9])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[10])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[11])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[12])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[13])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],i=r[(o^=(i+=r[768|255&s])^n[14])>>>24],i+=r[256|o>>16&255],i^=r[512|o>>8&255],i=r[(s^=(i+=r[768|255&o])^n[15])>>>24],i+=r[256|s>>16&255],i^=r[512|s>>8&255],o^=(i+=r[768|255&s])^n[16],e[t]=s^n[m+1],e[t+1]=o,e}function b(e,t){for(var n=0,r=0;n<4;++n)r=r<<8|255&e[t],t=(t+1)%e.length;return{key:r,offp:t}}function w(e,t,n){for(var r,i=0,o=[0,0],s=t.length,a=n.length,c=0;c<s;c++)i=(r=b(e,i)).offp,t[c]=t[c]^r.key;for(c=0;c<s;c+=2)o=E(o,0,t,n),t[c]=o[0],t[c+1]=o[1];for(c=0;c<a;c+=2)o=E(o,0,t,n),n[c]=o[0],n[c+1]=o[1]}function S(e,t,n,r){for(var i,o=0,s=[0,0],a=n.length,c=r.length,l=0;l<a;l++)o=(i=b(t,o)).offp,n[l]=n[l]^i.key;for(o=0,l=0;l<a;l+=2)o=(i=b(e,o)).offp,s[0]^=i.key,o=(i=b(e,o)).offp,s[1]^=i.key,s=E(s,0,n,r),n[l]=s[0],n[l+1]=s[1];for(l=0;l<c;l+=2)o=(i=b(e,o)).offp,s[0]^=i.key,o=(i=b(e,o)).offp,s[1]^=i.key,s=E(s,0,n,r),r[l]=s[0],r[l+1]=s[1]}function T(e,t,n,r,i){var s,a=_.slice(),c=a.length;if(n<4||n>31){if(s=Error("Illegal number of rounds (4-31): "+n),r)return void o(r.bind(this,s));throw s}if(t.length!==p){if(s=Error("Illegal salt length: "+t.length+" != "+p),r)return void o(r.bind(this,s));throw s}n=1<<n>>>0;var l,u,d,h=0;function f(){if(i&&i(h/n),!(h<n)){for(h=0;h<64;h++)for(d=0;d<c>>1;d++)E(a,d<<1,l,u);var s=[];for(h=0;h<c;h++)s.push((a[h]>>24&255)>>>0),s.push((a[h]>>16&255)>>>0),s.push((a[h]>>8&255)>>>0),s.push((255&a[h])>>>0);return r?void r(null,s):s}for(var p=Date.now();h<n&&(h+=1,w(e,l,u),w(t,l,u),!(Date.now()-p>g)););r&&o(f)}if(Int32Array?(l=new Int32Array(v),u=new Int32Array(y)):(l=v.slice(),u=y.slice()),S(t,e,l,u),"undefined"!==typeof r)f();else for(var m;;)if("undefined"!==typeof(m=f()))return m||[]}function C(e,t,n,r){var i,a,c;if("string"!==typeof e||"string"!==typeof t){if(i=Error("Invalid string / salt: Not a string"),n)return void o(n.bind(this,i));throw i}if("$"!==t.charAt(0)||"2"!==t.charAt(1)){if(i=Error("Invalid salt version: "+t.substring(0,2)),n)return void o(n.bind(this,i));throw i}if("$"===t.charAt(2))a=String.fromCharCode(0),c=3;else{if("a"!==(a=t.charAt(2))&&"b"!==a&&"y"!==a||"$"!==t.charAt(3)){if(i=Error("Invalid salt revision: "+t.substring(2,4)),n)return void o(n.bind(this,i));throw i}c=4}if(t.charAt(c+2)>"$"){if(i=Error("Missing salt rounds"),n)return void o(n.bind(this,i));throw i}var l=10*parseInt(t.substring(c,c+1),10)+parseInt(t.substring(c+1,c+2),10),h=t.substring(c+3,c+25),f=s(e+=a>="a"?"\0":""),m=d(h,p);function g(e){var t=[];return t.push("$2"),a>="a"&&t.push(a),t.push("$"),l<10&&t.push("0"),t.push(l.toString()),t.push("$"),t.push(u(m,m.length)),t.push(u(e,4*_.length-1)),t.join("")}if("undefined"==typeof n)return g(T(f,m,l));T(f,m,l,(function(e,t){e?n(e,null):n(null,g(t))}),r)}return t.encodeBase64=u,t.decodeBase64=d,t})?r.apply(t,i):r)||(e.exports=o)},195:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=(0,n(4436).A)()},237:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var r=n(8168),i=n(8587),o=n(7483),s=n(8076);const a=["sx"],c=e=>{var t,n;const r={systemProps:{},otherProps:{}},i=null!=(t=null==e||null==(n=e.theme)?void 0:n.unstable_sxConfig)?t:s.A;return Object.keys(e).forEach((t=>{i[t]?r.systemProps[t]=e[t]:r.otherProps[t]=e[t]})),r};function l(e){const{sx:t}=e,n=(0,i.A)(e,a),{systemProps:s,otherProps:l}=c(n);let u;return u=Array.isArray(t)?[s,...t]:"function"===typeof t?function(){const e=t(...arguments);return(0,o.Q)(e)?(0,r.A)({},s,e):s}:(0,r.A)({},s,t),(0,r.A)({},l,{sx:u})}},304:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.A});var r=n(5501)},423:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o});var r=n(4501);const i={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const o=i[t];return o?`${n}-${o}`:`${r.A.generate(e)}-${t}`}},505:(e,t,n)=>{"use strict";n.d(t,{A:()=>u,k:()=>c});var r=n(5501),i=n(6206),o=n(2703),s=n(8286),a=n(8076);function c(){function e(e,t,n,i){const a={[e]:t,theme:n},c=i[e];if(!c)return{[e]:t};const{cssProperty:l=e,themeKey:u,transform:d,style:h}=c;if(null==t)return null;if("typography"===u&&"inherit"===t)return{[e]:t};const p=(0,o.Yn)(n,u)||{};if(h)return h(a);return(0,s.NI)(a,t,(t=>{let n=(0,o.BO)(p,d,t);return t===n&&"string"===typeof t&&(n=(0,o.BO)(p,d,`${e}${"default"===t?"":(0,r.A)(t)}`,t)),!1===l?n:{[l]:n}}))}return function t(n){var r;const{sx:o,theme:c={}}=n||{};if(!o)return null;const l=null!=(r=c.unstable_sxConfig)?r:a.A;function u(n){let r=n;if("function"===typeof n)r=n(c);else if("object"!==typeof n)return n;if(!r)return null;const o=(0,s.EU)(c.breakpoints),a=Object.keys(o);let u=o;return Object.keys(r).forEach((n=>{const o=(a=r[n],d=c,"function"===typeof a?a(d):a);var a,d;if(null!==o&&void 0!==o)if("object"===typeof o)if(l[n])u=(0,i.A)(u,e(n,o,c,l));else{const e=(0,s.NI)({theme:c},o,(e=>({[n]:e})));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>e.concat(Object.keys(t))),[]),i=new Set(r);return t.every((e=>i.size===Object.keys(e).length))}(e,o)?u=(0,i.A)(u,e):u[n]=t({sx:o,theme:c})}else u=(0,i.A)(u,e(n,o,c,l))})),(0,s.vf)(a,u)}return Array.isArray(o)?o.map(u):u(o)}}const l=c();l.filterProps=["sx"];const u=l},560:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i=function(e){try{return!!e()}catch(e){return!0}},o=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),s=o,a=Function.prototype,c=a.call,l=s&&a.bind.bind(c,c),u=s?l:function(e){return function(){return c.apply(e,arguments)}},d=u({}.isPrototypeOf),h=function(e){return e&&e.Math==Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||function(){return this}()||t||Function("return this")(),f=o,m=Function.prototype,g=m.apply,v=m.call,y="object"==typeof Reflect&&Reflect.apply||(f?v.bind(g):function(){return v.apply(g,arguments)}),_=u,E=_({}.toString),b=_("".slice),w=function(e){return b(E(e),8,-1)},S=w,T=u,C=function(e){if("Function"===S(e))return T(e)},A="object"==typeof document&&document.all,R={all:A,IS_HTMLDDA:void 0===A&&void 0!==A},I=R.all,x=R.IS_HTMLDDA?function(e){return"function"==typeof e||e===I}:function(e){return"function"==typeof e},O={},k=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),N=o,P=Function.prototype.call,D=N?P.bind(P):function(){return P.apply(P,arguments)},L={},M={}.propertyIsEnumerable,j=Object.getOwnPropertyDescriptor,U=j&&!M.call({1:2},1);L.f=U?function(e){var t=j(this,e);return!!t&&t.enumerable}:M;var V,F,B=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},W=i,z=w,H=Object,G=u("".split),q=W((function(){return!H("z").propertyIsEnumerable(0)}))?function(e){return"String"==z(e)?G(e,""):H(e)}:H,K=function(e){return null==e},$=K,Y=TypeError,X=function(e){if($(e))throw Y("Can't call method on "+e);return e},J=q,Q=X,Z=function(e){return J(Q(e))},ee=x,te=R.all,ne=R.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:ee(e)||e===te}:function(e){return"object"==typeof e?null!==e:ee(e)},re={},ie=re,oe=p,se=x,ae=function(e){return se(e)?e:void 0},ce=function(e,t){return arguments.length<2?ae(ie[e])||ae(oe[e]):ie[e]&&ie[e][t]||oe[e]&&oe[e][t]},le="undefined"!=typeof navigator&&String(navigator.userAgent)||"",ue=p,de=le,he=ue.process,pe=ue.Deno,fe=he&&he.versions||pe&&pe.version,me=fe&&fe.v8;me&&(F=(V=me.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&de&&(!(V=de.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=de.match(/Chrome\/(\d+)/))&&(F=+V[1]);var ge=F,ve=ge,ye=i,_e=p.String,Ee=!!Object.getOwnPropertySymbols&&!ye((function(){var e=Symbol();return!_e(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ve&&ve<41})),be=Ee&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,we=ce,Se=x,Te=d,Ce=Object,Ae=be?function(e){return"symbol"==typeof e}:function(e){var t=we("Symbol");return Se(t)&&Te(t.prototype,Ce(e))},Re=String,Ie=function(e){try{return Re(e)}catch(e){return"Object"}},xe=x,Oe=Ie,ke=TypeError,Ne=function(e){if(xe(e))return e;throw ke(Oe(e)+" is not a function")},Pe=Ne,De=K,Le=function(e,t){var n=e[t];return De(n)?void 0:Pe(n)},Me=D,je=x,Ue=ne,Ve=TypeError,Fe={exports:{}},Be=p,We=Object.defineProperty,ze=function(e,t){try{We(Be,e,{value:t,configurable:!0,writable:!0})}catch(r){Be[e]=t}return t},He="__core-js_shared__",Ge=p[He]||ze(He,{}),qe=Ge;(Fe.exports=function(e,t){return qe[e]||(qe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ke=Fe.exports,$e=X,Ye=Object,Xe=function(e){return Ye($e(e))},Je=Xe,Qe=u({}.hasOwnProperty),Ze=Object.hasOwn||function(e,t){return Qe(Je(e),t)},et=u,tt=0,nt=Math.random(),rt=et(1..toString),it=function(e){return"Symbol("+(void 0===e?"":e)+")_"+rt(++tt+nt,36)},ot=Ke,st=Ze,at=it,ct=Ee,lt=be,ut=p.Symbol,dt=ot("wks"),ht=lt?ut.for||ut:ut&&ut.withoutSetter||at,pt=function(e){return st(dt,e)||(dt[e]=ct&&st(ut,e)?ut[e]:ht("Symbol."+e)),dt[e]},ft=D,mt=ne,gt=Ae,vt=Le,yt=function(e,t){var n,r;if("string"===t&&je(n=e.toString)&&!Ue(r=Me(n,e)))return r;if(je(n=e.valueOf)&&!Ue(r=Me(n,e)))return r;if("string"!==t&&je(n=e.toString)&&!Ue(r=Me(n,e)))return r;throw Ve("Can't convert object to primitive value")},_t=TypeError,Et=pt("toPrimitive"),bt=function(e,t){if(!mt(e)||gt(e))return e;var n,r=vt(e,Et);if(r){if(void 0===t&&(t="default"),n=ft(r,e,t),!mt(n)||gt(n))return n;throw _t("Can't convert object to primitive value")}return void 0===t&&(t="number"),yt(e,t)},wt=Ae,St=function(e){var t=bt(e,"string");return wt(t)?t:t+""},Tt=ne,Ct=p.document,At=Tt(Ct)&&Tt(Ct.createElement),Rt=function(e){return At?Ct.createElement(e):{}},It=Rt,xt=!k&&!i((function(){return 7!=Object.defineProperty(It("div"),"a",{get:function(){return 7}}).a})),Ot=k,kt=D,Nt=L,Pt=B,Dt=Z,Lt=St,Mt=Ze,jt=xt,Ut=Object.getOwnPropertyDescriptor;O.f=Ot?Ut:function(e,t){if(e=Dt(e),t=Lt(t),jt)try{return Ut(e,t)}catch(e){}if(Mt(e,t))return Pt(!kt(Nt.f,e,t),e[t])};var Vt=i,Ft=x,Bt=/#|\.prototype\./,Wt=function(e,t){var n=Ht[zt(e)];return n==qt||n!=Gt&&(Ft(t)?Vt(t):!!t)},zt=Wt.normalize=function(e){return String(e).replace(Bt,".").toLowerCase()},Ht=Wt.data={},Gt=Wt.NATIVE="N",qt=Wt.POLYFILL="P",Kt=Wt,$t=Ne,Yt=o,Xt=C(C.bind),Jt=function(e,t){return $t(e),void 0===t?e:Yt?Xt(e,t):function(){return e.apply(t,arguments)}},Qt={},Zt=k&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),en=ne,tn=String,nn=TypeError,rn=function(e){if(en(e))return e;throw nn(tn(e)+" is not an object")},on=k,sn=xt,an=Zt,cn=rn,ln=St,un=TypeError,dn=Object.defineProperty,hn=Object.getOwnPropertyDescriptor,pn="enumerable",fn="configurable",mn="writable";Qt.f=on?an?function(e,t,n){if(cn(e),t=ln(t),cn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&mn in n&&!n[mn]){var r=hn(e,t);r&&r[mn]&&(e[t]=n.value,n={configurable:fn in n?n[fn]:r[fn],enumerable:pn in n?n[pn]:r[pn],writable:!1})}return dn(e,t,n)}:dn:function(e,t,n){if(cn(e),t=ln(t),cn(n),sn)try{return dn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw un("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var gn=Qt,vn=B,yn=k?function(e,t,n){return gn.f(e,t,vn(1,n))}:function(e,t,n){return e[t]=n,e},_n=p,En=y,bn=C,wn=x,Sn=O.f,Tn=Kt,Cn=re,An=Jt,Rn=yn,In=Ze,xn=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return En(e,this,arguments)};return t.prototype=e.prototype,t},On=function(e,t){var n,r,i,o,s,a,c,l,u,d=e.target,h=e.global,p=e.stat,f=e.proto,m=h?_n:p?_n[d]:(_n[d]||{}).prototype,g=h?Cn:Cn[d]||Rn(Cn,d,{})[d],v=g.prototype;for(o in t)r=!(n=Tn(h?o:d+(p?".":"#")+o,e.forced))&&m&&In(m,o),a=g[o],r&&(c=e.dontCallGetSet?(u=Sn(m,o))&&u.value:m[o]),s=r&&c?c:t[o],r&&typeof a==typeof s||(l=e.bind&&r?An(s,_n):e.wrap&&r?xn(s):f&&wn(s)?bn(s):s,(e.sham||s&&s.sham||a&&a.sham)&&Rn(l,"sham",!0),Rn(g,o,l),f&&(In(Cn,i=d+"Prototype")||Rn(Cn,i,{}),Rn(Cn[i],o,s),e.real&&v&&(n||!v[o])&&Rn(v,o,s)))},kn=Math.ceil,Nn=Math.floor,Pn=Math.trunc||function(e){var t=+e;return(t>0?Nn:kn)(t)},Dn=Pn,Ln=function(e){var t=+e;return t!=t||0===t?0:Dn(t)},Mn=Ln,jn=Math.max,Un=Math.min,Vn=function(e,t){var n=Mn(e);return n<0?jn(n+t,0):Un(n,t)},Fn=Ln,Bn=Math.min,Wn=function(e){return e>0?Bn(Fn(e),9007199254740991):0},zn=Wn,Hn=function(e){return zn(e.length)},Gn=Z,qn=Vn,Kn=Hn,$n=function(e){return function(t,n,r){var i,o=Gn(t),s=Kn(o),a=qn(r,s);if(e&&n!=n){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===n)return e||a||0;return!e&&-1}},Yn={includes:$n(!0),indexOf:$n(!1)},Xn=Yn.includes;On({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return Xn(this,e,arguments.length>1?arguments[1]:void 0)}});var Jn=re,Qn=function(e){return Jn[e+"Prototype"]},Zn=Qn("Array").includes,er=ne,tr=w,nr=pt("match"),rr=function(e){var t;return er(e)&&(void 0!==(t=e[nr])?!!t:"RegExp"==tr(e))},ir=rr,or=TypeError,sr={};sr[pt("toStringTag")]="z";var ar="[object z]"===String(sr),cr=ar,lr=x,ur=w,dr=pt("toStringTag"),hr=Object,pr="Arguments"==ur(function(){return arguments}()),fr=cr?ur:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=hr(e),dr))?n:pr?ur(t):"Object"==(r=ur(t))&&lr(t.callee)?"Arguments":r},mr=fr,gr=String,vr=function(e){if("Symbol"===mr(e))throw TypeError("Cannot convert a Symbol value to a string");return gr(e)},yr=pt("match"),_r=On,Er=function(e){if(ir(e))throw or("The method doesn't accept regular expressions");return e},br=X,wr=vr,Sr=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[yr]=!1,"/./"[e](t)}catch(e){}}return!1},Tr=u("".indexOf);_r({target:"String",proto:!0,forced:!Sr("includes")},{includes:function(e){return!!~Tr(wr(br(this)),wr(Er(e)),arguments.length>1?arguments[1]:void 0)}});var Cr=Qn("String").includes,Ar=d,Rr=Zn,Ir=Cr,xr=Array.prototype,Or=String.prototype,kr=function(e){var t=e.includes;return e===xr||Ar(xr,e)&&t===xr.includes?Rr:"string"==typeof e||e===Or||Ar(Or,e)&&t===Or.includes?Ir:t},Nr=r(kr),Pr=Ne,Dr=Xe,Lr=q,Mr=Hn,jr=TypeError,Ur=function(e){return function(t,n,r,i){Pr(n);var o=Dr(t),s=Lr(o),a=Mr(o),c=e?a-1:0,l=e?-1:1;if(r<2)for(;;){if(c in s){i=s[c],c+=l;break}if(c+=l,e?c<0:a<=c)throw jr("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=l)c in s&&(i=n(i,s[c],c,o));return i}},Vr={left:Ur(!1),right:Ur(!0)},Fr=i,Br=function(e,t){var n=[][e];return!!n&&Fr((function(){n.call(null,t||function(){return 1},1)}))},Wr="undefined"!=typeof process&&"process"==w(process),zr=Vr.left;On({target:"Array",proto:!0,forced:!Wr&&ge>79&&ge<83||!Br("reduce")},{reduce:function(e){var t=arguments.length;return zr(this,e,t,t>1?arguments[1]:void 0)}});var Hr=Qn("Array").reduce,Gr=d,qr=Hr,Kr=Array.prototype,$r=function(e){var t=e.reduce;return e===Kr||Gr(Kr,e)&&t===Kr.reduce?qr:t},Yr=$r,Xr=r(Yr),Jr=w,Qr=Array.isArray||function(e){return"Array"==Jr(e)},Zr=On,ei=Qr,ti=u([].reverse),ni=[1,2];Zr({target:"Array",proto:!0,forced:String(ni)===String(ni.reverse())},{reverse:function(){return ei(this)&&(this.length=this.length),ti(this)}});var ri=Qn("Array").reverse,ii=d,oi=ri,si=Array.prototype,ai=function(e){var t=e.reverse;return e===si||ii(si,e)&&t===si.reverse?oi:t},ci=ai,li=r(ci),ui=it,di=Ke("keys"),hi=function(e){return di[e]||(di[e]=ui(e))},pi=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),fi=Ze,mi=x,gi=Xe,vi=pi,yi=hi("IE_PROTO"),_i=Object,Ei=_i.prototype,bi=vi?_i.getPrototypeOf:function(e){var t=gi(e);if(fi(t,yi))return t[yi];var n=t.constructor;return mi(n)&&t instanceof n?n.prototype:t instanceof _i?Ei:null},wi=u,Si=Ne,Ti=x,Ci=String,Ai=TypeError,Ri=function(e,t,n){try{return wi(Si(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Ii=rn,xi=function(e){if("object"==typeof e||Ti(e))return e;throw Ai("Can't set "+Ci(e)+" as a prototype")},Oi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Ri(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ii(n),xi(r),t?e(n,r):n.__proto__=r,n}}():void 0),ki={},Ni={},Pi=Ze,Di=Z,Li=Yn.indexOf,Mi=Ni,ji=u([].push),Ui=function(e,t){var n,r=Di(e),i=0,o=[];for(n in r)!Pi(Mi,n)&&Pi(r,n)&&ji(o,n);for(;t.length>i;)Pi(r,n=t[i++])&&(~Li(o,n)||ji(o,n));return o},Vi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Fi=Ui,Bi=Vi.concat("length","prototype");ki.f=Object.getOwnPropertyNames||function(e){return Fi(e,Bi)};var Wi={};Wi.f=Object.getOwnPropertySymbols;var zi=ce,Hi=ki,Gi=Wi,qi=rn,Ki=u([].concat),$i=zi("Reflect","ownKeys")||function(e){var t=Hi.f(qi(e)),n=Gi.f;return n?Ki(t,n(e)):t},Yi=Ze,Xi=$i,Ji=O,Qi=Qt,Zi={},eo=Ui,to=Vi,no=Object.keys||function(e){return eo(e,to)},ro=k,io=Zt,oo=Qt,so=rn,ao=Z,co=no;Zi.f=ro&&!io?Object.defineProperties:function(e,t){so(e);for(var n,r=ao(t),i=co(t),o=i.length,s=0;o>s;)oo.f(e,n=i[s++],r[n]);return e};var lo,uo=ce("document","documentElement"),ho=rn,po=Zi,fo=Vi,mo=Ni,go=uo,vo=Rt,yo="prototype",_o="script",Eo=hi("IE_PROTO"),bo=function(){},wo=function(e){return"<"+_o+">"+e+"</"+_o+">"},So=function(e){e.write(wo("")),e.close();var t=e.parentWindow.Object;return e=null,t},To=function(){try{lo=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;To="undefined"!=typeof document?document.domain&&lo?So(lo):(t=vo("iframe"),n="java"+_o+":",t.style.display="none",go.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(wo("document.F=Object")),e.close(),e.F):So(lo);for(var r=fo.length;r--;)delete To[yo][fo[r]];return To()};mo[Eo]=!0;var Co=Object.create||function(e,t){var n;return null!==e?(bo[yo]=ho(e),n=new bo,bo[yo]=null,n[Eo]=e):n=To(),void 0===t?n:po.f(n,t)},Ao=ne,Ro=yn,Io=Error,xo=u("".replace),Oo=String(Io("zxcasd").stack),ko=/\n\s*at [^:]*:[^\n]*/,No=ko.test(Oo),Po=B,Do=!i((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Po(1,7)),7!==e.stack)})),Lo=yn,Mo=function(e,t){if(No&&"string"==typeof e&&!Io.prepareStackTrace)for(;t--;)e=xo(e,ko,"");return e},jo=Do,Uo=Error.captureStackTrace,Vo={},Fo=Vo,Bo=pt("iterator"),Wo=Array.prototype,zo=function(e){return void 0!==e&&(Fo.Array===e||Wo[Bo]===e)},Ho=fr,Go=Le,qo=K,Ko=Vo,$o=pt("iterator"),Yo=function(e){if(!qo(e))return Go(e,$o)||Go(e,"@@iterator")||Ko[Ho(e)]},Xo=D,Jo=Ne,Qo=rn,Zo=Ie,es=Yo,ts=TypeError,ns=function(e,t){var n=arguments.length<2?es(e):t;if(Jo(n))return Qo(Xo(n,e));throw ts(Zo(e)+" is not iterable")},rs=D,is=rn,os=Le,ss=function(e,t,n){var r,i;is(e);try{if(!(r=os(e,"return"))){if("throw"===t)throw n;return n}r=rs(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return is(r),n},as=Jt,cs=D,ls=rn,us=Ie,ds=zo,hs=Hn,ps=d,fs=ns,ms=Yo,gs=ss,vs=TypeError,ys=function(e,t){this.stopped=e,this.result=t},_s=ys.prototype,Es=function(e,t,n){var r,i,o,s,a,c,l,u=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),m=as(t,u),g=function(e){return r&&gs(r,"normal",e),new ys(!0,e)},v=function(e){return d?(ls(e),f?m(e[0],e[1],g):m(e[0],e[1])):f?m(e,g):m(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(i=ms(e)))throw vs(us(e)+" is not iterable");if(ds(i)){for(o=0,s=hs(e);s>o;o++)if((a=v(e[o]))&&ps(_s,a))return a;return new ys(!1)}r=fs(e,i)}for(c=h?e.next:r.next;!(l=cs(c,r)).done;){try{a=v(l.value)}catch(e){gs(r,"throw",e)}if("object"==typeof a&&a&&ps(_s,a))return a}return new ys(!1)},bs=vr,ws=On,Ss=d,Ts=bi,Cs=Oi,As=function(e,t,n){for(var r=Xi(t),i=Qi.f,o=Ji.f,s=0;s<r.length;s++){var a=r[s];Yi(e,a)||n&&Yi(n,a)||i(e,a,o(t,a))}},Rs=Co,Is=yn,xs=B,Os=function(e,t){Ao(t)&&"cause"in t&&Ro(e,"cause",t.cause)},ks=function(e,t,n,r){jo&&(Uo?Uo(e,t):Lo(e,"stack",Mo(n,r)))},Ns=Es,Ps=function(e,t){return void 0===e?arguments.length<2?"":t:bs(e)},Ds=pt("toStringTag"),Ls=Error,Ms=[].push,js=function(e,t){var n,r=Ss(Us,this);Cs?n=Cs(Ls(),r?Ts(this):Us):(n=r?this:Rs(Us),Is(n,Ds,"Error")),void 0!==t&&Is(n,"message",Ps(t)),ks(n,js,n.stack,1),arguments.length>2&&Os(n,arguments[2]);var i=[];return Ns(e,Ms,{that:i}),Is(n,"errors",i),n};Cs?Cs(js,Ls):As(js,Ls,{name:!0});var Us=js.prototype=Rs(Ls.prototype,{constructor:xs(1,js),message:xs(1,""),name:xs(1,"AggregateError")});ws({global:!0,constructor:!0,arity:2},{AggregateError:js});var Vs,Fs,Bs,Ws=x,zs=p.WeakMap,Hs=Ws(zs)&&/native code/.test(String(zs)),Gs=p,qs=ne,Ks=yn,$s=Ze,Ys=Ge,Xs=hi,Js=Ni,Qs="Object already initialized",Zs=Gs.TypeError,ea=Gs.WeakMap;if(Hs||Ys.state){var ta=Ys.state||(Ys.state=new ea);ta.get=ta.get,ta.has=ta.has,ta.set=ta.set,Vs=function(e,t){if(ta.has(e))throw Zs(Qs);return t.facade=e,ta.set(e,t),t},Fs=function(e){return ta.get(e)||{}},Bs=function(e){return ta.has(e)}}else{var na=Xs("state");Js[na]=!0,Vs=function(e,t){if($s(e,na))throw Zs(Qs);return t.facade=e,Ks(e,na,t),t},Fs=function(e){return $s(e,na)?e[na]:{}},Bs=function(e){return $s(e,na)}}var ra,ia,oa,sa={set:Vs,get:Fs,has:Bs,enforce:function(e){return Bs(e)?Fs(e):Vs(e,{})},getterFor:function(e){return function(t){var n;if(!qs(t)||(n=Fs(t)).type!==e)throw Zs("Incompatible receiver, "+e+" required");return n}}},aa=k,ca=Ze,la=Function.prototype,ua=aa&&Object.getOwnPropertyDescriptor,da=ca(la,"name"),ha={EXISTS:da,PROPER:da&&"something"===function(){}.name,CONFIGURABLE:da&&(!aa||aa&&ua(la,"name").configurable)},pa=yn,fa=function(e,t,n,r){return r&&r.enumerable?e[t]=n:pa(e,t,n),e},ma=i,ga=x,va=ne,ya=Co,_a=bi,Ea=fa,ba=pt("iterator"),wa=!1;[].keys&&("next"in(oa=[].keys())?(ia=_a(_a(oa)))!==Object.prototype&&(ra=ia):wa=!0);var Sa=!va(ra)||ma((function(){var e={};return ra[ba].call(e)!==e}));ga((ra=Sa?{}:ya(ra))[ba])||Ea(ra,ba,(function(){return this}));var Ta={IteratorPrototype:ra,BUGGY_SAFARI_ITERATORS:wa},Ca=fr,Aa=ar?{}.toString:function(){return"[object "+Ca(this)+"]"},Ra=ar,Ia=Qt.f,xa=yn,Oa=Ze,ka=Aa,Na=pt("toStringTag"),Pa=function(e,t,n,r){if(e){var i=n?e:e.prototype;Oa(i,Na)||Ia(i,Na,{configurable:!0,value:t}),r&&!Ra&&xa(i,"toString",ka)}},Da=Ta.IteratorPrototype,La=Co,Ma=B,ja=Pa,Ua=Vo,Va=function(){return this},Fa=function(e,t,n,r){var i=t+" Iterator";return e.prototype=La(Da,{next:Ma(+!r,n)}),ja(e,i,!1,!0),Ua[i]=Va,e},Ba=On,Wa=D,za=Fa,Ha=bi,Ga=Pa,qa=fa,Ka=Vo,$a=Ta,Ya=ha.PROPER,Xa=$a.BUGGY_SAFARI_ITERATORS,Ja=pt("iterator"),Qa="keys",Za="values",ec="entries",tc=function(){return this},nc=function(e,t,n,r,i,o,s){za(n,t,r);var a,c,l,u=function(e){if(e===i&&m)return m;if(!Xa&&e in p)return p[e];switch(e){case Qa:case Za:case ec:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,p=e.prototype,f=p[Ja]||p["@@iterator"]||i&&p[i],m=!Xa&&f||u(i),g="Array"==t&&p.entries||f;if(g&&(a=Ha(g.call(new e)))!==Object.prototype&&a.next&&(Ga(a,d,!0,!0),Ka[d]=tc),Ya&&i==Za&&f&&f.name!==Za&&(h=!0,m=function(){return Wa(f,this)}),i)if(c={values:u(Za),keys:o?m:u(Qa),entries:u(ec)},s)for(l in c)(Xa||h||!(l in p))&&qa(p,l,c[l]);else Ba({target:t,proto:!0,forced:Xa||h},c);return s&&p[Ja]!==m&&qa(p,Ja,m,{name:i}),Ka[t]=m,c},rc=function(e,t){return{value:e,done:t}},ic=Z,oc=Vo,sc=sa;Qt.f;var ac=nc,cc=rc,lc="Array Iterator",uc=sc.set,dc=sc.getterFor(lc);ac(Array,"Array",(function(e,t){uc(this,{type:lc,target:ic(e),index:0,kind:t})}),(function(){var e=dc(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,cc(void 0,!0)):cc("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),oc.Arguments=oc.Array;var hc=Qt,pc=function(e,t,n){return hc.f(e,t,n)},fc=ce,mc=pc,gc=k,vc=pt("species"),yc=d,_c=TypeError,Ec=function(e,t){if(yc(t,e))return e;throw _c("Incorrect invocation")},bc=x,wc=Ge,Sc=u(Function.toString);bc(wc.inspectSource)||(wc.inspectSource=function(e){return Sc(e)});var Tc=wc.inspectSource,Cc=u,Ac=i,Rc=x,Ic=fr,xc=Tc,Oc=function(){},kc=[],Nc=ce("Reflect","construct"),Pc=/^\s*(?:class|function)\b/,Dc=Cc(Pc.exec),Lc=!Pc.exec(Oc),Mc=function(e){if(!Rc(e))return!1;try{return Nc(Oc,kc,e),!0}catch(e){return!1}},jc=function(e){if(!Rc(e))return!1;switch(Ic(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Lc||!!Dc(Pc,xc(e))}catch(e){return!0}};jc.sham=!0;var Uc,Vc,Fc,Bc,Wc=!Nc||Ac((function(){var e;return Mc(Mc.call)||!Mc(Object)||!Mc((function(){e=!0}))||e}))?jc:Mc,zc=Wc,Hc=Ie,Gc=TypeError,qc=rn,Kc=function(e){if(zc(e))return e;throw Gc(Hc(e)+" is not a constructor")},$c=K,Yc=pt("species"),Xc=function(e,t){var n,r=qc(e).constructor;return void 0===r||$c(n=qc(r)[Yc])?t:Kc(n)},Jc=u([].slice),Qc=TypeError,Zc=function(e,t){if(e<t)throw Qc("Not enough arguments");return e},el=/(?:ipad|iphone|ipod).*applewebkit/i.test(le),tl=p,nl=y,rl=Jt,il=x,ol=Ze,sl=i,al=uo,cl=Jc,ll=Rt,ul=Zc,dl=el,hl=Wr,pl=tl.setImmediate,fl=tl.clearImmediate,ml=tl.process,gl=tl.Dispatch,vl=tl.Function,yl=tl.MessageChannel,_l=tl.String,El=0,bl={},wl="onreadystatechange";sl((function(){Uc=tl.location}));var Sl=function(e){if(ol(bl,e)){var t=bl[e];delete bl[e],t()}},Tl=function(e){return function(){Sl(e)}},Cl=function(e){Sl(e.data)},Al=function(e){tl.postMessage(_l(e),Uc.protocol+"//"+Uc.host)};pl&&fl||(pl=function(e){ul(arguments.length,1);var t=il(e)?e:vl(e),n=cl(arguments,1);return bl[++El]=function(){nl(t,void 0,n)},Vc(El),El},fl=function(e){delete bl[e]},hl?Vc=function(e){ml.nextTick(Tl(e))}:gl&&gl.now?Vc=function(e){gl.now(Tl(e))}:yl&&!dl?(Bc=(Fc=new yl).port2,Fc.port1.onmessage=Cl,Vc=rl(Bc.postMessage,Bc)):tl.addEventListener&&il(tl.postMessage)&&!tl.importScripts&&Uc&&"file:"!==Uc.protocol&&!sl(Al)?(Vc=Al,tl.addEventListener("message",Cl,!1)):Vc=wl in ll("script")?function(e){al.appendChild(ll("script"))[wl]=function(){al.removeChild(this),Sl(e)}}:function(e){setTimeout(Tl(e),0)});var Rl={set:pl,clear:fl},Il=function(){this.head=null,this.tail=null};Il.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var xl,Ol,kl,Nl,Pl,Dl=Il,Ll=/ipad|iphone|ipod/i.test(le)&&"undefined"!=typeof Pebble,Ml=/web0s(?!.*chrome)/i.test(le),jl=p,Ul=Jt,Vl=O.f,Fl=Rl.set,Bl=Dl,Wl=el,zl=Ll,Hl=Ml,Gl=Wr,ql=jl.MutationObserver||jl.WebKitMutationObserver,Kl=jl.document,$l=jl.process,Yl=jl.Promise,Xl=Vl(jl,"queueMicrotask"),Jl=Xl&&Xl.value;if(!Jl){var Ql=new Bl,Zl=function(){var e,t;for(Gl&&(e=$l.domain)&&e.exit();t=Ql.get();)try{t()}catch(e){throw Ql.head&&xl(),e}e&&e.enter()};Wl||Gl||Hl||!ql||!Kl?!zl&&Yl&&Yl.resolve?((Nl=Yl.resolve(void 0)).constructor=Yl,Pl=Ul(Nl.then,Nl),xl=function(){Pl(Zl)}):Gl?xl=function(){$l.nextTick(Zl)}:(Fl=Ul(Fl,jl),xl=function(){Fl(Zl)}):(Ol=!0,kl=Kl.createTextNode(""),new ql(Zl).observe(kl,{characterData:!0}),xl=function(){kl.data=Ol=!Ol}),Jl=function(e){Ql.head||xl(),Ql.add(e)}}var eu=Jl,tu=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},nu=p.Promise,ru="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,iu=!ru&&!Wr&&"object"==typeof window&&"object"==typeof document,ou=p,su=nu,au=x,cu=Kt,lu=Tc,uu=pt,du=iu,hu=ru,pu=ge,fu=su&&su.prototype,mu=uu("species"),gu=!1,vu=au(ou.PromiseRejectionEvent),yu=cu("Promise",(function(){var e=lu(su),t=e!==String(su);if(!t&&66===pu)return!0;if(!fu.catch||!fu.finally)return!0;if(!pu||pu<51||!/native code/.test(e)){var n=new su((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[mu]=r,!(gu=n.then((function(){}))instanceof r))return!0}return!t&&(du||hu)&&!vu})),_u={CONSTRUCTOR:yu,REJECTION_EVENT:vu,SUBCLASSING:gu},Eu={},bu=Ne,wu=TypeError,Su=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw wu("Bad Promise constructor");t=e,n=r})),this.resolve=bu(t),this.reject=bu(n)};Eu.f=function(e){return new Su(e)};var Tu,Cu,Au=On,Ru=Wr,Iu=p,xu=D,Ou=fa,ku=Pa,Nu=function(e){var t=fc(e);gc&&t&&!t[vc]&&mc(t,vc,{configurable:!0,get:function(){return this}})},Pu=Ne,Du=x,Lu=ne,Mu=Ec,ju=Xc,Uu=Rl.set,Vu=eu,Fu=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},Bu=tu,Wu=Dl,zu=sa,Hu=nu,Gu=_u,qu=Eu,Ku="Promise",$u=Gu.CONSTRUCTOR,Yu=Gu.REJECTION_EVENT,Xu=zu.getterFor(Ku),Ju=zu.set,Qu=Hu&&Hu.prototype,Zu=Hu,ed=Qu,td=Iu.TypeError,nd=Iu.document,rd=Iu.process,id=qu.f,od=id,sd=!!(nd&&nd.createEvent&&Iu.dispatchEvent),ad="unhandledrejection",cd=function(e){var t;return!(!Lu(e)||!Du(t=e.then))&&t},ld=function(e,t){var n,r,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,l=e.reject,u=e.domain;try{a?(s||(2===t.rejection&&fd(t),t.rejection=1),!0===a?n=o:(u&&u.enter(),n=a(o),u&&(u.exit(),i=!0)),n===e.promise?l(td("Promise-chain cycle")):(r=cd(n))?xu(r,n,c,l):c(n)):l(o)}catch(e){u&&!i&&u.exit(),l(e)}},ud=function(e,t){e.notified||(e.notified=!0,Vu((function(){for(var n,r=e.reactions;n=r.get();)ld(n,e);e.notified=!1,t&&!e.rejection&&hd(e)})))},dd=function(e,t,n){var r,i;sd?((r=nd.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Iu.dispatchEvent(r)):r={promise:t,reason:n},!Yu&&(i=Iu["on"+e])?i(r):e===ad&&Fu("Unhandled promise rejection",n)},hd=function(e){xu(Uu,Iu,(function(){var t,n=e.facade,r=e.value;if(pd(e)&&(t=Bu((function(){Ru?rd.emit("unhandledRejection",r,n):dd(ad,n,r)})),e.rejection=Ru||pd(e)?2:1,t.error))throw t.value}))},pd=function(e){return 1!==e.rejection&&!e.parent},fd=function(e){xu(Uu,Iu,(function(){var t=e.facade;Ru?rd.emit("rejectionHandled",t):dd("rejectionhandled",t,e.value)}))},md=function(e,t,n){return function(r){e(t,r,n)}},gd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,ud(e,!0))},vd=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw td("Promise can't be resolved itself");var r=cd(t);r?Vu((function(){var n={done:!1};try{xu(r,t,md(vd,n,e),md(gd,n,e))}catch(t){gd(n,t,e)}})):(e.value=t,e.state=1,ud(e,!1))}catch(t){gd({done:!1},t,e)}}};$u&&(ed=(Zu=function(e){Mu(this,ed),Pu(e),xu(Tu,this);var t=Xu(this);try{e(md(vd,t),md(gd,t))}catch(e){gd(t,e)}}).prototype,(Tu=function(e){Ju(this,{type:Ku,done:!1,notified:!1,parent:!1,reactions:new Wu,rejection:!1,state:0,value:void 0})}).prototype=Ou(ed,"then",(function(e,t){var n=Xu(this),r=id(ju(this,Zu));return n.parent=!0,r.ok=!Du(e)||e,r.fail=Du(t)&&t,r.domain=Ru?rd.domain:void 0,0==n.state?n.reactions.add(r):Vu((function(){ld(r,n)})),r.promise})),Cu=function(){var e=new Tu,t=Xu(e);this.promise=e,this.resolve=md(vd,t),this.reject=md(gd,t)},qu.f=id=function(e){return e===Zu||void 0===e?new Cu(e):od(e)}),Au({global:!0,constructor:!0,wrap:!0,forced:$u},{Promise:Zu}),ku(Zu,Ku,!1,!0),Nu(Ku);var yd=pt("iterator"),_d=!1;try{var Ed=0,bd={next:function(){return{done:!!Ed++}},return:function(){_d=!0}};bd[yd]=function(){return this},Array.from(bd,(function(){throw 2}))}catch(e){}var wd=nu,Sd=function(e,t){if(!t&&!_d)return!1;var n=!1;try{var r={};r[yd]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Td=_u.CONSTRUCTOR||!Sd((function(e){wd.all(e).then(void 0,(function(){}))})),Cd=D,Ad=Ne,Rd=Eu,Id=tu,xd=Es;On({target:"Promise",stat:!0,forced:Td},{all:function(e){var t=this,n=Rd.f(t),r=n.resolve,i=n.reject,o=Id((function(){var n=Ad(t.resolve),o=[],s=0,a=1;xd(e,(function(e){var c=s++,l=!1;a++,Cd(n,t,e).then((function(e){l||(l=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise}});var Od=On,kd=_u.CONSTRUCTOR;nu&&nu.prototype,Od({target:"Promise",proto:!0,forced:kd,real:!0},{catch:function(e){return this.then(void 0,e)}});var Nd=D,Pd=Ne,Dd=Eu,Ld=tu,Md=Es;On({target:"Promise",stat:!0,forced:Td},{race:function(e){var t=this,n=Dd.f(t),r=n.reject,i=Ld((function(){var i=Pd(t.resolve);Md(e,(function(e){Nd(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var jd=D,Ud=Eu;On({target:"Promise",stat:!0,forced:_u.CONSTRUCTOR},{reject:function(e){var t=Ud.f(this);return jd(t.reject,void 0,e),t.promise}});var Vd=rn,Fd=ne,Bd=Eu,Wd=function(e,t){if(Vd(e),Fd(t)&&t.constructor===e)return t;var n=Bd.f(e);return(0,n.resolve)(t),n.promise},zd=On,Hd=nu,Gd=_u.CONSTRUCTOR,qd=Wd,Kd=ce("Promise"),$d=!Gd;zd({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return qd($d&&this===Kd?Hd:this,e)}});var Yd=D,Xd=Ne,Jd=Eu,Qd=tu,Zd=Es;On({target:"Promise",stat:!0,forced:Td},{allSettled:function(e){var t=this,n=Jd.f(t),r=n.resolve,i=n.reject,o=Qd((function(){var n=Xd(t.resolve),i=[],o=0,s=1;Zd(e,(function(e){var a=o++,c=!1;s++,Yd(n,t,e).then((function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--s||r(i))}),(function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--s||r(i))}))})),--s||r(i)}));return o.error&&i(o.value),n.promise}});var eh=D,th=Ne,nh=ce,rh=Eu,ih=tu,oh=Es,sh="No one promise resolved";On({target:"Promise",stat:!0,forced:Td},{any:function(e){var t=this,n=nh("AggregateError"),r=rh.f(t),i=r.resolve,o=r.reject,s=ih((function(){var r=th(t.resolve),s=[],a=0,c=1,l=!1;oh(e,(function(e){var u=a++,d=!1;c++,eh(r,t,e).then((function(e){d||l||(l=!0,i(e))}),(function(e){d||l||(d=!0,s[u]=e,--c||o(new n(s,sh)))}))})),--c||o(new n(s,sh))}));return s.error&&o(s.value),r.promise}});var ah=On,ch=nu,lh=i,uh=ce,dh=x,hh=Xc,ph=Wd,fh=ch&&ch.prototype;ah({target:"Promise",proto:!0,real:!0,forced:!!ch&&lh((function(){fh.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=hh(this,uh("Promise")),n=dh(e);return this.then(n?function(n){return ph(t,e()).then((function(){return n}))}:e,n?function(n){return ph(t,e()).then((function(){throw n}))}:e)}});var mh=u,gh=Ln,vh=vr,yh=X,_h=mh("".charAt),Eh=mh("".charCodeAt),bh=mh("".slice),wh=function(e){return function(t,n){var r,i,o=vh(yh(t)),s=gh(n),a=o.length;return s<0||s>=a?e?"":void 0:(r=Eh(o,s))<55296||r>56319||s+1===a||(i=Eh(o,s+1))<56320||i>57343?e?_h(o,s):r:e?bh(o,s,s+2):i-56320+(r-55296<<10)+65536}},Sh={codeAt:wh(!1),charAt:wh(!0)},Th=Sh.charAt,Ch=vr,Ah=sa,Rh=nc,Ih=rc,xh="String Iterator",Oh=Ah.set,kh=Ah.getterFor(xh);Rh(String,"String",(function(e){Oh(this,{type:xh,string:Ch(e),index:0})}),(function(){var e,t=kh(this),n=t.string,r=t.index;return r>=n.length?Ih(void 0,!0):(e=Th(n,r),t.index+=e.length,Ih(e,!1))}));var Nh=re.Promise,Ph={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Dh=p,Lh=fr,Mh=yn,jh=Vo,Uh=pt("toStringTag");for(var Vh in Ph){var Fh=Dh[Vh],Bh=Fh&&Fh.prototype;Bh&&Lh(Bh)!==Uh&&Mh(Bh,Uh,Vh),jh[Vh]=jh.Array}var Wh=Nh,zh=r(Wh),Hh=Qn("Array").values,Gh=fr,qh=Ze,Kh=d,$h=Hh,Yh=Array.prototype,Xh={DOMTokenList:!0,NodeList:!0},Jh=function(e){var t=e.values;return e===Yh||Kh(Yh,e)&&t===Yh.values||qh(Xh,Gh(e))?$h:t},Qh=r(Jh),Zh=i,ep=pt("iterator"),tp=!Zh((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[ep]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),np=fa,rp=St,ip=Qt,op=B,sp=function(e,t,n){var r=rp(t);r in e?ip.f(e,r,op(0,n)):e[r]=n},ap=Vn,cp=Hn,lp=sp,up=Array,dp=Math.max,hp=function(e,t,n){for(var r=cp(e),i=ap(t,r),o=ap(void 0===n?r:n,r),s=up(dp(o-i,0)),a=0;i<o;i++,a++)lp(s,a,e[i]);return s.length=a,s},pp=hp,fp=Math.floor,mp=function(e,t){var n=e.length,r=fp(n/2);return n<8?gp(e,t):vp(e,mp(pp(e,0,r),t),mp(pp(e,r),t),t)},gp=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},vp=function(e,t,n,r){for(var i=t.length,o=n.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?r(t[s],n[a])<=0?t[s++]:n[a++]:s<i?t[s++]:n[a++];return e},yp=mp,_p=On,Ep=p,bp=D,wp=u,Sp=k,Tp=tp,Cp=fa,Ap=pc,Rp=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:np(e,r,t[r],n);return e},Ip=Pa,xp=Fa,Op=sa,kp=Ec,Np=x,Pp=Ze,Dp=Jt,Lp=fr,Mp=rn,jp=ne,Up=vr,Vp=Co,Fp=B,Bp=ns,Wp=Yo,zp=Zc,Hp=yp,Gp=pt("iterator"),qp="URLSearchParams",Kp=qp+"Iterator",$p=Op.set,Yp=Op.getterFor(qp),Xp=Op.getterFor(Kp),Jp=Object.getOwnPropertyDescriptor,Qp=function(e){if(!Sp)return Ep[e];var t=Jp(Ep,e);return t&&t.value},Zp=Qp("fetch"),ef=Qp("Request"),tf=Qp("Headers"),nf=ef&&ef.prototype,rf=tf&&tf.prototype,of=Ep.RegExp,sf=Ep.TypeError,af=Ep.decodeURIComponent,cf=Ep.encodeURIComponent,lf=wp("".charAt),uf=wp([].join),df=wp([].push),hf=wp("".replace),pf=wp([].shift),ff=wp([].splice),mf=wp("".split),gf=wp("".slice),vf=/\+/g,yf=Array(4),_f=function(e){return yf[e-1]||(yf[e-1]=of("((?:%[\\da-f]{2}){"+e+"})","gi"))},Ef=function(e){try{return af(e)}catch(t){return e}},bf=function(e){var t=hf(e,vf," "),n=4;try{return af(t)}catch(e){for(;n;)t=hf(t,_f(n--),Ef);return t}},wf=/[!'()~]|%20/g,Sf={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Tf=function(e){return Sf[e]},Cf=function(e){return hf(cf(e),wf,Tf)},Af=xp((function(e,t){$p(this,{type:Kp,iterator:Bp(Yp(e).entries),kind:t})}),"Iterator",(function(){var e=Xp(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),Rf=function(e){this.entries=[],this.url=null,void 0!==e&&(jp(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===lf(e,0)?gf(e,1):e:Up(e)))};Rf.prototype={type:qp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,s,a,c=Wp(e);if(c)for(n=(t=Bp(e,c)).next;!(r=bp(n,t)).done;){if(o=(i=Bp(Mp(r.value))).next,(s=bp(o,i)).done||(a=bp(o,i)).done||!bp(o,i).done)throw sf("Expected sequence with length 2");df(this.entries,{key:Up(s.value),value:Up(a.value)})}else for(var l in e)Pp(e,l)&&df(this.entries,{key:l,value:Up(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=mf(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=mf(t,"="),df(this.entries,{key:bf(pf(n)),value:bf(uf(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],df(n,Cf(e.key)+"="+Cf(e.value));return uf(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var If=function(){kp(this,xf);var e=$p(this,new Rf(arguments.length>0?arguments[0]:void 0));Sp||(this.size=e.entries.length)},xf=If.prototype;if(Rp(xf,{append:function(e,t){var n=Yp(this);zp(arguments.length,2),df(n.entries,{key:Up(e),value:Up(t)}),Sp||this.length++,n.updateURL()},delete:function(e){for(var t=Yp(this),n=zp(arguments.length,1),r=t.entries,i=Up(e),o=n<2?void 0:arguments[1],s=void 0===o?o:Up(o),a=0;a<r.length;){var c=r[a];if(c.key!==i||void 0!==s&&c.value!==s)a++;else if(ff(r,a,1),void 0!==s)break}Sp||(this.size=r.length),t.updateURL()},get:function(e){var t=Yp(this).entries;zp(arguments.length,1);for(var n=Up(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Yp(this).entries;zp(arguments.length,1);for(var n=Up(e),r=[],i=0;i<t.length;i++)t[i].key===n&&df(r,t[i].value);return r},has:function(e){for(var t=Yp(this).entries,n=zp(arguments.length,1),r=Up(e),i=n<2?void 0:arguments[1],o=void 0===i?i:Up(i),s=0;s<t.length;){var a=t[s++];if(a.key===r&&(void 0===o||a.value===o))return!0}return!1},set:function(e,t){var n=Yp(this);zp(arguments.length,1);for(var r,i=n.entries,o=!1,s=Up(e),a=Up(t),c=0;c<i.length;c++)(r=i[c]).key===s&&(o?ff(i,c--,1):(o=!0,r.value=a));o||df(i,{key:s,value:a}),Sp||(this.size=i.length),n.updateURL()},sort:function(){var e=Yp(this);Hp(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Yp(this).entries,r=Dp(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new Af(this,"keys")},values:function(){return new Af(this,"values")},entries:function(){return new Af(this,"entries")}},{enumerable:!0}),Cp(xf,Gp,xf.entries,{name:"entries"}),Cp(xf,"toString",(function(){return Yp(this).serialize()}),{enumerable:!0}),Sp&&Ap(xf,"size",{get:function(){return Yp(this).entries.length},configurable:!0,enumerable:!0}),Ip(If,qp),_p({global:!0,constructor:!0,forced:!Tp},{URLSearchParams:If}),!Tp&&Np(tf)){var Of=wp(rf.has),kf=wp(rf.set),Nf=function(e){if(jp(e)){var t,n=e.body;if(Lp(n)===qp)return t=e.headers?new tf(e.headers):new tf,Of(t,"content-type")||kf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Vp(e,{body:Fp(0,Up(n)),headers:Fp(0,t)})}return e};if(Np(Zp)&&_p({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Zp(e,arguments.length>1?Nf(arguments[1]):{})}}),Np(ef)){var Pf=function(e){return kp(this,nf),new ef(e,arguments.length>1?Nf(arguments[1]):{})};nf.constructor=Pf,Pf.prototype=nf,_p({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Pf})}}var Df,Lf={URLSearchParams:If,getState:Yp},Mf=re.URLSearchParams,jf=k,Uf=u,Vf=D,Ff=i,Bf=no,Wf=Wi,zf=L,Hf=Xe,Gf=q,qf=Object.assign,Kf=Object.defineProperty,$f=Uf([].concat),Yf=!qf||Ff((function(){if(jf&&1!==qf({b:1},qf(Kf({},"a",{enumerable:!0,get:function(){Kf(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=qf({},e)[n]||Bf(qf({},t)).join("")!=r}))?function(e,t){for(var n=Hf(e),r=arguments.length,i=1,o=Wf.f,s=zf.f;r>i;)for(var a,c=Gf(arguments[i++]),l=o?$f(Bf(c),o(c)):Bf(c),u=l.length,d=0;u>d;)a=l[d++],jf&&!Vf(s,c,a)||(n[a]=c[a]);return n}:qf,Xf=rn,Jf=ss,Qf=Jt,Zf=D,em=Xe,tm=function(e,t,n,r){try{return r?t(Xf(n)[0],n[1]):t(n)}catch(t){Jf(e,"throw",t)}},nm=zo,rm=Wc,im=Hn,om=sp,sm=ns,am=Yo,cm=Array,lm=u,um=2147483647,dm=/[^\0-\u007E]/,hm=/[.\u3002\uFF0E\uFF61]/g,pm="Overflow: input needs wider integers to process",fm=RangeError,mm=lm(hm.exec),gm=Math.floor,vm=String.fromCharCode,ym=lm("".charCodeAt),_m=lm([].join),Em=lm([].push),bm=lm("".replace),wm=lm("".split),Sm=lm("".toLowerCase),Tm=function(e){return e+22+75*(e<26)},Cm=function(e,t,n){var r=0;for(e=n?gm(e/700):e>>1,e+=gm(e/t);e>455;)e=gm(e/35),r+=36;return gm(r+36*e/(e+38))},Am=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=ym(e,n++);if(i>=55296&&i<=56319&&n<r){var o=ym(e,n++);56320==(64512&o)?Em(t,((1023&i)<<10)+(1023&o)+65536):(Em(t,i),n--)}else Em(t,i)}return t}(e);var n,r,i=e.length,o=128,s=0,a=72;for(n=0;n<e.length;n++)(r=e[n])<128&&Em(t,vm(r));var c=t.length,l=c;for(c&&Em(t,"-");l<i;){var u=um;for(n=0;n<e.length;n++)(r=e[n])>=o&&r<u&&(u=r);var d=l+1;if(u-o>gm((um-s)/d))throw fm(pm);for(s+=(u-o)*d,o=u,n=0;n<e.length;n++){if((r=e[n])<o&&++s>um)throw fm(pm);if(r==o){for(var h=s,p=36;;){var f=p<=a?1:p>=a+26?26:p-a;if(h<f)break;var m=h-f,g=36-f;Em(t,vm(Tm(f+m%g))),h=gm(m/g),p+=36}Em(t,vm(Tm(h))),a=Cm(s,d,l==c),s=0,l++}}s++,o++}return _m(t,"")},Rm=On,Im=k,xm=tp,Om=p,km=Jt,Nm=u,Pm=fa,Dm=pc,Lm=Ec,Mm=Ze,jm=Yf,Um=function(e){var t=em(e),n=rm(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Qf(i,r>2?arguments[2]:void 0));var s,a,c,l,u,d,h=am(t),p=0;if(!h||this===cm&&nm(h))for(s=im(t),a=n?new this(s):cm(s);s>p;p++)d=o?i(t[p],p):t[p],om(a,p,d);else for(u=(l=sm(t,h)).next,a=n?new this:[];!(c=Zf(u,l)).done;p++)d=o?tm(l,i,[c.value,p],!0):c.value,om(a,p,d);return a.length=p,a},Vm=hp,Fm=Sh.codeAt,Bm=function(e){var t,n,r=[],i=wm(bm(Sm(e),hm,"."),".");for(t=0;t<i.length;t++)n=i[t],Em(r,mm(dm,n)?"xn--"+Am(n):n);return _m(r,".")},Wm=vr,zm=Pa,Hm=Zc,Gm=Lf,qm=sa,Km=qm.set,$m=qm.getterFor("URL"),Ym=Gm.URLSearchParams,Xm=Gm.getState,Jm=Om.URL,Qm=Om.TypeError,Zm=Om.parseInt,eg=Math.floor,tg=Math.pow,ng=Nm("".charAt),rg=Nm(/./.exec),ig=Nm([].join),og=Nm(1..toString),sg=Nm([].pop),ag=Nm([].push),cg=Nm("".replace),lg=Nm([].shift),ug=Nm("".split),dg=Nm("".slice),hg=Nm("".toLowerCase),pg=Nm([].unshift),fg="Invalid scheme",mg="Invalid host",gg="Invalid port",vg=/[a-z]/i,yg=/[\d+-.a-z]/i,_g=/\d/,Eg=/^0x/i,bg=/^[0-7]+$/,wg=/^\d+$/,Sg=/^[\da-f]+$/i,Tg=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Cg=/[\0\t\n\r #/:<>?@[\\\]^|]/,Ag=/^[\u0000-\u0020]+/,Rg=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Ig=/[\t\n\r]/g,xg=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)pg(t,e%256),e=eg(e/256);return ig(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=og(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Og={},kg=jm({},Og,{" ":1,'"':1,"<":1,">":1,"`":1}),Ng=jm({},kg,{"#":1,"?":1,"{":1,"}":1}),Pg=jm({},Ng,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Dg=function(e,t){var n=Fm(e,0);return n>32&&n<127&&!Mm(t,e)?e:encodeURIComponent(e)},Lg={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Mg=function(e,t){var n;return 2==e.length&&rg(vg,ng(e,0))&&(":"==(n=ng(e,1))||!t&&"|"==n)},jg=function(e){var t;return e.length>1&&Mg(dg(e,0,2))&&(2==e.length||"/"===(t=ng(e,2))||"\\"===t||"?"===t||"#"===t)},Ug=function(e){return"."===e||"%2e"===hg(e)},Vg={},Fg={},Bg={},Wg={},zg={},Hg={},Gg={},qg={},Kg={},$g={},Yg={},Xg={},Jg={},Qg={},Zg={},ev={},tv={},nv={},rv={},iv={},ov={},sv=function(e,t,n){var r,i,o,s=Wm(e);if(t){if(i=this.parse(s))throw Qm(i);this.searchParams=null}else{if(void 0!==n&&(r=new sv(n,!0)),i=this.parse(s,null,r))throw Qm(i);(o=Xm(new Ym)).bindURL(this),this.searchParams=o}};sv.prototype={type:"URL",parse:function(e,t,n){var r,i,o,s,a,c=this,l=t||Vg,u=0,d="",h=!1,p=!1,f=!1;for(e=Wm(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=cg(e,Ag,""),e=cg(e,Rg,"$1")),e=cg(e,Ig,""),r=Um(e);u<=r.length;){switch(i=r[u],l){case Vg:if(!i||!rg(vg,i)){if(t)return fg;l=Bg;continue}d+=hg(i),l=Fg;break;case Fg:if(i&&(rg(yg,i)||"+"==i||"-"==i||"."==i))d+=hg(i);else{if(":"!=i){if(t)return fg;d="",l=Bg,u=0;continue}if(t&&(c.isSpecial()!=Mm(Lg,d)||"file"==d&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&Lg[c.scheme]==c.port&&(c.port=null));d="","file"==c.scheme?l=Qg:c.isSpecial()&&n&&n.scheme==c.scheme?l=Wg:c.isSpecial()?l=qg:"/"==r[u+1]?(l=zg,u++):(c.cannotBeABaseURL=!0,ag(c.path,""),l=rv)}break;case Bg:if(!n||n.cannotBeABaseURL&&"#"!=i)return fg;if(n.cannotBeABaseURL&&"#"==i){c.scheme=n.scheme,c.path=Vm(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=ov;break}l="file"==n.scheme?Qg:Hg;continue;case Wg:if("/"!=i||"/"!=r[u+1]){l=Hg;continue}l=Kg,u++;break;case zg:if("/"==i){l=$g;break}l=nv;continue;case Hg:if(c.scheme=n.scheme,i==Df)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Vm(n.path),c.query=n.query;else if("/"==i||"\\"==i&&c.isSpecial())l=Gg;else if("?"==i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Vm(n.path),c.query="",l=iv;else{if("#"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Vm(n.path),c.path.length--,l=nv;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Vm(n.path),c.query=n.query,c.fragment="",l=ov}break;case Gg:if(!c.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=nv;continue}l=$g}else l=Kg;break;case qg:if(l=Kg,"/"!=i||"/"!=ng(d,u+1))continue;u++;break;case Kg:if("/"!=i&&"\\"!=i){l=$g;continue}break;case $g:if("@"==i){h&&(d="%40"+d),h=!0,o=Um(d);for(var m=0;m<o.length;m++){var g=o[m];if(":"!=g||f){var v=Dg(g,Pg);f?c.password+=v:c.username+=v}else f=!0}d=""}else if(i==Df||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(h&&""==d)return"Invalid authority";u-=Um(d).length+1,d="",l=Yg}else d+=i;break;case Yg:case Xg:if(t&&"file"==c.scheme){l=ev;continue}if(":"!=i||p){if(i==Df||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(c.isSpecial()&&""==d)return mg;if(t&&""==d&&(c.includesCredentials()||null!==c.port))return;if(s=c.parseHost(d))return s;if(d="",l=tv,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),d+=i}else{if(""==d)return mg;if(s=c.parseHost(d))return s;if(d="",l=Jg,t==Xg)return}break;case Jg:if(!rg(_g,i)){if(i==Df||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()||t){if(""!=d){var y=Zm(d,10);if(y>65535)return gg;c.port=c.isSpecial()&&y===Lg[c.scheme]?null:y,d=""}if(t)return;l=tv;continue}return gg}d+=i;break;case Qg:if(c.scheme="file","/"==i||"\\"==i)l=Zg;else{if(!n||"file"!=n.scheme){l=nv;continue}if(i==Df)c.host=n.host,c.path=Vm(n.path),c.query=n.query;else if("?"==i)c.host=n.host,c.path=Vm(n.path),c.query="",l=iv;else{if("#"!=i){jg(ig(Vm(r,u),""))||(c.host=n.host,c.path=Vm(n.path),c.shortenPath()),l=nv;continue}c.host=n.host,c.path=Vm(n.path),c.query=n.query,c.fragment="",l=ov}}break;case Zg:if("/"==i||"\\"==i){l=ev;break}n&&"file"==n.scheme&&!jg(ig(Vm(r,u),""))&&(Mg(n.path[0],!0)?ag(c.path,n.path[0]):c.host=n.host),l=nv;continue;case ev:if(i==Df||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&Mg(d))l=nv;else if(""==d){if(c.host="",t)return;l=tv}else{if(s=c.parseHost(d))return s;if("localhost"==c.host&&(c.host=""),t)return;d="",l=tv}continue}d+=i;break;case tv:if(c.isSpecial()){if(l=nv,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=Df&&(l=nv,"/"!=i))continue}else c.fragment="",l=ov;else c.query="",l=iv;break;case nv:if(i==Df||"/"==i||"\\"==i&&c.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(a=hg(a=d))||"%2e."===a||".%2e"===a||"%2e%2e"===a?(c.shortenPath(),"/"==i||"\\"==i&&c.isSpecial()||ag(c.path,"")):Ug(d)?"/"==i||"\\"==i&&c.isSpecial()||ag(c.path,""):("file"==c.scheme&&!c.path.length&&Mg(d)&&(c.host&&(c.host=""),d=ng(d,0)+":"),ag(c.path,d)),d="","file"==c.scheme&&(i==Df||"?"==i||"#"==i))for(;c.path.length>1&&""===c.path[0];)lg(c.path);"?"==i?(c.query="",l=iv):"#"==i&&(c.fragment="",l=ov)}else d+=Dg(i,Ng);break;case rv:"?"==i?(c.query="",l=iv):"#"==i?(c.fragment="",l=ov):i!=Df&&(c.path[0]+=Dg(i,Og));break;case iv:t||"#"!=i?i!=Df&&("'"==i&&c.isSpecial()?c.query+="%27":c.query+="#"==i?"%23":Dg(i,Og)):(c.fragment="",l=ov);break;case ov:i!=Df&&(c.fragment+=Dg(i,kg))}u++}},parseHost:function(e){var t,n,r;if("["==ng(e,0)){if("]"!=ng(e,e.length-1))return mg;if(t=function(e){var t,n,r,i,o,s,a,c=[0,0,0,0,0,0,0,0],l=0,u=null,d=0,h=function(){return ng(e,d)};if(":"==h()){if(":"!=ng(e,1))return;d+=2,u=++l}for(;h();){if(8==l)return;if(":"!=h()){for(t=n=0;n<4&&rg(Sg,h());)t=16*t+Zm(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,l>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;d++}if(!rg(_g,h()))return;for(;rg(_g,h());){if(o=Zm(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}c[l]=256*c[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[l++]=t}else{if(null!==u)return;d++,u=++l}}if(null!==u)for(s=l-u,l=7;0!=l&&s>0;)a=c[l],c[l--]=c[u+s-1],c[u+--s]=a;else if(8!=l)return;return c}(dg(e,1,-1)),!t)return mg;this.host=t}else if(this.isSpecial()){if(e=Bm(e),rg(Tg,e))return mg;if(t=function(e){var t,n,r,i,o,s,a,c=ug(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=c[r]))return e;if(o=10,i.length>1&&"0"==ng(i,0)&&(o=rg(Eg,i)?16:8,i=dg(i,8==o?1:2)),""===i)s=0;else{if(!rg(10==o?wg:8==o?bg:Sg,i))return e;s=Zm(i,o)}ag(n,s)}for(r=0;r<t;r++)if(s=n[r],r==t-1){if(s>=tg(256,5-t))return null}else if(s>255)return null;for(a=sg(n),r=0;r<n.length;r++)a+=n[r]*tg(256,3-r);return a}(e),null===t)return mg;this.host=t}else{if(rg(Cg,e))return mg;for(t="",n=Um(e),r=0;r<n.length;r++)t+=Dg(n[r],Og);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return Mm(Lg,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&Mg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=xg(i),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?s[0]:s.length?"/"+ig(s,"/"):"",null!==a&&(l+="?"+a),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw Qm(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new av(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+xg(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Wm(e)+":",Vg)},getUsername:function(){return this.username},setUsername:function(e){var t=Um(Wm(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Dg(t[n],Pg)}},getPassword:function(){return this.password},setPassword:function(e){var t=Um(Wm(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Dg(t[n],Pg)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?xg(e):xg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Yg)},getHostname:function(){var e=this.host;return null===e?"":xg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Xg)},getPort:function(){var e=this.port;return null===e?"":Wm(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=Wm(e))?this.port=null:this.parse(e,Jg))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ig(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,tv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=Wm(e))?this.query=null:("?"==ng(e,0)&&(e=dg(e,1)),this.query="",this.parse(e,iv)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=Wm(e))?("#"==ng(e,0)&&(e=dg(e,1)),this.fragment="",this.parse(e,ov)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var av=function(e){var t=Lm(this,cv),n=Hm(arguments.length,1)>1?arguments[1]:void 0,r=Km(t,new sv(e,!1,n));Im||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},cv=av.prototype,lv=function(e,t){return{get:function(){return $m(this)[e]()},set:t&&function(e){return $m(this)[t](e)},configurable:!0,enumerable:!0}};if(Im&&(Dm(cv,"href",lv("serialize","setHref")),Dm(cv,"origin",lv("getOrigin")),Dm(cv,"protocol",lv("getProtocol","setProtocol")),Dm(cv,"username",lv("getUsername","setUsername")),Dm(cv,"password",lv("getPassword","setPassword")),Dm(cv,"host",lv("getHost","setHost")),Dm(cv,"hostname",lv("getHostname","setHostname")),Dm(cv,"port",lv("getPort","setPort")),Dm(cv,"pathname",lv("getPathname","setPathname")),Dm(cv,"search",lv("getSearch","setSearch")),Dm(cv,"searchParams",lv("getSearchParams")),Dm(cv,"hash",lv("getHash","setHash"))),Pm(cv,"toJSON",(function(){return $m(this).serialize()}),{enumerable:!0}),Pm(cv,"toString",(function(){return $m(this).serialize()}),{enumerable:!0}),Jm){var uv=Jm.createObjectURL,dv=Jm.revokeObjectURL;uv&&Pm(av,"createObjectURL",km(uv,Jm)),dv&&Pm(av,"revokeObjectURL",km(dv,Jm))}zm(av,"URL"),Rm({global:!0,constructor:!0,forced:!xm,sham:!Im},{URL:av});var hv=On,pv=i,fv=Zc,mv=vr,gv=tp,vv=ce("URL");hv({target:"URL",stat:!0,forced:!(gv&&pv((function(){vv.canParse()})))},{canParse:function(e){var t=fv(arguments.length,1),n=mv(e),r=t<2||void 0===arguments[1]?void 0:mv(arguments[1]);try{return!!new vv(n,r)}catch(e){return!1}}});var yv=r(re.URL);let _v=!0,Ev=!0;function bv(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function wv(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Sv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(_v=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Tv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ev=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Cv(){if("object"==typeof window){if(_v)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Av(e,t){Ev&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Rv(e){return"[object Object]"===Object.prototype.toString.call(e)}function Iv(e){var t;return Rv(e)?Xr(t=Object.keys(e)).call(t,(function(t,n){const r=Rv(e[n]),i=r?Iv(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function xv(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?xv(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{xv(e,e.get(t),n)}))})))}function Ov(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&xv(e,n,i)}))})),i}const kv=Cv;function Nv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>{var n;return Nr(n=e.label.toLowerCase()).call(n,t)}))));return!s&&n.length&&Nr(t).call(t,"back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),kv("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return kv("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>zh.reject(o(e))))))}}}function Pv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Dv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wv(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Lv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Mv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new zh(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function jv(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Ov(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),wv(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Ov(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?zh.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():zh.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Uv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function Vv(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Uv(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),zh.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Fv(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function Bv(e,t){wv(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Wv=Object.freeze({__proto__:null,fixNegotiationNeeded:Bv,shimAddTrackRemoveTrack:Vv,shimAddTrackRemoveTrackWithNative:Uv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Lv,shimGetStats:Mv,shimGetUserMedia:Nv,shimMediaStream:Pv,shimOnTrack:Dv,shimPeerConnection:Fv,shimSenderReceiverGetStats:jv});function zv(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Av("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Hv(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Gv(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function qv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):zh.resolve(new Map)}}function Kv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),wv(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $v(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Av("removeStream","removeTrack"),this.getSenders().forEach((t=>{var n;t.track&&Nr(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)}))})}function Yv(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Xv(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function Jv(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Qv(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?zh.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Zv(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?zh.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var ey=Object.freeze({__proto__:null,shimAddTransceiver:Xv,shimCreateAnswer:Zv,shimCreateOffer:Qv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,zh.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Jv,shimGetUserMedia:zv,shimOnTrack:Hv,shimPeerConnection:Gv,shimRTCDataChannel:Yv,shimReceiverGetStats:Kv,shimRemoveStream:$v,shimSenderGetStats:qv});function ty(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Nr(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{var t;this._localStreams?Nr(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{Nr(n).call(n,e.track)&&this.removeTrack(e)}))})}}function ny(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Nr(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function ry(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),zh.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),zh.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),zh.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),zh.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),zh.resolve()):r},t.addIceCandidate=a}function iy(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(oy(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function oy(e){return e&&void 0!==e.video?Object.assign({},e,{video:Iv(e.video)}):e}function sy(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Av("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ay(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cy(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ly(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var uy=Object.freeze({__proto__:null,shimAudioContext:ly,shimCallbacksAPI:ry,shimConstraints:oy,shimCreateOfferLegacy:cy,shimGetUserMedia:iy,shimLocalStreamsAPI:ty,shimRTCIceServerUrls:sy,shimRemoteStreamsAPI:ny,shimTrackEventTransceiver:ay}),dy="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",hy=X,py=vr,fy=dy,my=u("".replace),gy=RegExp("^["+fy+"]+"),vy=RegExp("(^|[^"+fy+"])["+fy+"]+$"),yy=function(e){return function(t){var n=py(hy(t));return 1&e&&(n=my(n,gy,"")),2&e&&(n=my(n,vy,"$1")),n}},_y={start:yy(1),end:yy(2),trim:yy(3)},Ey=ha.PROPER,by=i,wy=dy,Sy=_y.trim;On({target:"String",proto:!0,forced:function(e){return by((function(){return!!wy[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||Ey&&wy[e].name!==e}))}("trim")},{trim:function(){return Sy(this)}});var Ty=Qn("String").trim,Cy=d,Ay=Ty,Ry=String.prototype,Iy=function(e){var t=e.trim;return"string"==typeof e||e===Ry||Cy(Ry,e)&&t===Ry.trim?Ay:t},xy=r(Iy),Oy={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],s=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const r=t.parseRtpMap(s),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Oy);var ky=Oy.exports,Ny=r(ky),Py=e({__proto__:null,default:Ny},[ky]);function Dy(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Ny.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,wv(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Ly(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||wv(e,"icecandidate",(e=>{if(e.candidate){const t=Ny.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function My(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Ny.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Ny.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Ny.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function jy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},wv(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Uy(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Vy(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==xy(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Fy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?zh.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),zh.resolve())})}function By(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var Wy=Object.freeze({__proto__:null,removeExtmapAllowMixed:Vy,shimAddIceCandidateNullOrEmpty:Fy,shimConnectionState:Uy,shimMaxMessageSize:My,shimParameterlessSetLocalDescription:By,shimRTCIceCandidate:Dy,shimRTCIceCandidateRelayProtocol:Ly,shimSendThrowTypeError:jy});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Cv,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=bv(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=bv(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=bv(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:Wy,extractVersion:bv,disableLog:Sv,disableWarnings:Tv,sdp:Py};switch(r.browser){case"chrome":if(!Wv||!Fv||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Wv,Fy(e,r),By(e),Nv(e,r),Pv(e),Fv(e,r),Dv(e),Vv(e,r),Lv(e),Mv(e),jv(e),Bv(e,r),Dy(e),Ly(e),Uy(e),My(e,r),jy(e),Vy(e,r);break;case"firefox":if(!ey||!Gv||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=ey,Fy(e,r),By(e),zv(e,r),Gv(e,r),Hv(e),$v(e),qv(e),Kv(e),Yv(e),Xv(e),Jv(e),Qv(e),Zv(e),Dy(e),Uy(e),My(e,r),jy(e);break;case"safari":if(!uy||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=uy,Fy(e,r),By(e),sy(e),cy(e),ry(e),ty(e),ny(e),ay(e),iy(e),ly(e),Dy(e),Ly(e),My(e,r),jy(e),Vy(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var zy=Ie,Hy=TypeError,Gy=le.match(/firefox\/(\d+)/i),qy=!!Gy&&+Gy[1],Ky=/MSIE|Trident/.test(le),$y=le.match(/AppleWebKit\/(\d+)\./),Yy=!!$y&&+$y[1],Xy=On,Jy=u,Qy=Ne,Zy=Xe,e_=Hn,t_=function(e,t){if(!delete e[t])throw Hy("Cannot delete property "+zy(t)+" of "+zy(e))},n_=vr,r_=i,i_=yp,o_=Br,s_=qy,a_=Ky,c_=ge,l_=Yy,u_=[],d_=Jy(u_.sort),h_=Jy(u_.push),p_=r_((function(){u_.sort(void 0)})),f_=r_((function(){u_.sort(null)})),m_=o_("sort"),g_=!r_((function(){if(c_)return c_<70;if(!(s_&&s_>3)){if(a_)return!0;if(l_)return l_<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)u_.push({k:t+r,v:n})}for(u_.sort((function(e,t){return t.v-e.v})),r=0;r<u_.length;r++)t=u_[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Xy({target:"Array",proto:!0,forced:p_||!f_||!m_||!g_},{sort:function(e){void 0!==e&&Qy(e);var t=Zy(this);if(g_)return void 0===e?d_(t):d_(t,e);var n,r,i=[],o=e_(t);for(r=0;r<o;r++)r in t&&h_(i,t[r]);for(i_(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:n_(t)>n_(n)?1:-1}}(e)),n=e_(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)t_(t,r++);return t}});var v_=Qn("Array").sort,y_=d,__=v_,E_=Array.prototype,b_=function(e){var t=e.sort;return e===E_||y_(E_,e)&&t===E_.sort?__:t},w_=r(b_),S_=p;On({global:!0,forced:S_.globalThis!==S_},{globalThis:S_});var T_=r(p),C_={exports:{}};!function(e,n){!function(t,r){var i="function",o="undefined",s="object",a="string",c="major",l="model",u="name",d="type",h="vendor",p="version",f="architecture",m="console",g="mobile",v="tablet",y="smarttv",_="wearable",E="embedded",b="Amazon",w="Apple",S="ASUS",T="BlackBerry",C="Browser",A="Chrome",R="Firefox",I="Google",x="Huawei",O="LG",k="Microsoft",N="Motorola",P="Opera",D="Samsung",L="Sharp",M="Sony",j="Xiaomi",U="Zebra",V="Facebook",F="Chromium OS",B="Mac OS",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},z=function(e,t){return typeof e===a&&-1!==H(t).indexOf(H(e))},H=function(e){return e.toLowerCase()},G=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},q=function(e,t){for(var n,o,a,c,l,u,d=0;d<t.length&&!l;){var h=t[d],p=t[d+1];for(n=o=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(a=0;a<p.length;a++)u=l[++o],typeof(c=p[a])===s&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,u):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=u?u.replace(c[1],c[2]):r:this[c[0]]=u?c[1].call(this,u,c[2]):r:4===c.length&&(this[c[0]]=u?c[3].call(this,u.replace(c[1],c[2])):r):this[c]=u||r;d+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===s&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(z(t[n][i],e))return"?"===n?r:n}else if(z(t[n],e))return"?"===n?r:n;return e},$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,p],[/opios[\/ ]+([\w\.]+)/i],[p,[u,P+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[u,P]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[u,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+C],p],[/\bfocus\/([\w\.]+)/i],[p,[u,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[u,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[u,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[u,"MIUI "+C]],[/fxios\/([-\w\.]+)/i],[p,[u,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+C]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+C],p],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,V],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[u,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,A+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[u,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[p,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[u,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,p],[/(cobalt)\/([\w\.]+)/i],[u,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,H]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",H]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,H]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,D],[d,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,D],[d,g]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[h,w],[d,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,w],[d,v]],[/(macintosh);/i],[l,[h,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,L],[d,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,x],[d,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,x],[d,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[h,j],[d,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,j],[d,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[d,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[d,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[d,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,N],[d,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,N],[d,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,O],[d,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,O],[d,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[d,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[d,g]],[/(pixel c)\b/i],[l,[h,I],[d,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,I],[d,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,M],[d,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,M],[d,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[d,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,b],[d,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,b],[d,g]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[d,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,T],[d,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,S],[d,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,S],[d,g]],[/(nexus 9)/i],[l,[h,"HTC"],[d,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[d,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[d,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[d,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[d,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[d,v]],[/(surface duo)/i],[l,[h,k],[d,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[d,g]],[/(u304aa)/i],[l,[h,"AT&T"],[d,g]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[d,g]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[d,v]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[d,v]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[d,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[d,v]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[d,v]],[/\b(k88) b/i],[l,[h,"ZTE"],[d,v]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[d,g]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[d,g]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[d,v]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[d,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[d,v]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[d,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[d,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[d,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[d,g]],[/\b(ph-1) /i],[l,[h,"Essential"],[d,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[d,v]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[d,v]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[d,v]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[d,v]],[/(sprint) (\w+)/i],[h,l,[d,g]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,k],[d,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[d,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[d,g]],[/smart-tv.+(samsung)/i],[h,[d,y]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,D],[d,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,O],[d,y]],[/(apple) ?tv/i],[h,[l,w+" TV"],[d,y]],[/crkey/i],[[l,A+"cast"],[h,I],[d,y]],[/droid.+aft(\w)( bui|\))/i],[l,[h,b],[d,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,L],[d,y]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,M],[d,y]],[/(mitv-\w{5}) bui/i],[l,[h,j],[d,y]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[d,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,G],[l,G],[d,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[d,m]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[l,[h,M],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,k],[d,m]],[/((pebble))app/i],[h,l,[d,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,w],[d,_]],[/droid.+; (glass) \d/i],[l,[h,I],[d,_]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[d,_]],[/(quest( 2| pro)?)/i],[l,[h,V],[d,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[d,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[d,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,g]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[p,K,$]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[p,K,$]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,p],[/\(bb(10);/i],[p,[u,T]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[u,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[u,A+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,F],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,p],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,p]]},X=function(e,n){if(typeof e===s&&(n=e,e=r),!(this instanceof X))return new X(e,n).getResult();var m=typeof t!==o&&t.navigator?t.navigator:r,y=e||(m&&m.userAgent?m.userAgent:""),_=m&&m.userAgentData?m.userAgentData:r,E=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(Y,n):Y;return this.getBrowser=function(){var e={};return e[u]=r,e[p]=r,q.call(e,y,E.browser),e[c]=function(e){return typeof e===a?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[p]),m&&m.brave&&typeof m.brave.isBrave==i&&(e[u]="Brave"),e},this.getCPU=function(){var e={};return e[f]=r,q.call(e,y,E.cpu),e},this.getDevice=function(){var e={};return e[h]=r,e[l]=r,e[d]=r,q.call(e,y,E.device),!e[d]&&_&&_.mobile&&(e[d]=g),"Macintosh"==e[l]&&m&&typeof m.standalone!==o&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[l]="iPad",e[d]=v),e},this.getEngine=function(){var e={};return e[u]=r,e[p]=r,q.call(e,y,E.engine),e},this.getOS=function(){var e={};return e[u]=r,e[p]=r,q.call(e,y,E.os),!e[u]&&_&&"Unknown"!=_.platform&&(e[u]=_.platform.replace(/chrome os/i,F).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return y},this.setUA=function(e){return y=typeof e===a&&e.length>350?G(e,350):e,this},this.setUA(y),this};X.VERSION="0.7.34",X.BROWSER=W([u,p,c]),X.CPU=W([f]),X.DEVICE=W([l,h,d,m,g,y,v,_,E]),X.ENGINE=X.OS=W([u,p]),e.exports&&(n=e.exports=X),n.UAParser=X;var J=typeof t!==o&&(t.jQuery||t.Zepto);if(J&&!J.ua){var Q=new X;J.ua=Q.getResult(),J.ua.get=function(){return Q.getUA()},J.ua.set=function(e){Q.setUA(e);var t=Q.getResult();for(var n in t)J.ua[n]=t[n]}}}("object"==typeof window?window:t)}(C_,C_.exports);var A_=r(C_.exports),R_=fr,I_=Ze,x_=K,O_=Vo,k_=pt("iterator"),N_=Object,P_=function(e){if(x_(e))return!1;var t=N_(e);return void 0!==t[k_]||"@@iterator"in t||I_(O_,R_(t))},D_=r(P_),L_=Rl.clear;On({global:!0,bind:!0,enumerable:!0,forced:p.clearImmediate!==L_},{clearImmediate:L_});var M_="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,j_=p,U_=y,V_=x,F_=M_,B_=le,W_=Jc,z_=Zc,H_=j_.Function,G_=/MSIE .\./.test(B_)||F_&&function(){var e=j_.Bun.version.split(".");return e.length<3||0==e[0]&&(e[1]<3||3==e[1]&&0==e[2])}(),q_=On,K_=p,$_=Rl.set,Y_=function(e,t){var n=t?2:1;return G_?function(r,i){var o=z_(arguments.length,1)>n,s=V_(r)?r:H_(r),a=o?W_(arguments,n):[],c=o?function(){U_(s,this,a)}:s;return t?e(c,i):e(c)}:e},X_=K_.setImmediate?Y_($_,!1):$_;q_({global:!0,bind:!0,enumerable:!0,forced:K_.setImmediate!==X_},{setImmediate:X_});var J_=r(re.setImmediate),Q_=On,Z_=eu,eE=Ne,tE=Zc,nE=Wr,rE=p.process;Q_({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){tE(arguments.length,1),eE(e);var t=nE&&rE.domain;Z_(t?t.bind(e):e)}});var iE=r(re.queueMicrotask);function oE(e,t){return function(){return e.apply(t,arguments)}}const{toString:sE}=Object.prototype,{getPrototypeOf:aE}=Object,cE=(lE=Object.create(null),e=>{const t=sE.call(e);return lE[t]||(lE[t]=t.slice(8,-1).toLowerCase())});var lE;const uE=e=>(e=e.toLowerCase(),t=>cE(t)===e),dE=e=>t=>typeof t===e,{isArray:hE}=Array,pE=dE("undefined"),fE=uE("ArrayBuffer"),mE=dE("string"),gE=dE("function"),vE=dE("number"),yE=e=>null!==e&&"object"==typeof e,_E=e=>{if("object"!==cE(e))return!1;const t=aE(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||D_(e))},EE=uE("Date"),bE=uE("File"),wE=uE("Blob"),SE=uE("FileList"),TE=uE("URLSearchParams"),[CE,AE,RE,IE]=["ReadableStream","Request","Response","Headers"].map(uE);function xE(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),hE(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let s;for(n=0;n<o;n++)s=r[n],t.call(null,e[s],s,e)}}function OE(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const kE=void 0!==T_?T_:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,NE=e=>!pE(e)&&e!==kE,PE=(DE="undefined"!=typeof Uint8Array&&aE(Uint8Array),e=>DE&&e instanceof DE);var DE;const LE=uE("HTMLFormElement"),ME=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),jE=uE("RegExp"),UE=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};xE(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},VE="abcdefghijklmnopqrstuvwxyz",FE="0123456789",BE={DIGIT:FE,ALPHA:VE,ALPHA_DIGIT:VE+VE.toUpperCase()+FE},WE=uE("AsyncFunction"),zE=(HE="function"==typeof J_,GE=gE(kE.postMessage),HE?J_:GE?(qE="axios@".concat(Math.random()),KE=[],kE.addEventListener("message",(e=>{let{source:t,data:n}=e;t===kE&&n===qE&&KE.length&&KE.shift()()}),!1),e=>{KE.push(e),kE.postMessage(qE,"*")}):e=>setTimeout(e));var HE,GE,qE,KE;const $E=void 0!==iE?iE.bind(kE):"undefined"!=typeof process&&process.nextTick||zE;var YE={isArray:hE,isArrayBuffer:fE,isBuffer:function(e){return null!==e&&!pE(e)&&null!==e.constructor&&!pE(e.constructor)&&gE(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||gE(e.append)&&("formdata"===(t=cE(e))||"object"===t&&gE(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&fE(e.buffer),t},isString:mE,isNumber:vE,isBoolean:e=>!0===e||!1===e,isObject:yE,isPlainObject:_E,isReadableStream:CE,isRequest:AE,isResponse:RE,isHeaders:IE,isUndefined:pE,isDate:EE,isFile:bE,isBlob:wE,isRegExp:jE,isFunction:gE,isStream:e=>yE(e)&&gE(e.pipe),isURLSearchParams:TE,isTypedArray:PE,isFileList:SE,forEach:xE,merge:function e(){const{caseless:t}=NE(this)&&this||{},n={},r=(r,i)=>{const o=t&&OE(n,i)||i;_E(n[o])&&_E(r)?n[o]=e(n[o],r):_E(r)?n[o]=e({},r):hE(r)?n[o]=r.slice():n[o]=r};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&xE(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return xE(t,((t,r)=>{n&&gE(t)?e[r]=oE(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>xy(e)?xy(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,s;const a={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)s=i[o],r&&!r(s,e,t)||a[s]||(t[s]=e[s],a[s]=!0);e=!1!==n&&aE(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:cE,kindOfTest:uE,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(hE(e))return e;let t=e.length;if(!vE(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:LE,hasOwnProperty:ME,hasOwnProp:ME,reduceDescriptors:UE,freezeMethods:e=>{UE(e,((t,n)=>{if(gE(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];gE(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return hE(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:OE,global:kE,isContextDefined:NE,ALPHABET:BE,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BE.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&gE(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(yE(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=hE(e)?[]:{};return xE(e,((e,t)=>{const o=n(e,r+1);!pE(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:WE,isThenable:e=>e&&(yE(e)||gE(e))&&gE(e.then)&&gE(e.catch),setImmediate:zE,asap:$E};function XE(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}YE.inherits(XE,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:YE.toJSONObject(this.config),code:this.code,status:this.status}}});const JE=XE.prototype,QE={};function ZE(e){return YE.isPlainObject(e)||YE.isArray(e)}function eb(e){return YE.endsWith(e,"[]")?e.slice(0,-2):e}function tb(e,t,n){return e?e.concat(t).map((function(e,t){return e=eb(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{QE[e]={value:e}})),Object.defineProperties(XE,QE),Object.defineProperty(JE,"isAxiosError",{value:!0}),XE.from=(e,t,n,r,i,o)=>{const s=Object.create(JE);return YE.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),XE.call(s,e.message,t,n,r,i),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const nb=YE.toFlatObject(YE,{},null,(function(e){return/^is[A-Z]/.test(e)}));function rb(e,t,n){if(!YE.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=YE.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!YE.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,o=n.dots,s=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&YE.isSpecCompliantForm(t);if(!YE.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(YE.isDate(e))return e.toISOString();if(!a&&YE.isBlob(e))throw new XE("Blob is not supported. Use a Buffer instead.");return YE.isArrayBuffer(e)||YE.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let a=e;if(e&&!i&&"object"==typeof e)if(YE.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(YE.isArray(e)&&function(e){return YE.isArray(e)&&!e.some(ZE)}(e)||(YE.isFileList(e)||YE.endsWith(n,"[]"))&&(a=YE.toArray(e)))return n=eb(n),a.forEach((function(e,r){!YE.isUndefined(e)&&null!==e&&t.append(!0===s?tb([n],r,o):null===s?n:n+"[]",c(e))})),!1;return!!ZE(e)||(t.append(tb(i,n,o),c(e)),!1)}const u=[],d=Object.assign(nb,{defaultVisitor:l,convertValue:c,isVisitable:ZE});if(!YE.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!YE.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),YE.forEach(n,(function(n,o){!0===(!(YE.isUndefined(n)||null===n)&&i.call(t,n,YE.isString(o)?xy(o).call(o):o,r,d))&&e(n,r?r.concat(o):[o])})),u.pop()}}(e),t}function ib(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function ob(e,t){this._pairs=[],e&&rb(e,this,t)}const sb=ob.prototype;function ab(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cb(e,t,n){if(!t)return e;const r=n&&n.encode||ab;YE.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let o;if(o=i?i(t,n):YE.isURLSearchParams(t)?t.toString():new ob(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}sb.append=function(e,t){this._pairs.push([e,t])},sb.toString=function(e){const t=e?function(t){return e.call(this,t,ib)}:ib;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var lb=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){YE.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},ub={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},db={exports:{}},hb=On,pb=k,fb=Qt.f;hb({target:"Object",stat:!0,forced:Object.defineProperty!==fb,sham:!pb},{defineProperty:fb});var mb=re.Object,gb=db.exports=function(e,t,n){return mb.defineProperty(e,t,n)};mb.defineProperty.sham&&(gb.sham=!0);var vb=r(db.exports),yb=TypeError,_b=Qr,Eb=Wc,bb=ne,wb=pt("species"),Sb=Array,Tb=function(e){var t;return _b(e)&&(t=e.constructor,(Eb(t)&&(t===Sb||_b(t.prototype))||bb(t)&&null===(t=t[wb]))&&(t=void 0)),void 0===t?Sb:t},Cb=function(e,t){return new(Tb(e))(0===t?0:t)},Ab=i,Rb=ge,Ib=pt("species"),xb=function(e){return Rb>=51||!Ab((function(){var t=[];return(t.constructor={})[Ib]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Ob=On,kb=i,Nb=Qr,Pb=ne,Db=Xe,Lb=Hn,Mb=function(e){if(e>9007199254740991)throw yb("Maximum allowed index exceeded");return e},jb=sp,Ub=Cb,Vb=xb,Fb=ge,Bb=pt("isConcatSpreadable"),Wb=Fb>=51||!kb((function(){var e=[];return e[Bb]=!1,e.concat()[0]!==e})),zb=function(e){if(!Pb(e))return!1;var t=e[Bb];return void 0!==t?!!t:Nb(e)};Ob({target:"Array",proto:!0,arity:1,forced:!Wb||!Vb("concat")},{concat:function(e){var t,n,r,i,o,s=Db(this),a=Ub(s,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(zb(o=-1===t?s:arguments[t]))for(i=Lb(o),Mb(c+i),n=0;n<i;n++,c++)n in o&&jb(a,c,o[n]);else Mb(c+1),jb(a,c++,o);return a.length=c,a}});var Hb={},Gb=w,qb=Z,Kb=ki.f,$b=hp,Yb="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Hb.f=function(e){return Yb&&"Window"==Gb(e)?function(e){try{return Kb(e)}catch(e){return $b(Yb)}}(e):Kb(qb(e))};var Xb={},Jb=pt;Xb.f=Jb;var Qb=re,Zb=Ze,ew=Xb,tw=Qt.f,nw=function(e){var t=Qb.Symbol||(Qb.Symbol={});Zb(t,e)||tw(t,e,{value:ew.f(e)})},rw=D,iw=ce,ow=pt,sw=fa,aw=function(){var e=iw("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=ow("toPrimitive");t&&!t[r]&&sw(t,r,(function(e){return rw(n,this)}),{arity:1})},cw=Jt,lw=q,uw=Xe,dw=Hn,hw=Cb,pw=u([].push),fw=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,l,u,d){for(var h,p,f=uw(c),m=lw(f),g=cw(l,u),v=dw(m),y=0,_=d||hw,E=t?_(c,v):n||s?_(c,0):void 0;v>y;y++)if((a||y in m)&&(p=g(h=m[y],y,f),e))if(t)E[y]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return y;case 2:pw(E,h)}else switch(e){case 4:return!1;case 7:pw(E,h)}return o?-1:r||i?i:E}},mw={forEach:fw(0),map:fw(1),filter:fw(2),some:fw(3),every:fw(4),find:fw(5),findIndex:fw(6),filterReject:fw(7)},gw=On,vw=p,yw=D,_w=u,Ew=k,bw=Ee,ww=i,Sw=Ze,Tw=d,Cw=rn,Aw=Z,Rw=St,Iw=vr,xw=B,Ow=Co,kw=no,Nw=ki,Pw=Hb,Dw=Wi,Lw=O,Mw=Qt,jw=Zi,Uw=L,Vw=fa,Fw=pc,Bw=Ke,Ww=Ni,zw=it,Hw=pt,Gw=Xb,qw=nw,Kw=aw,$w=Pa,Yw=sa,Xw=mw.forEach,Jw=hi("hidden"),Qw="Symbol",Zw="prototype",eS=Yw.set,tS=Yw.getterFor(Qw),nS=Object[Zw],rS=vw.Symbol,iS=rS&&rS[Zw],oS=vw.TypeError,sS=vw.QObject,aS=Lw.f,cS=Mw.f,lS=Pw.f,uS=Uw.f,dS=_w([].push),hS=Bw("symbols"),pS=Bw("op-symbols"),fS=Bw("wks"),mS=!sS||!sS[Zw]||!sS[Zw].findChild,gS=Ew&&ww((function(){return 7!=Ow(cS({},"a",{get:function(){return cS(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=aS(nS,t);r&&delete nS[t],cS(e,t,n),r&&e!==nS&&cS(nS,t,r)}:cS,vS=function(e,t){var n=hS[e]=Ow(iS);return eS(n,{type:Qw,tag:e,description:t}),Ew||(n.description=t),n},yS=function(e,t,n){e===nS&&yS(pS,t,n),Cw(e);var r=Rw(t);return Cw(n),Sw(hS,r)?(n.enumerable?(Sw(e,Jw)&&e[Jw][r]&&(e[Jw][r]=!1),n=Ow(n,{enumerable:xw(0,!1)})):(Sw(e,Jw)||cS(e,Jw,xw(1,{})),e[Jw][r]=!0),gS(e,r,n)):cS(e,r,n)},_S=function(e,t){Cw(e);var n=Aw(t),r=kw(n).concat(SS(n));return Xw(r,(function(t){Ew&&!yw(ES,n,t)||yS(e,t,n[t])})),e},ES=function(e){var t=Rw(e),n=yw(uS,this,t);return!(this===nS&&Sw(hS,t)&&!Sw(pS,t))&&(!(n||!Sw(this,t)||!Sw(hS,t)||Sw(this,Jw)&&this[Jw][t])||n)},bS=function(e,t){var n=Aw(e),r=Rw(t);if(n!==nS||!Sw(hS,r)||Sw(pS,r)){var i=aS(n,r);return!i||!Sw(hS,r)||Sw(n,Jw)&&n[Jw][r]||(i.enumerable=!0),i}},wS=function(e){var t=lS(Aw(e)),n=[];return Xw(t,(function(e){Sw(hS,e)||Sw(Ww,e)||dS(n,e)})),n},SS=function(e){var t=e===nS,n=lS(t?pS:Aw(e)),r=[];return Xw(n,(function(e){!Sw(hS,e)||t&&!Sw(nS,e)||dS(r,hS[e])})),r};bw||(rS=function(){if(Tw(iS,this))throw oS("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Iw(arguments[0]):void 0,t=zw(e),n=function(e){this===nS&&yw(n,pS,e),Sw(this,Jw)&&Sw(this[Jw],t)&&(this[Jw][t]=!1),gS(this,t,xw(1,e))};return Ew&&mS&&gS(nS,t,{configurable:!0,set:n}),vS(t,e)},Vw(iS=rS[Zw],"toString",(function(){return tS(this).tag})),Vw(rS,"withoutSetter",(function(e){return vS(zw(e),e)})),Uw.f=ES,Mw.f=yS,jw.f=_S,Lw.f=bS,Nw.f=Pw.f=wS,Dw.f=SS,Gw.f=function(e){return vS(Hw(e),e)},Ew&&Fw(iS,"description",{configurable:!0,get:function(){return tS(this).description}})),gw({global:!0,constructor:!0,wrap:!0,forced:!bw,sham:!bw},{Symbol:rS}),Xw(kw(fS),(function(e){qw(e)})),gw({target:Qw,stat:!0,forced:!bw},{useSetter:function(){mS=!0},useSimple:function(){mS=!1}}),gw({target:"Object",stat:!0,forced:!bw,sham:!Ew},{create:function(e,t){return void 0===t?Ow(e):_S(Ow(e),t)},defineProperty:yS,defineProperties:_S,getOwnPropertyDescriptor:bS}),gw({target:"Object",stat:!0,forced:!bw},{getOwnPropertyNames:wS}),Kw(),$w(rS,Qw),Ww[Jw]=!0;var TS=Ee&&!!Symbol.for&&!!Symbol.keyFor,CS=On,AS=ce,RS=Ze,IS=vr,xS=Ke,OS=TS,kS=xS("string-to-symbol-registry"),NS=xS("symbol-to-string-registry");CS({target:"Symbol",stat:!0,forced:!OS},{for:function(e){var t=IS(e);if(RS(kS,t))return kS[t];var n=AS("Symbol")(t);return kS[t]=n,NS[n]=t,n}});var PS=On,DS=Ze,LS=Ae,MS=Ie,jS=TS,US=Ke("symbol-to-string-registry");PS({target:"Symbol",stat:!0,forced:!jS},{keyFor:function(e){if(!LS(e))throw TypeError(MS(e)+" is not a symbol");if(DS(US,e))return US[e]}});var VS=Qr,FS=x,BS=w,WS=vr,zS=u([].push),HS=On,GS=ce,qS=y,KS=D,$S=u,YS=i,XS=x,JS=Ae,QS=Jc,ZS=function(e){if(FS(e))return e;if(VS(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?zS(n,i):"number"!=typeof i&&"Number"!=BS(i)&&"String"!=BS(i)||zS(n,WS(i))}var o=n.length,s=!0;return function(e,t){if(s)return s=!1,t;if(VS(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}},eT=Ee,tT=String,nT=GS("JSON","stringify"),rT=$S(/./.exec),iT=$S("".charAt),oT=$S("".charCodeAt),sT=$S("".replace),aT=$S(1..toString),cT=/[\uD800-\uDFFF]/g,lT=/^[\uD800-\uDBFF]$/,uT=/^[\uDC00-\uDFFF]$/,dT=!eT||YS((function(){var e=GS("Symbol")();return"[null]"!=nT([e])||"{}"!=nT({a:e})||"{}"!=nT(Object(e))})),hT=YS((function(){return'"\\udf06\\ud834"'!==nT("\udf06\ud834")||'"\\udead"'!==nT("\udead")})),pT=function(e,t){var n=QS(arguments),r=ZS(t);if(XS(r)||void 0!==e&&!JS(e))return n[1]=function(e,t){if(XS(r)&&(t=KS(r,this,tT(e),t)),!JS(t))return t},qS(nT,null,n)},fT=function(e,t,n){var r=iT(n,t-1),i=iT(n,t+1);return rT(lT,e)&&!rT(uT,i)||rT(uT,e)&&!rT(lT,r)?"\\u"+aT(oT(e,0),16):e};nT&&HS({target:"JSON",stat:!0,arity:3,forced:dT||hT},{stringify:function(e,t,n){var r=QS(arguments),i=qS(dT?pT:nT,null,r);return hT&&"string"==typeof i?sT(i,cT,fT):i}});var mT=Wi,gT=Xe;On({target:"Object",stat:!0,forced:!Ee||i((function(){mT.f(1)}))},{getOwnPropertySymbols:function(e){var t=mT.f;return t?t(gT(e)):[]}}),nw("asyncIterator"),nw("hasInstance"),nw("isConcatSpreadable"),nw("iterator"),nw("match"),nw("matchAll"),nw("replace"),nw("search"),nw("species"),nw("split");var vT=aw;nw("toPrimitive"),vT();var yT=ce,_T=Pa;nw("toStringTag"),_T(yT("Symbol"),"Symbol"),nw("unscopables"),Pa(p.JSON,"JSON",!0);var ET=re.Symbol,bT=pt,wT=Qt.f,ST=bT("metadata"),TT=Function.prototype;void 0===TT[ST]&&wT(TT,ST,{value:null}),nw("dispose"),nw("metadata");var CT=ET;nw("asyncDispose");var AT=u,RT=ce("Symbol"),IT=RT.keyFor,xT=AT(RT.prototype.valueOf),OT=RT.isRegisteredSymbol||function(e){try{return void 0!==IT(xT(e))}catch(e){return!1}};On({target:"Symbol",stat:!0},{isRegisteredSymbol:OT});for(var kT=Ke,NT=ce,PT=u,DT=Ae,LT=pt,MT=NT("Symbol"),jT=MT.isWellKnownSymbol,UT=NT("Object","getOwnPropertyNames"),VT=PT(MT.prototype.valueOf),FT=kT("wks"),BT=0,WT=UT(MT),zT=WT.length;BT<zT;BT++)try{var HT=WT[BT];DT(MT[HT])&&LT(HT)}catch(e){}var GT=function(e){if(jT&&jT(e))return!0;try{for(var t=VT(e),n=0,r=UT(FT),i=r.length;n<i;n++)if(FT[r[n]]==t)return!0}catch(e){}return!1};On({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:GT}),nw("matcher"),nw("observable"),On({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:OT}),On({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:GT}),nw("metadataKey"),nw("patternMatch"),nw("replaceAll");var qT=r(CT),KT=r(Xb.f("iterator"));function $T(e){return $T="function"==typeof qT&&"symbol"==typeof KT?function(e){return typeof e}:function(e){return e&&"function"==typeof qT&&e.constructor===qT&&e!==qT.prototype?"symbol":typeof e},$T(e)}var YT=r(Xb.f("toPrimitive"));function XT(e){var t=function(e,t){if("object"!==$T(e)||null===e)return e;var n=e[YT];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==$T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===$T(t)?t:String(t)}function JT(e,t,n){return(t=XT(t))in e?vb(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var QT=r(Mf),ZT={isBrowser:!0,classes:{URLSearchParams:void 0!==QT?QT:ob,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const eC="undefined"!=typeof window&&"undefined"!=typeof document,tC="object"==typeof navigator&&navigator||void 0,nC=eC&&(!tC||["ReactNative","NativeScript","NS"].indexOf(tC.product)<0),rC="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,iC=eC&&window.location.href||"http://localhost";function oC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oC(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var aC=sC(sC({},Object.freeze({__proto__:null,hasBrowserEnv:eC,hasStandardBrowserEnv:nC,hasStandardBrowserWebWorkerEnv:rC,navigator:tC,origin:iC})),ZT),cC=rn,lC=D,uC=Ze,dC=d,hC=function(){var e=cC(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},pC=RegExp.prototype,fC=function(e){var t=e.flags;return void 0!==t||"flags"in pC||uC(e,"flags")||!dC(pC,e)?t:lC(hC,e)},mC=Sh.charAt,gC=D,vC=rn,yC=x,_C=w,EC=/./.exec,bC=TypeError,wC=On,SC=D,TC=C,CC=Fa,AC=rc,RC=X,IC=Wn,xC=vr,OC=rn,kC=K,NC=w,PC=rr,DC=fC,LC=Le,MC=i,jC=Xc,UC=function(e,t,n){return t+(n?mC(e,t).length:1)},VC=function(e,t){var n=e.exec;if(yC(n)){var r=gC(n,e,t);return null!==r&&vC(r),r}if("RegExp"===_C(e))return gC(EC,e,t);throw bC("RegExp#exec called on incompatible receiver")},FC=sa,BC=pt("matchAll"),WC="RegExp String",zC=WC+" Iterator",HC=FC.set,GC=FC.getterFor(zC),qC=TypeError,KC=TC("".indexOf),$C=TC("".matchAll),YC=!!$C&&!MC((function(){$C("a",/./)})),XC=CC((function(e,t,n,r){HC(this,{type:zC,regexp:e,string:t,global:n,unicode:r,done:!1})}),WC,(function(){var e=GC(this);if(e.done)return AC(void 0,!0);var t=e.regexp,n=e.string,r=VC(t,n);return null===r?(e.done=!0,AC(void 0,!0)):e.global?(""===xC(r[0])&&(t.lastIndex=UC(n,IC(t.lastIndex),e.unicode)),AC(r,!1)):(e.done=!0,AC(r,!1))})),JC=function(e){var t,n,r,i=OC(this),o=xC(e),s=jC(i,RegExp),a=xC(DC(i));return t=new s(s===RegExp?i.source:i,a),n=!!~KC(a,"g"),r=!!~KC(a,"u"),t.lastIndex=IC(i.lastIndex),new XC(t,o,n,r)};wC({target:"String",proto:!0,forced:YC},{matchAll:function(e){var t,n,r,i,o=RC(this);if(kC(e)){if(YC)return $C(o,e)}else{if(PC(e)&&(t=xC(RC(DC(e))),!~KC(t,"g")))throw qC("`.matchAll` does not allow non-global regexes");if(YC)return $C(o,e);if(void 0===(r=LC(e,BC))&&"RegExp"==NC(e)&&(r=JC),r)return SC(r,e,o)}return n=xC(o),i=new RegExp(e,"g"),SC(JC,i,n)}});var QC=Qn("String").matchAll,ZC=d,eA=QC,tA=String.prototype,nA=function(e){var t=e.matchAll;return"string"==typeof e||e===tA||ZC(tA,e)&&t===tA.matchAll?eA:t},rA=r(nA);function iA(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;const s=Number.isFinite(+o),a=i>=e.length;return o=!o&&YE.isArray(r)?r.length:o,a?(YE.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s):(r[o]&&YE.isObject(r[o])||(r[o]=[]),t(e,n,r[o],i)&&YE.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!s)}if(YE.isFormData(e)&&YE.isFunction(e.entries)){const n={};return YE.forEachEntry(e,((e,r)=>{t(function(e){return rA(YE).call(YE,/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const oA={transitional:ub,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=YE.isObject(e);if(i&&YE.isHTMLForm(e)&&(e=new FormData(e)),YE.isFormData(e))return r?JSON.stringify(iA(e)):e;if(YE.isArrayBuffer(e)||YE.isBuffer(e)||YE.isStream(e)||YE.isFile(e)||YE.isBlob(e)||YE.isReadableStream(e))return e;if(YE.isArrayBufferView(e))return e.buffer;if(YE.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return rb(e,new aC.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return aC.isNode&&YE.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=YE.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return rb(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(YE.isString(e))try{return(t||JSON.parse)(e),xy(YE).call(YE,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||oA.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(YE.isResponse(e)||YE.isReadableStream(e))return e;if(e&&YE.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw XE.from(e,XE.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:aC.classes.FormData,Blob:aC.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};YE.forEach(["delete","get","head","post","put","patch"],(e=>{oA.headers[e]={}}));var sA=oA;const aA=YE.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cA=Symbol("internals");function lA(e){var t;return e&&xy(t=String(e)).call(t).toLowerCase()}function uA(e){return!1===e||null==e?e:YE.isArray(e)?e.map(uA):String(e)}function dA(e,t,n,r,i){return YE.isFunction(r)?r.call(this,t,n):(i&&(t=n),YE.isString(t)?YE.isString(r)?-1!==t.indexOf(r):YE.isRegExp(r)?r.test(t):void 0:void 0)}class hA{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=lA(t);if(!i)throw new Error("header name must be a non-empty string");const o=YE.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=uA(e))}const o=(e,t)=>YE.forEach(e,((e,n)=>i(e,n,t)));if(YE.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(YE.isString(e)&&(e=xy(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(xy(s=e).call(s)))o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){var o,s;i=e.indexOf(":"),n=xy(o=e.substring(0,i)).call(o).toLowerCase(),r=xy(s=e.substring(i+1)).call(s),!n||t[n]&&aA[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(YE.isHeaders(e))for(const[a,c]of e.entries())i(c,a,n);else null!=e&&i(t,e,n);var s;return this}get(e,t){if(e=lA(e)){const n=YE.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(YE.isFunction(t))return t.call(this,e,n);if(YE.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=lA(e)){const n=YE.findKey(this,e);return!(!n||void 0===this[n]||t&&!dA(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=lA(e)){const i=YE.findKey(n,e);!i||t&&!dA(0,n[i],i,t)||(delete n[i],r=!0)}}return YE.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!dA(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return YE.forEach(this,((r,i)=>{var o;const s=YE.findKey(n,i);if(s)return t[s]=uA(r),void delete t[i];const a=e?function(e){return xy(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):xy(o=String(i)).call(o);a!==i&&delete t[i],t[a]=uA(r),n[a]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return YE.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&YE.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[cA]=this[cA]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=lA(e);t[r]||(function(e,t){const n=YE.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return YE.isArray(e)?e.forEach(r):r(e),this}}hA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),YE.reduceDescriptors(hA.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),YE.freezeMethods(hA);var pA=hA;function fA(e,t){const n=this||sA,r=t||n,i=pA.from(r.headers);let o=r.data;return YE.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function mA(e){return!(!e||!e.__CANCEL__)}function gA(e,t,n){XE.call(this,null==e?"canceled":e,XE.ERR_CANCELED,t,n),this.name="CanceledError"}function vA(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new XE("Request failed with status code "+n.status,[XE.ERR_BAD_REQUEST,XE.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}YE.inherits(gA,XE,{__CANCEL__:!0});const yA=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),l=r[s];i||(i=c),n[o]=a,r[o]=c;let u=s,d=0;for(;u!==o;)d+=n[u++],u%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*d/h):void 0}}(50,250);return function(e,t){let n,r,i=0,o=1e3/t;const s=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=o,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];t>=o?s(c,e):(n=c,r||(r=setTimeout((()=>{r=null,s(n)}),o-t)))},()=>n&&s(n)]}((n=>{const o=n.loaded,s=n.lengthComputable?n.total:void 0,a=o-r,c=i(a);r=o,e({loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&o<=s?(s-o)/c:void 0,event:n,lengthComputable:null!=s,[t?"download":"upload"]:!0})}),n)},_A=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},EA=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return YE.asap((()=>e(...n)))};var bA=aC.hasStandardBrowserEnv?((e,t)=>n=>(n=new yv(n,aC.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new yv(aC.origin),aC.navigator&&/(msie|trident)/i.test(aC.navigator.userAgent)):()=>!0,wA=aC.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const s=[e+"="+encodeURIComponent(t)];YE.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),YE.isString(r)&&s.push("path="+r),YE.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function SA(e,t){return e&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function TA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const CA=e=>e instanceof pA?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TA(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e;function AA(e,t){t=t||{};const n={};function r(e,t,n,r){return YE.isPlainObject(e)&&YE.isPlainObject(t)?YE.merge.call({caseless:r},e,t):YE.isPlainObject(t)?YE.merge({},t):YE.isArray(t)?t.slice():t}function i(e,t,n,i){return YE.isUndefined(t)?YE.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function o(e,t){if(!YE.isUndefined(t))return r(void 0,t)}function s(e,t){return YE.isUndefined(t)?YE.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t,n)=>i(CA(e),CA(t),0,!0)};return YE.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=c[r]||i,s=o(e[r],t[r],r);YE.isUndefined(s)&&o!==a||(n[r]=s)})),n}var RA=e=>{const t=AA({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:s,headers:a,auth:c}=t;if(t.headers=a=pA.from(a),t.url=cb(SA(t.baseURL,t.url),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),YE.isFormData(r))if(aC.hasStandardBrowserEnv||aC.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(n=a.getContentType())){const[e,...t]=n?n.split(";").map((e=>xy(e).call(e))).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...t].join("; "))}if(aC.hasStandardBrowserEnv&&(i&&YE.isFunction(i)&&(i=i(t)),i||!1!==i&&bA(t.url))){const e=o&&s&&wA.read(s);e&&a.set(o,e)}return t},IA="undefined"!=typeof XMLHttpRequest&&function(e){return new zh((function(t,n){const r=RA(e);let i=r.data;const o=pA.from(r.headers).normalize();let s,a,c,l,u,{responseType:d,onUploadProgress:h,onDownloadProgress:p}=r;function f(){l&&l(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}let m=new XMLHttpRequest;function g(){if(!m)return;const r=pA.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());vA((function(e){t(e),f()}),(function(e){n(e),f()}),{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new XE("Request aborted",XE.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new XE("Network Error",XE.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||ub;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new XE(t,i.clarifyTimeoutError?XE.ETIMEDOUT:XE.ECONNABORTED,e,m)),m=null},void 0===i&&o.setContentType(null),"setRequestHeader"in m&&YE.forEach(o.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),YE.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),d&&"json"!==d&&(m.responseType=r.responseType),p&&([c,u]=yA(p,!0),m.addEventListener("progress",c)),h&&m.upload&&([a,l]=yA(h),m.upload.addEventListener("progress",a),m.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(s=t=>{m&&(n(!t||t.type?new gA(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===aC.protocols.indexOf(v)?n(new XE("Unsupported protocol "+v+":",XE.ERR_BAD_REQUEST,e)):m.send(i||null)}))},xA=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,s();const t=e instanceof Error?e:this.reason;r.abort(t instanceof XE?t:new gA(t instanceof Error?t.message:t))}};let o=t&&setTimeout((()=>{o=null,i(new XE("timeout ".concat(t," of ms exceeded"),XE.ETIMEDOUT))}),t);const s=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:a}=r;return a.unsubscribe=()=>YE.asap(s),a}},OA=Wh,kA=Eu;On({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=kA.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var NA=Eu,PA=tu;On({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=NA.f(this),n=PA(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var DA=r(OA),LA=Xb.f("asyncIterator"),MA=r(LA);function jA(e,t){this.v=e,this.k=t}function UA(e){var t,n;function r(t,n){try{var o=e[t](n),s=o.value,a=s instanceof jA;DA.resolve(a?s.v:s).then((function(n){if(a){var c="return"===t?"return":"next";if(!s.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new DA((function(o,s){var a={key:e,arg:i,resolve:o,reject:s,next:null};n?n=n.next=a:(t=n=a,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function VA(e){return function(){return new UA(e.apply(this,arguments))}}function FA(e){return new jA(e,0)}function BA(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new jA(r=new DA((function(n){n(e[t](r))})),1)}}return t[void 0!==qT&&KT||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}UA.prototype["function"==typeof qT&&MA||"@@asyncIterator"]=function(){return this},UA.prototype.next=function(e){return this._invoke("next",e)},UA.prototype.throw=function(e){return this._invoke("throw",e)},UA.prototype.return=function(e){return this._invoke("return",e)};var WA=r(LA);function zA(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=WA,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new HA(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function HA(e){function t(e){if(Object(e)!==e)return zh.reject(new TypeError(e+" is not an object."));var t=e.done;return zh.resolve(e.value).then((function(e){return{value:e,done:t}}))}return HA=function(e){this.s=e,this.n=e.next},HA.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?zh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?zh.reject(e):t(n.apply(this.s,arguments))}},new HA(e)}const GA=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},qA=function(){var e=VA((function*(e,t){var n,r=!1,i=!1;try{for(var o,s=zA(KA(e));r=!(o=yield FA(s.next())).done;r=!1){const e=o.value;yield*BA(zA(GA(e,t)))}}catch(e){i=!0,n=e}finally{try{r&&null!=s.return&&(yield FA(s.return()))}finally{if(i)throw n}}}));return function(t,n){return e.apply(this,arguments)}}(),KA=function(){var e=VA((function*(e){if(e[WA])return void(yield*BA(zA(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield FA(t.read());if(e)break;yield n}}finally{yield FA(t.cancel())}}));return function(t){return e.apply(this,arguments)}}(),$A=(e,t,n,r)=>{const i=qA(e,t);let o,s=0,a=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return a(),void e.close();let o=r.byteLength;if(n){let e=s+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw a(e),e}},cancel:e=>(a(e),i.return())},{highWaterMark:2})};function YA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YA(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const JA="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,QA=JA&&"function"==typeof ReadableStream,ZA=JA&&("function"==typeof TextEncoder?(eR=new TextEncoder,e=>eR.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var eR;const tR=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(e){return!1}},nR=QA&&tR((()=>{let e=!1;const t=new Request(aC.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),rR=QA&&tR((()=>YE.isReadableStream(new Response("").body))),iR={stream:rR&&(e=>e.body)};var oR;JA&&(oR=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!iR[e]&&(iR[e]=YE.isFunction(oR[e])?t=>t[e]():(t,n)=>{throw new XE("Response type '".concat(e,"' is not supported"),XE.ERR_NOT_SUPPORT,n)})})));const sR=async(e,t)=>{const n=YE.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(YE.isBlob(e))return e.size;if(YE.isSpecCompliantForm(e)){const t=new Request(aC.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return YE.isArrayBufferView(e)||YE.isArrayBuffer(e)?e.byteLength:(YE.isURLSearchParams(e)&&(e+=""),YE.isString(e)?(await ZA(e)).byteLength:void 0)})(t):n};var aR=JA&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:o,timeout:s,onDownloadProgress:a,onUploadProgress:c,responseType:l,headers:u,withCredentials:d="same-origin",fetchOptions:h}=RA(e);l=l?(l+"").toLowerCase():"text";let p,f=xA([i,o&&o.toAbortSignal()],s);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let g;try{if(c&&nR&&"get"!==n&&"head"!==n&&0!==(g=await sR(u,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(YE.isFormData(r)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body){const[e,t]=_A(g,yA(EA(c)));r=$A(n.body,65536,e,t)}}YE.isString(d)||(d=d?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,XA(XA({},h),{},{signal:f,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:i?d:void 0}));let o=await fetch(p);const s=rR&&("stream"===l||"response"===l);if(rR&&(a||s&&m)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=o[t]}));const t=YE.toFiniteNumber(o.headers.get("content-length")),[n,r]=a&&_A(t,yA(EA(a),!0))||[];o=new Response($A(o.body,65536,n,(()=>{r&&r(),m&&m()})),e)}l=l||"text";let v=await iR[YE.findKey(iR,l)||"text"](o,e);return!s&&m&&m(),await new zh(((t,n)=>{vA(t,n,{data:v,headers:pA.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:p})}))}catch(t){if(m&&m(),t&&"TypeError"===t.name&&/fetch/i.test(t.message))throw Object.assign(new XE("Network Error",XE.ERR_NETWORK,e,p),{cause:t.cause||t});throw XE.from(t,t&&t.code,e,p)}});const cR={http:null,xhr:IA,fetch:aR};YE.forEach(cR,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const lR=e=>"- ".concat(e),uR=e=>YE.isFunction(e)||null===e||!1===e;var dR={getAdapter:e=>{e=YE.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!uR(n)&&(r=cR[(t=String(n)).toLowerCase()],void 0===r))throw new XE("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new XE("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(lR).join("\n"):" "+lR(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:cR};function hR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new gA(null,e)}function pR(e){return hR(e),e.headers=pA.from(e.headers),e.data=fA.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),dR.getAdapter(e.adapter||sA.adapter)(e).then((function(t){return hR(e),t.data=fA.call(e,e.transformResponse,t),t.headers=pA.from(t.headers),t}),(function(t){return mA(t)||(hR(e),t&&t.response&&(t.response.data=fA.call(e,e.transformResponse,t.response),t.response.headers=pA.from(t.response.headers))),zh.reject(t)}))}const fR="1.7.9",mR={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{mR[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const gR={};mR.transitional=function(e,t,n){function r(e,t){return"[Axios v"+fR+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new XE(r(i," has been removed"+(t?" in "+t:"")),XE.ERR_DEPRECATED);return t&&!gR[i]&&(gR[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}},mR.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var vR={assertOptions:function(e,t,n){if("object"!=typeof e)throw new XE("options must be an object",XE.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],s=t[o];if(s){const t=e[o],n=void 0===t||s(t,o,e);if(!0!==n)throw new XE("option "+o+" must be "+n,XE.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new XE("Unknown option "+o,XE.ERR_BAD_OPTION)}},validators:mR};const yR=vR.validators;let _R=class{constructor(e){this.defaults=e,this.interceptors={request:new lb,response:new lb}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=AA(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&vR.assertOptions(n,{silentJSONParsing:yR.transitional(yR.boolean),forcedJSONParsing:yR.transitional(yR.boolean),clarifyTimeoutError:yR.transitional(yR.boolean)},!1),null!=r&&(YE.isFunction(r)?t.paramsSerializer={serialize:r}:vR.assertOptions(r,{encode:yR.function,serialize:yR.function},!0)),vR.assertOptions(t,{baseUrl:yR.spelling("baseURL"),withXsrfToken:yR.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&YE.merge(i.common,i[t.method]);i&&YE.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=pA.concat(o,i);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let u,d=0;if(!a){const e=[pR.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,c),u=e.length,l=zh.resolve(t);d<u;)l=l.then(e[d++],e[d++]);return l}u=s.length;let h=t;for(d=0;d<u;){const t=s[d++],n=s[d++];try{h=t(h)}catch(e){n.call(this,e);break}}try{l=pR.call(this,h)}catch(e){return zh.reject(e)}for(d=0,u=c.length;d<u;)l=l.then(c[d++],c[d++]);return l}getUri(e){return cb(SA((e=AA(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};YE.forEach(["delete","get","head","options"],(function(e){_R.prototype[e]=function(t,n){return this.request(AA(n||{},{method:e,url:t,data:(n||{}).data}))}})),YE.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(AA(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}_R.prototype[e]=t(),_R.prototype[e+"Form"]=t(!0)}));var ER=_R;class bR{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new zh((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new zh((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new gA(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new bR((function(t){e=t})),cancel:e}}}var wR=bR;const SR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(SR).forEach((e=>{let[t,n]=e;SR[n]=t}));var TR=SR;const CR=function e(t){const n=new ER(t),r=oE(ER.prototype.request,n);return YE.extend(r,ER.prototype,n,{allOwnKeys:!0}),YE.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(AA(t,n))},r}(sA);CR.Axios=ER,CR.CanceledError=gA,CR.CancelToken=wR,CR.isCancel=mA,CR.VERSION=fR,CR.toFormData=rb,CR.AxiosError=XE,CR.Cancel=CR.CanceledError,CR.all=function(e){return zh.all(e)},CR.spread=function(e){return function(t){return e.apply(null,t)}},CR.isAxiosError=function(e){return YE.isObject(e)&&!0===e.isAxiosError},CR.mergeConfig=AA,CR.AxiosHeaders=pA,CR.formToJSON=e=>iA(YE.isHTMLForm(e)?new FormData(e):e),CR.getAdapter=dR.getAdapter,CR.HttpStatusCode=TR,CR.default=CR;var AR=CR;const RR=()=>{};function IR(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:RR};return e.promise=new zh(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}const xR=new Map,OR=new Map,kR=new Map;let NR=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),PR=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const DR=new A_;let LR=DR.getResult(),MR=null;function jR(e){if(!MR){e&&DR.setUA(e),LR=DR.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return PR.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return PR.CHROME;case"Safari":case"Mobile Safari":return PR.SAFARI;case"Edge":return PR.EDGE;case"Firefox":return PR.FIREFOX;case"QQ":case"QQBrowser":return PR.QQ;case"Opera":return PR.OPERA;case"WeChat":return PR.WECHAT;default:return e.browser.name||""}}(LR),n=UR(LR),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(LR),i=LR.os.version,o=UR(LR,!1),s=LR.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:s};MR={name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:s}}return MR}function UR(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function VR(){return jR().os}function FR(){const e=jR();return"".concat(e.os," ").concat(e.osVersion)}function BR(){const e=jR();return!!("WebKit"===LR.engine.name&&e.os===NR.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==PR.SAFARI||qR()&&e.name!==PR.SAFARI)}function WR(){return jR().name===PR.CHROME}function zR(){return jR().name===PR.SAFARI}function HR(){return jR().name===PR.EDGE}function GR(){return jR().name===PR.FIREFOX}function qR(){return jR().os===NR.IOS}function KR(e){const t=jR();return!(t.name!==PR.CHROME||!t.osVersion)&&Number(t.version)>=e}function $R(e){const t=jR();return!(t.name!==PR.CHROME||!t.osVersion)&&Number(t.version)<e}function YR(e,t,n){const r=jR();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function XR(e){const t=jR();return!(t.name!==PR.EDGE||!t.osVersion)&&Number(t.version)>=e}function JR(e){const t=jR();return!(t.name!==PR.SAFARI||!t.osVersion)&&Number(t.version)>=e}function QR(e,t,n){const r=jR();if(r.os!==NR.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function ZR(e,t,n){const r=jR();if(r.name!==PR.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function eI(e){const t=jR();return!(t.name!==PR.OPERA||!t.osVersion)&&Number(t.version)>=e}function tI(){const e=jR();if(e.os!==NR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function nI(){const e=jR();if(e.os!==NR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function rI(){const e=jR();if(e.os!==NR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function iI(){const e=jR();if(e.os!==NR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function oI(){return zR()&&navigator.maxTouchPoints>0}function sI(){return jR().name===PR.WECHAT}function aI(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function cI(){const e=VR();return function(){const{deviceType:e}=jR();return"mobile"===e||"tablet"===e}()||e===NR.ANDROID||e===NR.IOS||e===NR.HARMONY_OS}function lI(){const e=jR();return e.name!==PR.EDGE&&e.name!==PR.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function uI(){return VR()===NR.ANDROID}function dI(){const e=jR();return uI()&&(e.name===PR.CHROME||e.name===PR.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function hI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hI(Object(n),!0).forEach((function(t){fI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fI(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let mI=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),gI=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),fI(this,"code",void 0),fI(this,"message",void 0),fI(this,"data",void 0),fI(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function vI(e,t){if("boolean"!=typeof e)throw new gI(mI.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function yI(e,t,n){if(!Nr(n).call(n,e))throw new gI(mI.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function _I(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new gI(mI.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function EI(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new gI(mI.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&_I(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&_I(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&_I(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&_I(e.ideal,"".concat(t,".ideal"),1,1/0)}else _I(e,t,1,1/0)}function bI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new gI(mI.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!TI(e,n,r,i))throw new gI(mI.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function wI(e,t){if(!Array.isArray(e))throw new gI(mI.INVALID_PARAMS,"".concat(t," should be an array"))}function SI(e){return null==e}function TI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var CI=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(CI||{}),AI=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(AI||{});const RI=new class{constructor(){fI(this,"_clientSize",null),fI(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),fI(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),fI(this,"getStyle",(e=>window.getComputedStyle(e,null))),fI(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:o,opacity:s,filter:a}=r;return("none"===i||Nr(t=["hidden","collapse"]).call(t,o)||Number(s)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter((e=>{var t;const n=e.split("(")[0];return Nr(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),fI(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n})),fI(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),fI(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:s}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:s,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}})),fI(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),fI(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),fI(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),fI(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,s=[],a=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*a+(0===c?.1:4===c?(i*c*a-1e5)/a:i*c)*a)/a,l=(r*a+(0===e?.1:4===e?(o*e*a-1e5)/a:o*e)*a)/a;s.push({x:t,y:l})}return[...s]})),fI(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),fI(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),fI(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:s}=this._clientSize;let a,c,l,u;if(e<0)a=0;else{if(!(e<o))return!1;a=e}if(t<0)return!1;if(c=t<o?t:o,n<0)l=0;else{if(!(n<i))return!1;l=n}if(r<0)return!1;u=r<i?r:i;const d=c-a,h=u-l;return this.checkSizeIsVisible(d,h,s)})),fI(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),fI(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(CI.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(CI.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(CI.SIZE)}}return this.returnHiddenResult(CI.STYLE)}return this.returnHiddenResult(AI.UNMOUNTED)}return this.returnHiddenResult(AI.INVALID_HTML_ELEMENT)})),fI(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function II(e){return(new TextEncoder).encode(e)}const xI=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},OI=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(t).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",II(e)),16);let kI=class{constructor(){fI(this,"_events",{}),fI(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){const n=t[o];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},NI=null;function PI(){if(NI)return NI;if(window.electron)return NI=window.electron;if(!window.require)return null;try{return NI=window.require("electron"),NI}catch(e){return null}}let DI=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),LI=function(e){return e.TRACER="tracer",e}({});function MI(e){return _I(e.timeout,"config.timeout",0,1e5),_I(e.timeoutFactor,"config.timeoutFactor",0,100,!1),_I(e.maxRetryCount,"config.maxRetryConfig",0,1/0),_I(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let jI=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),UI=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function VI(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function FI(e){return bI(e.turnServerURL,"turnServerURL"),bI(e.username,"username"),bI(e.password,"password"),e.udpport&&_I(e.udpport,"udpport",1,99999,!0),e.forceturn&&vI(e.forceturn,"forceturn"),e.security&&vI(e.security,"security"),e.tcpport&&_I(e.tcpport,"tcpport",1,99999,!0),!0}function BI(e){return void 0!==e.level&&yI(e.level,"level",[1,2,3]),void 0!==e.delay&&_I(e.delay,"delay",0,3e3,!0),!0}let WI=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),zI=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),HI=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),GI=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function qI(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?zh.reject(new gI(mI.UNEXPECTED_ERROR,"can not emit promise")):new zh(((n,i)=>{e.emit(t,...r,n,i)}))}function KI(e,t){if(0===e.getListeners(t).length)return zh.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return qI(e,t,...r)}function $I(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return YI(e,t,...r)}function YI(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new gI(mI.UNEXPECTED_ERROR,"handler is not sync");return n}const XI=new class extends kI{set networkState(e){this.emit(GI.NETWORK_STATE_CHANGE,e,this._networkState),e===HI.ONLINE?this.emit(GI.ONLINE):e===HI.OFFLINE&&(this.onlineWaiter=new zh((e=>{this.once(GI.ONLINE,(()=>{this.onlineWaiter=void 0,e(HI.ONLINE)}))})),this.emit(GI.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===HI.ONLINE}constructor(){super(),fI(this,"_moduleName","network-indicator"),fI(this,"_networkState",HI.ONLINE),fI(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=HI.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=HI.OFFLINE}))}};function JI(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function QI(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function ZI(e){void 0!==zh?zh.resolve().then(e):setTimeout(e,0)}function ex(e){return JSON.parse(JSON.stringify(e))}function tx(e){try{return ex(e)}catch(t){return e}}const nx={};function rx(e,t){nx[t]||(nx[t]=!0,e())}function ix(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function ox(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function sx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function ax(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Xr(t).call(t,((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(r));let o=0;return t.forEach((e=>{i.set(e,o),o+=e.length})),i}function cx(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function lx(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?cx(e):e.size})),t+138}function ux(e){const t=new gI(mI.TIMEOUT,"timeout");return new zh(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function dx(e){return new zh((t=>{window.setTimeout(t,e)}))}function hx(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+hx(e-n.length,"")}function px(){return hx(32,"").toUpperCase()}const fx=()=>{},mx=new class{constructor(){fI(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),s=4;s<i;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const s=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,pI(pI({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},gx=mx.throttleByKey.bind(mx);function vx(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function yx(e,t){if(!vx(e)||!vx(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=yx(e[r],t[r]);return n}{const n=pI({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=yx(e[r],t[r]):n[r]=t[r]);return n}}function _x(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function Ex(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function bx(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,s){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,s)),o),n)}function o(e,t,n,r,o,s,a){return i(t&n|~t&r,e,t,o,s,a)}function s(e,t,n,r,o,s,a){return i(t&r|n&~r,e,t,o,s,a)}function a(e,t,n,r,o,s,a){return i(t^n^r,e,t,o,s,a)}function c(e,t,n,r,o,s,a){return i(n^(t|~r),e,t,o,s,a)}const l=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let u,d,h,p,f,m=1732584193,g=-271733879,v=-1732584194,y=271733878;for(u=0;u<l.length;u+=16)d=m,h=g,p=v,f=y,m=o(m,g,v,y,l[u+0],7,-680876936),y=o(y,m,g,v,l[u+1],12,-389564586),v=o(v,y,m,g,l[u+2],17,606105819),g=o(g,v,y,m,l[u+3],22,-1044525330),m=o(m,g,v,y,l[u+4],7,-176418897),y=o(y,m,g,v,l[u+5],12,1200080426),v=o(v,y,m,g,l[u+6],17,-1473231341),g=o(g,v,y,m,l[u+7],22,-45705983),m=o(m,g,v,y,l[u+8],7,1770035416),y=o(y,m,g,v,l[u+9],12,-1958414417),v=o(v,y,m,g,l[u+10],17,-42063),g=o(g,v,y,m,l[u+11],22,-1990404162),m=o(m,g,v,y,l[u+12],7,1804603682),y=o(y,m,g,v,l[u+13],12,-40341101),v=o(v,y,m,g,l[u+14],17,-1502002290),g=o(g,v,y,m,l[u+15],22,1236535329),m=s(m,g,v,y,l[u+1],5,-165796510),y=s(y,m,g,v,l[u+6],9,-1069501632),v=s(v,y,m,g,l[u+11],14,643717713),g=s(g,v,y,m,l[u+0],20,-373897302),m=s(m,g,v,y,l[u+5],5,-701558691),y=s(y,m,g,v,l[u+10],9,38016083),v=s(v,y,m,g,l[u+15],14,-660478335),g=s(g,v,y,m,l[u+4],20,-405537848),m=s(m,g,v,y,l[u+9],5,568446438),y=s(y,m,g,v,l[u+14],9,-1019803690),v=s(v,y,m,g,l[u+3],14,-187363961),g=s(g,v,y,m,l[u+8],20,1163531501),m=s(m,g,v,y,l[u+13],5,-1444681467),y=s(y,m,g,v,l[u+2],9,-51403784),v=s(v,y,m,g,l[u+7],14,1735328473),g=s(g,v,y,m,l[u+12],20,-1926607734),m=a(m,g,v,y,l[u+5],4,-378558),y=a(y,m,g,v,l[u+8],11,-2022574463),v=a(v,y,m,g,l[u+11],16,1839030562),g=a(g,v,y,m,l[u+14],23,-35309556),m=a(m,g,v,y,l[u+1],4,-1530992060),y=a(y,m,g,v,l[u+4],11,1272893353),v=a(v,y,m,g,l[u+7],16,-155497632),g=a(g,v,y,m,l[u+10],23,-1094730640),m=a(m,g,v,y,l[u+13],4,681279174),y=a(y,m,g,v,l[u+0],11,-358537222),v=a(v,y,m,g,l[u+3],16,-722521979),g=a(g,v,y,m,l[u+6],23,76029189),m=a(m,g,v,y,l[u+9],4,-640364487),y=a(y,m,g,v,l[u+12],11,-421815835),v=a(v,y,m,g,l[u+15],16,530742520),g=a(g,v,y,m,l[u+2],23,-995338651),m=c(m,g,v,y,l[u+0],6,-198630844),y=c(y,m,g,v,l[u+7],10,1126891415),v=c(v,y,m,g,l[u+14],15,-1416354905),g=c(g,v,y,m,l[u+5],21,-57434055),m=c(m,g,v,y,l[u+12],6,1700485571),y=c(y,m,g,v,l[u+3],10,-1894986606),v=c(v,y,m,g,l[u+10],15,-1051523),g=c(g,v,y,m,l[u+1],21,-2054922799),m=c(m,g,v,y,l[u+8],6,1873313359),y=c(y,m,g,v,l[u+15],10,-30611744),v=c(v,y,m,g,l[u+6],15,-1560198380),g=c(g,v,y,m,l[u+13],21,1309151649),m=c(m,g,v,y,l[u+4],6,-145523070),y=c(y,m,g,v,l[u+11],10,-1120210379),v=c(v,y,m,g,l[u+2],15,718787259),g=c(g,v,y,m,l[u+9],21,-343485551),m=r(m,d),g=r(g,h),v=r(v,p),y=r(y,f);return n(m)+n(g)+n(v)+n(y)}let wx=1,Sx=console,Tx=class{static setLogger(e){Sx=e}constructor(e,t){fI(this,"id",void 0),fI(this,"lockingPromise",zh.resolve()),fI(this,"locks",0),fI(this,"name",""),fI(this,"lockId",void 0),this.lockId=wx++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");Sx.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new zh((n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function Cx(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await o.apply(this,a)}finally{i()}},i}}const Ax={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Rx(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ix(e,t,n,r){const i=Object.assign({},Ax,r);let o=i.timeout;const s=async()=>{await function(e){return new zh((t=>{window.setTimeout(t,e)}))}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let a=!1;const c=new zh((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(a)return o(new gI(mI.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await s()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await s()}}}));return c.cancel=()=>a=!0,c}let xx,Ox=class{constructor(e){fI(this,"input",[]),fI(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Xr(e=this.input).call(e,((e,t)=>e+t))/this.input.length}},kx=0,Nx=0;function Px(e,t,n,r){return new zh(((i,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),kx+=cx(t.data)):n&&(t.data.size?kx+=t.data.size:t.data instanceof FormData?kx+=lx(t.data):kx+=cx(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,AR.request(t).then((e=>{"string"==typeof e.data?Nx+=cx(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Nx+=e.data.byteLength:Nx+=cx(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{AR.isCancel(e)?o(new gI(mI.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new gI(mI.NETWORK_TIMEOUT,e.message)):e.response?o(new gI(mI.NETWORK_RESPONSE_ERROR,e.response.status)):o(new gI(mI.NETWORK_ERROR,e.message))}))}))}async function Dx(e,t){const n=new Blob([t.data],{type:"buffer"});return await Px(e,pI(pI({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Lx=()=>void 0!==window.isSecureContext;function Mx(e){if(Array.isArray(e))return e.map((e=>e));if(!jx(e))return e;const t={};for(const n in e){const r=e[n];jx(r)||Array.isArray(r)?t[n]=Mx(r):t[n]=r}return t}function jx(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let Ux=class{constructor(e){fI(this,"input",[]),fI(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Vx={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Fx={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Vx,remoteCandidate:Vx},updateInterval:0},Bx={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},Wx={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},zx={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Hx={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let Gx=class{constructor(e,t){fI(this,"onFirstVideoReceived",void 0),fI(this,"onFirstVideoDecoded",void 0),fI(this,"onFirstAudioReceived",void 0),fI(this,"onFirstVideoDecodedTimeout",void 0),fI(this,"onFirstAudioDecoded",void 0),fI(this,"onSelectedLocalCandidateChanged",void 0),fI(this,"onSelectedRemoteCandidateChanged",void 0),fI(this,"videoIsReady",!1),fI(this,"videoIsReady2",{}),fI(this,"pc",void 0),fI(this,"options",void 0),fI(this,"intervalTimer",void 0),fI(this,"stats",Mx(Fx)),fI(this,"isFirstVideoReceived",{}),fI(this,"isFirstVideoDecoded",{}),fI(this,"isFirstAudioReceived",{}),fI(this,"isFirstAudioDecoded",{}),fI(this,"isFirstVideoDecodedTimeout",{}),fI(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new zh((e=>{e({local:pI({},Vx),remote:pI({},Vx)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,s=0;for(const a of n)e[a].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][a][n]||!this.lossRateWindowStats[0][a][n])return;const c=this.lossRateWindowStats[t-1][a][n].packets-this.lossRateWindowStats[0][a][n].packets,l=this.lossRateWindowStats[t-1][a][n].packetsLost-this.lossRateWindowStats[0][a][n].packetsLost;"videoSend"===a||"audioSend"===a?(r+=c,o+=l):(i+=c,s+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||s<=0?0:s/(i+s)}},qx=class extends Gx{constructor(){super(...arguments),fI(this,"_stats",Fx),fI(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Mx(Fx);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;const n=Nr(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=Mx(Wx);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=Mx(Bx),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:pI({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=Mx(Hx);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=Mx(zx);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new zh(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}},Kx=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),$x=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Yx=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Xx=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Jx=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Jx||{});function Qx(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Jx.kNone;if(!t)return;const o=Number(t[n]);if("number"!=typeof o)return;const s=Number(t[r]);if("number"!=typeof s)return;if(!e)return s?o/s*i:void 0;const a=Number(e[n]);if("number"!=typeof a)return;const c=Number(e[r]);if("number"!=typeof c)return;const l=s-c;return l?(o-a)/l*i:void 0}let Zx=class extends Gx{constructor(){super(...arguments),fI(this,"_stats",Fx),fI(this,"report",void 0),fI(this,"lastDecodeVideoReceiverStats",new Map),fI(this,"lastVideoFramesRecv",new Map),fI(this,"lastVideoFramesSent",new Map),fI(this,"lastVideoFramesDecode",new Map),fI(this,"lastVideoFramesOutput",new Map),fI(this,"lastVideoJBDelay",new Map),fI(this,"lastAudioJBDelay",new Map),fI(this,"mediaBytesSent",new Map),fI(this,"mediaBytesRetransmit",new Map),fI(this,"mediaBytesTargetEncode",new Map),fI(this,"lastDecodeAudioReceiverStats",new Map),fI(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Mx(Fx),this.report.forEach((e=>{switch(e.type){case Xx.OUTBOUND:case Xx.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Xx.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===Xx.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case Xx.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Xx.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:pI({},Vx),remote:pI({},Vx)};return e.forEach((n=>{let r;if(n.type===Xx.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===Xx.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Xx.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Xx.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Xx.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(pI({},t),pI({},this.stats.selectedCandidatePair.localCandidate)),e.type===Xx.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(pI({},t),pI({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=Mx(Hx),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Qx(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Jx.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,pI({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=Mx(Bx),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,i=o-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Qx(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Qx(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",Jx.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Qx(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Jx.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Qx(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",Jx.kMillisecondsFromSeconds),r&&o-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:pI({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=Mx(Wx),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new Ux(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new Ux(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new Ux(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Xx.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=Mx(zx),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Xx.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(Qh(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null==a?void 0:a.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let l=null!==(i=null==a?void 0:a.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(o=null==a?void 0:a.frameHeight)&&void 0!==o?o:e.frameHeight,d=null!==(s=null==a?void 0:a.framesPerSecond)&&void 0!==s?s:e.framesPerSecond;if("number"==typeof l&&"number"==typeof u||(l=0,u=0),null==d){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(d=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:d})):t?d=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:u,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,s,a;const c=t?this.report.get(t):void 0,l=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,u=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(s=null==c?void 0:c.jitterBufferDelay)&&void 0!==s?s:e.jitterBufferDelay,p=null!==(a=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let r=0;e&&t-e.lts>=800?(r=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:u||0,height:d||0,frameRate:r||0},n.decodedFrame={width:u||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:u||0,height:d||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==a?void 0:a.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,l=null!==(o=null!==(s=null==a?void 0:a.echoReturnLossEnhancement)&&void 0!==s?s:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var r,i,o,s,a,c,l;const u=t?this.report.get(t):void 0,d=null!==(r=null==u?void 0:u.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,h=null!==(i=null==u?void 0:u.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(o=null==u?void 0:u.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(s=null==u?void 0:u.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount,m=null!==(a=null==u?void 0:u.audioLevel)&&void 0!==a?a:null==e?void 0:e.audioLevel,g=null!==(c=null==u?void 0:u.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,v=null!==(l=null==u?void 0:u.concealedSamples)&&void 0!==l?l:e.concealedSamples;if("number"==typeof h&&(n.totalSamplesReceived=h),d&&h&&(n.accelerateRate=d/h),p&&f){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=f-e.jitterBufferEmittedCount;r>0&&(t=1e3*(p-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=m;let y=1920;g&&h&&(y=h/g/50,n.receivedFrames=Math.round(h/y)),v&&(n.droppedFrames=Math.round(v/y))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},eO=class extends Gx{updateStats(){return zh.resolve()}};function tO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new qx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new Zx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof zh||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new Zx(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new eO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const nO="websdk_ng_install_id";function rO(){try{if(fO("INSTALL_ID"))return fO("INSTALL_ID");let e=window.localStorage.getItem(nO);return e||(e=px(),window.localStorage.setItem(nO,e)),pO("INSTALL_ID",e),e}catch(e){return}}const iO=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}return"4.0.0.999"}("4.23.2"),oO=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let sO=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const aO=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const o=i.join(""),s={};return s[e]=r,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=aO;const cO={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},lO={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},uO="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",dO={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},hO=pI(pI(pI({},dO),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:lO,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},cO),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function pO(e,t,n){var r,i,o;Nr(r=Object.keys(hO)).call(r,e)&&(!n&&Nr(i=Object.keys(gO)).call(i,e)||(hO[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS_METADATA"!==e||!0!==t||(hO.ENABLE_ENCODED_TRANSFORM=!0,"ENABLE_AUDIO_PTS_METADATA"===e&&(hO.ENABLE_AUDIO_METADATA=!0)),"USE_NEW_NETWORK_CONFIG"===e&&t&&(o=!!t,hO.USE_NEW_NETWORK_CONFIG=o,o&&(hO.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],hO.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],hO.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],hO.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],hO.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",hO.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",hO.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(hO.ENABLE_INSTANT_VIDEO=!0,hO.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(hO.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(hO.NEW_TURN_MODE||(hO.NEW_TURN_MODE=4))))}function fO(e){return hO[e]}oO||(hO.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],hO.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],hO.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],hO.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],hO.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],hO.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],hO.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",hO.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",hO.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",hO.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",hO.AREAS=["NORTH_AMERICA","OVERSEA"]);let mO=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const gO={};var vO=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(vO||{});let yO=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const _O=128,EO=96,bO=1e3,wO=10;let SO=0;var TO=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>w,Printer:()=>R,parse:()=>k,print:()=>N});const r="\n",i="".concat("\r").concat(r),o=" ";let s;function a(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function u(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function d(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function m(e){return h(e)||a(e)||"+"===e||"/"===e}function g(e){return a(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function v(e){return h(e)||a(e)||"+"===e||"/"===e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(s||(s={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&a(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;a(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let o=0;o<3;o++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!d(e[t]))throw new Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!d(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&a(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,u)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(d(e[n])&&(n+=1);a(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,a),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!d(e[t]))throw new Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class w extends b{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!xy(e).call(e))).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),s=this.parseUri(),a=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),u=this.parseBandWidth(),d=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:s,emails:a,phones:c,connection:l,bandwidths:u,timeFields:d,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new T;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>u(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new C(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>u(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===s.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===s.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.BANDWIDTH)break;{const n=this.extractOneOrMore(t,u);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,a);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==s.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==s.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===s.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==s.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===s.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===s.CONNECTION){const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===s.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:s})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.value,e.cur,...r),s=e.value.slice(e.cur,o);return e.cur=o,s}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class S extends b{constructor(){super(...arguments),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,s]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof s&&i.length>s)throw new Error("error in length, should be less or equal than ".concat(s," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.attValue,e._cur,...r),s=e.attValue.slice(e._cur,o);return e._cur=o,s}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,a);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=_(_({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class T extends S{constructor(){super(...arguments),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,v),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==o&&f(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class C extends S{constructor(e){super(),E(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const u={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:s,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),u.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),u.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),u.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(u)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=xy(t).call(t);const i="string"==typeof n?xy(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,u),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,u),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,u,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,u,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>h(e)||a(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class R{constructor(){A(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new x(this.eol).print(e)}printMediaAttributes(e){return new O(this.eol).print(e)}}class I{constructor(e){A(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class x extends I{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class O extends I{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function k(e){return(new w).parse(e)}function N(e,t){return(new R).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();function CO(e){return TO.parse(e)}function AO(e,t){return TO.print(e,t)}var RO=Qn("Array").keys,IO=fr,xO=Ze,OO=d,kO=RO,NO=Array.prototype,PO={DOMTokenList:!0,NodeList:!0},DO=function(e){var t=e.keys;return e===NO||OO(NO,e)&&t===NO.keys||xO(PO,IO(e))?kO:t},LO=r(DO);function MO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?MO(Object(n),!0).forEach((function(t){UO(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function UO(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const VO=new class extends kI{constructor(){super(...arguments),UO(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class FO{constructor(e){UO(this,"logger",void 0),UO(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function BO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function WO(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const zO={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},HO=Date.now(),GO=e=>{for(const t in zO)if(Object.prototype.hasOwnProperty.call(zO,t)&&zO[t]===e)return t;return"DEFAULT"},qO=new class{constructor(){UO(this,"proxyServerURL",void 0),UO(this,"logLevel",zO.DEBUG),UO(this,"uploadState","collecting"),UO(this,"uploadLogWaitingList",[]),UO(this,"uploadLogUploadingList",[]),UO(this,"uploadErrorCount",0),UO(this,"currentLogID",0),UO(this,"url",void 0),UO(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[zO.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[zO.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[zO.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[zO.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[zO.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){pO("UPLOAD_LOG",!0)}disableLogUpload(){pO("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new FO(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-HO<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-HO);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=BO()+" Agora-SDK [".concat(GO(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=BO()+" %cAgora-SDK [".concat(GO(r),"]:");let o=[];if(!fO("USE_NEW_LOG"))switch(r){case zO.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case zO.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case zO.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case zO.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-HO<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-HO);const r=Math.max(0,Math.min(4,t[0]));t[0]=BO()+" Agora-SDK [".concat(GO(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!fO("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=WO()+" Agora-SDK [".concat(GO(e),"]:"):n[0]=WO()+" Agora-SDK [".concat(GO(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:iO,process_id:fO("PROCESS_ID"),payload:JSON.stringify(e)};return Ix((async()=>{const e=await AR.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(fO("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(fO("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>{const n={status:-1,message:t.message,errorRange:e.map((e=>e.log_item_id))};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),VO.reportLogUploadError(n),!0}),{timeout:fO("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:fO("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,fO("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),fO("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),fO("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),fO("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var KO;function $O(e){return bI(e.reportId,"params.reportId",0,100,!1),bI(e.category,"params.category",0,100,!1),bI(e.event,"params.event",0,100,!1),bI(e.label,"params.label",0,100,!1),_I(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(KO={}).FREE="free",KO.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const YO={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let XO=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),JO=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let QO=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function ZO(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t,r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];let c=s;if(e.argsMap)try{c=e.argsMap(this,...s)}catch(e){qO.warning(e),c=[]}try{JSON.stringify(c)}catch(e){qO.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}const l=(e.report||ek).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(o,".").concat(String(n)),options:c,tag:LI.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,s);return t instanceof zh?t.then((t=>(l.onSuccess(e.reportResult&&t),t))).catch((e=>{throw l.onError(e),e})):(l.onSuccess(e.reportResult&&t),t)}catch(e){throw l.onError(e),e}}}return r}}const ek=new class{constructor(){UO(this,"baseInfoMap",new Map),UO(this,"proxyServer",void 0),UO(this,"eventUploadTimer",void 0),UO(this,"setSessionIdTimer",void 0),UO(this,"url",void 0),UO(this,"sids",new Set),UO(this,"backupUrl",void 0),UO(this,"_appId",void 0),UO(this,"_aid",0),UO(this,"keyEventUploadPendingItems",[]),UO(this,"normalEventUploadPendingItems",[]),UO(this,"apiInvokeUploadPendingItems",[]),UO(this,"apiInvokeCount",0),UO(this,"apiInvokeLoggedCount",0),UO(this,"ltsList",[]),UO(this,"lastSendNormalEventTime",Date.now()),UO(this,"customReportCounterTimer",void 0),UO(this,"customReportCount",0),UO(this,"extApiInvoke",(async e=>{for(const t of e){const e=jO(jO({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:LI.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),fO("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),fO("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(e=>{let[t,n]=e;return t+n})),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=!!fO("SHOW_REPORT_INVOKER_LOG"),s=!!fO("SHOW_REPORT_USER_INVOKER_LOG"),a=o||s&&t.id;a&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function l(e,n){if(a){let r="[apiInvoke-".concat(c,"]");t.id&&(r+="[".concat(t.id,"]")),t.name&&(r+="[".concat(t.name,"]")),qO.info("".concat(r," ").concat(e),"start"===e?t.options:n||"")}}const u=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});l("start");let d=!1;dx(t.timeout).then((()=>{d||(this.sendApiInvoke(jO(jO({},u()),{},{error:mI.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))}));const h=new gI(mI.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(d)throw h;return d=!0,this.sendApiInvoke(jO(jO({},u()),{},{success:!0},t.reportResult&&{result:e})),l("onSuccess"),e};return n?gx(r,t.name+"Success",n,(()=>d=!0)):r()},onError:e=>{const r=()=>{if(d)throw e;d=!0,this.sendApiInvoke(jO(jO({},u()),{},{success:!1,error:e})),l("onFailure",e.toString())};return n?gx(r,t.name+"Error",n,(()=>d=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:fO("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:oO?"global":"oversea",areas:fO("AREAS")&&fO("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:l,clientRole:u}=t,d=Date.now(),h=jO(jO({},r),{},{eventType:XO.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:uO,lts:d,elapse:d-n,extend:JSON.stringify(i),mode:t.mode,process:fO("PROCESS_ID"),appType:fO("APP_TYPE"),success:!0,version:iO,stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:l,clientType:Nr(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:u,serviceId:fO("PROCESS_ID"),extensionID:fO("PLUGIN_INFO").join(",")||""});var p;this.send({type:JO.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{role:t.role,eventType:XO.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:JO.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{eventType:XO.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:JO.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:s,addr:a,isProxy:c}=t,l=i-(o&&s?s:n.startTime),u=jO(jO({},r),{},{eventType:XO.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:rO(),isABTestSuccess:t.isABTestSuccess?1:0}),d=u.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:JO.JOIN_GATEWAY,data:u},!0);else{let e;if(a)if(c){const t=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=a.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:c?1:0}}else{const t=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=a.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:c?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);const t=Object.assign({},u,e,{eventType:XO.REJOIN_GATEWAY});this.send({type:JO.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=jO(jO({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:JO.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{eventType:XO.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:JO.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),s=jO(jO({},i),{},{eventType:XO.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?s.peerSuid=t.peerid:s.peer=t.peerid,this.send({type:JO.SUBSCRIBE,data:s},!0)}wsCompressorInit(e){var t;const n=[...LO(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,s=Date.now(),a=jO(jO({},o),{},{eventType:XO.WS_COMPRESSOR_INIT,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,status:e.status?1:2});this.send({type:JO.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=jO(jO(jO({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s,firstDecodeFrame:Math.max((r.firstFrame||s)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=jO(jO(jO({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s});this.send({type:n,data:a},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO(jO({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:XO.AB_TEST,lts:i});this.send({type:JO.AB_TEST,data:o},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO(jO({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:XO.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:JO.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO(jO({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:XO.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:JO.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=jO(jO(jO({},o),r),{},{eventType:t,lts:s});this.send({type:n,data:a},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{eventType:XO.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:JO.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{eventType:XO.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:JO.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{eventType:XO.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:JO.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?qO.debug("reportProxyServerurl: ".concat(e)):qO.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:JO.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=cx(JSON.stringify(e));let o=0;const s=[];let a=0;for(let c=0;c<r.length;c++)a+=r.charCodeAt(c)<=127?1:3,a<=n-i||(s[s.length]=pI(pI({},e),{},{[t]:r.substring(o,c)}),o=c,a=r.charCodeAt(c)<=127?1:3);return o!==r.length-1&&(s[s.length]=pI(pI({},e),{},{[t]:r.substring(o)})),s})(jO(jO(jO({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((e=>this.send({type:JO.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO(jO({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:JO.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO(jO({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:JO.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=jO(jO(jO({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:JO.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>fO("CUSTOM_REPORT_LIMIT"))throw new gI(mI.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:JO.USER_ANALYTICS,data:jO(jO({sid:e},t),{},{lts:n})})));try{fO("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw qO.error("send custom report message failed",e.toString()),new gI(mI.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=fO("NOT_REPORT_EVENT");if(e.tag&&Nr(t)&&Nr(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let s;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof gI){const{code:t,message:n}=e.error;s=t||n||e.error.toString()}else s=e.error.toString();const a={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?s:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:JO.API_INVOKE,data:a},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find((e=>null!==e));t&&e.forEach((e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>fO("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const o of[...n]){var i;-1!==this.ltsList.indexOf(o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),w_(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),fO("ENABLE_EVENT_REPORT")?(n.length&&(fO("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{fO("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>fO("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-fO("NORMAL_EVENT_QUEUE_CAPACITY")),qO.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){XI.networkState===HI.OFFLINE&&await zh.race([XI.onlineWaiter,dx(2*Ax.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=II(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(JO).forEach((n=>{let[r,i]=n;i===e.type&&(t=QO[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=xI(t,new Uint8Array(r)),t=xI(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(fO("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(fO("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(fO("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(fO("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Px(r,{timeout:1e4,data:t(e),headers:jO(jO({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:n,aid:r};XI.networkState===HI.OFFLINE&&await zh.race([XI.onlineWaiter,dx(2*Ax.maxRetryTimeout)]);const o=t?"/events/proto-raws":"/events/messages";let s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(fO("EVENT_REPORT_DOMAIN"),"&p=").concat(fO("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(fO("EVENT_REPORT_DOMAIN"),":").concat(fO("STATS_COLLECTOR_PORT")).concat(o));for(let a=0;a<2;a+=1){1===a&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(fO("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(fO("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(fO("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(fO("STATS_COLLECTOR_PORT")).concat(o)));try{t?await Dx(s,{timeout:1e4,data:i}):await Px(s,{timeout:1e4,data:i})}catch(t){if(1===a)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},YO);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:LI.TRACER}).onSuccess()}};VO.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=XI.networkState,ek.reportApiInvoke(null,{name:"logUploadError",options:e,tag:LI.TRACER}).onSuccess("logUploadError")}));class tk extends gI{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),UO(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,qO)}throw(){super.throw(qO)}}const nk={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function rk(){return nk}function ik(){return"setSinkId"in HTMLAudioElement.prototype&&(!fO("RESTRICTION_SET_PLAYBACK_DEVICE")||(WR()||HR())&&!cI())}function ok(){return!nk.supportUnifiedPlan||fO("CHROME_FORCE_PLAN_B")&&lI()}let sk=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function ak(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function ck(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function lk(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function uk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const dk={"90p":ck(160,90),"90p_1":ck(160,90),"120p":ck(160,120,15,30,65),"120p_1":ck(160,120,15,30,65),"120p_3":ck(120,120,15,30,50),"120p_4":ck(212,120),"180p":ck(320,180,15,30,140),"180p_1":ck(320,180,15,30,140),"180p_3":ck(180,180,15,30,100),"180p_4":ck(240,180,15,30,120),"240p":ck(320,240,15,40,200),"240p_1":ck(320,240,15,40,200),"240p_3":ck(240,240,15,40,140),"240p_4":ck(424,240,15,40,220),"360p":ck(640,360,15,80,400),"360p_1":ck(640,360,15,80,400),"360p_3":ck(360,360,15,80,260),"360p_4":ck(640,360,30,80,600),"360p_6":ck(360,360,30,80,400),"360p_7":ck(480,360,15,80,320),"360p_8":ck(480,360,30,80,490),"360p_9":ck(640,360,15,80,800),"360p_10":ck(640,360,24,80,800),"360p_11":ck(640,360,24,80,1e3),"480p":ck(640,480,15,100,500),"480p_1":ck(640,480,15,100,500),"480p_2":ck(640,480,30,100,1e3),"480p_3":ck(480,480,15,100,400),"480p_4":ck(640,480,30,100,750),"480p_6":ck(480,480,30,100,600),"480p_8":ck(848,480,15,100,610),"480p_9":ck(848,480,30,100,930),"480p_10":ck(640,480,10,100,400),"720p":ck(1280,720,15,120,1130),"720p_auto":ck(1280,720,30,900,3e3),"720p_1":ck(1280,720,15,120,1130),"720p_2":ck(1280,720,30,120,2e3),"720p_3":ck(1280,720,30,120,1710),"720p_5":ck(960,720,15,120,910),"720p_6":ck(960,720,30,120,1380),"1080p":ck(1920,1080,15,120,2080),"1080p_1":ck(1920,1080,15,120,2080),"1080p_2":ck(1920,1080,30,120,3e3),"1080p_3":ck(1920,1080,30,120,3150),"1080p_5":ck(1920,1080,60,120,4780),"1440p":ck(2560,1440,30,120,4850),"1440p_1":ck(2560,1440,30,120,4850),"1440p_2":ck(2560,1440,60,120,7350),"4k":ck(3840,2160,30,120,8910),"4k_1":ck(3840,2160,30,120,8910),"4k_3":ck(3840,2160,60,120,13500)},hk={"480p":lk(640,480,5),"480p_1":lk(640,480,5),"480p_2":lk(640,480,30),"480p_3":lk(640,480,15),"720p":lk(1280,720,5),"720p_auto":ck(1280,720,30,900,3e3),"720p_1":lk(1280,720,5),"720p_2":lk(1280,720,30),"720p_3":lk(1280,720,15),"1080p":lk(1920,1080,5),"1080p_1":lk(1920,1080,5),"1080p_2":lk(1920,1080,30),"1080p_3":lk(1920,1080,15)},pk={"1SL1TL":uk(1,1),"3SL3TL":uk(3,3),"2SL3TL":uk(2,3)};function fk(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},dk[e]):e}function mk(e){return"string"==typeof e?Object.assign({},hk[e]):e}function gk(e){return"string"==typeof e?Object.assign({},pk[e]):e}const vk={speech_low_quality:ak(16e3,!1),speech_standard:ak(32e3,!1,18),music_standard:ak(48e3,!1),standard_stereo:ak(48e3,!0,56),high_quality:ak(48e3,!1,128),high_quality_stereo:ak(48e3,!0,192)};function yk(e){return"string"==typeof e?Object.assign({},vk[e]):e}const _k=[];function Ek(e){return yI(e,"mediaSource",["screen","window","application"]),!0}let bk=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),wk=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Sk=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Tk=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Ck=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Ak=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Rk=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ik=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),xk=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Ok=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const kk={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Nk={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Pk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Dk={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Lk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Mk=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),jk=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Uk=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Vk=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Fk=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Bk=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const Wk={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let zk=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Hk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hk(Object(n),!0).forEach((function(t){qk(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hk(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qk(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kk(e,t,n,r,i){var o,s,a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=Xr(o=li(s=n.slice()).call(s)).call(o,(function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}class $k extends kI{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Ak.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),qk(this,"trackMediaType",void 0),qk(this,"_ID",void 0),qk(this,"_rtpTransceiver",void 0),qk(this,"_lowRtpTransceiver",void 0),qk(this,"_hints",[]),qk(this,"_isClosed",!1),qk(this,"_originMediaStreamTrack",void 0),qk(this,"mediaStreamTrack",void 0),qk(this,"_external",{}),this._ID=t||hx(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Nr(_k).call(_k,e)||_k.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||rx((()=>{var e;ek.reportApiInvoke(null,{name:DI.GET_MEDIA_STREAM_TRACK,options:[],tag:LI.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Sk.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=_k.indexOf(e);-1!==t&&_k.splice(t,1)}(this),this.emit(Rk.CLOSED),this.removeAllListeners(Ak.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Sk.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Ak.TRANSCEIVER_UPDATED,e,t)}}class Yk extends $k{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),qk(this,"_enabled",!0),qk(this,"_muted",!1),qk(this,"_isExternalTrack",!1),qk(this,"_isClosed",!1),qk(this,"_enabledMutex",void 0),qk(this,"processor",void 0),qk(this,"_processorContext",void 0),qk(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Tx("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,qO.debug("[".concat(this.getTrackId(),"] close")),this.emit(bk.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await KI(this,bk.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){qO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Rk.TRACK_ENDED)}stateCheck(e,t){if(qO.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),vI(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new gI(mI.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",qO);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new gI(mI.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",qO)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():zh.resolve([])}}const Xk=window.AudioContext||window.webkitAudioContext;let Jk=null;const Qk=new class extends kI{constructor(){super(...arguments),qk(this,"prevState",void 0),qk(this,"curState",void 0),qk(this,"currentTime",void 0),qk(this,"currentTimeStuckAt",void 0),qk(this,"interruptDetectorTrack",void 0),qk(this,"onLocalAudioTrackMute",(()=>{qO.info("ios15-interruption-start"),this.emit(sk.IOS_15_16_INTERRUPTION_START)})),qk(this,"onLocalAudioTrackUnmute",(async()=>{qO.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?qO.info("ios15-interruption-end-canceled"):(Jk&&await Jk.suspend(),this.emit(sk.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){qO.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){qO.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Zk(){if(!Jk){if(function(){if(!Xk)return void qO.error("your browser is not support web audio");qO.info("create audio context");const e=Gk({},fO("WEBAUDIO_INIT_OPTIONS"));qO.debug("audio context init option:",JSON.stringify(e)),Jk=new Xk(e),Qk.curState=Jk.state,Jk.onstatechange=()=>{Qk.prevState=Qk.curState,Qk.curState=Jk?Jk.state:void 0;const{prevState:e,curState:t}=Qk,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,s="interrupted"===e,a=jR().osVersion;(qR()||oI())&&i&&r&&(qO.info("ios".concat(a,"-interruption-start")),Qk.emit(sk.IOS_INTERRUPTION_START)),(qR()||oI())&&(o||s)&&n&&(qO.info("ios".concat(a,"-interruption-end")),Qk.emit(sk.IOS_INTERRUPTION_END)),e!==t&&Qk.emit(sk.STATE_CHANGE,t,e)},setInterval((()=>{var e;const t=null===(e=Jk)||void 0===e?void 0:e.currentTime;Qk.currentTime!==t?(Qk.currentTimeStuckAt&&(qO.debug("AudioContext current time resume at ".concat(t)),Qk.currentTimeStuckAt=void 0),Qk.currentTime=t):(t!==Qk.currentTimeStuckAt&&(ek.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:LI.TRACER}).onSuccess(),qO.warning("AudioContext current time stuck at ".concat(t))),Qk.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function s(t){"running"===e.state?a(!1):qR()||oI()?"suspended"===e.state&&(a(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(a(!0),t&&e.resume().then(c,c))}function a(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,l,{capture:!0,passive:!0}):window.removeEventListener(t,l,{capture:!0,passive:!0})}}}function c(){s(!1)}function l(){s(!0)}function u(e){if(!o)if(n.paused)if(e){let t;d(!1),o=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else d(!0);else d(!1)}function d(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),o=!1,u(!1)}function p(){u(!0)}if(qR()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,u(!0)}Qk.on(sk.STATE_CHANGE,(function(){s(!0)})),s(!1)}(Jk)}(),!Jk)throw new gI(mI.NOT_SUPPORTED,"can not create audio context");return Jk}return Jk}function eN(e){if(function(){if(null!==tN)return tN;const e=Zk(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),tN=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),Nr(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?JI(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let tN=null;function nN(e,t){let n=!1;const r=1/t;if(fO("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=Zk();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const s=t.createOscillator();s.onended=o,s.connect(i),s.start(0),s.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class rN{constructor(){qk(this,"context",void 0),qk(this,"analyserNode",void 0),qk(this,"sourceNode",void 0),this.context=Zk(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||qR()||oI()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=Xr(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){qO.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class iN extends kI{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),qk(this,"outputNode",void 0),qk(this,"outputTrack",void 0),qk(this,"isPlayed",!1),qk(this,"sourceNode",void 0),qk(this,"context",void 0),qk(this,"audioBufferNode",void 0),qk(this,"destNode",void 0),qk(this,"audioOutputLevel",0),qk(this,"volumeLevelAnalyser",void 0),qk(this,"_processedNode",void 0),qk(this,"playNode",void 0),qk(this,"isDestroyed",!1),qk(this,"onNoAudioInput",void 0),qk(this,"isNoAudioInput",!1),qk(this,"_noAudioInputCount",0),this.context=Zk(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),eN(this.outputNode),this.volumeLevelAnalyser=new rN}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(Ok.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!rk().webAudioMediaStreamDest)throw new gI(mI.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&ZI((()=>{Qk.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;qR()||oI()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await dx(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class oN extends iN{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),qk(this,"sourceNode",void 0),qk(this,"track",void 0),qk(this,"clonedTrack",void 0),qk(this,"audioElement",void 0),qk(this,"isCurrentTrackCloned",!1),qk(this,"isRemoteTrack",!1),qk(this,"originVolumeLevelAnalyser",void 0),qk(this,"rebuildWebAudio",(async()=>{if(qO.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void qO.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>qO.info("resume success"))),qO.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),eN(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),eN(this.outputNode),this.emit(Ok.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new gI(mI.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),eN(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,qO.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));eN(t),this.originVolumeLevelAnalyser=new rN,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=jR();t&&o.os===NR.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(Qk.on(sk.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),eN(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ok.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Qk.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),qO.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));eN(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function sN(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function aN(e,t){const n=await cN(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new zh(((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const s=document.createElement("div");s.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",s.setAttribute("style","height: 12%;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let u=t;const d=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=u,e.onchange=()=>{u=e.checked},d.appendChild(e),d.appendChild(t)}c.appendChild(d),c.appendChild(l),o.appendChild(s),o.appendChild(a),o.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(o),document.body.appendChild(h),e.map((e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:u})},a.appendChild(t)}}))}))}(n,t);return await sN(r,e,i)}async function cN(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=PI();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new gI(mI.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new zh(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new gI(mI.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const lN=new Tx("safari");let uN=!1,dN=!1;async function hN(e,t){let n=0,r=null;for(;n<2;)try{r=await pN(e,t,n>0);break}catch(e){if(e instanceof gI)throw qO.error("[".concat(t,"] ").concat(e.toString())),e;const r=fN(e.name||e.code||e,e.message);if(r.code===mI.MEDIA_OPTION_INVALID){qO.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await dx(500);continue}throw qO.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new gI(mI.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function pN(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new gI(mI.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=rk(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return qO.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(PI())e.screen.sourceId?mN(i,await sN(e.screen.sourceId,e.screen,!!e.screenAudio)):mN(i,await aN(e.screen,!!e.screenAudio));else if(WR()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new gI(mI.NOT_SUPPORTED,"This browser does not support screen sharing");qO.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(s=e.screen.extensionId,a=t,new zh(((e,t)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},(n=>{if(!n||!n.streamId)return qO.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new gI(mI.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){qO.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),e.toString()),t(new gI(mI.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,mN(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&Ek(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a,preferCurrentTab:c}=e.screen,l={selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a,preferCurrentTab:c};!r&&delete l.selfBrowserSurface,!s&&delete l.surfaceSwitching,!a&&delete l.systemAudio,!c&&delete l.preferCurrentTab,qO.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:e.screenAudio,controls:l})),mN(i,await navigator.mediaDevices.getDisplayMedia(Gk({video:n,audio:e.screenAudio},l)))}else{if(!GR())throw qO.error("[".concat(t,"] This browser does not support screenSharing")),new gI(mI.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Ek(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};qO.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),mN(i,await navigator.mediaDevices.getUserMedia(n))}}var s,a;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=fO("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=yx(c,l)}catch(e){}qO.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),jR();let u,d=null;(zR()||qR()||BR())&&(d=await lN.lock());try{u=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw d&&d(),e}return c.audio&&(uN=!0),c.video&&(dN=!0),mN(i,u),d&&d(),i}function fN(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new gI(mI.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new gI(mI.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new gI(mI.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new gI(mI.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new gI(mI.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new gI(mI.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return qO.error("getUserMedia unexpected error",e),new gI(mI.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function mN(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const gN=new class extends kI{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Vk.STATE_CHANGE,e),this._state=e)}constructor(){super(),qk(this,"_state",Uk.IDLE),qk(this,"isAccessMicrophonePermission",!1),qk(this,"isAccessCameraPermission",!1),qk(this,"lastAccessMicrophonePermission",!1),qk(this,"lastAccessCameraPermission",!1),qk(this,"checkdeviceMatched",!1),qk(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(fO("ENUMERATE_DEVICES_INTERVAL")||(uI()||VR()===NR.HARMONY_OS)&&lI())&&this.updateDevicesInfo()}),fO("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>qO.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new gI(mI.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,s=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(s=!1);let a=null,c=null,l=null;if(!n&&(o||s)){if(lN.isLocked&&(qO.debug("[device manager] wait GUM lock"),(await lN.lock())(),qO.debug("[device manager] GUM unlock")),uN&&(o=!1,this.isAccessMicrophonePermission=!0),dN&&(s=!1,this.isAccessCameraPermission=!0),qO.debug("[device manager] check media device permissions",e,t,o,s),o&&s){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=fN(e.name||e.code||e,e.message);if(t.code===mI.PERMISSION_DENIED)throw t;qO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{a=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=fN(e.name||e.code||e,e.message);if(t.code===mI.PERMISSION_DENIED)throw t;qO.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=fN(e.name||e.code||e,e.message);if(t.code===mI.PERMISSION_DENIED)throw t;qO.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}qO.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),a=null,c=null,l=null,e}catch(e){return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),a=null,c=null,l=null,new gI(mI.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new gI(mI.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Uk.INITING;try{await this.updateDevicesInfo(),this.state=Uk.INITEND}catch(e){throw qO.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Uk.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new gI(mI.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?qO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):qO.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):qO.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==Uk.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Vk.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Vk.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Vk.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let vN=!1;const yN=new class extends kI{constructor(){super(...arguments),qk(this,"onAutoplayFailed",void 0),qk(this,"onAudioAutoplayFailed",void 0)}};function _N(){if(jR(),!vN){const e=t=>{t.preventDefault(),vN=!1,dI()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};vN=!0,dI()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),qO.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),yN.onAutoplayFailed?yN.onAutoplayFailed():yN.onAudioAutoplayFailed?qO.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):qO.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),yN.emit("autoplay-failed")}}function EN(e,t,n,r){if(!e)return;const i=ek.getBaseInfoBySessionId(e);if(!i)return;const o=i.info,s=Date.now(),a=Gk(Gk({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:s,elapse:s-i.startTime,cbRegistered:yN.onAutoplayFailed||yN.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});ek.send({type:JO.AUTOPLAY_FAILED,data:a},!0)}const bN=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],wN=new class{constructor(){qk(this,"onAutoplayFailed",void 0),qk(this,"elementMap",new Map),qk(this,"elementStateMap",new Map),qk(this,"elementsNeedToResume",[]),qk(this,"sinkIdMap",new Map),qk(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t;const i=this.elementStateMap.get(n),o=r.srcObject.getAudioTracks()[0],s=o&&o.readyState;if(qO.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(s," ").concat(e)),"live"===s){if(e)return r.pause(),void r.play();if("running"===Qk.curState)return nI()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}}))})),qk(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(qO.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),Qk.on(sk.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qk.on(sk.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Qk.on(sk.STATE_CHANGE,(()=>{qR()&&"suspended"===Qk.prevState&&"running"===Qk.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new gI(mI.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Fk.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{qO.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){qO.warning("[".concat(t,"] set sink id failed"),e.toString())}const s=i.play();s&&s.then&&s.catch((e=>{r&&EN(r,"audio",e.message,t),qO.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(qO.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),ZI((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_N()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){bN.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(qO.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&qO.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{qO.debug("Auto resume audio element success")})).catch((e=>{qO.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new zh((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{dI()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function SN(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new gI(mI.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",qO);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof zh?new zh(((e,t)=>{i.then(e).catch(t)})):i}),n}}class TN extends kI{constructor(e){super(),qk(this,"name","VideoProcessorDestination"),qk(this,"ID","0"),qk(this,"_source",void 0),qk(this,"videoContext",void 0),qk(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new gI(mI.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new gI(mI.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Mk.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Mk.ON_TRACK,void 0)}}class CN extends kI{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),qk(this,"constraintsMap",new Map),qk(this,"statsRegistry",[]),qk(this,"usageRegistry",[]),qk(this,"trackId",void 0),qk(this,"direction",void 0),qk(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await qI(this,jk.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return qO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),KI(this,jk.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qh(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return qO.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),KI(this,jk.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qh(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){qO.error(new gI(mI.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof zh&&(n=await n),e.push(Gk(Gk({},n),{},{direction:this.direction}))}catch(e){qO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class AN extends kI{constructor(e){super(),qk(this,"name","AudioProcessorDestination"),qk(this,"ID","0"),qk(this,"inputTrack",void 0),qk(this,"inputNode",void 0),qk(this,"audioProcessorContext",void 0),qk(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new gI(mI.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new gI(mI.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Mk.ON_TRACK,void 0),this.emit(Mk.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Mk.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Mk.ON_NODE,this.inputNode))}}class RN extends kI{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),qk(this,"constraintsMap",new Map),qk(this,"statsRegistry",[]),qk(this,"audioContext",void 0),qk(this,"trackId",void 0),qk(this,"direction",void 0),qk(this,"usageRegistry",[]),qk(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return qI(this,jk.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return qO.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),KI(this,jk.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qh(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),KI(this,jk.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qh(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){qO.error(new gI(mI.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof zh&&(n=await n),e.push(Gk(Gk({},n),{},{direction:this.direction}))}catch(e){qO.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class IN extends kI{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),qk(this,"context",void 0),qk(this,"processSourceNode",void 0),qk(this,"outputTrack",void 0),qk(this,"processedNode",void 0),qk(this,"clonedTrack",void 0),qk(this,"outputNode",void 0),this.outputNode=new xN}setVolume(){}createOutputTrack(){throw new gI(mI.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class xN{disconnect(){}connect(){}}function ON(e){return new zh(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=qR()?"canplay":"playing";i.addEventListener(o,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&GR()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(fx),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function kN(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=fk(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!aI()&&n.frameRate&&(t.frameRate=n.frameRate),HR()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),GR()&&(t.frameRate={ideal:30,max:30}),t}function NN(e){const t={};return aI()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,WR()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function PN(e){const t=NN(e);if(e.encoderConfig){const n=yk(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),uI()&&(t.sampleRate=void 0),t}const DN=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:s=r,height:a=i}=t;if(!o||!s||!a)return;s=Ex(s),a=Ex(a),o=Ex(o);const{max:c,min:l}=function(e,t,n){const r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(s,a,o),{bitrateMax:u,bitrateMin:d}=t||{};u||qO.debug("calculate bitrate: [w: ".concat(s,", h: ").concat(a,", fps: ").concat(o,"] => [brMax: ").concat(u,", brMin: ").concat(d,"]"));const{maxFramerate:h}=fO("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:u||c,bitrateMin:d||l,scaleResolutionDownBy:1,scale:0}},LN=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(bx(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))})(e.buffer,t,n),MN=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new zh(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await jN(e);n({buffer:r,width:t.width,height:t.height})}else r(new gI(mI.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},jN=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var UN,VN,FN,BN,WN,zN,HN,GN,qN,KN,$N,YN,XN,JN,QN,ZN,eP,tP,nP,rP,iP,oP,sP,aP,cP,lP,uP,dP,hP,pP,fP,mP,gP,vP,yP,_P,EP,bP,wP,SP;let TP=(UN=ZO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),VN=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),FN=SN(),BN=Cx("LocalAudioTrack","_enabledMutex"),WN=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),zN=SN(),HN=Cx("LocalAudioTrack","_enabledMutex"),GN=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),qN=SN(),KN=SN(),$N=SN(),YN=ZO({argsMap:e=>[e.getTrackId()]}),XN=SN(),JN=ZO({argsMap:e=>[e.getTrackId()]}),QN=SN(),ZN=ZO({argsMap:e=>[e.getTrackId()]}),eP=ZO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),tP=ZO({argsMap:e=>[e.getTrackId()]}),Kk((nP=class extends Yk{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?wN.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),qk(this,"trackMediaType",xk.AUDIO),qk(this,"_encoderConfig",void 0),qk(this,"_trackSource",void 0),qk(this,"metadata",[]),qk(this,"_enabled",!0),qk(this,"_volume",100),qk(this,"_useAudioElement",!0),qk(this,"_bypassWebAudio",!1),qk(this,"processor",void 0),qk(this,"_processorContext",void 0),qk(this,"_processorDestination",void 0),qk(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new IN,fO("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),fO("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),zR()&&!Jk?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){_I(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&wN.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void qO.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,KI(this,bk.NEED_REPLACE_TRACK,this).then((()=>{qO.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{qO.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!ik())throw new gI(mI.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wN.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(qO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await KI(this,bk.NEED_ENABLE_TRACK,this),qO.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),qO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await KI(this,bk.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),qO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,qO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await KI(this,bk.NEED_MUTE_TRACK,this):await KI(this,bk.NEED_UNMUTE_TRACK,this))}getStats(){return rx((()=>{qO.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),$I(this,bk.GET_STATS)||Gk({},kk)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ok.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ok.ON_AUDIO_BUFFER),this._source.on(Ok.ON_AUDIO_BUFFER,(t=>e(t)))}play(){qO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(qO.debug("[".concat(this.getTrackId(),"] start audio playback in element")),wN.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){qO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?wN.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];qO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wN.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await KI(this,bk.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return zh.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new gI(mI.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new gI(mI.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Mk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await KI(this,bk.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await KI(this,bk.NEED_REPLACE_TRACK,this))})),e.on(Mk.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(Mk.ON_TRACK),e.removeAllListeners(Mk.ON_NODE)}bindProcessorContextEvents(e){e.on(jk.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(jk.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof IN&&(this._trackSource=new oN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new RN(this._source.context,this.getTrackId(),"local"),t=new AN(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Ok.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(wN.stop(this.getTrackId()),this._source.play()),KI(this,bk.NEED_REPLACE_MIXING_TRACK,this).then((()=>{qO.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((e=>{qO.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[UN],Object.getOwnPropertyDescriptor(nP.prototype,"setVolume"),nP.prototype),Kk(nP.prototype,"setPlaybackDevice",[VN,FN],Object.getOwnPropertyDescriptor(nP.prototype,"setPlaybackDevice"),nP.prototype),Kk(nP.prototype,"setEnabled",[BN,WN,zN],Object.getOwnPropertyDescriptor(nP.prototype,"setEnabled"),nP.prototype),Kk(nP.prototype,"setMuted",[HN,GN,qN],Object.getOwnPropertyDescriptor(nP.prototype,"setMuted"),nP.prototype),Kk(nP.prototype,"getStats",[KN],Object.getOwnPropertyDescriptor(nP.prototype,"getStats"),nP.prototype),Kk(nP.prototype,"setAudioFrameCallback",[$N],Object.getOwnPropertyDescriptor(nP.prototype,"setAudioFrameCallback"),nP.prototype),Kk(nP.prototype,"play",[YN,XN],Object.getOwnPropertyDescriptor(nP.prototype,"play"),nP.prototype),Kk(nP.prototype,"stop",[JN,QN],Object.getOwnPropertyDescriptor(nP.prototype,"stop"),nP.prototype),Kk(nP.prototype,"close",[ZN],Object.getOwnPropertyDescriptor(nP.prototype,"close"),nP.prototype),Kk(nP.prototype,"pipe",[eP],Object.getOwnPropertyDescriptor(nP.prototype,"pipe"),nP.prototype),Kk(nP.prototype,"unpipe",[tP],Object.getOwnPropertyDescriptor(nP.prototype,"unpipe"),nP.prototype),nP),CP=(rP=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),iP=SN(),oP=Cx("MicrophoneAudioTrack","_enabledMutex"),sP=ZO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),aP=SN(),cP=ZO({argsMap:e=>[e.getTrackId()]}),Kk((lP=class extends TP{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?yk(t.encoderConfig):{},r,fO("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),qk(this,"_config",void 0),qk(this,"_deviceName","default"),qk(this,"_constraints",void 0),qk(this,"_originalConstraints",void 0),qk(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(nI()||rI())&&Qk.bindInterruptDetectorTrack(this)}async setDevice(e){if(qO.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await gN.getDeviceById(e),n={};n.audio=Gk({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await hN(n,this.getTrackId())}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await hN({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await gN.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}qO.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return qO.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(qO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),fO("AUTO_RESET_AUDIO_ROUTE")&&(qR()||oI())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await KI(this,bk.NEED_DISABLE_TRACK,this)}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=Gk({},this._constraints),o=gN.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await hN({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await KI(this,bk.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),qO.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}qO.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(nI()||rI())&&Qk.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((qR()||oI())&&this._enabled&&!this._isClosed&&Qk.duringInterruption){const e=async()=>{Qk.off(sk.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(qO.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qk.on(sk.IOS_INTERRUPTION_END,e)}else qO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Rk.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=gN.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await hN({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(jk.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(jk.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[rP,iP],Object.getOwnPropertyDescriptor(lP.prototype,"setDevice"),lP.prototype),Kk(lP.prototype,"setEnabled",[oP,sP,aP],Object.getOwnPropertyDescriptor(lP.prototype,"setEnabled"),lP.prototype),Kk(lP.prototype,"close",[cP],Object.getOwnPropertyDescriptor(lP.prototype,"close"),lP.prototype),lP),AP=(uP=ZO({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),dP=SN(),hP=ZO({argsMap:e=>[e.getTrackId()]}),pP=SN(),fP=ZO({argsMap:e=>[e.getTrackId()]}),mP=SN(),gP=ZO({argsMap:e=>[e.getTrackId()]}),vP=SN(),yP=ZO({argsMap:e=>[e.getTrackId()]}),_P=SN(),EP=ZO({argsMap:e=>[e.getTrackId()]}),bP=ZO({argsMap:e=>[e.getTrackId()]}),wP=SN(),Kk((SP=class extends TP{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),qk(this,"source",void 0),qk(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Ok.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(Rk.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){_I(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[uP,dP],Object.getOwnPropertyDescriptor(SP.prototype,"startProcessAudioBuffer"),SP.prototype),Kk(SP.prototype,"pauseProcessAudioBuffer",[hP,pP],Object.getOwnPropertyDescriptor(SP.prototype,"pauseProcessAudioBuffer"),SP.prototype),Kk(SP.prototype,"seekAudioBuffer",[fP,mP],Object.getOwnPropertyDescriptor(SP.prototype,"seekAudioBuffer"),SP.prototype),Kk(SP.prototype,"resumeProcessAudioBuffer",[gP,vP],Object.getOwnPropertyDescriptor(SP.prototype,"resumeProcessAudioBuffer"),SP.prototype),Kk(SP.prototype,"stopProcessAudioBuffer",[yP,_P],Object.getOwnPropertyDescriptor(SP.prototype,"stopProcessAudioBuffer"),SP.prototype),Kk(SP.prototype,"close",[EP],Object.getOwnPropertyDescriptor(SP.prototype,"close"),SP.prototype),Kk(SP.prototype,"setAudioBufferPlaybackSpeed",[bP,wP],Object.getOwnPropertyDescriptor(SP.prototype,"setAudioBufferPlaybackSpeed"),SP.prototype),SP);class RP extends TP{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Zk().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,hx(8,"track-mix-")),qk(this,"trackList",void 0),qk(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(qO.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):qO.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){qO.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}JI(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof RP?t.emit(Ak.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class IP extends iN{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Ok.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),qk(this,"audioBuffer",void 0),qk(this,"sourceNode",void 0),qk(this,"startPlayTime",0),qk(this,"startPlayOffset",0),qk(this,"pausePlayTime",0),qk(this,"options",void 0),qk(this,"currentLoopCount",0),qk(this,"currentPlaybackSpeed",100),qk(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):qO.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const xP=new Map;class OP{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(qO.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){qk(this,"trackId",void 0),qk(this,"config",void 0),qk(this,"onFirstVideoFrameDecoded",void 0),qk(this,"onVideoStateChanged",void 0),qk(this,"freezeTimeCounterList",[]),qk(this,"renderFreezeAccTime",0),qk(this,"isKeepLastFrame",!1),qk(this,"timeUpdatedCount",0),qk(this,"freezeTime",0),qk(this,"playbackTime",0),qk(this,"lastTimeUpdatedTime",0),qk(this,"autoplayFailed",!1),qk(this,"videoTrack",void 0),qk(this,"videoElement",void 0),qk(this,"cacheVideoElement",void 0),qk(this,"renderStats",void 0),qk(this,"_videoState",Bk.VideoStateStopped),qk(this,"videoElementCheckInterval",void 0),qk(this,"videoElementFreezeTimeout",void 0),qk(this,"_videoElementStatus",Fk.NONE),qk(this,"isGettingVideoDimensions",!1),qk(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return qO.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),qk(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Qk.curState&&(qO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FR())),iI()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),qk(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Fk.PLAYING;break;case"loadeddata":if(this.videoState=Bk.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Fk.CANPLAY;break;case"stalled":this.videoElementStatus=Fk.STALLED;break;case"suspend":this.videoElementStatus=Fk.SUSPEND;break;case"pause":this.videoElementStatus=Fk.PAUSED,qR()||oI()||zR()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(qO.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Fk.WAITING;break;case"abort":this.videoElementStatus=Fk.ABORT;break;case"ended":this.videoElementStatus=Fk.ENDED;break;case"emptied":this.videoElementStatus=Fk.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=Fk.ERROR,qO.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,kD.lastVisibleTime<kD.lastHiddenTime||n<kD.lastHiddenTime||n<kD.lastVisibleTime)return;for(t>fO("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),qk(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(qO.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FR())),iI()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Qk.on(sk.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qk.on(sk.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&EN(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(qO.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):qO.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=jR();if(("Safari"===n.name&&15===Number(n.version)||nI())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return qO.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new zh(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await jN(e);r({buffer:t,width:n.width,height:n.height})}else i(new gI(mI.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await MN(e)}destroy(){this.renderStats=void 0,Qk.off(sk.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qk.off(sk.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Bk.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Fk.INIT,!this.videoElementCheckInterval&&(kP.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=Fk.DESTROYED)}),1e3),fO("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,fO("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Bk.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=Bk.VideoStateFrozen:document.addEventListener("visibilitychange",r))},o=(e,t)=>{if(this.videoElementStatus===Fk.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},n){const e=t.presentationTime-n.presentationTime;this.videoState===Bk.VideoStateStarting&&(this.videoState=Bk.VideoStateDecoding),this.videoState===Bk.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,fO("VIDEO_FREEZE_DURATION"))),e<fO("VIDEO_FREEZE_DURATION")&&this.videoState===Bk.VideoStateFrozen&&(this.videoState=Bk.VideoStateDecoding),e>fO("VIDEO_FREEZE_DURATION")&&kD.lastVisibleTime>=kD.lastHiddenTime&&n.timestamp>kD.lastVisibleTime&&n.timestamp>kD.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=Gk(Gk({},t),{},{timestamp:e})}var r,s;fO("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(s=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(s,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),uI()&&!fO("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=jR();"Safari"===n.name&&15===Number(n.version)||nI()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,GR()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,GR()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{qO.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){kP.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Fk.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{qO.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{qO.error(e)})),this.autoplayFailed=!1,dI()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};dI()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),_N()}}const kP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class NP extends OP{constructor(e){super(e),qk(this,"container",void 0),qk(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await MN(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",fO("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var PP,DP,LP,MP,jP,UP,VP,FP,BP,WP,zP,HP,GP,qP,KP,$P,YP,XP,JP,QP,ZP,eD,tD,nD,rD,iD,oD,sD,aD,cD,lD,uD,dD,hD;let pD=(PP=ZO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),DP=SN(),LP=ZO({argsMap:e=>[e.getTrackId()]}),MP=Cx("LocalVideoTrack","_enabledMutex"),jP=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),UP=SN(),VP=Cx("LocalVideoTrack","_enabledMutex"),FP=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),BP=SN(),WP=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),zP=SN(),HP=SN(),GP=ZO({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),qP=SN(),KP=SN(),$P=SN(),YP=SN(),XP=SN(),JP=SN(),QP=SN(),ZP=ZO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),eD=ZO({argsMap:e=>[e.getTrackId()]}),tD=ZO({argsMap:e=>[e.getTrackId()]}),nD=ZO({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),rD=class e extends Yk{get videoHeight(){if(zR()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(zR()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fk.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),qk(this,"trackMediaType",xk.VIDEO),qk(this,"_player",void 0),qk(this,"isUseScaleResolutionDownBy",!1),qk(this,"_videoVisibleTimer",null),qk(this,"_previousVideoVisibleStatus",void 0),qk(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),qk(this,"_encoderConfig",void 0),qk(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),qk(this,"_optimizationMode",void 0),qk(this,"_videoHeight",void 0),qk(this,"_videoWidth",void 0),qk(this,"_forceBitrateLimit",void 0),qk(this,"_enabled",!0),qk(this,"_processorDestination",void 0),qk(this,"_processorContext",void 0),zR()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(wk.SCREEN_TRACK))this.updateBitrateFromProfile();else if(YR(PR.CHROME,115)&&-1!==VR().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&rk().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),r=new MediaStreamTrackGenerator({kind:"video"});let i,o,s=Date.now();const a=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),o=void 0,r.removeEventListener("ended",a)};let c=window.setInterval((()=>{if(o&&i&&Date.now()-s>(null!=t?t:1e3))try{"live"===r.readyState?o.enqueue(i.clone()):a()}catch(e){a()}}),null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===r.readyState?(o=t,s=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return r.addEventListener("ended",a),n.readable.pipeThrough(l).pipeTo(r.writable),r}}(e);t&&(qO.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(wk.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new CN(this.getTrackId(),"local"),this._processorDestination=new TN(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(qO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}qO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Gk(Gk(Gk({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new OP(n):this._player=new NP(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Rk.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),fO("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,qO.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(qO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await KI(this,bk.NEED_DISABLE_TRACK,this)}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void qO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await KI(this,bk.NEED_ENABLE_TRACK,this)}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}qO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,qO.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await KI(this,bk.NEED_MUTE_TRACK,this):await KI(this,bk.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new gI(mI.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=fk(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=kN({encoderConfig:e});(zR()||qR()||oI())&&(t.deviceId=void 0),qO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new gI(mI.UNEXPECTED_ERROR,e.toString());throw qO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(wk.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await KI(this,bk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(qO)}}getStats(){return rx((()=>{qO.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),$I(this,bk.GET_STATS)||Gk({},Nk)}async setBeautyEffect(e){qO.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await MN(e)}async setBitrateLimit(e){qO.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void qO.error(mI.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await KI(this,bk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,qO.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}qO.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return qO.error(mI.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,qO.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){ON(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(fx)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new gI(mI.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");qO.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=fk(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(wk.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await KI(this,bk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(qO)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){const{max:o,min:s}=function(e,t,n,r,i){const o=fO("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===o)return{min:r,max:i};if(void 0===i){var s;const a=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===o?4*a:2*a,r=null!==(s=r)&&void 0!==s?s:a}else{var a;r=null!==(a=r)&&void 0!==a?a:Math.floor(i/10)}return{min:r,max:i}}(e,t,n,i,r);this._encoderConfig.bitrateMin=s,this._encoderConfig.bitrateMax=o,qO.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(s,"]"))}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=RI.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=ek.reportApiInvoke(null,{tag:LI.TRACER,name:DI.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new gI(mI.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new gI(mI.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=Gk(Gk({},r),fk(t))),r=tx(r);const i=hx(8,"track-video-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,tx(this._scalabilityMode),this._optimizationMode,i,tx(this._hints));return t&&r&&o.setEncoderConfiguration(r),qO.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new gI(mI.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new gI(mI.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(rx((()=>{ek.reportApiInvoke(null,{name:DI.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:LI.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!fO("ENABLE_VIDEO_SEI")||!fO("ENABLE_ENCODED_TRANSFORM"))return void qO.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new gI(mI.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void qO.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):qO.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Mk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await KI(this,bk.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await KI(this,bk.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Mk.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(jk.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(jk.REQUEST_CONSTRAINTS)}},Kk(rD.prototype,"play",[PP,DP],Object.getOwnPropertyDescriptor(rD.prototype,"play"),rD.prototype),Kk(rD.prototype,"stop",[LP],Object.getOwnPropertyDescriptor(rD.prototype,"stop"),rD.prototype),Kk(rD.prototype,"setEnabled",[MP,jP,UP],Object.getOwnPropertyDescriptor(rD.prototype,"setEnabled"),rD.prototype),Kk(rD.prototype,"setMuted",[VP,FP,BP],Object.getOwnPropertyDescriptor(rD.prototype,"setMuted"),rD.prototype),Kk(rD.prototype,"setEncoderConfiguration",[WP,zP],Object.getOwnPropertyDescriptor(rD.prototype,"setEncoderConfiguration"),rD.prototype),Kk(rD.prototype,"getStats",[HP],Object.getOwnPropertyDescriptor(rD.prototype,"getStats"),rD.prototype),Kk(rD.prototype,"setBeautyEffect",[GP,qP],Object.getOwnPropertyDescriptor(rD.prototype,"setBeautyEffect"),rD.prototype),Kk(rD.prototype,"getCurrentFrameData",[KP],Object.getOwnPropertyDescriptor(rD.prototype,"getCurrentFrameData"),rD.prototype),Kk(rD.prototype,"getCurrentFrameImage",[$P],Object.getOwnPropertyDescriptor(rD.prototype,"getCurrentFrameImage"),rD.prototype),Kk(rD.prototype,"setBitrateLimit",[YP],Object.getOwnPropertyDescriptor(rD.prototype,"setBitrateLimit"),rD.prototype),Kk(rD.prototype,"setOptimizationMode",[XP],Object.getOwnPropertyDescriptor(rD.prototype,"setOptimizationMode"),rD.prototype),Kk(rD.prototype,"setScalabiltyMode",[JP],Object.getOwnPropertyDescriptor(rD.prototype,"setScalabiltyMode"),rD.prototype),Kk(rD.prototype,"updateMediaStreamTrackResolution",[QP],Object.getOwnPropertyDescriptor(rD.prototype,"updateMediaStreamTrackResolution"),rD.prototype),Kk(rD.prototype,"pipe",[ZP],Object.getOwnPropertyDescriptor(rD.prototype,"pipe"),rD.prototype),Kk(rD.prototype,"unpipe",[eD],Object.getOwnPropertyDescriptor(rD.prototype,"unpipe"),rD.prototype),Kk(rD.prototype,"close",[tD],Object.getOwnPropertyDescriptor(rD.prototype,"close"),rD.prototype),Kk(rD.prototype,"replaceTrack",[nD],Object.getOwnPropertyDescriptor(rD.prototype,"replaceTrack"),rD.prototype),rD),fD=(iD=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),oD=SN(),sD=Cx("CameraVideoTrack","_enabledMutex"),aD=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),cD=SN(),lD=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),uD=SN(),dD=ZO({argsMap:e=>[e.getTrackId()]}),hD=class e extends pD{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,fk(t.encoderConfig),r,i,o),qk(this,"_config",void 0),qk(this,"_originalConstraints",void 0),qk(this,"_constraints",void 0),qk(this,"_enabled",!0),qk(this,"_deviceName","default"),qk(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(nI()||rI())&&!function(){const e=jR();if(e.os!==NR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&sI()&&this._enabled&&!this._isClosed&&(qO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=fk(this._config.encoderConfig),Qk.on(sk.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qk.on(sk.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(qO.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await gN.getDeviceById(e),n={};n.video=Gk({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await hN(n,this.getTrackId())}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await hN({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await gN.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}qO.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){qO.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:Gk(Gk({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await hN(t,this.getTrackId())}catch(t){throw qO.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await hN({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Gk({},t.video),qO.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(qO.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await hN({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await KI(this,bk.NEED_ENABLE_TRACK,this)}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),qO.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await KI(this,bk.NEED_DISABLE_TRACK,this)}catch(e){throw qO.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}qO.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new gI(mI.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=fk(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=ex(this._config);n.encoderConfig=e;const r=kN(n);(zR()||qR()||oI())&&(r.deviceId=void 0),qO.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new gI(mI.UNEXPECTED_ERROR,e.toString());throw qO.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(wk.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await KI(this,bk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(qO)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((qR()||oI())&&this._enabled&&!this._isClosed&&Qk.duringInterruption){const e=async()=>{Qk.off(sk.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(qO.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qk.on(sk.IOS_INTERRUPTION_END,e)}else qO.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Rk.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=gN.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await hN({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Qk.off(sk.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qk.off(sk.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=Gk(Gk({},r),fk(t))),r=tx(r);const i=hx(8,"track-cam-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,tx(Gk(Gk({},this._config),{},{encoderConfig:r})),tx(this._constraints),tx(this._scalabilityMode),this._optimizationMode,i);return t&&r&&o.setEncoderConfiguration(r),qO.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(jk.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(jk.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}},Kk(hD.prototype,"setDevice",[iD,oD],Object.getOwnPropertyDescriptor(hD.prototype,"setDevice"),hD.prototype),Kk(hD.prototype,"setEnabled",[sD,aD,cD],Object.getOwnPropertyDescriptor(hD.prototype,"setEnabled"),hD.prototype),Kk(hD.prototype,"setEncoderConfiguration",[lD,uD],Object.getOwnPropertyDescriptor(hD.prototype,"setEncoderConfiguration"),hD.prototype),Kk(hD.prototype,"close",[dD],Object.getOwnPropertyDescriptor(hD.prototype,"close"),hD.prototype),hD);function mD(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Gk(Gk({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?qO.debug("[".concat(e,"] set content hint to"),n.optimizationMode):qO.debug("[".concat(e,"] set content hint failed")))):qO.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var gD,vD,yD,_D,ED,bD,wD,SD,TD,CD,AD,RD;class ID extends $k{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(hx(5,""))),qk(this,"_userId",void 0),qk(this,"_uintId",void 0),qk(this,"_isDestroyed",!1),qk(this,"store",void 0),qk(this,"processor",void 0),qk(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,qO.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let xD=(gD=ZO({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),vD=ZO({argsMap:e=>[e.getTrackId()]}),yD=ZO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_D=ZO({argsMap:e=>[e.getTrackId()]}),Kk((ED=class extends ID{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fk.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),qk(this,"_videoVisibleTimer",null),qk(this,"_previousVideoVisibleStatus",void 0),qk(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),qk(this,"trackMediaType",xk.VIDEO),qk(this,"_videoWidth",void 0),qk(this,"_videoHeight",void 0),qk(this,"_player",void 0),qk(this,"processorDestination",void 0),qk(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new CN(this.getTrackId(),"remote"),this.processorDestination=new TN(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return rx((()=>{qO.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),$I(this,bk.GET_STATS)||Gk({},Lk)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(qO.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}qO.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Gk(Gk({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new OP(n):this._player=new NP(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ik.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(Ik.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Ik.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),fO("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,qO.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){ON(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(fx)}_updatePlayerSource(){qO.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=RI.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=ek.reportApiInvoke(null,{tag:LI.TRACER,name:DI.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new gI(mI.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new gI(mI.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Mk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Mk.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ak.SEI_RECEIVED,e)}}).prototype,"play",[gD],Object.getOwnPropertyDescriptor(ED.prototype,"play"),ED.prototype),Kk(ED.prototype,"stop",[vD],Object.getOwnPropertyDescriptor(ED.prototype,"stop"),ED.prototype),Kk(ED.prototype,"pipe",[yD],Object.getOwnPropertyDescriptor(ED.prototype,"pipe"),ED.prototype),Kk(ED.prototype,"unpipe",[_D],Object.getOwnPropertyDescriptor(ED.prototype,"unpipe"),ED.prototype),ED),OD=(bD=ZO({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),wD=ZO({argsMap:(e,t)=>[e.getTrackId(),t]}),SD=ZO({argsMap:e=>[e.getTrackId()]}),TD=ZO({argsMap:e=>[e.getTrackId()]}),CD=ZO({argsMap:(e,t)=>[e.getTrackId(),t.name]}),AD=ZO({argsMap:e=>[e.getTrackId()]}),Kk((RD=class extends ID{get isPlaying(){return this._useAudioElement?wN.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),qk(this,"trackMediaType",xk.AUDIO),qk(this,"_source",void 0),qk(this,"_useAudioElement",!0),qk(this,"_volume",100),qk(this,"processorContext",void 0),qk(this,"processorDestination",void 0),qk(this,"_played",!1),qk(this,"_bypassWebAudio",!1),fO("DISABLE_WEBAUDIO")?(this._source=new IN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new oN(e,!0),fO("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ok.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Ik.FIRST_FRAME_DECODED)})),this.processorContext=new RN(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new AN(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ok.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ok.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ok.ON_AUDIO_BUFFER),this._source.on(Ok.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?wN.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!ik())throw new gI(mI.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wN.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return rx((()=>{qO.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),$I(this,bk.GET_STATS)||Gk({},Pk)}play(){qO.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(qO.debug("[".concat(this.getTrackId(),"] use audio element to play")),wN.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){qO.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?wN.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];qO.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wN.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new gI(mI.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new gI(mI.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new gI(mI.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Mk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(Mk.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Mk.ON_TRACK),this.processorDestination.removeAllListeners(Mk.ON_NODE)}}).prototype,"setVolume",[bD],Object.getOwnPropertyDescriptor(RD.prototype,"setVolume"),RD.prototype),Kk(RD.prototype,"setPlaybackDevice",[wD],Object.getOwnPropertyDescriptor(RD.prototype,"setPlaybackDevice"),RD.prototype),Kk(RD.prototype,"play",[SD],Object.getOwnPropertyDescriptor(RD.prototype,"play"),RD.prototype),Kk(RD.prototype,"stop",[TD],Object.getOwnPropertyDescriptor(RD.prototype,"stop"),RD.prototype),Kk(RD.prototype,"pipe",[CD],Object.getOwnPropertyDescriptor(RD.prototype,"pipe"),RD.prototype),Kk(RD.prototype,"unpipe",[AD],Object.getOwnPropertyDescriptor(RD.prototype,"unpipe"),RD.prototype),RD);const kD=new class extends kI{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),qk(this,"_lastHiddenTime",0),qk(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),qO.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class ND extends kI{constructor(e,t){super(),qk(this,"trackMediaType",xk.DATA),qk(this,"_version",1),qk(this,"_type",3),qk(this,"_config",void 0),qk(this,"_originDataChannel",void 0),qk(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),qk(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),qk(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return fO("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new zh(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout((()=>{var e;t(new gI(mI.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new gI(mI.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new gI(mI.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[zk.OPEN,zk.CLOSE,zk.ERROR].forEach((t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}}class PD extends ND{constructor(e){super(e),qk(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(fO("SHOW_DATASTREAM2_LOG")&&qO.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(zk.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class DD extends ND{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function LD(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout((()=>yv.revokeObjectURL(e)),0),new Worker(yv.createObjectURL(e))}const MD=71,jD=1,UD=2,VD=1,FD=2;var BD=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(BD||{});function WD(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getUint8(0);if(n!==MD)return;const r=e.getUint16(1),i=jD+UD+r,o=new Uint8Array(e.byteLength-i);o.set(new Uint8Array(e.buffer,i,e.byteLength-i));const s={m:n,tlvLen:r,tlv:[],frame:o};let a=jD+UD;for(;a<i;){const n=e.getUint8(a),r=e.getUint16(a+VD),i=VD+FD;if(n===BD.AUDIO_LEVEL){let o=e.getUint8(a+i);for(let t=1;t<r;t++)o=o<<8|e.getUint8(a+i+t);s.tlv.push({tag:n,length:r,value:t?127^o>>1:127&o})}else if(n===BD.METADATA||n===BD.AUDIO_64_BIT_PTS){const t=new Uint8Array(r);for(let n=0;n<r;n++)t[n]=e.getUint8(a+i+n);s.tlv.push({tag:n,length:r,value:t})}a+=i+r}return s}const zD=new Map,HD=127,GD=1e-10,qD=139/13,KD=new Map;function $D(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;if(KD.has(r))i=KD.get(r);else{const o=.5;i=Math.log(function(e,t){const n=e-t;t<n&&(t=n);let r=1;for(let i=e,o=1;i>t;i--,o++)r=r*i/o;return r}(t,e))+e*Math.log(o)+(t-e)*Math.log(1-o)-Math.log(n)+n*e,KD.set(r,i)}return i<GD&&(i=GD),i}function YD(e,t,n){const r=t.length,i=e.length/r;let o=!1;for(let s=0,a=0;s<r;s++){let r=0;for(let t=a+i;a<t;a++)e[a]>n&&r++;t[s]!==r&&(t[s]=r,o=!0)}return o}window.cache=KD;let XD=0;class JD{constructor(e){qk(this,"id",void 0),qk(this,"immediates",[]),qk(this,"lastNonSilence",-1),qk(this,"immediateSpeechActivityScore",GD),qk(this,"lastLevelChangedTime",Date.now()),qk(this,"levels",[]),qk(this,"longs",[]),qk(this,"longSpeechActivityScore",GD),qk(this,"mediums",[]),qk(this,"mediumSpeechActivityScore",GD),qk(this,"minLevel",0),qk(this,"nextMinLevel",0),qk(this,"nextMinLevelWindowLength",0),qk(this,"energyScore",0),this.id=e||"".concat(XD++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,n=this.minLevel+qD;let r=!1;for(let i=0;i<e.length;++i){let o=t[i];o<n&&(o=0);const s=Math.floor(o/qD);e[i]!==s&&(e[i]=s,r=!0)}return r}computeLongs(){return YD(this.mediums,this.longs,4)}computeMediums(){return YD(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=$D(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=$D(this.longs[0],10,47),this.longSpeechActivityScore>GD&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=$D(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(li(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>HD&&(n=HD),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+qD?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>HD&&(e=HD),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class QD{constructor(e){qk(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class ZD{constructor(e,t,n){qk(this,"isDominant",void 0),qk(this,"energyRanking",void 0),qk(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class eL extends kI{constructor(e){super(),qk(this,"dominantId",null),qk(this,"lastDecisionTime",0),qk(this,"lastLevelChangedTime",0),qk(this,"lastLevelIdleTime",0),qk(this,"relativeSpeechActivities",[]),qk(this,"speakers",new Map),qk(this,"enableSilence",!1),qk(this,"timeoutToSilenceInterval",0),qk(this,"decisionMaker",null),qk(this,"loudest",[]),qk(this,"numLoudestToTrack",3),qk(this,"energyExpireTimeMs",250),qk(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some((t=>t.id===e))}levelChanged(e,t){const n=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const i=r.levelChanged(t,n);return this.updateLoudestList(r,i,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach((e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)}))}removeSpeakers(e){e.forEach((e=>{this.speakers.delete(e.id)}))}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new JD(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){const r=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new ZD(r,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new ZD(r,0,e.energyScore);const i=n-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const t=this.loudest[o];if(t.getLastLevelChangedTime()<i&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(t.id!==e.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let s=0;for(;s<this.loudest.length&&!(this.loudest[s].energyScore<e.energyScore);)++s;return s<this.numLoudestToTrack&&(this.loudest.splice(s,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new ZD(r,s,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new QD(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null;const r=this.speakers.size;let i=null;if(0===r)i=null;else if(1===r){var o;const t=Qh(o=this.speakers).call(o).next().value;this.enableSilence&&t&&(i=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(i=e.value[0],t=e.value[1])}else i=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const n=this.relativeSpeechActivities;let r=2;for(const o of this.speakers.entries()){const[s,a]=o;if(a===t)continue;a.evaluateSpeechActivityScores(e);for(let e=0;e<n.length;++e){const r=null==t?GD:t.getSpeechActivityScore(e);n[e]=Math.log(a.getSpeechActivityScore(e)/r)}const c=n[0],l=n[1],u=n[2];c>3&&l>2&&u>0&&l>r&&(r=l,i=s)}this.enableSilence&&null!=t&&i===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null)}null==i&&!this.enableSilence||i===this.dominantId||(t=this.dominantId,this.dominantId=i,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&n>r&&(n=r),n}timeoutIdleLevels(e){const t=[];for(const r of Qh(n=this.speakers).call(n)){var n;const i=e-r.getLastLevelChangedTime();36e5<i&&(null==this.dominantId||r.id!==this.dominantId)?t.push(r.id):300<i&&r.levelTimedOut()}t.forEach((e=>this.speakers.delete(e)))}}const tL=new Map;let nL=null,rL=null;const iL=3;let oL=[];const sL=new Map,aL=new Map;class cL{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){qk(this,"id",void 0),qk(this,"track",void 0),qk(this,"score",0),qk(this,"active",!0),qk(this,"muted",!1),qk(this,"timer",0),qk(this,"actives",0),qk(this,"inactives",0),this.id=e,this.track=t,this.setActive(sL.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:n}=function(){const e=[],t=[];return Array.from(Qh(sL).call(sL)).forEach((n=>{n.active?e.push(n):t.push(n)})),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach((t=>{(!e||e.score>t.score)&&(e=t)})),e&&e.setActive(!1)}if(t.length<3&&n.length>0){let t;n.forEach((e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)})),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(Qh(sL).call(sL)).forEach((n=>{!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)})),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(Qh(sL).call(sL)).forEach((n=>{n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)})),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let lL;function uL(e){const t=sL.get(e);t&&(sL.delete(e),t.clearTimer())}const dL=new Map,hL=new Map;function pL(e,t,n){let r=new Uint8Array(e,t,n),i=[],o=0;for(;i.length<n;)o+3<n&&0===r[o]&&0===r[o+1]&&3===r[o+2]&&(0===r[o+3]||1===r[o+3]||2===r[o+3]||3===r[o+3])?(i.push(r[o],r[o+1],r[o+3]),o+=4):(i.push(r[o]),o++);return new Uint8Array(i)}const fL=new Map,mL=new Map;!function(){const e=jR();nk.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),nk.getStreamFromExtension=e.name===PR.CHROME&&Number(e.version)>34,nk.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),nk.supportMinBitrate=e.name===PR.CHROME||e.name===PR.EDGE,nk.supportSetRtpSenderParameters=function(){const e=jR();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!lI()||!(!zR()&&!BR())||e.name===PR.FIREFOX&&Number(e.version)>=64)}(),e.name===PR.SAFARI&&(Number(e.version)>=14?nk.supportDualStream=!0:nk.supportDualStream=!1),nk.webAudioMediaStreamDest=function(){const e=jR();return!(e.name===PR.SAFARI&&Number(e.version)<12)}(),nk.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,nk.supportWebGL="undefined"!=typeof WebGLRenderingContext,nk.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,lI()||(nk.webAudioWithAEC=!0),nk.supportShareAudio=function(){const e=jR();return(e.os===NR.WIN_10||e.os===NR.WIN_81||e.os===NR.WIN_7||e.os===NR.LINUX||e.os===NR.MAC_OS||e.os===NR.CHROMIUM_OS)&&e.name===PR.CHROME&&Number(e.version)>=74}(),nk.supportDataChannel=!!(KR(76)||function(e){const t=jR();return!(t.name!==PR.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||JR(14)),nk.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!GR()&&!!e&&e.prototype.setConfiguration instanceof Function}(),nk.supportWebRTCEncodedTransform=function(){const e=jR();return"Chrome"===e.name&&Number(e.version)>=87||"Safari"===e.name&&Number(e.version)>=15}(),nk.supportWebRTCInsertableStream=function(){const e=jR();return(e.name===PR.CHROME||e.name===PR.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),nk.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,nk.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,ZI((()=>{nk.supportDualStreamEncoding=function(){const e=jR();return!!fO("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&fO("CHROME_DUAL_STREAM_USE_ENCODING"))}(),qO.debug("browser ua: ",navigator.userAgent),qO.info("browser info: ",e),qO.info("browser compatibility: ",nk)}))}();const gL=["CHINA","GLOBAL"],vL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],yL=[],_L=[];function EL(e,t){return!!t&&yL.some((n=>n.uid===e&&n.channelName===t))}function bL(){return _L.length>0}var wL=mw.forEach,SL=Br("forEach")?[].forEach:function(e){return wL(this,e,arguments.length>1?arguments[1]:void 0)};On({target:"Array",proto:!0,forced:[].forEach!=SL},{forEach:SL});var TL=Qn("Array").forEach,CL=fr,AL=Ze,RL=d,IL=TL,xL=Array.prototype,OL={DOMTokenList:!0,NodeList:!0},kL=function(e){var t=e.forEach;return e===xL||RL(xL,e)&&t===xL.forEach||AL(OL,CL(e))?IL:t},NL=r(kL),PL=Xe,DL=no;On({target:"Object",stat:!0,forced:i((function(){DL(1)}))},{keys:function(e){return DL(PL(e))}});var LL=r(re.Object.keys),ML=r(Yr),jL=r(ci),UL=On,VL=Qr,FL=Wc,BL=ne,WL=Vn,zL=Hn,HL=Z,GL=sp,qL=pt,KL=Jc,$L=xb("slice"),YL=qL("species"),XL=Array,JL=Math.max;UL({target:"Array",proto:!0,forced:!$L},{slice:function(e,t){var n,r,i,o=HL(this),s=zL(o),a=WL(e,s),c=WL(void 0===t?s:t,s);if(VL(o)&&(n=o.constructor,(FL(n)&&(n===XL||VL(n.prototype))||BL(n)&&null===(n=n[YL]))&&(n=void 0),n===XL||void 0===n))return KL(o,a,c);for(r=new(void 0===n?XL:n)(JL(c-a,0)),i=0;a<c;a++,i++)a in o&&GL(r,i,o[a]);return r.length=i,r}});var QL=Qn("Array").slice,ZL=d,eM=QL,tM=Array.prototype,nM=function(e){var t=e.slice;return e===tM||ZL(tM,e)&&t===tM.slice?eM:t},rM=r(nM);function iM(e,t,n,r,i){var o,s,a,c={};return NL(o=LL(r)).call(o,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=ML(s=jL(a=rM(n).call(n)).call(a)).call(s,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(vb(e,t,c),c=null),c}let oM=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),sM=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),aM=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),cM=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),lM=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),uM=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),dM=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),hM=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),pM=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),fM=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),mM=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),gM=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function vM(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw qO.error("Invalid Channel Name ".concat(e)),new tk(mI.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function yM(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||TI(e,1,255)))throw new tk(mI.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&qO.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let _M=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const EM={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},bM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function wM(e,t){bI(e.url,"".concat(t,".url"),1,1e3,!1),SI(e.x)||_I(e.x,"".concat(t,".x"),0,1e4),SI(e.y)||_I(e.y,"".concat(t,".y"),0,1e4),SI(e.width)||_I(e.width,"".concat(t,".width"),0,1e4),SI(e.height)||_I(e.height,"".concat(t,".height"),0,1e4),SI(e.zOrder)||_I(e.zOrder,"".concat(t,".zOrder"),0,255),SI(e.alpha)||_I(e.alpha,"".concat(t,".alpha"),0,1,!1)}const SM={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let TM=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),CM=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),AM=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function RM(e){if(!e.channelName)throw new tk(mI.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new tk(mI.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&bI(e.token,"info.token",1,2047),yM(e.uid),vM(e.channelName),!0}let IM=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),xM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),OM=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),kM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),NM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),PM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),DM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),LM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),MM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const jM=[MM.AFRICA,MM.ASIA,MM.CHINA,MM.EUROPE,MM.GLOBAL,MM.INDIA,MM.JAPAN,MM.NORTH_AMERICA,MM.OCEANIA,MM.OVERSEA,MM.SOUTH_AMERICA];let UM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const VM={CHINA:{},ASIA:{CODE:UM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:UM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:UM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:UM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:UM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:UM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:UM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:UM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:UM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:UM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:UM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:UM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:UM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};oO&&(VM.CHINA={CODE:UM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let FM=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function BM(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class WM extends kI{constructor(e,t){super(),JT(this,"onICEConnectionStateChange",void 0),JT(this,"onConnectionStateChange",void 0),JT(this,"onDTLSTransportStateChange",void 0),JT(this,"onDTLSTransportError",void 0),JT(this,"onICETransportStateChange",void 0),JT(this,"onFirstAudioReceived",void 0),JT(this,"onFirstVideoReceived",void 0),JT(this,"onFirstAudioDecoded",void 0),JT(this,"onFirstVideoDecoded",void 0),JT(this,"onFirstVideoDecodedTimeout",void 0),JT(this,"onSelectedLocalCandidateChanged",void 0),JT(this,"onSelectedRemoteCandidateChanged",void 0),JT(this,"onICECandidateError",void 0),JT(this,"getLocalVideoStats",void 0)}}class zM extends WM{constructor(e,t){super(e,t),JT(this,"establishPromise",void 0)}}let HM=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),GM=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),qM=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const KM=["disconnected","failed"];let $M=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),YM=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),XM=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),JM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),QM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ZM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ej=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),tj=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),nj=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),rj=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ij=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),oj=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),sj=function(e){return e.ABORT="abort",e}({}),aj=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),cj=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const lj={[oM.ACCESS_POINT]:{[cM.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[cM.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[cM.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[cM.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[cM.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[cM.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[cM.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[oM.UNILBS]:{[aM.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[aM.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[aM.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[aM.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[aM.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[aM.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[aM.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[aM.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[aM.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[aM.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[aM.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[aM.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[oM.STRING_UID_ALLOCATOR]:{[sM.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[sM.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[sM.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function uj(e){const t=lj[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===oM.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const dj={[lM.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[lM.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[lM.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[lM.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[lM.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[lM.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[lM.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[lM.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[lM.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[lM.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[lM.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[lM.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[lM.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[lM.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[lM.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[lM.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[lM.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[lM.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[lM.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[lM.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[lM.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[lM.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[lM.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[lM.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[lM.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[lM.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[lM.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[lM.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[lM.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[lM.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[lM.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[lM.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[lM.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[lM.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[lM.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[lM.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[lM.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[lM.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[lM.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[lM.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[lM.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[lM.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[lM.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[lM.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[lM.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[lM.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[lM.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[lM.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[lM.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[lM.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[lM.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[lM.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[lM.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[lM.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[lM.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[lM.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[lM.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[lM.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[lM.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[lM.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[lM.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[lM.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[lM.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[lM.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function hj(e){return dj[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function pj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pj(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mj(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=fO("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const gj=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,vj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,yj=/wss:\/\/(.+):([0-9]+)\/?/,_j=/wss:\/\/(.[^\/]+)\/?/;let Ej=0;class bj{constructor(e,t){JT(this,"id",0),JT(this,"store",void 0),JT(this,"recordIndex",void 0),JT(this,"websockets",[]),JT(this,"try443PortDuration",2e3),JT(this,"forceCloseWSDuration",5e3),JT(this,"try443PortTimeout",null),JT(this,"forceCloseTimeout",null),JT(this,"isTry443PortFailed",!1),JT(this,"isNormalPortFailed",!1),JT(this,"useDoubleDomain",!1),JT(this,"useProxy",!1),JT(this,"startTime",Date.now()),this.id=++Ej,this.try443PortDuration=fO("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];qO.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=fO("GATEWAY_DOMAINS"),i=Date.now(),o=[],s=r.find((t=>{var n;return Nr(n=e.host).call(n,t)}));s||(this.useDoubleDomain=!1);const a=[];if(this.useDoubleDomain)r.forEach((n=>{a.push(mj(fj(fj({},e),{},{host:e.host.replace(s,n)}),t))}));else{const n=fj({},e);if(t&&s){const e=r.find((e=>e!==s));e&&(n.host=n.host.replace(s,e))}a.push(mj(n,t))}try{a.forEach((e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)}))}catch(r){if(this.logger("ws create failed"),o.forEach((e=>e.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new tk(mI.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=IR();this.store&&this.store.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},this.recordIndex),o.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState));const r=o.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING));this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(r)),r&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:DM.A_ROUND_WS_FAILED})):!t&&r&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),u()),t?this.isTry443PortFailed=r:this.isNormalPortFailed=r},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...o);const l=()=>{this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))},u=()=>{if(c.isResolved)return l();jR().os===NR.MAC_OS&&GR()&&l(),this.createWebSocket(e,!0,!0).then((e=>{c.resolve(e)})).catch((e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,l()}),this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,l()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,u()}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(gj)||[],t||([,n,r]=e.match(vj)||[]),n&&r||([,n,r]=e.match(yj)||[]),n&&r||([,n]=e.match(_j)||[]),n||qO.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(qO.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}}function wj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class Sj extends kI{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Nr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(gM.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(gM.CONNECTED):"closed"===this._state?this.emit(gM.CLOSED):"failed"===this._state&&this.emit(gM.FAILED))}resetReconnectCount(e){qO.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),JT(this,"connectionID",0),JT(this,"currentURLIndex",0),JT(this,"urls",[]),JT(this,"_reconnectMode","tryNext"),JT(this,"reconnectReason",void 0),JT(this,"_initMutex",void 0),JT(this,"name",void 0),JT(this,"_state","closed"),JT(this,"reconnectInterrupter",void 0),JT(this,"websocket",void 0),JT(this,"retryConfig",void 0),JT(this,"reconnectCount",0),JT(this,"forceCloseTimeout",5e3),JT(this,"onlineReconnectListener",void 0),JT(this,"useCompress",void 0),JT(this,"tryDoubleDomain",!1),JT(this,"use443PortOnly",!1),JT(this,"wsInflateLength",0),JT(this,"wsDeflateLength",0),JT(this,"closeEstablishingWs",(()=>{})),JT(this,"store",void 0),JT(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wj(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i,this._initMutex=new Tx("websocket",o?o.clientId:void 0);const{timeout:s,timeoutFactor:a}=t,c=Math.max(300,Math.floor(3*s/5)),l=Math.max(1.2,Math.floor(8*a)/10);HI.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),XI.on(GI.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===HI.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=s,this.retryConfig.timeoutFactor=a))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const e=IR(),t=this.urls[this.currentURLIndex];fO("ENABLE_PREALLOC_PC")&&this.emit(ej.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(gM.CLOSED,(()=>{e.reject(new gI(mI.WS_DISCONNECT))})),this.once(gM.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void qO.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),qO.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new gI(mI.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new gI(mI.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=IR();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),qO.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(qO.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new gI(mI.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=$I(this,gM.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void qO.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new gI(mI.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},o=e=>{this.emit(gM.ON_MESSAGE,e)},s=e=>{qO.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),fO("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=fO("GATEWAY_WSS_ADDRESS")),qO.debug("[".concat(this.name,"] start connect, url:"),e);const a=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=s,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this.joinGatewayRecordIndex=a}catch(e){const t="closed"===this.state,r=e instanceof gI,o=r&&e.code===mI.WS_ABORT,s=r&&e.code===mI.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());qO.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:o?"aborted":"error",errors:[e]},a),t||s?(n.reject(t?new gI(mI.WS_DISCONNECT,"websocket is closed: ".concat(c)):new gI(mI.WS_ERR,"init websocket failed: ".concat(c))),s&&qO.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;qO.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||XI.isOnline||!XI.onlineWaiter||(this.onlineReconnectListener=XI.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=Rx(this.reconnectCount,this.retryConfig);qO.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await zh.race([dx(t),this.onlineReconnectListener||new zh((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(gM.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);qO.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(qO.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await qI(this,gM.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;qO.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Nr(r).call(r,"dynamic key expired")?(this.emit(gM.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class Tj extends Sj{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=IR(),r=function(e,t){return new bj(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{qO.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new gI(mI.WS_ABORT,"choose best websocket aborted"))};const i=fO("GATEWAY_DOMAINS");return qO.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class Cj extends Sj{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new zh(((n,r)=>{let i=!1;const o=[];this.closeEstablishingWs=()=>{qO.debug("[choose-best-ws] close establishing websockets"),o.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new gI(mI.WS_ABORT,"choose best websocket aborted"))};const s=fO("GATEWAY_DOMAINS");let a;const c=e.indexOf("?h="),l=s.find((t=>-1!==c?Nr(e).call(e,t,c):Nr(e).call(e,t)));qO.debug("[choose-best-ws] currentDomain: ",l,", domains: ",s);let u=!this.tryDoubleDomain||!l;if(!u&&l){var d;const h=Date.now();try{s.forEach((t=>{const n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),qO.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(qO.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((e=>e.close()));o.length;)o.pop();u=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},t),o.forEach((e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;qO.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),o.filter((t=>t!==e)).forEach((e=>{qO.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{a=e,i||o.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(qO.debug("[choose-best-ws] all websocket is closed"),i=!0,r(a))},e.onmessage=t=>{qO.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),dx(this.forceCloseTimeout).then((()=>{o.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(u){var h;let i;qO.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),o.push(i),i.binaryType="arraybuffer"}catch(e){const n=new gI(mI.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return qO.error("[".concat(this.name,"]").concat(n)),void r(n)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{qO.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},dx(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class Aj extends kI{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===uM.CONNECTED?this.emit(dM.WS_CONNECTED):e===uM.RECONNECTING?this.emit(dM.WS_RECONNECTING,this._websocketReconnectReason):e===uM.CLOSED&&this.emit(dM.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),JT(this,"_disconnectedReason",void 0),JT(this,"_websocketReconnectReason",void 0),JT(this,"_connectionState",uM.CLOSED),JT(this,"reconnectToken",void 0),JT(this,"websocket",void 0),JT(this,"openConnectionTime",void 0),JT(this,"clientId",void 0),JT(this,"lastMsgTime",Date.now()),JT(this,"uploadCache",[]),JT(this,"uploadCacheInterval",void 0),JT(this,"rttRolling",new Ox(5)),JT(this,"pingpongTimer",void 0),JT(this,"wsInflateDataTimer",void 0),JT(this,"pingpongTimeoutCount",0),JT(this,"joinResponse",void 0),JT(this,"multiIpOption",void 0),JT(this,"initError",void 0),JT(this,"spec",void 0),JT(this,"store",void 0),JT(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(dM.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===fM.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===fM.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(UI.UID_BANNED);break;case 15:this.close(UI.IP_BANNED);break;case 16:this.close(UI.CHANNEL_BANNED)}if(t._type===fM.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case lM.ERR_LICENSE_MISSING:this.close(UI.LICENSE_MISSING);break;case lM.ERR_LICENSE_EXPIRED:this.close(UI.LICENSE_EXPIRED);break;case lM.ERR_LICENSE_MINUTES_EXCEEDED:this.close(UI.LICENSE_MINUTES_EXCEEDED);break;case lM.ERR_LICENSE_PERIOD_INVALID:this.close(UI.LICENSE_PERIOD_INVALID);break;case lM.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(UI.LICENSE_MULTIPLE_SDK_SERVICE);break;case lM.ERR_LICENSE_ILLEGAL:this.close(UI.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Tj("gateway-".concat(this.clientId),this.spec.retryConfig,!0,fO("JOIN_GATEWAY_USE_DUAL_DOMAIN"),fO("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===uM.CONNECTED&&this.reconnect("retry",zI.OFFLINE)}))}async request(e,t,n,r){const i=hx(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new zh(((t,n)=>{if(this.connectionState===uM.CONNECTED)return t();const r=()=>{this.off(dM.WS_CLOSED,i),t()},i=()=>{this.off(dM.WS_CONNECTED,r),n(new tk(mI.WS_ABORT))};this.once(dM.WS_CONNECTED,r),this.once(dM.WS_CLOSED,i),e!==hM.PUBLISH&&e!==hM.PUBLISH_DATASTREAM&&e!==hM.SUBSCRIBE&&e!==hM.SUBSCRIBE_DATASTREAM&&e!==hM.UNSUBSCRIBE&&e!==hM.UNSUBSCRIBE_DATASTREAM&&e!==hM.UNPUBLISH&&e!==hM.UNPUBLISH_DATASTREAM&&e!==hM.CONTROL&&e!==hM.RESTART_ICE||this.once(dM.DISCONNECT_P2P,(()=>{n(new tk(mI.DISCONNECT_P2P))})),e!==hM.PUBLISH&&e!==hM.RESTART_ICE||this.once(dM.ABORT_P2P_EXECUTION,(()=>{n(new tk(mI.DISCONNECT_P2P))}))}));if(this.connectionState!==uM.CONNECTING&&this.connectionState!==uM.RECONNECTING||e===hM.JOIN||e===hM.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new zh(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(dM.WS_CLOSED,c),this.off(dM.WS_RECONNECTING,c),this.emit(dM.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new tk(mI.WS_ABORT,"type: ".concat(e))),this.off(dM.WS_CLOSED,c),this.off(dM.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(dM.WS_CLOSED,c),this.once(dM.WS_RECONNECTING,c),dx(fO("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(qO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(dM.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===uM.CLOSED||e===hM.LEAVE)throw new tk(mI.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===hM.JOIN||e===hM.REJOIN?null:(await a(),await this.request(e,t))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=hj(u),h=new tk(mI.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:d.desc});return"success"===d.action?l.message:(qO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===lM.ERR_TOO_MANY_BROADCASTERS?e===hM.JOIN||e===hM.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===lM.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,qO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zI.MULTI_IP)):this.reconnect(d.action,zI.SERVER_ERROR),e===hM.JOIN||e===hM.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new zh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void qO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(pM.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=fO("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==uM.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),fO("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new zh(((t,n)=>{this.once(dM.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(dM.WS_CLOSED,(e=>n(this.initError||new tk(mI.WS_ABORT,e)))),this.connectionState=uM.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||UI.LEAVE,this.connectionState=uM.CLOSED,qO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(dM.ABORT_P2P_EXECUTION);const e=await qI(this,dM.REQUEST_JOIN_INFO),t=await this.request(hM.JOIN,e);if(!t)return this.emit(dM.REPORT_JOIN_GATEWAY,DM.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(dM.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=uM.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new tk(mI.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=YI(this,dM.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(hM.REJOIN,e);return!!t&&(this.connectionState=uM.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(fM.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(fM.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(fM.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(fM.MUTE_AUDIO,{uid:e.uid}):this.emit(fM.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(fM.MUTE_VIDEO,{uid:e.uid}):this.emit(fM.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(fM.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(fM.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(fM.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(fM.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(fM.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){qO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=hj(e.code);if(28===e.code&&"detail"in e&&(qO.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(dM.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(UI.UID_BANNED),void this.close()):void this.reconnect(t.action,zI.SERVER_ERROR);qO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=fO("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(qO.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>fO("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zI.TIMEOUT):this.request(hM.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),fO("REPORT_STATS")&&this.send(hM.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(pM.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(gM.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(dM.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(gM.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(gM.CLOSED,(()=>{this.connectionState=uM.CLOSED})),this.websocket.on(gM.FAILED,(()=>{this._disconnectedReason=UI.NETWORK_ERROR,this.connectionState=uM.CLOSED})),this.websocket.on(gM.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===uM.CONNECTED?this.connectionState=uM.RECONNECTING:this.connectionState=uM.CONNECTING})),this.websocket.on(gM.WILL_RECONNECT,((e,t,n)=>{const r=YI(this,dM.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(qO.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=DM.P2P_DISCONNECTED),i&&(qO.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(dM.REPORT_JOIN_GATEWAY,t||DM.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(dM.DISCONNECT_P2P)),n(e)})),this.websocket.on(gM.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{qO.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",zI.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(dM.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof tk){if(e.code===mI.UNEXPECTED_RESPONSE&&e.data.code===lM.ERR_NO_AUTHORIZED)return this.initError=new tk(mI.TOKEN_EXPIRE,"dynamic key expired"),void this.close(UI.TOKEN_EXPIRE);qO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zI.SERVER_ERROR):(this.initError=e,this.close())}}))})),this.websocket.on(gM.REQUEST_NEW_URLS,((e,t)=>{qI(this,dM.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(gM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(fM.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(ej.PRE_CONNECT_PC,(()=>{this.emit(dM.PRE_CONNECT_PC)}))}}let Rj=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Ij=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function xj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xj(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kj(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(fO("TURN_DOMAIN")):(qO.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function Nj(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(fO("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}}));const n=fO("GATEWAY_DOMAINS");let r=n[1]&&Nr(t).call(t,n[1])?1:0;return e.map((e=>{let{domain_prefix:t,port:i,ip:o}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};const s=/^[\.\:\d]+$/.test(o),a=s?"".concat(o.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(o,":").concat(i);return s||qO.debug("Cannot recognized as ip address: ".concat(o,", use as host")),{ip:o,port:i,address:a}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){const e=r.split(";");for(let t=0;t<e.length;t++){var i;const r=xy(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}const o=e.detail&&e.detail.candidate;let s;if(o){const[e,t]=o.split(":");e&&t&&(s={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:s,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Pj(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Dj(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Pj(t.width),"x").concat(Pj(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function Lj(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Mj(e,t){let n,r,i;switch(t){case Ij.CHOOSE_SERVER:r=4096,i="choose server";break;case Ij.CLOUD_PROXY:r=1048576,i="proxy";break;case Ij.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Ij.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new tk(mI.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>Oj(Oj({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:Oj(Oj({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new tk(mI.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function jj(e,t){return await zh.all(e.addresses.map((async e=>({address:fO("USE_TURN_IP")?e.ip:kj(e.ip),tcpport:e.port,udpport:e.port,username:t&&fO("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():aO.username,password:t&&fO("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await OI(t.toString()):aO.password}))))}function Uj(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Pj(e.height),Pj(e.width)),1):(qO.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Vj(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:s}=e;const a={candidateType:t,relayProtocol:n,protocol:s};if("local-candidate"!==r){const e=i.split(".");e.length>=4&&(e[1]="*",e[2]="*"),a.address=e.join("."),a.port=o}return a}function Fj(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fO("SVC_MODE");if(fO("ENABLE_SVC"))return function(e){return e in $x}(e)?e:$x.L1T3}const Bj={[HM.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[HM.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Wj(e,t,n){t.forEach((t=>{var r;const i=Bj[e].find((e=>{var n;let{key:r}=e;return Nr(n=t.extensionName).call(n,r)}));if(!i)return;const o=n.find((e=>{let{extensionName:t}=e;return Nr(t).call(t,i.key)}));o&&Nr(r=o.extensionName).call(r,"gdpr_forbidden")&&(t.extensionName=o.extensionName)}))}function zj(e,t){t.forEach((t=>{var n;const r=Bj[e].find((e=>{var n;let{key:r}=e;return Nr(n=t.extensionName).call(n,r)}));Nr(n=t.extensionName).call(n,"gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)}))}function Hj(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Nr(e).call(e,"abs-send-time")}function Gj(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Nr(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qj(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:c}=t,{useXR:l}=n;let u=[],d=[],h=[],p=[],f=!1,m=!1;if(CO(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(d=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||m||(u=e.attributes.payloads,h=e.attributes.extmaps,m=!0))})),!p||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===u.length)throw new Error("Cannot get audio capabilities from SDP.");if(d.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),u.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(u=u.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),d=d.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),o&&(d=d.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(u=u.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),a&&(null==a?void 0:a.length)>0&&(u=u.filter((e=>{var t;return Nr(a).call(a,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0){const e=d.filter((e=>{var t;return Nr(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));d=e.concat(i?[]:hU(e,d))}const g=fO("UNSUPPORTED_VIDEO_CODEC");return g&&g.length>0&&(d=d.filter((e=>!(e.rtpMap&&Nr(g).call(g,e.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:u,videoCodecs:d,audioExtensions:h,videoExtensions:p}}function Yj(e){const t=CO(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!r){const e=i.attributes.fingerprints;e.length>0&&(r={fingerprints:e})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function Xj(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function Jj(e,t,n){const{cname:r}=e;let i=[];t&&(i=Qj(t)),0===i.length&&(i=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}))),qO.debug("Using candidates from gateway."));const o={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},s={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let a;switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}const c=lU(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach((e=>{l.push({kind:HM.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:HM.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})})),{dtlsParameters:o,iceParameters:s,candidates:i,rtpCapabilities:c,setup:a,cname:r,preSSRCs:l}}function Qj(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],qO.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),qO.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Zj(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:s}=e;const a=hx(8,"track-"),c={ssrcId:o,attributes:Kj({label:a,mslabel:n=n||hx(10,""),msid:"".concat(n," ").concat(a)},t&&{cname:t})};if(r.push(c),void 0!==s){const e={ssrcId:s,attributes:Kj({label:a,mslabel:n,msid:"".concat(n," ").concat(a)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,s]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function eU(e,t){t instanceof TP&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!GR()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function tU(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function nU(e,t){var n;if(!(t instanceof pD&&t._encoderConfig&&-1===t._hints.indexOf(wk.SCREEN_TRACK)))return;const r=t._encoderConfig;rk().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;Nr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),rk().supportMinBitrate&&!Nr(n=t._hints).call(n,wk.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;Nr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(fO("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function rU(e){if("video"!==e.media.mediaType)return;const t=jR();if(t.name!==PR.SAFARI&&t.os!==NR.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function iU(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>Gj(e.extensionName)));if(t){const n=t.extensionName;e.attributes.extmaps.find((e=>Gj(e.extensionName)))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads);r.forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>Gj(e.extensionName)));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>Hj(e.extensionName)));if(t){const n=t.extensionName;e.attributes.extmaps.find((e=>e.extensionName===n))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads);r.forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>Hj(e.extensionName)));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function oU(e,t,n){if(GR())return;if("video"!==e.media.mediaType)return;if(!(t instanceof pD))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!fO("SIMULCAST"))return;if("vp9"===n&&fO("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),s={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<r;a++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:ex(i.attributes)}),s.ssrcIds.push(i.ssrcId+a),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+a,attributes:ex(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,o.ssrcIds[1]+a]}));e.attributes.ssrcGroups.unshift(s)}async function sU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:o,sendrecv:s}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=$j(n,e,t,"sendonly"),i=$j(n,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(cU(r,i,"videoExtensions",o,s,a),cU(r,i,"videoCodecs",o,s,a),cU(r,i,"audioExtensions",o,s,a),cU(r,i,"audioCodecs",o,s,a),fO("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];a.videoCodecs.forEach(((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){var o,s;const i=a.videoCodecs[r+1],c=i&&vU(n,i),l=null===(o=n.fmtp)||void 0===o?void 0:o.parameters["profile-level-id"],u=null===(s=n.fmtp)||void 0===s?void 0:s.parameters["packetization-mode"];!l||l!==fO("FIRST_H264_PROFILE_LEVEL_ID")||fO("FIRST_PACKETIZATION_MODE")&&u!==fO("FIRST_PACKETIZATION_MODE")?c?t.push([n,i]):t.push([n]):c?e.push([n,i]):e.push([n])}})),e.length>0&&t.length>0&&(qO.debug("raising H264 baseline profile priority"),a.videoCodecs.forEach(((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){const i=vU(n,a.videoCodecs[r+1]),o=e.shift()||t.shift()||[];o.length>0&&(i?a.videoCodecs.splice(r,2,...o):a.videoCodecs.splice(r,1,...o))}})),s.videoCodecs=s.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==fO("FIRST_H264_PROFILE_LEVEL_ID"))})),fO("FILTER_SEND_H264_BASELINE")&&(o.videoCodecs=o.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==fO("FIRST_H264_PROFILE_LEVEL_ID"))}))))}return{send:o,recv:s,sendrecv:a}}(e,t,r);try{n.close()}catch(e){}return{send:i,recv:o,sendrecv:s}}function aU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=$j(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(cU(e,t,"videoExtensions",n,r,i),cU(e,t,"videoCodecs",n,r,i),cU(e,t,"audioExtensions",n,r,i),cU(e,t,"audioCodecs",n,r,i),fO("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){qO.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}function cU(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}}function lU(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function uU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function dU(e,t,n,r){let i=[];if(e===HM.VIDEO){if(fO("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return Nr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===fO("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){let e=[];const o=[],s=[],a=[];if(n.videoCodecs.forEach((t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Nr(n).call(n,r)?e.push(t):Nr(n).call(n,"vp9")?o.push(t):Nr(n).call(n,"vp8")?s.push(t):Nr(n).call(n,"h264")&&a.push(t)})),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==s.length?(e=s,t="vp8"):0!==a.length&&(e=a,t="h264"),qO.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(0===i.length&&(qO.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),fO("USE_PUB_RTX")||fO("USE_SUB_RTX")){const e=hU(i,t.videoCodecs);i=[...i,...e]}}else i=t.audioCodecs.filter((e=>{var t;return Nr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)})),0===i.length&&(qO.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return Nr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})));return i}function hU(e,t){const n=e.map((e=>e.payloadType.toString()));return t.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Nr(n).call(n,e.fmtp&&e.fmtp.parameters.apt)))}async function pU(e,t,n){const r=t.toString(),i=mU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let s=o.sdp;s=fU(s,n||{}),null==i||i(s||""),await e.setLocalDescription({type:"answer",sdp:s})}function fU(e,t,n){const r=CO(e),{useXR:i}=t;return r.mediaDescriptions.forEach((e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Nr(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&uU(e),i&&Nr(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))))})),AO(r)}function mU(e,t,n,r){if(fO("SDP_LOGGING"))return qO.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{mU(e,"answer","local"===n?"remote":"local",r)}:void 0}function gU(e){const t=fO("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((t=>Nr(e).call(e,t)))}function vU(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function yU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _U(e,t){return typeof fO(e)===t?fO(e):void 0}function EU(){try{const e=fO("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yU(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}catch(e){return qO.debug("handle gateway attributes failed: ",e),{}}}const bU={};function wU(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&qO.debug("install service ".concat(e.name)),bU[e.name]=e}function SU(e){const t=bU[e];if(!t)throw new gI(mI.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function TU(e,t){return SU("DataStream").create(e,t)}function CU(){return SU("InterceptFrame").create()}function AU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AU(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const IU=new Map;class xU extends kI{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(PM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(PM.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){qO.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,r,i;super(),JT(this,"store",void 0),JT(this,"joinInfo",void 0),JT(this,"key",void 0),JT(this,"ntpOffset",0),JT(this,"signal",void 0),JT(this,"role",void 0),JT(this,"inChannelInfo",{joinAt:null,duration:0}),JT(this,"spec",void 0),JT(this,"_state","DISCONNECTED"),JT(this,"_statsCollector",void 0),JT(this,"_disconnectedReason",void 0),JT(this,"isSignalRecover",!1),JT(this,"hasChangeBGPAddress",!1),JT(this,"trafficStatsInterval",void 0),JT(this,"networkQualityInterval",void 0),JT(this,"_joinGatewayStartTime",0),JT(this,"_signalTimeout",!1),JT(this,"_clientRoleOptions",void 0),JT(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:RU(RU({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(r=(i=SU("P2PChannel")).createSubmodule)||void 0===r?void 0:r.call(i,n)):new Aj(RU(RU({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=IU.get(e.cname);if(i||(i=new Map,IU.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new tk(mI.UID_CONFLICT);throw ek.joinGateway(e.sid,{lts:r,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const s=e.proxyServer;try{qO.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const t=e.gatewayAddrs.map((t=>{let{address:n}=t;const[r,i]=n.split(":"),o={host:r,port:i};return e.proxyServer&&(o.proxy=e.proxyServer),o}));o=(await this.signal.init(t)).uid,qO.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var a;throw qO.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),ek.joinGateway(e.sid,{lts:r,succ:!1,ec:(null===(a=t.data)||void 0===a?void 0:a.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s,signalChannel:"0",preload:e.preload}),i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),qO.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{qO.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(PM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(PM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(PM.NETWORK_QUALITY,{uplinkNetworkQuality:Lj(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Lj(this._statsCollector.trafficStats.B_dnq)}):this.emit(PM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==UI.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==uM.CONNECTED||await function(e,t){return t===1/0?e:zh.race([e,ux(t)])}(this.signal.request(hM.LEAVE,void 0,!0),3e3)}catch(e){qO.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==UI.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:fO("PUB_EXTEND"),twcc:!!fO("PUBLISH_TWCC"),rtx:!!fO("USE_PUB_RTX")};try{return(await this.signal.request(hM.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===lM.ERR_PUBLISH_REQUEST_INVALID)return qO.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(hM.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===lM.ERR_PUBLISH_REQUEST_INVALID)return qO.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(hM.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){qO.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await zh.all(e.map((e=>this.signal.request(hM.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(e){qO.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!fO("SUBSCRIBE_TWCC"),rtx:!!fO("USE_SUB_RTX")||void 0,extend:fO("SUB_EXTEND"),svc:Array.isArray(fO("SVC"))&&0!==fO("SVC").length?fO("SVC"):void 0};try{return await this.signal.request(hM.PRE_SUBSCRIBE,r,!0)}catch(r){if(n&&r.data&&r.data.code===lM.ERR_SUBSCRIBE_REQUEST_INVALID)return qO.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),r.toString()),this.presubscribe(e,t,!1);throw r}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!fO("SUBSCRIBE_TWCC"),rtx:!!fO("USE_SUB_RTX"),extend:fO("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(fO("SVC"))&&0!==fO("SVC").length?fO("SVC"):void 0};try{return(await this.signal.request(hM.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===lM.ERR_SUBSCRIBE_REQUEST_INVALID)return qO.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(hM.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===lM.ERR_SUBSCRIBE_REQUEST_INVALID)return qO.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!fO("USE_SUB_RTX"),twcc:!!fO("SUBSCRIBE_TWCC"),svc:Array.isArray(fO("SVC"))&&0!==fO("SVC").length?fO("SVC"):void 0};try{return await this.signal.request(hM.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===lM.ERR_SUBSCRIBE_REQUEST_INVALID)return qO.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(hM.SET_VIDEO_PROFILE,t);qO.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(hM.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){qO.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new tk(mI.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await zh.all(e.map((e=>this.signal.request(hM.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(e){qO.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(hM.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){qO.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(hM.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(hM.GATEWAY_INFO)}async renewToken(e){await this.signal.request(hM.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),fO("CLIENT_ROLE_OPTIONS")&&(qO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(fO("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},fO("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),fO("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},fO("CLIENT_ROLE_OPTIONS")),qO.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(fO("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(hM.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(hM.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(hM.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(hM.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(hM.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(hM.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),RU({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(hM.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=IU.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:aO.username,password:aO.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(RU(RU({},aO),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(hM.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&ZI((()=>{this.emit(PM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new tk(mI.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let n=fO("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}var r;n&&n.length>128&&(n=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(PM.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,Nr(_L).call(_L,r)||_L.push(r);const i=!(GR()||$R(87)||ok())&&"boolean"==typeof fO("ENABLE_PRE_SUB")&&fO("ENABLE_PRE_SUB"),o=!ok()&&_U("ENABLE_PREALLOC_PC","boolean"),s=EU(),a=KR(87)||function(){const e=jR();if(e.name!==PR.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}(),c=RU({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:iO,browser:navigator.userAgent,process_id:fO("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:fO("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:RU({enableEncodedTransform:!!fO("ENABLE_AUDIO_METADATA")&&a||!!fO("ENABLE_AUDIO_TOPN")&&YR(PR.CHROME,87,116)||void 0,enableAudioMetadata:!!fO("ENABLE_AUDIO_METADATA")&&a,enableAudioPts:!!fO("ENABLE_AUDIO_PTS_METADATA")&&a,topnSmoothLevel:fO("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:fO("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:fO("TOPN_SWITCH_HOLD_MS"),topnAudioGain:fO("TOPN_AUDIO_GAIN"),enablePublishedUserList:fO("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:fO("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:_U("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:_U("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:_U("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===fO("USE_PUB_RTX")||!0===fO("USE_SUB_RTX")||void 0,disableFEC:fO("DISABLE_FEC"),enableNTPReport:!!fO("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!fO("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!fO("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:_U("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!fO("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!fO("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:_U("USE_XR","boolean"),enableLossbasedBwe:_U("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!fO("ENABLE_AUT_CC")||void 0,enableCCFallback:_U("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:i?_U("PRE_SUB_NUM","number"):void 0,enablePubTWCC:_U("PUBLISH_TWCC","boolean"),enableSubTWCC:_U("SUBSCRIBE_TWCC","boolean"),enablePubRTX:_U("USE_PUB_RTX","boolean"),enableSubRTX:_U("USE_SUB_RTX","boolean"),enableSubSVC:fO("ENABLE_SVC")?fO("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(fO("SVC"))&&0!==fO("SVC").length?fO("SVC"):void 0,enableSvcExtended:fO("ENABLE_SVC")&&Array.isArray(fO("SVC_EXTENDED"))&&0!==fO("SVC_EXTENDED").length?fO("SVC_EXTENDED"):void 0},s)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,fO("ENCRYPT_AES")?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(c.default_video_stream=this.joinInfo.defaultVideoStream),c}getRejoinMessage(){if(!this.joinInfo)throw new tk(mI.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(dM.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(dM.WS_RECONNECTING,(e=>{this.joinInfo&&ek.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||zI.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ek.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(dM.WS_CLOSED,(e=>{let t;switch(e){case UI.LEAVE:t=zI.LEAVE;break;case UI.UID_BANNED:case UI.IP_BANNED:case UI.CHANNEL_BANNED:case UI.SERVER_ERROR:t=zI.SERVER_ERROR;break;case UI.FALLBACK:t=zI.FALLBACK;break;case UI.LICENSE_MISSING:case UI.LICENSE_EXPIRED:case UI.LICENSE_MINUTES_EXCEEDED:case UI.LICENSE_PERIOD_INVALID:case UI.LICENSE_MULTIPLE_SDK_SERVICE:case UI.LICENSE_ILLEGAL:case UI.TOKEN_EXPIRE:t=e;break;default:t=zI.NETWORK_ERROR}qO.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+zI.NETWORK_ERROR)),this.joinInfo&&ek.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===UI.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==UI.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(dM.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=fO("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(qO.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(ek.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void qO.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));pO("EVENT_REPORT_DOMAIN",e[1]),pO("EVENT_REPORT_BACKUP_DOMAIN",e[1]),pO("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}})),this.signal.on(fM.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(dM.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new tk(mI.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,qI(this,PM.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(dM.REQUEST_JOIN_INFO,(async(e,t,n)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const i=ex(null===(r=this.joinInfo)||void 0===r?void 0:r.turnServer);if(fO("NEW_TURN_MODE")&&i){let e=i.servers,t=i.serversFromGateway;const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],i.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],i.serversFromGateway=t),qO.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n))}const{iceParameters:o,dtlsParameters:s,rtpCapabilities:a}=await qI(this,PM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:i});try{e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:s,rtpCapabilities:a,version:"2"}}))}catch(e){t(e)}})),this.signal.on(dM.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(dM.REPORT_JOIN_GATEWAY,((e,t)=>{if(!this.joinInfo)return;let n,r="";var i;e instanceof tk?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,r=e.message):n=e,ek.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(dM.IS_P2P_DISCONNECTED,(e=>{e(YI(this,PM.IS_P2P_DISCONNECTED))})),this.signal.on(dM.DISCONNECT_P2P,(()=>{this.emit(PM.DISCONNECT_P2P)})),this.signal.on(dM.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(dM.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(dM.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(PM.JOIN_RESPONSE,e,t)})),this.signal.on(dM.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),t=fO("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){const n=Qj(e);this.emit(PM.PRE_CONNECT_PC,{candidates:n,fingerprint:t})}}})),this.signal.on(dM.RECOVER_NOTIFICATION,(e=>{this.joinInfo&&"string"==typeof fO("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(fO("AP_REQUEST_DETAIL"),";").concat(e))}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(hM.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(hM.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw qO.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(hM.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(hM.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw qO.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(hM.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===NM.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(hM.CONTROL,n,!0,!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===NM.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(hM.CONTROL,n,!0,!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===HM.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(hM.CONTROL,n,!0,!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===HM.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(hM.CONTROL,n,!0,!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(hM.RESTART_ICE,t,!0)}catch(e){throw qO.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||zI.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!fO("GATEWAY_WSS_ADDRESS"))return fO("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(qO.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(hM.SET_PARAMETER,{enablePublishAudioFilter:e})}}let OU=0,kU=0;function NU(e,t,n,r){return new zh(((i,o)=>{t.timeout=t.timeout||fO("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),OU+=cx(t.data)):n&&(t.data.size?OU+=t.data.size:t.data instanceof FormData?OU+=lx(t.data):OU+=cx(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,AR.request(t).then((e=>{"string"==typeof e.data?kU+=cx(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?kU+=e.data.byteLength:kU+=cx(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{AR.isCancel(e)?o(new tk(mI.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new tk(mI.NETWORK_TIMEOUT,e.message)):e.response?o(new tk(mI.NETWORK_RESPONSE_ERROR,e.response.status)):o(new tk(mI.NETWORK_ERROR,e.message))}))}))}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function s(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var s=e[r];if(!(s in n))break e;n=n[s]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function a(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(s("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),s("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var s=o[t[r]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&i(s.prototype,e,{configurable:!0,writable:!0,value:function(){return a(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var l;e:{var u={};try{u.__proto__={a:!0},l=u.a;break e}catch(e){}l=!1}r=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=r;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function f(e,t){return e.h=3,{value:t}}function m(e){this.g=new h,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),v(e)}return e.g.j=null,r.call(e.g,o),v(e)}function v(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function y(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),v(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function _(e,t){return t=new y(new m(t)),d&&e.prototype&&d(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),v(this))},m.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),v(this))},s("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var E=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},w=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},T="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,C=T.FormData,A=T.XMLHttpRequest&&T.XMLHttpRequest.prototype.send,R=T.Request&&T.fetch,I=T.navigator&&T.navigator.sendBeacon,x=T.Element&&T.Element.prototype,O=T.Symbol&&Symbol.toStringTag;O&&(Blob.prototype[O]||(Blob.prototype[O]="Blob"),"File"in T&&!File.prototype[O]&&(File.prototype[O]="File"));try{new File([],"")}catch(e){T.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),O&&Object.defineProperty(e,O,{value:"File"}),e}}var k=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},N=function(e){this.i=[];var t=this;e&&E(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];E(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?E(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))}))};if((e=N.prototype).append=function(e,t,n){S(arguments,2),this.i.push(w(e,t,n))},e.delete=function(e){S(arguments,1);var t=[];e=String(e),E(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return _(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=f(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){S(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){S(arguments,1);var t=[];return e=String(e),E(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return _(e,(function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,f(e,c(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){S(arguments,2),e=String(e);var r=[],i=w(e,t,n),o=!0;E(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,o=this;return _(e,(function(e){if(1==e.h&&(t=c(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),f(e,i.next().value));n=t.next(),e.h=2}))},N.prototype._asNative=function(){for(var e=new C,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},N.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+k(b(r))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+k(b(r))+'"; filename="'+k(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},N.prototype[Symbol.iterator]=function(){return this.entries()},N.prototype.toString=function(){return"[object FormData]"},x&&!x.matches&&(x.matches=x.matchesSelector||x.mozMatchesSelector||x.msMatchesSelector||x.oMatchesSelector||x.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),O&&(N.prototype[O]="FormData"),A){var P=T.XMLHttpRequest.prototype.setRequestHeader;T.XMLHttpRequest.prototype.setRequestHeader=function(e,t){P.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},T.XMLHttpRequest.prototype.send=function(e){e instanceof N?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),A.call(this,e)):A.call(this,e)}}R&&(T.fetch=function(e,t){return t&&t.body&&t.body instanceof N&&(t.body=t.body._blob()),R.call(this,e,t)}),I&&(T.navigator.sendBeacon=function(e,t){return t instanceof N&&(t=t._asNative()),I.call(this,e,t)}),T.FormData=N}}();const PU=()=>{const e=fO("AREAS");return 0===e.length&&e.push(MM.GLOBAL),Xr(e).call(e,((e,t,n)=>{const r=DU(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},DU=e=>e===MM.OVERSEA?"".concat(UM.ASIA,",").concat(UM.EUROPE,",").concat(UM.AFRICA,",").concat(UM.NORTH_AMERICA,",").concat(UM.SOUTH_AMERICA,",").concat(UM.OCEANIA):UM[e],LU=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=VM[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},MU={GLOBAL:{ASIA:[MM.CHINA,MM.JAPAN,MM.INDIA,MM.KOREA,MM.HKMC],EUROPE:[],NORTH_AMERICA:[MM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},jU=Object.keys(MU[MM.GLOBAL]),UU=[MM.CHINA,MM.NORTH_AMERICA,MM.EUROPE,MM.ASIA,MM.JAPAN,MM.INDIA,MM.OCEANIA,MM.SOUTH_AMERICA,MM.AFRICA,MM.KOREA,MM.HKMC,MM.US],VU=function(e,t){let n=[];if(Nr(e).call(e,MM.GLOBAL)){const o=[MM.GLOBAL,MM.OVERSEA],s=Object.keys(VM);if(t===MM.GLOBAL)throw new tk(mI.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===MM.CHINA)n=[MM.OVERSEA];else if(i=t,Nr(jU).call(jU,i)){const e=(r=t,MU[MM.GLOBAL][r]||[]),i=[...o,t,...e];n=s.filter((e=>!Nr(i).call(i,e)))}else if(function(e){let t=!1;return jU.forEach((n=>{var r;Nr(r=MU[MM.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){const e=function(e){let t;return jU.forEach((n=>{var r;Nr(r=MU[MM.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...o,e,t];n=s.filter((e=>!Nr(r).call(r,e)))}else n=e;n=function(e){const t=[];return UU.forEach((n=>{Nr(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!Nr(UU).call(UU,e))))}(n)}else n=e;var r,i;return n};function FU(e){var t,n;if(!e&&Nr(t=fO("AREAS")).call(t,MM.EXTENSIONS))return qO.debug("update area from ap : reset"),void BU(gL,!0);if(!Nr(n=fO("AREAS")).call(n,MM.GLOBAL)||!e)return;let r=VM.EXTENSIONS;r&&(r={CODE:DU(MM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},qO.debug("update area from ap success: ".concat(e,",config is "),r),pO("AREAS",[MM.EXTENSIONS],!0),Object.keys(r).map((e=>{pO(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function BU(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=ek.reportApiInvoke(null,{name:DI.SET_AREA,options:e,tag:LI.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!Nr(jM).call(jM,e))throw new tk(mI.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new tk(mI.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?VU(i,n):i}if(!t){if(gO.AREAS){const e=new tk(mI.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void qO.warning("setArea is prohibited because of config-distribute")}if(Nr(r).call(r,MM.GLOBAL)&&fO("AREAS")===MM.EXTENSIONS){const e=new tk(mI.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void qO.warning("setArea is prohibited because of ap extensions")}}pO("AREAS",r,t);const i=LU(r);Object.keys(i).map((e=>{pO(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),qO.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function WU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WU(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let HU=1;function GU(e,t,n,r,i){HU+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:HU,requestId:HU,version:iO,cname:n.cname},s={service_name:t,json_body:JSON.stringify(o)};let a,c,l=e[0];return Ix((async()=>{a=Date.now();const e=await NU(l,{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,0!==e.code){const t=new tk(mI.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw qO.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new tk(mI.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw qO.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new tk(mI.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw qO.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(fO("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return fO("LIVE_STREAMING_ADDRESS")&&(i.addressList=fO("LIVE_STREAMING_ADDRESS")instanceof Array?fO("LIVE_STREAMING_ADDRESS"):[fO("LIVE_STREAMING_ADDRESS")]),zU(zU({},i),{},{responseTime:c})}),((r,i)=>(ek.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(ek.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==mI.OPERATION_ABORTED&&r.code!==mI.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0))),i)}let qU=1;function KU(e,t,n,r){let{url:i,areaCode:o}=e;const{clientId:s,sid:a}=t,c=Date.now();let l;const u=t.role,[d,h]=QU(t,o,[Ij.CHOOSE_SERVER]);let p=XI.networkState;return Ix((async()=>{p&&XI.networkState===HI.OFFLINE&&XI.onlineWaiter&&await zh.race([XI.onlineWaiter,dx(r&&r.maxRetryTimeout||Ax.maxRetryTimeout)]),p=XI.networkState;const{data:e,headers:o}=await NU(i,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===o.http3?1:-1,ek.reportResourceTiming(i,a),YU(e,i,t,c,[Ij.CHOOSE_SERVER],l);const s=Mj(e,Ij.CHOOSE_SERVER);return XU(s),Nj(s,i)}),(e=>(e&&ek.joinChooseServer(a,{role:u,lts:c,succ:!0,csAddr:i,opid:h,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[Ij.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1)),(e=>e.code!==mI.OPERATION_ABORTED&&(e.code===mI.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(ek.joinChooseServer(a,{role:u,lts:c,succ:!1,csAddr:i,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[Ij.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),qO.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),e),!0))),r)}function $U(e,t,n,r){let i,{url:o,areaCode:s,serviceIds:a}=e;const c=Date.now(),l=t.role,[u,d]=QU(t,s,a);let h;return Ix((async()=>{h&&XI.networkState===HI.OFFLINE&&XI.onlineWaiter&&await zh.race([XI.onlineWaiter,dx(r&&r.maxRetryTimeout||Ax.maxRetryTimeout)]),h=XI.networkState;const{data:e,headers:s}=await NU(o,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===s.http3?1:-1,ek.reportResourceTiming(o,t.sid),YU(e,o,t,c,a,i);const l=Mj(e,Ij.CHOOSE_SERVER),d=Mj(e,"proxy5"===t.cloudProxyServer?Ij.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?Ij.CLOUD_PROXY:Ij.CLOUD_PROXY_FALLBACK);return XU(l),{gatewayInfo:Nj(l,o),proxyInfo:d,url:o}}),(e=>(e.gatewayInfo&&ek.joinChooseServer(t.sid,{role:l,lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:d,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38]}),e.proxyInfo&&ek.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:a.toString()}),!1)),(e=>e.code!==mI.OPERATION_ABORTED&&(e.code===mI.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(ek.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:h})}),qO.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const YU=(e,t,n,r,i,o)=>{const{sid:s,clientId:a,cloudProxyServer:c}=n,l=[],u=a=>{4096===a.flag?ek.joinChooseServer(s,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:a.error.message,csIp:a.error.data&&a.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):1048576!==a.flag&&4194304!==a.flag&&4194310!==a.flag||ek.joinWebProxyAP(s,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:a.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)qO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(n),u(n)}if(0!==n){const r=uj(n),i={error:new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?qO.warning(i.error.toString()):l.push(i),u(i)}})),l.length)throw qO.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,l.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!l.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(l.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},XU=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(fO("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?FU(e.detail[23].toLowerCase()):FU()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let r=0;r<n.length;r++){var o;const t=xy(o=n[r]).call(o);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(fO("GATEWAY_ADDRESS")&&fO("GATEWAY_ADDRESS").length>0){qO.debug("assign gateway address to",fO("GATEWAY_ADDRESS"));const t=fO("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},JU=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=uj(t.buffer.code);throw new tk(mI.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw qO.debug("update ticket request received ap response without response body:",t),new tk(mI.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},QU=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i="host"===e.role?"1":"audience"===e.role?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:zU(zU(zU({6:e.stringUid,11:t,12:fO("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const s=new FormData;return s.append("request",JSON.stringify(o)),[s,r]},ZU=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let eV=0;function tV(e){return zh.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}const nV=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,s=0;const a=t;let c,l=0;const u=async()=>{const e=(()=>{const e=s*a,t=e+a;return n.slice(e,t).map(r)})();o&&o.push(...e);try{c=await tV(e)}catch(e){if(l+=a,s++,!(l>=n.length))return void await u();i(e)}e.forEach((e=>e.cancel()))};return await u(),c},rV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let o=0;const s=async()=>{const e=n(t.shift());try{return await e}catch(e){if(o++,o>=i||null!=r&&r(e))throw e;return s()}};return s()};async function iV(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],s=async()=>{const i=fO("WEBCS_DOMAIN").slice(0,fO("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:PU()}))),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),a=await nV({fragementLength:fO("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(qO.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),KU(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),a},a=async()=>{if(await dx(1e3),null!==i)return i;const s=fO("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:PU()}))),a=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map((e=>e.url))}),c=await nV({fragementLength:fO("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(qO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),KU(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c};try{return i=await tV([s(),a()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function oV(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await iV(e,t,n,i);if(fO("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await uV(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};const a=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||aO.tcpport,udpport:e.udpport||aO.udpport,username:e.username||aO.username,password:e.password||aO.password,forceturn:!1,security:!0})));if(i.useP2P){var s;const t=null!==(s=e.uid)&&void 0!==s?s:r.uid,n="glb:".concat(t.toString()),i=await OI(n),c=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||aO.tcpport,udpport:e.udpport||aO.udpport,username:n,password:i,forceturn:!1,security:!0})));a.push(...c)}return e.turnServer={mode:"manual",servers:a},{gatewayInfo:r}}return await iV(e,t,n,i)}const{proxyInfo:a,gatewayInfo:c}=await uV(e,t,n,i),l={gatewayInfo:c},u=a.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:aO.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:aO.udpport,username:e.username||aO.username,password:e.password||aO.password,forceturn:"proxy4"!==o,security:"proxy5"===o})));if(i.useP2P){var d;const t=null!==(d=e.uid)&&void 0!==d?d:c.uid,n="glb:".concat(t.toString()),r=await OI(n),i=a.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport||aO.tcpport,udpport:"proxy4"===o?void 0:e.udpport||aO.udpport,username:n,password:r,forceturn:"proxy4"!==o,security:"proxy5"===o})));u.push(...i)}return e.turnServer={mode:"manual",servers:u},qO.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),l}async function sV(e,t,n,r,i){const o=fO("ACCOUNT_REGISTER").slice(0,fO("AJAX_REQUEST_CONCURRENT"));let s=[];s=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));const a=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const o=await async function(e,t,n,r,i){const o=Date.now(),s={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let a=e[0];const c=await Ix((()=>NU(a+"".concat(-1===a.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw qO.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),ek.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:mI.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new tk(mI.INVALID_UINT_UID_FROM_STRING_UID);return ek.reqUserAccount(s.sid,{lts:o,success:!0,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:null,extend:s}),!1}const i=uj(n.code);return i.retry&&(a=e[(r+1)%e.length]),ek.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:i.desc,extend:s}),i.retry}),((t,n)=>t.code!==mI.OPERATION_ABORTED&&(ek.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:null,errorCode:t.code,extend:s}),a=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=uj(c.code);throw new tk(mI.UNEXPECTED_RESPONSE,e.desc)}return c}(s,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),o.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},a),e}}async function aV(e,t,n){const r=fO("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):r.map((e=>"https://".concat(e,"/api/v1")));try{const r=await rV({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){const i=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await NU(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=uj(t.code);throw new tk(mI.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new tk(mI.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:o,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(r,e,t,n),closeFn:e=>e.code===mI.OPERATION_ABORTED||e.code===mI.UNEXPECTED_RESPONSE&&!e.data.retry});return r}catch(e){throw e}}async function cV(e,t,n){const r=fO("CDS_AP").slice(0,fO("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))),i=r.map((r=>function(e,t,n,r){const i=jR(),o={flag:64,cipher_method:0,features:zU(zU(zU(zU(zU({install_id:rO(),device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:iO,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:Rj.WEB_RTC,browser_name:i.name,browser_version:i.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),i.os&&{os_name:i.os}),i.osVersion&&{os_version:i.osVersion}),{},{detail:""})};return Ix((()=>NU(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==mI.OPERATION_ABORTED),r)}(r,e,t,n)));let o=null,s=null,a={};try{o=await tV(i)}catch(e){if(e.code===mI.OPERATION_ABORTED)throw e;s=e}if(i.forEach((e=>e.cancel())),ek.reportApiInvoke(e.sid,{name:DI.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:o}}).onSuccess(),o&&o.test_tags)try{a=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=xy(n=e.slice(4)).call(n),o=JSON.parse(t[e]),s=o[1];r[i]={tag:o[0]||"",value:s}})),r}(o)}catch(e){}return a}async function lV(e,t){const n=fO("WEBCS_DOMAIN").concat(fO("WEBCS_DOMAIN_BACKUP_LIST")).map((e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:PU(),serviceIds:[Ij.CHOOSE_SERVER,Ij.CLOUD_PROXY_FALLBACK]})));try{const r=await rV({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:o,serviceIds:s}=e;const a=Date.now(),[c,l]=QU(t,o,s);let u=XI.networkState;try{u&&XI.networkState===HI.OFFLINE&&XI.onlineWaiter&&await zh.race([XI.onlineWaiter,dx(Ax.maxRetryTimeout)]),u=XI.networkState;const{data:e,headers:t}=await NU(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1;const o=e=>{const t=[];if(e.response_body.forEach((n=>{const r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const r={error:new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){const i=uj(r),o={error:new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?qO.warning(o.error.toString()):t.push(o)}})),t.length)throw new tk(mI.CAN_NOT_GET_GATEWAY_SERVER,t.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!t.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(t.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})};o(e);const s=Mj(e,Ij.CHOOSE_SERVER),d=Mj(e,Ij.CLOUD_PROXY_FALLBACK);return XU(s),{gatewayInfo:Nj(s,i),proxyInfo:d,opid:l,requestTime:a,url:i,isHttp3:r,elapse:Date.now()-a}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===mI.OPERATION_ABORTED||e.code===mI.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return r}catch(e){throw e}}async function uV(e,t,n,r){const i=fO("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let s=null;const a=[],c=async()=>{const i=fO("WEBCS_DOMAIN").slice(0,fO("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:PU(),serviceIds:[Ij.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?Ij.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?Ij.CLOUD_PROXY:Ij.CLOUD_PROXY_FALLBACK]}})),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await nV({fragementLength:fO("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(qO.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),$U(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c},l=async()=>{if(await dx(1e3),null!==s)return s;const i=fO("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:PU(),serviceIds:[Ij.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?Ij.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?Ij.CLOUD_PROXY:Ij.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),l=await nV({fragementLength:fO("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(qO.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),$U(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let u,d,h;try{({gatewayInfo:u,proxyInfo:d,url:h}=await tV([c(),l()]))}catch(e){throw e[0]}if(a.length&&a.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!u||!d)throw new tk(mI.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Nr(i).call(i,t)&&(e.proxyServer=t,qO.setProxyServer(t),ek.setProxyServer(t))}return s={gatewayInfo:u,proxyInfo:await jj(d,u.uid)},s}async function dV(e,t,n){const r=fO("UAP_AP").slice(0,fO("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))),i=r.map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:iO,cname:t.cname,uid:t.uid.toString(),requestId:qU,seq:qU};qU+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return Ix((async()=>{const t=await NU(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new tk(mI.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw qO.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new tk(mI.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw qO.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new tk(mI.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw qO.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(fO("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(fO("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==mI.OPERATION_ABORTED&&e.code!==mI.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await tV(i);return i.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}async function hV(e,t,n){let r=null;const i=[],o=async o=>{const s=fO(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await dx(1e3),null!==r)?r:await nV({fragementLength:fO("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(qO.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=ZU(t,[Ij.CHOOSE_SERVER]);let o=XI.networkState;return Ix((async()=>{o&&XI.networkState===HI.OFFLINE&&XI.onlineWaiter&&await zh.race([XI.onlineWaiter,dx(r&&r.maxRetryTimeout||Ax.maxRetryTimeout)]),o=XI.networkState;const t=await NU(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return JU(t,e)}),(()=>!1),(e=>e.code!==mI.OPERATION_ABORTED&&(e.code===mI.UPDATE_TICKET_FAILED?e.data.retry:(qO.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await tV([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function pV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pV(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class mV extends kI{get isSuccess(){return!!this.configs}constructor(e,t){super(),JT(this,"configs",void 0),JT(this,"store",void 0),JT(this,"joinInfo",void 0),JT(this,"cancelToken",void 0),JT(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),JT(this,"interval",void 0),JT(this,"mutex",void 0),JT(this,"mutableParamsRead",!1),JT(this,"configCache",{}),JT(this,"limit_bitrate",void 0),this.mutex=new Tx("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),fO("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),fO("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ek.reportApiInvoke(null,{options:void 0,name:DI.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:LI.TRACER}).onSuccess(JSON.stringify(gO))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void qO.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await cV(this.joinInfo,this.cancelToken,this.retryConfig),qO.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const n=w_(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let o=0;o<n.length;o++)for(let t=n.length-1;t>o;t--){const r=n[t],i=e[r].value;if("number"==typeof i.__priority){const o=i.__priority,s=n[t-1],a=e[s].value;if("number"==typeof a.__priority){if(!(o>a.__priority))continue;{const e=r;n[t]=n[t-1],n[t-1]=e}}else{const e=r;n[t]=n[t-1],n[t-1]=e}}}const r=Date.now();let i={};return n.forEach((t=>{const n=e[t].value.__expires;n&&n<=r||(i[t]=e[t])})),i}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new tk(mI.NETWORK_RESPONSE_ERROR,e);qO.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){BM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(FM.UPDATE_BITRATE_LIMIT,e):this.emit(FM.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&fV({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},n=Object.keys(e),r=[];n.forEach((n=>{const i=e[n].value;t[n]=i;const o=i.__id;if(o&&this.configCache[n]&&this.configCache[n].__id===o)return;const s=i.__type,a=e[n].value,c=e[n].tag;let l=0;s?s===mO.REALTIME&&(l=1):Object.keys(a).some((e=>Object.prototype.hasOwnProperty.call(dO,e)||!bL()&&Object.prototype.hasOwnProperty.call(cO,e)?(l=1,!0):void 0)),r.push({tag:c,isApplied:l,feature:n,params:JSON.stringify(i)})})),r.forEach((e=>{let{tag:t,feature:n,params:r,isApplied:i}=e;this.store.sessionId&&ek.abTest(this.store.sessionId,{intSucc:1,isApplied:i,tag:t,feature:n,params:r,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=t}catch(e){qO.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n].value,i=r.__expires,o=r.__type;Object.keys(r).forEach((e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=fV(fV({value:r[e]},i&&{expires:i}),o&&{type:o}))}))})),t}(e);try{var n;const r=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,r&&BM(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach((n=>{const{value:r,type:i,expires:o}=e[n];o&&o<=t||((i===mO.REALTIME||Object.prototype.hasOwnProperty.call(dO,n))&&(gO[n]=r,hO[n]=r,qO.debug("Update realtime parameters from config distribute",n,r)),i||bL()||!Object.prototype.hasOwnProperty.call(cO,n)||(gO[n]=r,hO[n]=r,qO.debug("Update gateway parameters from config distribute",n,r)))}))}catch(t){qO.error("Error update config immediately: ".concat(e),t.message)}}(t);const i=JSON.stringify(t),o=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",o),qO.debug("Caching global parameters ".concat(i))}catch(e){qO.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach((n=>{if("CLIENT_ROLE_OPTIONS"===n&&Object.prototype.hasOwnProperty.call(hO,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(hO[n],r)||(gO[n]=r,hO[n]=r,this.emit(FM.UPDATE_CLIENT_ROLE_OPTIONS,r),qO.debug("Updating client role options: ".concat(JSON.stringify(r))))}}))}catch(e){qO.error("Error handling global parameter config:",e.message)}}}class gV extends kI{constructor(){super(...arguments),JT(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(fO("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;const n=Nr(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",vV[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",vV[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof RP&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=Pj(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof RP&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const vV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},yV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function _V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function EV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_V(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class bV{constructor(e){JT(this,"store",void 0),JT(this,"onStatsException",void 0),JT(this,"onUploadPublishDuration",void 0),JT(this,"onStatsChanged",void 0),JT(this,"localStats",new Map),JT(this,"remoteStats",new Map),JT(this,"updateStatsInterval",void 0),JT(this,"trafficStats",void 0),JT(this,"trafficStatsPeerList",[]),JT(this,"uplinkStats",void 0),JT(this,"exceptionMonitor",void 0),JT(this,"p2pChannel",void 0),JT(this,"scalabilityMode",$x.L1T1),JT(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.exceptionMonitor=new gV,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($M.LocalAudioTrack)||EV({},kk)}getLocalVideoTrackStats(){return this.localStats.get($M.LocalVideoTrack)||EV({},Nk)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get($M.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get($M.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const s=this.localStats.get($M.LocalVideoLowTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let a=1;return this.trafficStats&&(a+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:a,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?yV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?yV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&qO.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case $M.LocalVideoTrack:case $M.LocalVideoLowTrack:{const t=r,o=EV({},Nk),s=e.getStats(),a=e.getLocalMedia(n);if(s){const n=s.videoSend.find((e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),i=e.getEncoderConfig($M.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.sendJitterMs=n.jitterMs,o.sendRttMs=n.rttMs,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(qO.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,o);break}case $M.LocalAudioTrack:{const t=r,i=EV({},kk),o=e.getStats(),s=e.getLocalMedia(n);if(o){const n=o.audioSend.find((e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($M.LocalAudioTrack,i),i&&s&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,s.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{var n,r;let[i,{videoStats:o,audioStats:s,videoPcStats:a}]=t;const c=s,l=o,u=a,d=EV({},Pk),h=EV({},Lk),p=EV({},Dk),{audioTrack:f,videoTrack:m,audioSSRC:g,videoSSRC:v}=e.getRemoteMedia(i);let y;y=this.store.useP2P?e.getStats(!0):e.getStats();const _=null===(n=y)||void 0===n?void 0:n.audioRecv.find((e=>e.ssrc===g)),E=null===(r=y)||void 0===r?void 0:r.videoRecv.find((e=>e.ssrc===v)),b=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===i));if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(d.codecType=_.codec),_.outputLevel?d.receiveLevel=Math.round(32767*_.outputLevel):f&&(d.receiveLevel=Math.round(32767*f.getVolumeLevel())),d.receiveBytes=_.bytes,d.receivePackets=_.packets,d.receivePacketsLost=_.packetsLost,d.receivePacketsDiscarded=_.packetsDiscarded,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost),d.receiveBitrate=c?8*Math.max(0,d.receiveBytes-c.receiveBytes):0,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,d.freezeRate=d.totalFreezeTime/d.totalDuration,d.receiveDelay=_.jitterBufferMs,d.totalDuration>10&&bV.isRemoteAudioFreeze(f)&&(d.totalFreezeTime+=1)),E){var w;"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(h.codecType=E.codec),h.receiveBytes=E.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,h.renderFrameRate=E.decodeFrameRate<0?0:E.decodeFrameRate,E.outputFrame&&(h.renderFrameRate=E.outputFrame.frameRate),E.receivedFrame?(h.receiveFrameRate=E.receivedFrame.frameRate,h.receiveResolutionHeight=E.receivedFrame.height,h.receiveResolutionWidth=E.receivedFrame.width):m&&(h.receiveResolutionHeight=m._videoHeight||0,h.receiveResolutionWidth=m._videoWidth||0),void 0!==E.framesRateFirefox&&(h.receiveFrameRate=Math.round(E.framesRateFirefox)),h.receivePackets=E.packets,h.receivePacketsLost=E.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost);const t=l?l.totalFreezeTime:0,n=l?l.totalDuration:0;h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=null!==(w=E.totalFreezesDuration)&&void 0!==w?w:t||0,h.receiveDelay=E.jitterBufferMs||0;const r=!!v&&e.getRemoteVideoIsReady(v);void 0===E.totalFreezesDuration&&m&&r&&bV.isRemoteVideoFreeze(m,E,u)&&(h.totalFreezeTime+=1),h.freezeRate=Math.max(0,Math.min((h.totalFreezeTime-t)/(h.totalDuration-n),1))}b&&(d.end2EndDelay=b.B_ad,h.end2EndDelay=b.B_vd,d.transportDelay=b.B_ed,h.transportDelay=b.B_ed,d.currentPacketLossRate=b.B_ealr4/100,h.currentPacketLossRate=b.B_evlr4/100,p.uplinkNetworkQuality=b.B_punq?b.B_punq:0,p.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(i,{audioStats:d,videoStats:h,videoPcStats:E,networkStats:p}),f&&this.exceptionMonitor.setRemoteAudioStats(f,d),m&&this.exceptionMonitor.setRemoteVideoStats(m,h)}))}}class wV{constructor(){JT(this,"destChannelMediaInfos",new Map),JT(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){RM(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){RM(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){vM(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function SV(e){if(!(e instanceof wV))return new tk(mI.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new tk(mI.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new tk(mI.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class TV{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){JT(this,"uid",void 0),JT(this,"_uintid",void 0),JT(this,"_trust_in_room_",!0),JT(this,"_trust_audio_enabled_state_",!0),JT(this,"_trust_video_enabled_state_",!0),JT(this,"_trust_audio_mute_state_",!0),JT(this,"_trust_video_mute_state_",!0),JT(this,"_audio_muted_",!1),JT(this,"_video_muted_",!1),JT(this,"_audio_enabled_",!0),JT(this,"_video_enabled_",!0),JT(this,"_audio_added_",!1),JT(this,"_video_added_",!1),JT(this,"_is_pre_created",!1),JT(this,"_video_pre_subscribed",!1),JT(this,"_audio_pre_subscribed",!1),JT(this,"_trust_video_stream_added_state_",!0),JT(this,"_trust_audio_stream_added_state_",!0),JT(this,"_audioTrack",void 0),JT(this,"_videoTrack",void 0),JT(this,"_dataChannels",[]),JT(this,"_audioSSRC",void 0),JT(this,"_videoSSRC",void 0),JT(this,"_audioOrtc",void 0),JT(this,"_videoOrtc",void 0),JT(this,"_cname",void 0),JT(this,"_rtxSsrcId",void 0),JT(this,"_videoMid",void 0),JT(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function CV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function AV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CV(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const RV="9",IV=4e4;function xV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function OV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xV(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kV=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(kV||{});const NV=new Map;function PV(e,t,n,r){let{scale:i}=e;if(0===i&&r===kV.UP||i>=t.length-1&&r===kV.DOWN)return e;let o=OV(OV({},e),{},{scale:r===kV.DOWN?++i:--i});switch(n){case"maintain-framerate":o=OV(OV({},o),t[i].motion);break;case"maintain-resolution":o=OV(OV({},o),t[i].detail);break;case"balanced":o=OV(OV({},o),t[i].balanced)}return o}function DV(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:LV(t)};NV.set(e,n)}else NV.delete(e)}function LV(e){const t=OV({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:s,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:u,BWE_SCALE_UP_THRESHOLD:d,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:m,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:v,MOTION_RESOLUTION_FACTOR:y,MOTION_BITRATE_FACTOR:_,DETAIL_FRAMERATE_FACTOR:E,DETAIL_BITRATE_FACTOR:b}=lO,w=Math.min(t.frameRate,a),S=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*w),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o}}];for(let T=1;T<=c;T++){const e={bwe_up:Math.round(Math.pow(d,T)*n),bwe_down:Math.round(Math.pow(h,T+1)*n),fps_up:Math.round(Math.pow(f,T)*w),fps_down:Math.round(Math.pow(p,T+1)*w)},t={scaleResolutionDownBy:i/Math.pow(v,T),frameRate:Math.max(Math.round(Math.pow(g,T)*r),s),bitrateMax:Math.max(Math.round(Math.pow(m,T)*n),u),bitrateMin:Math.max(Math.round(Math.pow(m,T)*o),l)},a={scaleResolutionDownBy:i/Math.pow(y,T),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(_,T)*n),u),bitrateMin:Math.max(Math.round(Math.pow(_,T)*o),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(E,T)*r),s),bitrateMax:Math.max(Math.round(Math.pow(b,T)*n),u),bitrateMin:Math.max(Math.round(Math.pow(b,T)*o),l)};S.push({scale:T,threshold:e,balanced:t,motion:a,detail:c})}return S}function MV(e,t,n,r,i,o){const s=NV.get(e)||{overUse:0,underUse:0,adaptationList:LV(i)},{adaptationList:a}=s;NV.set(e,s);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=lO,{scale:u}=r;let d,h;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return fO("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,u,a,o)&&(s.overUse++,h=Kx.CPU,s.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:r}}=n[t];return e<r}(n,u,a)&&(s.overUse++,h=Kx.BANDWIDTH,s.overUse>c)?(s.overUse=0,s.underUse=0,d=PV(r,a,o,kV.DOWN),[d,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return fO("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,u,a,o)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:r}}=n[t];return e>r}(n,u,a)&&(s.underUse++,s.underUse>l&&(s.overUse=0,s.underUse=0,d=PV(r,a,o,kV.UP),0===d.scale&&(h=Kx.NONE))),[d,h])}function jV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function UV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jV(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function VV(e){var t;return!!fO("ENABLE_AG_ADAPTATION")&&!!(e instanceof fD||Nr(t=e._hints).call(t,wk.CUSTOM_TRACK))&&(!!fO("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(e){const t=jR();if(t.os!==NR.IOS||!t.osVersion)return!1;const n=t.osVersion.split(".");return Number(n[0])>=e}(14)&&QR(17,4,!0)||JR(14)&&ZR(17,4,!0)))}const FV=new Map;function BV(e,t){const n=FV.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),FV.delete(e)}t.qualityLimitationReason=Kx.NONE,DV(e)}function WV(e,t){var n;let r;switch(t){case $M.LocalAudioTrack:r=NM.Audio;break;case $M.LocalVideoTrack:r=Nr(n=e._hints).call(n,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalVideoLowTrack:r=NM.Low}return r}function zV(e){const t=rk();if(e.some((e=>e._bypassWebAudio)))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function HV(e,t){zV(e);const n=t||new RP;return e.forEach((e=>n.addAudioTrack(e))),n}const GV=!rk().supportUnifiedPlan||fO("CHROME_FORCE_PLAN_B")&&lI();function qV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return GV?(n={spec:t,store:e},SU("PlanBConnection").create(n)):new QV(t,e)}function KV(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function $V(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(VI(e.turnServer.servers))return!1;if(fO("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((e=>e.forceturn)))return!0}return!1}catch(e){return!1}}var YV;function XV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?XV(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let QV=(YV=class e extends zM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Nr(t=Object.keys(yO)).call(t,e)})))]}constructor(t,n){super(t,n),JT(this,"id",hx(5,"connection-")),JT(this,"store",void 0),JT(this,"peerConnection",void 0),JT(this,"forceTurn",!1),JT(this,"remoteSDP",void 0),JT(this,"initialOffer",void 0),JT(this,"transportEventReceiver",void 0),JT(this,"statsFilter",void 0),JT(this,"extension",{useXR:fO("USE_XR")}),JT(this,"localCapabilities",void 0),JT(this,"remoteCodecs",void 0),JT(this,"localCandidateCount",0),JT(this,"allCandidatesReceived",!1),JT(this,"isPreallocation",!1),JT(this,"preSSRCMap",new Map),JT(this,"dataStreamChannelMap",new Map),JT(this,"establishPromise",void 0),JT(this,"recoveredDataChannelIds",[]),JT(this,"currentDataChannelId",1),JT(this,"supportAV1RtpSpec",!1),JT(this,"mutex",void 0),JT(this,"qualityLimitationReason",Kx.NONE),JT(this,"isFirstConnected",!1),this.store=n,this.forceTurn=$V(t),this.mutex=new Tx("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=tO(this.peerConnection,fO("STATS_UPDATE_INTERVAL"),void 0,GR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const t=this.preSSRCMap.get(e);if(void 0!==t){const e=this.peerConnection.getTransceivers().find((e=>e.mid===t));if(e)return{transceiver:e,track:e.receiver.track,id:t}}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else qO.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else qO.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Yj(n.sdp),i=await sU({filterRTX:!fO("USE_PUB_RTX")&&!fO("USE_SUB_RTX"),filterVideoFec:fO("FILTER_VIDEO_FEC"),filterAudioFec:fO("FILTER_AUDIO_FEC"),filterVideoCodec:fO("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=lU(i),this.initialOffer=n,fO("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:$x.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=CO(t.sdp).mediaDescriptions[0];if(!n)return;const r=n.attributes.extmaps.find((e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName));return e.close(),r}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=i.send)||void 0===e||e.videoExtensions.push(t))}let o;return n.sdp&&gU(n.sdp)&&(o=ex(i),(t=o).send&&(zj(HM.VIDEO,t.send.videoExtensions),zj(HM.AUDIO,t.send.audioExtensions)),t.recv&&(zj(HM.VIDEO,t.recv.videoExtensions),zj(HM.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(zj(HM.VIDEO,t.sendrecv.videoExtensions),zj(HM.AUDIO,t.sendrecv.audioExtensions))),JV(JV({},r),{},{rtpCapabilities:o||i,offerSDP:n.sdp})}catch(e){throw new gI(mI.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&gU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(Wj(HM.VIDEO,t.send.videoExtensions,n.send.videoExtensions),Wj(HM.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(Wj(HM.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),Wj(HM.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return ex(this._localCapabilities)}get rtpCapabilities(){return ex(this._rtpCapabilities)}get candidates(){return ex(this._candidates)}get iceParameters(){return ex(this._iceParameters)}get dtlsParameters(){return ex(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];JT(this,"sessionDesc",void 0),JT(this,"_localCapabilities",void 0),JT(this,"_rtpCapabilities",void 0),JT(this,"_candidates",void 0),JT(this,"_originCandidates",void 0),JT(this,"_iceParameters",void 0),JT(this,"_isUseExtmapAllowMixed",void 0),JT(this,"_dtlsParameters",void 0),JT(this,"setup",void 0),JT(this,"currentMidIndex",void 0),JT(this,"cname",void 0),JT(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,e=ex(e);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:o,setup:s,localCapabilities:a,cname:c}=e;this._rtpCapabilities=o,this._candidates=i,this._originCandidates=ex(i),this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=a,this.setup=s,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let s=1;s<e;s++){const e=2*s+2e4,a=2*s+IV,{ssrcs:c,ssrcGroups:l}=Zj([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:d}=Zj([{ssrcId:a,rtx:fO("USE_SUB_RTX")?a+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:RV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:RV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return AO(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=Zj(t,this.cname,fO("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(GR()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&(zR()||function(){const e=jR();return!(e.name!==PR.CHROME||!e.osVersion)&&Number(e.version)<=90}()||fO("ENABLE_ENCODED_TRANSFORM")&&WR())||0===t&&fO("USE_SUB_RTX")||tI()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=ex(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),GR()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||GR()||tI()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Nr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Nr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||CO((n=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(n?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var n;this._rtpCapabilities=e;const r=this.rtpCapabilities.send,i=this.localCapabilities.send;for(const o of t.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,"application"===o.media.mediaType&&(o.attributes.sctpPort="5000"),"video"===o.media.mediaType)if(0===r.videoCodecs.length){const e=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Nr(n=t.encodingName.toLowerCase()).call(n,"vp8")}))||[i.videoCodecs[0]];o.media.fmts=e.map((e=>e.payloadType.toString(10))),o.attributes.payloads=e,o.attributes.extmaps=[]}else if(o.media.fmts=r.videoCodecs.map((e=>e.payloadType.toString(10))),o.attributes.payloads=r.videoCodecs,o.attributes.extmaps=r.videoExtensions,fO("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:e,ssrcGroups:t}=Zj([{ssrcId:IV,rtx:fO("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=e,o.attributes.ssrcGroups=t}if("audio"===o.media.mediaType)if(0===r.audioCodecs.length){const e=i.audioCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Nr(n=t.encodingName.toLowerCase()).call(n,"opus")}))||[i.audioCodecs[0]];o.media.fmts=e.map((e=>e.payloadType.toString(10))),o.attributes.payloads=e,o.attributes.extmaps=[]}else if(o.media.fmts=r.audioCodecs.map((e=>e.payloadType.toString(10))),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions,uU(o),fO("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:e,ssrcGroups:t}=Zj([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=e,o.attributes.ssrcGroups=t}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const t=this._originCandidates.filter((e=>"udp"===e.transport)),n=[];if(t.forEach((e=>{n.push(AV(AV({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case GM.TCP_RELAY:this._candidates=n;break;case GM.UDP_TCP_RELAY:case GM.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=ex(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(GR()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:RV,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=dU(s,a,this.localCapabilities.send,s===HM.VIDEO?r:i),l=s===HM.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let d={media:{mediaType:s,port:RV,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,e,o);const h=this.findFirstClosedMedia(s);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Nr(t=Object.keys(yO)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return qO.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Nr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return qO.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let a;if(qO.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&Nr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return qO.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(fO("USE_PUB_RTX")||fO("USE_SUB_RTX")){const e=hU(o,this.rtpCapabilities.recv.videoCodecs);o.push(...e)}this._rtpCapabilities.recv.videoCodecs=o;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=dU(HM.VIDEO,l,c,n);return a.forEach((e=>{const t=u.map((e=>e.payloadType.toString(10)));qO.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",u),e.attributes.payloads=u,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===HM.VIDEO?o.videoCodecs:o.audioCodecs,a=e===HM.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:RV,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=ex(e);return tU(r),eU(r,t),nU(r,t),rU(r),iU(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=ex(e);return iU(n,t,this.localCapabilities.recv),uU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>GR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}(JV(JV({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),i=fU(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==o||o(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const s=this.peerConnection.getTransceivers()[0];if(null!=s&&s.receiver&&this.tryBindTransportEvents(s.receiver),fO("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(fO("PRELOAD_MEDIA_COUNT"));const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}const{preSSRCs:a}=e;if(Array.isArray(a)&&a.length>0){const{mids:e}=this.remoteSDP.batchSend(a.map((e=>({kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}))));e.forEach(((e,t)=>{this.preSSRCMap.set(a[t].ssrcId,e)})),await pU(this.peerConnection,this.remoteSDP,this.extension),qO.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,n}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:t}=e;this.remoteSDP.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:n}=e;if(Array.isArray(n)&&n.length>0){const{mids:e}=this.remoteSDP.batchSend(n.map((e=>Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}))));e.forEach(((e,t)=>{this.preSSRCMap.set(n[t].ssrcId,e)}))}await pU(this.peerConnection,this.remoteSDP,this.extension),qO.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return VA((function*(){const i=yield FA(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],s=Fj();e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,JV({direction:"sendonly"},"video"===e.trackMediaType&&r.supportAV1RtpSpec&&s?{sendEncodings:[{scalabilityMode:s}]}:{}));o.push(t),e._updateRtpTransceiver(t)})),GR()&&!0===fO("SIMULCAST")&&(yield FA(r.applySimulcastForFirefox(o,e)));const a=yield FA(r.peerConnection.createOffer()),c=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(a.sdp,e,c),u=CO(l),d=c.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return Xj(t,fO("USE_PUB_RTX"))}));let h;try{h=yield d}catch(i){h=[],r.remoteSDP.receive(e,t,n,h);const o=r.remoteSDP.toString();throw yield FA(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield FA(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield FA(r.stopSending(c,!0)),i}r.remoteSDP.receive(e,t,n,h);const p=r.remoteSDP.toString(),f=r.logSDPExchange(l,"offer","local","send");return yield FA(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield FA(r.applySimulcastEncodings(o,e)),yield FA(r.applySendEncodings(o,e)),null==f||f(p),yield FA(r.peerConnection.setRemoteDescription({type:"answer",sdp:p})),o.map(((e,t)=>{const n=c[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(e){throw e instanceof gI?e:new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)qO.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:fO("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach((e=>{e._updateOriginDataChannel(n)}));const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),qO.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else qO.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof gI?e:new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof gI?e:new gI(mI.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;BV(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);o&&(await pU(this.peerConnection,this.remoteSDP,this.extension),qO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await pU(this.peerConnection,this.remoteSDP,this.extension),qO.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach((e=>{Array.from(this.preSSRCMap.entries()).some((t=>{let[n,r]=t;if(r===e)return this.preSSRCMap.delete(n),!0}))})),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return VA((function*(){const n=yield FA(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=rk().supportPCSetConfiguration,r=fO("FORCE_TURN_TCP")||t.forceTurn;if(e===GM.RELAY&&!n)return;if(n&&!r){const n=e===GM.RELAY?"relay":"all",r=t.peerConnection.getConfiguration();r.iceTransportPolicy!==n&&(qO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(r.iceTransportPolicy,"] to [").concat(n,"]")),r.iceTransportPolicy=n,t.peerConnection.setConfiguration(r))}t.remoteSDP.updateCandidates(e);const i=yield FA(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Yj(i.sdp),{remoteIceParameters:s}=yield o.iceParameters;t.remoteSDP.restartICE(s);const a=t.remoteSDP.toString(),c=t.logSDPExchange(i.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield FA(t.peerConnection.setLocalDescription(i)),null==c||c(a),yield FA(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){qO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(GM.TCP_RELAY),await pU(this.peerConnection,this.remoteSDP,this.extension)}catch(e){qO.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach((e=>{BV(this.id+e.mid,this)})),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return JV(JV({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?GR()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:JV(JV({},Vx),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:JV(JV({},Vx),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";qO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&qO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,qO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,qO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),fO("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(VI(t.turnServer.servers)?n.iceServers=t.turnServer.servers:fO("NEW_TURN_MODE")&&n.iceServers?(fO("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),fO("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),fO("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),fO("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),fO("ENABLE_ENCODED_TRANSFORM")&&rk().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(kj(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!fO("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{const n=fO("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(kj(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(kj(e.turnServerURL),":443?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();qO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(!t){const n=this.peerConnection.getSenders();t=n.find((t=>t.track===e._mediaStreamTrack))}if(!t)return qO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return qO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!rk().supportSetRtpSenderParameters)return qO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const s=function(e,t){return e.getTransceivers().find((e=>e.sender.track===t||e.receiver.track===t))}(this.peerConnection,e._mediaStreamTrack),a=DN(e);if(VV(e)&&s&&t&&a&&this.getLocalVideoStats&&Nr(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Nr(c=e._hints).call(c,wk.CUSTOM_TRACK)?fO("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,o){if(BV(e,n),i(t),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let s=-1;DV(e,t);const a=window.setInterval((()=>{const a=FV.get(e);if(!fO("ENABLE_AG_ADAPTATION")||!a)return BV(e,n),void i(t);const c=o();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===s)return void(s=Date.now());if(Date.now()-s<1e3)return;const o=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[u,d]=MV(e,o,l,a.adaptationConfig,t,r);d&&(n.qualityLimitationReason=d),u&&a.adaptationConfig.scale!==u.scale&&(qO.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(l,", switch from ").concat(a.adaptationConfig.scale," to ").concat(u.scale," ")),a.adaptationConfig=UV(UV({},a.adaptationConfig),u),i(u))}}),fO("CHECK_LOCAL_STATS_INTERVAL")),c=UV({},t);FV.set(e,{timer:a,adaptationConfig:c,originConfig:t,adaptationFunc:i}),qO.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+s.mid,a,this,n,(e=>{t&&this.updateAdaptation(t,e)}),this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(o.maxBitrate=1e3*t),(Nr(l=e._hints).call(l,wk.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(o.maxFramerate=Pj(n)),r&&r>=1&&(o.scaleResolutionDownBy=r))}const{maxFramerate:u}=fO("ENCODER_CONFIG_LIMIT");if(u&&"number"==typeof u&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,u):u),fO("DSCP_TYPE")&&lI()){var d;const e=fO("DSCP_TYPE");Nr(d=["very-low","low","medium","high"]).call(d,e)&&(o.networkPriority=e)}const h=t.getParameters(),p=null===(r=h.encodings)||void 0===r?void 0:r[0];GR()&&!p&&(i.encodings=[o]),p&&Object.assign(p,o),Object.assign(h,i),qO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var r;if(!rk().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!fO("ENABLE_SVC"))return;const i={},o={},s=t.getParameters(),a=null===(r=s.encodings)||void 0===r?void 0:r[0];o.scalabilityMode=Fj(n),a&&Object.assign(a,o),Object.assign(s,i),await t.setParameters(s),qO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(s.encodings)))}catch(e){qO.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,fO("SVC_MODE"))}async updateAdaptation(e,t){var n,r;if(!e)return qO.debug("[updateAdaptation] no rtpSender found");if(!rk().supportSetRtpSenderParameters)return qO.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:o,frameRate:s,scaleResolutionDownBy:a}=t;o&&(i.maxBitrate=1e3*o),s&&(i.maxFramerate=Pj(s)),a&&a>=1&&Nr(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=a);const c=e.getParameters(),l=null===(r=c.encodings)||void 0===r?void 0:r[0];l&&Object.assign(l,i),Object.assign(c,{});try{await e.setParameters(c),qO.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?qO.debug("[updateAdaptation] peerConnection not connected}"):qO.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):qO.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!rk().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof pD&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){qO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=CO(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(eU(o,e),oU(o,e,this.store.codec))})),AO(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],l=t[a];if(l instanceof pD&&!Nr(n=l._hints).call(n,wk.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=l._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!GR()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof pD&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof pD&&fO("SIMULCAST")&&"vp8"===this.store.codec&&!Nr(t=e._hints).call(t,wk.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(fO("SDP_LOGGING"))return qO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(rk().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},iM(YV.prototype,"updateRemoteRTPCapabilities",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"updateRemoteRTPCapabilities"),YV.prototype),iM(YV.prototype,"connect",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"connect"),YV.prototype),iM(YV.prototype,"updateRemoteConnect",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"updateRemoteConnect"),YV.prototype),iM(YV.prototype,"createDataChannels",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"createDataChannels"),YV.prototype),iM(YV.prototype,"receive",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"receive"),YV.prototype),iM(YV.prototype,"batchReceive",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"batchReceive"),YV.prototype),iM(YV.prototype,"stopReceiving",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"stopReceiving"),YV.prototype),iM(YV.prototype,"muteRemote",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"muteRemote"),YV.prototype),iM(YV.prototype,"unmuteRemote",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"unmuteRemote"),YV.prototype),iM(YV.prototype,"muteLocal",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"muteLocal"),YV.prototype),iM(YV.prototype,"unmuteLocal",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"unmuteLocal"),YV.prototype),iM(YV.prototype,"close",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"close"),YV.prototype),iM(YV.prototype,"updateEncoderConfig",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"updateEncoderConfig"),YV.prototype),iM(YV.prototype,"updateSendParameters",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"updateSendParameters"),YV.prototype),iM(YV.prototype,"replaceTrack",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"replaceTrack"),YV.prototype),iM(YV.prototype,"updateAdaptation",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"updateAdaptation"),YV.prototype),iM(YV.prototype,"getRemoteSSRC",[ZV],Object.getOwnPropertyDescriptor(YV.prototype,"getRemoteSSRC"),YV.prototype),YV);function ZV(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function eF(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Pj(t.width),r.height=Pj(t.height);const i=Pj(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const s=r.getContext("2d");if(!s)throw new tk(mI.UNEXPECTED_ERROR,"can not get canvas context");const a=rk(),c=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(qO.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}s.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=nN((()=>r.startCapture&&r.startCapture()),i);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),qO.debug("clean low stream renderer")},c}var tF=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(tF||{}),nF=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(nF||{}),rF=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(rF||{}),iF=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(iF||{}),oF=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(oF||{}),sF=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(sF||{}),aF=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(aF||{}),cF=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(cF||{}),lF=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(lF||{}),uF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(uF||{}),dF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(dF||{});const hF=1e3,pF=6,fF=3,mF=Math.max(pF,fF);function gF(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function vF(e){const t={[uF.CONN_TYPE]:0,[uF.RTT]:e.rtt,[uF.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[uF.CONN_TYPE]=1),"tcp"===n&&(t[uF.CONN_TYPE]=3),"tls"===n&&(t[uF.CONN_TYPE]=4);break}case"srflx":t[uF.CONN_TYPE]=2;break;case"unknown":t[uF.CONN_TYPE]=5;break;default:t[uF.CONN_TYPE]=0}return t}function yF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class _F extends kI{constructor(e){super(),JT(this,"store",void 0),JT(this,"uploadWRTCStatsTimer",void 0),JT(this,"uploadOutboundDenoiserStatsTimer",void 0),JT(this,"uploadExtStatsTimer",void 0),JT(this,"uploadExtUsageStatsTimer",void 0),JT(this,"uploadInboundExtStatsTimer",void 0),JT(this,"requestStats",void 0),JT(this,"requestTransportStats",void 0),JT(this,"requestLocalMedia",void 0),JT(this,"requestRemoteMedia",void 0),JT(this,"requestAllTracks",void 0),JT(this,"requestVideoIsReady",void 0),JT(this,"requestUploadStats",void 0),JT(this,"requestUpload",void 0),JT(this,"uploadOutboundStarted",!1),JT(this,"uploadInboundStarted",!1),JT(this,"uploadTransportStarted",!1),JT(this,"uploadBaseStatsStarted",!1),JT(this,"uploadExtensionUsageStarted",!1),JT(this,"lastRecvStats",void 0),JT(this,"lastSendStats",void 0),JT(this,"lastRefRecvStats",void 0),JT(this,"lastRefSendStats",void 0),JT(this,"lastFullRecvStats",void 0),JT(this,"lastFullSendStats",void 0),JT(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%fF==0,n=e%pF==0;let r,i;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),r||i){var o;const e={};if(this.uploadTransportStarted&&r){const n=this.getTransportStats(r,i,t);n&&(e.misc=[n])}if(this.uploadOutboundStarted&&r){const i=this.getOutboundStats(r,n?this.lastFullSendStats:t?this.lastRefSendStats:this.lastSendStats,t,n);i&&(e.outbound=[i])}if(this.uploadInboundStarted&&i){const r=this.getInboundStats(i,n?this.lastFullRecvStats:t?this.lastRefRecvStats:this.lastRecvStats,t,n);r&&(e.inbound=r)}const s=null===(o=this.requestTransportStats)||void 0===o?void 0:o.call(this).connectState;s&&(Array.isArray(e.misc)?e.misc[0]&&e.misc[0].addition&&(e.misc[0].addition[dF.RTC_PEER_CONNECTION_STATE]=Yx[s]):e.misc=[{addition:{[dF.RTC_PEER_CONNECTION_STATE]:Yx[s]}}]),this.requestUploadStats(e)}this.lastRecvStats=i,this.lastSendStats=r,n&&(this.lastFullRecvStats=i,this.lastFullSendStats=r),t&&(this.lastRefRecvStats=i,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(n=this.requestUploadStats)||void 0===n||n.call(this,{misc:[{addition:{[dF.RTC_PEER_CONNECTION_STATE]:Yx[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===mF+1&&(e=1)}),hF)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return null==e.rtt?void 0:{addition:{[uF.RTT]:e.rtt,[uF.CONN_TYPE]:void 0,[uF.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=vF(e);if(this.store.useP2P){if(t){const e=vF(t);r[uF.CONN_TYPE]+=e[uF.CONN_TYPE]<<3}r[uF.CONN_TYPE]+=110}else r[uF.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||0===i.length)return;let o,s,a;return i.forEach((i=>{let[c,{track:l,ssrcs:u}]=i;switch(c){case $M.LocalVideoLowTrack:case $M.LocalVideoTrack:if(c===$M.LocalVideoTrack){const i=function(e,t,n,r,i,o){const s=t.videoSend.find((t=>t.ssrc===e));if(!s)return;const a={},{sentFrame:c,inputFrame:l}=s;if(o&&(gF(a,nF.QP_SUM,s.qpSumPerFrame),l&&c)){const e=l.frameRate,t=c.frameRate;a[nF.FREEZE]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(i){switch(c&&(gF(a,nF.HEIGHT,c.height),gF(a,nF.WIDTH,c.width),gF(a,nF.FRAME_RATE,c.frameRate)),a[nF.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0,s.adaptionChangeReason){case"none":a[nF.ADAPTATION]=0;break;case"cpu":a[nF.ADAPTATION]=1;break;case"bandwidth":a[nF.ADAPTATION]=2;break;case"other":a[nF.ADAPTATION]=3}let o=0;s.adaptionChangeReason&&(o+=yF(s.adaptionChangeReason)),t.qualityLimitationReason&&(o+=yF(t.qualityLimitationReason)<<3),a[nF.ADAPTATION]=o,a[nF.PLAYER_STATUS]=Wk[r._player?r._player.videoElementStatus:"uninit"],gF(a,nF.NACKS,s.nacksCount),gF(a,nF.PLIS,s.plisCount),gF(a,nF.FIRS,s.firsCount),gF(a,nF.AVG_ENCODE,s.avgEncodeMs),gF(a,nF.HUGE_FRAME_SENT,s.hugeFramesSent),gF(a,nF.BYTES_RETRANSMIT,s.retransmittedBytesSent),gF(a,nF.PACKAGES_RETRANSMIT,s.retransmittedPacketsSent),gF(a,nF.KEY_FRAMES_ENCODED,s.keyFramesEncoded);const l=n&&n.videoSend.find((t=>t.ssrc===e));if(l){let e=i?hF:hF*pF;l.timestamp&&s.timestamp&&(e=s.timestamp-l.timestamp),null!=l.packets&&null!=s.packets&&gF(a,nF.PACKAGE_RATE,1e3*(s.packets-l.packets)/e),null!=s.packetsLost&&null!=l.packetsLost&&gF(a,nF.PACKAGE_LOST,s.packetsLost-l.packetsLost),null!=l.bytes&&null!=s.bytes&&gF(a,nF.BITRATE,8*(s.bytes-l.bytes)/e)}}return a}(u[0].ssrcId,e,t,l,n,r),o=l&&function(e,t,n,r){const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return null;const o={};if(r){const e=i.inputFrame,t=e&&e.height||n.videoHeight||0,r=e&&e.width||n.videoWidth||0,s=e&&e.frameRate||0;gF(o,tF.HEIGHT,t),gF(o,tF.WIDTH,r),gF(o,tF.FRAME_RATE,s)}return o}(u[0].ssrcId,e,l,n),a=function(e,t){const n={};return t&&(gF(n,nF.RETRANSMIT,e.bitrate.retransmit),gF(n,nF.TARGET_ENCODED,e.bitrate.targetEncoded),gF(n,nF.ACTUAL_ENCODED,e.bitrate.actualEncoded),gF(n,nF.TRANSMIT,e.bitrate.transmit),gF(n,nF.BANDWIDTH,e.sendBandwidth)),n}(e,n);s=Object.assign({},i,o,a)}else a=function(e,t,n,r){const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return;const o={};if(r){const t=i.sentFrame;if(t&&(gF(o,rF.HEIGHT,t.height),gF(o,rF.WIDTH,t.width),gF(o,rF.FRAME_RATE,t.frameRate)),n){const t=n.videoSend.find((t=>t.ssrc===e));if(t){let e=hF*pF;t.timestamp&&i.timestamp&&(e=i.timestamp-t.timestamp),null!=t.packets&&null!=i.packets&&gF(o,rF.PACKAGE_RATE,1e3*(i.packets-t.packets)/e),null!=i.packetsLost&&null!=t.packetsLost&&gF(o,rF.PACKAGE_LOST,i.packetsLost-t.packetsLost),null!=t.bytes&&null!=i.bytes&&gF(o,rF.BITRATE,8*(i.bytes-t.bytes)/e)}}}return o}(u[0].ssrcId,e,t,n);break;case $M.LocalAudioTrack:o=l&&function(e,t,n,r,i){const o=t.audioSend.find((t=>t.ssrc===e));if(!o)return;const s={};if(i){s[aF.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0;const t=100*r._source.getAccurateVolumeLevel(),i=o.inputLevel;if(null!=i){const e=Math.ceil(50*Math.log10(100*i+1));gF(s,aF.LEVEL,e)}gF(s,sF.PCM_LEVEL,t),gF(s,aF.AEC_RETURN_LOSS,o.aecReturnLoss),gF(s,aF.AEC_RETURN_LOSS_ENH,o.aecReturnLossEnhancement),gF(s,aF.BYTES_RETRANSMIT,o.retransmittedBytesSent),gF(s,aF.PACKAGES_RETRANSMIT,o.retransmittedPacketsSent),s[aF.FREEZE]=0;const a=n&&n.audioSend.find((t=>t.ssrc===e));if(a){let e=hF*pF;a.timestamp&&o.timestamp&&(e=o.timestamp-a.timestamp),null!=a.bytes&&null!=o.bytes&&gF(s,aF.BITRATE,8*(o.bytes-a.bytes)/e),null!=a.packets&&null!=o.packets&&gF(s,aF.PACKAGE_RATE,1e3*(o.packets-a.packets)/e)}}return s}(u[0].ssrcId,e,t,l,n)}})),{high:s,low:a,audio:o}}getInboundStats(e,t,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],o=[];return i.forEach((i=>{let[s,a]=i;const c={peer:s.uid};if(a.has(HM.VIDEO)&&s.videoTrack){const i=s._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(s._videoSSRC)||!1,o=s.videoTrack?function(e,t,n,r,i,o,s,a){const c=t.videoRecv.find((t=>t.ssrc===e));if(!c)return;const l={},{receivedFrame:u,outputFrame:d,decodeFrameRate:h}=c,p=n&&n.videoRecv.find((t=>t.ssrc===e));if(gF(l,oF.FRAME_RATE_DECODE,h),c.framesRateFirefox&&gF(l,iF.FRAME_RATE,c.framesRateFirefox),u&&gF(l,iF.FRAME_RATE,u.frameRate),gF(l,iF.FRAMES_DROPPED,c.framesDroppedCount),gF(l,iF.BYTES_RETRANSMIT,c.retransmittedBytesReceived),gF(l,iF.PACKAGES_RETRANSMIT,c.retransmittedPacketsReceived),gF(l,iF.PACKAGES_DISCARDED,c.packetsDiscarded),gF(l,iF.AVG_DECODE,c.avgDecodeMs),gF(l,iF.AVG_PROCESSING_DELAY,c.avgProcessingDelayMs),gF(l,iF.AVG_ASSEMBLY_TIME,c.avgFramesAssembledFromMultiplePacketsMs),gF(l,iF.AVG_INTER_FRAME_DELAY,c.avgInterFrameDelayMs),gF(l,iF.KEY_FRAMES_DECODED,c.keyFramesDecoded),p){const e=t.timestamp-n.timestamp||hF*(a?pF:s?fF:1);null!=c.packetsLost&&null!=p.packetsLost&&gF(l,iF.PACKAGE_LOST,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&gF(l,iF.BITRATE,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&gF(l,iF.PACKAGE_RATE,1e3*(c.packets-p.packets)/e)}if(a&&(gF(l,iF.QP_SUM,c.qpSumPerFrame),l[iF.FREEZE]=i&&bV.isRemoteVideoFreeze(r,c,p)?1:0),s){var f;u?(gF(l,iF.HEIGHT,u.height),gF(l,iF.WIDTH,u.width)):r&&(gF(l,iF.HEIGHT,r._videoHeight||0),gF(l,iF.WIDTH,r._videoWidth||0)),d&&gF(l,oF.FRAME_RATE_OUTPUT,d.frameRate);const e=null===(f=r._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(e&&gF(l,oF.FRAME_RATE_RENDER,+e),gF(l,iF.JITTER_BUFFER,c.jitterBufferMs),gF(l,iF.CURRENT_DELAY,c.currentDelayMs),gF(l,iF.FIRS,c.firsCount),gF(l,iF.NACKS,c.nacksCount),gF(l,iF.PLIS,c.plisCount),r){l[iF.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1;const e=r._player;if(e){const{freezeTimeCounterList:t,renderFreezeAccTime:n,videoElementStatus:r}=e;if(t&&t.length>0&&gF(l,oF.FREEZE_TIME,t.splice(0,1)[0]),o&&"visible"===kD.visibility&&r===Fk.PLAYING&&rk().supportRequestVideoFrameCallback){const t=Math.min(6e3,n);e.renderFreezeAccTime=Math.max(0,n-t),gF(l,oF.FREEZE_TIME_RENDER,t)}if("number"==typeof c.totalFreezesDuration){const e=p&&p.totalFreezesDuration?c.totalFreezesDuration-p.totalFreezesDuration:c.totalFreezesDuration;gF(l,oF.FREEZE_DURATION,1e3*e)}}}if(l[iF.PLAYER_STATUS]=Wk[r._player?r._player.videoElementStatus:"uninit"],p&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==p.totalInterFrameDelay&&void 0!==p.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-p.totalInterFrameDelay,t=c.totalSquaredInterFrameDelay-p.totalSquaredInterFrameDelay,n=c.framesDecodeCount-p.framesDecodeCount,r=e/n*1e3,i=Math.round(1e3*Math.sqrt((t-Math.pow(e,2)/n)/n));!isNaN(i)&&r+i>Math.max(3*r,r+150)&&(l[iF.I_FRAME_DELAY]=i)}}return l}(s._videoSSRC,e,t,s.videoTrack,!0===i,this.needUploadRenderFreezeTime,n,r):void 0;o&&(c.video=o)}if(a.has(HM.AUDIO)&&s.audioTrack){const i=s.audioTrack?function(e,t,n,r,i,o){const s=t.audioRecv.find((t=>t.ssrc===e));if(!s)return;const a={},c=n&&n.audioRecv.find((t=>t.ssrc===e));if(gF(a,cF.JITTER,s.jitterMs),gF(a,cF.BYTES_RETRANSMIT,s.retransmittedBytesReceived),gF(a,cF.PACKAGES_RETRANSMIT,s.retransmittedPacketsReceived),gF(a,cF.PACKAGES_DISCARDED,s.packetsDiscarded),gF(a,cF.AVG_PROCESSING_DELAY,s.avgProcessingDelayMs),c){const e=t.timestamp-n.timestamp||hF*(o?pF:i?fF:1);null!=s.packets&&null!=c.packets&&gF(a,cF.PACKAGE_RATE,1e3*(s.packets-c.packets)/e),i&&null!=c.bytes&&null!=s.bytes&&gF(a,cF.BITRATE,8*(s.bytes-c.bytes)/e),null!=s.packetsLost&&null!=c.packetsLost&&gF(a,cF.PACKAGE_LOST,s.packetsLost-c.packetsLost)}if(o){const{receivedFrames:e,droppedFrames:t}=s;null!=e&&null!=t&&(a[cF.FREEZE]=0===(l=e)||100*t/l>20?1:0)}var l;if(i){const e=100*r._source.getAccurateVolumeLevel(),t=s.outputLevel;if(null!=t){const e=Math.ceil(50*Math.log10(100*t+1));gF(a,lF.LEVEL,e)}if(gF(a,cF.PCM_LEVEL,e),r&&(a[cF.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1),gF(a,cF.JITTER_BUFFER,s.jitterBufferMs),gF(a,cF.CURRENT_DELAY,s.jitterBufferMs),a[cF.PLAYER_STATUS]=Wk[wN.getPlayerState(r.getTrackId())],c){const e=s.concealedSamples-c.concealedSamples;e>0&&gF(a,cF.CONCEALED_SAMPLES,e);const t=s.totalSamplesReceived-c.totalSamplesReceived;t>0&&gF(a,cF.TOTAL_SAMPLES_RECEIVED,t)}}return a}(s._audioSSRC,e,t,s.audioTrack,n,r):void 0;i&&(c.audio=i)}(c.video||c.audio)&&o.push(c)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find((e=>e instanceof CP));if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(pM.DENOISER_STATS,t)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach((e=>{e.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach((e=>{let[t,n]=e;n.has(HM.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})),n.has(HM.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const t=Date.now(),n={connectionInterval:fO("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let r=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of o)c.has(HM.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),c.has(HM.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){const n={};for(const{id:s,value:a,level:c,direction:l}of e){var r;const e=null!==(r=t.get(s))&&void 0!==r?r:0,u=2===a?e+fO("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(s,u),n[s]?(2===a&&(n[s].value=a),c>n[s].level&&(n[s].level=c),"remote"===l&&(n[s].remoteUidCount+=1),n[s].totalTs=null!==(i=t.get(s))&&void 0!==i?i:0):n[s]={value:a,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(o=t.get(s))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(r,e);const s=Date.now(),a=s>t?s:t+1;this.requestUpload&&this.requestUpload(pM.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:a})}),fO("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const EF=fO("ICE_RESTART_INTERVAL");let bF=new Map,wF=new Map,SF=[GM.UDP_TCP_RELAY,GM.TCP_RELAY,GM.RELAY],TF=fO("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&rk().supportPCSetConfiguration;function CF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=bF.get(e.id);n&&(window.clearTimeout(n),bF.delete(e.id));const r=wF.get(e.id);t&&r&&r.index===SF.length-1&&(qO.debug("[".concat(e.id,"] reset ICE restart policy")),wF.delete(e.id))}function AF(e,t,n){if(0===bF.size&&0===wF.size&&(Array.isArray(fO("RESTART_SEQUENCE"))&&fO("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const r=e[n];if(e.filter((e=>e===r)).length!==t.filter((e=>e===r)).length)return!1}return!0}(SF,fO("RESTART_SEQUENCE"))&&(SF=fO("RESTART_SEQUENCE").filter((e=>{var t;if(Nr(t=Object.values(GM)).call(t,e))return!0})),qO.debug("use reconnection policy from config distribution, queues: ".concat(SF.join(" => ")))),TF=fO("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&rk().supportPCSetConfiguration),0===SF.length)return void n();let r,{index:i=0,type:o}=wF.get(e.id)||{};if(TF&&o===GM.RELAY)return void n();let s=o&&i>=SF.length-1;if(TF)o=GM.RELAY;else{if(s)return void n();o?(i++,o=SF[i]):(o=SF[0],i=0)}qO.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(i)),t(o),wF.set(e.id,{index:i,type:o}),r=window.setTimeout((()=>AF(e,t,n)),EF),bF.set(e.id,r)}var RF;function IF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IF(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function OF(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=WA,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new kF(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function kF(e){function t(e){if(Object(e)!==e)return zh.reject(new TypeError(e+" is not an object."));var t=e.done;return zh.resolve(e.value).then((function(e){return{value:e,done:t}}))}return kF=function(e){this.s=e,this.n=e.next},kF.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?zh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?zh.reject(e):t(n.apply(this.s,arguments))}},new kF(e)}let NF=(RF=class extends kI{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(XM.StateChange,t,this._state)}constructor(e,t){super(),JT(this,"isPlanB",void 0),JT(this,"store",void 0),JT(this,"statsUploader",void 0),JT(this,"connection",void 0),JT(this,"localTrackMap",new Map),JT(this,"remoteUserMap",new Map),JT(this,"localDataChannels",[]),JT(this,"remoteDataChannelMap",new Map),JT(this,"pendingLocalTracks",[]),JT(this,"pendingRemoteTracks",[]),JT(this,"pendingLocalDataChannels",[]),JT(this,"pendingRemoteDataChannels",[]),JT(this,"statsCollector",void 0),JT(this,"shouldForwardP2PCreation",void 0),JT(this,"iceFailedCount",0),JT(this,"dtlsFailedCount",0),JT(this,"mutex",void 0),JT(this,"_state",YM.Disconnected),JT(this,"_pcStatsUploadType",fO("NEW_ICE_RESTART")?qM.FIRST_CONNECTION:qM.OLD_FIRST_CONNECTION),JT(this,"_isStartRestartIce",!1),JT(this,"_restartTimer",void 0),JT(this,"_isTryConnecting",!1),JT(this,"_iceError",null),JT(this,"_forceTurn",!1),JT(this,"_isWaitPcToRePub",!1),JT(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==YM.Connected)return void n(new gI(mI.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createMuteMessage(r);await KI(this,XM.RequestMuteLocal,o),t()}catch(e){n(e)}finally{r()}})),JT(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==YM.Connected)return void n(new gI(mI.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const t=i[1];if(t.track._originMediaStreamTrack.stop(),!fO("DISABLE_DUAL_STREAM_USE_ENCODING")&&rk().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=eF(e,YI(this,XM.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new zh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnmuteMessage(r);await KI(this,XM.RequestUnmuteLocal,o),t()}catch(e){n(e)}finally{r()}})),JT(this,"handleUpdateVideoEncoder",(async(e,t,n,r)=>{let i;r||(i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get($M.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==YM.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(XM.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{var o;null===(o=i)||void 0===o||o()}})),JT(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get($M.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==YM.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),JT(this,"handleReplaceMixingTrack",(async(e,t,n,r)=>{if(!this.connection||this.state!==YM.Connected)return void t();const i=HV([e]);let o;qO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof r&&r||(o=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var s;null===(s=o)||void 0===s||s()}})),JT(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;qO.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==YM.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===$M.LocalVideoTrack&&!fO("DISABLE_DUAL_STREAM_USE_ENCODING")&&rk().supportDualStreamEncoding){const t=this.localTrackMap.get($M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new zh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),JT(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),JT(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),JT(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),JT(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),JT(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new _F(this.store),this.bindStatsUploaderEvents(),this.mutex=new Tx("P2PChannel-mutex",this.store.clientId),this.isPlanB=!rk().supportUnifiedPlan||fO("CHROME_FORCE_PLAN_B")&&lI(),this.shouldForwardP2PCreation=fO("FORWARD_P2P_CREATION")&&rk().supportPCSetConfiguration&&cI(),this.shouldForwardP2PCreation&&(this.connection=qV(this.store),this.emit(XM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=YM.New,this._forceTurn=$V(e),qO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&"closed"===(null===(t=this.connection)||void 0===t?void 0:t.peerConnectionState);if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(qO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=qV(this.store,e),this.emit(XM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new gI(mI.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=fO("NEW_ICE_RESTART")?qM.FIRST_CONNECTION:qM.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new gI(mI.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");fO("ENABLE_PREALLOC_PC")&&this.state===YM.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=YM.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return Nr(t=[$M.LocalVideoLowTrack,$M.LocalVideoTrack]).call(t,n)})),n=t.map((e=>{let[,{id:t}]=e;return t})),r=t.map((e=>{let[t]=e;return t}));if(this.connection instanceof QV){if(ek.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Nr(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find((t=>Nr(e).call(e,t)));t&&(this.store.codec=t,qO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof QV&&"closed"!==this.connection.peerConnectionState&&Nr(e=[YM.New,YM.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==YM.Connected){if(this.state===YM.Disconnected)throw new gI(mI.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((e=>{var t;Nr(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)})),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach((e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})),e.map((e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId}))))}publish(e,t,n){var r=this;return VA((function*(){const i=yield FA(r.mutex.lock("From P2PChannel.publish"));try{var o;const i=r.connection&&Nr(o=["disconnected","failed"]).call(o,r.connection.peerConnectionState);if(!r.connection||r.state!==YM.Connected||i){if(r.state===YM.Disconnected)throw new gI(mI.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return r.pendingLocalTracks=r.pendingLocalTracks.concat(t),void(i&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,yV.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(0===s.length)return void(yield FA(r.tryToUnmuteAudio(e)));yield*BA(OF(r.doPublish(r.connection,s)))}finally{i()}}))()}doPublish(e,t){var n=this;return VA((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===$M.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=t.map((e=>{let{track:t}=e;return t})),i=yield FA(e.send(r,n.store.codec,n.store.audioCodec)),o=(yield FA(i.next())).value,s=n.createGatewayPublishMessage(t,o);let a;try{a=yield s}catch(e){throw i.throw(e),(null==e?void 0:e.code)===mI.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(s,a,r),l=(yield FA(i.next(c))).value;if(n.state===YM.Disconnected)throw new gI(mI.UNEXPECTED_ERROR,"PeerConnection already disconnected.");fO("ENABLE_VIDEO_SEI");const u=fO("ENABLE_ENCODED_TRANSFORM"),d=fO("ENABLE_AUDIO_METADATA");r.forEach((async e=>{const t=e.getRTCRtpTransceiver();if(!t||!u)return;const{interceptLocalVideoFrame:n,interceptLocalAudioFrame:r}=CU();e.trackMediaType===HM.VIDEO?await n(t.sender,e):e.trackMediaType===HM.AUDIO&&await r(t.sender,{metadata:d?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})})),t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===$M.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof pD))return qO.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=Uj(e,t)),n.maxFramerate=e.framerate?Pj(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==$M.LocalVideoLowTrack||!fO("DISABLE_DUAL_STREAM_USE_ENCODING")&&rk().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return qO.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=Pj(t.width)),t.height&&(n.height=Pj(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=nN((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),Pj(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),qO.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return VA((function*(){if(!t.connection||t.state!==YM.Connected)return;const n=yield FA(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get($M.LocalVideoTrack);if(!n)throw new gI(mI.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has($M.LocalVideoLowTrack))throw new gI(mI.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:$M.LocalVideoLowTrack}];if(yield*BA(OF(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get($M.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield FA(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(qO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await qI(this,XM.RequestRePublish,this.pendingLocalTracks),this.emit(XM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(qO.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await qI(this,XM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==HM.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==HM.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await qI(this,XM.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===HM.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(XM.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==YM.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==YM.Connected)return void e.forEach((e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==YM.Connected)return;const e=this.localTrackMap.get($M.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[$M.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==YM.Connected)throw new gI(mI.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==YM.Connected)throw new gI(mI.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let s,a,c;const l=this.connection.getPreMedia(n);if(l)qO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=l.transceiver,s=l.track,a=l.id;else if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new gI(mI.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof QV&&(c=r.transceiver),s=r.track,a=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof QV&&(c=i.transceiver),s=i.track,a=i.id}if(t===HM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new OD(s,e.uid,e._uintid,this.store),qO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new xD(s,e.uid,e._uintid,this.store),qO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&fO("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:n,interceptRemoteAudioFrame:r}=CU();t==HM.VIDEO?await n(c.receiver,{onSei:fO("ENABLE_VIDEO_SEI")&&(t=>{var n;return null===(n=e._videoTrack)||void 0===n?void 0:n._onSei(t)})}):t==HM.AUDIO&&await r(c.receiver,{enableTopn:!!fO("ENABLE_AUDIO_TOPN"),enableMetadata:!!fO("ENABLE_AUDIO_METADATA"),onMetadata:e=>{this.safeEmit(XM.AudioMetadata,e)}})}const u=this.remoteUserMap.get(e);u?u.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const d=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(XM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==YM.Connected)throw new gI(mI.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=[],n=new Map;e.forEach((e=>{if(!this.connection)return;const r=this.connection.getPreMedia(e.ssrcId);r?n.set(e.ssrcId,r):t.push(e)}));const r=await this.connection.batchReceive(t.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));t.forEach(((e,t)=>{n.set(e.ssrcId,r[t])}));for(const{user:i,mediaType:o,ssrcId:s}of e){const e=n.get(s);if(!e)return void qO.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(o,", ").concat(s));const{track:t,id:r,transceiver:a}=e;if(a&&fO("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=CU();o==HM.VIDEO?await e(a.receiver,{onSei:fO("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=i._videoTrack)||void 0===t?void 0:t._onSei(e)})}):o==HM.AUDIO&&await t(a.receiver,{enableTopn:!!fO("ENABLE_AUDIO_TOPN"),enableMetadata:!!fO("ENABLE_AUDIO_METADATA"),onMetadata:e=>{this.safeEmit(XM.AudioMetadata,e)}})}if(o===HM.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(t):(i._audioTrack=new OD(t,i.uid,i._uintid,this.store),qO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),a&&i._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(t):(i._videoTrack=new xD(t,i.uid,i._uintid,this.store),qO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),a&&i._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(i,i._videoTrack)),fO("ENABLE_VIDEO_SEI")&&a){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=CU();o==HM.VIDEO?await e(a.receiver,{onSei:e=>{var t;null===(t=i._videoTrack)||void 0===t||t._onSei(e)}}):o==HM.AUDIO&&await t(a.receiver)}const c=this.remoteUserMap.get(i);c?c.set(o,r):this.remoteUserMap.set(i,new Map([[o,r]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const l=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===i.uid&&o===n}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(XM.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===YM.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===HM.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===HM.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==YM.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===HM.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===HM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===HM.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),o}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{const t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:o}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==o?t.uid===i.uid&&o===n:t.uid===i.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==YM.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===HM.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===HM.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=Xr(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===HM.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===HM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===HM.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}isPreSubScribe(e){return!(!this.connection||this.state!==YM.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void qO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void qO.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===HM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||qO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):qO.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get($M.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get($M.LocalAudioTrack);if((null==t?void 0:t.track)instanceof RP){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==$M.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===$M.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===$M.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get($M.LocalAudioTrack),o=r?this.localTrackMap.get($M.LocalVideoLowTrack):this.localTrackMap.get($M.LocalVideoTrack);ek.publish(this.store.sessionId,{eventElapse:yV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(wk.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof TP)),a=r?null===(o=this.localTrackMap.get($M.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof pD));ek.publish(this.store.sessionId,{eventElapse:yV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(wk.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===HM.VIDEO?n._videoSSRC:n._audioSSRC;i&&ek.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===HM.VIDEO,audio:r===HM.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:yV.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){qO.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Tx("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=qV(this.store),this.emit(XM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($M.LocalAudioTrack);if((null==e?void 0:e.track)instanceof RP){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=YM.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($M.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($M.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof pD||t&&t.track instanceof TP?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get($M.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=w_(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(qO.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=YM.Reconnecting,fO("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=qV(this.store),this.emit(XM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case $M.LocalVideoTrack:Nr(t=r._hints).call(t,wk.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case $M.LocalAudioTrack:r instanceof RP?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case $M.LocalVideoLowTrack:}})),this.emit(XM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(LO(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(XM.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(LO(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),qO.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof TV?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof TV?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return VA((function*(){if(!t.connection||t.state!==YM.Connected)return;const n=yield FA(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield FA(t.connection.restartICE(e));const n=yield FA(r.next());if(n.done)return;const i=n.value,o=yield i;switch(KV(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case GM.UDP_TCP_RELAY:t._pcStatsUploadType=qM.UDP_TCP_RESTART;break;case GM.TCP_RELAY:t._pcStatsUploadType=qM.TCP_RESTART;break;case GM.RELAY:t._pcStatsUploadType=qM.RELAY_RESTART;break;default:t._pcStatsUploadType=qM.OLD_RESTART}t._isTryConnecting=!0,r.next(o)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get($M.LocalVideoTrack),n=this.localTrackMap.get($M.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const o=$I(this,XM.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,l=(c&&o?(c+o)/2:c||o)||0,u=100*e.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(wk.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return vL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=$I(this,XM.NeedSignalRTT),l=e.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*u/1500;d&&(p=.6*h*100/50+.2*u/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new zh(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(qO.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==YM.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===$M.LocalVideoTrack&&!fO("DISABLE_DUAL_STREAM_USE_ENCODING")&&rk().supportDualStreamEncoding){const t=this.localTrackMap.get($M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new zh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=QI(e=e.filter((e=>-1===i.indexOf(e))));let o,s=!1;const a=this.localTrackMap.get($M.LocalAudioTrack);for(const c of e){if(c instanceof pD&&(this.localTrackMap.has($M.LocalVideoTrack)||s?new gI(mI.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:$M.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:$M.LocalVideoLowTrack})}if(c instanceof TP)if(a){const e=a.track;if(e instanceof RP)zV([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=HV([e,c]);qO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof RP?(zV([c]),o.addAudioTrack(c)):o=o||!c._useAudioElement&&rk().webAudioMediaStreamDest&&!c._bypassWebAudio?HV(o?[c,o]:[c]):c}return o&&(qO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:$M.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=QI(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof TP){const e=this.localTrackMap.get($M.LocalAudioTrack);if(!e)continue;e.track instanceof RP?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([$M.LocalAudioTrack,e]),e.track.close())):t.push([$M.LocalAudioTrack,e])}if(r instanceof pD){const e=this.localTrackMap.get($M.LocalVideoTrack);if(!e)continue;t.push([$M.LocalVideoTrack,e]);const n=this.localTrackMap.get($M.LocalVideoLowTrack);n&&t.push([$M.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=QI(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=QI(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case $M.LocalVideoTrack:t.addListener(bk.GET_STATS,this.handleGetLocalVideoStats),t.addListener(bk.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(bk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(bk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $M.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case $M.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof RP?e.trackList.forEach((e=>{e.addListener(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(bk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(bk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(bk.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case $M.LocalVideoTrack:t.off(bk.GET_STATS,this.handleGetLocalVideoStats),t.off(bk.GET_RTC_STATS,this.handleGetRTCStats),t.off(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(bk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(bk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $M.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case $M.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof RP?e.trackList.forEach((e=>{e.off(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(bk.GET_STATS,this.handleGetLocalAudioStats),e.off(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(bk.GET_STATS,this.handleGetLocalAudioStats),e.off(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(bk.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof xD&&t.addListener(bk.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof OD&&t.addListener(bk.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(bk.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(HM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(HM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,o,{track:s,type:a}=e;switch(a){case $M.LocalAudioTrack:i=NM.Audio,o={dtx:s instanceof CP&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $M.LocalVideoTrack:i=Nr(r=s._hints).call(r,wk.SCREEN_TRACK)?NM.Screen:NM.High,o=xF(xF({},Dj(s)),{},{codec:this.store.codec,svc_mode:Fj()});break;case $M.LocalVideoLowTrack:i=NM.Low,o=xF(xF({},Dj(s)),{},{codec:this.store.codec,svc_mode:Fj()})}return{stream_type:i,attributes:o,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case $M.LocalVideoTrack:n=Nr(t=i._hints).call(t,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalAudioTrack:n=NM.Audio;break;case $M.LocalVideoLowTrack:n=NM.Low}return{stream_type:n,ssrcs:o,mid:s}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(XM.PeerConnectionStateChange,t),"connecting"===t&&e instanceof QV&&!GR()&&fO("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{"connecting"===t&&e.extendCandidate()}),fO("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof QV&&CF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=qM.DISCONNECTED_OR_FAILED,"CONNECTED"===$I(this,XM.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map((e=>e.getTrackId())),t=this.pendingLocalDataChannels.map((e=>"dc_".concat(e.id)));ek.reportApiInvoke(this.store.sessionId,{name:DI.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:LI.TRACER}).onSuccess(),this.republish()}if(fO("NEW_ICE_RESTART")&&e instanceof QV&&!GR()&&!this._forceTurn){if(Nr(KM).call(KM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{KV(e)&&(qO.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===$I(this,XM.QueryClientConnectionState)&&this.emit(XM.RequestRestartICE,t))},n=()=>{KV(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),qO.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(XM.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{AF(e,t,n)}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&fO("ICE_RESTART")&&"CONNECTED"===$I(this,XM.QueryClientConnectionState)&&this.emit(XM.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(qO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(XM.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(qO.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(XM.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),ek.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:LI.TRACER}).onSuccess(),this.emit(XM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(Ik.FIRST_FRAME_DECODED),ek.firstRemoteFrame(this.store.sessionId,XO.FIRST_AUDIO_DECODE,JO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&ek.firstRemoteFrame(this.store.sessionId,XO.FIRST_AUDIO_RECEIVED,JO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&ek.firstRemoteFrame(this.store.sessionId,XO.FIRST_VIDEO_RECEIVED,JO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(XM.ConnectionTypeChange,n),qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vj(t))," -> ").concat(JSON.stringify(Vj(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vj(t))," -> ").concat(JSON.stringify(Vj(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return xF(xF({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof QV&&function(e){wF.delete(e.id),CF(e)}(e),e.close(),this.emit(XM.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get($M.LocalAudioTrack);if(e instanceof TP&&(null==n?void 0:n.track)instanceof RP)return n.track.isActive||t.push([$M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===$M.LocalVideoTrack)){const e=this.localTrackMap.get($M.LocalVideoLowTrack);e&&t.push([$M.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get($M.LocalAudioTrack);if(e instanceof TP&&(null==n?void 0:n.track)instanceof RP)return n.track.isActive&&t.push([$M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===$M.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get($M.LocalVideoLowTrack);e&&t.push([$M.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case $M.LocalAudioTrack:n=NM.Audio;break;case $M.LocalVideoTrack:n=Nr(t=i._hints).call(t,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalVideoLowTrack:n=NM.Low}return{stream_type:n,ssrcs:o,mid:s}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case $M.LocalAudioTrack:n=NM.Audio;break;case $M.LocalVideoTrack:n=Nr(t=i._hints).call(t,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalVideoLowTrack:n=NM.Low}return{stream_type:n,ssrcs:o,mid:s}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case HM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:HM.VIDEO,ssrcId:n._videoSSRC}));case HM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:HM.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===HM.VIDEO?e|=LM.Video:e|=LM.Audio,t.set(n,e)}else r===HM.VIDEO?t.set(n,LM.Video):t.set(n,LM.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get($M.LocalVideoTrack),n=this.localTrackMap.get($M.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new zh(((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new zh(((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)})))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t,n){return e.map(((e,r)=>{var i;let{stream_type:o}=e;const s=null===(i=t.find((e=>{let{stream_type:t}=e;return o===t})))||void 0===i?void 0:i.attributes;if(s&&fO("DISABLE_SCREEN_SHARE_REMB")){const e=n[r]._hints;(Nr(e).call(e,wk.SCREEN_TRACK)||Nr(e).call(e,wk.SCREEN_LOW_TRACK))&&(s.remb=!1,qO.debug("disable remb for screen share, hints:",e))}return s}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof TP){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await KI(this,XM.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(XM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(XM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await dx(Rx(this.dtlsFailedCount,Ax)),this.emit(XM.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await qI(this,XM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(XM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($M.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof pD))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof pD)).length>1)throw new gI(mI.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof TP)).length>1&&(e.some((e=>e instanceof TP&&e._bypassWebAudio))||!rk().webAudioMediaStreamDest))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof pD&&this.pendingLocalTracks.some((e=>e instanceof pD)))throw new gI(mI.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof TP&&this.pendingLocalTracks.some((e=>e instanceof TP))&&(!rk().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof TP&&e._bypassWebAudio))))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!fO("DISABLE_DUAL_STREAM_USE_ENCODING")&&rk().supportDualStreamEncoding,i=xF(xF({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=r?e._mediaStreamTrack.clone():eF(e,i);const s=hx(8,"track-low-"),a=new pD(o,xF(xF({},r&&{scaleResolutionDownBy:Uj(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return a.on(Ak.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Sk.LOW_STREAM)})),a._hints.push(wk.LOW_STREAM),Nr(n=e._hints).call(n,wk.SCREEN_TRACK)&&a._hints.push(wk.SCREEN_LOW_TRACK),e.on("sei-to-send",(e=>{a.emit("sei-to-send",e)})),e.addListener(bk.NEED_CLOSE,(()=>{a.close()})),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof QV){var i,o,s,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:u,peerConnectionState:d}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();ek.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:u,connectionstate:d,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(s=p.protocol)&&void 0!==s?s:"",selectedRemoteCandidateType:null!==(a=p.candidateType)&&void 0!==a?a:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(LO(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));ek.firstRemoteVideoDecode(this.store.sessionId,XO.FIRST_VIDEO_DECODE,JO.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0,firstFrame:(null==s?void 0:s.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===$M.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Sk.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},iM(RF.prototype,"startP2PConnection",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"startP2PConnection"),RF.prototype),iM(RF.prototype,"connect",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"connect"),RF.prototype),iM(RF.prototype,"updateRemoteRTPCapabilities",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"updateRemoteRTPCapabilities"),RF.prototype),iM(RF.prototype,"publishDataChannel",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"publishDataChannel"),RF.prototype),iM(RF.prototype,"unpublish",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"unpublish"),RF.prototype),iM(RF.prototype,"unpublishDataChannel",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"unpublishDataChannel"),RF.prototype),iM(RF.prototype,"unpublishLowStream",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"unpublishLowStream"),RF.prototype),iM(RF.prototype,"subscribeDataChannel",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"subscribeDataChannel"),RF.prototype),iM(RF.prototype,"subscribe",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"subscribe"),RF.prototype),iM(RF.prototype,"massSubscribe",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"massSubscribe"),RF.prototype),iM(RF.prototype,"unsubscribe",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"unsubscribe"),RF.prototype),iM(RF.prototype,"unsubscribeDataChannel",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"unsubscribeDataChannel"),RF.prototype),iM(RF.prototype,"massUnsubscribe",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"massUnsubscribe"),RF.prototype),iM(RF.prototype,"muteRemote",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"muteRemote"),RF.prototype),iM(RF.prototype,"unmuteRemote",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"unmuteRemote"),RF.prototype),iM(RF.prototype,"hasRemoteMediaWithLock",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"hasRemoteMediaWithLock"),RF.prototype),iM(RF.prototype,"disconnectForReconnect",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"disconnectForReconnect"),RF.prototype),iM(RF.prototype,"updateBitrateLimit",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"updateBitrateLimit"),RF.prototype),iM(RF.prototype,"remoteMediaSsrcChanged",[PF],Object.getOwnPropertyDescriptor(RF.prototype,"remoteMediaSsrcChanged"),RF.prototype),RF);function PF(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function DF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function LF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DF(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const MF=Date.now(),jF=20,UF=new Map,VF=new Map;async function FF(e){const t=UF.get(e),n=Array.isArray(t)&&t[t.length-1],r=VF.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const o=n.sendTs-r.firstSendTs,s=o-(Date.now()-r.firstRecvTs);s>0&&(r.firstRecvTs=Date.now()-o);let a=n.mediaDelay+s;a<=0?(t.pop(),BF(n.context,i),a=0):a=Math.min(a,jF),setTimeout((()=>t.length&&FF(e)),a)}function BF(e,t){e.safeEmit(WI.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function WF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return BF(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=UF.get(r)||[],o=i.findIndex((t=>e.sendTs>=t.sendTs)),s=LF(LF({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?i.push(s):i.splice(o,0,s),UF.set(r,i);let a=!1;var c;VF.has(r)?a=!(null===(c=VF.get(r))||void 0===c||!c.isSyncing):VF.set(r,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||FF(r)}const zF=jR().name;function HF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HF(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const qF="websdk_ng_cache_parameter",KF=fO("MAX_PRELOAD_ASYNC_LENGTH"),$F=1e4,YF=new Map,XF=[];let JF=null,QF=0,ZF=0;const eB=new Map,tB=function(e,t){const n=[];let r=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return new zh((async(o,a)=>{n.push((async()=>{try{const t=await e(...s);o(t)}catch(e){a(e)}})),r<t&&(r++,i())}))}}(rB,KF),nB=AR.CancelToken.source();async function rB(e,t,n,r,i,o){try{if(!fO("ENABLE_PRELOAD"))return;if(!rk().supportWebCrypto)return void rx((()=>{qO.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&null!==n)throw new gI(mI.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&bI(n,"token",1,2047),bI(e,"appid",1,2047),vM(t),r&&yM(r);const s=px();qO.debug("preload channel ".concat(t,", uid is ").concat(r));const a={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:s,proxyServer:i};let c,l;"string"==typeof r?(a.stringUid=r,[l,c]=await zh.all([aV(r,{sid:s,appId:e},nB.token),lV(GF(GF({},a),{},{token:n||e,uid:0}),nB.token)]),a.uid=l.uid,c.gatewayInfo.uid=a.uid,c.gatewayInfo.res.uid=a.uid):(o&&(a.stringUid=o),c=await lV(a,nB.token));const u={sid:s,appId:e,cname:t,token:n||e,uid:a.stringUid||r,intUid:a.uid||c.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:l,ap:c};await async function(e){let t;try{e.uid&&oB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=dB(e),r=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",sx(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,ix(window.btoa(JSON.stringify(e))));return ox(new Uint8Array(r))}catch(e){return}}(e,e.token||e.appId);if(!r)return;t=lB(qF);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>fO("AP_CACHE_NUM")&&i.shift(),uB(qF,JSON.stringify(i))}catch(e){qO.warn("Error caching server parameters:",e.message),uB(qF,"")}}(u),QF++}catch(e){throw ZF++,function(e){JF||(JF=window.setTimeout((()=>{let t="";eB.forEach(((e,n)=>{t+="".concat(n,": ").concat(e," ;")})),ek.reportApiInvoke(null,{name:DI.PRELOAD,options:{success:QF,failed:ZF,err:t}}).onError(e),QF=0,ZF=0,eB.clear(),JF=null}),$F));const t=eB.get(e.code)||0;eB.set(e.code,t+1)}(e),e}}async function iB(e){try{if(fO("AP_REQUEST_DETAIL")||fO("ENABLE_ROLE_SELECT_EDGE"))return;const t=oB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",sx(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,ix(e));return JSON.parse(window.atob(ox(new Uint8Array(r))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<fO("AP_CACHE_LIFETIME"))return n}catch(e){qO.warn("Error get preloadInfo",e.message)}}function oB(e){let t;try{if(t=lB(qF),!t)return;const n=JSON.parse(t),r=dB(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(e=>r in e));if(-1===i)return;const o=n.splice(i,1)[0];return uB(qF,JSON.stringify(n)),o[r]}catch(e){qO.warn("Error delete preload info: ".concat(t),e.message),uB(qF,"")}}function sB(e){if(e){let t=YF.get(e);t&&(window.clearTimeout(t),t=null,YF.delete(e)),Nr(XF).call(XF,e)||"disabled"!==e.cloudProxyServer||XF.push(e)}if(YF.size<fO("AP_CACHE_NUM")&&XF.length>0){const e=XF.shift();YF.set(e,window.setTimeout((async()=>{const{appId:t,cname:n,token:r,stringUid:i,uid:o,proxyServer:s}=e;try{await tB(t,n,r,o,s,i),YF.has(e)&&sB(e)}catch(t){qO.warn("update preload failed",t.message),aB(e)}}),fO("AP_UPDATE_INTERVAL")))}}function aB(e){const t=XF.indexOf(e);-1!==t&&XF.splice(t,1);let n=YF.get(e);n&&(window.clearTimeout(n),n=null,YF.delete(e),sB())}function cB(e,t){const n=e.sua,r=e.ap;t&&n&&ek.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ek.reportResourceTiming(e.ap.url,e.sid),ek.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((e=>e.ip)).join(","),eventType:"disabled",unilbsServerIds:[Ij.CHOOSE_SERVER,Ij.CLOUD_PROXY_FALLBACK].toString()}),ek.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Ij.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function lB(e){return window.atob(window.localStorage.getItem(e)||"")}function uB(e,t){window.localStorage.setItem(e,window.btoa(t))}function dB(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),bx(t)}function hB(e){let t=function(){const e=gB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(RB(t,10),SB(t,n));let r=e.cid;void 0!==r&&(RB(t,16),RB(t,r));let i=e.cname;void 0!==i&&(RB(t,26),SB(t,i));let o=e.deviceId;void 0!==o&&(RB(t,34),SB(t,o));let s=e.elapse;void 0!==s&&(RB(t,40),xB(t,s));let a=e.fileSize;void 0!==a&&(RB(t,48),xB(t,mB(a)));let c=e.height;void 0!==c&&(RB(t,56),xB(t,mB(c)));let l=e.jpg;void 0!==l&&(RB(t,66),RB(t,l.length),bB(t,l));let u=e.networkType;void 0!==u&&(RB(t,72),xB(t,mB(u)));let d=e.osType;void 0!==d&&(RB(t,80),xB(t,mB(d)));let h=e.requestId;void 0!==h&&(RB(t,90),SB(t,h));let p=e.sdkVersion;void 0!==p&&(RB(t,98),SB(t,p));let f=e.sequence;void 0!==f&&(RB(t,104),xB(t,mB(f)));let m=e.sid;void 0!==m&&(RB(t,114),SB(t,m));let g=e.timestamp;void 0!==g&&(RB(t,120),xB(t,g));let v=e.uid;void 0!==v&&(RB(t,128),RB(t,v));let y=e.vid;void 0!==y&&(RB(t,136),RB(t,y));let _=e.width;void 0!==_&&(RB(t,144),xB(t,mB(_)));let E=e.service;void 0!==E&&(RB(t,152),RB(t,E));let b=e.callbackData;void 0!==b&&(RB(t,162),RB(t,b.length),bB(t,b));let w=e.ticket;void 0!==w&&(RB(t,170),SB(t,w));let S=e.vendorConfigs;void 0!==S&&(RB(t,178),SB(t,S))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function pB(e){return function(e){let t={};e:for(;!yB(e);){let n=AB(e);switch(n>>>3){case 0:break e;case 1:t.code=AB(e);break;case 2:t.msg=wB(e,AB(e));break;case 3:t.requestId=wB(e,AB(e));break;case 4:t.timestamp=IB(e,!1);break;default:fB(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function fB(e,t){switch(t){case 0:for(;128&TB(e););break;case 2:vB(e,AB(e));break;case 5:vB(e,4);break;case 1:vB(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function mB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gB=[];function vB(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function yB(e){return e.offset>=e.limit}function _B(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function EB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function bB(e,t){let n=_B(e,t.length);e.bytes.set(t,n)}function wB(e,t){let n=EB(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let e,c,l,u,d=i[a+n];0==(128&d)?s+=r(d):192==(224&d)?a+1>=t?s+=o:(e=i[a+n+1],128!=(192&e)?s+=o:(u=(31&d)<<6|63&e,u<128?s+=o:(s+=r(u),a++))):224==(240&d)?a+2>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],32896!=(49344&(e|c<<8))?s+=o:(u=(15&d)<<12|(63&e)<<6|63&c,u<2048||u>=55296&&u<=57343?s+=o:(s+=r(u),a+=2))):240==(248&d)?a+3>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],l=i[a+n+3],8421504!=(12632256&(e|c<<8|l<<16))?s+=o:(u=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&l,u<65536||u>1114111?s+=o:(u-=65536,s+=r(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o}return s}function SB(e,t){let n=t.length,r=0;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}RB(e,r);let i=_B(e,r),o=e.bytes;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function TB(e){return e.bytes[EB(e,1)]}function CB(e,t){let n=_B(e,1);e.bytes[n]=t}function AB(e){let t,n=0,r=0;do{t=TB(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function RB(e,t){for(t>>>=0;t>=128;)CB(e,127&t|128),t>>>=7;CB(e,t)}function IB(e,t){let n,r=0,i=0,o=0;return n=TB(e),r=127&n,128&n&&(n=TB(e),r|=(127&n)<<7,128&n&&(n=TB(e),r|=(127&n)<<14,128&n&&(n=TB(e),r|=(127&n)<<21,128&n&&(n=TB(e),i=127&n,128&n&&(n=TB(e),i|=(127&n)<<7,128&n&&(n=TB(e),i|=(127&n)<<14,128&n&&(n=TB(e),i|=(127&n)<<21,128&n&&(n=TB(e),o=127&n,128&n&&(n=TB(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function xB(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=_B(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}const OB={},kB={},NB=4294967296,PB=NB*NB,DB=PB/2,LB=FB(0,!0),MB=FB(0),jB=BB(0,-2147483648,!1),UB=BB(-1,2147483647,!1),VB=BB(-1,-1,!0);function FB(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=kB[e],r)?r:(n=BB(e,0,!0),i&&(kB[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=OB[e],r)?r:(n=BB(e,e<0?-1:0,!1),i&&(OB[e]=n),n)}function BB(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function WB(e,t){if(isNaN(e))return t?LB:MB;if(t){if(e<0)return LB;if(e>=PB)return VB}else{if(e<=-DB)return jB;if(e+1>=DB)return UB}return e<0?t?LB:MB:BB(e%NB|0,e/NB|0,t)}function zB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class HB extends kI{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(rj.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),JT(this,"name","AgoraRTCImageModeration"),JT(this,"_connectionState",nj.CONNECTING),JT(this,"_sequence",0),JT(this,"_moderationStartTime",void 0),JT(this,"_workerConnection",void 0),JT(this,"_workerMessageLengthLimit",void 0),JT(this,"_qualityRatio",void 0),JT(this,"_connectInfo",void 0),JT(this,"_cancelTokenSource",AR.CancelToken.source()),JT(this,"_retryConfig",void 0),JT(this,"_moderationInterval",void 0),JT(this,"_moderationTimer",null),JT(this,"_moderationMode",1),JT(this,"_quality",1),JT(this,"_qualityTimer",null),JT(this,"_ticket",void 0),JT(this,"_moderationIntervalMinimum",void 0),JT(this,"_uploadFailedNum",0),JT(this,"_uploadNum",0),JT(this,"_uploadTimer",null),JT(this,"_extraInfo",void 0),JT(this,"_vendor",""),JT(this,"_encoder",new TextEncoder),JT(this,"_moderationId",void 0),JT(this,"inspectImage",(()=>{if(this.connectionState!==nj.CONNECTED)throw new tk(mI.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===nj.CONNECTED?this.requestToInspectImage():qO.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=hx(5,"image-moderation-"),this._workerMessageLengthLimit=fO("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=fO("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=fO("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Cj("worker-"+this._moderationId,Ax),this.on(rj.STATE_CHANGE,((e,t)=>{qO.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ij[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(rj.STATE_CHANGE,ij.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new zh(((r,i)=>{this.on(rj.CONNECTION_STATE_CHANGE,((e,t)=>{e===nj.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),qO.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===nj.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=fO("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:l}=t;eV++;const u="moderation_plugin",d={service_name:u,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:eV,seq:eV,sid:a,appToken:c,ts:Date.now(),uid:l+""})};let h,p,f=e[0];return Ix((async()=>{h=Date.now();const e=await NU(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new tk(mI.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw qO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new tk(mI.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw qO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new tk(mI.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw qO.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new tk(mI.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw qO.error(e.toString()),e}const r=fO("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}}),((t,n)=>(ek.apworkerEvent(a,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(ek.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==mI.OPERATION_ABORTED&&t.code!==mI.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(rj.STATE_CHANGE,ij.AP_CONNECTED);const{addressList:o,ticket:s}=i;return this._ticket=s,o}async connectWorker(e){this.emit(rj.STATE_CHANGE,ij.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(gM.CONNECTED,(async()=>{this.emit(rj.STATE_CHANGE,ij.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=nj.CONNECTED})),this._workerConnection.on(gM.CLOSED,(()=>{this.connectionState=nj.CLOSED})),this._workerConnection.on(gM.FAILED,(()=>{this.connectionState=nj.CLOSED})),this._workerConnection.on(gM.RECONNECTING,(()=>{this.connectionState=this.connectionState===nj.CONNECTED?nj.RECONNECTING:nj.CONNECTING})),this._workerConnection.on(gM.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=pB(new Uint8Array(e.data));fO("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&qO.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,qO.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{ek.reportApiInvoke(this._connectInfo.sid||null,{name:DI.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:LI.TRACER}).onError(new tk(mI.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),fO("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else qO.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(gM.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(gM.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=$I(this,rj.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(fO("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&qO.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else fO("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&qO.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await LN(l,n,r),d=this._sequence+"-"+i+"-"+a+"-"+c+"-"+hx(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:HB.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.23.2",sequence:this._sequence,sid:s,timestamp:WB(c),uid:a,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=hB(h);if(p.byteLength<this._workerMessageLengthLimit){if(fO("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zB(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,qO.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=AR.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=nj.CLOSED,this.emit(rj.STATE_CHANGE,ij.CLOSED)}}function GB(e){if(_I(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new tk(mI.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new tk(mI.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const qB={name:"ImageModeration",create:function(e){let{config:t}=e;return GB(t),new HB(t)}};var KB,$B,YB,XB,JB,QB,ZB,eW,tW,nW,rW,iW,oW,sW,aW,cW,lW,uW,dW,hW,pW,fW,mW,gW,vW,yW,_W,EW,bW,wW,SW,TW,CW,AW,RW,IW,xW,OW,kW,NW,PW,DW;function LW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function MW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LW(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Tx.setLogger(qO);let jW=(KB=ZO(),$B=ZO({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Yk))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),YB=ZO({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==xk.DATA?(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))):[t.getChannelId()])}),XB=ZO({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),JB=ZO({argsMap:(e,t,n)=>[t,n]}),QB=ZO({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),ZB=ZO({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),eW=ZO({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),tW=ZO(),nW=ZO(),rW=ZO(),iW=ZO(),oW=ZO(),sW=ZO(),aW=ZO(),cW=ZO(),lW=ZO(),uW=ZO(),dW=ZO(),hW=ZO(),pW=ZO(),fW=ZO(),mW=ZO(),gW=ZO({argsMap:(e,t)=>[t]}),vW=ZO(),yW=ZO(),_W=ZO(),EW=ZO(),bW=ZO(),wW=ZO(),SW=ZO(),TW=ZO(),CW=ZO({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),AW=ZO(),RW=ZO(),IW=ZO(),xW=ZO(),OW=ZO(),kW=ZO(),NW=ZO({reportResult:!0}),PW=ZO(),DW=class extends kI{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),JT(this,"store",void 0),JT(this,"_uid",void 0),JT(this,"_channelName",void 0),JT(this,"_uintUid",void 0),JT(this,"_users",[]),JT(this,"_config",void 0),JT(this,"_clientId",void 0),JT(this,"_appId",void 0),JT(this,"_sessionId",null),JT(this,"_key",void 0),JT(this,"_rtmConfig",{}),JT(this,"_joinInfo",void 0),JT(this,"_gateway",void 0),JT(this,"_statsCollector",void 0),JT(this,"_configDistribute",void 0),JT(this,"_leaveMutex",void 0),JT(this,"_publishMutex",void 0),JT(this,"_renewTokenMutex",void 0),JT(this,"_subscribeMutex",void 0),JT(this,"_encryptionMode","none"),JT(this,"_encryptionSecret",null),JT(this,"_encryptionSalt",null),JT(this,"_encryptDataStream",!1),JT(this,"_encryptDataStreamKey",null),JT(this,"_encryptDataStreamIv",null),JT(this,"_proxyServer",void 0),JT(this,"_turnServer",{servers:[],mode:"auto"}),JT(this,"_cloudProxyServerMode","disabled"),JT(this,"_isDualStreamEnabled",!1),JT(this,"_defaultStreamFallbackType",void 0),JT(this,"_lowStreamParameter",void 0),JT(this,"_streamFallbackTypeCacheMap",new Map),JT(this,"_remoteStreamTypeCacheMap",new Map),JT(this,"_axiosCancelSource",AR.CancelToken.source()),JT(this,"_audioVolumeIndicationInterval",void 0),JT(this,"_networkQualityInterval",void 0),JT(this,"_userOfflineTimeout",void 0),JT(this,"_streamRemovedTimeout",void 0),JT(this,"_liveTranscodeStreamingClient",void 0),JT(this,"_liveRawStreamingClient",void 0),JT(this,"_channelMediaRelayClient",void 0),JT(this,"_networkQualitySensitivity","normal"),JT(this,"_p2pChannel",void 0),JT(this,"_useLocalAccessPoint",!1),JT(this,"_setLocalAPVersion",void 0),JT(this,"_joinAndNotLeaveYet",!1),JT(this,"_numberOfJoinCount",0),JT(this,"_remoteDefaultVideoStreamType",void 0),JT(this,"_inspect",void 0),JT(this,"_moderation",void 0),JT(this,"_license",void 0),JT(this,"_pendingPublishedUsers",[]),JT(this,"ntpAlignErrorCount",0),JT(this,"remoteInboundOffset",0),JT(this,"_peerConnectionState",void 0),JT(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),JT(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),JT(this,"_handleUserOnline",(e=>{if(fO("BLOCK_LOCAL_CLIENT")&&EL(e.uid,this.channelName))return void qO.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&qO.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(WI.USER_JOINED,t));else{const t=new TV(e.uid,e.uint_id||e.uid);this._users.push(t),qO.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(WI.USER_JOINED,t)}})),JT(this,"_handleUserOffline",(e=>{if(fO("BLOCK_LOCAL_CLIENT")&&EL(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:JI(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),qO.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(WI.USER_LEAVED,t,e.reason))})),JT(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,s)=>{if(fO("BLOCK_LOCAL_CLIENT")&&EL(t,this.channelName))return;const a=this._users.find((e=>e.uid===t));if(!a)return void qO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));qO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(a.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?a.hasAudio:a.hasVideo;a._uintid||(a._uintid=i||t),"audio"===e?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===e?(a._audio_added_=!0,void 0!==n&&(a._audioSSRC=n),void 0!==r&&(a._cname=r),o&&(a._audioOrtc=o)):(a._video_added_=!0,void 0!==n&&(a._videoSSRC=n),void 0!==r&&(a._cname=r),void 0!==s&&(a._rtxSsrcId=s),o&&(a._videoOrtc=o)),("audio"===e?a.hasAudio:a.hasVideo)&&!c&&(qO.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(e)),this.safeEmit(WI.USER_PUBLISHED,a,e)),"video"===e?ek.onGatewayStream(this._sessionId,XO.ON_ADD_VIDEO_STREAM,JO.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:a._videoSSRC}):ek.onGatewayStream(this._sessionId,XO.ON_ADD_AUDIO_STREAM,JO.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:a._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(a,e,n).then((t=>{if(t&&(qO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof NF))return this._p2pChannel.unsubscribe(a,e,!0).then((()=>this._subscribe(a,e,!0).catch((e=>{qO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(a,e)&&(qO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,e,!0).catch((e=>{qO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),JT(this,"_handleRemoveStream",(e=>{if(fO("BLOCK_LOCAL_CLIENT")&&EL(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));if(!t)return void qO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));qO.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{qO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(WI.USER_UNPUBLISHED,t,"audio"),qO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(WI.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{qO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(WI.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{qO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(WI.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof NF&&this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),ek.onGatewayStream(this._sessionId,XO.ON_REMOVE_STREAM,JO.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),JT(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(fO("BLOCK_LOCAL_CLIENT")&&EL(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void qO.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));qO.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";qO.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(WI.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";qO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(WI.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(qO.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(WI.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),qO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(WI.USER_UNPUBLISHED,r,e)):void 0})),JT(this,"_handleMuteStream",((e,t,n)=>{if(fO("BLOCK_LOCAL_CLIENT")&&EL(e,this.channelName))return;qO.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find((t=>t.uid===e));if(!r)return void qO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";qO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(WI.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";qO.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(WI.USER_INFO_UPDATED,e,t)}}const o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(qO.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(WI.USER_PUBLISHED,r,t)):void qO.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),qO.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(WI.USER_UNPUBLISHED,r,t)}})),JT(this,"_handleP2PLost",(async e=>{qO.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():qO.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),JT(this,"_handleTokenWillExpire",(()=>{qO.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(WI.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),JT(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),qO.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),JT(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(WI.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(WI.NETWORK_QUALITY,e)})),JT(this,"_handleP2PAddAudioOrVideoStream",((e,t,n,r)=>{const i=this._users.find((e=>e.uid===t));if(!i)return void qO.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));qO.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const o="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!o&&(qO.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(WI.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(qO.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch((e=>{qO.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=t||hx(5,"client-"),this.store=new class{constructor(e,t,n,r){fI(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:sO.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case vO.SET_SESSION_ID:return pI(pI({},e),{},{sessionId:t.sessionId});case vO.SET_P2P_ID:return pI(pI({},e),{},{p2pId:t.p2pId});case vO.SET_UID:return pI(pI({},e),{},{uid:t.uid});case vO.SET_INT_UID:return pI(pI({},e),{},{intUid:t.intUid});case vO.SET_PUB_ID:return pI(pI({},e),{},{pubId:t.pubId});case vO.KEY_METRIC_CLIENT_CREATED:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{clientCreated:t.metric})});case vO.KEY_METRIC_JOIN_START:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{joinStart:t.metric})});case vO.AVOID_JOIN_START:return pI(pI({},e),{},{avoidJoinStart:t.avoidJoinStart});case vO.KEY_METRIC_JOIN_END:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{joinEnd:t.metric})});case vO.KEY_METRIC_REQUEST_AP_START:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{requestAPStart:t.metric})});case vO.KEY_METRIC_REQUEST_AP_END:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{requestAPEnd:t.metric})});case vO.KEY_METRIC_JOIN_GATEWAY_START:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case vO.KEY_METRIC_JOIN_GATEWAY_END:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case vO.KEY_METRIC_PEER_CONNECTION_START:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case vO.KEY_METRIC_PEER_CONNECTION_END:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case vO.KEY_METRIC_DESCRIPTION_START:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{descriptionStart:t.metric})});case vO.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case vO.KEY_METRIC_ICE_CONNECTION_END:return pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case vO.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=pI(pI({},n[r]),t.metric),pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{publish:[...n]})})):pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case vO.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=pI(pI({},n[r]),t.metric),pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{subscribe:[...n]})})):pI(pI({},e),{},{keyMetrics:pI(pI({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case vO.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case vO.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=pI(pI({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case vO.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case vO.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case vO.SET_USE_P2P:return pI(pI({},e),{},{useP2P:t.val});case vO.SET_TRANSPORT_TYPE:return pI(pI({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:vO.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:vO.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:vO.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:vO.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:vO.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:vO.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:vO.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:vO.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:vO.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:vO.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:vO.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:vO.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:vO.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:vO.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:vO.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:vO.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:vO.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:vO.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:vO.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:vO.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:vO.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:vO.KEY_METRIC_PUBLISH,metric:pI(pI({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,s){this.dispatch({type:vO.KEY_METRIC_SUBSCRIBE,metric:pI(pI(pI(pI(pI({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),s&&{firstDecoded:s})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:vO.KEY_METRIC_SUBSCRIBE,metric:pI(pI(pI({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:vO.RECORD_JOIN_CHANNEL_SERVICE,record:pI(pI({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:vO.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:vO.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:vO.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:vO.AVOID_JOIN_START,avoidJoinStart:e})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Tx("client-leave",this._clientId),this._publishMutex=new Tx("client-publish",this._clientId),this._renewTokenMutex=new Tx("client-renewtoken",this._clientId),this._subscribeMutex=new Tx("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),qO.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(iO," build: ").concat(uO,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{BI(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(e){qO.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var r;this._statsCollector=new bV(this.store),this._statsCollector.onStatsException=(e,t,n)=>{qO.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(WI.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&ek.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useP2P="p2p"===e.mode,this._gateway=new xU(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ax,httpRetryConfig:e.httpRetryConfig||Ax,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new mV(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},SU("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new NF(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];pO("JOIN_GATEWAY_USE_443PORT_ONLY",o),pO("JOIN_GATEWAY_USE_DUAL_DOMAIN",s);const a=this._gateway.signal.websocket;return a instanceof Tj&&(a.use443PortOnly=o,a.tryDoubleDomain=s),async function(e,t,n){xR.get(e)||xR.set(e,[]),OR.get(e)||OR.set(e,t),kR.get(e)||kR.set(e,0);const r=xR.get(e),i=OR.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(kR.get(e)===i){const e=IR();r.push(e),await e.promise}kR.set(e,kR.get(e)+1);for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];const c=await n(...s);return kR.set(e,kR.get(e)-1),kR.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===kR.get(e)&&(xR.set(e,[]),OR.set(e,0),kR.set(e,0)),c}("client.join",fO("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const s="HTTPS"===(xx||xx||(xx=(window.location.protocol.split(":")[0]||"").toUpperCase(),xx)),a=Lx()?window.isSecureContext:"Browser Not Support";if(!Lx()&&!s||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";qO.warning(e)}"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),qO.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),ek.setAppId(e);try{if(!n&&null!==n)throw new tk(mI.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&bI(n,"token",1,2047),bI(e,"appid",1,2047),vM(t),r&&yM(r),i&&bI(i,"optionalInfo",1,2047)}catch(i){throw ek.reportApiInvoke(px(),{name:DI.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:LI.TRACER}).onError(i),i}if(this._leaveMutex.isLocked&&(qO.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),qO.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const i=new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ek.reportApiInvoke(px(),{name:DI.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:LI.TRACER}).onError(i),i}this._gateway.state="CONNECTING";const c=await iB({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const l=(null==c?void 0:c.sid)||px();qO.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);const u=ek.reportApiInvoke(l,{id:this._clientId,name:DI.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:LI.TRACER}),d=MW(MW(MW({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:fO("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(d.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(d.stringUid=r,this._uintUid?(d.uid=this._uintUid,this._uintUid=void 0):d.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(d.aesmode=this._encryptionMode,d.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=II(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=fO("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(d.appId+this._encryptionSecret+this._encryptionSecret):e.encode(d.appId+d.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,o=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:bO,hash:"SHA-256",salt:n},r,i+EO);return new Uint8Array(o).subarray(i/8)}(this._encryptionMode,t,ix(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:bO,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,ix(this._encryptionSalt))}else a?qO.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):qO.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,qO.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:d.stringUid});const h=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&ek.joinChannelTimeout(this._sessionId,5)}),5e3);try{var p;let r;const i=d.cloudProxyServer;if(Nr(p=["proxy3","proxy4","proxy5"]).call(p,i)){const e=fO("PROXY_SERVER_TYPE3");Array.isArray(e)?d.proxyServer=e[0]:d.proxyServer=e}if(ek.setProxyServer(d.proxyServer),qO.setProxyServer(d.proxyServer),this.store.requestAPStart(),c){if(qO.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d.stringUid?", ".concat(d.stringUid," => ").concat(c.intUid):""," ")),d.stringUid&&!d.uid&&(d.uid=c.intUid),r={gatewayInfo:c.ap.gatewayInfo},fO("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===d.turnServer.mode)if(0===c.ap.proxyInfo.addresses.length)qO.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await jj(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map((e=>({turnServerURL:e.address,tcpport:e.tcpport||aO.tcpport,udpport:e.udpport||aO.udpport,username:e.username||aO.username,password:e.password||aO.password,forceturn:!1,security:!0})));d.turnServer={mode:"manual",servers:e}}cB(c,d.stringUid)}else{if(d.stringUid&&!d.uid){let e;[e,r]=await zh.all([sV(d.stringUid,d,this._axiosCancelSource.token,this._config.httpRetryConfig||Ax,this.store),oV(d,this._axiosCancelSource.token,this._config.httpRetryConfig||Ax,!0,this.store)]),qO.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d.stringUid," => ").concat(e)),d.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await oV(d,this._axiosCancelSource.token,this._config.httpRetryConfig||Ax,!0,this.store);if(!this._joinAndNotLeaveYet)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(d,this._axiosCancelSource.token),this._configDistribute.on(FM.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)})),this._configDistribute.on(FM.UPDATE_CLIENT_ROLE_OPTIONS,(e=>{this._setClientRoleOptions(e)}))}),0),this._key=n||e;const o=r.gatewayInfo,s=d.uid?d.uid:o.uid;this._joinInfo=MW(MW({},d),{},{cid:o.cid,uid:s,vid:o.vid,apResponse:o.res,apGatewayAddress:o.apGatewayAddress,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs}),this.store.intUid=s,this.store.cid=o.cid;const a=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(a),this._appId=e,this._channelName=d.cname,this._uid=a,this.store.uid=a,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(zR()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const l=d.stringUid?"string uid: ".concat(d.stringUid,",uid: ").concat(d.uid):"uid: ".concat(this._uid);return qO.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(l)),setTimeout((()=>{qO.startUpload()}),5e3),this.store.joinEnd(),f=this,Nr(yL).call(yL,f)||yL.push(f),"disabled"===this._cloudProxyServerMode&&rk().supportWebCrypto&&fO("ENABLE_PRELOAD")&&sB(this._joinInfo),a}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===mI.OPERATION_ABORTED?qO.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):qO.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==mI.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new tk(mI.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!fO("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){qO.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(zR()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=yL.indexOf(e);-1!==t&&yL.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return qO.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,UI.LEAVE),qO.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Yk))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new tk(mI.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new tk(mI.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof Yk))throw new tk(mI.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new tk(mI.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}qO.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof pD&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),qO.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw qO.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){_I(e.id,"id",0,65535,!0),vI(e.ordered,"ordered"),bI(e.metadata,"metadata",0,512),qO.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new tk(mI.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new tk(mI.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&fO("FORCE_TURN")&&!fO("TURN_ENABLE_TCP")&&!fO("TURN_ENABLE_UDP"))throw new tk(mI.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return TU(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw qO.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new tk(mI.CREATE_DATACHANNEL_ERROR);try{await zh.all(n.map((e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)))),await t._waitTillOpen()}catch(e){if(e.code!==mI.DISCONNECT_P2P)throw e}}return qO.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw qO.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new tk(mI.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Yk))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);qO.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(oj.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),qO.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(e){throw qO.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),qO.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),qO.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(e){throw qO.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof TV)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(yI(t,"mediaType",["audio","video"]),this.store.useP2P)throw new tk(mI.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===HM.AUDIO,r=t===HM.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:o,rtxSsrcId:s,cname:a,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new tk(mI.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find((t=>t.uid===e));l||(l=new TV(e,c||e),l._is_pre_created=!0,this._users.push(l)),a&&(l._cname=a),l._uintid||(l._uintid=c||e),n&&(l._audioSSRC=i,l._audio_pre_subscribed=!0,o&&(l._audioOrtc=o)),r&&(l._videoSSRC=i,l._video_pre_subscribed=!0,o&&(l._videoOrtc=o),null!=s&&(l._rtxSsrcId=s)),qO.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(l,t,i,s,o);const u=n?l._audioTrack:l._videoTrack;if(!u)throw new tk(mI.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),r&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),u}catch(t){throw qO.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(_I(t,"channelId",0,65535,!0),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r)throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new tk(mI.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!i)throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new tk(mI.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();qO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Nr(n).call(n,i.id))try{var s;if("number"!=typeof i._originDataChannelId)throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new tk(mI.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(s=i.metadata)&&void 0!==s?s:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==mI.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return qO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{o()}}async _p2pSubscribe(e,t,n){if(yI(t,"mediaType",["audio","video"]),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new tk(mI.INVALID_REMOTE_USER,"user is not published");throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new tk(mI.REMOTE_USER_IS_NOT_PUBLISHED);throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();qO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,n,r)}catch(e){throw e}qO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{qO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new tk(mI.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw qO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(yI(t,"mediaType",["audio","video"]),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new tk(mI.INVALID_REMOTE_USER,"user is not published");throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new tk(mI.REMOTE_USER_IS_NOT_PUBLISHED);throw qO.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,o="audio"===t?e._audioOrtc:e._videoOrtc,s="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?HM.AUDIO:HM.VIDEO,ssrcId:i};const c=await this._subscribeMutex.lock();qO.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,o="audio"===t?e._audioOrtc:e._videoOrtc,s="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?HM.AUDIO:HM.VIDEO,ssrcId:i}),yV.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,s,o);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,a,!0)}catch(n){if((null==n?void 0:n.code)!==mI.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}qO.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{qO.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new tk(mI.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw qO.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(wI(e,"subscribeList"),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();qO.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var s;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:s}=r;if(yI(s,"mediaType",["audio","video"]),!o){const e=new tk(mI.INVALID_PARAMS,"user property does not exist in subscribeList item");throw qO.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const a=this._users.find((e=>e===o));if(!a){const n=new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");qO.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===s&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===s&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new tk(mI.REMOTE_USER_IS_NOT_PUBLISHED);qO.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=LM.Video|LM.LwoVideo,l=n.get(o);if(l){if("video"===s?l&c:l&LM.Audio){e.splice(t,1),qO.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(s," twice"));continue}n.set(o,l|("video"===s?c:LM.Audio))}else n.set(o,"video"===s?c:LM.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,s=LM.Video|LM.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^s:r^LM.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);let r=Xr(s=Array.from(n.entries())).call(s,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&LM.Audio&&(i.audio_ssrc=n._audioSSRC),r&LM.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===HM.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===HM.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(r=r.filter((e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc)),r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach((t=>{let[n,r]=t;const i=this.remoteUsers.find((e=>e.uid===n));if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=HM.VIDEO:r.audio_error_code&&(t=HM.AUDIO),e.push({user:i,mediaType:t})}})),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=hj(n);qO.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new tk(mI.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;ek.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===HM.VIDEO,audio:e.mediaType===HM.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===HM.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)})),qO.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t,n){if(!(e instanceof TV)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&yI(t,"mediaType",["audio","video"]),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const r=this._users.find((t=>t===e));if(!r){const t=new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");throw qO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}qO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&JI(this._users,e),qO.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===mI.DISCONNECT_P2P)return void qO.warning("disconnecting p2p, abort unsubscribe request.");throw qO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&_I(t,"id",0,65535,!0),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find((t=>t===e));if(!n){const t=new tk(mI.INVALID_REMOTE_USER,"user is not in the channel");throw qO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let r;if("number"==typeof t){const n=e._dataChannels.find((e=>e.id===t));n&&(r=[n])}else r=e._dataChannels;if(void 0===r){const n=new tk(mI.REMOTE_USER_IS_NOT_PUBLISHED);throw qO.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}qO.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((e=>e.id))));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),qO.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===mI.DISCONNECT_P2P)return void qO.warning("disconnecting p2p, abort unsubscribe request.");throw qO.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(wI(e,"unsubscribeList"),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");qO.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new tk(mI.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw qO.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}yI(i,"mediaType",["video","audio",void 0]);const o=this._users.find((e=>e===r));if(!o){qO.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const s=LM.Video|LM.LwoVideo;if(t.has(r)){const o=t.get(r);let a;switch(i){case"video":a=o&s;break;case"audio":a=o&LM.Audio;break;default:a=o&(LM.Audio|s)}if(a){qO.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,o|LM.Audio):"video"===i&&t.set(r,o|s):t.set(r,o|LM.Audio|s)}else i?"audio"===i?t.set(r,LM.Audio):"video"===i&&t.set(r,s):t.set(r,LM.Audio|s)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),qO.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===mI.DISCONNECT_P2P)return void qO.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw qO.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new gI(mI.INVALID_PARAMS);SI(e.width)||EI(e.width,"streamParameter.width"),SI(e.height)||EI(e.height,"streamParameter.height"),SI(e.framerate)||EI(e.framerate,"streamParameter.framerate"),SI(e.bitrate)||_I(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&qO.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),qO.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,$M.LocalVideoLowTrack)}async enableDualStream(){if(!rk().supportDualStream)throw ek.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new tk(mI.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new tk(mI.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ek.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ek.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),qO.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($M.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ek.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ek.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),qO.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){yI(e,"role",["audience","host"])}(e),t&&BI(t),"rtc"===this.mode||"p2p"===this.mode)throw qO.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new tk(mI.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new tk(mI.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new tk(mI.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&fO("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",zI.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),qO.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&BI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{qO.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(bI(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new tk(mI.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ek.setProxyServer(this._proxyServer),qO.setProxyServer(this._proxyServer),qO.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new tk(mI.INVALID_OPERATION,"You have already set the proxy")}if(VI(e))return this._turnServer={servers:e,mode:"original-manual"},void qO.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>FI(e))),this._turnServer={servers:e,mode:"manual"},qO.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"you should set license before join channel");if(bI(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new tk(mI.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,qO.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new tk(mI.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new tk(mI.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new tk(mI.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,qO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"Stop proxy server after leave channel");ek.setProxyServer(),qO.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",qO.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new tk(mI.INVALID_PARAMS,"accessPoints is required.");wI(e.accessPoints.serverList,"accessPoints.serverList"),bI(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{_I(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new tk(mI.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");fO("CLOSE_AFB_FOR_LOCAL_AP")&&(pO("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),pO("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),s=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,pO("WEBCS_DOMAIN",s),pO("WEBCS_DOMAIN_BACKUP_LIST",s),pO("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(wI(e.report.hostname,"report.hostname"),pO("EVENT_REPORT_DOMAIN",e.report.hostname[0]),pO("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(pO("EVENT_REPORT_DOMAIN",o[0]),pO("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let a=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),a=e.report.port),pO("STATS_COLLECTOR_PORT",a),e.report?pO("ENABLE_EVENT_REPORT",!0):pO("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(wI(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),pO("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let u=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(wI(e.cds.hostname,"cds.hostname"),u=e.cds.hostname):u=o;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),pO("CDS_AP",u.map((e=>"".concat(e,":").concat(d)))),e.cds?pO("ENABLE_CONFIG_DISTRIBUTE",!0):pO("ENABLE_CONFIG_DISTRIBUTE",!1),qO.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(wI(e,"serverList"),bI(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new tk(mI.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,pO("WEBCS_DOMAIN",e),pO("WEBCS_DOMAIN_BACKUP_LIST",e),pO("GATEWAY_DOMAINS",[t]),pO("EVENT_REPORT_DOMAIN",e[0]),pO("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),pO("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),qO.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(yI(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw qO.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else qO.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){yI(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw qO.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}qO.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){yI(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw qO.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}qO.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){!function(e){yI(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),bI(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Nr(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new tk(mI.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new tk(mI.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(vI(r,"encryptDataStream"),!Nr(i).call(i,e))throw new tk(mI.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||qO.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ox(n))}async renewToken(e){if(bI(e,"token",1,2047),!this._key||!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(fO("USE_NEW_TOKEN")){qO.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await hV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ax);qO.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else qO.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});qO.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,qO.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?qO.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(WI.VOLUME_INDICATOR,e)}),fO("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new tk(mI.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new tk(mI.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new tk(mI.LIVE_STREAMING_TASK_CONFLICT);const n=t?_M.TRANSCODE:_M.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(_M.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new tk(mI.INVALID_PARAMS,"can not find live streaming url to stop");await zh.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){SV(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){SV(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof NF&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Nr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;const i=Xr(r=Array.from(n)).call(r,((e,t)=>e+t),0),o={serverTs:0,seq:SO++,length:n.length,checkSum:i},s=new Uint8Array(_x(i,2)),a=new ArrayBuffer(wO),c=new DataView(a);c.setUint32(0,o.serverTs),c.setUint16(4,o.seq),c.setUint16(6,o.length),c.setUint16(8,o.checkSum);const l=16-n.length%16;n=ax(n,new Uint8Array(l));const u=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:_O,additionalData:s},t,n);return ax(new Uint8Array(a),new Uint8Array(u))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new tk(mI.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(hM.DATA_STREAM,{payload:ox(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-MF},!n)}sendMetadata(e){if(!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new tk(mI.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(hM.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ox(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach($O),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"can not send custom report, not joined");await ek.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){yI(t.spatialLayer,"spatialLayer",[0,1,2,3]),yI(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw qO.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(vI(t,"apRTM"),_I(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,qO.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(qO.debug("[".concat(this._clientId,"] reset client")),function(e){const t=_L.indexOf(e);-1!==t&&_L.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=AR.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&aB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ek.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Tx("client-publish",this._clientId),this._subscribeMutex=new Tx("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const r=e||px();e?qO.debug("[".concat(this._clientId,"] new Session ").concat(r)):qO.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,ek.addSid(r);const o={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};ek.sessionInit(this._sessionId,MW({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new tk(mI.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&fO("FORCE_TURN")&&!fO("TURN_ENABLE_TCP")&&!fO("TURN_ENABLE_UDP"))throw new tk(mI.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");qO.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(oj.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==mI.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof pD&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch((e=>{qO.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===mI.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new tk(mI.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));qO.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==mI.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===mI.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new tk(mI.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},SU("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{ek.reportApiInvoke(this._sessionId,{name:DI.ON_LIVE_STREAM_ERROR,options:[e,t],tag:LI.TRACER}).onSuccess(),this.safeEmit(WI.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{ek.reportApiInvoke(this._sessionId,{name:DI.ON_LIVE_STREAM_WARNING,options:[e,t],tag:LI.TRACER}).onSuccess(),this.safeEmit(WI.LIVE_STREAMING_WARNING,e,t)},e.on(CM.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new tk(mI.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,r){const i=fO("UAP_AP").slice(0,fO("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await GU(i,e,t,n,r)})(e,this._joinInfo,this._axiosCancelSource.token,Ax).then(t).catch(n)})),e};return e===_M.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new tk(mI.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},SU("ChannelMediaRelay").create(e));r.on("state",(e=>{e===OM.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(WI.CHANNEL_MEDIA_RELAY_STATE,e)})),r.on("event",(e=>{this.safeEmit(WI.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const e=[];this._users.forEach((t=>{t._dataChannels.forEach((r=>{n.every((e=>e.uid!==t._uintid||e.stream_id!==r.id))&&e.push({uid:t._uintid,stream_id:r.id,ordered:r.ordered,max_retrans_times:r.maxRetransmits,metadata:r.metadata})}))})),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach((e=>{const{uid:n,stream_id:r,ordered:o,max_retrans_times:s,metadata:a}=e,c=this._users.find((e=>e._uintid===n));if(c){if(qO.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Nr(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((t=>t.id===e.stream_id))){const e={id:r,ordered:!!o,maxRetransmits:s,metadata:a},n=function(e){return TU(e,!0)}(e);c._dataChannels.push(n),qO.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(WI.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(qO.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch((e=>{qO.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else qO.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(WI.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{const{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void qO.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(qO.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(r._dataChannels=r._dataChannels.filter((e=>e!==i)),e)return this._gateway.unsubscribeDataChannel(e,r.uid)})),qO.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(WI.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_handleRemoveDataChannels(e){const t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){qO.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{qO.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(WI.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else qO.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(PM.UPDATE_GATEWAY_CONFIG,(()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void qO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((e=>{const{value:r,type:i,expires:o}=t[e];o&&o<=n||i||bL()||!Object.prototype.hasOwnProperty.call(cO,e)||(gO[e]=r,hO[e]=r,qO.debug("Update gateway parameters from config distribute",e,r))}))}catch(e){qO.error("Error update config from local cache",e.message)}}()})),this._gateway.on(PM.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(PM.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===UI.FALLBACK)return;const i=()=>{this.safeEmit(WI.CONNECTION_STATE_CHANGE,e,t,n)};if(ek.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:DI.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:LI.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),qO.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{qO.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{qO.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{qO.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{qO.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{qO.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(qO.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,HM.AUDIO,!1)),e._trust_video_mute_state_||(qO.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,HM.VIDEO,!1)),e._trust_audio_enabled_state_||(qO.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(qO.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(qO.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(qO.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(qO.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(PM.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new tk(mI.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await iB(MW(MW({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,cB(n),this._joinInfo.preload=!0):(t=await iV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ax,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const r=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e;const[n,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:n,port:i}):r.push({host:n,port:i})})),e(r)}catch(e){t(e)}})),this._gateway.on(PM.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(WI.NETWORK_QUALITY,e)})),this._gateway.on(PM.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(WI.STREAM_TYPE_CHANGED,e,t),ek.reportApiInvoke(this._sessionId,{name:DI.STREAM_TYPE_CHANGE,options:[e,t],tag:LI.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(PM.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(PM.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();fO("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}})),this._gateway.on(PM.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:qO.debug("no attributes in joinResponse");const r=Jj(e.ortc,t,n);this._p2pChannel.connect(r)})),this._gateway.on(PM.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:e,cid:i}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(i,"_").concat(e),icePwd:"".concat(i,"_").concat(e)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(r=fO("FINGERPRINT"))&&void 0!==r?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(fM.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(fM.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(fM.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(fM.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(fM.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(fM.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(fM.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(fM.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(fM.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,HM.AUDIO,!0))),this._gateway.signal.on(fM.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,HM.AUDIO,!1))),this._gateway.signal.on(fM.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,HM.VIDEO,!0))),this._gateway.signal.on(fM.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,HM.VIDEO,!1))),this._gateway.signal.on(fM.RECEIVE_METADATA,(e=>{const t=ix(e.metadata);this.safeEmit(WI.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(fM.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=ix(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Nr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<wO)throw new tk(mI.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(wO));const t=await async function(e,t,n){const r=n.subarray(0,wO),i=r.slice(8,wO),o=(i[0]<<8)+i[1],s=(r[6]<<8)+r[7],a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:_O,additionalData:new Uint8Array(_x(o,2))},t,n.subarray(wO));return new Uint8Array(a).subarray(0,s)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let r=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find((t=>t.uid===e.uid)),i=null==t?void 0:t.audioRecv.find((e=>e.ssrc===(null==n?void 0:n._audioSSRC)));r=null==i?void 0:i.jitterBufferMs}(null==r||Number.isNaN(r))&&(r=0),WF(MW(MW({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(fM.ON_CRYPT_ERROR,(()=>{rx((()=>{qO.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(WI.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(fM.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(fM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{qO.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,UI.TOKEN_EXPIRE),this.safeEmit(WI.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(fM.ON_STREAM_FALLBACK_UPDATE,(e=>{qO.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(WI.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(fM.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),qO.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(fM.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(fM.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(dM.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case hM.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some((e=>{let{stream_type:t}=e;return t===NM.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t!==NM.Audio})),s=e.some((e=>{let{stream_type:t}=e;return t===NM.Screen||t===NM.ScreenLow}));"offer"===t.state&&ek.publish(this._joinInfo.sid,{eventElapse:yV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:mI.TIMEOUT,audio:i,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:s,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===NM.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:o?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==NM.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case hM.SUBSCRIBE:t&&ek.subscribe(this._joinInfo.sid,{succ:!1,ec:mI.TIMEOUT,audio:t.stream_type===HM.AUDIO,video:t.stream_type===HM.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:yV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(fM.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(fM.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;fO("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!EL(e.string_id||e.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new TV(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(WI.PUBLISHED_USER_LIST).length&&(qO.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(WI.USER_JOINED,e)));const i=LM.Audio&r.stream_type,o=(LM.Video|LM.LwoVideo)&r.stream_type,s=0!=(65280&r.stream_type),a=i&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!a&&0===this.getListeners(WI.PUBLISHED_USER_LIST).length&&(qO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(WI.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(WI.PUBLISHED_USER_LIST).length&&(qO.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(WI.USER_PUBLISHED,e,"video")),(i&&!a||o&&!c||s)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(qO.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{qO.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(WI.PUBLISHED_USER_LIST).length>0?fO("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(qO.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(WI.PUBLISHED_USER_LIST,t)):qO.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(fM.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof NF&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return Nr(t=Object.keys(yO)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(fM.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(oj.PUBLISH,((e,t,n)=>{const{uid:r}=e;e.forEach((e=>{const{kind:i,ssrcs:o,mid:s,isMuted:a}=e;this._handleP2PAddAudioOrVideoStream(i,r,o[0].ssrcId,s);const c=this._users.find((e=>e.uid===r));return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,i,o[0].ssrcId,s).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,i,!!a)}))})),this._gateway.signal.on(oj.CALL,(async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(e){n(e)}})),this._gateway.signal.on(dM.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(oj.UNPUBLISH,(async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,o=this._users.find((e=>e.uid===i));if(!o)return qO.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async e=>{let{stream_type:t}=e;const n=t===NM.Audio?HM.AUDIO:HM.VIDEO;await this._p2pChannel.unsubscribe(o,n),this._handleMuteStream(i,n,!0)})),t()}catch(e){n(e)}}})),this._gateway.signal.on(oj.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case aj.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,HM.VIDEO,!0);break;case aj.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,HM.AUDIO,!0);break;case aj.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,HM.VIDEO,!1);break;case aj.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,HM.AUDIO,!1)}})),this._gateway.signal.on(oj.RESTART_ICE,(async(e,t,n)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:r}=e;n!==mM.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}})),this._gateway.signal.on(oj.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(XM.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(oj.RESTART_ICE,e,n===mM.SEND_ONLY))}catch(e){n(e)}})),this._p2pChannel.on(XM.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(oj.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(XM.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(oj.CONTROL,e,!0),t()}catch(e){n(e)}})),this._p2pChannel.on(XM.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===mI.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(XM.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===mI.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(XM.StateChange,((e,t)=>{t===YM.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(XM.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(WI.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(XM.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===mI.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(XM.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===mI.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(XM.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(XM.RequestRePublishDataChannel,((e,t,n)=>{zh.all(e.map((async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach((e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)}))}catch(e){if(e.code!==mI.DISCONNECT_P2P)throw e}}))).then(t).catch(n)})),this._p2pChannel.on(XM.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===HM.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(XM.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(XM.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(XM.MediaReconnectStart,(e=>{this.safeEmit(WI.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(XM.MediaReconnectEnd,(e=>{this.safeEmit(WI.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(XM.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(XM.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(XM.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(XM.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),s=Jj(i,o);await this._p2pChannel.connect(s),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(XM.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(XM.P2PLost,(()=>{this.safeEmit(WI.P2P_LOST,this.store.uid)})),this._p2pChannel.on(XM.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(XM.ConnectionTypeChange,(e=>{this.safeEmit(WI.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(XM.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(XM.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(XM.AudioMetadata,(e=>{this.safeEmit(WI.AUDIO_METADATA,e)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},SU("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:o,token:s,uid:a,cid:c,vid:l}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:o,token:s,uid:a,cid:c,vid:l?Number(l):0},Ax)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(ZM.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(WI.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===JM.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(WI.CONTENT_INSPECT_ERROR,new tk(mI.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(ZM.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===mI.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return qO.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(WI.CONTENT_INSPECT_RESULT,e,t)})),e.on(ZM.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}async disableContentInspect(){if(!this._inspect)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(vI(e,"enabled"),e){if(!t)throw new tk(mI.INVALID_PARAMS,"config is required");if(GB(t),!this._joinInfo)throw new tk(mI.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},SU("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:r,cname:i,sid:o,token:s,uid:a,cid:c,vid:l}=this._joinInfo;await e.init({appId:r,areaCode:"",cname:i,sid:o,token:s,uid:a,cid:c,vid:l?Number(l):0},Ax)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new tk(mI.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(rj.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(WI.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===nj.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new tk(mI.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(rj.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}setP2PTransport(e){if(function(e){yI(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new tk(mI.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,qO.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return qO.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){vI(e,"enabled"),pO("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},iM(DW.prototype,"leave",[KB],Object.getOwnPropertyDescriptor(DW.prototype,"leave"),DW.prototype),iM(DW.prototype,"publish",[$B],Object.getOwnPropertyDescriptor(DW.prototype,"publish"),DW.prototype),iM(DW.prototype,"unpublish",[YB],Object.getOwnPropertyDescriptor(DW.prototype,"unpublish"),DW.prototype),iM(DW.prototype,"subscribe",[XB],Object.getOwnPropertyDescriptor(DW.prototype,"subscribe"),DW.prototype),iM(DW.prototype,"presubscribe",[JB],Object.getOwnPropertyDescriptor(DW.prototype,"presubscribe"),DW.prototype),iM(DW.prototype,"massSubscribe",[QB],Object.getOwnPropertyDescriptor(DW.prototype,"massSubscribe"),DW.prototype),iM(DW.prototype,"unsubscribe",[ZB],Object.getOwnPropertyDescriptor(DW.prototype,"unsubscribe"),DW.prototype),iM(DW.prototype,"massUnsubscribe",[eW],Object.getOwnPropertyDescriptor(DW.prototype,"massUnsubscribe"),DW.prototype),iM(DW.prototype,"setLowStreamParameter",[tW],Object.getOwnPropertyDescriptor(DW.prototype,"setLowStreamParameter"),DW.prototype),iM(DW.prototype,"enableDualStream",[nW],Object.getOwnPropertyDescriptor(DW.prototype,"enableDualStream"),DW.prototype),iM(DW.prototype,"disableDualStream",[rW],Object.getOwnPropertyDescriptor(DW.prototype,"disableDualStream"),DW.prototype),iM(DW.prototype,"setClientRole",[iW],Object.getOwnPropertyDescriptor(DW.prototype,"setClientRole"),DW.prototype),iM(DW.prototype,"_setClientRoleOptions",[oW],Object.getOwnPropertyDescriptor(DW.prototype,"_setClientRoleOptions"),DW.prototype),iM(DW.prototype,"setProxyServer",[sW],Object.getOwnPropertyDescriptor(DW.prototype,"setProxyServer"),DW.prototype),iM(DW.prototype,"setTurnServer",[aW],Object.getOwnPropertyDescriptor(DW.prototype,"setTurnServer"),DW.prototype),iM(DW.prototype,"setLicense",[cW],Object.getOwnPropertyDescriptor(DW.prototype,"setLicense"),DW.prototype),iM(DW.prototype,"startProxyServer",[lW],Object.getOwnPropertyDescriptor(DW.prototype,"startProxyServer"),DW.prototype),iM(DW.prototype,"stopProxyServer",[uW],Object.getOwnPropertyDescriptor(DW.prototype,"stopProxyServer"),DW.prototype),iM(DW.prototype,"setLocalAccessPointsV2",[dW],Object.getOwnPropertyDescriptor(DW.prototype,"setLocalAccessPointsV2"),DW.prototype),iM(DW.prototype,"setLocalAccessPoints",[hW],Object.getOwnPropertyDescriptor(DW.prototype,"setLocalAccessPoints"),DW.prototype),iM(DW.prototype,"setRemoteDefaultVideoStreamType",[pW],Object.getOwnPropertyDescriptor(DW.prototype,"setRemoteDefaultVideoStreamType"),DW.prototype),iM(DW.prototype,"setRemoteVideoStreamType",[fW],Object.getOwnPropertyDescriptor(DW.prototype,"setRemoteVideoStreamType"),DW.prototype),iM(DW.prototype,"setStreamFallbackOption",[mW],Object.getOwnPropertyDescriptor(DW.prototype,"setStreamFallbackOption"),DW.prototype),iM(DW.prototype,"setEncryptionConfig",[gW],Object.getOwnPropertyDescriptor(DW.prototype,"setEncryptionConfig"),DW.prototype),iM(DW.prototype,"renewToken",[vW],Object.getOwnPropertyDescriptor(DW.prototype,"renewToken"),DW.prototype),iM(DW.prototype,"enableAudioVolumeIndicator",[yW],Object.getOwnPropertyDescriptor(DW.prototype,"enableAudioVolumeIndicator"),DW.prototype),iM(DW.prototype,"startLiveStreaming",[_W],Object.getOwnPropertyDescriptor(DW.prototype,"startLiveStreaming"),DW.prototype),iM(DW.prototype,"setLiveTranscoding",[EW],Object.getOwnPropertyDescriptor(DW.prototype,"setLiveTranscoding"),DW.prototype),iM(DW.prototype,"stopLiveStreaming",[bW],Object.getOwnPropertyDescriptor(DW.prototype,"stopLiveStreaming"),DW.prototype),iM(DW.prototype,"startChannelMediaRelay",[wW],Object.getOwnPropertyDescriptor(DW.prototype,"startChannelMediaRelay"),DW.prototype),iM(DW.prototype,"updateChannelMediaRelay",[SW],Object.getOwnPropertyDescriptor(DW.prototype,"updateChannelMediaRelay"),DW.prototype),iM(DW.prototype,"stopChannelMediaRelay",[TW],Object.getOwnPropertyDescriptor(DW.prototype,"stopChannelMediaRelay"),DW.prototype),iM(DW.prototype,"sendCustomReportMessage",[CW],Object.getOwnPropertyDescriptor(DW.prototype,"sendCustomReportMessage"),DW.prototype),iM(DW.prototype,"pickSVCLayer",[AW],Object.getOwnPropertyDescriptor(DW.prototype,"pickSVCLayer"),DW.prototype),iM(DW.prototype,"setRTMConfig",[RW],Object.getOwnPropertyDescriptor(DW.prototype,"setRTMConfig"),DW.prototype),iM(DW.prototype,"enableContentInspect",[IW],Object.getOwnPropertyDescriptor(DW.prototype,"enableContentInspect"),DW.prototype),iM(DW.prototype,"disableContentInspect",[xW],Object.getOwnPropertyDescriptor(DW.prototype,"disableContentInspect"),DW.prototype),iM(DW.prototype,"setImageModeration",[OW],Object.getOwnPropertyDescriptor(DW.prototype,"setImageModeration"),DW.prototype),iM(DW.prototype,"setP2PTransport",[kW],Object.getOwnPropertyDescriptor(DW.prototype,"setP2PTransport"),DW.prototype),iM(DW.prototype,"getJoinChannelServiceRecords",[NW],Object.getOwnPropertyDescriptor(DW.prototype,"getJoinChannelServiceRecords"),DW.prototype),iM(DW.prototype,"setPublishAudioFilterEnabled",[PW],Object.getOwnPropertyDescriptor(DW.prototype,"setPublishAudioFilterEnabled"),DW.prototype),DW);class UW{constructor(e,t){JT(this,"id",0),JT(this,"element",void 0),JT(this,"peerPair",void 0),JT(this,"context",void 0),JT(this,"audioPlayerElement",void 0),JT(this,"audioTrack",void 0),UW.count+=1,this.id=UW.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new zh((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new tk(mI.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new tk(mI.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new tk(mI.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){qO.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var VW,FW;JT(UW,"count",0);const BW=window.AudioContext||window.webkitAudioContext,WW=new(VW=ZO({report:ek}),iM((FW=class{constructor(){JT(this,"units",[]),JT(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return qO.debug("the system does not need to process local aec"),-1;this.context||(this.context=new BW);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new UW(e,this.context),this.units.push(t)),t.startEchoCancellation(),qO.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return jR().name!==PR.SAFARI}}).prototype,"processExternalMediaAEC",[VW],Object.getOwnPropertyDescriptor(FW.prototype,"processExternalMediaAEC"),FW.prototype),FW);function zW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zW(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const GW=window||document;function qW(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!GW)return;const n=h$._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(h$.onSecurityPolicyViolation||h$.getListeners(tj.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;fO("CSP_DETECTED_HOSTNAME_LIST").some((e=>Nr(t).call(t,e)))&&(h$.onSecurityPolicyViolation&&"function"==typeof h$.onSecurityPolicyViolation&&h$.onSecurityPolicyViolation(e),h$.getListeners(tj.SECURITY_POLICY_VIOLATION).length>0&&h$.safeEmit(tj.SECURITY_POLICY_VIOLATION,e))};n&&GW.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||h$.getListeners(tj.SECURITY_POLICY_VIOLATION).length>0)&&GW.addEventListener("securitypolicyviolation",r),h$._cspEventHandlerPointer=r}var KW=d,$W=fC,YW=RegExp.prototype,XW=function(e){return e===YW||KW(YW,e)?$W(e):e.flags},JW=r(XW);function QW(e){let t=e.length;for(;--t>=0;)e[t]=0}const ZW=256,ez=286,tz=30,nz=15,rz=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),iz=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),oz=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),sz=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),az=new Array(576);QW(az);const cz=new Array(60);QW(cz);const lz=new Array(512);QW(lz);const uz=new Array(256);QW(uz);const dz=new Array(29);QW(dz);const hz=new Array(tz);function pz(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let fz,mz,gz;function vz(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}QW(hz);const yz=e=>e<256?lz[e]:lz[256+(e>>>7)],_z=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ez=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,_z(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},bz=(e,t,n)=>{Ez(e,n[2*t],n[2*t+1])},wz=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Sz=(e,t,n)=>{const r=new Array(16);let i,o,s=0;for(i=1;i<=nz;i++)s=s+n[i-1]<<1,r[i]=s;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=wz(r[t]++,t))}},Tz=e=>{let t;for(t=0;t<ez;t++)e.dyn_ltree[2*t]=0;for(t=0;t<tz;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Cz=e=>{e.bi_valid>8?_z(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Az=(e,t,n,r)=>{const i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},Rz=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Az(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Az(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},Iz=(e,t,n)=>{let r,i,o,s,a=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+a++],r+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===r?bz(e,i,t):(o=uz[i],bz(e,o+ZW+1,t),s=rz[o],0!==s&&(i-=dz[o],Ez(e,i,s)),r--,o=yz(r),bz(e,o,n),s=iz[o],0!==s&&(r-=hz[o],Ez(e,r,s)))}while(a<e.sym_next);bz(e,256,t)},xz=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==n[2*s]?(e.heap[++e.heap_len]=l=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=l,s=e.heap_len>>1;s>=1;s--)Rz(e,n,s);c=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Rz(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=a,n[2*c]=n[2*s]+n[2*a],e.depth[c]=(e.depth[s]>=e.depth[a]?e.depth[s]:e.depth[a])+1,n[2*s+1]=n[2*a+1]=c,e.heap[1]=c++,Rz(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,u,d,h,p,f,m=0;for(h=0;h<=nz;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)u=e.heap[l],h=n[2*n[2*u+1]+1]+1,h>c&&(h=c,m++),n[2*u+1]=h,u>r||(e.bl_count[h]++,p=0,u>=a&&(p=s[u-a]),f=n[2*u],e.opt_len+=f*(h+p),o&&(e.static_len+=f*(i[2*u+1]+p)));if(0!==m){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(h=c;0!==h;h--)for(u=e.bl_count[h];0!==u;)d=e.heap[--l],d>r||(n[2*d+1]!==h&&(e.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),u--)}})(e,t),Sz(n,l,e.bl_count)},Oz=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<c&&i===s||(a<l?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4))},kz=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<c&&i===s)){if(a<l)do{bz(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(bz(e,i,e.bl_tree),a--),bz(e,16,e.bl_tree),Ez(e,a-3,2)):a<=10?(bz(e,17,e.bl_tree),Ez(e,a-3,3)):(bz(e,18,e.bl_tree),Ez(e,a-11,7));a=0,o=i,0===s?(c=138,l=3):i===s?(c=6,l=3):(c=7,l=4)}};let Nz=!1;const Pz=(e,t,n,r)=>{Ez(e,0+(r?1:0),3),Cz(e),_z(e,n),_z(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Dz=e=>{Nz||((()=>{let e,t,n,r,i;const o=new Array(16);for(n=0,r=0;r<28;r++)for(dz[r]=n,e=0;e<1<<rz[r];e++)uz[n++]=r;for(uz[n-1]=r,i=0,r=0;r<16;r++)for(hz[r]=i,e=0;e<1<<iz[r];e++)lz[i++]=r;for(i>>=7;r<tz;r++)for(hz[r]=i<<7,e=0;e<1<<iz[r]-7;e++)lz[256+i++]=r;for(t=0;t<=nz;t++)o[t]=0;for(e=0;e<=143;)az[2*e+1]=8,e++,o[8]++;for(;e<=255;)az[2*e+1]=9,e++,o[9]++;for(;e<=279;)az[2*e+1]=7,e++,o[7]++;for(;e<=287;)az[2*e+1]=8,e++,o[8]++;for(Sz(az,287,o),e=0;e<tz;e++)cz[2*e+1]=5,cz[2*e]=wz(e,5);fz=new pz(az,rz,257,ez,nz),mz=new pz(cz,iz,0,tz,nz),gz=new pz(new Array(0),oz,0,19,7)})(),Nz=!0),e.l_desc=new vz(e.dyn_ltree,fz),e.d_desc=new vz(e.dyn_dtree,mz),e.bl_desc=new vz(e.bl_tree,gz),e.bi_buf=0,e.bi_valid=0,Tz(e)},Lz=(e,t,n,r)=>{let i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<ZW;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),xz(e,e.l_desc),xz(e,e.d_desc),s=(e=>{let t;for(Oz(e,e.dyn_ltree,e.l_desc.max_code),Oz(e,e.dyn_dtree,e.d_desc.max_code),xz(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*sz[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?Pz(e,t,n,r):4===e.strategy||o===i?(Ez(e,2+(r?1:0),3),Iz(e,az,cz)):(Ez(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(Ez(e,t-257,5),Ez(e,n-1,5),Ez(e,r-4,4),i=0;i<r;i++)Ez(e,e.bl_tree[2*sz[i]+1],3);kz(e,e.dyn_ltree,t-1),kz(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Iz(e,e.dyn_ltree,e.dyn_dtree)),Tz(e),r&&Cz(e)},Mz=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(uz[n]+ZW+1)]++,e.dyn_dtree[2*yz(t)]++),e.sym_next===e.sym_end),jz=e=>{Ez(e,2,3),bz(e,256,az),(e=>{16===e.bi_valid?(_z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},Uz={_tr_init:Dz,_tr_stored_block:Pz,_tr_flush_block:Lz,_tr_tally:Mz,_tr_align:jz},Vz=(e,t,n,r)=>{let i=65535&e,o=e>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+t[r++]|0,o=o+i|0}while(--s);i%=65521,o%=65521}return i|o<<16};const Fz=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Bz=(e,t,n,r)=>{const i=Fz,o=r+n;e^=-1;for(let s=r;s<o;s++)e=e>>>8^i[255&(e^t[s])];return~e},Wz={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},zz={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Hz,_tr_stored_block:Gz,_tr_flush_block:qz,_tr_tally:Kz,_tr_align:$z}=Uz,{Z_NO_FLUSH:Yz,Z_PARTIAL_FLUSH:Xz,Z_FULL_FLUSH:Jz,Z_FINISH:Qz,Z_BLOCK:Zz,Z_OK:eH,Z_STREAM_END:tH,Z_STREAM_ERROR:nH,Z_DATA_ERROR:rH,Z_BUF_ERROR:iH,Z_DEFAULT_COMPRESSION:oH,Z_FILTERED:sH,Z_HUFFMAN_ONLY:aH,Z_RLE:cH,Z_FIXED:lH,Z_DEFAULT_STRATEGY:uH,Z_UNKNOWN:dH,Z_DEFLATED:hH}=zz,pH=286,fH=30,mH=19,gH=2*pH+1,vH=15,yH=258,_H=262,EH=42,bH=113,wH=666,SH=(e,t)=>(e.msg=Wz[t],t),TH=e=>2*e-(e>4?9:0),CH=e=>{let t=e.length;for(;--t>=0;)e[t]=0},AH=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let RH=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const IH=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},xH=(e,t)=>{qz(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,IH(e.strm)},OH=(e,t)=>{e.pending_buf[e.pending++]=t},kH=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},NH=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=Vz(e.adler,t,i,n):2===e.state.wrap&&(e.adler=Bz(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},PH=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-_H?e.strstart-(e.w_size-_H):0,l=e.window,u=e.w_mask,d=e.prev,h=e.strstart+yH;let p=l[o+s-1],f=l[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,l[n+s]===f&&l[n+s-1]===p&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<h);if(r=yH-(h-o),o=h-yH,r>s){if(e.match_start=t,s=r,r>=a)break;p=l[o+s-1],f=l[o+s]}}}while((t=d[t&u])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead},DH=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-_H)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),AH(e),r+=t),0===e.strm.avail_in)break;if(n=NH(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=RH(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=RH(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_H&&0!==e.strm.avail_in)},LH=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==Qz||t===Yz||n!==r+e.strm.avail_in))break;s=t===Qz&&n===r+e.strm.avail_in?1:0,Gz(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,IH(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(NH(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Yz&&t!==Qz&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(NH(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===Qz)&&t!==Yz&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===Qz&&0===e.strm.avail_in&&n===r?1:0,Gz(e,e.block_start,n,s),e.block_start+=n,IH(e.strm)),s?3:1)},MH=(e,t)=>{let n,r;for(;;){if(e.lookahead<_H){if(DH(e),e.lookahead<_H&&t===Yz)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=RH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-_H&&(e.match_length=PH(e,n)),e.match_length>=3)if(r=Kz(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=RH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=RH(e,e.ins_h,e.window[e.strstart+1]);else r=Kz(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(xH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Qz?(xH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(xH(e,!1),0===e.strm.avail_out)?1:2},jH=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<_H){if(DH(e),e.lookahead<_H&&t===Yz)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=RH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-_H&&(e.match_length=PH(e,n),e.match_length<=5&&(e.strategy===sH||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Kz(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=RH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(xH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=Kz(e,0,e.window[e.strstart-1]),r&&xH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Kz(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Qz?(xH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(xH(e,!1),0===e.strm.avail_out)?1:2};function UH(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const VH=[new UH(0,0,0,0,LH),new UH(4,4,8,4,MH),new UH(4,5,16,8,MH),new UH(4,6,32,32,MH),new UH(4,4,16,16,jH),new UH(8,16,32,32,jH),new UH(8,16,128,128,jH),new UH(8,32,128,256,jH),new UH(32,128,258,1024,jH),new UH(32,258,258,4096,jH)];function FH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=hH,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*gH),this.dyn_dtree=new Uint16Array(2*(2*fH+1)),this.bl_tree=new Uint16Array(2*(2*mH+1)),CH(this.dyn_ltree),CH(this.dyn_dtree),CH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(vH+1),this.heap=new Uint16Array(2*pH+1),CH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*pH+1),CH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const BH=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==EH&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==bH&&t.status!==wH?1:0},WH=e=>{if(BH(e))return SH(e,nH);e.total_in=e.total_out=0,e.data_type=dH;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?EH:bH,e.adler=2===t.wrap?0:1,t.last_flush=-2,Hz(t),eH},zH=e=>{const t=WH(e);return t===eH&&(e=>{e.window_size=2*e.w_size,CH(e.head),e.max_lazy_match=VH[e.level].max_lazy,e.good_match=VH[e.level].good_length,e.nice_match=VH[e.level].nice_length,e.max_chain_length=VH[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},HH=(e,t,n,r,i,o)=>{if(!e)return nH;let s=1;if(t===oH&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==hH||r<8||r>15||t<0||t>9||o<0||o>lH||8===r&&1!==s)return SH(e,nH);8===r&&(r=9);const a=new FH;return e.state=a,a.strm=e,a.status=EH,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=n,zH(e)};var GH=(e,t)=>{if(BH(e)||t>Zz||t<0)return e?SH(e,nH):nH;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===wH&&t!==Qz)return SH(e,0===e.avail_out?iH:nH);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(IH(e),0===e.avail_out)return n.last_flush=-1,eH}else if(0===e.avail_in&&TH(t)<=TH(r)&&t!==Qz)return SH(e,iH);if(n.status===wH&&0!==e.avail_in)return SH(e,iH);if(n.status===EH&&0===n.wrap&&(n.status=bH),n.status===EH){let t=hH+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=aH||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,kH(n,t),0!==n.strstart&&(kH(n,e.adler>>>16),kH(n,65535&e.adler)),e.adler=1,n.status=bH,IH(e),0!==n.pending)return n.last_flush=-1,eH}if(57===n.status)if(e.adler=0,OH(n,31),OH(n,139),OH(n,8),n.gzhead)OH(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),OH(n,255&n.gzhead.time),OH(n,n.gzhead.time>>8&255),OH(n,n.gzhead.time>>16&255),OH(n,n.gzhead.time>>24&255),OH(n,9===n.level?2:n.strategy>=aH||n.level<2?4:0),OH(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(OH(n,255&n.gzhead.extra.length),OH(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Bz(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(OH(n,0),OH(n,0),OH(n,0),OH(n,0),OH(n,0),OH(n,9===n.level?2:n.strategy>=aH||n.level<2?4:0),OH(n,3),n.status=bH,IH(e),0!==n.pending)return n.last_flush=-1,eH;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=Bz(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,IH(e),0!==n.pending)return n.last_flush=-1,eH;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=Bz(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Bz(e.adler,n.pending_buf,n.pending-r,r)),IH(e),0!==n.pending)return n.last_flush=-1,eH;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,OH(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Bz(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Bz(e.adler,n.pending_buf,n.pending-r,r)),IH(e),0!==n.pending)return n.last_flush=-1,eH;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,OH(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Bz(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(IH(e),0!==n.pending))return n.last_flush=-1,eH;OH(n,255&e.adler),OH(n,e.adler>>8&255),e.adler=0}if(n.status=bH,IH(e),0!==n.pending)return n.last_flush=-1,eH}if(0!==e.avail_in||0!==n.lookahead||t!==Yz&&n.status!==wH){let r=0===n.level?LH(n,t):n.strategy===aH?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(DH(e),0===e.lookahead)){if(t===Yz)return 1;break}if(e.match_length=0,n=Kz(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(xH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Qz?(xH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(xH(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===cH?((e,t)=>{let n,r,i,o;const s=e.window;for(;;){if(e.lookahead<=yH){if(DH(e),e.lookahead<=yH&&t===Yz)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){o=e.strstart+yH;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=yH-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Kz(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Kz(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(xH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Qz?(xH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(xH(e,!1),0===e.strm.avail_out)?1:2})(n,t):VH[n.level].func(n,t);if(3!==r&&4!==r||(n.status=wH),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),eH;if(2===r&&(t===Xz?$z(n):t!==Zz&&(Gz(n,0,0,!1),t===Jz&&(CH(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),IH(e),0===e.avail_out))return n.last_flush=-1,eH}return t!==Qz?eH:n.wrap<=0?tH:(2===n.wrap?(OH(n,255&e.adler),OH(n,e.adler>>8&255),OH(n,e.adler>>16&255),OH(n,e.adler>>24&255),OH(n,255&e.total_in),OH(n,e.total_in>>8&255),OH(n,e.total_in>>16&255),OH(n,e.total_in>>24&255)):(kH(n,e.adler>>>16),kH(n,65535&e.adler)),IH(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?eH:tH)},qH=(e,t)=>{let n=t.length;if(BH(e))return nH;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==EH||r.lookahead)return nH;if(1===i&&(e.adler=Vz(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(CH(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,DH(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=RH(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,DH(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,r.wrap=i,eH},KH={deflateInit:(e,t)=>HH(e,t,hH,15,8,uH),deflateInit2:HH,deflateReset:zH,deflateResetKeep:WH,deflateSetHeader:(e,t)=>BH(e)||2!==e.state.wrap?nH:(e.state.gzhead=t,eH),deflate:GH,deflateEnd:e=>{if(BH(e))return nH;const t=e.state.status;return e.state=null,t===bH?SH(e,rH):eH},deflateSetDictionary:qH,deflateInfo:"pako deflate (from Nodeca project)"};const $H=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var YH={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)$H(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,o=e.length;r<o;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let XH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){XH=!1}const JH=new Uint8Array(256);for(let n=0;n<256;n++)JH[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;JH[254]=JH[254]=1;var QH={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,o,s=e.length,a=0;for(i=0;i<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let s=JH[t];if(s>4)o[i++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&XH)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+JH[e[n]]>t?n:t}},ZH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const eG=Object.prototype.toString,{Z_NO_FLUSH:tG,Z_SYNC_FLUSH:nG,Z_FULL_FLUSH:rG,Z_FINISH:iG,Z_OK:oG,Z_STREAM_END:sG,Z_DEFAULT_COMPRESSION:aG,Z_DEFAULT_STRATEGY:cG,Z_DEFLATED:lG}=zz;function uG(e){this.options=YH.assign({level:aG,method:lG,chunkSize:16384,windowBits:15,memLevel:8,strategy:cG},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZH,this.strm.avail_out=0;let n=KH.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==oG)throw new Error(Wz[n]);if(t.header&&KH.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?QH.string2buf(t.dictionary):"[object ArrayBuffer]"===eG.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=KH.deflateSetDictionary(this.strm,e),n!==oG)throw new Error(Wz[n]);this._dict_set=!0}}function dG(e,t){const n=new uG(t);if(n.push(e,!0),n.err)throw n.msg||Wz[n.err];return n.result}uG.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?iG:tG,"string"==typeof e?n.input=QH.string2buf(e):"[object ArrayBuffer]"===eG.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===nG||o===rG)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=KH.deflate(n,o),i===sG)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=KH.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===oG;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},uG.prototype.onData=function(e){this.chunks.push(e)},uG.prototype.onEnd=function(e){e===oG&&(this.result=YH.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var hG={Deflate:uG,deflate:dG,deflateRaw:function(e,t){return(t=t||{}).raw=!0,dG(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,dG(e,t)},constants:zz};const pG=16209;var fG=function(e,t){let n,r,i,o,s,a,c,l,u,d,h,p,f,m,g,v,y,_,E,b,w,S,T,C;const A=e.state;n=e.next_in,T=e.input,r=n+(e.avail_in-5),i=e.next_out,C=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),a=A.dmax,c=A.wsize,l=A.whave,u=A.wnext,d=A.window,h=A.hold,p=A.bits,f=A.lencode,m=A.distcode,g=(1<<A.lenbits)-1,v=(1<<A.distbits)-1;e:do{p<15&&(h+=T[n++]<<p,p+=8,h+=T[n++]<<p,p+=8),y=f[h&g];t:for(;;){if(_=y>>>24,h>>>=_,p-=_,_=y>>>16&255,0===_)C[i++]=65535&y;else{if(!(16&_)){if(0==(64&_)){y=f[(65535&y)+(h&(1<<_)-1)];continue t}if(32&_){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=pG;break e}E=65535&y,_&=15,_&&(p<_&&(h+=T[n++]<<p,p+=8),E+=h&(1<<_)-1,h>>>=_,p-=_),p<15&&(h+=T[n++]<<p,p+=8,h+=T[n++]<<p,p+=8),y=m[h&v];n:for(;;){if(_=y>>>24,h>>>=_,p-=_,_=y>>>16&255,!(16&_)){if(0==(64&_)){y=m[(65535&y)+(h&(1<<_)-1)];continue n}e.msg="invalid distance code",A.mode=pG;break e}if(b=65535&y,_&=15,p<_&&(h+=T[n++]<<p,p+=8,p<_&&(h+=T[n++]<<p,p+=8)),b+=h&(1<<_)-1,b>a){e.msg="invalid distance too far back",A.mode=pG;break e}if(h>>>=_,p-=_,_=i-o,b>_){if(_=b-_,_>l&&A.sane){e.msg="invalid distance too far back",A.mode=pG;break e}if(w=0,S=d,0===u){if(w+=c-_,_<E){E-=_;do{C[i++]=d[w++]}while(--_);w=i-b,S=C}}else if(u<_){if(w+=c+u-_,_-=u,_<E){E-=_;do{C[i++]=d[w++]}while(--_);if(w=0,u<E){_=u,E-=_;do{C[i++]=d[w++]}while(--_);w=i-b,S=C}}}else if(w+=u-_,_<E){E-=_;do{C[i++]=d[w++]}while(--_);w=i-b,S=C}for(;E>2;)C[i++]=S[w++],C[i++]=S[w++],C[i++]=S[w++],E-=3;E&&(C[i++]=S[w++],E>1&&(C[i++]=S[w++]))}else{w=i-b;do{C[i++]=C[w++],C[i++]=C[w++],C[i++]=C[w++],E-=3}while(E>2);E&&(C[i++]=C[w++],E>1&&(C[i++]=C[w++]))}break}}break}}while(n<r&&i<s);E=p>>3,n-=E,p-=E<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),A.hold=h,A.bits=p};const mG=15,gG=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vG=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yG=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_G=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var EG=(e,t,n,r,i,o,s,a)=>{const c=a.bits;let l,u,d,h,p,f,m=0,g=0,v=0,y=0,_=0,E=0,b=0,w=0,S=0,T=0,C=null;const A=new Uint16Array(16),R=new Uint16Array(16);let I,x,O,k=null;for(m=0;m<=mG;m++)A[m]=0;for(g=0;g<r;g++)A[t[n+g]]++;for(_=c,y=mG;y>=1&&0===A[y];y--);if(_>y&&(_=y),0===y)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(v=1;v<y&&0===A[v];v++);for(_<v&&(_=v),w=1,m=1;m<=mG;m++)if(w<<=1,w-=A[m],w<0)return-1;if(w>0&&(0===e||1!==y))return-1;for(R[1]=0,m=1;m<mG;m++)R[m+1]=R[m]+A[m];for(g=0;g<r;g++)0!==t[n+g]&&(s[R[t[n+g]]++]=g);if(0===e?(C=k=s,f=20):1===e?(C=gG,k=vG,f=257):(C=yG,k=_G,f=0),T=0,g=0,m=v,p=o,E=_,b=0,d=-1,S=1<<_,h=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){I=m-b,s[g]+1<f?(x=0,O=s[g]):s[g]>=f?(x=k[s[g]-f],O=C[s[g]-f]):(x=96,O=0),l=1<<m-b,u=1<<E,v=u;do{u-=l,i[p+(T>>b)+u]=I<<24|x<<16|O}while(0!==u);for(l=1<<m-1;T&l;)l>>=1;if(0!==l?(T&=l-1,T+=l):T=0,g++,0==--A[m]){if(m===y)break;m=t[n+s[g]]}if(m>_&&(T&h)!==d){for(0===b&&(b=_),p+=v,E=m-b,w=1<<E;E+b<y&&(w-=A[E+b],!(w<=0));)E++,w<<=1;if(S+=1<<E,1===e&&S>852||2===e&&S>592)return 1;d=T&h,i[d]=_<<24|E<<16|p-o}}return 0!==T&&(i[p+T]=m-b<<24|64<<16),a.bits=_,0};const{Z_FINISH:bG,Z_BLOCK:wG,Z_TREES:SG,Z_OK:TG,Z_STREAM_END:CG,Z_NEED_DICT:AG,Z_STREAM_ERROR:RG,Z_DATA_ERROR:IG,Z_MEM_ERROR:xG,Z_BUF_ERROR:OG,Z_DEFLATED:kG}=zz,NG=16180,PG=16190,DG=16191,LG=16192,MG=16194,jG=16199,UG=16200,VG=16206,FG=16209,BG=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function WG(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const zG=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<NG||t.mode>16211?1:0},HG=e=>{if(zG(e))return RG;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=NG,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,TG},GG=e=>{if(zG(e))return RG;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,HG(e)},qG=(e,t)=>{let n;if(zG(e))return RG;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?RG:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,GG(e))},KG=(e,t)=>{if(!e)return RG;const n=new WG;e.state=n,n.strm=e,n.window=null,n.mode=NG;const r=qG(e,t);return r!==TG&&(e.state=null),r};let $G,YG,XG=!0;const JG=e=>{if(XG){$G=new Int32Array(512),YG=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(EG(1,e.lens,0,288,$G,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;EG(2,e.lens,0,32,YG,0,e.work,{bits:5}),XG=!1}e.lencode=$G,e.lenbits=9,e.distcode=YG,e.distbits=5},QG=(e,t,n,r)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var ZG=(e,t)=>{let n,r,i,o,s,a,c,l,u,d,h,p,f,m,g,v,y,_,E,b,w,S,T=0;const C=new Uint8Array(4);let A,R;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(zG(e)||!e.output||!e.input&&0!==e.avail_in)return RG;n=e.state,n.mode===DG&&(n.mode=LG),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,l=n.hold,u=n.bits,d=a,h=c,S=TG;e:for(;;)switch(n.mode){case NG:if(0===n.wrap){n.mode=LG;break}for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&l,C[1]=l>>>8&255,n.check=Bz(n.check,C,2,0),l=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=FG;break}if((15&l)!==kG){e.msg="unknown compression method",n.mode=FG;break}if(l>>>=4,u-=4,w=8+(15&l),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=FG;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:DG,l=0,u=0;break;case 16181:for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(n.flags=l,(255&JW(n))!==kG){e.msg="unknown compression method",n.mode=FG;break}if(57344&JW(n)){e.msg="unknown header flags set",n.mode=FG;break}n.head&&(n.head.text=l>>8&1),512&JW(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=Bz(n.check,C,2,0)),l=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.head&&(n.head.time=l),512&JW(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,n.check=Bz(n.check,C,4,0)),l=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&JW(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=Bz(n.check,C,2,0)),l=0,u=0,n.mode=16184;case 16184:if(1024&JW(n)){for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&JW(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=Bz(n.check,C,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&JW(n)&&(p=n.length,p>a&&(p=a),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+p),w)),512&JW(n)&&4&n.wrap&&(n.check=Bz(n.check,r,p,o)),a-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&JW(n)){if(0===a)break e;p=0;do{w=r[o+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<a);if(512&JW(n)&&4&n.wrap&&(n.check=Bz(n.check,r,p,o)),a-=p,o+=p,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&JW(n)){if(0===a)break e;p=0;do{w=r[o+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<a);if(512&JW(n)&&4&n.wrap&&(n.check=Bz(n.check,r,p,o)),a-=p,o+=p,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&JW(n)){for(;u<16;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=FG;break}l=0,u=0}n.head&&(n.head.hcrc=JW(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=DG;break;case 16189:for(;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}e.adler=n.check=BG(l),l=0,u=0,n.mode=PG;case PG:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,AG;e.adler=n.check=1,n.mode=DG;case DG:if(t===wG||t===SG)break e;case LG:if(n.last){l>>>=7&u,u-=7&u,n.mode=VG;break}for(;u<3;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}switch(n.last=1&l,l>>>=1,u-=1,3&l){case 0:n.mode=16193;break;case 1:if(JG(n),n.mode=jG,t===SG){l>>>=2,u-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=FG}l>>>=2,u-=2;break;case 16193:for(l>>>=7&u,u-=7&u;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=FG;break}if(n.length=65535&l,l=0,u=0,n.mode=MG,t===SG)break e;case MG:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;i.set(r.subarray(o,o+p),s),a-=p,o+=p,c-=p,s+=p,n.length-=p;break}n.mode=DG;break;case 16196:for(;u<14;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=FG;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.lens[I[n.have++]]=7&l,l>>>=3,u-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},S=EG(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,S){e.msg="invalid code lengths set",n.mode=FG;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;T=n.lencode[l&(1<<n.lenbits)-1],g=T>>>24,v=T>>>16&255,y=65535&T,!(g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(y<16)l>>>=g,u-=g,n.lens[n.have++]=y;else{if(16===y){for(R=g+2;u<R;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(l>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=FG;break}w=n.lens[n.have-1],p=3+(3&l),l>>>=2,u-=2}else if(17===y){for(R=g+3;u<R;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=g,u-=g,w=0,p=3+(7&l),l>>>=3,u-=3}else{for(R=g+7;u<R;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=g,u-=g,w=0,p=11+(127&l),l>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=FG;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===FG)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=FG;break}if(n.lenbits=9,A={bits:n.lenbits},S=EG(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,S){e.msg="invalid literal/lengths set",n.mode=FG;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},S=EG(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,S){e.msg="invalid distances set",n.mode=FG;break}if(n.mode=jG,t===SG)break e;case jG:n.mode=UG;case UG:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,fG(e,h),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,l=n.hold,u=n.bits,n.mode===DG&&(n.back=-1);break}for(n.back=0;T=n.lencode[l&(1<<n.lenbits)-1],g=T>>>24,v=T>>>16&255,y=65535&T,!(g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(v&&0==(240&v)){for(_=g,E=v,b=y;T=n.lencode[b+((l&(1<<_+E)-1)>>_)],g=T>>>24,v=T>>>16&255,y=65535&T,!(_+g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=_,u-=_,n.back+=_}if(l>>>=g,u-=g,n.back+=g,n.length=y,0===v){n.mode=16205;break}if(32&v){n.back=-1,n.mode=DG;break}if(64&v){e.msg="invalid literal/length code",n.mode=FG;break}n.extra=15&v,n.mode=16201;case 16201:if(n.extra){for(R=n.extra;u<R;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;T=n.distcode[l&(1<<n.distbits)-1],g=T>>>24,v=T>>>16&255,y=65535&T,!(g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(0==(240&v)){for(_=g,E=v,b=y;T=n.distcode[b+((l&(1<<_+E)-1)>>_)],g=T>>>24,v=T>>>16&255,y=65535&T,!(_+g<=u);){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}l>>>=_,u-=_,n.back+=_}if(l>>>=g,u-=g,n.back+=g,64&v){e.msg="invalid distance code",n.mode=FG;break}n.offset=y,n.extra=15&v,n.mode=16203;case 16203:if(n.extra){for(R=n.extra;u<R;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=FG;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=FG;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,f=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[s++]=m[f++]}while(--p);0===n.length&&(n.mode=UG);break;case 16205:if(0===c)break e;i[s++]=n.length,c--,n.mode=UG;break;case VG:if(n.wrap){for(;u<32;){if(0===a)break e;a--,l|=r[o++]<<u,u+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=JW(n)?Bz(n.check,i,h,s-h):Vz(n.check,i,h,s-h)),h=c,4&n.wrap&&(JW(n)?l:BG(l))!==n.check){e.msg="incorrect data check",n.mode=FG;break}l=0,u=0}n.mode=16207;case 16207:if(n.wrap&&JW(n)){for(;u<32;){if(0===a)break e;a--,l+=r[o++]<<u,u+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=FG;break}l=0,u=0}n.mode=16208;case 16208:S=CG;break e;case FG:S=IG;break e;case 16210:return xG;default:return RG}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,(n.wsize||h!==e.avail_out&&n.mode<FG&&(n.mode<VG||t!==bG))&&QG(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=JW(n)?Bz(n.check,i,h,e.next_out-h):Vz(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===DG?128:0)+(n.mode===jG||n.mode===MG?256:0),(0===d&&0===h||t===bG)&&S===TG&&(S=OG),S},eq={inflateReset:GG,inflateReset2:qG,inflateResetKeep:HG,inflateInit:e=>KG(e,15),inflateInit2:KG,inflate:ZG,inflateEnd:e=>{if(zG(e))return RG;let t=e.state;return t.window&&(t.window=null),e.state=null,TG},inflateGetHeader:(e,t)=>{if(zG(e))return RG;const n=e.state;return 0==(2&n.wrap)?RG:(n.head=t,t.done=!1,TG)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,o;return zG(e)?RG:(r=e.state,0!==r.wrap&&r.mode!==PG?RG:r.mode===PG&&(i=1,i=Vz(i,t,n,0),i!==r.check)?IG:(o=QG(e,t,n,n),o?(r.mode=16210,xG):(r.havedict=1,TG)))},inflateInfo:"pako inflate (from Nodeca project)"},tq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const nq=Object.prototype.toString,{Z_NO_FLUSH:rq,Z_FINISH:iq,Z_OK:oq,Z_STREAM_END:sq,Z_NEED_DICT:aq,Z_STREAM_ERROR:cq,Z_DATA_ERROR:lq,Z_MEM_ERROR:uq}=zz;function dq(e){this.options=YH.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZH,this.strm.avail_out=0;let n=eq.inflateInit2(this.strm,t.windowBits);if(n!==oq)throw new Error(Wz[n]);if(this.header=new tq,eq.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=QH.string2buf(t.dictionary):"[object ArrayBuffer]"===nq.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=eq.inflateSetDictionary(this.strm,t.dictionary),n!==oq)))throw new Error(Wz[n])}function hq(e,t){const n=new dq(t);if(n.push(e),n.err)throw n.msg||Wz[n.err];return n.result}dq.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=t===~~t?t:!0===t?iq:rq,"[object ArrayBuffer]"===nq.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=eq.inflate(n,s),o===aq&&i&&(o=eq.inflateSetDictionary(n,i),o===oq?o=eq.inflate(n,s):o===lq&&(o=aq));n.avail_in>0&&o===sq&&n.state.wrap>0&&0!==e[n.next_in];)eq.inflateReset(n),o=eq.inflate(n,s);switch(o){case cq:case lq:case aq:case uq:return this.onEnd(o),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||o===sq))if("string"===this.options.to){let e=QH.utf8border(n.output,n.next_out),t=n.next_out-e,i=QH.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==oq||0!==a){if(o===sq)return o=eq.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},dq.prototype.onData=function(e){this.chunks.push(e)},dq.prototype.onEnd=function(e){e===oq&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=YH.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var pq={Inflate:dq,inflate:hq,inflateRaw:function(e,t){return(t=t||{}).raw=!0,hq(e,t)},ungzip:hq,constants:zz};const{Deflate:fq,deflate:mq,deflateRaw:gq,gzip:vq}=hG,{Inflate:yq,inflate:_q,inflateRaw:Eq,ungzip:bq}=pq;var wq=mq,Sq=_q,Tq=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Tq||{});class Cq{constructor(){JT(this,"_sequence",0),JT(this,"_startTime",Date.now()),JT(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;fO("SHOW_DATASTREAM2_LOG")&&qO.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),o),o+=e.byteLength}if(r.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let o,s;if(n+=4,fO("SHOW_DATASTREAM2_LOG")&&qO.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){s=this.deserializeExtension(e.slice(n)),n+=2+s.length,o=e.slice(n);let t=!1;if(s.datas.length>0){const e=s.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}o=t?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),o=new Uint8Array(i),s=new DataView(i);let a=0;if(s.setUint8(a++,t),s.setUint8(a++,n),r.forEach((e=>{t?(s.setUint8(a++,e.id),s.setUint8(a++,e.length),o.set(new Uint8Array(e.data),a),a+=e.data.byteLength):(s.setUint8(a++,e.id|e.length<<4),o.set(new Uint8Array(e.data),a),a+=e.data.byteLength)})),a!==n+2)throw Error("serialize extension error, is ".concat(a,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const o=r===Tq.TWO_BYTE,s=[],a=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);o?(e=a.getUint8(c),c++,t=a.getUint8(c),c++):(e=15&a.getUint8(c),t=a.getUint8(c)>>4,c++),t>0&&(n=a.buffer.slice(c+2,c+2+t),c+=n.byteLength),s.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:s}}decompress(e){return Sq(new Uint8Array(e))}compress(e){return wq(new Uint8Array(e))}}const Aq={name:"DataStream",create:(e,t)=>{const n=t?new PD(e):new DD(e);return n.useDataStream(new Cq),n}};class Rq extends kI{constructor(e,t,n){super(),JT(this,"ws",void 0),JT(this,"requestId",1),JT(this,"heartBeatTimer",void 0),JT(this,"joinInfo",void 0),JT(this,"clientId",void 0),JT(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),JT(this,"onClose",(e=>{this.emit("close"),this.dispose()})),JT(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new Cj("cross-channel-".concat(this.clientId),n),this.ws.on(gM.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(gM.CONNECTED,this.onOpen),this.ws.on(gM.ON_MESSAGE,this.onMessage),this.ws.on(gM.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new zh(((t,n)=>{const r=window.setTimeout((()=>{n(new tk(mI.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new tk(mI.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new tk(mI.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new tk(mI.WS_DISCONNECT);const t=()=>new zh(((e,t)=>{this.ws.once(gM.CLOSED,(()=>t(new tk(mI.WS_ABORT)))),this.ws.once(gM.CONNECTED,e)}));"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new zh(((e,t)=>{const r=()=>{t(new tk(mI.WS_ABORT))};this.ws.once(gM.RECONNECTING,r),this.ws.once(gM.CLOSED,r),this.once("req_".concat(n),e),dx(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(gM.RECONNECTING,r),this.ws.off(gM.CLOSED,r),t(new tk(mI.TIMEOUT,"cross channel ws request timeout"))}))})),i=await r;if(!i||200!==i.code)throw new tk(mI.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(gM.REQUEST_NEW_URLS),this.ws.on(gM.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Iq extends kI{set state(e){e!==this._state&&(e!==OM.RELAY_STATE_FAILURE&&(this.errorCode=kM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),JT(this,"joinInfo",void 0),JT(this,"sid",void 0),JT(this,"clientId",void 0),JT(this,"cancelToken",AR.CancelToken.source()),JT(this,"workerToken",void 0),JT(this,"requestId",0),JT(this,"signal",void 0),JT(this,"prevChannelMediaConfig",void 0),JT(this,"httpRetryConfig",void 0),JT(this,"_resolution",void 0),JT(this,"_state",OM.RELAY_STATE_IDLE),JT(this,"errorCode",kM.RELAY_OK),JT(this,"onStatus",(e=>{qO.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",xM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",xM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=kM.SRC_TOKEN_EXPIRED,this.state=OM.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=kM.DEST_TOKEN_EXPIRED,this.state=OM.RELAY_STATE_FAILURE))})),JT(this,"onReconnect",(async()=>{qO.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",xM.NETWORK_DISCONNECTED),this.state=OM.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==OM.RELAY_STATE_IDLE&&(qO.error("auto restart channel media relay failed",e.toString()),this.errorCode=kM.SERVER_CONNECTION_LOST,this.state=OM.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=px(),this.signal=new Rq(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==OM.RELAY_STATE_IDLE)throw new tk(mI.INVALID_OPERATION);this.state=OM.RELAY_STATE_CONNECTING,await this.connect(),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new tk(mI.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new tk(mI.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new tk(mI.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==OM.RELAY_STATE_RUNNING)throw new tk(mI.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==OM.RELAY_STATE_RUNNING)throw new tk(mI.INVALID_OPERATION);const t=this.genMessage(IM.SetVideoProfile);await this.signal.request(t),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),qO.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=OM.RELAY_STATE_IDLE,this.dispose()}dispose(){qO.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=AR.CancelToken.source(),this.state=OM.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await dV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",xM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(IM.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(IM.SetSdkProfile,e);await this.signal.request(n),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(IM.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",xM.PACKET_JOINED_SRC_CHANNEL),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(IM.SetSourceUserId,e);await this.signal.request(i),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(IM.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",xM.PACKET_JOINED_DEST_CHANNEL),qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const s=this.genMessage(IM.StartPacketTransfer,e);await this.signal.request(s),this.emit("event",xM.PACKET_SENT_TO_DEST_CHANNEL),this.state=OM.RELAY_STATE_RUNNING,qO.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(IM.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",xM.PACKET_UPDATE_DEST_CHANNEL),qO.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(IM.StopPacketTransfer);await this.signal.request(e),qO.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:iO,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.23.2"===o.sdkVersion&&(o.sdkVersion="0.0.1");let s=null,a=null;switch(e){case IM.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case IM.SetSourceChannel:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new tk(mI.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},o;case IM.SetSourceUserId:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new tk(mI.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:a.uid+""},o;case IM.SetDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new tk(mI.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case IM.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case IM.Reconnect:return o.clientRequest={command:"Reconnect"},o;case IM.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case IM.UpdateDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new tk(mI.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case IM.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const xq={name:"ChannelMediaRelay",create:function(e){return new Iq(e.joinInfo,e.clientId,e.websocketRetryConfig||Ax,e.httpRetryConfig||Ax,e.resolution)}};function Oq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oq(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Nq extends kI{constructor(e,t,n,r){super(),JT(this,"spec",void 0),JT(this,"token",void 0),JT(this,"websocket",void 0),JT(this,"pingpongTimer",void 0),JT(this,"reconnectMode","retry"),JT(this,"serviceMode",void 0),JT(this,"reqId",0),JT(this,"commandReqId",0),JT(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),JT(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(ek.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===_M.TRANSCODE?1:2}),this.emit(TM.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Cj("live-streaming",n),this.websocket.on(gM.CONNECTED,this.handleWebSocketOpen),this.websocket.on(gM.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(gM.REQUEST_NEW_URLS,((e,t)=>{qI(this,TM.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(gM.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new tk(mI.UNEXPECTED_ERROR);const s=kq({command:e,sdkVersion:"4.23.2"===iO?"0.0.1":iO,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new tk(mI.WS_DISCONNECT);const a=()=>new zh(((e,t)=>{this.websocket.once(gM.CLOSED,(()=>t(new tk(mI.WS_ABORT)))),this.websocket.once(gM.CONNECTED,e)}));"connected"!==this.websocket.state&&await a(),s.clientRequest&&(s.clientRequest.workerToken=this.token);const c=new zh(((e,t)=>{const n=()=>{t(new tk(mI.WS_ABORT))};this.websocket.once(gM.RECONNECTING,n),this.websocket.once(gM.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&ek.workerEvent(this.spec.sid,kq(kq({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(s);let u=null;try{u=await c}catch(r){if("closed"===this.websocket.state)throw r;return await a(),await this.request(e,t,n)}return r&&ek.workerEvent(this.spec.sid,kq(kq({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:200===u.code,responseTime:Date.now()-l})),200!==u.code&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.23.2"===iO?"0.0.1":iO;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case AM.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void qO.warning("live stream response already exists stream");case AM.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case AM.LIVE_STREAM_RESPONSE_BAD_STREAM:case AM.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new tk(mI.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case AM.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case AM.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new tk(mI.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case AM.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new tk(mI.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(TM.WARNING,t,e.serverResponse.url)}case AM.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new tk(mI.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(TM.WARNING,t,e.serverResponse.url)}case AM.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case AM.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new tk(mI.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case AM.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new tk(mI.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(TM.WARNING,t,e.serverResponse.url)}case AM.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case AM.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case AM.LIVE_STREAM_RESPONSE_WORKER_LOST:case AM.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case AM.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case AM.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case AM.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case AM.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case AM.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new tk(mI.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(fx)}),6e3)}}function Pq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pq(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Lq extends kI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ax,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ax;super(),JT(this,"onLiveStreamWarning",void 0),JT(this,"onLiveStreamError",void 0),JT(this,"spec",void 0),JT(this,"retryTimeout",1e4),JT(this,"connection",void 0),JT(this,"httpRetryConfig",void 0),JT(this,"wsRetryConfig",void 0),JT(this,"streamingTasks",new Map),JT(this,"isStartingStreamingTask",!1),JT(this,"taskMutex",new Tx("live-streaming")),JT(this,"cancelToken",AR.CancelToken.source()),JT(this,"transcodingConfig",void 0),JT(this,"uapResponse",void 0),JT(this,"lastTaskId",1),JT(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=Dq(Dq({},SM),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(qO.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>Dq(Dq(Dq({},EM),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){SI(e.width)||_I(e.width,"config.width",0,1e4),SI(e.height)||_I(e.height,"config.height",0,1e4),SI(e.videoBitrate)||_I(e.videoBitrate,"config.videoBitrate",1,1e6),SI(e.videoFrameRate)||_I(e.videoFrameRate,"config.videoFrameRate"),SI(e.lowLatency)||vI(e.lowLatency,"config.lowLatency"),SI(e.audioSampleRate)||yI(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),SI(e.audioBitrate)||_I(e.audioBitrate,"config.audioBitrate",1,128),SI(e.audioChannels)||yI(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),SI(e.videoGop)||_I(e.videoGop,"config.videoGop"),SI(e.videoCodecProfile)||yI(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),SI(e.userCount)||_I(e.userCount,"config.userCount",0,17),SI(e.backgroundColor)||_I(e.backgroundColor,"config.backgroundColor",0,16777215),SI(e.userConfigExtraInfo)||bI(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!SI(e.transcodingUsers)&&(wI(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{yM(e.uid),SI(e.x)||_I(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),SI(e.y)||_I(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),SI(e.width)||_I(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),SI(e.height)||_I(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),SI(e.zOrder)||_I(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),SI(e.alpha)||_I(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),SI(e.watermark)||wM(e.watermark,"watermark"),SI(e.backgroundImage)||wM(e.backgroundImage,"backgroundImage"),e.images&&!SI(e.images)&&(wI(e.images,"config.images"),e.images.forEach(((e,t)=>{wM(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>Dq(Dq(Dq({},bM),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(Dq(Dq(Dq({},bM),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(Dq(Dq(Dq({},bM),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>Dq({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?zh.resolve(e.uid):sV(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await zh.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Qh(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});qO.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{qO.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{qO.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{qO.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===_M.TRANSCODE)throw new tk(mI.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};qO.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new tk(mI.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw i(),e}switch(t){case _M.TRANSCODE:r.transcodingConfig=Dq({},this.transcodingConfig);case _M.RAW:}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const s=new zh(((t,r)=>{dx(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),a=await zh.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===_M.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),s]);this.isStartingStreamingTask=!1,qO.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(a.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:o}),i()}catch(r){if(i(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new zh(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new tk(mI.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{qO.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===_M.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{qO.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()})).catch(n)}))}resetAllTask(){var e;const t=Array.from(Qh(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=AR.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new tk(mI.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await qI(this,CM.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new Nq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(TM.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(TM.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(TM.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new tk(mI.UNEXPECTED_ERROR,"can not get new live streaming address list"));qI(this,CM.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case AM.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case AM.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case AM.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case AM.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new tk(mI.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return qO.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case AM.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new tk(mI.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case AM.LIVE_STREAM_RESPONSE_WORKER_LOST:case AM.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(Qh(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(qO.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new tk(mI.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{qO.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{qO.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const Mq={name:"LiveStreaming",create:function(e){return new Lq(e.joinInfo,e.websocketRetryConfig||Ax,e.httpRetryConfig||Ax)}};function jq(e){let t=$q();return function(e,t){let n=e.appId;void 0!==n&&(cK(t,10),tK(t,n));let r=e.cid;void 0!==r&&(cK(t,16),cK(t,r));let i=e.cname;void 0!==i&&(cK(t,26),tK(t,i));let o=e.deviceId;void 0!==o&&(cK(t,34),tK(t,o));let s=e.elapse;void 0!==s&&(cK(t,40),lK(t,s));let a=e.fileSize;void 0!==a&&(cK(t,48),lK(t,qq(a)));let c=e.height;void 0!==c&&(cK(t,56),lK(t,qq(c)));let l=e.jpg;void 0!==l&&(cK(t,66),cK(t,l.length),function(e,t){let n=Qq(e,t.length);e.bytes.set(t,n)}(t,l));let u=e.networkType;void 0!==u&&(cK(t,72),lK(t,qq(u)));let d=e.osType;void 0!==d&&(cK(t,80),lK(t,qq(d)));let h=e.requestId;void 0!==h&&(cK(t,90),tK(t,h));let p=e.sdkVersion;void 0!==p&&(cK(t,98),tK(t,p));let f=e.sequence;void 0!==f&&(cK(t,104),lK(t,qq(f)));let m=e.sid;void 0!==m&&(cK(t,114),tK(t,m));let g=e.timestamp;void 0!==g&&(cK(t,120),lK(t,g));let v=e.uid;void 0!==v&&(cK(t,128),cK(t,v));let y=e.vid;void 0!==y&&(cK(t,136),cK(t,y));let _=e.width;void 0!==_&&(cK(t,144),lK(t,qq(_)));let E=e.service;void 0!==E&&(cK(t,152),cK(t,E));let b=e.callbackData;void 0!==b&&(cK(t,162),tK(t,b));let w=e.jpgEncryption;void 0!==w&&(cK(t,168),cK(t,w));let S=e.requestType;void 0!==S&&(cK(t,176),cK(t,S));let T=e.scorePorn;void 0!==T&&(cK(t,185),sK(t,T));let C=e.scoreSexy;void 0!==C&&(cK(t,193),sK(t,C));let A=e.scoreNeutral;void 0!==A&&(cK(t,201),sK(t,A));let R=e.scene;void 0!==R&&(cK(t,208),cK(t,R));let I=e.ossFilePrefix;void 0!==I&&(cK(t,218),tK(t,I));let x=e.serviceVendor;if(void 0!==x)for(let O of x){cK(t,226);let e=$q();Fq(O,e),cK(t,e.limit),nK(t,e),Yq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function Uq(e){return function(e){let t={};e:for(;!Jq(e);){let n=aK(e);switch(n>>>3){case 0:break e;case 1:t.code=aK(e);break;case 2:t.msg=eK(e,aK(e));break;case 3:{let n=Bq(e);t.data=Vq(e),e.limit=n;break}default:Wq(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function Vq(e){let t={};e:for(;!Jq(e);){let n=aK(e);switch(n>>>3){case 0:break e;case 1:t.requestId=eK(e,aK(e));break;case 2:t.requestType=aK(e)>>>0;break;case 3:t.scorePorn=oK(e);break;case 4:t.scoreSexy=oK(e);break;case 5:t.scoreNeutral=oK(e);break;case 6:t.requestScene=aK(e)>>>0;break;case 7:t.scene=aK(e)>>>0;break;default:Wq(e,7&n)}}return t}function Fq(e,t){let n=e.service;void 0!==n&&(cK(t,8),cK(t,n));let r=e.vendor;void 0!==r&&(cK(t,16),cK(t,r));let i=e.token;void 0!==i&&(cK(t,26),tK(t,i));let o=e.callbackUrl;void 0!==o&&(cK(t,34),tK(t,o))}function Bq(e){let t=aK(e),n=e.limit;return e.limit=e.offset+t,n}function Wq(e,t){switch(t){case 0:for(;128&rK(e););break;case 2:Xq(e,aK(e));break;case 5:Xq(e,4);break;case 1:Xq(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let zq=new Float32Array(1);new Uint8Array(zq.buffer);let Hq=new Float64Array(1),Gq=new Uint8Array(Hq.buffer);function qq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Kq=[];function $q(){const e=Kq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Yq(e){Kq.push(e)}function Xq(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Jq(e){return e.offset>=e.limit}function Qq(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function Zq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function eK(e,t){let n=Zq(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let e,c,l,u,d=i[a+n];0==(128&d)?s+=r(d):192==(224&d)?a+1>=t?s+=o:(e=i[a+n+1],128!=(192&e)?s+=o:(u=(31&d)<<6|63&e,u<128?s+=o:(s+=r(u),a++))):224==(240&d)?a+2>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],32896!=(49344&(e|c<<8))?s+=o:(u=(15&d)<<12|(63&e)<<6|63&c,u<2048||u>=55296&&u<=57343?s+=o:(s+=r(u),a+=2))):240==(248&d)?a+3>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],l=i[a+n+3],8421504!=(12632256&(e|c<<8|l<<16))?s+=o:(u=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&l,u<65536||u>1114111?s+=o:(u-=65536,s+=r(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o}return s}function tK(e,t){let n=t.length,r=0;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}cK(e,r);let i=Qq(e,r),o=e.bytes;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function nK(e,t){let n=Qq(e,t.limit),r=e.bytes,i=t.bytes;for(let o=0,s=t.limit;o<s;o++)r[o+n]=i[o]}function rK(e){return e.bytes[Zq(e,1)]}function iK(e,t){let n=Qq(e,1);e.bytes[n]=t}function oK(e){let t=Zq(e,8),n=e.bytes;return Gq[0]=n[t++],Gq[1]=n[t++],Gq[2]=n[t++],Gq[3]=n[t++],Gq[4]=n[t++],Gq[5]=n[t++],Gq[6]=n[t++],Gq[7]=n[t++],Hq[0]}function sK(e,t){let n=Qq(e,8),r=e.bytes;Hq[0]=t,r[n++]=Gq[0],r[n++]=Gq[1],r[n++]=Gq[2],r[n++]=Gq[3],r[n++]=Gq[4],r[n++]=Gq[5],r[n++]=Gq[6],r[n++]=Gq[7]}function aK(e){let t,n=0,r=0;do{t=rK(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function cK(e,t){for(t>>>=0;t>=128;)iK(e,127&t|128),t>>>=7;iK(e,t)}function lK(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=Qq(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}function uK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const dK=new Map([["moderation",1],["supervise",2]]);class hK extends kI{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(ZM.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Xr(t=e.map((e=>dK.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),JT(this,"name","AgoraRTCVideoContentInspect"),JT(this,"_connectionState",JM.CONNECTING),JT(this,"_innerConnectionState",void 0),JT(this,"sequence",0),JT(this,"inspectStartTime",void 0),JT(this,"workerManagerConnection",void 0),JT(this,"workerConnection",void 0),JT(this,"workerMessageLengthLimit",void 0),JT(this,"inspectIntervalMinimum",void 0),JT(this,"qualityRatio",void 0),JT(this,"_connectInfo",void 0),JT(this,"_cancelTokenSource",AR.CancelToken.source()),JT(this,"_retryConfig",void 0),JT(this,"wmSequence",0),JT(this,"inspectInterval",void 0),JT(this,"inspectTimer",null),JT(this,"ossFilePrefix",void 0),JT(this,"extraInfo",void 0),JT(this,"_inspectType",void 0),JT(this,"_inspectMode",void 0),JT(this,"_quality",1),JT(this,"qualityTimer",null),JT(this,"_inspectId",void 0),JT(this,"_needWorkUrlOnly",!1),JT(this,"inspectImage",(()=>{if(this.connectionState!==JM.CONNECTED)throw new tk(mI.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===JM.CONNECTED?this.requestToInspectImage():qO.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=hx(5,"inspect-"),this.workerMessageLengthLimit=fO("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=fO("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=fO("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Cj("worker-manager-"+this._inspectId,Ax),this.on(ZM.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,qO.debug("[".concat(this._inspectId,"] Inspect operation :").concat(QM[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Cj("worker-"+this._inspectId,Ax),this.handleWorkerEvents()}async init(e,t){this.emit(ZM.STATE_CHANGE,QM.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new zh(((r,i)=>{this.on(ZM.CONNECTION_STATE_CHANGE,((e,t)=>{t===JM.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=fO("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:l}=t;eV++;const u="image_moderation_api",d={service_name:u,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:eV,seq:eV,sid:a,token:c,ts:Date.now(),uid:l+""})};let h,p,f=e[0];return Ix((async()=>{h=Date.now();const e=await NU(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new tk(mI.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw qO.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new tk(mI.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw qO.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new tk(mI.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw qO.error(e.toString()),e}const r=fO("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=fO("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:p}}),((t,n)=>(ek.apworkerEvent(a,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(ek.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==mI.OPERATION_ABORTED&&t.code!==mI.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(ZM.STATE_CHANGE,QM.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(ZM.STATE_CHANGE,QM.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(gM.CONNECTED,(async()=>{this.emit(ZM.STATE_CHANGE,QM.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(gM.CLOSED,(()=>{this._innerConnectionState<QM.GET_WORKER_MANAGER_RESPONSE&&qO.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(gM.FAILED,(()=>{this._innerConnectionState<QM.GET_WORKER_MANAGER_RESPONSE&&qO.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(gM.RECONNECTING,(()=>{this._innerConnectionState<QM.GET_WORKER_MANAGER_RESPONSE&&qO.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(gM.ON_MESSAGE,(async e=>{this.emit(ZM.STATE_CHANGE,QM.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw qO.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new tk(mI.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw qO.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new tk(mI.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=fO("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(ZM.STATE_CHANGE,QM.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(ZM.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(gM.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(gM.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(gM.CONNECTED,(async()=>{this.emit(ZM.STATE_CHANGE,QM.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=JM.CONNECTED})),this.workerConnection.on(gM.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=Uq(new Uint8Array(e.data));if(fO("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&qO.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(ZM.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Xr(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(ZM.INSPECT_RESULT,i)}else this.emit(ZM.INSPECT_RESULT,void 0,new tk(mI.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(ZM.INSPECT_RESULT,void 0,new tk(mI.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else qO.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ZM.INSPECT_RESULT,void 0,new tk(mI.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(gM.CLOSED,(()=>{this.connectionState=JM.CLOSED})),this.workerConnection.on(gM.FAILED,(()=>{this.connectionState=JM.CLOSED})),this.workerConnection.on(gM.RECONNECTING,(()=>{this.connectionState=this.connectionState===JM.CONNECTED?JM.RECONNECTING:JM.CONNECTING})),this.workerConnection.on(gM.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(gM.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(ZM.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}async requestToInspectImage(){this.sequence++;const e=$I(this,ZM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(ZM.INSPECT_RESULT,void 0,new tk(mI.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(ZM.INSPECT_RESULT,void 0,new tk(mI.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await LN(l,n,r),d=this.sequence+"-"+i+"-"+a+"-"+c+"-"+hx(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:(p=Number(c-this.inspectStartTime),{low:p|=0,high:p>>31,unsigned:p>=0}),fileSize:u.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.23.2",sequence:this.sequence,sid:s,timestamp:WB(c),uid:a,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var p;void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const f=jq(h);if(f.byteLength<this.workerMessageLengthLimit){if(fO("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uK(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,qO.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return f}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=AR.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=JM.CLOSED,this.emit(ZM.STATE_CHANGE,QM.CLOSED)}}const pK={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new tk(mI.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new tk(mI.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!Nr(t=["supervise","moderation"]).call(t,e))throw new tk(mI.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new tk(mI.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new hK(t)}};var fK=r(re.Object.getOwnPropertySymbols),mK=On,gK=Yn.indexOf,vK=Br,yK=C([].indexOf),_K=!!yK&&1/yK([1],1,-0)<0;mK({target:"Array",proto:!0,forced:_K||!vK("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return _K?yK(this,e,t)||0:gK(this,e,t)}});var EK=Qn("Array").indexOf,bK=d,wK=EK,SK=Array.prototype,TK=function(e){var t=e.indexOf;return e===SK||bK(SK,e)&&t===SK.indexOf?wK:t},CK=r(TK);function AK(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=LL(e);for(r=0;r<o.length;r++)n=o[r],CK(t).call(t,n)>=0||(i[n]=e[n]);return i}(e,t);if(fK){var o=fK(e);for(r=0;r<o.length;r++)n=o[r],CK(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let RK=class{get localCapabilities(){return ex(this._localCapabilities)}get rtpCapabilities(){return ex(this._rtpCapabilities)}get candidates(){return ex(this._candidates)}get iceParameters(){return ex(this._iceParameters)}get dtlsParameters(){return ex(this._dtlsParameters)}constructor(e){JT(this,"sessionDesc",void 0),JT(this,"_localCapabilities",void 0),JT(this,"_rtpCapabilities",void 0),JT(this,"_candidates",void 0),JT(this,"_iceParameters",void 0),JT(this,"_dtlsParameters",void 0),JT(this,"setup",void 0),JT(this,"currentMidIndex",void 0),JT(this,"cname","o/i14u9pJrxRKAsu"),JT(this,"firefoxSsrcMidMap",new Map),e=ex(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:o,direction:s,setup:a,videoCodec:c,audioCodec:l}=e;let u;this.setup=a,u=s===mM.RECEIVE_ONLY?CO("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):CO("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const d=s===mM.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=s===mM.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=s===mM.RECEIVE_ONLY?i.send.videoCodecs:dU(HM.VIDEO,d,h,c),f=s===mM.RECEIVE_ONLY?i.send.audioCodecs:dU(HM.AUDIO,d,h,l);for(const m of u.mediaDescriptions)m.attributes.iceUfrag=t.iceUfrag,m.attributes.icePwd=t.icePwd,m.attributes.fingerprints=n.fingerprints,m.attributes.candidates=r,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=p.map((e=>e.payloadType.toString(10))),m.attributes.payloads=p,m.attributes.extmaps=d.videoExtensions),"audio"===m.media.mediaType&&(m.media.fmts=f.map((e=>e.payloadType.toString(10))),m.attributes.payloads=f,m.attributes.extmaps=d.audioExtensions,uU(m));this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}toString(){return AO(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((e=>this.hasMid(e))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:s}=Zj(t,this.cname,fO("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(o);if(a){if(GR()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,o,r);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,o,s,"sendonly",r,i),this.updateBundleMids()):(n=ex(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=o,n.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),GR()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{e.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach((e=>{const i=e._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(i);let s,a=!1;-1===o?(a=!0,s=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(s=ex(this.sessionDesc.mediaDescriptions[o]),s.attributes.direction="recvonly"),r.push({mid:s.attributes.mid,needCreateTransceiver:a})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:o,relatedAddress:s,relatedPort:a,priority:c}=new RTCIceCandidate(e),l={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=r?r:"",port:i?i+"":"",type:o?o+"":"",relAddr:null!=s?s:"",relPort:a?a+"":"",extension:{}};this.candidates.some((e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port))||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,a=dU(o,s,this.localCapabilities.send,o===HM.AUDIO?i:r),c=o===HM.VIDEO?s.videoExtensions:s.audioExtensions,l="".concat(++this.currentMidIndex);let u={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};u=this.mungRecvMediaDsec(u,e);const d=this.findFirstClosedMedia(o);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Nr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Nr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(GR()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=ex(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,o){const s=this.rtpCapabilities.send,a=e===HM.VIDEO?s.videoCodecs:s.audioCodecs,c=e===HM.VIDEO?s.videoExtensions:s.audioExtensions;GR()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,o);const u=this.findFirstClosedMedia(e);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){const r=ex(e);return tU(r),eU(r,t),nU(r,t),rU(r),iU(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=ex(e);return iU(n,t,this.localCapabilities.recv),uU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>GR()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}};const IK=["sdp"];var xK;function OK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OK(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let NK=(xK=class e extends WM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),JT(this,"direction",void 0),JT(this,"name",void 0),JT(this,"store",void 0),JT(this,"spec",void 0),JT(this,"peerConnection",void 0),JT(this,"initialOffer",void 0),JT(this,"transport",void 0),JT(this,"statsFilter",void 0),JT(this,"localCandidateCount",0),JT(this,"_isInRestartIce",!1),JT(this,"mutex",void 0),JT(this,"onLocalCandidate",void 0),JT(this,"remoteSDP",void 0),JT(this,"pendingCandidates",[]),JT(this,"localCapabilities",void 0),JT(this,"isReady",!1),JT(this,"restartCnt",0),JT(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Tx("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=r?r:mM.SEND_ONLY,this.name=this.direction===mM.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=tO(this.peerConnection,fO("STATS_UPDATE_INTERVAL"),void 0,GR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await sU();if(this.localCapabilities=lU(t),e){const{sdp:t}=e,n=AK(e,IK),r=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=$j(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(cU(t,e,"videoExtensions",n,r,i),cU(t,e,"videoCodecs",n,r,i),cU(t,e,"audioExtensions",n,r,i),cU(t,e,"audioCodecs",n,r,i),fO("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){qO.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&fO("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new RK({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const o=Yj(i.sdp);await this.peerConnection.setLocalDescription(i);const s=await aU({},{},i.sdp);this.localCapabilities=lU(s);const a=this.peerConnection.getTransceivers()[0];return null!=a&&a.receiver&&a.receiver.transport&&this.tryBindTransportEvents(a.receiver.transport),kK(kK({},o),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=Yj(e.sdp);return this.initialOffer=e,kK(kK({},t),{},{sdp:e.sdp})}}catch(e){throw new gI(mI.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await aU({},{},t);this.remoteSDP=new RK({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];null!=o&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((e=>{this.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[])}catch(e){throw new gI(mI.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return VA((function*(){const i=yield FA(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],o=r.remoteSDP.receive(e,t,n);e.forEach(((e,t)=>{if(o[t].needCreateTransceiver){const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=r.peerConnection.getTransceivers().find((e=>e.mid===o[t].mid));if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(o[t].mid));i.push(n),e._updateRtpTransceiver(n)}})),GR()&&!0===fO("SIMULCAST")&&(yield FA(r.applySimulcastForFirefox(i,e)));const s=o.map((e=>e.mid)),a=yield FA(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(a.sdp,e,s),l=CO(c),u=s.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return Xj(t,fO("USE_PUB_RTX"))})),d=i.map(((e,t)=>{const n=s[t];return{localSSRC:u[t],id:n}}));yield FA(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield d}catch(e){const n=r.remoteSDP.toString();throw yield FA(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield FA(r.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield FA(r.stopSending(s,!0)),e}yield FA(r.applySimulcastEncodings(i,e)),yield FA(r.applySendEncodings(i,e));const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield FA(r.setRemoteDescription({type:"answer",sdp:h})),i.map(((e,t)=>{const n=s[t];return{localSSRC:u[t],id:n}}))}catch(e){throw e instanceof gI?e:new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),qO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else qO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s||null===s.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,mid:s.mid,transceiver:s}}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),qO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else qO.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===sO.Auto&&(this.store.p2pTransport=sO.SdRtn,rk().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,rk().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=Yj(e.sdp);return this.store.descriptionStart(),this.direction===mM.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===mM.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=Yj(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?GR()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:kK(kK({},Vx),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:kK(kK({},Vx),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Nr(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):qO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(VI(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),fO("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Nr(o=[sO.Relay,sO.SdRtn]).call(o,n)&&(i.iceTransportPolicy="relay"),fO("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(i.iceTransportPolicy="relay")})))),fO("ENABLE_ENCODED_TRANSFORM")&&rk().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),qO.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],i=e.filter((e=>e.tcpport));qO.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const o=i.length>n?i[n]:i[0];switch(t){case sO.SdRtn:const t=e.filter((e=>{var t;return Nr(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(kj(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(kj(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case sO.Relay:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(kj(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(kj(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair();qO.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return qO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return qO.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!rk().supportSetRtpSenderParameters)return qO.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Nr(o=e._hints).call(o,wk.LOW_STREAM)&&(n&&(i.maxFramerate=Pj(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(fO("DSCP_TYPE")&&lI()){var s;const e=fO("DSCP_TYPE");Nr(s=["very-low","low","medium","high"]).call(s,e)&&(i.networkPriority=e)}const a=t.getParameters(),c=null===(n=a.encodings)||void 0===n?void 0:n[0];GR()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(a,r),qO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!rk().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof pD&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){qO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=CO(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(eU(o,e),oU(o,e,this.store.codec))})),AO(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],l=t[a];if(l instanceof pD&&!Nr(n=l._hints).call(n,wk.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=l._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!GR()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof pD&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof pD&&fO("SIMULCAST")&&"vp8"===this.store.codec&&!Nr(t=e._hints).call(t,wk.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(fO("SDP_LOGGING"))return qO.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async e=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp){var i;const n=null===(i=CO(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===i?void 0:i.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Nr(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const r=CO(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===HM.AUDIO&&"audio"===i.media.mediaType&&uU(i),AO(r)}},iM(xK.prototype,"establish",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"establish"),xK.prototype),iM(xK.prototype,"connect",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"connect"),xK.prototype),iM(xK.prototype,"receive",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"receive"),xK.prototype),iM(xK.prototype,"mockReceive",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"mockReceive"),xK.prototype),iM(xK.prototype,"stopReceiving",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"stopReceiving"),xK.prototype),iM(xK.prototype,"restartICE",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"restartICE"),xK.prototype),iM(xK.prototype,"close",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"close"),xK.prototype),iM(xK.prototype,"updateEncoderConfig",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"updateEncoderConfig"),xK.prototype),iM(xK.prototype,"updateSendParameters",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"updateSendParameters"),xK.prototype),iM(xK.prototype,"replaceTrack",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"replaceTrack"),xK.prototype),iM(xK.prototype,"muteLocal",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"muteLocal"),xK.prototype),iM(xK.prototype,"unmuteLocal",[PK],Object.getOwnPropertyDescriptor(xK.prototype,"unmuteLocal"),xK.prototype),xK);function PK(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}let DK=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var LK,MK,jK,UK,VK,FK,BK,WK,zK,HK,GK,qK;function KK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KK(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let YK=(LK=XK(DK.SEND_ONLY),MK=XK(DK.SEND_ONLY),jK=XK(),UK=XK(DK.RECEIVE_ONLY),VK=XK(DK.RECEIVE_ONLY),FK=XK(DK.RECEIVE_ONLY),BK=XK(DK.RECEIVE_ONLY),WK=XK(DK.RECEIVE_ONLY),zK=XK(DK.RECEIVE_ONLY),HK=XK(),GK=XK(DK.RECEIVE_ONLY),qK=class extends kI{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(XM.StateChange,t,this._state)}constructor(e,t){super(),JT(this,"isPlanB",!1),JT(this,"store",void 0),JT(this,"statsUploader",void 0),JT(this,"sendConnection",void 0),JT(this,"recvConnection",void 0),JT(this,"localTrackMap",new Map),JT(this,"remoteUserMap",new Map),JT(this,"localDataChannels",[]),JT(this,"pendingLocalTracks",[]),JT(this,"pendingRemoteTracks",[]),JT(this,"statsCollector",void 0),JT(this,"dtlsFailedCount",0),JT(this,"sendMutex",void 0),JT(this,"recvMutex",void 0),JT(this,"_state",YM.Disconnected),JT(this,"_restartStates",["disconnected","failed"]),JT(this,"reconnectInterval",void 0),JT(this,"uploadUnplinkStarted",!1),JT(this,"uploadDownlinkStarted",!1),JT(this,"uplinkStateUploadInterval",void 0),JT(this,"downlinkStatsUploadInterval",void 0),JT(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==YM.Connected)return void n(new gI(mI.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const s=r.find((e=>"videoLowTrack"===e[0]));s&&s[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let a=!1;var i,o;a="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get($M.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(o=this.localTrackMap.get($M.LocalVideoTrack))||void 0===o?void 0:o.id);const c=this.createMuteMessage(r);await KI(this,XM.RequestMuteLocal,c);const l="video"===e.trackMediaType?aj.MUTE_LOCAL_VIDEO:aj.MUTE_LOCAL_AUDIO;await KI(this,XM.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:a}),t()}catch(e){n(e)}finally{r()}})),JT(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==YM.Connected)return void n(new gI(mI.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(r),o="video"===e.trackMediaType?aj.UNMUTE_LOCAL_VIDEO:aj.UNMUTE_LOCAL_AUDIO;await KI(this,XM.RequestP2PMuteLocal,{action:o,message:i}),t()}catch(e){n(e)}finally{r()}})),JT(this,"handleUpdateVideoEncoder",(async(e,t,n,r)=>{let i;"boolean"==typeof r&&r||(i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get($M.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==YM.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(XM.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{var o;null===(o=i)||void 0===o||o()}})),JT(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get($M.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==YM.Connected)return void t();const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),JT(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;qO.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==YM.Connected)return void t();if(await(null===(o=this.sendConnection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),n[0]===$M.LocalVideoTrack&&rk().supportDualStreamEncoding){const t=this.localTrackMap.get($M.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new zh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),JT(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),JT(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),JT(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),JT(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new _F(e),this.bindStatsUploaderEvents(),this.sendMutex=new Tx("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Tx("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))}))}),fO("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(qO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new NK(e,this.store,mM.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=YM.New,this.sendConnection&&(qO.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new NK(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new gI(mI.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=YM.Connected}async addRemoteCandidate(e,t){if(t===mM.RECEIVE_ONLY){if(!this.sendConnection)throw new gI(mI.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new gI(mI.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return VA((function*(){const i=yield FA(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==YM.Connected){r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,yV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield FA(r.tryToUnmuteAudio(e)));i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===$M.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(i);const o=yield FA(r.sendConnection.send(i.map((e=>{let{track:t}=e;return t})),r.store.codec,r.store.audioCodec)),s=(yield FA(o.next())).value,a=r.createGatewayPublishMessage(i,s);try{yield a}catch(e){throw o.throw(e),(null==e?void 0:e.code)===mI.WS_ABORT&&i.forEach((e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(i),e}yield FA(o.next()),i.forEach((e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,s),i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===$M.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==YM.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!Nr(e).call(e,t))));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===YM.Connected)return n&&n[1].track.close(),r;e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach((n=>{let[r,{track:i,ssrcs:o}]=n;const s={stream_type:WV(i,r),ssrcs:o};i._muted||!i._enabled?e.push(s):t.push(s)})),e.length>0&&e.forEach((e=>{KI(this,XM.RequestMuteLocal,[e])})),t.length>0&&t.forEach((e=>{KI(this,XM.RequestUnmuteLocal,[e])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return VA((function*(){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(qO.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await qI(this,XM.RequestRePublish,this.pendingLocalTracks),this.emit(XM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new gI(mI.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:o,mid:s,transceiver:a}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===HM.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new OD(o,e.uid,e._uintid,this.store),qO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),a&&e._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new xD(o,e.uid,e._uintid,this.store),qO.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),a&&e._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(XM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new gI(mI.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===HM.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===HM.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===HM.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===HM.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===HM.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),i.forEach((e=>{let[,{kind:t}]=e;KI(this,XM.RequestP2PMuteRemote,t)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((e=>{let[,t]=e;[HM.VIDEO,HM.AUDIO].forEach((e=>{t.has(e)?KI(this,XM.RequestP2PUnmuteRemote,e):KI(this,XM.RequestP2PMuteRemote,e)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new gI(mI.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void qO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void qO.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===HM.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||qO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):qO.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get($M.LocalAudioTrack);if((null==t?void 0:t.track)instanceof RP){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==$M.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===$M.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===$M.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get($M.LocalAudioTrack),o=r?this.localTrackMap.get($M.LocalVideoLowTrack):this.localTrackMap.get($M.LocalVideoTrack);ek.publish(this.store.sessionId,{eventElapse:yV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(wk.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof TP)),a=r?null===(o=this.localTrackMap.get($M.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof pD));ek.publish(this.store.sessionId,{eventElapse:yV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(wk.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===HM.VIDEO?n._videoSSRC:n._audioSSRC;i&&ek.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===HM.VIDEO,audio:r===HM.AUDIO,peerid:n.uid,subscribeRequestid:r===HM.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:yV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){qO.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Tx("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Tx("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($M.LocalAudioTrack);if((null==e?void 0:e.track)instanceof RP){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=YM.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($M.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($M.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof pD||t&&t.track instanceof TP?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get($M.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=w_(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(qO.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=YM.Reconnecting,fO("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case $M.LocalVideoTrack:Nr(t=r._hints).call(t,wk.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case $M.LocalAudioTrack:r instanceof RP?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case $M.LocalVideoLowTrack:}})),this.emit(XM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(LO(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(XM.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),qO.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof TV?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===mM.SEND_ONLY){if(!this.sendConnection)throw new gI(mI.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new gI(mI.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const e=await r.restartICE(t);return r.isInRestartIce=!1,e}{const e=await r.restartICE();if(e){const t=await qI(this,XM.RequestP2PRestartICE,{direction:mM.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get($M.LocalVideoTrack),n=this.localTrackMap.get($M.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;const o=$I(this,XM.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,l=(c&&o?(c+o)/2:c||o)||0,u=100*e.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(wk.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return vL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=$I(this,XM.NeedSignalRTT),l=e.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*u/1500;d&&(p=.6*h*100/50+.2*u/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new zh(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=rk(),o=this.getAllTracks();e=QI(e=e.filter((e=>-1===o.indexOf(e))));let s=!1,a=!1;for(const c of e){if(c instanceof pD&&(this.localTrackMap.has($M.LocalVideoTrack)||s?new gI(mI.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:$M.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:$M.LocalVideoLowTrack})}if(c instanceof TP){const e=this.localTrackMap.get($M.LocalAudioTrack);if(e){if(!(e.track instanceof RP))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const e=r.find((e=>{let{type:t}=e;return t===$M.LocalAudioTrack}));if(!(e.track instanceof RP))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof RP||c._bypassWebAudio)r.push({track:c,type:$M.LocalAudioTrack});else{const e=new RP;e.addAudioTrack(c),r.push({track:e,type:$M.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=QI(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof TP){const e=this.localTrackMap.get($M.LocalAudioTrack);if(!e)continue;e.track instanceof RP?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([$M.LocalAudioTrack,e]),e.track.close())):t.push([$M.LocalAudioTrack,e])}if(r instanceof pD){const e=this.localTrackMap.get($M.LocalVideoTrack);if(!e)continue;t.push([$M.LocalVideoTrack,e]);const n=this.localTrackMap.get($M.LocalVideoLowTrack);n&&t.push([$M.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case $M.LocalVideoTrack:t.addListener(bk.GET_STATS,this.handleGetLocalVideoStats),t.addListener(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(bk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(bk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $M.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case $M.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof RP?e.trackList.forEach((e=>{e.addListener(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(bk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(bk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case $M.LocalVideoTrack:t.off(bk.GET_STATS,this.handleGetLocalVideoStats),t.off(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(bk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(bk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $M.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case $M.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof RP?e.trackList.forEach((e=>{e.off(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(bk.GET_STATS,this.handleGetLocalAudioStats),e.off(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(bk.GET_STATS,this.handleGetLocalAudioStats),e.off(bk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(bk.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(bk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(bk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof xD&&t.addListener(bk.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof OD&&t.addListener(bk.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(bk.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(HM.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(HM.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,{track:o,type:s}=e;switch(s){case $M.LocalAudioTrack:i=NM.Audio;break;case $M.LocalVideoTrack:i=Nr(r=o._hints).call(r,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalVideoLowTrack:i=NM.Low}return{kind:s===$M.LocalAudioTrack?HM.AUDIO:HM.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case $M.LocalVideoTrack:n=Nr(t=i._hints).call(t,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalAudioTrack:n=NM.Audio;break;case $M.LocalVideoLowTrack:n=NM.Low}return{stream_type:n,ssrcs:o,mid:s}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(XM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Nr(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await dx(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),ek.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:LI.TRACER}).onSuccess(),this.emit(XM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(Ik.FIRST_FRAME_DECODED),ek.firstRemoteFrame(this.store.sessionId,XO.FIRST_AUDIO_DECODE,JO.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&ek.firstRemoteFrame(this.store.sessionId,XO.FIRST_AUDIO_RECEIVED,JO.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(LO(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&ek.firstRemoteFrame(this.store.sessionId,XO.FIRST_VIDEO_RECEIVED,JO.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(XM.ConnectionTypeChange,n),qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vj(t))," -> ").concat(JSON.stringify(Vj(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{qO.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vj(t))," -> ").concat(JSON.stringify(Vj(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(XM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===mM.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,qO.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===mM.SEND_ONLY?this.restartICE(e):qI(this,XM.RequestP2PRestartICE,{direction:mM.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get($M.LocalAudioTrack);if(e instanceof TP&&(null==n?void 0:n.track)instanceof RP)return n.track.isActive||t.push([$M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===$M.LocalVideoTrack)){const e=this.localTrackMap.get($M.LocalVideoLowTrack);e&&t.push([$M.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get($M.LocalAudioTrack);if(e instanceof TP&&(null==n?void 0:n.track)instanceof RP)return n.track.isActive&&t.push([$M.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===$M.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get($M.LocalVideoLowTrack);e&&t.push([$M.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case $M.LocalAudioTrack:n=NM.Audio;break;case $M.LocalVideoTrack:n=Nr(t=i._hints).call(t,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalVideoLowTrack:n=NM.Low}return{stream_type:n,ssrcs:o,mid:s}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case $M.LocalAudioTrack:n=NM.Audio;break;case $M.LocalVideoTrack:n=Nr(t=i._hints).call(t,wk.SCREEN_TRACK)?NM.Screen:NM.High;break;case $M.LocalVideoLowTrack:n=NM.Low}return{stream_type:n,ssrcs:o,mid:s}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case HM.VIDEO:return void(n._videoSSRC&&t.push({stream_type:HM.VIDEO,ssrcId:n._videoSSRC}));case HM.AUDIO:return void(n._audioSSRC&&t.push({stream_type:HM.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get($M.LocalVideoTrack),n=this.localTrackMap.get($M.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new zh(((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new zh(((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof TP){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await KI(this,XM.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(XM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(XM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await dx(Rx(this.dtlsFailedCount,Ax)),this.emit(XM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($M.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof pD))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof pD)).length>1)throw new gI(mI.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof TP)).length>1&&(e.some((e=>e instanceof TP&&e._bypassWebAudio))||!rk().webAudioMediaStreamDest))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof pD&&this.pendingLocalTracks.some((e=>e instanceof pD)))throw new gI(mI.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof TP&&this.pendingLocalTracks.some((e=>e instanceof TP))&&(!rk().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof TP&&e._bypassWebAudio))))throw new gI(mI.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!fO("DISABLE_DUAL_STREAM_USE_ENCODING")&&rk().supportDualStreamEncoding,r=$K($K({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():eF(e,r);const o=hx(8,"track-low-"),s=new pD(i,$K($K({},n&&{scaleResolutionDownBy:Uj(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(Ak.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Sk.LOW_STREAM)})),s._hints.push(wk.LOW_STREAM),e.addListener(bk.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(LO(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));ek.firstRemoteVideoDecode(this.store.sessionId,XO.FIRST_VIDEO_DECODE,JO.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:yV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return void 0!==o&&o!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new gI(mI.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new gI(mI.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new gI(mI.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new gI(mI.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new gI(mI.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new gI(mI.NOT_SUPPORTED)}async preConnect(e){throw new gI(mI.NOT_SUPPORTED)}getEstablishParams(){throw new gI(mI.NOT_SUPPORTED)}async reSubscribe(e){throw new gI(mI.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new gI(mI.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===$M.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Sk.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},iM(qK.prototype,"p2pConnect",[LK],Object.getOwnPropertyDescriptor(qK.prototype,"p2pConnect"),qK.prototype),iM(qK.prototype,"unpublish",[MK],Object.getOwnPropertyDescriptor(qK.prototype,"unpublish"),qK.prototype),iM(qK.prototype,"unpublishLowStream",[jK],Object.getOwnPropertyDescriptor(qK.prototype,"unpublishLowStream"),qK.prototype),iM(qK.prototype,"subscribe",[UK],Object.getOwnPropertyDescriptor(qK.prototype,"subscribe"),qK.prototype),iM(qK.prototype,"mockSubscribe",[VK],Object.getOwnPropertyDescriptor(qK.prototype,"mockSubscribe"),qK.prototype),iM(qK.prototype,"unsubscribe",[FK],Object.getOwnPropertyDescriptor(qK.prototype,"unsubscribe"),qK.prototype),iM(qK.prototype,"muteRemote",[BK],Object.getOwnPropertyDescriptor(qK.prototype,"muteRemote"),qK.prototype),iM(qK.prototype,"unmuteRemote",[WK],Object.getOwnPropertyDescriptor(qK.prototype,"unmuteRemote"),qK.prototype),iM(qK.prototype,"hasRemoteMediaWithLock",[zK],Object.getOwnPropertyDescriptor(qK.prototype,"hasRemoteMediaWithLock"),qK.prototype),iM(qK.prototype,"disconnectForReconnect",[HK],Object.getOwnPropertyDescriptor(qK.prototype,"disconnectForReconnect"),qK.prototype),iM(qK.prototype,"remoteMediaSsrcChanged",[GK],Object.getOwnPropertyDescriptor(qK.prototype,"remoteMediaSsrcChanged"),qK.prototype),qK);function XK(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];switch(e){case DK.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case DK.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}class JK extends kI{constructor(e,t){super(),JT(this,"signal",void 0),JT(this,"token",void 0),JT(this,"tokenTimeout",void 0),JT(this,"tokenInterval",void 0),JT(this,"_sequence",0),JT(this,"userMap",new Map),JT(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===uM.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*fO("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var o,s,a;if(0===this.userMap.size)return;const c=Array.from(Qh(o=this.userMap).call(o))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!==(s=r)&&void 0!==s?s:hx(6,""),i=null!==(a=i)&&void 0!==a?a:this._sequence++;const l={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(c)};fO("SHOW_P2P_LOG")&&qO.debug("send message",l,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(l)).forEach((e=>{this.signal.request(hM.DATA_STREAM,{payload:ox(this.encoder.encode(e))})}));const u=new zh(((t,i)=>{const o=window.setTimeout((()=>{this.off("res-@".concat(r,"_ack"),s),this.off("res-@".concat(r),c),this.off(sj.ABORT,a),qO.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new gI(mI.INVALID_REMOTE_USER)):i(new gI(mI.TIMEOUT))}),fO("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),s=()=>{o&&window.clearTimeout(o),this.off(sj.ABORT,a),n&&t()},a=()=>{o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),s),this.off("res-@".concat(r),c),i(new gI(mI.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(sj.ABORT,a),this.once("res-@".concat(r,"_ack"),s);const c=(n,c)=>{u=!0,o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),s),this.off(sj.ABORT,a),"success"===n?t(c):i(new gI(mI.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let u=!1;n||(this.once("res-@".concat(r),c),dx(fO("SIGNAL_REQUEST_TIMEOUT")).then((()=>{u||qO.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(l))})))}));try{return await u}catch(o){if(o.code===mI.TIMEOUT)return await this.send(e,t,n,r,i);throw o}}onMessage(e){var t;const{_uid:n}=e;let r,i=this.userMap.get(n);if(i)r=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==oj.CHECK)return;const{token:t}=e;r=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(fM.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;const{id:t,total:i}=e,s=null!==(o=r.get(t))&&void 0!==o?o:[];if(s.push(e),r.has(t)||r.set(t,s),s.length!==i)return;{const i=w_(s).call(s,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");r.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:s,token:a}=e;if(Nr(t=[oj.ACK,oj.CHECK]).call(t,s))return s===oj.CHECK&&this.handleCheckToken(i,a),void this.receiveMessage(e);a==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):qO.debug('Receive unexpected message", '.concat(a,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:hx(6,""),token:this.token,_type:oj.CHECK};fO("SHOW_P2P_LOG")&&qO.debug("send message",e),this.signal.request(hM.DATA_STREAM,{payload:ox(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:oj.ACK,token:this.token};fO("SHOW_P2P_LOG")&&qO.debug("send message",t),this.signal.request(hM.DATA_STREAM,{payload:ox(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(oj.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach((e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:o,isStart:s,nextExpectedSequenceNumber:a}=i;if(r<a)return this.ack(e._id),void qO.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));o.set(r,e),s&&r===a&&(this.receiveMessage(e),o.delete(a),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(fO("SHOW_P2P_LOG")&&qO.debug("receive message",e),t){let o;switch(e._type!==oj.ACK&&(r&&(o=JSON.parse(r)),this.ack(e._id)),e._type){case oj.CANDIDATE:case oj.CONTROL:this.signal.emit(n,o,i);break;case oj.PUBLISH:case oj.UNPUBLISH:case oj.RESTART_ICE:case oj.CALL:o.uid=i,qI(this.signal,n,o).then((t=>{this.response(e._id,t)})).catch((()=>{this.response(e._id,void 0,!0)}));break;case oj.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case oj.RESPONSE:{const{success:e,message:n}=o;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<JK.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),r=hx(6,"");let i=0,o=800;const s=Math.ceil(e.length/o);for(;e.length>0;){i++;const a={id:r,index:i,total:s,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(a).length>JK.MAX_MESSAGE_SIZE?o-=50:(t.push(a),e=e.slice(o))}return t.map((e=>JSON.stringify(e)))}handleCheckToken(e,t){return e.token!==t?(qO.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{qO.debug("token timeout, ".concat(t)),this.reset(e.uid)}),fO("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await qI(this.signal,oj.CALL,void 0),t=await this.send(oj.CALL,e);this.signal.emit(dM.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(sj.ABORT),this.signal.emit(fM.ON_USER_OFFLINE,{uid:n.uid,reason:cj.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(qO.debug("change local token from ".concat(t," to ").concat(t)),this.token=hx(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(sj.ABORT)}}JT(JK,"MAX_SIZE",1),JT(JK,"MAX_MESSAGE_SIZE",1024);class QK extends kI{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===uM.CONNECTED?this.emit(dM.WS_CONNECTED):e===uM.RECONNECTING?this.emit(dM.WS_RECONNECTING,this._websocketReconnectReason):e===uM.CLOSED&&this.emit(dM.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),JT(this,"_disconnectedReason",void 0),JT(this,"_websocketReconnectReason",void 0),JT(this,"_connectionState",uM.CLOSED),JT(this,"reconnectToken",void 0),JT(this,"p2pToken",void 0),JT(this,"websocket",void 0),JT(this,"openConnectionTime",void 0),JT(this,"clientId",void 0),JT(this,"lastMsgTime",Date.now()),JT(this,"uploadCache",[]),JT(this,"uploadCacheInterval",void 0),JT(this,"rttRolling",new Ox(5)),JT(this,"pingpongTimer",void 0),JT(this,"pingpongTimeoutCount",0),JT(this,"joinResponse",void 0),JT(this,"multiIpOption",void 0),JT(this,"initError",void 0),JT(this,"spec",void 0),JT(this,"store",void 0),JT(this,"_external_signal",void 0),JT(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(dM.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case fM.ON_DATA_STREAM:return void this.handleDataStream(t._message);case fM.MUTE_AUDIO:case fM.MUTE_VIDEO:case fM.ON_P2P_LOST:case fM.ON_USER_ONLINE:return;case fM.ON_USER_OFFLINE:const{uid:e}=t._message;return qO.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===fM.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===fM.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(UI.UID_BANNED);break;case 15:this.close(UI.IP_BANNED);break;case 16:this.close(UI.CHANNEL_BANNED)}if(t._type===fM.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case lM.ERR_LICENSE_MISSING:this.close(UI.LICENSE_MISSING);break;case lM.ERR_LICENSE_EXPIRED:this.close(UI.LICENSE_EXPIRED);break;case lM.ERR_LICENSE_MINUTES_EXCEEDED:this.close(UI.LICENSE_MINUTES_EXCEEDED);break;case lM.ERR_LICENSE_PERIOD_INVALID:this.close(UI.LICENSE_PERIOD_INVALID);break;case lM.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(UI.LICENSE_MULTIPLE_SDK_SERVICE);break;case lM.ERR_LICENSE_ILLEGAL:this.close(UI.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Tj("gateway-".concat(this.clientId),this.spec.retryConfig,!0,fO("JOIN_GATEWAY_USE_DUAL_DOMAIN"),fO("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===uM.CONNECTED&&this.reconnect("retry",zI.OFFLINE)})),this.p2pToken=hx(6,""),this._external_signal=new JK(this,this.p2pToken)}async request(e,t,n,r){const i=hx(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new zh(((e,t)=>{if(this.connectionState===uM.CONNECTED)return e();const n=()=>{this.off(dM.WS_CLOSED,r),e()},r=()=>{this.off(dM.WS_CONNECTED,n),t(new gI(mI.WS_ABORT))};this.once(dM.WS_CONNECTED,n),this.once(dM.WS_CLOSED,r)}));if(this.connectionState!==uM.CONNECTING&&this.connectionState!==uM.RECONNECTING||e===hM.JOIN||e===hM.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new zh(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(dM.WS_CLOSED,c),this.off(dM.WS_RECONNECTING,c),this.emit(dM.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new gI(mI.WS_ABORT,"type: ".concat(e))),this.off(dM.WS_CLOSED,c),this.off(dM.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(dM.WS_CLOSED,c),this.once(dM.WS_RECONNECTING,c),dx(fO("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(qO.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(dM.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===uM.CLOSED||e===hM.LEAVE)throw new gI(mI.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===hM.JOIN||e===hM.REJOIN?null:(await a(),await this.request(e,t))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=hj(u),h=new gI(mI.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:d.desc});return"success"===d.action?l.message:(qO.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===lM.ERR_TOO_MANY_BROADCASTERS?e===hM.JOIN||e===hM.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===lM.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,qO.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",zI.MULTI_IP)):this.reconnect(d.action,zI.SERVER_ERROR),e===hM.JOIN||e===hM.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new zh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void qO.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(pM.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=fO("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==uM.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),fO("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new zh(((t,n)=>{this.once(dM.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(dM.WS_CLOSED,(()=>n(this.initError||new gI(mI.WS_ABORT)))),this.connectionState=uM.CONNECTING,this.websocket.init(e).catch(n)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||UI.LEAVE,this.connectionState=uM.CLOSED,qO.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=hx(6,""),this._external_signal.clear(),this._external_signal=new JK(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(dM.ABORT_P2P_EXECUTION);const e=await qI(this,dM.REQUEST_JOIN_INFO),t=await this.request(hM.JOIN,e);if(!t)return this.emit(dM.REPORT_JOIN_GATEWAY,mI.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(dM.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=uM.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const n=ix(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Nr(t=Object.values(oj)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(fM.ON_DATA_STREAM,e)}catch(t){this.emit(fM.ON_DATA_STREAM,e)}}handleNotification(e){qO.debug("[".concat(this.clientId,"] receive notification: "),e);const t=hj(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(UI.UID_BANNED),void this.close()):void this.reconnect(t.action,zI.SERVER_ERROR);qO.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=fO("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(qO.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>fO("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",zI.TIMEOUT):this.request(hM.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),fO("REPORT_STATS")&&this.send(hM.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWebsocketEvents(){this.websocket.on(gM.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(dM.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(gM.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(gM.CLOSED,(()=>{this.connectionState=uM.CLOSED})),this.websocket.on(gM.FAILED,(()=>{this._disconnectedReason=UI.NETWORK_ERROR,this.connectionState=uM.CLOSED})),this.websocket.on(gM.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===uM.CONNECTED?this.connectionState=uM.RECONNECTING:this.connectionState=uM.CONNECTING})),this.websocket.on(gM.WILL_RECONNECT,((e,t,n)=>{"retry"!==e?(qO.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):qO.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)})),this.websocket.on(gM.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((e=>{if(this.emit(dM.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof gI&&e.code===mI.UNEXPECTED_RESPONSE&&e.data.code===lM.ERR_NO_AUTHORIZED)return qO.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",zI.SERVER_ERROR);qO.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",zI.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(gM.REQUEST_NEW_URLS,((e,t)=>{qI(this,dM.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(gM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(fM.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const ZK={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new YK(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new QK(n,t)}};function e$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function t$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e$(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class n${constructor(e){JT(this,"sessionDesc",void 0),JT(this,"localCapabilities",void 0),JT(this,"rtpCapabilities",void 0),JT(this,"candidates",void 0),JT(this,"_originCandidates",void 0),JT(this,"iceParameters",void 0),JT(this,"dtlsParameters",void 0),JT(this,"setup",void 0),JT(this,"currentMidIndex",void 0),JT(this,"cname",void 0),e=ex(e);const{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:o,localCapabilities:s,sdkCodec:a,cname:c}=e,l=CO("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this._originCandidates=ex(r),this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=s,this.cname=c;for(let u=0;u<l.mediaDescriptions.length;u++){const e=l.mediaDescriptions[u];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));let t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Nr(n=t.encodingName.toLowerCase()).call(n,a)}));0===t.length&&(t=i.videoCodecs),e.attributes.payloads=t,e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[u]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return AO(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=Zj(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===HM.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),s=r[0].attributes.label,a=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:s,mslabel:a}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{Nr(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;Nr(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter((e=>"udp"===e.transport)),n=[];if(t.forEach((e=>{n.push(t$(t$({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case GM.TCP_RELAY:this.candidates=n;break;case GM.UDP_TCP_RELAY:case GM.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=ex(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=ex(e);return eU(n,t),nU(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===HM.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=ex(e);return tU(t),function(e){const t=e.attributes.extmaps.find((e=>Gj(e.extensionName)));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var r$;function i$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i$(Object(n),!0).forEach((function(t){JT(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let s$=(r$=class e extends zM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Nr(t=Object.keys(yO)).call(t,e)})))]}constructor(t,n){super(t,n),JT(this,"store",void 0),JT(this,"peerConnection",void 0),JT(this,"remoteSDP",void 0),JT(this,"initialOffer",void 0),JT(this,"statsFilter",void 0),JT(this,"useRTX",!1),JT(this,"localCapabilities",void 0),JT(this,"localCandidateCount",0),JT(this,"allCandidatesReceived",!1),JT(this,"establishPromise",void 0),JT(this,"mutex",void 0),this.store=n,this.mutex=new Tx("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=tO(this.peerConnection,fO("STATS_UPDATE_INTERVAL"),void 0,GR()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=Yj(e.sdp),n=$j(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:fO("FILTER_VIDEO_FEC"),filterAudioFec:fO("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,o$(o$({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new gI(mI.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new n$(o$(o$({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new gI(mI.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return VA((function*(){const r=yield FA(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),i=yield FA(n.peerConnection.createOffer()),o=CO(i.sdp),s=e.map((e=>{const t=e._mediaStreamTrack,r=o.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let a;try{a=yield s}catch(e){throw r.forEach((e=>{zR()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,a);const l=n.remoteSDP.toString();return yield FA(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield FA(n.applySendEncodings(r,e)),yield FA(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:s[t],id:n}}))}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{zR()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new zh(((t,r)=>{const o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),s=r=>{const a=jR();if(("Safari"===a.name&&11===Number(a.version)||qR())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",s)})),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),{track:await o,id:n}}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(zR()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(zR()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return VA((function*(){const n=yield FA(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=rk().supportPCSetConfiguration;if(e===GM.RELAY&&!n)return;if(n){const n=t.peerConnection.getConfiguration(),r=e===GM.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(qO.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}e!==GM.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield FA(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=Yj(r.sdp),{remoteIceParameters:o}=yield i.iceParameters;t.remoteSDP.restartICE(o);const s=t.remoteSDP.toString();yield FA(t.peerConnection.setLocalDescription(r)),yield FA(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){qO.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new gI(mI.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new gI(mI.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,qO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,qO.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),fO("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(VI(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),fO("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return qO.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!rk().supportSetRtpSenderParameters)return qO.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof pD)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(fO("DSCP_TYPE")&&lI()){var o;const e=fO("DSCP_TYPE");Nr(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}const s=t.getParameters(),a=null===(n=s.encodings)||void 0===n?void 0:n[0];a&&Object.assign(a,i),Object.assign(s,r),qO.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!rk().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){qO.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=CO(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&eU(i,e)})),AO(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new zh(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),s=t=>{const a=jR();if("Safari"===a.name&&11===Number(a.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",s)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await zh.all(t)}catch(e){throw new gI(mI.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(rk().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},iM(r$.prototype,"connect",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"connect"),r$.prototype),iM(r$.prototype,"stopSending",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"stopSending"),r$.prototype),iM(r$.prototype,"receive",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"receive"),r$.prototype),iM(r$.prototype,"stopReceiving",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"stopReceiving"),r$.prototype),iM(r$.prototype,"muteRemote",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"muteRemote"),r$.prototype),iM(r$.prototype,"unmuteRemote",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"unmuteRemote"),r$.prototype),iM(r$.prototype,"muteLocal",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"muteLocal"),r$.prototype),iM(r$.prototype,"unmuteLocal",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"unmuteLocal"),r$.prototype),iM(r$.prototype,"close",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"close"),r$.prototype),iM(r$.prototype,"updateEncoderConfig",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"updateEncoderConfig"),r$.prototype),iM(r$.prototype,"updateSendParameters",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"updateSendParameters"),r$.prototype),iM(r$.prototype,"replaceTrack",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"replaceTrack"),r$.prototype),iM(r$.prototype,"getRemoteSSRC",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"getRemoteSSRC"),r$.prototype),r$);function a$(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}const c$={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new s$(n,t)}},l$={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!rk().supportWebRTCEncodedTransform)return void qO.warning("browser not support audio encoded transform");if(zD.has(e))return;if(!e.track)return;const n={track:e.track};if(WR()){if(!e.createEncodedStreams)return void qO.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void qO.error("create audio-encoded-streams error",e&&e.message)}const o=new TransformStream({transform(i,o){n.controller||(n.controller=o),e.track&&e.track.id!==n.track.id&&(qO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const s=t.metadata&&t.metadata();s?function(e,t){const{chunk:n,controller:r}=t,i=fO("ENABLE_AUDIO_PTS_METADATA")?BD.AUDIO_64_BIT_PTS:BD.METADATA;n.data=function(e,t,n){const r=n.byteLength,i=r+VD+FD,o=jD+UD+i,s=new ArrayBuffer(e.byteLength+o),a=new DataView(s);a.setUint8(0,MD),a.setUint16(1,i),a.setUint8(3,t),a.setUint16(4,r);for(let l=0;l<r;l++)a.setUint8(6+l,n[l]);const c=new Uint8Array(a.buffer);return c.set(new Uint8Array(e),o),c.buffer}(n.data,i,e),r.enqueue(n)}(s,{sender:e,chunk:i,controller:o}):o.enqueue(i)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(zR()){if("undefined"==typeof RTCRtpScriptTransform)return void qO.warning("browser not support RTCRtpScriptTransform");const i=LD(),o=new MessageChannel;await new zh((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const s=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:o.port2},[o.port2]);e.transform=s,await new zh((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),o.port1.onmessage=i=>{var s;if(i.data.transformed&&e.track&&(null===(s=e.track)||void 0===s?void 0:s.id)!==n.track.id)qO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(i.data.getMetadata){const e=t.metadata&&t.metadata();e&&o.port1.postMessage({metadata:e})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=zD.get(e);if(t){zD.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){qO.warning(e&&e.message)}}}zD.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!rk().supportWebRTCEncodedTransform)return void qO.warning("browser not support audio encoded transform");if(dL.has(e))return;const n={track:e.track,onMetadata:t.onMetadata};if(WR()){if(!e.createEncodedStreams)return void qO.warning("browser not support createEncodedStreams() API");YR(PR.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(e){return void qO.error("create audio-encoded-streams error",e&&e.message)}const o=new TransformStream({transform(i,o){n.controller||(n.controller=o),e.track&&e.track.id!==n.track.id&&(qO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(e,t,n){var r;const i=WD(new DataView(t.data));if(!i)return n.enqueue(t);const o=e.track.id;hL.set(o,e.track);const s=null===(r=i.tlv.find((e=>e.tag===BD.AUDIO_LEVEL)))||void 0===r?void 0:r.value;let a=0;"number"==typeof s&&(a=127-s);const c=Math.round(Math.pow(10,a/60)-1),{selected:l,speaker:u}=function(e,t){let n=tL.get(e);if(n||(n=function(e){const t=new JD;return tL.set(e,t),nL||(nL=new eL(fO("TOPN_SILENCE_THRESHOLD")||500),nL.on("ActiveSpeakerChanged",(e=>{null!=e&&(rL=e)}))),nL.addSpeakers([t]),t}(e)),tL.size<=iL)return{selected:!0,speaker:n};if(!nL)throw new Error("no active speaker detector");return nL.levelChanged(n.id,t),oL=nL.loudest.map((e=>e.id)),rL&&!Nr(oL).call(oL,rL)&&oL.length>=iL&&oL.pop(),{selected:Nr(oL).call(oL,n.id)||n.id===rL,speaker:n}}(e,c),d=function(e,t,n){const r=sL.get(e)||new cL(e,t);return r.score=n,sL.set(e,r),function(e){if(aL.set(e,!0),!lL)return void(lL=Date.now());const t=Date.now();t-lL>1e3&&(aL.get(e)?aL.set(e,!1):(uL(e),aL.delete(e)),lL=t)}(e),r}(o,e.track,u.energyScore);d.addSample(l),d.active&&(t.data=i.frame.buffer,n.enqueue(t))}(e,i,o):t.enableMetadata?function(e,t,n){const r=WD(new DataView(e.data));if(!r)return t.enqueue(e);const i=r.tlv.find((e=>e.tag===BD.METADATA||e.tag===BD.AUDIO_64_BIT_PTS));i&&n&&i.value instanceof Uint8Array&&n(i.value),e.data=r.frame.buffer,t.enqueue(e)}(i,o,t.onMetadata):o.enqueue(i)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(zR()){if("undefined"==typeof RTCRtpScriptTransform)return void qO.warning("browser not support RTCRtpScriptTransform");const t=LD(),i=new MessageChannel;await new zh((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:i.port2},[i.port2]);e.transform=o,await new zh((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(qO.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.metadata&&n.onMetadata&&n.onMetadata(t.data.metadata)},n.worker=t}function r(){e.track.removeEventListener("ended",r),function(e){const t=dL.get(e);if(t){!function(e){const t=tL.get(e);t&&(tL.delete(e),nL&&(nL.removeSpeakers([t]),0===tL.size&&(nL.destroy(),nL=null)))}(e),uL(e.track.id),dL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){qO.warning(e&&e.message)}}}(e)}dL.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!rk().supportWebRTCEncodedTransform)return void qO.warning("browser not support video encoded transform");if(fL.has(e))return;if(!e.track)return;const n={track:e.track};if(WR()){if(!e.createEncodedStreams)return void qO.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void qO.error("create video-encoded-streams error",e&&e.message)}const o=[];t.on("sei-to-send",(e=>{o.push(e)}));const s=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(qO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const s=o.shift();s&&(t.data=function(e,t){const n=function(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),o=r%255,s=new Uint8Array(6+i+1+r+e.byteLength);s[0]=0,s[1]=0,s[2]=0,s[3]=1,s[4]=6,s[5]=101;let a=0;for(;a<i;)s[6+a]=255,a++;return s[6+a]=o,a++,s.set(n,6+a),s.set(new Uint8Array(e),6+a+r),s.buffer}(t.data,s)),i.enqueue(t)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(!zR())return;{if("undefined"==typeof RTCRtpScriptTransform)return void qO.warning("browser not support RTCRtpScriptTransform");const i=LD(),o=new MessageChannel;await new zh((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const s=new RTCRtpScriptTransform(i,{name:"sei-tx",port:o.port2},[o.port2]);e.transform=s,await new zh((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),t.on("sei-to-send",(e=>{o.port1.postMessage({sei:e})})),o.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(qO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=fL.get(e);if(t){fL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){qO.warning(e&&e.message)}}}fL.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!rk().supportWebRTCEncodedTransform)return void qO.warning("browser not support video encoded transform");if(!e.track)return;if(mL.has(e)){const n=mL.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(WR()){if(!e.createEncodedStreams)return void qO.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void qO.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(qO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const o=function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let r=n+6,i=0,o=0;for(;255===(o=t.getUint8(r++));)i+=255;i+=o;const s=pL(e.data,r,i);return new Uint8Array(s)}n++}return null}(t);o&&n.onSei&&n.onSei(o),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if(zR()){if("undefined"==typeof RTCRtpScriptTransform)return void qO.warning("browser not support RTCRtpScriptTransform");const t=LD(),i=new MessageChannel;await new zh((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(t,{name:"sei-rx",port:i.port2},[i.port2]);e.transform=o,await new zh((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(qO.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){const t=mL.get(e);if(t){mL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){qO.warning(e&&e.message)}}}(e)}mL.set(e,n),e.track.addEventListener("ended",r)}},u$={name:"InterceptFrame",create:()=>l$};rO(),pO("PROCESS_ID","process-".concat(hx(8,""),"-").concat(hx(4,""),"-").concat(hx(4,""),"-").concat(hx(4,""),"-").concat(hx(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void qO.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();qO.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(hO,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;gO[e]=r,hO[e]=r}}))}catch(t){qO.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(gO.AREAS)&&gO.AREAS.length>0&&BU(gO.AREAS,!0);const d$=(e,t,n)=>{qO.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),pO(e,t,n)};wU(xq,!1),wU(Mq,!1),wU(qB,!1),wU(pK,!1),wU(Aq,!1),wU(ZK,!1),wU(c$,!1),wU(u$,!1);const h$=function(e){const t=new kI,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===tj.SECURITY_POLICY_VIOLATION&&qW(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return HW(HW({},n),r)}({__TRACK_LIST__:_k,VERSION:iO,BUILD:uO,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:d$,getParameter:fO,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return rk().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new tk(mI.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=ek.reportApiInvoke(null,{name:DI.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:LI.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&cI()&&$R(75)&&(new e).close()}catch(e){return qO.error("check system requirement failed: ",e),!1}let n=!1;const r=jR();r.name===PR.CHROME&&Number(r.version)>=58&&("WebKit"!==LR.engine.name||function(){const e=jR();if(BR()){if(e.os===NR.MAC_OS)return!0;if(e.os===NR.IOS){const e=LR.os.version&&LR.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===PR.FIREFOX&&Number(r.version)>=56||r.name===PR.OPERA&&Number(r.version)>=45||r.name===PR.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(qR()||oI())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||sI()||jR().name===PR.QQ)&&(n=!0),qO.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return gN.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return gN.getRecordingDevices(e)},getCameras:function(e){return gN.getCamerasDevices(e)},getElectronScreenSources:cN,getPlaybackDevices:function(e){return gN.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=hx(5,"client-"),r=ek.reportApiInvoke(null,{id:n,name:DI.CREATE_CLIENT,options:[t],tag:LI.TRACER});try{!function(e){yI(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),yI(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&yI(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&bI(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&FI(e.turnServer),void 0!==e.httpRetryConfig&&MI(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&MI(e.websocketRetryConfig)}(t)}catch(e){throw r.onError(e),e}return(QR(16,0,!0)||ZR(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",qO.debug("browser not support vp9, force use vp8")),pO("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),r.onSuccess(),new jW(MW(MW({forceWaitGatewayResponse:!0},t),{},{role:Nr(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=fO("CAMERA_CAPTURE_CONFIG"),n=hx(8,"track-cam-"),r=ek.reportApiInvoke(null,{id:n,tag:LI.TRACER,name:DI.CREATE_CAM_VIDEO_TRACK,options:[Gk({},e),t]});t&&(e.encoderConfig=t);const i=kN(e);let o=null;qO.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{o=(await hN({video:i},n)).getVideoTracks()[0]||null}catch(e){throw r.onError(e),e}if(!o){const e=new gI(mI.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(qO)}e.optimizationMode&&mD(n,o,e,fk(e.encoderConfig));const s=new fD(o,e,i,e.scalabiltyMode?gk(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(s.getTrackId()),qO.info("create camera video success, trackId:",n),s},createCustomVideoTrack:function(e){const t=hx(8,"track-cus-"),n=ek.reportApiInvoke(null,{id:t,tag:LI.TRACER,name:DI.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new pD(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?gk(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[wk.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),qO.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n="object"==typeof t?function(e){return NN(e)}(t):void 0;n&&(t="auto");const r=hx(8,"track-scr-v-"),i=ek.reportApiInvoke(null,{id:r,tag:LI.TRACER,name:DI.CREATE_SCREEN_VIDEO_TRACK,options:[Gk({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const o=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&WR()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o,preferCurrentTab:s}=e;(KR(107)||XR(107)||eI(93))&&(n&&(yI(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(yI(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(yI(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(KR(105)||XR(105)||eI(91))&&o&&(yI(o,"systemAudio",["exclude","include"]),t.systemAudio=o),(KR(94)||XR(94)||eI(80))&&s&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const a=e.encoderConfig?mk(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:a?a.width:void 0,maxHeight:a?a.height:void 0},a&&(a.frameRate&&("number"==typeof a.frameRate?(t.mandatory.maxFrameRate=a.frameRate,t.mandatory.minFrameRate=a.frameRate):(t.mandatory.maxFrameRate=a.frameRate.max||a.frameRate.ideal||a.frameRate.exact||void 0,t.mandatory.minFrameRate=a.frameRate.min||a.frameRate.ideal||a.frameRate.exact||void 0),t.frameRate=a.frameRate),a.width&&(t.width=a.width),a.height&&(t.height=a.height)),t}(e);let s=null,a=null;const c=rk();if(!c.supportShareAudio&&"enable"===t){const e=new gI(mI.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(e),e.throw(qO)}qO.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const l=c.supportShareAudio&&"disable"!==t;try{const e=await hN({screen:o,screenAudio:l?n||!0:void 0},r);s=e.getVideoTracks()[0]||null,a=e.getAudioTracks()[0]||null}catch(e){throw i.onError(e),e}if(!s){const e=new gI(mI.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(qO)}if(!a&&"enable"===t){s&&s.stop();const e=new gI(mI.SHARE_AUDIO_NOT_ALLOWED);return i.onError(e),e.throw(qO)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(mD(r,s,e,e.encoderConfig&&mk(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const u=new pD(s,e.encoderConfig?mk(e.encoderConfig):{},e.scalabiltyMode?gk(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[wk.SCREEN_TRACK]);if(!a)return i.onSuccess(u.getTrackId()),qO.info("create screen video track success","video:",u.getTrackId()),u;const d=new TP(a,void 0,hx(8,"track-scr-a-"),!1);return i.onSuccess([u.getTrackId(),d.getTrackId()]),qO.info("create screen video track success","video:",u.getTrackId(),"audio:",d.getTrackId()),[u,d]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=fO("CAMERA_CAPTURE_CONFIG"),r=hx(8,"track-mic-"),i=hx(8,"track-cam-"),o=ek.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:LI.TRACER,name:DI.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const s=kN(t),a=PN(e);let c=null,l=null;qO.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await hN({audio:a,video:s},"".concat(r,"-").concat(i));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw o.onError(e),e}if(!c||!l){const e=new gI(mI.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(e),e.throw(qO)}t.optimizationMode&&mD(i,l,t,fk(t.encoderConfig));const u=new CP(c,e,a,r),d=new fD(l,t,s,t.scalabiltyMode?gk(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return o.onSuccess([u.getTrackId(),d.getTrackId()]),qO.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[u,d]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=hx(8,"track-mic-"),n=ek.reportApiInvoke(null,{id:t,tag:LI.TRACER,name:DI.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=PN(e);let i=null;qO.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await hN({audio:r},t)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!i){const e=new gI(mI.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(qO)}const o=new CP(i,e,r,t);return n.onSuccess(o.getTrackId()),qO.info("create microphone audio track success, trackId:",t),o},createCustomAudioTrack:function(e){const t=hx(8,"track-cus-"),n=ek.reportApiInvoke(null,{id:t,tag:LI.TRACER,name:DI.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new TP(e.mediaStreamTrack,e.encoderConfig?yk(e.encoderConfig):{},t,!1);return qO.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},s=hx(8,"track-buf-"),a=ek.reportApiInvoke(null,{id:s,tag:LI.TRACER,name:DI.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(fO("DISABLE_WEBAUDIO"))throw new gI(mI.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");qO.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=xP.get(e);if(t)return qO.debug("use cached audio resource: ",e),t;try{n=(await Ix((()=>AR.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new gI(mI.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new zh(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new gI(mI.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new gI(mI.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=Zk();return new zh(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new gI(mI.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&xP.set(e,r),r}(i,n)}catch(e){return a.onError(e),e.throw(qO)}const l=new IP(i),u=new AP(c,l,r?yk(r):{},s);return qO.info("create buffer source audio track success, trackId:",s),a.onSuccess(u.getTrackId()),u},setAppType:function(e){if(qO.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw qO.debug("Invalid appType"),new tk(mI.INVALID_PARAMS,"invalid app type",e);pO("APP_TYPE",Math.floor(e))},setLogLevel:function(e){qO.setLogLevel(e)},enableLogUpload:function(){fO("USE_NEW_LOG")?pO("UPLOAD_LOG",!0):qO.enableLogUpload()},disableLogUpload:function(){fO("USE_NEW_LOG")?pO("UPLOAD_LOG",!1):qO.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new wV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=ek.reportApiInvoke(null,{tag:LI.TRACER,name:DI.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof TP||e instanceof OD)){const e=new tk(mI.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof TP?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,s=i;const a=Date.now();return new zh((i=>{const c=setInterval((()=>{const l=e.getVolumeLevel();o=l>o?l:o,s=l<s?l:s;const u=o-s>1e-4,d=Date.now()-a;if(u||d>t){clearInterval(c);const t=u,s={duration:d,deviceLabel:r,maxVolumeLevel:o,result:t};qO.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(s))),n.onSuccess(s),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=ek.reportApiInvoke(null,{tag:LI.TRACER,name:DI.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof pD||e instanceof xD)){const e=new tk(mI.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof pD?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(zR()||BR())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const s=document.createElement("canvas");s.width=160,s.height=120;let a=0,c=0;try{const e=Date.now();a=await function(e,t,n,r){let i,o=0,s=null;return new zh(((a,c)=>{function l(){o>r&&i&&(i(),a(o));const t=n.getContext("2d");if(!t){const e=new tk(mI.UNEXPECTED_ERROR,"can not get canvas 2d context.");return qO.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),u=Math.floor(l.data.length/3);if(s){for(let e=0;e<u;e+=3)if(l.data[e]!==s[e])return o+=1,void(s=l.data);s=l.data}else s=l.data}setTimeout((()=>{i&&(i(),a(o))}),t),i=nN((()=>{l()}),30)}))}(o,t,s,4),c=Date.now()-e}catch(e){throw n.onError(e),e}zF===PR.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const l=a>4,u={duration:c,changedPicNum:a,deviceLabel:r,result:l};return qO.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(u))),n.onSuccess(u),l},setArea:BU,audioElementPlayCenter:wN,resumeAudioContext:function(){wN.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){WW.processExternalMediaAEC(e)},registerExtensions:function(e){const t=fO("PLUGIN_INFO")||[];e.forEach((e=>{"name"in e&&!Nr(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=qO.extLog,n.reporter.hookApiInvoke=ek.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((e=>{n.parameters[e]=fO(e)}))})),d$("PLUGIN_INFO",t)},ChannelMediaRelayError:kM,ChannelMediaRelayEvent:xM,ChannelMediaRelayState:OM,RemoteStreamFallbackType:Ck,RemoteStreamType:Tk,ConnectionDisconnectedReason:UI,AudienceLatencyLevelType:jI,AREAS:MM,preload:async function(e,t,n,r){return rB(e,t,n,r)}});return Object.defineProperties(h$,{onAudioAutoplayFailed:{get:()=>yN.onAudioAutoplayFailed,set:e=>{yN.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>yN.onAutoplayFailed,set:e=>{yN.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>h$._onSecurityPolicyViolation,set(e){h$._onSecurityPolicyViolation=e,qW(e)}},__CLIENT_LIST__:{get:()=>fO("SHOW_GLOBAL_CLIENT_LIST")?yL:[]}}),gN.on(Vk.CAMERA_DEVICE_CHANGED,(e=>{qO.info("camera device changed",JSON.stringify(e)),h$.onCameraChanged&&h$.onCameraChanged(e),h$.safeEmit(tj.CAMERA_CHANGED,e)})),gN.on(Vk.RECORDING_DEVICE_CHANGED,(e=>{qO.info("microphone device changed",JSON.stringify(e)),h$.onMicrophoneChanged&&h$.onMicrophoneChanged(e),h$.safeEmit(tj.MICROPHONE_CHANGED,e)})),gN.on(Vk.PLAYOUT_DEVICE_CHANGED,(e=>{qO.debug("playout device changed",JSON.stringify(e)),h$.onPlaybackDeviceChanged&&h$.onPlaybackDeviceChanged(e),h$.safeEmit(tj.PLAYBACK_DEVICE_CHANGED,e)})),wN.onAutoplayFailed=()=>{qO.info("detect audio element autoplay failed"),yN.onAudioAutoplayFailed&&yN.onAudioAutoplayFailed()},Qk.on("autoplay-failed",(()=>{qO.info("detect webaudio autoplay failed"),yN.onAudioAutoplayFailed&&yN.onAudioAutoplayFailed(),h$.safeEmit(tj.AUTOPLAY_FAILED)})),Qk.on(sk.STATE_CHANGE,((e,t)=>{qO.info("audio context state changed: ".concat(t," => ").concat(e)),h$.onAudioContextStateChanged&&h$.onAudioContextStateChanged(e,t),h$.safeEmit(tj.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),XI.on(GI.NETWORK_STATE_CHANGE,((e,t)=>{qO.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=h$),h$}()},630:(e,t,n)=>{"use strict";e.exports=n(2138)},827:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(8635).A},1014:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(3539).A},1209:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(1927).A},1352:(e,t,n)=>{"use strict";var r=n(7119);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},1397:function(e,t,n){var r;e=n.nmd(e),function(){var i,o="Expected a function",s="__lodash_hash_undefined__",a="__lodash_placeholder__",c=16,l=32,u=64,d=128,h=256,p=1/0,f=9007199254740991,m=NaN,g=4294967295,v=[["ary",d],["bind",1],["bindKey",2],["curry",8],["curryRight",c],["flip",512],["partial",l],["partialRight",u],["rearg",h]],y="[object Arguments]",_="[object Array]",E="[object Boolean]",b="[object Date]",w="[object Error]",S="[object Function]",T="[object GeneratorFunction]",C="[object Map]",A="[object Number]",R="[object Object]",I="[object Promise]",x="[object RegExp]",O="[object Set]",k="[object String]",N="[object Symbol]",P="[object WeakMap]",D="[object ArrayBuffer]",L="[object DataView]",M="[object Float32Array]",j="[object Float64Array]",U="[object Int8Array]",V="[object Int16Array]",F="[object Int32Array]",B="[object Uint8Array]",W="[object Uint8ClampedArray]",z="[object Uint16Array]",H="[object Uint32Array]",G=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,K=/(__e\(.*?\)|\b__t\)) \+\n'';/g,$=/&(?:amp|lt|gt|quot|#39);/g,Y=/[&<>"']/g,X=RegExp($.source),J=RegExp(Y.source),Q=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,ee=/<%=([\s\S]+?)%>/g,te=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ne=/^\w*$/,re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ie=/[\\^$.*+?()[\]{}|]/g,oe=RegExp(ie.source),se=/^\s+/,ae=/\s/,ce=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,le=/\{\n\/\* \[wrapped with (.+)\] \*/,ue=/,? & /,de=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,he=/[()=,{}\[\]\/\s]/,pe=/\\(\\)?/g,fe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,me=/\w*$/,ge=/^[-+]0x[0-9a-f]+$/i,ve=/^0b[01]+$/i,ye=/^\[object .+?Constructor\]$/,_e=/^0o[0-7]+$/i,Ee=/^(?:0|[1-9]\d*)$/,be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,we=/($^)/,Se=/['\n\r\u2028\u2029\\]/g,Te="\\ud800-\\udfff",Ce="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ae="\\u2700-\\u27bf",Re="a-z\\xdf-\\xf6\\xf8-\\xff",Ie="A-Z\\xc0-\\xd6\\xd8-\\xde",xe="\\ufe0e\\ufe0f",Oe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ke="['\u2019]",Ne="["+Te+"]",Pe="["+Oe+"]",De="["+Ce+"]",Le="\\d+",Me="["+Ae+"]",je="["+Re+"]",Ue="[^"+Te+Oe+Le+Ae+Re+Ie+"]",Ve="\\ud83c[\\udffb-\\udfff]",Fe="[^"+Te+"]",Be="(?:\\ud83c[\\udde6-\\uddff]){2}",We="[\\ud800-\\udbff][\\udc00-\\udfff]",ze="["+Ie+"]",He="\\u200d",Ge="(?:"+je+"|"+Ue+")",qe="(?:"+ze+"|"+Ue+")",Ke="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",$e="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Ye="(?:"+De+"|"+Ve+")"+"?",Xe="["+xe+"]?",Je=Xe+Ye+("(?:"+He+"(?:"+[Fe,Be,We].join("|")+")"+Xe+Ye+")*"),Qe="(?:"+[Me,Be,We].join("|")+")"+Je,Ze="(?:"+[Fe+De+"?",De,Be,We,Ne].join("|")+")",et=RegExp(ke,"g"),tt=RegExp(De,"g"),nt=RegExp(Ve+"(?="+Ve+")|"+Ze+Je,"g"),rt=RegExp([ze+"?"+je+"+"+Ke+"(?="+[Pe,ze,"$"].join("|")+")",qe+"+"+$e+"(?="+[Pe,ze+Ge,"$"].join("|")+")",ze+"?"+Ge+"+"+Ke,ze+"+"+$e,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Qe].join("|"),"g"),it=RegExp("["+He+Te+Ce+xe+"]"),ot=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,st=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],at=-1,ct={};ct[M]=ct[j]=ct[U]=ct[V]=ct[F]=ct[B]=ct[W]=ct[z]=ct[H]=!0,ct[y]=ct[_]=ct[D]=ct[E]=ct[L]=ct[b]=ct[w]=ct[S]=ct[C]=ct[A]=ct[R]=ct[x]=ct[O]=ct[k]=ct[P]=!1;var lt={};lt[y]=lt[_]=lt[D]=lt[L]=lt[E]=lt[b]=lt[M]=lt[j]=lt[U]=lt[V]=lt[F]=lt[C]=lt[A]=lt[R]=lt[x]=lt[O]=lt[k]=lt[N]=lt[B]=lt[W]=lt[z]=lt[H]=!0,lt[w]=lt[S]=lt[P]=!1;var ut={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},dt=parseFloat,ht=parseInt,pt="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,ft="object"==typeof self&&self&&self.Object===Object&&self,mt=pt||ft||Function("return this")(),gt=t&&!t.nodeType&&t,vt=gt&&e&&!e.nodeType&&e,yt=vt&&vt.exports===gt,_t=yt&&pt.process,Et=function(){try{var e=vt&&vt.require&&vt.require("util").types;return e||_t&&_t.binding&&_t.binding("util")}catch(t){}}(),bt=Et&&Et.isArrayBuffer,wt=Et&&Et.isDate,St=Et&&Et.isMap,Tt=Et&&Et.isRegExp,Ct=Et&&Et.isSet,At=Et&&Et.isTypedArray;function Rt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function It(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var s=e[i];t(r,s,n(s),e)}return r}function xt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Ot(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function kt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Nt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}function Pt(e,t){return!!(null==e?0:e.length)&&zt(e,t,0)>-1}function Dt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Lt(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Mt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function jt(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function Ut(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function Vt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var Ft=Kt("length");function Bt(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function Wt(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function zt(e,t,n){return t===t?function(e,t,n){var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):Wt(e,Gt,n)}function Ht(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function Gt(e){return e!==e}function qt(e,t){var n=null==e?0:e.length;return n?Xt(e,t)/n:m}function Kt(e){return function(t){return null==t?i:t[e]}}function $t(e){return function(t){return null==e?i:e[t]}}function Yt(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function Xt(e,t){for(var n,r=-1,o=e.length;++r<o;){var s=t(e[r]);s!==i&&(n=n===i?s:n+s)}return n}function Jt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Qt(e){return e?e.slice(0,gn(e)+1).replace(se,""):e}function Zt(e){return function(t){return e(t)}}function en(e,t){return Lt(t,(function(t){return e[t]}))}function tn(e,t){return e.has(t)}function nn(e,t){for(var n=-1,r=e.length;++n<r&&zt(t,e[n],0)>-1;);return n}function rn(e,t){for(var n=e.length;n--&&zt(t,e[n],0)>-1;);return n}var on=$t({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),sn=$t({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(e){return"\\"+ut[e]}function cn(e){return it.test(e)}function ln(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function un(e,t){return function(n){return e(t(n))}}function dn(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var s=e[n];s!==t&&s!==a||(e[n]=a,o[i++]=n)}return o}function hn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function pn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function fn(e){return cn(e)?function(e){var t=nt.lastIndex=0;for(;nt.test(e);)++t;return t}(e):Ft(e)}function mn(e){return cn(e)?function(e){return e.match(nt)||[]}(e):function(e){return e.split("")}(e)}function gn(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var vn=$t({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var yn=function e(t){var n=(t=null==t?mt:yn.defaults(mt.Object(),t,yn.pick(mt,st))).Array,r=t.Date,ae=t.Error,Te=t.Function,Ce=t.Math,Ae=t.Object,Re=t.RegExp,Ie=t.String,xe=t.TypeError,Oe=n.prototype,ke=Te.prototype,Ne=Ae.prototype,Pe=t["__core-js_shared__"],De=ke.toString,Le=Ne.hasOwnProperty,Me=0,je=function(){var e=/[^.]+$/.exec(Pe&&Pe.keys&&Pe.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ue=Ne.toString,Ve=De.call(Ae),Fe=mt._,Be=Re("^"+De.call(Le).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),We=yt?t.Buffer:i,ze=t.Symbol,He=t.Uint8Array,Ge=We?We.allocUnsafe:i,qe=un(Ae.getPrototypeOf,Ae),Ke=Ae.create,$e=Ne.propertyIsEnumerable,Ye=Oe.splice,Xe=ze?ze.isConcatSpreadable:i,Je=ze?ze.iterator:i,Qe=ze?ze.toStringTag:i,Ze=function(){try{var e=ho(Ae,"defineProperty");return e({},"",{}),e}catch(t){}}(),nt=t.clearTimeout!==mt.clearTimeout&&t.clearTimeout,it=r&&r.now!==mt.Date.now&&r.now,ut=t.setTimeout!==mt.setTimeout&&t.setTimeout,pt=Ce.ceil,ft=Ce.floor,gt=Ae.getOwnPropertySymbols,vt=We?We.isBuffer:i,_t=t.isFinite,Et=Oe.join,Ft=un(Ae.keys,Ae),$t=Ce.max,_n=Ce.min,En=r.now,bn=t.parseInt,wn=Ce.random,Sn=Oe.reverse,Tn=ho(t,"DataView"),Cn=ho(t,"Map"),An=ho(t,"Promise"),Rn=ho(t,"Set"),In=ho(t,"WeakMap"),xn=ho(Ae,"create"),On=In&&new In,kn={},Nn=Uo(Tn),Pn=Uo(Cn),Dn=Uo(An),Ln=Uo(Rn),Mn=Uo(In),jn=ze?ze.prototype:i,Un=jn?jn.valueOf:i,Vn=jn?jn.toString:i;function Fn(e){if(ta(e)&&!Hs(e)&&!(e instanceof Hn)){if(e instanceof zn)return e;if(Le.call(e,"__wrapped__"))return Vo(e)}return new zn(e)}var Bn=function(){function e(){}return function(t){if(!ea(t))return{};if(Ke)return Ke(t);e.prototype=t;var n=new e;return e.prototype=i,n}}();function Wn(){}function zn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function Hn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=g,this.__views__=[]}function Gn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function qn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Kn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function $n(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Kn;++t<n;)this.add(e[t])}function Yn(e){var t=this.__data__=new qn(e);this.size=t.size}function Xn(e,t){var n=Hs(e),r=!n&&zs(e),i=!n&&!r&&$s(e),o=!n&&!r&&!i&&la(e),s=n||r||i||o,a=s?Jt(e.length,Ie):[],c=a.length;for(var l in e)!t&&!Le.call(e,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||_o(l,c))||a.push(l);return a}function Jn(e){var t=e.length;return t?e[$r(0,t-1)]:i}function Qn(e,t){return Lo(xi(e),ar(t,0,e.length))}function Zn(e){return Lo(xi(e))}function er(e,t,n){(n!==i&&!Fs(e[t],n)||n===i&&!(t in e))&&or(e,t,n)}function tr(e,t,n){var r=e[t];Le.call(e,t)&&Fs(r,n)&&(n!==i||t in e)||or(e,t,n)}function nr(e,t){for(var n=e.length;n--;)if(Fs(e[n][0],t))return n;return-1}function rr(e,t,n,r){return hr(e,(function(e,i,o){t(r,e,n(e),o)})),r}function ir(e,t){return e&&Oi(t,ka(t),e)}function or(e,t,n){"__proto__"==t&&Ze?Ze(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function sr(e,t){for(var r=-1,o=t.length,s=n(o),a=null==e;++r<o;)s[r]=a?i:Aa(e,t[r]);return s}function ar(e,t,n){return e===e&&(n!==i&&(e=e<=n?e:n),t!==i&&(e=e>=t?e:t)),e}function cr(e,t,n,r,o,s){var a,c=1&t,l=2&t,u=4&t;if(n&&(a=o?n(e,r,o,s):n(e)),a!==i)return a;if(!ea(e))return e;var d=Hs(e);if(d){if(a=function(e){var t=e.length,n=new e.constructor(t);t&&"string"==typeof e[0]&&Le.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!c)return xi(e,a)}else{var h=mo(e),p=h==S||h==T;if($s(e))return Si(e,c);if(h==R||h==y||p&&!o){if(a=l||p?{}:vo(e),!c)return l?function(e,t){return Oi(e,fo(e),t)}(e,function(e,t){return e&&Oi(t,Na(t),e)}(a,e)):function(e,t){return Oi(e,po(e),t)}(e,ir(a,e))}else{if(!lt[h])return o?e:{};a=function(e,t,n){var r=e.constructor;switch(t){case D:return Ti(e);case E:case b:return new r(+e);case L:return function(e,t){var n=t?Ti(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case M:case j:case U:case V:case F:case B:case W:case z:case H:return Ci(e,n);case C:return new r;case A:case k:return new r(e);case x:return function(e){var t=new e.constructor(e.source,me.exec(e));return t.lastIndex=e.lastIndex,t}(e);case O:return new r;case N:return i=e,Un?Ae(Un.call(i)):{}}var i}(e,h,c)}}s||(s=new Yn);var f=s.get(e);if(f)return f;s.set(e,a),sa(e)?e.forEach((function(r){a.add(cr(r,t,n,r,e,s))})):na(e)&&e.forEach((function(r,i){a.set(i,cr(r,t,n,i,e,s))}));var m=d?i:(u?l?io:ro:l?Na:ka)(e);return xt(m||e,(function(r,i){m&&(r=e[i=r]),tr(a,i,cr(r,t,n,i,e,s))})),a}function lr(e,t,n){var r=n.length;if(null==e)return!r;for(e=Ae(e);r--;){var o=n[r],s=t[o],a=e[o];if(a===i&&!(o in e)||!s(a))return!1}return!0}function ur(e,t,n){if("function"!=typeof e)throw new xe(o);return ko((function(){e.apply(i,n)}),t)}function dr(e,t,n,r){var i=-1,o=Pt,s=!0,a=e.length,c=[],l=t.length;if(!a)return c;n&&(t=Lt(t,Zt(n))),r?(o=Dt,s=!1):t.length>=200&&(o=tn,s=!1,t=new $n(t));e:for(;++i<a;){var u=e[i],d=null==n?u:n(u);if(u=r||0!==u?u:0,s&&d===d){for(var h=l;h--;)if(t[h]===d)continue e;c.push(u)}else o(t,d,r)||c.push(u)}return c}Fn.templateSettings={escape:Q,evaluate:Z,interpolate:ee,variable:"",imports:{_:Fn}},Fn.prototype=Wn.prototype,Fn.prototype.constructor=Fn,zn.prototype=Bn(Wn.prototype),zn.prototype.constructor=zn,Hn.prototype=Bn(Wn.prototype),Hn.prototype.constructor=Hn,Gn.prototype.clear=function(){this.__data__=xn?xn(null):{},this.size=0},Gn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gn.prototype.get=function(e){var t=this.__data__;if(xn){var n=t[e];return n===s?i:n}return Le.call(t,e)?t[e]:i},Gn.prototype.has=function(e){var t=this.__data__;return xn?t[e]!==i:Le.call(t,e)},Gn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=xn&&t===i?s:t,this},qn.prototype.clear=function(){this.__data__=[],this.size=0},qn.prototype.delete=function(e){var t=this.__data__,n=nr(t,e);return!(n<0)&&(n==t.length-1?t.pop():Ye.call(t,n,1),--this.size,!0)},qn.prototype.get=function(e){var t=this.__data__,n=nr(t,e);return n<0?i:t[n][1]},qn.prototype.has=function(e){return nr(this.__data__,e)>-1},qn.prototype.set=function(e,t){var n=this.__data__,r=nr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Kn.prototype.clear=function(){this.size=0,this.__data__={hash:new Gn,map:new(Cn||qn),string:new Gn}},Kn.prototype.delete=function(e){var t=lo(this,e).delete(e);return this.size-=t?1:0,t},Kn.prototype.get=function(e){return lo(this,e).get(e)},Kn.prototype.has=function(e){return lo(this,e).has(e)},Kn.prototype.set=function(e,t){var n=lo(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},$n.prototype.add=$n.prototype.push=function(e){return this.__data__.set(e,s),this},$n.prototype.has=function(e){return this.__data__.has(e)},Yn.prototype.clear=function(){this.__data__=new qn,this.size=0},Yn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Yn.prototype.get=function(e){return this.__data__.get(e)},Yn.prototype.has=function(e){return this.__data__.has(e)},Yn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof qn){var r=n.__data__;if(!Cn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Kn(r)}return n.set(e,t),this.size=n.size,this};var hr=Pi(Er),pr=Pi(br,!0);function fr(e,t){var n=!0;return hr(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function mr(e,t,n){for(var r=-1,o=e.length;++r<o;){var s=e[r],a=t(s);if(null!=a&&(c===i?a===a&&!ca(a):n(a,c)))var c=a,l=s}return l}function gr(e,t){var n=[];return hr(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function vr(e,t,n,r,i){var o=-1,s=e.length;for(n||(n=yo),i||(i=[]);++o<s;){var a=e[o];t>0&&n(a)?t>1?vr(a,t-1,n,r,i):Mt(i,a):r||(i[i.length]=a)}return i}var yr=Di(),_r=Di(!0);function Er(e,t){return e&&yr(e,t,ka)}function br(e,t){return e&&_r(e,t,ka)}function wr(e,t){return Nt(t,(function(t){return Js(e[t])}))}function Sr(e,t){for(var n=0,r=(t=_i(t,e)).length;null!=e&&n<r;)e=e[jo(t[n++])];return n&&n==r?e:i}function Tr(e,t,n){var r=t(e);return Hs(e)?r:Mt(r,n(e))}function Cr(e){return null==e?e===i?"[object Undefined]":"[object Null]":Qe&&Qe in Ae(e)?function(e){var t=Le.call(e,Qe),n=e[Qe];try{e[Qe]=i;var r=!0}catch(s){}var o=Ue.call(e);r&&(t?e[Qe]=n:delete e[Qe]);return o}(e):function(e){return Ue.call(e)}(e)}function Ar(e,t){return e>t}function Rr(e,t){return null!=e&&Le.call(e,t)}function Ir(e,t){return null!=e&&t in Ae(e)}function xr(e,t,r){for(var o=r?Dt:Pt,s=e[0].length,a=e.length,c=a,l=n(a),u=1/0,d=[];c--;){var h=e[c];c&&t&&(h=Lt(h,Zt(t))),u=_n(h.length,u),l[c]=!r&&(t||s>=120&&h.length>=120)?new $n(c&&h):i}h=e[0];var p=-1,f=l[0];e:for(;++p<s&&d.length<u;){var m=h[p],g=t?t(m):m;if(m=r||0!==m?m:0,!(f?tn(f,g):o(d,g,r))){for(c=a;--c;){var v=l[c];if(!(v?tn(v,g):o(e[c],g,r)))continue e}f&&f.push(g),d.push(m)}}return d}function Or(e,t,n){var r=null==(e=Io(e,t=_i(t,e)))?e:e[jo(Xo(t))];return null==r?i:Rt(r,e,n)}function kr(e){return ta(e)&&Cr(e)==y}function Nr(e,t,n,r,o){return e===t||(null==e||null==t||!ta(e)&&!ta(t)?e!==e&&t!==t:function(e,t,n,r,o,s){var a=Hs(e),c=Hs(t),l=a?_:mo(e),u=c?_:mo(t),d=(l=l==y?R:l)==R,h=(u=u==y?R:u)==R,p=l==u;if(p&&$s(e)){if(!$s(t))return!1;a=!0,d=!1}if(p&&!d)return s||(s=new Yn),a||la(e)?to(e,t,n,r,o,s):function(e,t,n,r,i,o,s){switch(n){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case D:return!(e.byteLength!=t.byteLength||!o(new He(e),new He(t)));case E:case b:case A:return Fs(+e,+t);case w:return e.name==t.name&&e.message==t.message;case x:case k:return e==t+"";case C:var a=ln;case O:var c=1&r;if(a||(a=hn),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;r|=2,s.set(e,t);var u=to(a(e),a(t),r,i,o,s);return s.delete(e),u;case N:if(Un)return Un.call(e)==Un.call(t)}return!1}(e,t,l,n,r,o,s);if(!(1&n)){var f=d&&Le.call(e,"__wrapped__"),m=h&&Le.call(t,"__wrapped__");if(f||m){var g=f?e.value():e,v=m?t.value():t;return s||(s=new Yn),o(g,v,n,r,s)}}if(!p)return!1;return s||(s=new Yn),function(e,t,n,r,o,s){var a=1&n,c=ro(e),l=c.length,u=ro(t),d=u.length;if(l!=d&&!a)return!1;var h=l;for(;h--;){var p=c[h];if(!(a?p in t:Le.call(t,p)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var g=!0;s.set(e,t),s.set(t,e);var v=a;for(;++h<l;){var y=e[p=c[h]],_=t[p];if(r)var E=a?r(_,y,p,t,e,s):r(y,_,p,e,t,s);if(!(E===i?y===_||o(y,_,n,r,s):E)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var b=e.constructor,w=t.constructor;b==w||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w||(g=!1)}return s.delete(e),s.delete(t),g}(e,t,n,r,o,s)}(e,t,n,r,Nr,o))}function Pr(e,t,n,r){var o=n.length,s=o,a=!r;if(null==e)return!s;for(e=Ae(e);o--;){var c=n[o];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<s;){var l=(c=n[o])[0],u=e[l],d=c[1];if(a&&c[2]){if(u===i&&!(l in e))return!1}else{var h=new Yn;if(r)var p=r(u,d,l,e,t,h);if(!(p===i?Nr(d,u,3,r,h):p))return!1}}return!0}function Dr(e){return!(!ea(e)||(t=e,je&&je in t))&&(Js(e)?Be:ye).test(Uo(e));var t}function Lr(e){return"function"==typeof e?e:null==e?rc:"object"==typeof e?Hs(e)?Br(e[0],e[1]):Fr(e):hc(e)}function Mr(e){if(!To(e))return Ft(e);var t=[];for(var n in Ae(e))Le.call(e,n)&&"constructor"!=n&&t.push(n);return t}function jr(e){if(!ea(e))return function(e){var t=[];if(null!=e)for(var n in Ae(e))t.push(n);return t}(e);var t=To(e),n=[];for(var r in e)("constructor"!=r||!t&&Le.call(e,r))&&n.push(r);return n}function Ur(e,t){return e<t}function Vr(e,t){var r=-1,i=qs(e)?n(e.length):[];return hr(e,(function(e,n,o){i[++r]=t(e,n,o)})),i}function Fr(e){var t=uo(e);return 1==t.length&&t[0][2]?Ao(t[0][0],t[0][1]):function(n){return n===e||Pr(n,e,t)}}function Br(e,t){return bo(e)&&Co(t)?Ao(jo(e),t):function(n){var r=Aa(n,e);return r===i&&r===t?Ra(n,e):Nr(t,r,3)}}function Wr(e,t,n,r,o){e!==t&&yr(t,(function(s,a){if(o||(o=new Yn),ea(s))!function(e,t,n,r,o,s,a){var c=xo(e,n),l=xo(t,n),u=a.get(l);if(u)return void er(e,n,u);var d=s?s(c,l,n+"",e,t,a):i,h=d===i;if(h){var p=Hs(l),f=!p&&$s(l),m=!p&&!f&&la(l);d=l,p||f||m?Hs(c)?d=c:Ks(c)?d=xi(c):f?(h=!1,d=Si(l,!0)):m?(h=!1,d=Ci(l,!0)):d=[]:ia(l)||zs(l)?(d=c,zs(c)?d=va(c):ea(c)&&!Js(c)||(d=vo(l))):h=!1}h&&(a.set(l,d),o(d,l,r,s,a),a.delete(l));er(e,n,d)}(e,t,a,n,Wr,r,o);else{var c=r?r(xo(e,a),s,a+"",e,t,o):i;c===i&&(c=s),er(e,a,c)}}),Na)}function zr(e,t){var n=e.length;if(n)return _o(t+=t<0?n:0,n)?e[t]:i}function Hr(e,t,n){t=t.length?Lt(t,(function(e){return Hs(e)?function(t){return Sr(t,1===e.length?e[0]:e)}:e})):[rc];var r=-1;t=Lt(t,Zt(co()));var i=Vr(e,(function(e,n,i){var o=Lt(t,(function(t){return t(e)}));return{criteria:o,index:++r,value:e}}));return function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(i,(function(e,t){return function(e,t,n){var r=-1,i=e.criteria,o=t.criteria,s=i.length,a=n.length;for(;++r<s;){var c=Ai(i[r],o[r]);if(c)return r>=a?c:c*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function Gr(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var s=t[r],a=Sr(e,s);n(a,s)&&Zr(o,_i(s,e),a)}return o}function qr(e,t,n,r){var i=r?Ht:zt,o=-1,s=t.length,a=e;for(e===t&&(t=xi(t)),n&&(a=Lt(e,Zt(n)));++o<s;)for(var c=0,l=t[o],u=n?n(l):l;(c=i(a,u,c,r))>-1;)a!==e&&Ye.call(a,c,1),Ye.call(e,c,1);return e}function Kr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;_o(i)?Ye.call(e,i,1):di(e,i)}}return e}function $r(e,t){return e+ft(wn()*(t-e+1))}function Yr(e,t){var n="";if(!e||t<1||t>f)return n;do{t%2&&(n+=e),(t=ft(t/2))&&(e+=e)}while(t);return n}function Xr(e,t){return No(Ro(e,t,rc),e+"")}function Jr(e){return Jn(Fa(e))}function Qr(e,t){var n=Fa(e);return Lo(n,ar(t,0,n.length))}function Zr(e,t,n,r){if(!ea(e))return e;for(var o=-1,s=(t=_i(t,e)).length,a=s-1,c=e;null!=c&&++o<s;){var l=jo(t[o]),u=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(o!=a){var d=c[l];(u=r?r(d,l,c):i)===i&&(u=ea(d)?d:_o(t[o+1])?[]:{})}tr(c,l,u),c=c[l]}return e}var ei=On?function(e,t){return On.set(e,t),e}:rc,ti=Ze?function(e,t){return Ze(e,"toString",{configurable:!0,enumerable:!1,value:ec(t),writable:!0})}:rc;function ni(e){return Lo(Fa(e))}function ri(e,t,r){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var s=n(o);++i<o;)s[i]=e[i+t];return s}function ii(e,t){var n;return hr(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function oi(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t===t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,s=e[o];null!==s&&!ca(s)&&(n?s<=t:s<t)?r=o+1:i=o}return i}return si(e,t,rc,n)}function si(e,t,n,r){var o=0,s=null==e?0:e.length;if(0===s)return 0;for(var a=(t=n(t))!==t,c=null===t,l=ca(t),u=t===i;o<s;){var d=ft((o+s)/2),h=n(e[d]),p=h!==i,f=null===h,m=h===h,g=ca(h);if(a)var v=r||m;else v=u?m&&(r||p):c?m&&p&&(r||!f):l?m&&p&&!f&&(r||!g):!f&&!g&&(r?h<=t:h<t);v?o=d+1:s=d}return _n(s,4294967294)}function ai(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var s=e[n],a=t?t(s):s;if(!n||!Fs(a,c)){var c=a;o[i++]=0===s?0:s}}return o}function ci(e){return"number"==typeof e?e:ca(e)?m:+e}function li(e){if("string"==typeof e)return e;if(Hs(e))return Lt(e,li)+"";if(ca(e))return Vn?Vn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ui(e,t,n){var r=-1,i=Pt,o=e.length,s=!0,a=[],c=a;if(n)s=!1,i=Dt;else if(o>=200){var l=t?null:Yi(e);if(l)return hn(l);s=!1,i=tn,c=new $n}else c=t?[]:a;e:for(;++r<o;){var u=e[r],d=t?t(u):u;if(u=n||0!==u?u:0,s&&d===d){for(var h=c.length;h--;)if(c[h]===d)continue e;t&&c.push(d),a.push(u)}else i(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}function di(e,t){return null==(e=Io(e,t=_i(t,e)))||delete e[jo(Xo(t))]}function hi(e,t,n,r){return Zr(e,t,n(Sr(e,t)),r)}function pi(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?ri(e,r?0:o,r?o+1:i):ri(e,r?o+1:0,r?i:o)}function fi(e,t){var n=e;return n instanceof Hn&&(n=n.value()),jt(t,(function(e,t){return t.func.apply(t.thisArg,Mt([e],t.args))}),n)}function mi(e,t,r){var i=e.length;if(i<2)return i?ui(e[0]):[];for(var o=-1,s=n(i);++o<i;)for(var a=e[o],c=-1;++c<i;)c!=o&&(s[o]=dr(s[o]||a,e[c],t,r));return ui(vr(s,1),t,r)}function gi(e,t,n){for(var r=-1,o=e.length,s=t.length,a={};++r<o;){var c=r<s?t[r]:i;n(a,e[r],c)}return a}function vi(e){return Ks(e)?e:[]}function yi(e){return"function"==typeof e?e:rc}function _i(e,t){return Hs(e)?e:bo(e,t)?[e]:Mo(ya(e))}var Ei=Xr;function bi(e,t,n){var r=e.length;return n=n===i?r:n,!t&&n>=r?e:ri(e,t,n)}var wi=nt||function(e){return mt.clearTimeout(e)};function Si(e,t){if(t)return e.slice();var n=e.length,r=Ge?Ge(n):new e.constructor(n);return e.copy(r),r}function Ti(e){var t=new e.constructor(e.byteLength);return new He(t).set(new He(e)),t}function Ci(e,t){var n=t?Ti(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Ai(e,t){if(e!==t){var n=e!==i,r=null===e,o=e===e,s=ca(e),a=t!==i,c=null===t,l=t===t,u=ca(t);if(!c&&!u&&!s&&e>t||s&&a&&l&&!c&&!u||r&&a&&l||!n&&l||!o)return 1;if(!r&&!s&&!u&&e<t||u&&n&&o&&!r&&!s||c&&n&&o||!a&&o||!l)return-1}return 0}function Ri(e,t,r,i){for(var o=-1,s=e.length,a=r.length,c=-1,l=t.length,u=$t(s-a,0),d=n(l+u),h=!i;++c<l;)d[c]=t[c];for(;++o<a;)(h||o<s)&&(d[r[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function Ii(e,t,r,i){for(var o=-1,s=e.length,a=-1,c=r.length,l=-1,u=t.length,d=$t(s-c,0),h=n(d+u),p=!i;++o<d;)h[o]=e[o];for(var f=o;++l<u;)h[f+l]=t[l];for(;++a<c;)(p||o<s)&&(h[f+r[a]]=e[o++]);return h}function xi(e,t){var r=-1,i=e.length;for(t||(t=n(i));++r<i;)t[r]=e[r];return t}function Oi(e,t,n,r){var o=!n;n||(n={});for(var s=-1,a=t.length;++s<a;){var c=t[s],l=r?r(n[c],e[c],c,n,e):i;l===i&&(l=e[c]),o?or(n,c,l):tr(n,c,l)}return n}function ki(e,t){return function(n,r){var i=Hs(n)?It:rr,o=t?t():{};return i(n,e,co(r,2),o)}}function Ni(e){return Xr((function(t,n){var r=-1,o=n.length,s=o>1?n[o-1]:i,a=o>2?n[2]:i;for(s=e.length>3&&"function"==typeof s?(o--,s):i,a&&Eo(n[0],n[1],a)&&(s=o<3?i:s,o=1),t=Ae(t);++r<o;){var c=n[r];c&&e(t,c,r,s)}return t}))}function Pi(e,t){return function(n,r){if(null==n)return n;if(!qs(n))return e(n,r);for(var i=n.length,o=t?i:-1,s=Ae(n);(t?o--:++o<i)&&!1!==r(s[o],o,s););return n}}function Di(e){return function(t,n,r){for(var i=-1,o=Ae(t),s=r(t),a=s.length;a--;){var c=s[e?a:++i];if(!1===n(o[c],c,o))break}return t}}function Li(e){return function(t){var n=cn(t=ya(t))?mn(t):i,r=n?n[0]:t.charAt(0),o=n?bi(n,1).join(""):t.slice(1);return r[e]()+o}}function Mi(e){return function(t){return jt(Ja(za(t).replace(et,"")),e,"")}}function ji(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Bn(e.prototype),r=e.apply(n,t);return ea(r)?r:n}}function Ui(e){return function(t,n,r){var o=Ae(t);if(!qs(t)){var s=co(n,3);t=ka(t),n=function(e){return s(o[e],e,o)}}var a=e(t,n,r);return a>-1?o[s?t[a]:a]:i}}function Vi(e){return no((function(t){var n=t.length,r=n,s=zn.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new xe(o);if(s&&!c&&"wrapper"==so(a))var c=new zn([],!0)}for(r=c?r:n;++r<n;){var l=so(a=t[r]),u="wrapper"==l?oo(a):i;c=u&&wo(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?c[so(u[0])].apply(c,u[3]):1==a.length&&wo(a)?c[l]():c.thru(a)}return function(){var e=arguments,r=e[0];if(c&&1==e.length&&Hs(r))return c.plant(r).value();for(var i=0,o=n?t[i].apply(this,e):r;++i<n;)o=t[i].call(this,o);return o}}))}function Fi(e,t,r,o,s,a,c,l,u,h){var p=t&d,f=1&t,m=2&t,g=24&t,v=512&t,y=m?i:ji(e);return function d(){for(var _=arguments.length,E=n(_),b=_;b--;)E[b]=arguments[b];if(g)var w=ao(d),S=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(E,w);if(o&&(E=Ri(E,o,s,g)),a&&(E=Ii(E,a,c,g)),_-=S,g&&_<h){var T=dn(E,w);return Ki(e,t,Fi,d.placeholder,r,E,T,l,u,h-_)}var C=f?r:this,A=m?C[e]:e;return _=E.length,l?E=function(e,t){var n=e.length,r=_n(t.length,n),o=xi(e);for(;r--;){var s=t[r];e[r]=_o(s,n)?o[s]:i}return e}(E,l):v&&_>1&&E.reverse(),p&&u<_&&(E.length=u),this&&this!==mt&&this instanceof d&&(A=y||ji(A)),A.apply(C,E)}}function Bi(e,t){return function(n,r){return function(e,t,n,r){return Er(e,(function(e,i,o){t(r,n(e),i,o)})),r}(n,e,t(r),{})}}function Wi(e,t){return function(n,r){var o;if(n===i&&r===i)return t;if(n!==i&&(o=n),r!==i){if(o===i)return r;"string"==typeof n||"string"==typeof r?(n=li(n),r=li(r)):(n=ci(n),r=ci(r)),o=e(n,r)}return o}}function zi(e){return no((function(t){return t=Lt(t,Zt(co())),Xr((function(n){var r=this;return e(t,(function(e){return Rt(e,r,n)}))}))}))}function Hi(e,t){var n=(t=t===i?" ":li(t)).length;if(n<2)return n?Yr(t,e):t;var r=Yr(t,pt(e/fn(t)));return cn(t)?bi(mn(r),0,e).join(""):r.slice(0,e)}function Gi(e){return function(t,r,o){return o&&"number"!=typeof o&&Eo(t,r,o)&&(r=o=i),t=pa(t),r===i?(r=t,t=0):r=pa(r),function(e,t,r,i){for(var o=-1,s=$t(pt((t-e)/(r||1)),0),a=n(s);s--;)a[i?s:++o]=e,e+=r;return a}(t,r,o=o===i?t<r?1:-1:pa(o),e)}}function qi(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=ga(t),n=ga(n)),e(t,n)}}function Ki(e,t,n,r,o,s,a,c,d,h){var p=8&t;t|=p?l:u,4&(t&=~(p?u:l))||(t&=-4);var f=[e,t,o,p?s:i,p?a:i,p?i:s,p?i:a,c,d,h],m=n.apply(i,f);return wo(e)&&Oo(m,f),m.placeholder=r,Po(m,e,t)}function $i(e){var t=Ce[e];return function(e,n){if(e=ga(e),(n=null==n?0:_n(fa(n),292))&&_t(e)){var r=(ya(e)+"e").split("e");return+((r=(ya(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Yi=Rn&&1/hn(new Rn([,-0]))[1]==p?function(e){return new Rn(e)}:cc;function Xi(e){return function(t){var n=mo(t);return n==C?ln(t):n==O?pn(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Ji(e,t,r,s,p,f,m,g){var v=2&t;if(!v&&"function"!=typeof e)throw new xe(o);var y=s?s.length:0;if(y||(t&=-97,s=p=i),m=m===i?m:$t(fa(m),0),g=g===i?g:fa(g),y-=p?p.length:0,t&u){var _=s,E=p;s=p=i}var b=v?i:oo(e),w=[e,t,r,s,p,_,E,f,m,g];if(b&&function(e,t){var n=e[1],r=t[1],i=n|r,o=i<131,s=r==d&&8==n||r==d&&n==h&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!o&&!s)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var c=t[3];if(c){var l=e[3];e[3]=l?Ri(l,c,t[4]):c,e[4]=l?dn(e[3],a):t[4]}(c=t[5])&&(l=e[5],e[5]=l?Ii(l,c,t[6]):c,e[6]=l?dn(e[5],a):t[6]);(c=t[7])&&(e[7]=c);r&d&&(e[8]=null==e[8]?t[8]:_n(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=i}(w,b),e=w[0],t=w[1],r=w[2],s=w[3],p=w[4],!(g=w[9]=w[9]===i?v?0:e.length:$t(w[9]-y,0))&&24&t&&(t&=-25),t&&1!=t)S=8==t||t==c?function(e,t,r){var o=ji(e);return function s(){for(var a=arguments.length,c=n(a),l=a,u=ao(s);l--;)c[l]=arguments[l];var d=a<3&&c[0]!==u&&c[a-1]!==u?[]:dn(c,u);return(a-=d.length)<r?Ki(e,t,Fi,s.placeholder,i,c,d,i,i,r-a):Rt(this&&this!==mt&&this instanceof s?o:e,this,c)}}(e,t,g):t!=l&&33!=t||p.length?Fi.apply(i,w):function(e,t,r,i){var o=1&t,s=ji(e);return function t(){for(var a=-1,c=arguments.length,l=-1,u=i.length,d=n(u+c),h=this&&this!==mt&&this instanceof t?s:e;++l<u;)d[l]=i[l];for(;c--;)d[l++]=arguments[++a];return Rt(h,o?r:this,d)}}(e,t,r,s);else var S=function(e,t,n){var r=1&t,i=ji(e);return function t(){return(this&&this!==mt&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,r);return Po((b?ei:Oo)(S,w),e,t)}function Qi(e,t,n,r){return e===i||Fs(e,Ne[n])&&!Le.call(r,n)?t:e}function Zi(e,t,n,r,o,s){return ea(e)&&ea(t)&&(s.set(t,e),Wr(e,t,i,Zi,s),s.delete(t)),e}function eo(e){return ia(e)?i:e}function to(e,t,n,r,o,s){var a=1&n,c=e.length,l=t.length;if(c!=l&&!(a&&l>c))return!1;var u=s.get(e),d=s.get(t);if(u&&d)return u==t&&d==e;var h=-1,p=!0,f=2&n?new $n:i;for(s.set(e,t),s.set(t,e);++h<c;){var m=e[h],g=t[h];if(r)var v=a?r(g,m,h,t,e,s):r(m,g,h,e,t,s);if(v!==i){if(v)continue;p=!1;break}if(f){if(!Vt(t,(function(e,t){if(!tn(f,t)&&(m===e||o(m,e,n,r,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!o(m,g,n,r,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function no(e){return No(Ro(e,i,Go),e+"")}function ro(e){return Tr(e,ka,po)}function io(e){return Tr(e,Na,fo)}var oo=On?function(e){return On.get(e)}:cc;function so(e){for(var t=e.name+"",n=kn[t],r=Le.call(kn,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function ao(e){return(Le.call(Fn,"placeholder")?Fn:e).placeholder}function co(){var e=Fn.iteratee||ic;return e=e===ic?Lr:e,arguments.length?e(arguments[0],arguments[1]):e}function lo(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function uo(e){for(var t=ka(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Co(i)]}return t}function ho(e,t){var n=function(e,t){return null==e?i:e[t]}(e,t);return Dr(n)?n:i}var po=gt?function(e){return null==e?[]:(e=Ae(e),Nt(gt(e),(function(t){return $e.call(e,t)})))}:mc,fo=gt?function(e){for(var t=[];e;)Mt(t,po(e)),e=qe(e);return t}:mc,mo=Cr;function go(e,t,n){for(var r=-1,i=(t=_i(t,e)).length,o=!1;++r<i;){var s=jo(t[r]);if(!(o=null!=e&&n(e,s)))break;e=e[s]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Zs(i)&&_o(s,i)&&(Hs(e)||zs(e))}function vo(e){return"function"!=typeof e.constructor||To(e)?{}:Bn(qe(e))}function yo(e){return Hs(e)||zs(e)||!!(Xe&&e&&e[Xe])}function _o(e,t){var n=typeof e;return!!(t=null==t?f:t)&&("number"==n||"symbol"!=n&&Ee.test(e))&&e>-1&&e%1==0&&e<t}function Eo(e,t,n){if(!ea(n))return!1;var r=typeof t;return!!("number"==r?qs(n)&&_o(t,n.length):"string"==r&&t in n)&&Fs(n[t],e)}function bo(e,t){if(Hs(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ca(e))||(ne.test(e)||!te.test(e)||null!=t&&e in Ae(t))}function wo(e){var t=so(e),n=Fn[t];if("function"!=typeof n||!(t in Hn.prototype))return!1;if(e===n)return!0;var r=oo(n);return!!r&&e===r[0]}(Tn&&mo(new Tn(new ArrayBuffer(1)))!=L||Cn&&mo(new Cn)!=C||An&&mo(An.resolve())!=I||Rn&&mo(new Rn)!=O||In&&mo(new In)!=P)&&(mo=function(e){var t=Cr(e),n=t==R?e.constructor:i,r=n?Uo(n):"";if(r)switch(r){case Nn:return L;case Pn:return C;case Dn:return I;case Ln:return O;case Mn:return P}return t});var So=Pe?Js:gc;function To(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ne)}function Co(e){return e===e&&!ea(e)}function Ao(e,t){return function(n){return null!=n&&(n[e]===t&&(t!==i||e in Ae(n)))}}function Ro(e,t,r){return t=$t(t===i?e.length-1:t,0),function(){for(var i=arguments,o=-1,s=$t(i.length-t,0),a=n(s);++o<s;)a[o]=i[t+o];o=-1;for(var c=n(t+1);++o<t;)c[o]=i[o];return c[t]=r(a),Rt(e,this,c)}}function Io(e,t){return t.length<2?e:Sr(e,ri(t,0,-1))}function xo(e,t){if(("constructor"!==t||"function"!==typeof e[t])&&"__proto__"!=t)return e[t]}var Oo=Do(ei),ko=ut||function(e,t){return mt.setTimeout(e,t)},No=Do(ti);function Po(e,t,n){var r=t+"";return No(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(ce,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return xt(v,(function(n){var r="_."+n[0];t&n[1]&&!Pt(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(le);return t?t[1].split(ue):[]}(r),n)))}function Do(e){var t=0,n=0;return function(){var r=En(),o=16-(r-n);if(n=r,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Lo(e,t){var n=-1,r=e.length,o=r-1;for(t=t===i?r:t;++n<t;){var s=$r(n,o),a=e[s];e[s]=e[n],e[n]=a}return e.length=t,e}var Mo=function(e){var t=Ds(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(re,(function(e,n,r,i){t.push(r?i.replace(pe,"$1"):n||e)})),t}));function jo(e){if("string"==typeof e||ca(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Uo(e){if(null!=e){try{return De.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Vo(e){if(e instanceof Hn)return e.clone();var t=new zn(e.__wrapped__,e.__chain__);return t.__actions__=xi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Fo=Xr((function(e,t){return Ks(e)?dr(e,vr(t,1,Ks,!0)):[]})),Bo=Xr((function(e,t){var n=Xo(t);return Ks(n)&&(n=i),Ks(e)?dr(e,vr(t,1,Ks,!0),co(n,2)):[]})),Wo=Xr((function(e,t){var n=Xo(t);return Ks(n)&&(n=i),Ks(e)?dr(e,vr(t,1,Ks,!0),i,n):[]}));function zo(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fa(n);return i<0&&(i=$t(r+i,0)),Wt(e,co(t,3),i)}function Ho(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r-1;return n!==i&&(o=fa(n),o=n<0?$t(r+o,0):_n(o,r-1)),Wt(e,co(t,3),o,!0)}function Go(e){return(null==e?0:e.length)?vr(e,1):[]}function qo(e){return e&&e.length?e[0]:i}var Ko=Xr((function(e){var t=Lt(e,vi);return t.length&&t[0]===e[0]?xr(t):[]})),$o=Xr((function(e){var t=Xo(e),n=Lt(e,vi);return t===Xo(n)?t=i:n.pop(),n.length&&n[0]===e[0]?xr(n,co(t,2)):[]})),Yo=Xr((function(e){var t=Xo(e),n=Lt(e,vi);return(t="function"==typeof t?t:i)&&n.pop(),n.length&&n[0]===e[0]?xr(n,i,t):[]}));function Xo(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Jo=Xr(Qo);function Qo(e,t){return e&&e.length&&t&&t.length?qr(e,t):e}var Zo=no((function(e,t){var n=null==e?0:e.length,r=sr(e,t);return Kr(e,Lt(t,(function(e){return _o(e,n)?+e:e})).sort(Ai)),r}));function es(e){return null==e?e:Sn.call(e)}var ts=Xr((function(e){return ui(vr(e,1,Ks,!0))})),ns=Xr((function(e){var t=Xo(e);return Ks(t)&&(t=i),ui(vr(e,1,Ks,!0),co(t,2))})),rs=Xr((function(e){var t=Xo(e);return t="function"==typeof t?t:i,ui(vr(e,1,Ks,!0),i,t)}));function is(e){if(!e||!e.length)return[];var t=0;return e=Nt(e,(function(e){if(Ks(e))return t=$t(e.length,t),!0})),Jt(t,(function(t){return Lt(e,Kt(t))}))}function os(e,t){if(!e||!e.length)return[];var n=is(e);return null==t?n:Lt(n,(function(e){return Rt(t,i,e)}))}var ss=Xr((function(e,t){return Ks(e)?dr(e,t):[]})),as=Xr((function(e){return mi(Nt(e,Ks))})),cs=Xr((function(e){var t=Xo(e);return Ks(t)&&(t=i),mi(Nt(e,Ks),co(t,2))})),ls=Xr((function(e){var t=Xo(e);return t="function"==typeof t?t:i,mi(Nt(e,Ks),i,t)})),us=Xr(is);var ds=Xr((function(e){var t=e.length,n=t>1?e[t-1]:i;return n="function"==typeof n?(e.pop(),n):i,os(e,n)}));function hs(e){var t=Fn(e);return t.__chain__=!0,t}function ps(e,t){return t(e)}var fs=no((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,o=function(t){return sr(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Hn&&_o(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:ps,args:[o],thisArg:i}),new zn(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(i),e}))):this.thru(o)}));var ms=ki((function(e,t,n){Le.call(e,n)?++e[n]:or(e,n,1)}));var gs=Ui(zo),vs=Ui(Ho);function ys(e,t){return(Hs(e)?xt:hr)(e,co(t,3))}function _s(e,t){return(Hs(e)?Ot:pr)(e,co(t,3))}var Es=ki((function(e,t,n){Le.call(e,n)?e[n].push(t):or(e,n,[t])}));var bs=Xr((function(e,t,r){var i=-1,o="function"==typeof t,s=qs(e)?n(e.length):[];return hr(e,(function(e){s[++i]=o?Rt(t,e,r):Or(e,t,r)})),s})),ws=ki((function(e,t,n){or(e,n,t)}));function Ss(e,t){return(Hs(e)?Lt:Vr)(e,co(t,3))}var Ts=ki((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var Cs=Xr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&Eo(e,t[0],t[1])?t=[]:n>2&&Eo(t[0],t[1],t[2])&&(t=[t[0]]),Hr(e,vr(t,1),[])})),As=it||function(){return mt.Date.now()};function Rs(e,t,n){return t=n?i:t,t=e&&null==t?e.length:t,Ji(e,d,i,i,i,i,t)}function Is(e,t){var n;if("function"!=typeof t)throw new xe(o);return e=fa(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=i),n}}var xs=Xr((function(e,t,n){var r=1;if(n.length){var i=dn(n,ao(xs));r|=l}return Ji(e,r,t,n,i)})),Os=Xr((function(e,t,n){var r=3;if(n.length){var i=dn(n,ao(Os));r|=l}return Ji(t,r,e,n,i)}));function ks(e,t,n){var r,s,a,c,l,u,d=0,h=!1,p=!1,f=!0;if("function"!=typeof e)throw new xe(o);function m(t){var n=r,o=s;return r=s=i,d=t,c=e.apply(o,n)}function g(e){var n=e-u;return u===i||n>=t||n<0||p&&e-d>=a}function v(){var e=As();if(g(e))return y(e);l=ko(v,function(e){var n=t-(e-u);return p?_n(n,a-(e-d)):n}(e))}function y(e){return l=i,f&&r?m(e):(r=s=i,c)}function _(){var e=As(),n=g(e);if(r=arguments,s=this,u=e,n){if(l===i)return function(e){return d=e,l=ko(v,t),h?m(e):c}(u);if(p)return wi(l),l=ko(v,t),m(u)}return l===i&&(l=ko(v,t)),c}return t=ga(t)||0,ea(n)&&(h=!!n.leading,a=(p="maxWait"in n)?$t(ga(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),_.cancel=function(){l!==i&&wi(l),d=0,r=u=s=l=i},_.flush=function(){return l===i?c:y(As())},_}var Ns=Xr((function(e,t){return ur(e,1,t)})),Ps=Xr((function(e,t,n){return ur(e,ga(t)||0,n)}));function Ds(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new xe(o);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(Ds.Cache||Kn),n}function Ls(e){if("function"!=typeof e)throw new xe(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ds.Cache=Kn;var Ms=Ei((function(e,t){var n=(t=1==t.length&&Hs(t[0])?Lt(t[0],Zt(co())):Lt(vr(t,1),Zt(co()))).length;return Xr((function(r){for(var i=-1,o=_n(r.length,n);++i<o;)r[i]=t[i].call(this,r[i]);return Rt(e,this,r)}))})),js=Xr((function(e,t){var n=dn(t,ao(js));return Ji(e,l,i,t,n)})),Us=Xr((function(e,t){var n=dn(t,ao(Us));return Ji(e,u,i,t,n)})),Vs=no((function(e,t){return Ji(e,h,i,i,i,t)}));function Fs(e,t){return e===t||e!==e&&t!==t}var Bs=qi(Ar),Ws=qi((function(e,t){return e>=t})),zs=kr(function(){return arguments}())?kr:function(e){return ta(e)&&Le.call(e,"callee")&&!$e.call(e,"callee")},Hs=n.isArray,Gs=bt?Zt(bt):function(e){return ta(e)&&Cr(e)==D};function qs(e){return null!=e&&Zs(e.length)&&!Js(e)}function Ks(e){return ta(e)&&qs(e)}var $s=vt||gc,Ys=wt?Zt(wt):function(e){return ta(e)&&Cr(e)==b};function Xs(e){if(!ta(e))return!1;var t=Cr(e);return t==w||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ia(e)}function Js(e){if(!ea(e))return!1;var t=Cr(e);return t==S||t==T||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Qs(e){return"number"==typeof e&&e==fa(e)}function Zs(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=f}function ea(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ta(e){return null!=e&&"object"==typeof e}var na=St?Zt(St):function(e){return ta(e)&&mo(e)==C};function ra(e){return"number"==typeof e||ta(e)&&Cr(e)==A}function ia(e){if(!ta(e)||Cr(e)!=R)return!1;var t=qe(e);if(null===t)return!0;var n=Le.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&De.call(n)==Ve}var oa=Tt?Zt(Tt):function(e){return ta(e)&&Cr(e)==x};var sa=Ct?Zt(Ct):function(e){return ta(e)&&mo(e)==O};function aa(e){return"string"==typeof e||!Hs(e)&&ta(e)&&Cr(e)==k}function ca(e){return"symbol"==typeof e||ta(e)&&Cr(e)==N}var la=At?Zt(At):function(e){return ta(e)&&Zs(e.length)&&!!ct[Cr(e)]};var ua=qi(Ur),da=qi((function(e,t){return e<=t}));function ha(e){if(!e)return[];if(qs(e))return aa(e)?mn(e):xi(e);if(Je&&e[Je])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Je]());var t=mo(e);return(t==C?ln:t==O?hn:Fa)(e)}function pa(e){return e?(e=ga(e))===p||e===-1/0?17976931348623157e292*(e<0?-1:1):e===e?e:0:0===e?e:0}function fa(e){var t=pa(e),n=t%1;return t===t?n?t-n:t:0}function ma(e){return e?ar(fa(e),0,g):0}function ga(e){if("number"==typeof e)return e;if(ca(e))return m;if(ea(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ea(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Qt(e);var n=ve.test(e);return n||_e.test(e)?ht(e.slice(2),n?2:8):ge.test(e)?m:+e}function va(e){return Oi(e,Na(e))}function ya(e){return null==e?"":li(e)}var _a=Ni((function(e,t){if(To(t)||qs(t))Oi(t,ka(t),e);else for(var n in t)Le.call(t,n)&&tr(e,n,t[n])})),Ea=Ni((function(e,t){Oi(t,Na(t),e)})),ba=Ni((function(e,t,n,r){Oi(t,Na(t),e,r)})),wa=Ni((function(e,t,n,r){Oi(t,ka(t),e,r)})),Sa=no(sr);var Ta=Xr((function(e,t){e=Ae(e);var n=-1,r=t.length,o=r>2?t[2]:i;for(o&&Eo(t[0],t[1],o)&&(r=1);++n<r;)for(var s=t[n],a=Na(s),c=-1,l=a.length;++c<l;){var u=a[c],d=e[u];(d===i||Fs(d,Ne[u])&&!Le.call(e,u))&&(e[u]=s[u])}return e})),Ca=Xr((function(e){return e.push(i,Zi),Rt(Da,i,e)}));function Aa(e,t,n){var r=null==e?i:Sr(e,t);return r===i?n:r}function Ra(e,t){return null!=e&&go(e,t,Ir)}var Ia=Bi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),e[t]=n}),ec(rc)),xa=Bi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),Le.call(e,t)?e[t].push(n):e[t]=[n]}),co),Oa=Xr(Or);function ka(e){return qs(e)?Xn(e):Mr(e)}function Na(e){return qs(e)?Xn(e,!0):jr(e)}var Pa=Ni((function(e,t,n){Wr(e,t,n)})),Da=Ni((function(e,t,n,r){Wr(e,t,n,r)})),La=no((function(e,t){var n={};if(null==e)return n;var r=!1;t=Lt(t,(function(t){return t=_i(t,e),r||(r=t.length>1),t})),Oi(e,io(e),n),r&&(n=cr(n,7,eo));for(var i=t.length;i--;)di(n,t[i]);return n}));var Ma=no((function(e,t){return null==e?{}:function(e,t){return Gr(e,t,(function(t,n){return Ra(e,n)}))}(e,t)}));function ja(e,t){if(null==e)return{};var n=Lt(io(e),(function(e){return[e]}));return t=co(t),Gr(e,n,(function(e,n){return t(e,n[0])}))}var Ua=Xi(ka),Va=Xi(Na);function Fa(e){return null==e?[]:en(e,ka(e))}var Ba=Mi((function(e,t,n){return t=t.toLowerCase(),e+(n?Wa(t):t)}));function Wa(e){return Xa(ya(e).toLowerCase())}function za(e){return(e=ya(e))&&e.replace(be,on).replace(tt,"")}var Ha=Mi((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ga=Mi((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),qa=Li("toLowerCase");var Ka=Mi((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var $a=Mi((function(e,t,n){return e+(n?" ":"")+Xa(t)}));var Ya=Mi((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Xa=Li("toUpperCase");function Ja(e,t,n){return e=ya(e),(t=n?i:t)===i?function(e){return ot.test(e)}(e)?function(e){return e.match(rt)||[]}(e):function(e){return e.match(de)||[]}(e):e.match(t)||[]}var Qa=Xr((function(e,t){try{return Rt(e,i,t)}catch(n){return Xs(n)?n:new ae(n)}})),Za=no((function(e,t){return xt(t,(function(t){t=jo(t),or(e,t,xs(e[t],e))})),e}));function ec(e){return function(){return e}}var tc=Vi(),nc=Vi(!0);function rc(e){return e}function ic(e){return Lr("function"==typeof e?e:cr(e,1))}var oc=Xr((function(e,t){return function(n){return Or(n,e,t)}})),sc=Xr((function(e,t){return function(n){return Or(e,n,t)}}));function ac(e,t,n){var r=ka(t),i=wr(t,r);null!=n||ea(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=wr(t,ka(t)));var o=!(ea(n)&&"chain"in n)||!!n.chain,s=Js(e);return xt(i,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__);return(n.__actions__=xi(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Mt([this.value()],arguments))})})),e}function cc(){}var lc=zi(Lt),uc=zi(kt),dc=zi(Vt);function hc(e){return bo(e)?Kt(jo(e)):function(e){return function(t){return Sr(t,e)}}(e)}var pc=Gi(),fc=Gi(!0);function mc(){return[]}function gc(){return!1}var vc=Wi((function(e,t){return e+t}),0),yc=$i("ceil"),_c=Wi((function(e,t){return e/t}),1),Ec=$i("floor");var bc=Wi((function(e,t){return e*t}),1),wc=$i("round"),Sc=Wi((function(e,t){return e-t}),0);return Fn.after=function(e,t){if("function"!=typeof t)throw new xe(o);return e=fa(e),function(){if(--e<1)return t.apply(this,arguments)}},Fn.ary=Rs,Fn.assign=_a,Fn.assignIn=Ea,Fn.assignInWith=ba,Fn.assignWith=wa,Fn.at=Sa,Fn.before=Is,Fn.bind=xs,Fn.bindAll=Za,Fn.bindKey=Os,Fn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Hs(e)?e:[e]},Fn.chain=hs,Fn.chunk=function(e,t,r){t=(r?Eo(e,t,r):t===i)?1:$t(fa(t),0);var o=null==e?0:e.length;if(!o||t<1)return[];for(var s=0,a=0,c=n(pt(o/t));s<o;)c[a++]=ri(e,s,s+=t);return c},Fn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},Fn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Mt(Hs(r)?xi(r):[r],vr(t,1))},Fn.cond=function(e){var t=null==e?0:e.length,n=co();return e=t?Lt(e,(function(e){if("function"!=typeof e[1])throw new xe(o);return[n(e[0]),e[1]]})):[],Xr((function(n){for(var r=-1;++r<t;){var i=e[r];if(Rt(i[0],this,n))return Rt(i[1],this,n)}}))},Fn.conforms=function(e){return function(e){var t=ka(e);return function(n){return lr(n,e,t)}}(cr(e,1))},Fn.constant=ec,Fn.countBy=ms,Fn.create=function(e,t){var n=Bn(e);return null==t?n:ir(n,t)},Fn.curry=function e(t,n,r){var o=Ji(t,8,i,i,i,i,i,n=r?i:n);return o.placeholder=e.placeholder,o},Fn.curryRight=function e(t,n,r){var o=Ji(t,c,i,i,i,i,i,n=r?i:n);return o.placeholder=e.placeholder,o},Fn.debounce=ks,Fn.defaults=Ta,Fn.defaultsDeep=Ca,Fn.defer=Ns,Fn.delay=Ps,Fn.difference=Fo,Fn.differenceBy=Bo,Fn.differenceWith=Wo,Fn.drop=function(e,t,n){var r=null==e?0:e.length;return r?ri(e,(t=n||t===i?1:fa(t))<0?0:t,r):[]},Fn.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?ri(e,0,(t=r-(t=n||t===i?1:fa(t)))<0?0:t):[]},Fn.dropRightWhile=function(e,t){return e&&e.length?pi(e,co(t,3),!0,!0):[]},Fn.dropWhile=function(e,t){return e&&e.length?pi(e,co(t,3),!0):[]},Fn.fill=function(e,t,n,r){var o=null==e?0:e.length;return o?(n&&"number"!=typeof n&&Eo(e,t,n)&&(n=0,r=o),function(e,t,n,r){var o=e.length;for((n=fa(n))<0&&(n=-n>o?0:o+n),(r=r===i||r>o?o:fa(r))<0&&(r+=o),r=n>r?0:ma(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},Fn.filter=function(e,t){return(Hs(e)?Nt:gr)(e,co(t,3))},Fn.flatMap=function(e,t){return vr(Ss(e,t),1)},Fn.flatMapDeep=function(e,t){return vr(Ss(e,t),p)},Fn.flatMapDepth=function(e,t,n){return n=n===i?1:fa(n),vr(Ss(e,t),n)},Fn.flatten=Go,Fn.flattenDeep=function(e){return(null==e?0:e.length)?vr(e,p):[]},Fn.flattenDepth=function(e,t){return(null==e?0:e.length)?vr(e,t=t===i?1:fa(t)):[]},Fn.flip=function(e){return Ji(e,512)},Fn.flow=tc,Fn.flowRight=nc,Fn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},Fn.functions=function(e){return null==e?[]:wr(e,ka(e))},Fn.functionsIn=function(e){return null==e?[]:wr(e,Na(e))},Fn.groupBy=Es,Fn.initial=function(e){return(null==e?0:e.length)?ri(e,0,-1):[]},Fn.intersection=Ko,Fn.intersectionBy=$o,Fn.intersectionWith=Yo,Fn.invert=Ia,Fn.invertBy=xa,Fn.invokeMap=bs,Fn.iteratee=ic,Fn.keyBy=ws,Fn.keys=ka,Fn.keysIn=Na,Fn.map=Ss,Fn.mapKeys=function(e,t){var n={};return t=co(t,3),Er(e,(function(e,r,i){or(n,t(e,r,i),e)})),n},Fn.mapValues=function(e,t){var n={};return t=co(t,3),Er(e,(function(e,r,i){or(n,r,t(e,r,i))})),n},Fn.matches=function(e){return Fr(cr(e,1))},Fn.matchesProperty=function(e,t){return Br(e,cr(t,1))},Fn.memoize=Ds,Fn.merge=Pa,Fn.mergeWith=Da,Fn.method=oc,Fn.methodOf=sc,Fn.mixin=ac,Fn.negate=Ls,Fn.nthArg=function(e){return e=fa(e),Xr((function(t){return zr(t,e)}))},Fn.omit=La,Fn.omitBy=function(e,t){return ja(e,Ls(co(t)))},Fn.once=function(e){return Is(2,e)},Fn.orderBy=function(e,t,n,r){return null==e?[]:(Hs(t)||(t=null==t?[]:[t]),Hs(n=r?i:n)||(n=null==n?[]:[n]),Hr(e,t,n))},Fn.over=lc,Fn.overArgs=Ms,Fn.overEvery=uc,Fn.overSome=dc,Fn.partial=js,Fn.partialRight=Us,Fn.partition=Ts,Fn.pick=Ma,Fn.pickBy=ja,Fn.property=hc,Fn.propertyOf=function(e){return function(t){return null==e?i:Sr(e,t)}},Fn.pull=Jo,Fn.pullAll=Qo,Fn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?qr(e,t,co(n,2)):e},Fn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?qr(e,t,i,n):e},Fn.pullAt=Zo,Fn.range=pc,Fn.rangeRight=fc,Fn.rearg=Vs,Fn.reject=function(e,t){return(Hs(e)?Nt:gr)(e,Ls(co(t,3)))},Fn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=co(t,3);++r<o;){var s=e[r];t(s,r,e)&&(n.push(s),i.push(r))}return Kr(e,i),n},Fn.rest=function(e,t){if("function"!=typeof e)throw new xe(o);return Xr(e,t=t===i?t:fa(t))},Fn.reverse=es,Fn.sampleSize=function(e,t,n){return t=(n?Eo(e,t,n):t===i)?1:fa(t),(Hs(e)?Qn:Qr)(e,t)},Fn.set=function(e,t,n){return null==e?e:Zr(e,t,n)},Fn.setWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:Zr(e,t,n,r)},Fn.shuffle=function(e){return(Hs(e)?Zn:ni)(e)},Fn.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Eo(e,t,n)?(t=0,n=r):(t=null==t?0:fa(t),n=n===i?r:fa(n)),ri(e,t,n)):[]},Fn.sortBy=Cs,Fn.sortedUniq=function(e){return e&&e.length?ai(e):[]},Fn.sortedUniqBy=function(e,t){return e&&e.length?ai(e,co(t,2)):[]},Fn.split=function(e,t,n){return n&&"number"!=typeof n&&Eo(e,t,n)&&(t=n=i),(n=n===i?g:n>>>0)?(e=ya(e))&&("string"==typeof t||null!=t&&!oa(t))&&!(t=li(t))&&cn(e)?bi(mn(e),0,n):e.split(t,n):[]},Fn.spread=function(e,t){if("function"!=typeof e)throw new xe(o);return t=null==t?0:$t(fa(t),0),Xr((function(n){var r=n[t],i=bi(n,0,t);return r&&Mt(i,r),Rt(e,this,i)}))},Fn.tail=function(e){var t=null==e?0:e.length;return t?ri(e,1,t):[]},Fn.take=function(e,t,n){return e&&e.length?ri(e,0,(t=n||t===i?1:fa(t))<0?0:t):[]},Fn.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?ri(e,(t=r-(t=n||t===i?1:fa(t)))<0?0:t,r):[]},Fn.takeRightWhile=function(e,t){return e&&e.length?pi(e,co(t,3),!1,!0):[]},Fn.takeWhile=function(e,t){return e&&e.length?pi(e,co(t,3)):[]},Fn.tap=function(e,t){return t(e),e},Fn.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new xe(o);return ea(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ks(e,t,{leading:r,maxWait:t,trailing:i})},Fn.thru=ps,Fn.toArray=ha,Fn.toPairs=Ua,Fn.toPairsIn=Va,Fn.toPath=function(e){return Hs(e)?Lt(e,jo):ca(e)?[e]:xi(Mo(ya(e)))},Fn.toPlainObject=va,Fn.transform=function(e,t,n){var r=Hs(e),i=r||$s(e)||la(e);if(t=co(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:ea(e)&&Js(o)?Bn(qe(e)):{}}return(i?xt:Er)(e,(function(e,r,i){return t(n,e,r,i)})),n},Fn.unary=function(e){return Rs(e,1)},Fn.union=ts,Fn.unionBy=ns,Fn.unionWith=rs,Fn.uniq=function(e){return e&&e.length?ui(e):[]},Fn.uniqBy=function(e,t){return e&&e.length?ui(e,co(t,2)):[]},Fn.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?ui(e,i,t):[]},Fn.unset=function(e,t){return null==e||di(e,t)},Fn.unzip=is,Fn.unzipWith=os,Fn.update=function(e,t,n){return null==e?e:hi(e,t,yi(n))},Fn.updateWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:hi(e,t,yi(n),r)},Fn.values=Fa,Fn.valuesIn=function(e){return null==e?[]:en(e,Na(e))},Fn.without=ss,Fn.words=Ja,Fn.wrap=function(e,t){return js(yi(t),e)},Fn.xor=as,Fn.xorBy=cs,Fn.xorWith=ls,Fn.zip=us,Fn.zipObject=function(e,t){return gi(e||[],t||[],tr)},Fn.zipObjectDeep=function(e,t){return gi(e||[],t||[],Zr)},Fn.zipWith=ds,Fn.entries=Ua,Fn.entriesIn=Va,Fn.extend=Ea,Fn.extendWith=ba,ac(Fn,Fn),Fn.add=vc,Fn.attempt=Qa,Fn.camelCase=Ba,Fn.capitalize=Wa,Fn.ceil=yc,Fn.clamp=function(e,t,n){return n===i&&(n=t,t=i),n!==i&&(n=(n=ga(n))===n?n:0),t!==i&&(t=(t=ga(t))===t?t:0),ar(ga(e),t,n)},Fn.clone=function(e){return cr(e,4)},Fn.cloneDeep=function(e){return cr(e,5)},Fn.cloneDeepWith=function(e,t){return cr(e,5,t="function"==typeof t?t:i)},Fn.cloneWith=function(e,t){return cr(e,4,t="function"==typeof t?t:i)},Fn.conformsTo=function(e,t){return null==t||lr(e,t,ka(t))},Fn.deburr=za,Fn.defaultTo=function(e,t){return null==e||e!==e?t:e},Fn.divide=_c,Fn.endsWith=function(e,t,n){e=ya(e),t=li(t);var r=e.length,o=n=n===i?r:ar(fa(n),0,r);return(n-=t.length)>=0&&e.slice(n,o)==t},Fn.eq=Fs,Fn.escape=function(e){return(e=ya(e))&&J.test(e)?e.replace(Y,sn):e},Fn.escapeRegExp=function(e){return(e=ya(e))&&oe.test(e)?e.replace(ie,"\\$&"):e},Fn.every=function(e,t,n){var r=Hs(e)?kt:fr;return n&&Eo(e,t,n)&&(t=i),r(e,co(t,3))},Fn.find=gs,Fn.findIndex=zo,Fn.findKey=function(e,t){return Bt(e,co(t,3),Er)},Fn.findLast=vs,Fn.findLastIndex=Ho,Fn.findLastKey=function(e,t){return Bt(e,co(t,3),br)},Fn.floor=Ec,Fn.forEach=ys,Fn.forEachRight=_s,Fn.forIn=function(e,t){return null==e?e:yr(e,co(t,3),Na)},Fn.forInRight=function(e,t){return null==e?e:_r(e,co(t,3),Na)},Fn.forOwn=function(e,t){return e&&Er(e,co(t,3))},Fn.forOwnRight=function(e,t){return e&&br(e,co(t,3))},Fn.get=Aa,Fn.gt=Bs,Fn.gte=Ws,Fn.has=function(e,t){return null!=e&&go(e,t,Rr)},Fn.hasIn=Ra,Fn.head=qo,Fn.identity=rc,Fn.includes=function(e,t,n,r){e=qs(e)?e:Fa(e),n=n&&!r?fa(n):0;var i=e.length;return n<0&&(n=$t(i+n,0)),aa(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&zt(e,t,n)>-1},Fn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fa(n);return i<0&&(i=$t(r+i,0)),zt(e,t,i)},Fn.inRange=function(e,t,n){return t=pa(t),n===i?(n=t,t=0):n=pa(n),function(e,t,n){return e>=_n(t,n)&&e<$t(t,n)}(e=ga(e),t,n)},Fn.invoke=Oa,Fn.isArguments=zs,Fn.isArray=Hs,Fn.isArrayBuffer=Gs,Fn.isArrayLike=qs,Fn.isArrayLikeObject=Ks,Fn.isBoolean=function(e){return!0===e||!1===e||ta(e)&&Cr(e)==E},Fn.isBuffer=$s,Fn.isDate=Ys,Fn.isElement=function(e){return ta(e)&&1===e.nodeType&&!ia(e)},Fn.isEmpty=function(e){if(null==e)return!0;if(qs(e)&&(Hs(e)||"string"==typeof e||"function"==typeof e.splice||$s(e)||la(e)||zs(e)))return!e.length;var t=mo(e);if(t==C||t==O)return!e.size;if(To(e))return!Mr(e).length;for(var n in e)if(Le.call(e,n))return!1;return!0},Fn.isEqual=function(e,t){return Nr(e,t)},Fn.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:i)?n(e,t):i;return r===i?Nr(e,t,i,n):!!r},Fn.isError=Xs,Fn.isFinite=function(e){return"number"==typeof e&&_t(e)},Fn.isFunction=Js,Fn.isInteger=Qs,Fn.isLength=Zs,Fn.isMap=na,Fn.isMatch=function(e,t){return e===t||Pr(e,t,uo(t))},Fn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:i,Pr(e,t,uo(t),n)},Fn.isNaN=function(e){return ra(e)&&e!=+e},Fn.isNative=function(e){if(So(e))throw new ae("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Dr(e)},Fn.isNil=function(e){return null==e},Fn.isNull=function(e){return null===e},Fn.isNumber=ra,Fn.isObject=ea,Fn.isObjectLike=ta,Fn.isPlainObject=ia,Fn.isRegExp=oa,Fn.isSafeInteger=function(e){return Qs(e)&&e>=-9007199254740991&&e<=f},Fn.isSet=sa,Fn.isString=aa,Fn.isSymbol=ca,Fn.isTypedArray=la,Fn.isUndefined=function(e){return e===i},Fn.isWeakMap=function(e){return ta(e)&&mo(e)==P},Fn.isWeakSet=function(e){return ta(e)&&"[object WeakSet]"==Cr(e)},Fn.join=function(e,t){return null==e?"":Et.call(e,t)},Fn.kebabCase=Ha,Fn.last=Xo,Fn.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r;return n!==i&&(o=(o=fa(n))<0?$t(r+o,0):_n(o,r-1)),t===t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,o):Wt(e,Gt,o,!0)},Fn.lowerCase=Ga,Fn.lowerFirst=qa,Fn.lt=ua,Fn.lte=da,Fn.max=function(e){return e&&e.length?mr(e,rc,Ar):i},Fn.maxBy=function(e,t){return e&&e.length?mr(e,co(t,2),Ar):i},Fn.mean=function(e){return qt(e,rc)},Fn.meanBy=function(e,t){return qt(e,co(t,2))},Fn.min=function(e){return e&&e.length?mr(e,rc,Ur):i},Fn.minBy=function(e,t){return e&&e.length?mr(e,co(t,2),Ur):i},Fn.stubArray=mc,Fn.stubFalse=gc,Fn.stubObject=function(){return{}},Fn.stubString=function(){return""},Fn.stubTrue=function(){return!0},Fn.multiply=bc,Fn.nth=function(e,t){return e&&e.length?zr(e,fa(t)):i},Fn.noConflict=function(){return mt._===this&&(mt._=Fe),this},Fn.noop=cc,Fn.now=As,Fn.pad=function(e,t,n){e=ya(e);var r=(t=fa(t))?fn(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return Hi(ft(i),n)+e+Hi(pt(i),n)},Fn.padEnd=function(e,t,n){e=ya(e);var r=(t=fa(t))?fn(e):0;return t&&r<t?e+Hi(t-r,n):e},Fn.padStart=function(e,t,n){e=ya(e);var r=(t=fa(t))?fn(e):0;return t&&r<t?Hi(t-r,n)+e:e},Fn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),bn(ya(e).replace(se,""),t||0)},Fn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&Eo(e,t,n)&&(t=n=i),n===i&&("boolean"==typeof t?(n=t,t=i):"boolean"==typeof e&&(n=e,e=i)),e===i&&t===i?(e=0,t=1):(e=pa(e),t===i?(t=e,e=0):t=pa(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var o=wn();return _n(e+o*(t-e+dt("1e-"+((o+"").length-1))),t)}return $r(e,t)},Fn.reduce=function(e,t,n){var r=Hs(e)?jt:Yt,i=arguments.length<3;return r(e,co(t,4),n,i,hr)},Fn.reduceRight=function(e,t,n){var r=Hs(e)?Ut:Yt,i=arguments.length<3;return r(e,co(t,4),n,i,pr)},Fn.repeat=function(e,t,n){return t=(n?Eo(e,t,n):t===i)?1:fa(t),Yr(ya(e),t)},Fn.replace=function(){var e=arguments,t=ya(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Fn.result=function(e,t,n){var r=-1,o=(t=_i(t,e)).length;for(o||(o=1,e=i);++r<o;){var s=null==e?i:e[jo(t[r])];s===i&&(r=o,s=n),e=Js(s)?s.call(e):s}return e},Fn.round=wc,Fn.runInContext=e,Fn.sample=function(e){return(Hs(e)?Jn:Jr)(e)},Fn.size=function(e){if(null==e)return 0;if(qs(e))return aa(e)?fn(e):e.length;var t=mo(e);return t==C||t==O?e.size:Mr(e).length},Fn.snakeCase=Ka,Fn.some=function(e,t,n){var r=Hs(e)?Vt:ii;return n&&Eo(e,t,n)&&(t=i),r(e,co(t,3))},Fn.sortedIndex=function(e,t){return oi(e,t)},Fn.sortedIndexBy=function(e,t,n){return si(e,t,co(n,2))},Fn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=oi(e,t);if(r<n&&Fs(e[r],t))return r}return-1},Fn.sortedLastIndex=function(e,t){return oi(e,t,!0)},Fn.sortedLastIndexBy=function(e,t,n){return si(e,t,co(n,2),!0)},Fn.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=oi(e,t,!0)-1;if(Fs(e[n],t))return n}return-1},Fn.startCase=$a,Fn.startsWith=function(e,t,n){return e=ya(e),n=null==n?0:ar(fa(n),0,e.length),t=li(t),e.slice(n,n+t.length)==t},Fn.subtract=Sc,Fn.sum=function(e){return e&&e.length?Xt(e,rc):0},Fn.sumBy=function(e,t){return e&&e.length?Xt(e,co(t,2)):0},Fn.template=function(e,t,n){var r=Fn.templateSettings;n&&Eo(e,t,n)&&(t=i),e=ya(e),t=ba({},t,r,Qi);var o,s,a=ba({},t.imports,r.imports,Qi),c=ka(a),l=en(a,c),u=0,d=t.interpolate||we,h="__p += '",p=Re((t.escape||we).source+"|"+d.source+"|"+(d===ee?fe:we).source+"|"+(t.evaluate||we).source+"|$","g"),f="//# sourceURL="+(Le.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++at+"]")+"\n";e.replace(p,(function(t,n,r,i,a,c){return r||(r=i),h+=e.slice(u,c).replace(Se,an),n&&(o=!0,h+="' +\n__e("+n+") +\n'"),a&&(s=!0,h+="';\n"+a+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=c+t.length,t})),h+="';\n";var m=Le.call(t,"variable")&&t.variable;if(m){if(he.test(m))throw new ae("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(s?h.replace(G,""):h).replace(q,"$1").replace(K,"$1;"),h="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=Qa((function(){return Te(c,f+"return "+h).apply(i,l)}));if(g.source=h,Xs(g))throw g;return g},Fn.times=function(e,t){if((e=fa(e))<1||e>f)return[];var n=g,r=_n(e,g);t=co(t),e-=g;for(var i=Jt(r,t);++n<e;)t(n);return i},Fn.toFinite=pa,Fn.toInteger=fa,Fn.toLength=ma,Fn.toLower=function(e){return ya(e).toLowerCase()},Fn.toNumber=ga,Fn.toSafeInteger=function(e){return e?ar(fa(e),-9007199254740991,f):0===e?e:0},Fn.toString=ya,Fn.toUpper=function(e){return ya(e).toUpperCase()},Fn.trim=function(e,t,n){if((e=ya(e))&&(n||t===i))return Qt(e);if(!e||!(t=li(t)))return e;var r=mn(e),o=mn(t);return bi(r,nn(r,o),rn(r,o)+1).join("")},Fn.trimEnd=function(e,t,n){if((e=ya(e))&&(n||t===i))return e.slice(0,gn(e)+1);if(!e||!(t=li(t)))return e;var r=mn(e);return bi(r,0,rn(r,mn(t))+1).join("")},Fn.trimStart=function(e,t,n){if((e=ya(e))&&(n||t===i))return e.replace(se,"");if(!e||!(t=li(t)))return e;var r=mn(e);return bi(r,nn(r,mn(t))).join("")},Fn.truncate=function(e,t){var n=30,r="...";if(ea(t)){var o="separator"in t?t.separator:o;n="length"in t?fa(t.length):n,r="omission"in t?li(t.omission):r}var s=(e=ya(e)).length;if(cn(e)){var a=mn(e);s=a.length}if(n>=s)return e;var c=n-fn(r);if(c<1)return r;var l=a?bi(a,0,c).join(""):e.slice(0,c);if(o===i)return l+r;if(a&&(c+=l.length-c),oa(o)){if(e.slice(c).search(o)){var u,d=l;for(o.global||(o=Re(o.source,ya(me.exec(o))+"g")),o.lastIndex=0;u=o.exec(d);)var h=u.index;l=l.slice(0,h===i?c:h)}}else if(e.indexOf(li(o),c)!=c){var p=l.lastIndexOf(o);p>-1&&(l=l.slice(0,p))}return l+r},Fn.unescape=function(e){return(e=ya(e))&&X.test(e)?e.replace($,vn):e},Fn.uniqueId=function(e){var t=++Me;return ya(e)+t},Fn.upperCase=Ya,Fn.upperFirst=Xa,Fn.each=ys,Fn.eachRight=_s,Fn.first=qo,ac(Fn,function(){var e={};return Er(Fn,(function(t,n){Le.call(Fn.prototype,n)||(e[n]=t)})),e}(),{chain:!1}),Fn.VERSION="4.17.21",xt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Fn[e].placeholder=Fn})),xt(["drop","take"],(function(e,t){Hn.prototype[e]=function(n){n=n===i?1:$t(fa(n),0);var r=this.__filtered__&&!t?new Hn(this):this.clone();return r.__filtered__?r.__takeCount__=_n(n,r.__takeCount__):r.__views__.push({size:_n(n,g),type:e+(r.__dir__<0?"Right":"")}),r},Hn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),xt(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Hn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:co(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),xt(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Hn.prototype[e]=function(){return this[n](1).value()[0]}})),xt(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Hn.prototype[e]=function(){return this.__filtered__?new Hn(this):this[n](1)}})),Hn.prototype.compact=function(){return this.filter(rc)},Hn.prototype.find=function(e){return this.filter(e).head()},Hn.prototype.findLast=function(e){return this.reverse().find(e)},Hn.prototype.invokeMap=Xr((function(e,t){return"function"==typeof e?new Hn(this):this.map((function(n){return Or(n,e,t)}))})),Hn.prototype.reject=function(e){return this.filter(Ls(co(e)))},Hn.prototype.slice=function(e,t){e=fa(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Hn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==i&&(n=(t=fa(t))<0?n.dropRight(-t):n.take(t-e)),n)},Hn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Hn.prototype.toArray=function(){return this.take(g)},Er(Hn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),o=Fn[r?"take"+("last"==t?"Right":""):t],s=r||/^find/.test(t);o&&(Fn.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,c=t instanceof Hn,l=a[0],u=c||Hs(t),d=function(e){var t=o.apply(Fn,Mt([e],a));return r&&h?t[0]:t};u&&n&&"function"==typeof l&&1!=l.length&&(c=u=!1);var h=this.__chain__,p=!!this.__actions__.length,f=s&&!h,m=c&&!p;if(!s&&u){t=m?t:new Hn(this);var g=e.apply(t,a);return g.__actions__.push({func:ps,args:[d],thisArg:i}),new zn(g,h)}return f&&m?e.apply(this,a):(g=this.thru(d),f?r?g.value()[0]:g.value():g)})})),xt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Oe[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Fn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Hs(i)?i:[],e)}return this[n]((function(n){return t.apply(Hs(n)?n:[],e)}))}})),Er(Hn.prototype,(function(e,t){var n=Fn[t];if(n){var r=n.name+"";Le.call(kn,r)||(kn[r]=[]),kn[r].push({name:t,func:n})}})),kn[Fi(i,2).name]=[{name:"wrapper",func:i}],Hn.prototype.clone=function(){var e=new Hn(this.__wrapped__);return e.__actions__=xi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=xi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=xi(this.__views__),e},Hn.prototype.reverse=function(){if(this.__filtered__){var e=new Hn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Hn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Hs(e),r=t<0,i=n?e.length:0,o=function(e,t,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=_n(t,e+s);break;case"takeRight":e=$t(e,t-s)}}return{start:e,end:t}}(0,i,this.__views__),s=o.start,a=o.end,c=a-s,l=r?a:s-1,u=this.__iteratees__,d=u.length,h=0,p=_n(c,this.__takeCount__);if(!n||!r&&i==c&&p==c)return fi(e,this.__actions__);var f=[];e:for(;c--&&h<p;){for(var m=-1,g=e[l+=t];++m<d;){var v=u[m],y=v.iteratee,_=v.type,E=y(g);if(2==_)g=E;else if(!E){if(1==_)continue e;break e}}f[h++]=g}return f},Fn.prototype.at=fs,Fn.prototype.chain=function(){return hs(this)},Fn.prototype.commit=function(){return new zn(this.value(),this.__chain__)},Fn.prototype.next=function(){this.__values__===i&&(this.__values__=ha(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},Fn.prototype.plant=function(e){for(var t,n=this;n instanceof Wn;){var r=Vo(n);r.__index__=0,r.__values__=i,t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t},Fn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Hn){var t=e;return this.__actions__.length&&(t=new Hn(this)),(t=t.reverse()).__actions__.push({func:ps,args:[es],thisArg:i}),new zn(t,this.__chain__)}return this.thru(es)},Fn.prototype.toJSON=Fn.prototype.valueOf=Fn.prototype.value=function(){return fi(this.__wrapped__,this.__actions__)},Fn.prototype.first=Fn.prototype.head,Je&&(Fn.prototype[Je]=function(){return this}),Fn}();mt._=yn,(r=function(){return yn}.call(t,n,t,e))===i||(e.exports=r)}.call(this)},1399:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(9950);const i="undefined"!==typeof window?r.useLayoutEffect:r.useEffect},1506:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(5393).A},1676:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(5501).A},1761:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,c=e[a],l=a+1,u=e[l];if(0>o(c,n))l<i&&0>o(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[a]=n,r=a);else{if(!(l<i&&0>o(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var l=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function E(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(l,t)}t=r(u)}}function b(e){if(g=!1,E(e),!m)if(null!==r(l))m=!0,P(w);else{var t=r(u);null!==t&&D(b,t.startTime-e)}}function w(e,n){m=!1,g&&(g=!1,y(A),A=-1),f=!0;var o=p;try{for(E(n),h=r(l);null!==h&&(!(h.expirationTime>n)||e&&!x());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===r(l)&&i(l),E(n)}else i(l);h=r(l)}if(null!==h)var c=!0;else{var d=r(u);null!==d&&D(b,d.startTime-n),c=!1}return c}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,C=null,A=-1,R=5,I=-1;function x(){return!(t.unstable_now()-I<R)}function O(){if(null!==C){var e=t.unstable_now();I=e;var n=!0;try{n=C(!0,e)}finally{n?S():(T=!1,C=null)}}else T=!1}if("function"===typeof _)S=function(){_(O)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,N=k.port2;k.port1.onmessage=O,S=function(){N.postMessage(null)}}else S=function(){v(O,0)};function P(e){C=e,T||(T=!0,S())}function D(e,n){A=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,P(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(l)&&e===r(u)&&(g?(y(A),A=-1):g=!0,D(b,o-s))):(e.sortIndex=a,n(l,e),m||f||(m=!0,P(w))),e},t.unstable_shouldYield=x,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},1763:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(423);function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const i={};return t.forEach((t=>{i[t]=(0,r.Ay)(e,t,n)})),i}},1783:(e,t,n)=>{"use strict";n.d(t,{Rk:()=>r,SF:()=>i,sk:()=>o});function r(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):n&&(r+=n+" ")})),r}var i=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},o=function(e,t,n){i(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var o=t;do{e.insert(t===o?"."+r:"",o,e.sheet,!0),o=o.next}while(void 0!==o)}}},1824:(e,t,n)=>{"use strict";n.d(t,{E:()=>s,A:()=>a});var r=n(9950);const i={};const o=[];class s{constructor(){this.currentId=null,this.clear=()=>{null!==this.currentId&&(clearTimeout(this.currentId),this.currentId=null)},this.disposeEffect=()=>this.clear}static create(){return new s}start(e,t){this.clear(),this.currentId=setTimeout((()=>{this.currentId=null,t()}),e)}}function a(){const e=function(e,t){const n=r.useRef(i);return n.current===i&&(n.current=e(t)),n}(s.create).current;var t;return t=e.disposeEffect,r.useEffect(t,o),e}},1927:(e,t,n)=>{"use strict";function r(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];clearTimeout(t),t=setTimeout((()=>{e.apply(this,i)}),n)}return r.clear=()=>{clearTimeout(t)},r}n.d(t,{A:()=>r})},1942:(e,t,n)=>{e.exports=n(3488)()},1960:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=function(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}},1976:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(2529).A},2004:(e,t,n)=>{"use strict";function r(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}n.d(t,{A:()=>i});const i=function(){for(var e,t,n=0,i="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}},2049:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var E=_.prototype=new y;E.constructor=_,m(E,v.prototype),E.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,i)&&!T.hasOwnProperty(i)&&(o[i]=t[i]);var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===o[i]&&(o[i]=c[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function x(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return s=s(c=e),e=""===o?"."+I(c,0):o,b(s)?(i="",null!=e&&(i=e.replace(R,"$&/")+"/"),x(s,t,i,"",(function(e){return e}))):null!=s&&(A(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(R,"$&/")+"/")+e)),t.push(s)),1;if(c=0,o=""===o?".":o+":",b(e))for(var l=0;l<e.length;l++){var u=o+I(a=e[l],l);c+=x(a,t,i,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=x(a=a.value,t,i,u=o+I(a,l++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function O(e,t,n){if(null==e)return e;var r=[],i=0;return x(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},P={transition:null},D={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:P,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:O,forEach:function(e,t,n){O(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return O(e,(function(){t++})),t},toArray:function(e){return O(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=s,t.PureComponent=_,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)w.call(t,l)&&!T.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return N.current.useCallback(e,t)},t.useContext=function(e){return N.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return N.current.useDeferredValue(e)},t.useEffect=function(e,t){return N.current.useEffect(e,t)},t.useId=function(){return N.current.useId()},t.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.current.useMemo(e,t)},t.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},t.useRef=function(e){return N.current.useRef(e)},t.useState=function(e){return N.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.current.useTransition()},t.version="18.3.1"},2138:(e,t)=>{"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,_=n?Symbol.for("react.responder"):60118,E=n?Symbol.for("react.scope"):60119;function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case d:case o:case a:case s:case p:return e;default:switch(e=e&&e.$$typeof){case l:case h:case g:case m:case c:return e;default:return t}}case i:return t}}}function w(e){return b(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=l,t.ContextProvider=c,t.Element=r,t.ForwardRef=h,t.Fragment=o,t.Lazy=g,t.Memo=m,t.Portal=i,t.Profiler=a,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return w(e)||b(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return b(e)===l},t.isContextProvider=function(e){return b(e)===c},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return b(e)===h},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===g},t.isMemo=function(e){return b(e)===m},t.isPortal=function(e){return b(e)===i},t.isProfiler=function(e){return b(e)===a},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===d||e===a||e===s||e===p||e===f||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===c||e.$$typeof===l||e.$$typeof===h||e.$$typeof===y||e.$$typeof===_||e.$$typeof===E||e.$$typeof===v)},t.typeOf=b},2183:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite")},2529:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(9950),i=n(1399);const o=function(e){const t=r.useRef(e);return(0,i.A)((()=>{t.current=e})),r.useRef((function(){return(0,t.current)(...arguments)})).current}},2654:(e,t,n)=>{"use strict";var r=n(9950),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,o={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},2703:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>a,BO:()=>s,Yn:()=>o});var r=n(5501),i=n(8286);function o(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){const n=`vars.${t}`.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=n)return n}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function s(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"===typeof e?e(n):Array.isArray(e)?e[n]||i:o(e,n)||i,t&&(r=t(r,i,e)),r}const a=function(e){const{prop:t,cssProperty:n=e.prop,themeKey:a,transform:c}=e,l=e=>{if(null==e[t])return null;const l=e[t],u=o(e.theme,a)||{};return(0,i.NI)(e,l,(e=>{let i=s(u,c,e);return e===i&&"string"===typeof e&&(i=s(u,c,`${t}${"default"===e?"":(0,r.A)(e)}`,e)),!1===n?i:{[n]:i}}))};return l.propTypes={},l.filterProps=[t],l}},2860:(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var r=n(8168),i=n(8587),o=n(7483),s=n(3628);const a={borderRadius:4};var c=n(7937);var l=n(505),u=n(8076),d=n(86);const h=["breakpoints","palette","spacing","shape"];const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:n={},spacing:p,shape:f={}}=e,m=(0,i.A)(e,h),g=(0,s.A)(t),v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;const t=(0,c.LX)({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0===n.length?[1]:n).map((e=>{const n=t(e);return"number"===typeof n?`${n}px`:n})).join(" ")};return n.mui=!0,n}(p);let y=(0,o.A)({breakpoints:g,direction:"ltr",components:{},palette:(0,r.A)({mode:"light"},n),spacing:v,shape:(0,r.A)({},a,f)},m);y.applyStyles=d.A;for(var _=arguments.length,E=new Array(_>1?_-1:0),b=1;b<_;b++)E[b-1]=arguments[b];return y=E.reduce(((e,t)=>(0,o.A)(e,t)),y),y.unstable_sxConfig=(0,r.A)({},u.A,null==m?void 0:m.unstable_sxConfig),y.unstable_sx=function(e){return(0,l.A)({sx:e,theme:this})},y}},2937:(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var r=n(9950),i=n(1824);let o=!0,s=!1;const a=new i.E,c={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function l(e){e.metaKey||e.altKey||e.ctrlKey||(o=!0)}function u(){o=!1}function d(){"hidden"===this.visibilityState&&s&&(o=!0)}function h(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(n){}return o||function(e){const{type:t,tagName:n}=e;return!("INPUT"!==n||!c[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}const p=function(){const e=r.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",l,!0),t.addEventListener("mousedown",u,!0),t.addEventListener("pointerdown",u,!0),t.addEventListener("touchstart",u,!0),t.addEventListener("visibilitychange",d,!0))}),[]),t=r.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!h(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(s=!0,a.start(100,(()=>{s=!1})),t.current=!1,!0)},ref:e}}},3158:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});n(9950);var r=n(8283),i=n(4414);function o(e){const{styles:t,defaultTheme:n={}}=e,o="function"===typeof t?e=>{return t(void 0===(r=e)||null===r||0===Object.keys(r).length?n:e);var r}:t;return(0,i.jsx)(r.mL,{styles:o})}},3235:(e,t,n)=>{"use strict";n.d(t,{A:()=>_});var r=n(8168),i=n(9950),o=n(8587),s=n(2004),a=n(8465),c=n(1676),l=n(8463),u=n(9254),d=n(1763),h=n(423);function p(e){return(0,h.Ay)("MuiSvgIcon",e)}(0,d.A)("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var f=n(4414);const m=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],g=(0,u.Ay)("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"inherit"!==n.color&&t[`color${(0,c.A)(n.color)}`],t[`fontSize${(0,c.A)(n.fontSize)}`]]}})((e=>{let{theme:t,ownerState:n}=e;var r,i,o,s,a,c,l,u,d,h,p,f,m;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:n.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(r=t.transitions)||null==(i=r.create)?void 0:i.call(r,"fill",{duration:null==(o=t.transitions)||null==(o=o.duration)?void 0:o.shorter}),fontSize:{inherit:"inherit",small:(null==(s=t.typography)||null==(a=s.pxToRem)?void 0:a.call(s,20))||"1.25rem",medium:(null==(c=t.typography)||null==(l=c.pxToRem)?void 0:l.call(c,24))||"1.5rem",large:(null==(u=t.typography)||null==(d=u.pxToRem)?void 0:d.call(u,35))||"2.1875rem"}[n.fontSize],color:null!=(h=null==(p=(t.vars||t).palette)||null==(p=p[n.color])?void 0:p.main)?h:{action:null==(f=(t.vars||t).palette)||null==(f=f.action)?void 0:f.active,disabled:null==(m=(t.vars||t).palette)||null==(m=m.action)?void 0:m.disabled,inherit:void 0}[n.color]}})),v=i.forwardRef((function(e,t){const n=(0,l.b)({props:e,name:"MuiSvgIcon"}),{children:u,className:d,color:h="inherit",component:v="svg",fontSize:y="medium",htmlColor:_,inheritViewBox:E=!1,titleAccess:b,viewBox:w="0 0 24 24"}=n,S=(0,o.A)(n,m),T=i.isValidElement(u)&&"svg"===u.type,C=(0,r.A)({},n,{color:h,component:v,fontSize:y,instanceFontSize:e.fontSize,inheritViewBox:E,viewBox:w,hasSvgAsChild:T}),A={};E||(A.viewBox=w);const R=(e=>{const{color:t,fontSize:n,classes:r}=e,i={root:["root","inherit"!==t&&`color${(0,c.A)(t)}`,`fontSize${(0,c.A)(n)}`]};return(0,a.A)(i,p,r)})(C);return(0,f.jsxs)(g,(0,r.A)({as:v,className:(0,s.A)(R.root,d),focusable:"false",color:_,"aria-hidden":!b||void 0,role:b?"img":void 0,ref:t},A,S,T&&u.props,{ownerState:C,children:[T?u.props.children:u,b?(0,f.jsx)("title",{children:b}):null]}))}));v.muiName="SvgIcon";const y=v;function _(e,t){function n(n,i){return(0,f.jsx)(y,(0,r.A)({"data-testid":`${t}Icon`,ref:i},n,{children:e}))}return n.muiName=y.muiName,i.memo(i.forwardRef(n))}},3488:(e,t,n)=>{"use strict";var r=n(3959);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,s){if(s!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},3539:(e,t,n)=>{"use strict";var r;n.d(t,{A:()=>a});var i=n(9950);let o=0;const s=(r||(r=n.t(i,2)))["useId".toString()];function a(e){if(void 0!==s){const t=s();return null!=e?e:t}return function(e){const[t,n]=i.useState(e),r=e||t;return i.useEffect((()=>{null==t&&(o+=1,n(`mui-${o}`))}),[t]),r}(e)}},3628:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(8587),i=n(8168);const o=["values","unit","step"],s=e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,i.A)({},e,{[t.key]:t.val})),{})};function a(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:a=5}=e,c=(0,r.A)(e,o),l=s(t),u=Object.keys(l);function d(e){return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${n})`}function h(e){return`@media (max-width:${("number"===typeof t[e]?t[e]:e)-a/100}${n})`}function p(e,r){const i=u.indexOf(r);return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${n}) and (max-width:${(-1!==i&&"number"===typeof t[u[i]]?t[u[i]]:r)-a/100}${n})`}return(0,i.A)({keys:u,values:l,up:d,down:h,between:p,only:function(e){return u.indexOf(e)+1<u.length?p(e,u[u.indexOf(e)+1]):d(e)},not:function(e){const t=u.indexOf(e);return 0===t?d(u[1]):t===u.length-1?h(u[t]):p(e,u[u.indexOf(e)+1]).replace("@media","@media not all and")},unit:n},c)}},3828:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(9950);const i=function(e,t){var n,i;return r.isValidElement(e)&&-1!==t.indexOf(null!=(n=e.type.muiName)?n:null==(i=e.type)||null==(i=i._payload)||null==(i=i.value)?void 0:i.muiName)}},3876:(e,t,n)=>{"use strict";var r=n(630),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function c(e){return r.isMemo(e)?s:a[e.$$typeof]||i}a[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[r.Memo]=s;var l=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(f){var i=p(n);i&&i!==f&&e(t,i,r)}var s=u(n);d&&(s=s.concat(d(n)));for(var a=c(t),m=c(n),g=0;g<s.length;++g){var v=s[g];if(!o[v]&&(!r||!r[v])&&(!m||!m[v])&&(!a||!a[v])){var y=h(n,v);try{l(t,v,y)}catch(_){}}}}return t}},3931:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(9950);function i(e){let{controlled:t,default:n,name:i,state:o="value"}=e;const{current:s}=r.useRef(void 0!==t),[a,c]=r.useState(n);return[s?t:a,r.useCallback((e=>{s||c(e)}),[])]}},3959:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4414:(e,t,n)=>{"use strict";e.exports=n(2654)},4436:(e,t,n)=>{"use strict";n.d(t,{A:()=>D});var r=n(8168),i=n(8587),o=n(8099),s=n(7483),a=n(8076),c=n(505),l=n(2860);var u=n(9269);const d={black:"#000",white:"#fff"},h={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},p={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},f={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},m={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},v={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},y={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},_=["mode","contrastThreshold","tonalOffset"],E={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:d.white,default:d.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},b={text:{primary:d.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:d.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function w(e,t,n,r){const i=r.light||r,o=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=(0,u.a)(e.main,i):"dark"===t&&(e.dark=(0,u.e$)(e.main,o)))}function S(e){const{mode:t="light",contrastThreshold:n=3,tonalOffset:a=.2}=e,c=(0,i.A)(e,_),l=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:g[200],light:g[50],dark:g[400]}:{main:g[700],light:g[400],dark:g[800]}}(t),S=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:p[200],light:p[50],dark:p[400]}:{main:p[500],light:p[300],dark:p[700]}}(t),T=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:f[500],light:f[300],dark:f[700]}:{main:f[700],light:f[400],dark:f[800]}}(t),C=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:v[400],light:v[300],dark:v[700]}:{main:v[700],light:v[500],dark:v[900]}}(t),A=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:y[400],light:y[300],dark:y[700]}:{main:y[800],light:y[500],dark:y[900]}}(t),R=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:m[400],light:m[300],dark:m[700]}:{main:"#ed6c02",light:m[500],dark:m[900]}}(t);function I(e){return(0,u.eM)(e,b.text.primary)>=n?b.text.primary:E.text.primary}const x=e=>{let{color:t,name:n,mainShade:i=500,lightShade:s=300,darkShade:c=700}=e;if(t=(0,r.A)({},t),!t.main&&t[i]&&(t.main=t[i]),!t.hasOwnProperty("main"))throw new Error((0,o.A)(11,n?` (${n})`:"",i));if("string"!==typeof t.main)throw new Error((0,o.A)(12,n?` (${n})`:"",JSON.stringify(t.main)));return w(t,"light",s,a),w(t,"dark",c,a),t.contrastText||(t.contrastText=I(t.main)),t},O={dark:b,light:E};return(0,s.A)((0,r.A)({common:(0,r.A)({},d),mode:t,primary:x({color:l,name:"primary"}),secondary:x({color:S,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:x({color:T,name:"error"}),warning:x({color:R,name:"warning"}),info:x({color:C,name:"info"}),success:x({color:A,name:"success"}),grey:h,contrastThreshold:n,getContrastText:I,augmentColor:x,tonalOffset:a},O[t]),c)}const T=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];const C={textTransform:"uppercase"},A='"Roboto", "Helvetica", "Arial", sans-serif';function R(e,t){const n="function"===typeof t?t(e):t,{fontFamily:o=A,fontSize:a=14,fontWeightLight:c=300,fontWeightRegular:l=400,fontWeightMedium:u=500,fontWeightBold:d=700,htmlFontSize:h=16,allVariants:p,pxToRem:f}=n,m=(0,i.A)(n,T);const g=a/14,v=f||(e=>e/h*g+"rem"),y=(e,t,n,i,s)=>{return(0,r.A)({fontFamily:o,fontWeight:e,fontSize:v(t),lineHeight:n},o===A?{letterSpacing:(a=i/t,Math.round(1e5*a)/1e5)+"em"}:{},s,p);var a},_={h1:y(c,96,1.167,-1.5),h2:y(c,60,1.2,-.5),h3:y(l,48,1.167,0),h4:y(l,34,1.235,.25),h5:y(l,24,1.334,0),h6:y(u,20,1.6,.15),subtitle1:y(l,16,1.75,.15),subtitle2:y(u,14,1.57,.1),body1:y(l,16,1.5,.15),body2:y(l,14,1.43,.15),button:y(u,14,1.75,.4,C),caption:y(l,12,1.66,.4),overline:y(l,12,2.66,1,C),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,s.A)((0,r.A)({htmlFontSize:h,pxToRem:v,fontFamily:o,fontSize:a,fontWeightLight:c,fontWeightRegular:l,fontWeightMedium:u,fontWeightBold:d},_),m,{clone:!1})}function I(){return[`${arguments.length<=0?void 0:arguments[0]}px ${arguments.length<=1?void 0:arguments[1]}px ${arguments.length<=2?void 0:arguments[2]}px ${arguments.length<=3?void 0:arguments[3]}px rgba(0,0,0,0.2)`,`${arguments.length<=4?void 0:arguments[4]}px ${arguments.length<=5?void 0:arguments[5]}px ${arguments.length<=6?void 0:arguments[6]}px ${arguments.length<=7?void 0:arguments[7]}px rgba(0,0,0,0.14)`,`${arguments.length<=8?void 0:arguments[8]}px ${arguments.length<=9?void 0:arguments[9]}px ${arguments.length<=10?void 0:arguments[10]}px ${arguments.length<=11?void 0:arguments[11]}px rgba(0,0,0,0.12)`].join(",")}const x=["none",I(0,2,1,-1,0,1,1,0,0,1,3,0),I(0,3,1,-2,0,2,2,0,0,1,5,0),I(0,3,3,-2,0,3,4,0,0,1,8,0),I(0,2,4,-1,0,4,5,0,0,1,10,0),I(0,3,5,-1,0,5,8,0,0,1,14,0),I(0,3,5,-1,0,6,10,0,0,1,18,0),I(0,4,5,-2,0,7,10,1,0,2,16,1),I(0,5,5,-3,0,8,10,1,0,3,14,2),I(0,5,6,-3,0,9,12,1,0,3,16,2),I(0,6,6,-3,0,10,14,1,0,4,18,3),I(0,6,7,-4,0,11,15,1,0,4,20,3),I(0,7,8,-4,0,12,17,2,0,5,22,4),I(0,7,8,-4,0,13,19,2,0,5,24,4),I(0,7,9,-4,0,14,21,2,0,5,26,4),I(0,8,9,-5,0,15,22,2,0,6,28,5),I(0,8,10,-5,0,16,24,2,0,6,30,5),I(0,8,11,-5,0,17,26,2,0,6,32,5),I(0,9,11,-5,0,18,28,2,0,7,34,6),I(0,9,12,-6,0,19,29,2,0,7,36,6),I(0,10,13,-6,0,20,31,3,0,8,38,7),I(0,10,13,-6,0,21,33,3,0,8,40,7),I(0,10,14,-6,0,22,35,3,0,8,42,7),I(0,11,14,-7,0,23,36,3,0,9,44,8),I(0,11,15,-7,0,24,38,3,0,9,46,8)];var O=n(5361);const k={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},N=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mixins:t={},palette:n={},transitions:u={},typography:d={}}=e,h=(0,i.A)(e,N);if(e.vars&&void 0===e.generateCssVars)throw new Error((0,o.A)(18));const p=S(n),f=(0,l.A)(e);let m=(0,s.A)(f,{mixins:(g=f.breakpoints,v=t,(0,r.A)({toolbar:{minHeight:56,[g.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[g.up("sm")]:{minHeight:64}}},v)),palette:p,shadows:x.slice(),typography:R(p,d),transitions:(0,O.Ay)(u),zIndex:(0,r.A)({},k)});var g,v;m=(0,s.A)(m,h);for(var y=arguments.length,_=new Array(y>1?y-1:0),E=1;E<y;E++)_[E-1]=arguments[E];return m=_.reduce(((e,t)=>(0,s.A)(e,t)),m),m.unstable_sxConfig=(0,r.A)({},a.A,null==h?void 0:h.unstable_sxConfig),m.unstable_sx=function(e){return(0,c.A)({sx:e,theme:this})},m}const D=P},4453:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},4501:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const r=e=>e,i=(()=>{let e=r;return{configure(t){e=t},generate:t=>e(t),reset(){e=r}}})()},4634:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4893:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},4894:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},r=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},i={p:r,P:function(e,t){var i,o=e.match(/(P+)(p+)?/)||[],s=o[1],a=o[2];if(!a)return n(e,t);switch(s){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;default:i=t.dateTime({width:"full"})}return i.replace("{{date}}",n(s,t)).replace("{{time}}",r(a,t))}};t.default=i,e.exports=t.default},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},5329:(e,t,n)=>{"use strict";t.A=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(9950)),i=n(116);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}t.A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=r.useContext(i.ThemeContext);return t&&(n=t,0!==Object.keys(n).length)?t:e;var n}},5340:(e,t,n)=>{"use strict";e.exports=n(1761)},5361:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>u,p0:()=>a});var r=n(8587),i=n(8168);const o=["duration","easing","delay"],s={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},a={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function c(e){return`${Math.round(e)}ms`}function l(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function u(e){const t=(0,i.A)({},s,e.easing),n=(0,i.A)({},a,e.duration);return(0,i.A)({getAutoHeightDuration:l,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:s=n.standard,easing:a=t.easeInOut,delay:l=0}=i;(0,r.A)(i,o);return(Array.isArray(e)?e:[e]).map((e=>`${e} ${"string"===typeof s?s:c(s)} ${a} ${"string"===typeof l?l:c(l)}`)).join(",")}},e,{easing:t,duration:n})}},5393:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(9950),i=n(5587);function o(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.useMemo((()=>t.every((e=>null==e))?null:e=>{t.forEach((t=>{(0,i.A)(t,e)}))}),t)}},5433:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"Restore")},5501:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(8099);function i(e){if("string"!==typeof e)throw new Error((0,r.A)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},5511:(e,t,n)=>{"use strict";function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>null==t?e:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r),t.apply(this,r)}),(()=>{}))}n.d(t,{A:()=>r})},5537:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(8168);function i(e,t){const n=(0,r.A)({},t);return Object.keys(e).forEach((o=>{if(o.toString().match(/^(components|slots)$/))n[o]=(0,r.A)({},e[o],n[o]);else if(o.toString().match(/^(componentsProps|slotProps)$/)){const s=e[o]||{},a=t[o];n[o]={},a&&Object.keys(a)?s&&Object.keys(s)?(n[o]=(0,r.A)({},a),Object.keys(s).forEach((e=>{n[o][e]=i(s[e],a[e])}))):n[o]=a:n[o]=s}else void 0===n[o]&&(n[o]=e[o])})),n}},5587:(e,t,n)=>{"use strict";function r(e,t){"function"===typeof e?e(t):e&&(e.current=t)}n.d(t,{A:()=>r})},6171:(e,t,n)=>{"use strict";n.d(t,{A:()=>c,b:()=>a});var r=n(9950),i=n(5537),o=n(4414);const s=r.createContext(void 0);function a(e){let{props:t,name:n}=e;return function(e){const{theme:t,name:n,props:r}=e;if(!t||!t.components||!t.components[n])return r;const o=t.components[n];return o.defaultProps?(0,i.A)(o.defaultProps,r):o.styleOverrides||o.variants?r:(0,i.A)(o,r)}({props:t,name:n,theme:{components:r.useContext(s)}})}const c=function(e){let{value:t,children:n}=e;return(0,o.jsx)(s.Provider,{value:t,children:n})}},6206:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(7483);const i=function(e,t){return t?(0,r.A)(e,t,{clone:!1}):e}},6319:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},6477:(e,t,n)=>{"use strict";var r;n.d(t,{i:()=>a,s:()=>s});var i=n(9950),o=!!(r||(r=n.t(i,2))).useInsertionEffect&&(r||(r=n.t(i,2))).useInsertionEffect,s=o||function(e){return e()},a=o||i.useLayoutEffect},6747:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MIN_SAFE_INTEGER,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Math.max(t,Math.min(e,n))}},6832:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2z"}),"Repeat")},6879:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler");Symbol.for("react.provider");var a=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.for("react.view_transition"),m=Symbol.for("react.client.reference");function g(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case i:case s:case o:case u:case d:case f:return e;default:switch(e=e&&e.$$typeof){case c:case l:case p:case h:case a:return e;default:return t}}case r:return t}}}t.vM=l,t.lD=h},6907:(e,t,n)=>{"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,{A:()=>r})},7034:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalize:()=>i.A,createChainedFunction:()=>o,createSvgIcon:()=>s.A,debounce:()=>a.A,deprecatedPropType:()=>c,isMuiElement:()=>l.A,ownerDocument:()=>u.A,ownerWindow:()=>d.A,requirePropFactory:()=>h,setRef:()=>p,unstable_ClassNameGenerator:()=>b,unstable_useEnhancedEffect:()=>f.A,unstable_useId:()=>m.A,unsupportedProp:()=>g,useControlled:()=>v.A,useEventCallback:()=>y.A,useForkRef:()=>_.A,useIsFocusVisible:()=>E.A});var r=n(4501),i=n(1676);const o=n(5511).A;var s=n(3235),a=n(1209);const c=function(e,t){return()=>null};var l=n(3828),u=n(7402),d=n(827);const h=function(e,t){return()=>null};const p=n(5587).A;var f=n(9044),m=n(1014);const g=function(e,t,n,r,i){return null};var v=n(8733),y=n(1976),_=n(1506),E=n(2937);const b={configure:e=>{r.A.configure(e)}}},7119:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(8345)},7295:(e,t,n)=>{"use strict";var r=n(4994);t.Ay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=m,rootShouldForwardProp:r=f,slotShouldForwardProp:c=f}=e,u=e=>(0,l.default)((0,i.default)({},e,{theme:v((0,i.default)({},e,{defaultTheme:n,themeId:t}))}));return u.__mui_systemSx=!0,function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:d,slot:p,skipVariantsResolver:m,skipSx:E,overridesResolver:b=y(g(p))}=l,w=(0,o.default)(l,h),S=void 0!==m?m:p&&"Root"!==p&&"root"!==p||!1,T=E||!1;let C=f;"Root"===p||"root"===p?C=r:p?C=c:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(C=void 0);const A=(0,s.default)(e,(0,i.default)({shouldForwardProp:C,label:undefined},w)),R=e=>"function"===typeof e&&e.__emotion_real!==e||(0,a.isPlainObject)(e)?r=>_(e,(0,i.default)({},r,{theme:v({theme:r.theme,defaultTheme:n,themeId:t})})):e,I=function(r){let o=R(r);for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];const l=a?a.map(R):[];d&&b&&l.push((e=>{const r=v((0,i.default)({},e,{defaultTheme:n,themeId:t}));if(!r.components||!r.components[d]||!r.components[d].styleOverrides)return null;const o=r.components[d].styleOverrides,s={};return Object.entries(o).forEach((t=>{let[n,o]=t;s[n]=_(o,(0,i.default)({},e,{theme:r}))})),b(e,s)})),d&&!S&&l.push((e=>{var r;const o=v((0,i.default)({},e,{defaultTheme:n,themeId:t}));return _({variants:null==o||null==(r=o.components)||null==(r=r[d])?void 0:r.variants},(0,i.default)({},e,{theme:o}))})),T||l.push(u);const h=l.length-a.length;if(Array.isArray(r)&&h>0){const e=new Array(h).fill("");o=[...r,...e],o.raw=[...r.raw,...e]}const p=A(o,...l);return e.muiName&&(p.muiName=e.muiName),p};return A.withConfig&&(I.withConfig=A.withConfig),I}};var i=r(n(4634)),o=r(n(4893)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(116)),a=n(7785),c=(r(n(304)),r(n(8399)),r(n(9904))),l=r(n(8807));const u=["ownerState"],d=["variants"],h=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function f(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const m=(0,c.default)(),g=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function v(e){let{defaultTheme:t,theme:n,themeId:r}=e;return i=n,0===Object.keys(i).length?t:n[r]||n;var i}function y(e){return e?(t,n)=>n[e]:null}function _(e,t){let{ownerState:n}=t,r=(0,o.default)(t,u);const s="function"===typeof e?e((0,i.default)({ownerState:n},r)):e;if(Array.isArray(s))return s.flatMap((e=>_(e,(0,i.default)({ownerState:n},r))));if(s&&"object"===typeof s&&Array.isArray(s.variants)){const{variants:e=[]}=s;let t=(0,o.default)(s,d);return e.forEach((e=>{let o=!0;"function"===typeof e.props?o=e.props((0,i.default)({ownerState:n},r,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&r[t]!==e.props[t]&&(o=!1)})),o&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,i.default)({ownerState:n},r,n)):e.style))})),t}return s}},7370:(e,t,n)=>{"use strict";n.d(t,{C:()=>l,E:()=>g,T:()=>d,c:()=>f,h:()=>h,w:()=>u});var r=n(9950),i=n(8603),o=n(1783),s=n(9015),a=n(6477),c=r.createContext("undefined"!==typeof HTMLElement?(0,i.A)({key:"css"}):null),l=c.Provider,u=function(e){return(0,r.forwardRef)((function(t,n){var i=(0,r.useContext)(c);return e(t,i,n)}))},d=r.createContext({});var h={}.hasOwnProperty,p="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",f=function(e,t){var n={};for(var r in t)h.call(t,r)&&(n[r]=t[r]);return n[p]=e,n},m=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return(0,o.SF)(t,n,r),(0,a.s)((function(){return(0,o.sk)(t,n,r)})),null},g=u((function(e,t,n){var i=e.css;"string"===typeof i&&void 0!==t.registered[i]&&(i=t.registered[i]);var a=e[p],c=[i],l="";"string"===typeof e.className?l=(0,o.Rk)(t.registered,c,e.className):null!=e.className&&(l=e.className+" ");var u=(0,s.J)(c,void 0,r.useContext(d));l+=t.key+"-"+u.name;var f={};for(var g in e)h.call(e,g)&&"css"!==g&&g!==p&&(f[g]=e[g]);return f.className=l,n&&(f.ref=n),r.createElement(r.Fragment,null,r.createElement(m,{cache:t,serialized:u,isStringTag:"string"===typeof a}),r.createElement(a,f))}))},7402:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(6907).A},7483:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,Q:()=>o});var r=n(8168),i=n(9950);function o(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function s(e){if(i.isValidElement(e)||!o(e))return e;const t={};return Object.keys(e).forEach((n=>{t[n]=s(e[n])})),t}function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const c=n.clone?(0,r.A)({},e):e;return o(e)&&o(t)&&Object.keys(t).forEach((r=>{i.isValidElement(t[r])?c[r]=t[r]:o(t[r])&&Object.prototype.hasOwnProperty.call(e,r)&&o(e[r])?c[r]=a(e[r],t[r],n):n.clone?c[r]=o(t[r])?s(t[r]):t[r]:c[r]=t[r]})),c}},7550:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r="$$material"},7785:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.A,isPlainObject:()=>r.Q});var r=n(7483)},7813:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever")},7923:(e,t,n)=>{"use strict";function r(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}n.d(t,{A:()=>r})},7937:(e,t,n)=>{"use strict";n.d(t,{LX:()=>f,MA:()=>p,_W:()=>m,Lc:()=>y,Ms:()=>_});var r=n(8286),i=n(2703),o=n(6206);const s={m:"margin",p:"padding"},a={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},c={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},l=function(e){const t={};return n=>(void 0===t[n]&&(t[n]=e(n)),t[n])}((e=>{if(e.length>2){if(!c[e])return[e];e=c[e]}const[t,n]=e.split(""),r=s[t],i=a[n]||"";return Array.isArray(i)?i.map((e=>r+e)):[r+i]})),u=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],d=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],h=[...u,...d];function p(e,t,n,r){var o;const s=null!=(o=(0,i.Yn)(e,t,!1))?o:n;return"number"===typeof s?e=>"string"===typeof e?e:s*e:Array.isArray(s)?e=>"string"===typeof e?e:s[e]:"function"===typeof s?s:()=>{}}function f(e){return p(e,"spacing",8)}function m(e,t){if("string"===typeof t||null==t)return t;const n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:`-${n}`}function g(e,t,n,i){if(-1===t.indexOf(n))return null;const o=function(e,t){return n=>e.reduce(((e,r)=>(e[r]=m(t,n),e)),{})}(l(n),i),s=e[n];return(0,r.NI)(e,s,o)}function v(e,t){const n=f(e.theme);return Object.keys(e).map((r=>g(e,t,r,n))).reduce(o.A,{})}function y(e){return v(e,u)}function _(e){return v(e,d)}function E(e){return v(e,h)}y.propTypes={},y.filterProps=u,_.propTypes={},_.filterProps=d,E.propTypes={},E.filterProps=h},7988:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},8076:(e,t,n)=>{"use strict";n.d(t,{A:()=>D});var r=n(7937),i=n(2703),o=n(6206);const s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>(t.filterProps.forEach((n=>{e[n]=t})),e)),{}),i=e=>Object.keys(e).reduce(((t,n)=>r[n]?(0,o.A)(t,r[n](e)):t),{});return i.propTypes={},i.filterProps=t.reduce(((e,t)=>e.concat(t.filterProps)),[]),i};var a=n(8286);function c(e){return"number"!==typeof e?e:`${e}px solid`}function l(e,t){return(0,i.Ay)({prop:e,themeKey:"borders",transform:t})}const u=l("border",c),d=l("borderTop",c),h=l("borderRight",c),p=l("borderBottom",c),f=l("borderLeft",c),m=l("borderColor"),g=l("borderTopColor"),v=l("borderRightColor"),y=l("borderBottomColor"),_=l("borderLeftColor"),E=l("outline",c),b=l("outlineColor"),w=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,r.MA)(e.theme,"shape.borderRadius",4,"borderRadius"),n=e=>({borderRadius:(0,r._W)(t,e)});return(0,a.NI)(e,e.borderRadius,n)}return null};w.propTypes={},w.filterProps=["borderRadius"];s(u,d,h,p,f,m,g,v,y,_,w,E,b);const S=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,r.MA)(e.theme,"spacing",8,"gap"),n=e=>({gap:(0,r._W)(t,e)});return(0,a.NI)(e,e.gap,n)}return null};S.propTypes={},S.filterProps=["gap"];const T=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,r.MA)(e.theme,"spacing",8,"columnGap"),n=e=>({columnGap:(0,r._W)(t,e)});return(0,a.NI)(e,e.columnGap,n)}return null};T.propTypes={},T.filterProps=["columnGap"];const C=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,r.MA)(e.theme,"spacing",8,"rowGap"),n=e=>({rowGap:(0,r._W)(t,e)});return(0,a.NI)(e,e.rowGap,n)}return null};C.propTypes={},C.filterProps=["rowGap"];s(S,T,C,(0,i.Ay)({prop:"gridColumn"}),(0,i.Ay)({prop:"gridRow"}),(0,i.Ay)({prop:"gridAutoFlow"}),(0,i.Ay)({prop:"gridAutoColumns"}),(0,i.Ay)({prop:"gridAutoRows"}),(0,i.Ay)({prop:"gridTemplateColumns"}),(0,i.Ay)({prop:"gridTemplateRows"}),(0,i.Ay)({prop:"gridTemplateAreas"}),(0,i.Ay)({prop:"gridArea"}));function A(e,t){return"grey"===t?t:e}s((0,i.Ay)({prop:"color",themeKey:"palette",transform:A}),(0,i.Ay)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:A}),(0,i.Ay)({prop:"backgroundColor",themeKey:"palette",transform:A}));function R(e){return e<=1&&0!==e?100*e+"%":e}const I=(0,i.Ay)({prop:"width",transform:R}),x=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var n,r;const i=(null==(n=e.theme)||null==(n=n.breakpoints)||null==(n=n.values)?void 0:n[t])||a.zu[t];return i?"px"!==(null==(r=e.theme)||null==(r=r.breakpoints)?void 0:r.unit)?{maxWidth:`${i}${e.theme.breakpoints.unit}`}:{maxWidth:i}:{maxWidth:R(t)}};return(0,a.NI)(e,e.maxWidth,t)}return null};x.filterProps=["maxWidth"];const O=(0,i.Ay)({prop:"minWidth",transform:R}),k=(0,i.Ay)({prop:"height",transform:R}),N=(0,i.Ay)({prop:"maxHeight",transform:R}),P=(0,i.Ay)({prop:"minHeight",transform:R}),D=((0,i.Ay)({prop:"size",cssProperty:"width",transform:R}),(0,i.Ay)({prop:"size",cssProperty:"height",transform:R}),s(I,x,O,k,N,P,(0,i.Ay)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:c},borderTop:{themeKey:"borders",transform:c},borderRight:{themeKey:"borders",transform:c},borderBottom:{themeKey:"borders",transform:c},borderLeft:{themeKey:"borders",transform:c},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:c},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:w},color:{themeKey:"palette",transform:A},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:A},backgroundColor:{themeKey:"palette",transform:A},p:{style:r.Ms},pt:{style:r.Ms},pr:{style:r.Ms},pb:{style:r.Ms},pl:{style:r.Ms},px:{style:r.Ms},py:{style:r.Ms},padding:{style:r.Ms},paddingTop:{style:r.Ms},paddingRight:{style:r.Ms},paddingBottom:{style:r.Ms},paddingLeft:{style:r.Ms},paddingX:{style:r.Ms},paddingY:{style:r.Ms},paddingInline:{style:r.Ms},paddingInlineStart:{style:r.Ms},paddingInlineEnd:{style:r.Ms},paddingBlock:{style:r.Ms},paddingBlockStart:{style:r.Ms},paddingBlockEnd:{style:r.Ms},m:{style:r.Lc},mt:{style:r.Lc},mr:{style:r.Lc},mb:{style:r.Lc},ml:{style:r.Lc},mx:{style:r.Lc},my:{style:r.Lc},margin:{style:r.Lc},marginTop:{style:r.Lc},marginRight:{style:r.Lc},marginBottom:{style:r.Lc},marginLeft:{style:r.Lc},marginX:{style:r.Lc},marginY:{style:r.Lc},marginInline:{style:r.Lc},marginInlineStart:{style:r.Lc},marginInlineEnd:{style:r.Lc},marginBlock:{style:r.Lc},marginBlockStart:{style:r.Lc},marginBlockEnd:{style:r.Lc},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:S},rowGap:{style:C},columnGap:{style:T},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:R},maxWidth:{style:x},minWidth:{transform:R},height:{transform:R},maxHeight:{transform:R},minHeight:{transform:R},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},8099:(e,t,n)=>{"use strict";function r(e){let t="https://mui.com/production-error/?code="+e;for(let n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}n.d(t,{A:()=>r})},8154:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Comment")},8168:(e,t,n)=>{"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(null,arguments)}n.d(t,{A:()=>r})},8283:(e,t,n)=>{"use strict";n.d(t,{AH:()=>u,i7:()=>d,mL:()=>l});var r=n(7370),i=n(9950),o=n(1783),s=n(6477),a=n(9015),c=(n(8603),n(3876),function(e,t){var n=arguments;if(null==t||!r.h.call(t,"css"))return i.createElement.apply(void 0,n);var o=n.length,s=new Array(o);s[0]=r.E,s[1]=(0,r.c)(e,t);for(var a=2;a<o;a++)s[a]=n[a];return i.createElement.apply(null,s)});!function(e){var t;t||(t=e.JSX||(e.JSX={}))}(c||(c={}));var l=(0,r.w)((function(e,t){var n=e.styles,c=(0,a.J)([n],void 0,i.useContext(r.T)),l=i.useRef();return(0,s.i)((function(){var e=t.key+"-global",n=new t.sheet.constructor({key:e,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),r=!1,i=document.querySelector('style[data-emotion="'+e+" "+c.name+'"]');return t.sheet.tags.length&&(n.before=t.sheet.tags[0]),null!==i&&(r=!0,i.setAttribute("data-emotion",e),n.hydrate([i])),l.current=[n,r],function(){n.flush()}}),[t]),(0,s.i)((function(){var e=l.current,n=e[0];if(e[1])e[1]=!1;else{if(void 0!==c.next&&(0,o.sk)(t,c.next,!0),n.tags.length){var r=n.tags[n.tags.length-1].nextElementSibling;n.before=r,n.flush()}t.insert("",c,n,!1)}}),[t,c.name]),null}));function u(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.J)(t)}function d(){var e=u.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}},8286:(e,t,n)=>{"use strict";n.d(t,{EU:()=>a,NI:()=>s,iZ:()=>l,kW:()=>u,vf:()=>c,zu:()=>i});var r=n(7483);const i={xs:0,sm:600,md:900,lg:1200,xl:1536},o={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${i[e]}px)`};function s(e,t,n){const r=e.theme||{};if(Array.isArray(t)){const e=r.breakpoints||o;return t.reduce(((r,i,o)=>(r[e.up(e.keys[o])]=n(t[o]),r)),{})}if("object"===typeof t){const e=r.breakpoints||o;return Object.keys(t).reduce(((r,o)=>{if(-1!==Object.keys(e.values||i).indexOf(o)){r[e.up(o)]=n(t[o],o)}else{const e=o;r[e]=t[e]}return r}),{})}return n(t)}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return(null==(t=e.keys)?void 0:t.reduce(((t,n)=>(t[e.up(n)]={},t)),{}))||{}}function c(e,t){return e.reduce(((e,t)=>{const n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function l(e){const t=a(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];const s=[t,...i].reduce(((e,t)=>(0,r.A)(e,t)),{});return c(Object.keys(t),s)}function u(e){let{values:t,breakpoints:n,base:r}=e;const i=r||function(e,t){if("object"!==typeof e)return{};const n={},r=Object.keys(t);return Array.isArray(e)?r.forEach(((t,r)=>{r<e.length&&(n[t]=!0)})):r.forEach((t=>{null!=e[t]&&(n[t]=!0)})),n}(t,n),o=Object.keys(i);if(0===o.length)return t;let s;return o.reduce(((e,n,r)=>(Array.isArray(t)?(e[n]=null!=t[r]?t[r]:t[s],s=r):"object"===typeof t?(e[n]=null!=t[n]?t[n]:t[s],s=n):e[n]=t,e)),{})}},8345:(e,t,n)=>{"use strict";var r=n(9950),i=n(5340);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function _(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),R=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),N=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var P=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var M,j=Object.assign;function U(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var V=!1;function F(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var c="\n"+i[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=s&&0<=a);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function B(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case C:return"Profiler";case T:return"StrictMode";case x:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function $(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return j({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function Q(e,t){J(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&$(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return j({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function oe(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ee=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Te=null;function Ce(e){if(e=_i(e)){if("function"!==typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=bi(t),we(e.stateNode,e.type,t))}}function Ae(e){Se?Te?Te.push(e):Te=[e]:Se=e}function Re(){if(Se){var e=Se,t=Te;if(Te=Se=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Ie(e,t){return e(t)}function xe(){}var Oe=!1;function ke(e,t,n){if(Oe)return e(t,n);Oe=!0;try{return Ie(e,t,n)}finally{Oe=!1,(null!==Se||null!==Te)&&(xe(),Re())}}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var r=bi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Pe=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ue){Pe=!1}function Le(e,t,n,r,i,o,s,a,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Me=!1,je=null,Ue=!1,Ve=null,Fe={onError:function(e){Me=!0,je=e}};function Be(e,t,n,r,i,o,s,a,c){Me=!1,je=null,Le.apply(Fe,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(We(e)!==e)throw Error(o(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return He(i),e;if(s===r)return He(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,c=i.child;c;){if(c===n){a=!0,n=i,r=s;break}if(c===r){a=!0,r=i,n=s;break}c=c.sibling}if(!a){for(c=s.child;c;){if(c===n){a=!0,n=s,r=i;break}if(c===r){a=!0,r=s,n=i;break}c=c.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,$e=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Je=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/ct|0)|0},at=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=dt(a):0!==(o&=s)&&(r=dt(o))}else 0!==(s=n&~i)?r=dt(s):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var _t=0;function Et(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,St,Tt,Ct,At=!1,Rt=[],It=null,xt=null,Ot=null,kt=new Map,Nt=new Map,Pt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":xt=null;break;case"mouseover":case"mouseout":Ot=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nt.delete(t.pointerId)}}function Mt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=_i(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function jt(e){var t=yi(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=ze(n)))return e.blockedOn=t,void Ct(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_i(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ee=r,n.target.dispatchEvent(r),Ee=null,t.shift()}return!0}function Vt(e,t,n){Ut(e)&&n.delete(t)}function Ft(){At=!1,null!==It&&Ut(It)&&(It=null),null!==xt&&Ut(xt)&&(xt=null),null!==Ot&&Ut(Ot)&&(Ot=null),kt.forEach(Vt),Nt.forEach(Vt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ft)))}function Wt(e){function t(t){return Bt(t,e)}if(0<Rt.length){Bt(Rt[0],e);for(var n=1;n<Rt.length;n++){var r=Rt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==It&&Bt(It,e),null!==xt&&Bt(xt,e),null!==Ot&&Bt(Ot,e),kt.forEach(t),Nt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)jt(n),null===n.blockedOn&&Pt.shift()}var zt=E.ReactCurrentBatchConfig,Ht=!0;function Gt(e,t,n,r){var i=_t,o=zt.transition;zt.transition=null;try{_t=1,Kt(e,t,n,r)}finally{_t=i,zt.transition=o}}function qt(e,t,n,r){var i=_t,o=zt.transition;zt.transition=null;try{_t=4,Kt(e,t,n,r)}finally{_t=i,zt.transition=o}}function Kt(e,t,n,r){if(Ht){var i=Yt(e,t,n,r);if(null===i)Hr(e,t,r,$t,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return It=Mt(It,e,t,n,r,i),!0;case"dragenter":return xt=Mt(xt,e,t,n,r,i),!0;case"mouseover":return Ot=Mt(Ot,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return kt.set(o,Mt(kt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Nt.set(o,Mt(Nt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==i;){var o=_i(i);if(null!==o&&bt(o),null===(o=Yt(e,t,n,r))&&Hr(e,t,r,$t,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var $t=null;function Yt(e,t,n,r){if($t=null,null!==(e=yi(e=be(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $t=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Qt,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(ln),dn=j({},ln,{view:0,detail:0}),hn=on(dn),pn=j({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(sn=e.screenX-cn.screenX,an=e.screenY-cn.screenY):an=sn=0,cn=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(j({},pn,{dataTransfer:0})),gn=on(j({},dn,{relatedTarget:0})),vn=on(j({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=j({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=on(yn),En=on(j({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Cn(){return Tn}var An=j({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=on(An),In=on(j({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),xn=on(j({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),On=on(j({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=j({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=on(kn),Pn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var Mn=u&&"TextEvent"in window&&!Ln,jn=u&&(!Dn||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Vn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var zn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!zn[e.type]:"textarea"===t}function Gn(e,t,n,r){Ae(r),0<(t=qr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Kn=null;function $n(e){Ur(e,0)}function Yn(e){if(K(Ei(e)))return e}function Xn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Qn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Qn=Zn}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];Gn(t,Kn,e,be(e)),ke($n,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function or(e,t){if("click"===e)return Yn(t)}function sr(e,t){if("input"===e||"change"===e)return Yn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=$();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=$((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(n,o);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,yr=null,_r=!1;function Er(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==gr||gr!==$(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&cr(yr,r)||(yr=r,0<(r=qr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function br(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:br("Animation","AnimationEnd"),animationiteration:br("Animation","AnimationIteration"),animationstart:br("Animation","AnimationStart"),transitionend:br("Transition","TransitionEnd")},Sr={},Tr={};function Cr(e){if(Sr[e])return Sr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Tr)return Sr[e]=n[t];return e}u&&(Tr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Ar=Cr("animationend"),Rr=Cr("animationiteration"),Ir=Cr("animationstart"),xr=Cr("transitionend"),Or=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nr(e,t){Or.set(e,t),c(t,[e])}for(var Pr=0;Pr<kr.length;Pr++){var Dr=kr[Pr];Nr(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Nr(Ar,"onAnimationEnd"),Nr(Rr,"onAnimationIteration"),Nr(Ir,"onAnimationStart"),Nr("dblclick","onDoubleClick"),Nr("focusin","onFocus"),Nr("focusout","onBlur"),Nr(xr,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function jr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,c,l){if(Be.apply(this,arguments),Me){if(!Me)throw Error(o(198));var u=je;Me=!1,je=null,Ue||(Ue=!0,Ve=u)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==o&&i.isPropagationStopped())break e;jr(i,a,l),o=c}else for(s=0;s<r.length;s++){if(c=(a=r[s]).instance,l=a.currentTarget,a=a.listener,c!==o&&i.isPropagationStopped())break e;jr(i,a,l),o=c}}}if(Ue)throw e=Ve,Ue=!1,Ve=null,e}function Vr(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(zr(t,e,2,!1),n.add(r))}function Fr(e,t,n){var r=0;t&&(r|=4),zr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Br]){e[Br]=!0,s.forEach((function(t){"selectionchange"!==t&&(Mr.has(t)||Fr(t,!1,e),Fr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Fr("selectionchange",!1,t))}}function zr(e,t,n,r){switch(Xt(t)){case 1:var i=Gt;break;case 4:i=qt;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var c=s.tag;if((3===c||4===c)&&((c=s.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=yi(a)))return;if(5===(c=s.tag)||6===c){r=o=s;continue e}a=a.parentNode}}r=r.return}ke((function(){var r=o,i=be(n),s=[];e:{var a=Or.get(e);if(void 0!==a){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=xn;break;case Ar:case Rr:case Ir:c=vn;break;case xr:c=On;break;case"scroll":c=hn;break;case"wheel":c=Nn;break;case"copy":case"cut":case"paste":c=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=In}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Ne(f,h))&&u.push(Gr(f,m,p)))),d)break;f=f.return}0<u.length&&(a=new c(a,l,null,n,i),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===Ee||!(l=n.relatedTarget||n.fromElement)||!yi(l)&&!l[fi])&&(c||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?yi(l):null)&&(l!==(d=We(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=In,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==c?a:Ei(c),p=null==l?a:Ei(l),(a=new u(m,f+"leave",c,n,i)).target=d,a.relatedTarget=p,m=null,yi(i)===r&&((u=new u(h,f+"enter",l,n,i)).target=p,u.relatedTarget=d,m=u),d=m,c&&l)e:{for(h=l,f=0,p=u=c;p;p=Kr(p))f++;for(p=0,m=h;m;m=Kr(m))p++;for(;0<f-p;)u=Kr(u),f--;for(;0<p-f;)h=Kr(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Kr(u),h=Kr(h)}u=null}else u=null;null!==c&&$r(s,a,c,u,!1),null!==l&&null!==d&&$r(s,d,l,u,!0)}if("select"===(c=(a=r?Ei(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var g=Xn;else if(Hn(a))if(Jn)g=sr;else{g=ir;var v=rr}else(c=a.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=or);switch(g&&(g=g(e,r))?Gn(s,g,n,i):(v&&v(e,a,r),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ee(a,"number",a.value)),v=r?Ei(r):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,yr=null);break;case"focusout":yr=vr=gr=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,Er(s,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":Er(s,n,i)}var y;if(Dn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Wn?Fn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(jn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Wn&&(y=en()):(Qt="value"in(Jt=i)?Jt.value:Jt.textContent,Wn=!0)),0<(v=qr(r,_)).length&&(_=new En(_,e,null,n,i),s.push({event:_,listeners:v}),y?_.data=y:null!==(y=Bn(n))&&(_.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(Vn=!0,Un);case"textInput":return(e=t.data)===Un&&Vn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!Dn&&Fn(e,t)?(e=en(),Zt=Qt=Jt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(i=new En("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=y))}Ur(s,t)}))}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Ne(e,n))&&r.unshift(Gr(e,o,i)),null!=(o=Ne(e,t))&&r.push(Gr(e,o,i))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $r(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(null!==c&&c===r)break;5===a.tag&&null!==l&&(a=l,i?null!=(c=Ne(n,o))&&s.unshift(Gr(n,c,a)):i||null!=(c=Ne(n,o))&&s.push(Gr(n,c,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Yr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Xr,"")}function Qr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(o(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Wt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,pi="__reactProps$"+di,fi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,vi="__reactHandles$"+di;function yi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function _i(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ei(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function bi(e){return e[pi]||null}var wi=[],Si=-1;function Ti(e){return{current:e}}function Ci(e){0>Si||(e.current=wi[Si],wi[Si]=null,Si--)}function Ai(e,t){Si++,wi[Si]=e.current,e.current=t}var Ri={},Ii=Ti(Ri),xi=Ti(!1),Oi=Ri;function ki(e,t){var n=e.type.contextTypes;if(!n)return Ri;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Ni(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Pi(){Ci(xi),Ci(Ii)}function Di(e,t,n){if(Ii.current!==Ri)throw Error(o(168));Ai(Ii,t),Ai(xi,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,z(e)||"Unknown",i));return j({},n,r)}function Mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ri,Oi=Ii.current,Ai(Ii,e),Ai(xi,xi.current),!0}function ji(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Li(e,t,Oi),r.__reactInternalMemoizedMergedChildContext=e,Ci(xi),Ci(Ii),Ai(Ii,e)):Ci(xi),Ai(xi,n)}var Ui=null,Vi=!1,Fi=!1;function Bi(e){null===Ui?Ui=[e]:Ui.push(e)}function Wi(){if(!Fi&&null!==Ui){Fi=!0;var e=0,t=_t;try{var n=Ui;for(_t=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Vi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),Ke(Ze,Wi),i}finally{_t=t,Fi=!1}}return null}var zi=[],Hi=0,Gi=null,qi=0,Ki=[],$i=0,Yi=null,Xi=1,Ji="";function Qi(e,t){zi[Hi++]=qi,zi[Hi++]=Gi,Gi=e,qi=t}function Zi(e,t,n){Ki[$i++]=Xi,Ki[$i++]=Ji,Ki[$i++]=Yi,Yi=e;var r=Xi;e=Ji;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Xi=1<<32-st(t)+i|n<<i|r,Ji=o+e}else Xi=1<<o|n<<i|r,Ji=e}function eo(e){null!==e.return&&(Qi(e,1),Zi(e,1,0))}function to(e){for(;e===Gi;)Gi=zi[--Hi],zi[Hi]=null,qi=zi[--Hi],zi[Hi]=null;for(;e===Yi;)Yi=Ki[--$i],Ki[$i]=null,Ji=Ki[--$i],Ki[$i]=null,Xi=Ki[--$i],Ki[$i]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=kl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yi?{id:Xi,overflow:Ji}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=kl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function lo(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(co(e))throw Error(o(418));t=li(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(co(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(co(e))throw po(),Error(o(418));for(;t;)so(e,t),t=li(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?li(e.stateNode.nextSibling):null;return!0}function po(){for(var e=ro;e;)e=li(e.nextSibling)}function fo(){ro=no=null,io=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=E.ReactCurrentBatchConfig;function vo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function yo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _o(e){return(0,e._init)(e._payload)}function Eo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pl(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=jl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var o=n.type;return o===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===N&&_o(o)===t.type)?((r=i(t,n.props)).ref=vo(e,t,n),r.return=e,r):((r=Dl(n.type,n.key,n.props,null,e.mode,r)).ref=vo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ul(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Ll(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=jl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Dl(t.type,t.key,t.props,null,e.mode,n)).ref=vo(e,null,t),n.return=e,n;case w:return(t=Ul(t,e.mode,n)).return=e,t;case N:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Ll(t,e.mode,n,null)).return=e,t;yo(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?l(e,t,n,r):null;case w:return n.key===i?u(e,t,n,r):null;case N:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:d(e,t,n,r,null);yo(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case N:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return d(t,e=e.get(n)||null,r,i,null);yo(t,r)}return null}function m(i,o,a,c){for(var l=null,u=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(i,d,a[m],c);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(i,d),o=s(v,o,m),null===u?l=v:u.sibling=v,u=v,d=g}if(m===a.length)return n(i,d),io&&Qi(i,m),l;if(null===d){for(;m<a.length;m++)null!==(d=h(i,a[m],c))&&(o=s(d,o,m),null===u?l=d:u.sibling=d,u=d);return io&&Qi(i,m),l}for(d=r(i,d);m<a.length;m++)null!==(g=f(d,i,m,a[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(i,e)})),io&&Qi(i,m),l}function g(i,a,c,l){var u=L(c);if("function"!==typeof u)throw Error(o(150));if(null==(c=u.call(c)))throw Error(o(151));for(var d=u=null,m=a,g=a=0,v=null,y=c.next();null!==m&&!y.done;g++,y=c.next()){m.index>g?(v=m,m=null):v=m.sibling;var _=p(i,m,y.value,l);if(null===_){null===m&&(m=v);break}e&&m&&null===_.alternate&&t(i,m),a=s(_,a,g),null===d?u=_:d.sibling=_,d=_,m=v}if(y.done)return n(i,m),io&&Qi(i,g),u;if(null===m){for(;!y.done;g++,y=c.next())null!==(y=h(i,y.value,l))&&(a=s(y,a,g),null===d?u=y:d.sibling=y,d=y);return io&&Qi(i,g),u}for(m=r(i,m);!y.done;g++,y=c.next())null!==(y=f(m,i,g,y.value,l))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=s(y,a,g),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(i,e)})),io&&Qi(i,g),u}return function e(r,o,s,c){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case b:e:{for(var l=s.key,u=o;null!==u;){if(u.key===l){if((l=s.type)===S){if(7===u.tag){n(r,u.sibling),(o=i(u,s.props.children)).return=r,r=o;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===N&&_o(l)===u.type){n(r,u.sibling),(o=i(u,s.props)).ref=vo(r,u,s),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===S?((o=Ll(s.props.children,r.mode,c,s.key)).return=r,r=o):((c=Dl(s.type,s.key,s.props,null,r.mode,c)).ref=vo(r,o,s),c.return=r,r=c)}return a(r);case w:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Ul(s,r.mode,c)).return=r,r=o}return a(r);case N:return e(r,o,(u=s._init)(s._payload),c)}if(te(s))return m(r,o,s,c);if(L(s))return g(r,o,s,c);yo(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=jl(s,r.mode,c)).return=r,r=o),a(r)):n(r,o)}}var bo=Eo(!0),wo=Eo(!1),So=Ti(null),To=null,Co=null,Ao=null;function Ro(){Ao=Co=To=null}function Io(e){var t=So.current;Ci(So),e._currentValue=t}function xo(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Oo(e,t){To=e,Ao=Co=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(_a=!0),e.firstContext=null)}function ko(e){var t=e._currentValue;if(Ao!==e)if(e={context:e,memoizedValue:t,next:null},null===Co){if(null===To)throw Error(o(308));Co=e,To.dependencies={lanes:0,firstContext:e}}else Co=Co.next=e;return t}var No=null;function Po(e){null===No?No=[e]:No.push(e)}function Do(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Po(t)):(n.next=i.next,i.next=n),t.interleaved=n,Lo(e,r)}function Lo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mo=!1;function jo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Vo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ic)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Lo(e,n)}return null===(i=r.interleaved)?(t.next=t,Po(r)):(t.next=i.next,i.next=t),r.interleaved=t,Lo(e,n)}function Bo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Wo(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zo(e,t,n,r){var i=e.updateQueue;Mo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var c=a,l=c.next;c.next=null,null===s?o=l:s.next=l,s=c;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(null!==o){var d=i.baseState;for(s=0,u=l=c=null,a=o;;){var h=a.lane,p=a.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=j({},d,h);break e;case 2:Mo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(l=u=p,c=d):u=u.next=p,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(h=a).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Mc|=s,e.lanes=s,e.memoizedState=d}}function Ho(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Go={},qo=Ti(Go),Ko=Ti(Go),$o=Ti(Go);function Yo(e){if(e===Go)throw Error(o(174));return e}function Xo(e,t){switch(Ai($o,t),Ai(Ko,e),Ai(qo,Go),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ci(qo),Ai(qo,t)}function Jo(){Ci(qo),Ci(Ko),Ci($o)}function Qo(e){Yo($o.current);var t=Yo(qo.current),n=ce(t,e.type);t!==n&&(Ai(Ko,e),Ai(qo,n))}function Zo(e){Ko.current===e&&(Ci(qo),Ci(Ko))}var es=Ti(0);function ts(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ns=[];function rs(){for(var e=0;e<ns.length;e++)ns[e]._workInProgressVersionPrimary=null;ns.length=0}var is=E.ReactCurrentDispatcher,os=E.ReactCurrentBatchConfig,ss=0,as=null,cs=null,ls=null,us=!1,ds=!1,hs=0,ps=0;function fs(){throw Error(o(321))}function ms(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function gs(e,t,n,r,i,s){if(ss=s,as=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,is.current=null===e||null===e.memoizedState?Zs:ea,e=n(r,i),ds){s=0;do{if(ds=!1,hs=0,25<=s)throw Error(o(301));s+=1,ls=cs=null,t.updateQueue=null,is.current=ta,e=n(r,i)}while(ds)}if(is.current=Qs,t=null!==cs&&null!==cs.next,ss=0,ls=cs=as=null,us=!1,t)throw Error(o(300));return e}function vs(){var e=0!==hs;return hs=0,e}function ys(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ls?as.memoizedState=ls=e:ls=ls.next=e,ls}function _s(){if(null===cs){var e=as.alternate;e=null!==e?e.memoizedState:null}else e=cs.next;var t=null===ls?as.memoizedState:ls.next;if(null!==t)ls=t,cs=e;else{if(null===e)throw Error(o(310));e={memoizedState:(cs=e).memoizedState,baseState:cs.baseState,baseQueue:cs.baseQueue,queue:cs.queue,next:null},null===ls?as.memoizedState=ls=e:ls=ls.next=e}return ls}function Es(e,t){return"function"===typeof t?t(e):t}function bs(e){var t=_s(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=cs,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var c=a=null,l=null,u=s;do{var d=u.lane;if((ss&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,a=r):l=l.next=h,as.lanes|=d,Mc|=d}u=u.next}while(null!==u&&u!==s);null===l?a=r:l.next=c,ar(r,t.memoizedState)||(_a=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,as.lanes|=s,Mc|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ws(e){var t=_s(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(_a=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ss(){}function Ts(e,t){var n=as,r=_s(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,_a=!0),r=r.queue,Ms(Rs.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==ls&&1&ls.memoizedState.tag){if(n.flags|=2048,ks(9,As.bind(null,n,r,i,t),void 0,null),null===xc)throw Error(o(349));0!==(30&ss)||Cs(n,t,i)}return i}function Cs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function As(e,t,n,r){t.value=n,t.getSnapshot=r,Is(t)&&xs(e)}function Rs(e,t,n){return n((function(){Is(t)&&xs(e)}))}function Is(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function xs(e){var t=Lo(e,1);null!==t&&nl(t,e,1,-1)}function Os(e){var t=ys();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Es,lastRenderedState:e},t.queue=e,e=e.dispatch=$s.bind(null,as,e),[t.memoizedState,e]}function ks(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ns(){return _s().memoizedState}function Ps(e,t,n,r){var i=ys();as.flags|=e,i.memoizedState=ks(1|t,n,void 0,void 0===r?null:r)}function Ds(e,t,n,r){var i=_s();r=void 0===r?null:r;var o=void 0;if(null!==cs){var s=cs.memoizedState;if(o=s.destroy,null!==r&&ms(r,s.deps))return void(i.memoizedState=ks(t,n,o,r))}as.flags|=e,i.memoizedState=ks(1|t,n,o,r)}function Ls(e,t){return Ps(8390656,8,e,t)}function Ms(e,t){return Ds(2048,8,e,t)}function js(e,t){return Ds(4,2,e,t)}function Us(e,t){return Ds(4,4,e,t)}function Vs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ds(4,4,Vs.bind(null,t,e),n)}function Bs(){}function Ws(e,t){var n=_s();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ms(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function zs(e,t){var n=_s();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ms(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Hs(e,t,n){return 0===(21&ss)?(e.baseState&&(e.baseState=!1,_a=!0),e.memoizedState=n):(ar(n,t)||(n=mt(),as.lanes|=n,Mc|=n,e.baseState=!0),t)}function Gs(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var r=os.transition;os.transition={};try{e(!1),t()}finally{_t=n,os.transition=r}}function qs(){return _s().memoizedState}function Ks(e,t,n){var r=tl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ys(e))Xs(t,n);else if(null!==(n=Do(e,t,n,r))){nl(n,e,r,el()),Js(n,t,r)}}function $s(e,t,n){var r=tl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ys(e))Xs(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var c=t.interleaved;return null===c?(i.next=i,Po(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=Do(e,t,i,r))&&(nl(n,e,r,i=el()),Js(n,t,r))}}function Ys(e){var t=e.alternate;return e===as||null!==t&&t===as}function Xs(e,t){ds=us=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Js(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Qs={readContext:ko,useCallback:fs,useContext:fs,useEffect:fs,useImperativeHandle:fs,useInsertionEffect:fs,useLayoutEffect:fs,useMemo:fs,useReducer:fs,useRef:fs,useState:fs,useDebugValue:fs,useDeferredValue:fs,useTransition:fs,useMutableSource:fs,useSyncExternalStore:fs,useId:fs,unstable_isNewReconciler:!1},Zs={readContext:ko,useCallback:function(e,t){return ys().memoizedState=[e,void 0===t?null:t],e},useContext:ko,useEffect:Ls,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ps(4194308,4,Vs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ps(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ps(4,2,e,t)},useMemo:function(e,t){var n=ys();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ys();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ks.bind(null,as,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ys().memoizedState=e},useState:Os,useDebugValue:Bs,useDeferredValue:function(e){return ys().memoizedState=e},useTransition:function(){var e=Os(!1),t=e[0];return e=Gs.bind(null,e[1]),ys().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=as,i=ys();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===xc)throw Error(o(349));0!==(30&ss)||Cs(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Ls(Rs.bind(null,r,s,e),[e]),r.flags|=2048,ks(9,As.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=ys(),t=xc.identifierPrefix;if(io){var n=Ji;t=":"+t+"R"+(n=(Xi&~(1<<32-st(Xi)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ps++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ea={readContext:ko,useCallback:Ws,useContext:ko,useEffect:Ms,useImperativeHandle:Fs,useInsertionEffect:js,useLayoutEffect:Us,useMemo:zs,useReducer:bs,useRef:Ns,useState:function(){return bs(Es)},useDebugValue:Bs,useDeferredValue:function(e){return Hs(_s(),cs.memoizedState,e)},useTransition:function(){return[bs(Es)[0],_s().memoizedState]},useMutableSource:Ss,useSyncExternalStore:Ts,useId:qs,unstable_isNewReconciler:!1},ta={readContext:ko,useCallback:Ws,useContext:ko,useEffect:Ms,useImperativeHandle:Fs,useInsertionEffect:js,useLayoutEffect:Us,useMemo:zs,useReducer:ws,useRef:Ns,useState:function(){return ws(Es)},useDebugValue:Bs,useDeferredValue:function(e){var t=_s();return null===cs?t.memoizedState=e:Hs(t,cs.memoizedState,e)},useTransition:function(){return[ws(Es)[0],_s().memoizedState]},useMutableSource:Ss,useSyncExternalStore:Ts,useId:qs,unstable_isNewReconciler:!1};function na(e,t){if(e&&e.defaultProps){for(var n in t=j({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ra(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:j({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ia={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),o=Vo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Fo(e,o,i))&&(nl(t,e,i,r),Bo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),o=Vo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Fo(e,o,i))&&(nl(t,e,i,r),Bo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),r=tl(e),i=Vo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Fo(e,i,r))&&(nl(t,e,r,n),Bo(t,e,r))}};function oa(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,o))}function sa(e,t,n){var r=!1,i=Ri,o=t.contextType;return"object"===typeof o&&null!==o?o=ko(o):(i=Ni(t)?Oi:Ii.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?ki(e,i):Ri),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ia,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function aa(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ia.enqueueReplaceState(t,t.state,null)}function ca(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},jo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=ko(o):(o=Ni(t)?Oi:Ii.current,i.context=ki(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ra(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ia.enqueueReplaceState(i,i.state,null),zo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function la(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function ua(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ha="function"===typeof WeakMap?WeakMap:Map;function pa(e,t,n){(n=Vo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hc||(Hc=!0,Gc=r),da(0,t)},n}function fa(e,t,n){(n=Vo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof r&&(null===qc?qc=new Set([this]):qc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ma(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ha;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Cl.bind(null,e,t,n),t.then(e,e))}function ga(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Vo(-1,1)).tag=2,Fo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ya=E.ReactCurrentOwner,_a=!1;function Ea(e,t,n,r){t.child=null===e?wo(t,null,n,r):bo(t,e.child,n,r)}function ba(e,t,n,r,i){n=n.render;var o=t.ref;return Oo(t,i),r=gs(e,t,n,r,o,i),n=vs(),null===e||_a?(io&&n&&eo(t),t.flags|=1,Ea(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ha(e,t,i))}function wa(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Nl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dl(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sa(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(s,r)&&e.ref===t.ref)return Ha(e,t,i)}return t.flags|=1,(e=Pl(o,r)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(cr(o,r)&&e.ref===t.ref){if(_a=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,Ha(e,t,i);0!==(131072&e.flags)&&(_a=!0)}}return Aa(e,t,n,r,i)}function Ta(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ai(Pc,Nc),Nc|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ai(Pc,Nc),Nc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ai(Pc,Nc),Nc|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ai(Pc,Nc),Nc|=r;return Ea(e,t,i,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Aa(e,t,n,r,i){var o=Ni(n)?Oi:Ii.current;return o=ki(t,o),Oo(t,i),n=gs(e,t,n,r,o,i),r=vs(),null===e||_a?(io&&r&&eo(t),t.flags|=1,Ea(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ha(e,t,i))}function Ra(e,t,n,r,i){if(Ni(n)){var o=!0;Mi(t)}else o=!1;if(Oo(t,i),null===t.stateNode)za(e,t),sa(t,n,r),ca(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,l=n.contextType;"object"===typeof l&&null!==l?l=ko(l):l=ki(t,l=Ni(n)?Oi:Ii.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||c!==l)&&aa(t,s,r,l),Mo=!1;var h=t.memoizedState;s.state=h,zo(t,r,s,i),c=t.memoizedState,a!==r||h!==c||xi.current||Mo?("function"===typeof u&&(ra(t,n,u,r),c=t.memoizedState),(a=Mo||oa(t,n,a,r,h,c,l))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=l,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Uo(e,t),a=t.memoizedProps,l=t.type===t.elementType?a:na(t.type,a),s.props=l,d=t.pendingProps,h=s.context,"object"===typeof(c=n.contextType)&&null!==c?c=ko(c):c=ki(t,c=Ni(n)?Oi:Ii.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==c)&&aa(t,s,r,c),Mo=!1,h=t.memoizedState,s.state=h,zo(t,r,s,i);var f=t.memoizedState;a!==d||h!==f||xi.current||Mo?("function"===typeof p&&(ra(t,n,p,r),f=t.memoizedState),(l=Mo||oa(t,n,l,r,h,f,c)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,c),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,c)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=c,r=l):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ia(e,t,n,r,o,i)}function Ia(e,t,n,r,i,o){Ca(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&ji(t,n,!1),Ha(e,t,o);r=t.stateNode,ya.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=bo(t,e.child,null,o),t.child=bo(t,null,a,o)):Ea(e,t,a,o),t.memoizedState=r.state,i&&ji(t,n,!0),t.child}function xa(e){var t=e.stateNode;t.pendingContext?Di(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Di(0,t.context,!1),Xo(e,t.containerInfo)}function Oa(e,t,n,r,i){return fo(),mo(i),t.flags|=256,Ea(e,t,n,r),t.child}var ka,Na,Pa,Da,La={dehydrated:null,treeContext:null,retryLane:0};function Ma(e){return{baseLanes:e,cachePool:null,transitions:null}}function ja(e,t,n){var r,i=t.pendingProps,s=es.current,a=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ai(es,1&s),null===e)return lo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,a?(i=t.mode,a=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=c):a=Ml(c,i,0,null),e=Ll(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ma(n),t.memoizedState=La,e):Ua(t,c));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,Va(e,t,a,r=ua(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Ml({mode:"visible",children:r.children},i,0,null),(s=Ll(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&bo(t,e.child,null,a),t.child.memoizedState=Ma(a),t.memoizedState=La,s);if(0===(1&t.mode))return Va(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Va(e,t,a,r=ua(s=Error(o(419)),r,void 0))}if(c=0!==(a&e.childLanes),_a||c){if(null!==(r=xc)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,Lo(e,i),nl(r,e,i,-1))}return ml(),Va(e,t,a,r=ua(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Rl.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=li(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Ki[$i++]=Xi,Ki[$i++]=Ji,Ki[$i++]=Yi,Xi=e.id,Ji=e.overflow,Yi=t),t=Ua(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,s,n);if(a){a=i.fallback,c=t.mode,r=(s=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Pl(s,l)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Pl(r,a):(a=Ll(a,c,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,c=null===(c=e.child.memoizedState)?Ma(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},a.memoizedState=c,a.childLanes=e.childLanes&~n,t.memoizedState=La,i}return e=(a=e.child).sibling,i=Pl(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Ua(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Va(e,t,n,r){return null!==r&&mo(r),bo(t,e.child,null,n),(e=Ua(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fa(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),xo(e.return,t,n)}function Ba(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Wa(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Ea(e,t,r.children,n),0!==(2&(r=es.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fa(e,n,t);else if(19===e.tag)Fa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ai(es,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ts(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ba(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ts(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ba(t,!0,n,null,o);break;case"together":Ba(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function za(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ha(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Pl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ga(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ka(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qa(t),null;case 1:case 17:return Ni(t.type)&&Pi(),qa(t),null;case 3:return r=t.stateNode,Jo(),Ci(xi),Ci(Ii),rs(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(sl(oo),oo=null))),Na(e,t),qa(t),null;case 5:Zo(t);var i=Yo($o.current);if(n=t.type,null!==e&&null!=t.stateNode)Pa(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return qa(t),null}if(e=Yo(qo.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[hi]=t,r[pi]=s,e=0!==(1&t.mode),n){case"dialog":Vr("cancel",r),Vr("close",r);break;case"iframe":case"object":case"embed":Vr("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Vr(Lr[i],r);break;case"source":Vr("error",r);break;case"img":case"image":case"link":Vr("error",r),Vr("load",r);break;case"details":Vr("toggle",r);break;case"input":X(r,s),Vr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Vr("invalid",r);break;case"textarea":ie(r,s),Vr("invalid",r)}for(var c in ye(n,s),i=null,s)if(s.hasOwnProperty(c)){var l=s[c];"children"===c?"string"===typeof l?r.textContent!==l&&(!0!==s.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==s.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",""+l]):a.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Vr("scroll",r)}switch(n){case"input":q(r),Z(r,s,!0);break;case"textarea":q(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[hi]=t,e[pi]=r,ka(e,t,!1,!1),t.stateNode=e;e:{switch(c=_e(n,r),n){case"dialog":Vr("cancel",e),Vr("close",e),i=r;break;case"iframe":case"object":case"embed":Vr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Vr(Lr[i],e);i=r;break;case"source":Vr("error",e),i=r;break;case"img":case"image":case"link":Vr("error",e),Vr("load",e),i=r;break;case"details":Vr("toggle",e),i=r;break;case"input":X(e,r),i=Y(e,r),Vr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=j({},r,{value:void 0}),Vr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Vr("invalid",e)}for(s in ye(n,i),l=i)if(l.hasOwnProperty(s)){var u=l[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Vr("scroll",e):null!=u&&_(e,s,u,c))}switch(n){case"input":q(e),Z(e,r,!1);break;case"textarea":q(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qa(t),null;case 6:if(e&&null!=t.stateNode)Da(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=Yo($o.current),Yo(qo.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return qa(t),null;case 13:if(Ci(es),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hi]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qa(t),s=!1}else null!==oo&&(sl(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&es.current)?0===Dc&&(Dc=3):ml())),null!==t.updateQueue&&(t.flags|=4),qa(t),null);case 4:return Jo(),Na(e,t),null===e&&Wr(t.stateNode.containerInfo),qa(t),null;case 10:return Io(t.type._context),qa(t),null;case 19:if(Ci(es),null===(s=t.memoizedState))return qa(t),null;if(r=0!==(128&t.flags),null===(c=s.rendering))if(r)Ga(s,!1);else{if(0!==Dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ts(e))){for(t.flags|=128,Ga(s,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ai(es,1&es.current|2),t.child}e=e.sibling}null!==s.tail&&Je()>Wc&&(t.flags|=128,r=!0,Ga(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ts(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ga(s,!0),null===s.tail&&"hidden"===s.tailMode&&!c.alternate&&!io)return qa(t),null}else 2*Je()-s.renderingStartTime>Wc&&1073741824!==n&&(t.flags|=128,r=!0,Ga(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=s.last)?n.sibling=c:t.child=c,s.last=c)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Je(),t.sibling=null,n=es.current,Ai(es,r?1&n|2:1&n),t):(qa(t),null);case 22:case 23:return dl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Nc)&&(qa(t),6&t.subtreeFlags&&(t.flags|=8192)):qa(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function $a(e,t){switch(to(t),t.tag){case 1:return Ni(t.type)&&Pi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Jo(),Ci(xi),Ci(Ii),rs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zo(t),null;case 13:if(Ci(es),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ci(es),null;case 4:return Jo(),null;case 10:return Io(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}ka=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Na=function(){},Pa=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Yo(qo.current);var o,s=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),s=[];break;case"select":i=j({},i,{value:void 0}),r=j({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in ye(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var c=i[u];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(c=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(o in c)!c.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&c[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(s=s||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(s=s||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Vr("scroll",e),s||c===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Da=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ya=!1,Xa=!1,Ja="function"===typeof WeakSet?WeakSet:Set,Qa=null;function Za(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Tl(e,t,r)}else n.current=null}function ec(e,t,n){try{n()}catch(r){Tl(e,t,r)}}var tc=!1;function nc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&ec(t,n,o)}i=i.next}while(i!==r)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ic(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[mi],delete t[gi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sc(e){return 5===e.tag||3===e.tag||4===e.tag}function ac(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var uc=null,dc=!1;function hc(e,t,n){for(n=n.child;null!==n;)pc(e,t,n),n=n.sibling}function pc(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:Xa||Za(n,t);case 6:var r=uc,i=dc;uc=null,hc(e,t,n),dc=i,null!==(uc=r)&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Wt(e)):ci(uc,n.stateNode));break;case 4:r=uc,i=dc,uc=n.stateNode.containerInfo,dc=!0,hc(e,t,n),uc=r,dc=i;break;case 0:case 11:case 14:case 15:if(!Xa&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&ec(n,t,s),i=i.next}while(i!==r)}hc(e,t,n);break;case 1:if(!Xa&&(Za(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Tl(n,t,a)}hc(e,t,n);break;case 21:hc(e,t,n);break;case 22:1&n.mode?(Xa=(r=Xa)||null!==n.memoizedState,hc(e,t,n),Xa=r):hc(e,t,n);break;default:hc(e,t,n)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ja),t.forEach((function(t){var r=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,c=a;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,dc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===uc)throw Error(o(160));pc(s,a,i),uc=null,dc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(u){Tl(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),vc(e),4&r){try{nc(3,e,e.return),rc(3,e)}catch(g){Tl(e,e.return,g)}try{nc(5,e,e.return)}catch(g){Tl(e,e.return,g)}}break;case 1:mc(t,e),vc(e),512&r&&null!==n&&Za(n,n.return);break;case 5:if(mc(t,e),vc(e),512&r&&null!==n&&Za(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Tl(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===s.type&&null!=s.name&&J(i,s),_e(c,a);var u=_e(c,s);for(a=0;a<l.length;a+=2){var d=l[a],h=l[a+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):_(i,d,h,u)}switch(c){case"input":Q(i,s);break;case"textarea":oe(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(i,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[pi]=s}catch(g){Tl(e,e.return,g)}}break;case 6:if(mc(t,e),vc(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(g){Tl(e,e.return,g)}}break;case 3:if(mc(t,e),vc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(g){Tl(e,e.return,g)}break;case 4:default:mc(t,e),vc(e);break;case 13:mc(t,e),vc(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Bc=Je())),4&r&&fc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xa=(u=Xa)||d,mc(t,e),Xa=u):mc(t,e),vc(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Qa=e,d=e.child;null!==d;){for(h=Qa=d;null!==Qa;){switch(f=(p=Qa).child,p.tag){case 0:case 11:case 14:case 15:nc(4,p,p.return);break;case 1:Za(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Tl(r,n,g)}}break;case 5:Za(p,p.return);break;case 22:if(null!==p.memoizedState){bc(h);continue}}null!==f?(f.return=p,Qa=f):bc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(c=h.stateNode,a=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=me("display",a))}catch(g){Tl(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Tl(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mc(t,e),vc(e),4&r&&fc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sc(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),lc(e,ac(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;cc(e,ac(e),s);break;default:throw Error(o(161))}}catch(a){Tl(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yc(e,t,n){Qa=e,_c(e,t,n)}function _c(e,t,n){for(var r=0!==(1&e.mode);null!==Qa;){var i=Qa,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Ya;if(!s){var a=i.alternate,c=null!==a&&null!==a.memoizedState||Xa;a=Ya;var l=Xa;if(Ya=s,(Xa=c)&&!l)for(Qa=i;null!==Qa;)c=(s=Qa).child,22===s.tag&&null!==s.memoizedState?wc(i):null!==c?(c.return=s,Qa=c):wc(i);for(;null!==o;)Qa=o,_c(o,t,n),o=o.sibling;Qa=i,Ya=a,Xa=l}Ec(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Qa=o):Ec(e)}}function Ec(e){for(;null!==Qa;){var t=Qa;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xa||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xa)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:na(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Ho(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ho(t,a,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Wt(h)}}}break;default:throw Error(o(163))}Xa||512&t.flags&&ic(t)}catch(p){Tl(t,t.return,p)}}if(t===e){Qa=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qa=n;break}Qa=t.return}}function bc(e){for(;null!==Qa;){var t=Qa;if(t===e){Qa=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qa=n;break}Qa=t.return}}function wc(e){for(;null!==Qa;){var t=Qa;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){Tl(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){Tl(t,i,c)}}var o=t.return;try{ic(t)}catch(c){Tl(t,o,c)}break;case 5:var s=t.return;try{ic(t)}catch(c){Tl(t,s,c)}}}catch(c){Tl(t,t.return,c)}if(t===e){Qa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Qa=a;break}Qa=t.return}}var Sc,Tc=Math.ceil,Cc=E.ReactCurrentDispatcher,Ac=E.ReactCurrentOwner,Rc=E.ReactCurrentBatchConfig,Ic=0,xc=null,Oc=null,kc=0,Nc=0,Pc=Ti(0),Dc=0,Lc=null,Mc=0,jc=0,Uc=0,Vc=null,Fc=null,Bc=0,Wc=1/0,zc=null,Hc=!1,Gc=null,qc=null,Kc=!1,$c=null,Yc=0,Xc=0,Jc=null,Qc=-1,Zc=0;function el(){return 0!==(6&Ic)?Je():-1!==Qc?Qc:Qc=Je()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==kc?kc&-kc:null!==go.transition?(0===Zc&&(Zc=mt()),Zc):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nl(e,t,n,r){if(50<Xc)throw Xc=0,Jc=null,Error(o(185));vt(e,n,r),0!==(2&Ic)&&e===xc||(e===xc&&(0===(2&Ic)&&(jc|=n),4===Dc&&al(e,kc)),rl(e,r),1===n&&0===Ic&&0===(1&t.mode)&&(Wc=Je()+500,Vi&&Wi()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,c=i[s];-1===c?0!==(a&n)&&0===(a&r)||(i[s]=pt(a,t)):c<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=ht(e,e===xc?kc:0);if(0===r)null!==n&&$e(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&$e(n),1===t)0===e.tag?function(e){Vi=!0,Bi(e)}(cl.bind(null,e)):Bi(cl.bind(null,e)),si((function(){0===(6&Ic)&&Wi()})),n=null;else{switch(Et(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=xl(n,il.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function il(e,t){if(Qc=-1,Zc=0,0!==(6&Ic))throw Error(o(327));var n=e.callbackNode;if(wl()&&e.callbackNode!==n)return null;var r=ht(e,e===xc?kc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gl(e,r);else{t=r;var i=Ic;Ic|=2;var s=fl();for(xc===e&&kc===t||(zc=null,Wc=Je()+500,hl(e,t));;)try{yl();break}catch(c){pl(e,c)}Ro(),Cc.current=s,Ic=i,null!==Oc?t=0:(xc=null,kc=0,t=Dc)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=ol(e,i))),1===t)throw n=Lc,hl(e,0),al(e,r),rl(e,Je()),n;if(6===t)al(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gl(e,r))&&(0!==(s=ft(e))&&(r=s,t=ol(e,s))),1===t))throw n=Lc,hl(e,0),al(e,r),rl(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:bl(e,Fc,zc);break;case 3:if(al(e,r),(130023424&r)===r&&10<(t=Bc+500-Je())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){el(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(bl.bind(null,e,Fc,zc),t);break}bl(e,Fc,zc);break;case 4:if(al(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tc(r/1960))-r)){e.timeoutHandle=ri(bl.bind(null,e,Fc,zc),r);break}bl(e,Fc,zc);break;default:throw Error(o(329))}}}return rl(e,Je()),e.callbackNode===n?il.bind(null,e):null}function ol(e,t){var n=Vc;return e.current.memoizedState.isDehydrated&&(hl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=Fc,Fc=n,null!==t&&sl(t)),e}function sl(e){null===Fc?Fc=e:Fc.push.apply(Fc,e)}function al(e,t){for(t&=~Uc,t&=~jc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function cl(e){if(0!==(6&Ic))throw Error(o(327));wl();var t=ht(e,0);if(0===(1&t))return rl(e,Je()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ol(e,r))}if(1===n)throw n=Lc,hl(e,0),al(e,t),rl(e,Je()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bl(e,Fc,zc),rl(e,Je()),null}function ll(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(Wc=Je()+500,Vi&&Wi())}}function ul(e){null!==$c&&0===$c.tag&&0===(6&Ic)&&wl();var t=Ic;Ic|=1;var n=Rc.transition,r=_t;try{if(Rc.transition=null,_t=1,e)return e()}finally{_t=r,Rc.transition=n,0===(6&(Ic=t))&&Wi()}}function dl(){Nc=Pc.current,Ci(Pc)}function hl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Oc)for(n=Oc.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Pi();break;case 3:Jo(),Ci(xi),Ci(Ii),rs();break;case 5:Zo(r);break;case 4:Jo();break;case 13:case 19:Ci(es);break;case 10:Io(r.type._context);break;case 22:case 23:dl()}n=n.return}if(xc=e,Oc=e=Pl(e.current,null),kc=Nc=t,Dc=0,Lc=null,Uc=jc=Mc=0,Fc=Vc=null,null!==No){for(t=0;t<No.length;t++)if(null!==(r=(n=No[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}No=null}return e}function pl(e,t){for(;;){var n=Oc;try{if(Ro(),is.current=Qs,us){for(var r=as.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}us=!1}if(ss=0,ls=cs=as=null,ds=!1,hs=0,Ac.current=null,null===n||null===n.return){Dc=1,Lc=t,Oc=null;break}e:{var s=e,a=n.return,c=n,l=t;if(t=kc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=ga(a);if(null!==f){f.flags&=-257,va(f,a,c,0,t),1&f.mode&&ma(s,u,t),l=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){ma(s,u,t),ml();break e}l=Error(o(426))}else if(io&&1&c.mode){var v=ga(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),va(v,a,c,0,t),mo(la(l,c));break e}}s=l=la(l,c),4!==Dc&&(Dc=2),null===Vc?Vc=[s]:Vc.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Wo(s,pa(0,l,t));break e;case 1:c=l;var y=s.type,_=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===qc||!qc.has(_)))){s.flags|=65536,t&=-t,s.lanes|=t,Wo(s,fa(s,c,t));break e}}s=s.return}while(null!==s)}El(n)}catch(E){t=E,Oc===n&&null!==n&&(Oc=n=n.return);continue}break}}function fl(){var e=Cc.current;return Cc.current=Qs,null===e?Qs:e}function ml(){0!==Dc&&3!==Dc&&2!==Dc||(Dc=4),null===xc||0===(268435455&Mc)&&0===(268435455&jc)||al(xc,kc)}function gl(e,t){var n=Ic;Ic|=2;var r=fl();for(xc===e&&kc===t||(zc=null,hl(e,t));;)try{vl();break}catch(i){pl(e,i)}if(Ro(),Ic=n,Cc.current=r,null!==Oc)throw Error(o(261));return xc=null,kc=0,Dc}function vl(){for(;null!==Oc;)_l(Oc)}function yl(){for(;null!==Oc&&!Ye();)_l(Oc)}function _l(e){var t=Sc(e.alternate,e,Nc);e.memoizedProps=e.pendingProps,null===t?El(e):Oc=t,Ac.current=null}function El(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ka(n,t,Nc)))return void(Oc=n)}else{if(null!==(n=$a(n,t)))return n.flags&=32767,void(Oc=n);if(null===e)return Dc=6,void(Oc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Oc=t);Oc=t=e}while(null!==t);0===Dc&&(Dc=5)}function bl(e,t,n){var r=_t,i=Rc.transition;try{Rc.transition=null,_t=1,function(e,t,n,r){do{wl()}while(null!==$c);if(0!==(6&Ic))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===xc&&(Oc=xc=null,kc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kc||(Kc=!0,xl(tt,(function(){return wl(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Rc.transition,Rc.transition=null;var a=_t;_t=1;var c=Ic;Ic|=4,Ac.current=null,function(e,t){if(ei=Ht,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(b){n=null;break e}var a=0,c=-1,l=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(c=a+i),h!==s||0!==r&&3!==h.nodeType||(l=a+r),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===i&&(c=a),p===s&&++d===r&&(l=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,Qa=t;null!==Qa;)if(e=(t=Qa).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qa=e;else for(;null!==Qa;){t=Qa;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,_=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:na(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var E=t.stateNode.containerInfo;1===E.nodeType?E.textContent="":9===E.nodeType&&E.documentElement&&E.removeChild(E.documentElement);break;default:throw Error(o(163))}}catch(b){Tl(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Qa=e;break}Qa=t.return}m=tc,tc=!1}(e,n),gc(n,e),fr(ti),Ht=!!ei,ti=ei=null,e.current=n,yc(n,e,i),Xe(),Ic=c,_t=a,Rc.transition=s}else e.current=n;if(Kc&&(Kc=!1,$c=e,Yc=i),s=e.pendingLanes,0===s&&(qc=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Hc)throw Hc=!1,e=Gc,Gc=null,e;0!==(1&Yc)&&0!==e.tag&&wl(),s=e.pendingLanes,0!==(1&s)?e===Jc?Xc++:(Xc=0,Jc=e):Xc=0,Wi()}(e,t,n,r)}finally{Rc.transition=i,_t=r}return null}function wl(){if(null!==$c){var e=Et(Yc),t=Rc.transition,n=_t;try{if(Rc.transition=null,_t=16>e?16:e,null===$c)var r=!1;else{if(e=$c,$c=null,Yc=0,0!==(6&Ic))throw Error(o(331));var i=Ic;for(Ic|=4,Qa=e.current;null!==Qa;){var s=Qa,a=s.child;if(0!==(16&Qa.flags)){var c=s.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for(Qa=u;null!==Qa;){var d=Qa;switch(d.tag){case 0:case 11:case 15:nc(8,d,s)}var h=d.child;if(null!==h)h.return=d,Qa=h;else for(;null!==Qa;){var p=(d=Qa).sibling,f=d.return;if(oc(d),d===u){Qa=null;break}if(null!==p){p.return=f,Qa=p;break}Qa=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Qa=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Qa=a;else e:for(;null!==Qa;){if(0!==(2048&(s=Qa).flags))switch(s.tag){case 0:case 11:case 15:nc(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Qa=y;break e}Qa=s.return}}var _=e.current;for(Qa=_;null!==Qa;){var E=(a=Qa).child;if(0!==(2064&a.subtreeFlags)&&null!==E)E.return=a,Qa=E;else e:for(a=_;null!==Qa;){if(0!==(2048&(c=Qa).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(w){Tl(c,c.return,w)}if(c===a){Qa=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,Qa=b;break e}Qa=c.return}}if(Ic=i,Wi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(w){}r=!0}return r}finally{_t=n,Rc.transition=t}}return!1}function Sl(e,t,n){e=Fo(e,t=pa(0,t=la(n,t),1),1),t=el(),null!==e&&(vt(e,1,t),rl(e,t))}function Tl(e,t,n){if(3===e.tag)Sl(e,e,n);else for(;null!==t;){if(3===t.tag){Sl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qc||!qc.has(r))){t=Fo(t,e=fa(t,e=la(n,e),1),1),e=el(),null!==t&&(vt(t,1,e),rl(t,e));break}}t=t.return}}function Cl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,xc===e&&(kc&n)===n&&(4===Dc||3===Dc&&(130023424&kc)===kc&&500>Je()-Bc?hl(e,0):Uc|=n),rl(e,t)}function Al(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=el();null!==(e=Lo(e,t))&&(vt(e,t,n),rl(e,n))}function Rl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Al(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Al(e,n)}function xl(e,t){return Ke(e,t)}function Ol(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kl(e,t,n,r){return new Ol(e,t,n,r)}function Nl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pl(e,t){var n=e.alternate;return null===n?((n=kl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dl(e,t,n,r,i,s){var a=2;if(r=e,"function"===typeof e)Nl(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Ll(n.children,i,s,t);case T:a=8,i|=8;break;case C:return(e=kl(12,n,t,2|i)).elementType=C,e.lanes=s,e;case x:return(e=kl(13,n,t,i)).elementType=x,e.lanes=s,e;case O:return(e=kl(19,n,t,i)).elementType=O,e.lanes=s,e;case P:return Ml(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:a=10;break e;case R:a=9;break e;case I:a=11;break e;case k:a=14;break e;case N:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=kl(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Ll(e,t,n,r){return(e=kl(7,e,r,t)).lanes=n,e}function Ml(e,t,n,r){return(e=kl(22,e,r,t)).elementType=P,e.lanes=n,e.stateNode={isHidden:!1},e}function jl(e,t,n){return(e=kl(6,e,null,t)).lanes=n,e}function Ul(e,t,n){return(t=kl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Fl(e,t,n,r,i,o,s,a,c){return e=new Vl(e,t,n,a,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=kl(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jo(o),e}function Bl(e){if(!e)return Ri;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ni(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Ni(n))return Li(e,n,t)}return t}function Wl(e,t,n,r,i,o,s,a,c){return(e=Fl(n,r,!0,e,0,o,0,a,c)).context=Bl(null),n=e.current,(o=Vo(r=el(),i=tl(n))).callback=void 0!==t&&null!==t?t:null,Fo(n,o,i),e.current.lanes=i,vt(e,i,r),rl(e,r),e}function zl(e,t,n,r){var i=t.current,o=el(),s=tl(i);return n=Bl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Vo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Fo(i,t,s))&&(nl(e,i,s,o),Bo(e,i,s)),s}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ql(e,t){Gl(e,t),(e=e.alternate)&&Gl(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||xi.current)_a=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return _a=!1,function(e,t,n){switch(t.tag){case 3:xa(t),fo();break;case 5:Qo(t);break;case 1:Ni(t.type)&&Mi(t);break;case 4:Xo(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ai(So,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ai(es,1&es.current),t.flags|=128,null):0!==(n&t.child.childLanes)?ja(e,t,n):(Ai(es,1&es.current),null!==(e=Ha(e,t,n))?e.sibling:null);Ai(es,1&es.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Wa(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ai(es,es.current),r)break;return null;case 22:case 23:return t.lanes=0,Ta(e,t,n)}return Ha(e,t,n)}(e,t,n);_a=0!==(131072&e.flags)}else _a=!1,io&&0!==(1048576&t.flags)&&Zi(t,qi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;za(e,t),e=t.pendingProps;var i=ki(t,Ii.current);Oo(t,n),i=gs(null,t,r,e,i,n);var s=vs();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ni(r)?(s=!0,Mi(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,jo(t),i.updater=ia,t.stateNode=i,i._reactInternals=t,ca(t,r,e,n),t=Ia(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),Ea(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(za(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Nl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===k)return 14}return 2}(r),e=na(r,e),i){case 0:t=Aa(null,t,r,e,n);break e;case 1:t=Ra(null,t,r,e,n);break e;case 11:t=ba(null,t,r,e,n);break e;case 14:t=wa(null,t,r,na(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Aa(e,t,r,i=t.elementType===r?i:na(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ra(e,t,r,i=t.elementType===r?i:na(r,i),n);case 3:e:{if(xa(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,Uo(e,t),zo(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Oa(e,t,r,n,i=la(Error(o(423)),t));break e}if(r!==i){t=Oa(e,t,r,n,i=la(Error(o(424)),t));break e}for(ro=li(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=wo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),r===i){t=Ha(e,t,n);break e}Ea(e,t,r,n)}t=t.child}return t;case 5:return Qo(t),null===e&&lo(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),Ca(e,t),Ea(e,t,a,n),t.child;case 6:return null===e&&lo(t),null;case 13:return ja(e,t,n);case 4:return Xo(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=bo(t,null,r,n):Ea(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ba(e,t,r,i=t.elementType===r?i:na(r,i),n);case 7:return Ea(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ea(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ai(So,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!xi.current){t=Ha(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var c=s.dependencies;if(null!==c){a=s.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===s.tag){(l=Vo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),xo(s.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),xo(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}Ea(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Oo(t,n),r=r(i=ko(i)),t.flags|=1,Ea(e,t,r,n),t.child;case 14:return i=na(r=t.type,t.pendingProps),wa(e,t,r,i=na(r.type,i),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:na(r,i),za(e,t),t.tag=1,Ni(r)?(e=!0,Mi(t)):e=!1,Oo(t,n),sa(t,r,i),ca(t,r,i,n),Ia(null,t,r,!0,e,n);case 19:return Wa(e,t,n);case 22:return Ta(e,t,n)}throw Error(o(156,t.tag))};var Kl="function"===typeof reportError?reportError:function(e){console.error(e)};function $l(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function Zl(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof i){var a=i;i=function(){var e=Hl(s);a.call(e)}}zl(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=Hl(s);o.call(e)}}var s=Wl(t,r,e,0,null,!1,0,"",Ql);return e._reactRootContainer=s,e[fi]=s.current,Wr(8===e.nodeType?e.parentNode:e),ul(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=Hl(c);a.call(e)}}var c=Fl(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=c,e[fi]=c.current,Wr(8===e.nodeType?e.parentNode:e),ul((function(){zl(t,c,n,r)})),c}(n,t,e,i,r);return Hl(s)}Yl.prototype.render=$l.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));zl(e,t,null,null)},Yl.prototype.unmount=$l.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul((function(){zl(null,e,null,null)})),t[fi]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&jt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rl(t,Je()),0===(6&Ic)&&(Wc=Je()+500,Wi()))}break;case 13:ul((function(){var t=Lo(e,1);if(null!==t){var n=el();nl(t,e,1,n)}})),ql(e,1)}},wt=function(e){if(13===e.tag){var t=Lo(e,134217728);if(null!==t)nl(t,e,134217728,el());ql(e,134217728)}},St=function(e){if(13===e.tag){var t=tl(e),n=Lo(e,t);if(null!==n)nl(n,e,t,el());ql(e,t)}},Tt=function(){return _t},Ct=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},we=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=bi(r);if(!i)throw Error(o(90));K(r),Q(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=ll,xe=ul;var eu={usingClientEntryPoint:!1,Events:[_i,Ei,bi,Ae,Re,ll]},tu={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xl(e))throw Error(o(299));var n=!1,r="",i=Kl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Fl(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Wr(8===e.nodeType?e.parentNode:e),new $l(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Jl(t))throw Error(o(200));return Zl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xl(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=Kl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Wl(t,null,e,1,null!=n?n:null,i,0,s,a),e[fi]=t.current,Wr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Yl(t)},t.render=function(e,t,n){if(!Jl(t))throw Error(o(200));return Zl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jl(e))throw Error(o(40));return!!e._reactRootContainer&&(ul((function(){Zl(null,null,e,!1,(function(){e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jl(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return Zl(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},8399:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c,getFunctionName:()=>o});var r=n(6879);const i=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function o(e){const t=`${e}`.match(i);return t&&t[1]||""}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.displayName||e.name||o(e)||t}function a(e,t,n){const r=s(t);return e.displayName||(""!==r?`${n}(${r})`:n)}function c(e){if(null!=e){if("string"===typeof e)return e;if("function"===typeof e)return s(e,"Component");if("object"===typeof e)switch(e.$$typeof){case r.vM:return a(e,e.render,"ForwardRef");case r.lD:return a(e,e.type,"memo");default:return}}}},8463:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});n(9950);var r=n(6171);n(4414);function i(e){return(0,r.b)(e)}},8465:(e,t,n)=>{"use strict";function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const r={};return Object.keys(e).forEach((i=>{r[i]=e[i].reduce(((e,r)=>{if(r){const i=t(r);""!==i&&e.push(i),n&&n[r]&&e.push(n[r])}return e}),[]).join(" ")})),r}n.d(t,{A:()=>r})},8522:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8zM5 19l3-4 2 3 3-4 4 5z"}),"AddPhotoAlternate")},8587:(e,t,n)=>{"use strict";function r(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}n.d(t,{A:()=>r})},8603:(e,t,n)=>{"use strict";n.d(t,{A:()=>ie});var r=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)})),this.tags=[],this.ctr=0},e}(),i=Math.abs,o=String.fromCharCode,s=Object.assign;function a(e){return e.trim()}function c(e,t,n){return e.replace(t,n)}function l(e,t){return e.indexOf(t)}function u(e,t){return 0|e.charCodeAt(t)}function d(e,t,n){return e.slice(t,n)}function h(e){return e.length}function p(e){return e.length}function f(e,t){return t.push(e),e}var m=1,g=1,v=0,y=0,_=0,E="";function b(e,t,n,r,i,o,s){return{value:e,root:t,parent:n,type:r,props:i,children:o,line:m,column:g,length:s,return:""}}function w(e,t){return s(b("",null,null,"",null,null,0),e,{length:-e.length},t)}function S(){return _=y>0?u(E,--y):0,g--,10===_&&(g=1,m--),_}function T(){return _=y<v?u(E,y++):0,g++,10===_&&(g=1,m++),_}function C(){return u(E,y)}function A(){return y}function R(e,t){return d(E,e,t)}function I(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function x(e){return m=g=1,v=h(E=e),y=0,[]}function O(e){return E="",e}function k(e){return a(R(y-1,D(91===e?e+2:40===e?e+1:e)))}function N(e){for(;(_=C())&&_<33;)T();return I(e)>2||I(_)>3?"":" "}function P(e,t){for(;--t&&T()&&!(_<48||_>102||_>57&&_<65||_>70&&_<97););return R(e,A()+(t<6&&32==C()&&32==T()))}function D(e){for(;T();)switch(_){case e:return y;case 34:case 39:34!==e&&39!==e&&D(_);break;case 40:41===e&&D(e);break;case 92:T()}return y}function L(e,t){for(;T()&&e+_!==57&&(e+_!==84||47!==C()););return"/*"+R(t,y-1)+"*"+o(47===e?e:T())}function M(e){for(;!I(C());)T();return R(e,y)}var j="-ms-",U="-moz-",V="-webkit-",F="comm",B="rule",W="decl",z="@keyframes";function H(e,t){for(var n="",r=p(e),i=0;i<r;i++)n+=t(e[i],i,e,t)||"";return n}function G(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case W:return e.return=e.return||e.value;case F:return"";case z:return e.return=e.value+"{"+H(e.children,r)+"}";case B:e.value=e.props.join(",")}return h(n=H(e.children,r))?e.return=e.value+"{"+n+"}":""}function q(e){return O(K("",null,null,null,[""],e=x(e),0,[0],e))}function K(e,t,n,r,i,s,a,d,p){for(var m=0,g=0,v=a,y=0,_=0,E=0,b=1,w=1,R=1,I=0,x="",O=i,D=s,j=r,U=x;w;)switch(E=I,I=T()){case 40:if(108!=E&&58==u(U,v-1)){-1!=l(U+=c(k(I),"&","&\f"),"&\f")&&(R=-1);break}case 34:case 39:case 91:U+=k(I);break;case 9:case 10:case 13:case 32:U+=N(E);break;case 92:U+=P(A()-1,7);continue;case 47:switch(C()){case 42:case 47:f(Y(L(T(),A()),t,n),p);break;default:U+="/"}break;case 123*b:d[m++]=h(U)*R;case 125*b:case 59:case 0:switch(I){case 0:case 125:w=0;case 59+g:-1==R&&(U=c(U,/\f/g,"")),_>0&&h(U)-v&&f(_>32?X(U+";",r,n,v-1):X(c(U," ","")+";",r,n,v-2),p);break;case 59:U+=";";default:if(f(j=$(U,t,n,m,g,i,d,x,O=[],D=[],v),s),123===I)if(0===g)K(U,t,j,j,O,s,v,d,D);else switch(99===y&&110===u(U,3)?100:y){case 100:case 108:case 109:case 115:K(e,j,j,r&&f($(e,j,j,0,0,i,d,x,i,O=[],v),D),i,D,v,d,r?O:D);break;default:K(U,j,j,j,[""],D,0,d,D)}}m=g=_=0,b=R=1,x=U="",v=a;break;case 58:v=1+h(U),_=E;default:if(b<1)if(123==I)--b;else if(125==I&&0==b++&&125==S())continue;switch(U+=o(I),I*b){case 38:R=g>0?1:(U+="\f",-1);break;case 44:d[m++]=(h(U)-1)*R,R=1;break;case 64:45===C()&&(U+=k(T())),y=C(),g=v=h(x=U+=M(A())),I++;break;case 45:45===E&&2==h(U)&&(b=0)}}return s}function $(e,t,n,r,o,s,l,u,h,f,m){for(var g=o-1,v=0===o?s:[""],y=p(v),_=0,E=0,w=0;_<r;++_)for(var S=0,T=d(e,g+1,g=i(E=l[_])),C=e;S<y;++S)(C=a(E>0?v[S]+" "+T:c(T,/&\f/g,v[S])))&&(h[w++]=C);return b(e,t,n,0===o?B:u,h,f,m)}function Y(e,t,n){return b(e,t,n,F,o(_),d(e,2,-2),0)}function X(e,t,n,r){return b(e,t,n,W,d(e,0,r),d(e,r+1,-1),r)}var J=function(e,t,n){for(var r=0,i=0;r=i,i=C(),38===r&&12===i&&(t[n]=1),!I(i);)T();return R(e,y)},Q=function(e,t){return O(function(e,t){var n=-1,r=44;do{switch(I(r)){case 0:38===r&&12===C()&&(t[n]=1),e[n]+=J(y-1,t,n);break;case 2:e[n]+=k(r);break;case 4:if(44===r){e[++n]=58===C()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=o(r)}}while(r=T());return e}(x(e),t))},Z=new WeakMap,ee=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||Z.get(n))&&!r){Z.set(e,!0);for(var i=[],o=Q(t,i),s=n.props,a=0,c=0;a<o.length;a++)for(var l=0;l<s.length;l++,c++)e.props[c]=i[a]?o[a].replace(/&\f/g,s[l]):s[l]+" "+o[a]}}},te=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function ne(e,t){switch(function(e,t){return 45^u(e,0)?(((t<<2^u(e,0))<<2^u(e,1))<<2^u(e,2))<<2^u(e,3):0}(e,t)){case 5103:return V+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return V+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return V+e+U+e+j+e+e;case 6828:case 4268:return V+e+j+e+e;case 6165:return V+e+j+"flex-"+e+e;case 5187:return V+e+c(e,/(\w+).+(:[^]+)/,V+"box-$1$2"+j+"flex-$1$2")+e;case 5443:return V+e+j+"flex-item-"+c(e,/flex-|-self/,"")+e;case 4675:return V+e+j+"flex-line-pack"+c(e,/align-content|flex-|-self/,"")+e;case 5548:return V+e+j+c(e,"shrink","negative")+e;case 5292:return V+e+j+c(e,"basis","preferred-size")+e;case 6060:return V+"box-"+c(e,"-grow","")+V+e+j+c(e,"grow","positive")+e;case 4554:return V+c(e,/([^-])(transform)/g,"$1"+V+"$2")+e;case 6187:return c(c(c(e,/(zoom-|grab)/,V+"$1"),/(image-set)/,V+"$1"),e,"")+e;case 5495:case 3959:return c(e,/(image-set\([^]*)/,V+"$1$`$1");case 4968:return c(c(e,/(.+:)(flex-)?(.*)/,V+"box-pack:$3"+j+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+V+e+e;case 4095:case 3583:case 4068:case 2532:return c(e,/(.+)-inline(.+)/,V+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(h(e)-1-t>6)switch(u(e,t+1)){case 109:if(45!==u(e,t+4))break;case 102:return c(e,/(.+:)(.+)-([^]+)/,"$1"+V+"$2-$3$1"+U+(108==u(e,t+3)?"$3":"$2-$3"))+e;case 115:return~l(e,"stretch")?ne(c(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==u(e,t+1))break;case 6444:switch(u(e,h(e)-3-(~l(e,"!important")&&10))){case 107:return c(e,":",":"+V)+e;case 101:return c(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+V+(45===u(e,14)?"inline-":"")+"box$3$1"+V+"$2$3$1"+j+"$2box$3")+e}break;case 5936:switch(u(e,t+11)){case 114:return V+e+j+c(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return V+e+j+c(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return V+e+j+c(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return V+e+j+e+e}return e}var re=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case W:e.return=ne(e.value,e.length);break;case z:return H([w(e,{value:c(e.value,"@","@"+V)})],r);case B:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return H([w(e,{props:[c(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return H([w(e,{props:[c(t,/:(plac\w+)/,":"+V+"input-$1")]}),w(e,{props:[c(t,/:(plac\w+)/,":-moz-$1")]}),w(e,{props:[c(t,/:(plac\w+)/,j+"input-$1")]})],r)}return""}))}}],ie=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var i,o,s=e.stylisPlugins||re,a={},c=[];i=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)a[t[n]]=!0;c.push(e)}));var l,u,d=[G,(u=function(e){l.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],h=function(e){var t=p(e);return function(n,r,i,o){for(var s="",a=0;a<t;a++)s+=e[a](n,r,i,o)||"";return s}}([ee,te].concat(s,d));o=function(e,t,n,r){l=n,H(q(e?e+"{"+t.styles+"}":t.styles),h),r&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new r({key:t,container:i,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:a,registered:{},insert:o};return f.sheet.hydrate(c),f}},8635:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(6907);function i(e){return(0,r.A)(e).defaultView||window}},8733:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(3931).A},8807:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.A,extendSxProp:()=>i.A,unstable_createStyleFunctionSx:()=>r.k,unstable_defaultSxConfig:()=>o.A});var r=n(505),i=n(237),o=n(8076)},9015:(e,t,n)=>{"use strict";n.d(t,{J:()=>g});var r={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},i=n(7923),o=!1,s=/[A-Z]|^ms/g,a=/_EMO_([^_]+?)_([^]*?)_EMO_/g,c=function(e){return 45===e.charCodeAt(1)},l=function(e){return null!=e&&"boolean"!==typeof e},u=(0,i.A)((function(e){return c(e)?e:e.replace(s,"-$&").toLowerCase()})),d=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(a,(function(e,t,n){return f={name:t,styles:n,next:f},t}))}return 1===r[e]||c(e)||"number"!==typeof t||0===t?t:t+"px"},h="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function p(e,t,n){if(null==n)return"";var r=n;if(void 0!==r.__emotion_styles)return r;switch(typeof n){case"boolean":return"";case"object":var i=n;if(1===i.anim)return f={name:i.name,styles:i.styles,next:f},i.name;var s=n;if(void 0!==s.styles){var a=s.next;if(void 0!==a)for(;void 0!==a;)f={name:a.name,styles:a.styles,next:f},a=a.next;return s.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=p(e,t,n[i])+";";else for(var s in n){var a=n[s];if("object"!==typeof a){var c=a;null!=t&&void 0!==t[c]?r+=s+"{"+t[c]+"}":l(c)&&(r+=u(s)+":"+d(s,c)+";")}else{if("NO_COMPONENT_SELECTOR"===s&&o)throw new Error(h);if(!Array.isArray(a)||"string"!==typeof a[0]||null!=t&&void 0!==t[a[0]]){var f=p(e,t,a);switch(s){case"animation":case"animationName":r+=u(s)+":"+f+";";break;default:r+=s+"{"+f+"}"}}else for(var m=0;m<a.length;m++)l(a[m])&&(r+=u(s)+":"+d(s,a[m])+";")}}return r}(e,t,n);case"function":if(void 0!==e){var c=f,m=n(e);return f=c,p(e,t,m)}}var g=n;if(null==t)return g;var v=t[g];return void 0!==v?v:g}var f,m=/label:\s*([^\s;{]+)\s*(;|$)/g;function g(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,i="";f=void 0;var o=e[0];null==o||void 0===o.raw?(r=!1,i+=p(n,t,o)):i+=o[0];for(var s=1;s<e.length;s++){if(i+=p(n,t,e[s]),r)i+=o[s]}m.lastIndex=0;for(var a,c="";null!==(a=m.exec(i));)c+="-"+a[1];var l=function(e){for(var t,n=0,r=0,i=e.length;i>=4;++r,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(i)+c;return{name:l,styles:i,next:f}}},9044:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const r=n(1399).A},9234:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.A});var r=n(8099)},9254:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>a});var r=n(7295),i=n(195),o=n(7550),s=n(9608);const a=(0,r.Ay)({themeId:o.A,defaultTheme:i.A,rootShouldForwardProp:s.A})},9269:(e,t,n)=>{"use strict";var r=n(4994);t.X4=p,t.e$=f,t.tL=g,t.eM=function(e,t){const n=h(e),r=h(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},t.a=m;var i=r(n(9234)),o=r(n(9344));function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,o.default)(e,t,n)}function a(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?`rgb${4===n.length?"a":""}(${n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}function c(e){if(e.type)return e;if("#"===e.charAt(0))return c(a(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,i.default)(9,e));let r,o=e.substring(t+1,e.length-1);if("color"===n){if(o=o.split(" "),r=o.shift(),4===o.length&&"/"===o[3].charAt(0)&&(o[3]=o[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error((0,i.default)(10,r))}else o=o.split(",");return o=o.map((e=>parseFloat(e))),{type:n,values:o,colorSpace:r}}const l=e=>{const t=c(e);return t.values.slice(0,3).map(((e,n)=>-1!==t.type.indexOf("hsl")&&0!==n?`${e}%`:e)).join(" ")};function u(e){const{type:t,colorSpace:n}=e;let{values:r}=e;return-1!==t.indexOf("rgb")?r=r.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),r=-1!==t.indexOf("color")?`${n} ${r.join(" ")}`:`${r.join(", ")}`,`${t}(${r})`}function d(e){e=c(e);const{values:t}=e,n=t[0],r=t[1]/100,i=t[2]/100,o=r*Math.min(i,1-i),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return i-o*Math.max(Math.min(t-3,9-t,1),-1)};let a="rgb";const l=[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4))];return"hsla"===e.type&&(a+="a",l.push(t[3])),u({type:a,values:l})}function h(e){let t="hsl"===(e=c(e)).type||"hsla"===e.type?c(d(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function p(e,t){return e=c(e),t=s(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,u(e)}function f(e,t){if(e=c(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]*=1-t;return u(e)}function m(e,t){if(e=c(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]+=(1-e.values[n])*t;return u(e)}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return h(e)>.5?f(e,t):m(e,t)}},9344:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.A});var r=n(6747)},9526:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(7034)},9532:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},9608:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(1960);const i=e=>(0,r.A)(e)&&"classes"!==e},9693:(e,t,n)=>{"use strict";var r=n(4994);t.A=void 0;var i=r(n(9526)),o=n(4414);t.A=(0,i.default)((0,o.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},9904:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.A,private_createBreakpoints:()=>i.A,unstable_applyStyles:()=>o.A});var r=n(2860),i=n(3628),o=n(86)},9950:(e,t,n)=>{"use strict";e.exports=n(2049)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>r[e]));return s.default=()=>r,n.d(o,s),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e,t=n(9950),r=n.t(t,2),i=n(1352);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const s="popstate";function a(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(JS){}}}function l(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,n,r){return void 0===n&&(n=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?h(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function h(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function p(t,n,r,i){void 0===i&&(i={});let{window:c=document.defaultView,v5Compat:h=!1}=i,p=c.history,f=e.Pop,m=null,g=v();function v(){return(p.state||{idx:null}).idx}function y(){f=e.Pop;let t=v(),n=null==t?null:t-g;g=t,m&&m({action:f,location:E.location,delta:n})}function _(e){let t="null"!==c.location.origin?c.location.origin:c.location.href,n="string"===typeof e?e:d(e);return n=n.replace(/ $/,"%20"),a(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,p.replaceState(o({},p.state,{idx:g}),""));let E={get action(){return f},get location(){return t(c,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return c.addEventListener(s,y),m=e,()=>{c.removeEventListener(s,y),m=null}},createHref:e=>n(c,e),createURL:_,encodeLocation(e){let t=_(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){f=e.Push;let i=u(E.location,t,n);r&&r(i,t),g=v()+1;let o=l(i,g),s=E.createHref(i);try{p.pushState(o,"",s)}catch(k_){if(k_ instanceof DOMException&&"DataCloneError"===k_.name)throw k_;c.location.assign(s)}h&&m&&m({action:f,location:E.location,delta:1})},replace:function(t,n){f=e.Replace;let i=u(E.location,t,n);r&&r(i,t),g=v();let o=l(i,g),s=E.createHref(i);p.replaceState(o,"",s),h&&m&&m({action:f,location:E.location,delta:0})},go:e=>p.go(e)};return E}var f;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(f||(f={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function m(e,t,n){return void 0===n&&(n="/"),g(e,t,n,!1)}function g(e,t,n,r){let i=O(("string"===typeof t?h(t):t).pathname||"/",n);if(null==i)return null;let o=v(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(o);let s=null;for(let a=0;null==s&&a<o.length;++a){let e=x(i);s=R(o[a],e,r)}return s}function v(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};s.relativePath.startsWith("/")&&(a(s.relativePath.startsWith(r),'Absolute route path "'+s.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(r.length));let c=L([r,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(a(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+c+'".'),v(e.children,t,l,c)),(null!=e.path||e.index)&&t.push({path:c,score:A(c,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of y(e.path))i(e,t,r);else i(e,t)})),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let s=y(r.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),i&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const _=/^:[\w-]+$/,E=3,b=2,w=1,S=10,T=-2,C=e=>"*"===e;function A(e,t){let n=e.split("/"),r=n.length;return n.some(C)&&(r+=T),t&&(r+=b),n.filter((e=>!C(e))).reduce(((e,t)=>e+(_.test(t)?E:""===t?w:S)),r)}function R(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},o="/",s=[];for(let a=0;a<r.length;++a){let e=r[a],c=a===r.length-1,l="/"===o?t:t.slice(o.length)||"/",u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),d=e.route;if(!u&&c&&n&&!r[r.length-1].route.index&&(u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!u)return null;Object.assign(i,u.params),s.push({params:i,pathname:L([o,u.pathname]),pathnameBase:M(L([o,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(o=L([o,u.pathnameBase]))}return s}function I(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let o=new RegExp(i,t?void 0:"i");return[o,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=a[n]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const c=a[n];return e[r]=i&&!c?void 0:(c||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:s,pattern:e}}function x(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(k_){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+k_+")."),e}}function O(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function k(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function N(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function P(e,t){let n=N(e);return t?n.map(((e,t)=>t===n.length-1?e.pathname:e.pathnameBase)):n.map((e=>e.pathnameBase))}function D(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=h(e):(i=o({},e),a(!i.pathname||!i.pathname.includes("?"),k("?","pathname","search",i)),a(!i.pathname||!i.pathname.includes("#"),k("#","pathname","hash",i)),a(!i.search||!i.search.includes("#"),k("#","search","hash",i)));let s,c=""===e||""===i.pathname,l=c?"/":i.pathname;if(null==l)s=n;else{let e=t.length-1;if(!r&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}s=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?h(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:j(r),hash:U(i)}}(i,s),d=l&&"/"!==l&&l.endsWith("/"),p=(c||"."===l)&&n.endsWith("/");return u.pathname.endsWith("/")||!d&&!p||(u.pathname+="/"),u}const L=e=>e.join("/").replace(/\/\/+/g,"/"),M=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),j=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function V(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const F=["post","put","patch","delete"],B=(new Set(F),["get",...F]);new Set(B),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}const z=t.createContext(null);const H=t.createContext(null);const G=t.createContext(null);const q=t.createContext(null);const K=t.createContext({outlet:null,matches:[],isDataRoute:!1});const $=t.createContext(null);function Y(){return null!=t.useContext(q)}function X(){return Y()||a(!1),t.useContext(q).location}function J(e){t.useContext(G).static||t.useLayoutEffect(e)}function Q(){let{isDataRoute:e}=t.useContext(K);return e?function(){let{router:e}=le(ae.UseNavigateStable),n=de(ce.UseNavigateStable),r=t.useRef(!1);return J((()=>{r.current=!0})),t.useCallback((function(t,i){void 0===i&&(i={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,W({fromRouteId:n},i)))}),[e,n])}():function(){Y()||a(!1);let e=t.useContext(z),{basename:n,future:r,navigator:i}=t.useContext(G),{matches:o}=t.useContext(K),{pathname:s}=X(),c=JSON.stringify(P(o,r.v7_relativeSplatPath)),l=t.useRef(!1);return J((()=>{l.current=!0})),t.useCallback((function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof t)return void i.go(t);let o=D(t,JSON.parse(c),s,"path"===r.relative);null==e&&"/"!==n&&(o.pathname="/"===o.pathname?n:L([n,o.pathname])),(r.replace?i.replace:i.push)(o,r.state,r)}),[n,i,c,s,e])}()}function Z(){let{matches:e}=t.useContext(K),n=e[e.length-1];return n?n.params:{}}function ee(e,n){let{relative:r}=void 0===n?{}:n,{future:i}=t.useContext(G),{matches:o}=t.useContext(K),{pathname:s}=X(),a=JSON.stringify(P(o,i.v7_relativeSplatPath));return t.useMemo((()=>D(e,JSON.parse(a),s,"path"===r)),[e,a,s,r])}function te(n,r,i,o){Y()||a(!1);let{navigator:s,static:c}=t.useContext(G),{matches:l}=t.useContext(K),u=l[l.length-1],d=u?u.params:{},p=(u&&u.pathname,u?u.pathnameBase:"/");u&&u.route;let f,g=X();if(r){var v;let e="string"===typeof r?h(r):r;"/"===p||(null==(v=e.pathname)?void 0:v.startsWith(p))||a(!1),f=e}else f=g;let y=f.pathname||"/",_=y;if("/"!==p){let e=p.replace(/^\//,"").split("/");_="/"+y.replace(/^\//,"").split("/").slice(e.length).join("/")}let E=!c&&i&&i.matches&&i.matches.length>0?i.matches:m(n,{pathname:_});let b=se(E&&E.map((e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:L([p,s.encodeLocation?s.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?p:L([p,s.encodeLocation?s.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),l,i,o);return r&&b?t.createElement(q.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:e.Pop}},b):b}function ne(){let e=function(){var e;let n=t.useContext($),r=ue(ce.UseRouteError),i=de(ce.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[i]}(),n=V(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:o},r):null,null)}const re=t.createElement(ne,null);class ie extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(K.Provider,{value:this.props.routeContext},t.createElement($.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oe(e){let{routeContext:n,match:r,children:i}=e,o=t.useContext(z);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(K.Provider,{value:n},i)}function se(e,n,r,i){var o;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var s;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(s=i)&&s.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let c=e,l=null==(o=r)?void 0:o.errors;if(null!=l){let e=c.findIndex((e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id])));e>=0||a(!1),c=c.slice(0,Math.min(c.length,e+1))}let u=!1,d=-1;if(r&&i&&i.v7_partialHydration)for(let t=0;t<c.length;t++){let e=c[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=t),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){u=!0,c=d>=0?c.slice(0,d+1):[c[0]];break}}}return c.reduceRight(((e,i,o)=>{let s,a=!1,h=null,p=null;var f;r&&(s=l&&i.route.id?l[i.route.id]:void 0,h=i.route.errorElement||re,u&&(d<0&&0===o?(f="route-fallback",!1||he[f]||(he[f]=!0),a=!0,p=null):d===o&&(a=!0,p=i.route.hydrateFallbackElement||null)));let m=n.concat(c.slice(0,o+1)),g=()=>{let n;return n=s?h:a?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(oe,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===o)?t.createElement(ie,{location:r.location,revalidation:r.revalidation,component:h,error:s,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var ae=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ae||{}),ce=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ce||{});function le(e){let n=t.useContext(z);return n||a(!1),n}function ue(e){let n=t.useContext(H);return n||a(!1),n}function de(e){let n=function(){let e=t.useContext(K);return e||a(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||a(!1),r.route.id}const he={};function pe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function fe(e){let{to:n,replace:r,state:i,relative:o}=e;Y()||a(!1);let{future:s,static:c}=t.useContext(G),{matches:l}=t.useContext(K),{pathname:u}=X(),d=Q(),h=D(n,P(l,s.v7_relativeSplatPath),u,"path"===o),p=JSON.stringify(h);return t.useEffect((()=>d(JSON.parse(p),{replace:r,state:i,relative:o})),[d,p,o,r,i]),null}function me(e){a(!1)}function ge(n){let{basename:r="/",children:i=null,location:o,navigationType:s=e.Pop,navigator:c,static:l=!1,future:u}=n;Y()&&a(!1);let d=r.replace(/^\/*/,"/"),p=t.useMemo((()=>({basename:d,navigator:c,static:l,future:W({v7_relativeSplatPath:!1},u)})),[d,u,c,l]);"string"===typeof o&&(o=h(o));let{pathname:f="/",search:m="",hash:g="",state:v=null,key:y="default"}=o,_=t.useMemo((()=>{let e=O(f,d);return null==e?null:{location:{pathname:e,search:m,hash:g,state:v,key:y},navigationType:s}}),[d,f,m,g,v,y,s]);return null==_?null:t.createElement(G.Provider,{value:p},t.createElement(q.Provider,{children:i,value:_}))}function ve(e){let{children:t,location:n}=e;return te(ye(t),n)}new Promise((()=>{}));t.Component;function ye(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,((e,i)=>{if(!t.isValidElement(e))return;let o=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,ye(e.props.children,o));e.type!==me&&a(!1),e.props.index&&e.props.children&&a(!1);let s={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=ye(e.props.children,o)),r.push(s)})),r}var _e=n(7119),Ee=n.t(_e,2);function be(){return be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},be.apply(this,arguments)}function we(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Se=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(JS){}new Map;const Te=r.startTransition;Ee.flushSync,r.useId;function Ce(e){let{basename:n,children:r,future:i,window:o}=e,s=t.useRef();var a;null==s.current&&(s.current=(void 0===(a={window:o,v5Compat:!0})&&(a={}),p((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return u("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:d(t)}),null,a)));let c=s.current,[l,h]=t.useState({action:c.action,location:c.location}),{v7_startTransition:f}=i||{},m=t.useCallback((e=>{f&&Te?Te((()=>h(e))):h(e)}),[h,f]);return t.useLayoutEffect((()=>c.listen(m)),[c,m]),t.useEffect((()=>pe(i)),[i]),t.createElement(ge,{basename:n,children:r,location:l.location,navigationType:l.action,navigator:c,future:i})}const Ae="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Re=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ie=t.forwardRef((function(e,n){let r,{onClick:i,relative:o,reloadDocument:s,replace:c,state:l,target:u,to:h,preventScrollReset:p,viewTransition:f}=e,m=we(e,Se),{basename:g}=t.useContext(G),v=!1;if("string"===typeof h&&Re.test(h)&&(r=h,Ae))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=O(t.pathname,g);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:v=!0}catch(JS){}let y=function(e,n){let{relative:r}=void 0===n?{}:n;Y()||a(!1);let{basename:i,navigator:o}=t.useContext(G),{hash:s,pathname:c,search:l}=ee(e,{relative:r}),u=c;return"/"!==i&&(u="/"===c?i:L([i,c])),o.createHref({pathname:u,search:l,hash:s})}(h,{relative:o}),_=function(e,n){let{target:r,replace:i,state:o,preventScrollReset:s,relative:a,viewTransition:c}=void 0===n?{}:n,l=Q(),u=X(),h=ee(e,{relative:a});return t.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();let n=void 0!==i?i:d(u)===d(h);l(e,{replace:n,state:o,preventScrollReset:s,relative:a,viewTransition:c})}}),[u,l,h,i,o,r,e,s,a,c])}(h,{replace:c,state:l,target:u,preventScrollReset:p,relative:o,viewTransition:f});return t.createElement("a",be({},m,{href:r||y,onClick:v||s?i:function(e){i&&i(e),e.defaultPrevented||_(e)},ref:n,target:u}))}));var xe,Oe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(xe||(xe={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Oe||(Oe={}));var ke=n(8168),Ne=n(8587),Pe=n(2004),De=n(116),Le=n(505),Me=n(237),je=n(2860),Ue=n(7370);const Ve=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n=t.useContext(Ue.T);return n&&(r=n,0!==Object.keys(r).length)?n:e;var r},Fe=(0,je.A)();const Be=function(){return Ve(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe)};var We=n(4414);const ze=["className","component"];var He=n(4501),Ge=n(4436),qe=n(7550),Ke=n(1763);const $e=(0,Ke.A)("MuiBox",["root"]),Ye=(0,Ge.A)(),Xe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:n,defaultTheme:r,defaultClassName:i="MuiBox-root",generateClassName:o}=e,s=(0,De.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(Le.A),a=t.forwardRef((function(e,t){const a=Be(r),c=(0,Me.A)(e),{className:l,component:u="div"}=c,d=(0,Ne.A)(c,ze);return(0,We.jsx)(s,(0,ke.A)({as:u,ref:t,className:(0,Pe.A)(l,o?o(i):i),theme:n&&a[n]||a},d))}));return a}({themeId:qe.A,defaultTheme:Ye,defaultClassName:$e.root,generateClassName:He.A.generate}),Je=Xe;var Qe=n(8463),Ze=n(3158);const et=function(e){let{styles:t,themeId:n,defaultTheme:r={}}=e;const i=Be(r),o="function"===typeof t?t(n&&i[n]||i):t;return(0,We.jsx)(Ze.A,{styles:o})};var tt=n(195);const nt=function(e){return(0,We.jsx)(et,(0,ke.A)({},e,{defaultTheme:tt.A,themeId:qe.A}))},rt=(e,t)=>(0,ke.A)({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%"},t&&!e.vars&&{colorScheme:e.palette.mode}),it=e=>(0,ke.A)({color:(e.vars||e).palette.text.primary},e.typography.body1,{backgroundColor:(e.vars||e).palette.background.default,"@media print":{backgroundColor:(e.vars||e).palette.common.white}});const ot=function(e){const n=(0,Qe.b)({props:e,name:"MuiCssBaseline"}),{children:r,enableColorScheme:i=!1}=n;return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)(nt,{styles:e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n;const r={};t&&e.colorSchemes&&Object.entries(e.colorSchemes).forEach((t=>{let[n,i]=t;var o;r[e.getColorSchemeSelector(n).replace(/\s*&/,"")]={colorScheme:null==(o=i.palette)?void 0:o.mode}}));let i=(0,ke.A)({html:rt(e,t),"*, *::before, *::after":{boxSizing:"inherit"},"strong, b":{fontWeight:e.typography.fontWeightBold},body:(0,ke.A)({margin:0},it(e),{"&::backdrop":{backgroundColor:(e.vars||e).palette.background.default}})},r);const o=null==(n=e.components)||null==(n=n.MuiCssBaseline)?void 0:n.styleOverrides;return o&&(i=[i,o]),i}(e,i)}),r]})},st=!1,at=!1,ct="${JSCORE_VERSION}",lt=function(e,t){if(!e)throw ut(t)},ut=function(e){return new Error("Firebase Database ("+ct+") INTERNAL ASSERT FAILED: "+e)},dt=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},ht={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],o=i+1<e.length,s=o?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,l=t>>2,u=(3&t)<<4|s>>4;let d=(15&s)<<2|c>>6,h=63&c;a||(h=64,o||(d=64)),r.push(n[l],n[u],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(dt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const s=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==s||null==a)throw new pt;const c=t<<2|o>>4;if(r.push(c),64!==s){const e=o<<4&240|s>>2;if(r.push(e),64!==a){const e=s<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class pt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ft=function(e){const t=dt(e);return ht.encodeByteArray(t,!0)},mt=function(e){return ft(e).replace(/\./g,"")},gt=function(e){try{return ht.decodeString(e,!0)}catch(JS){console.error("base64Decode failed: ",JS)}return null};function vt(e){return yt(void 0,e)}function yt(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=yt(e[n],t[n]));return e}const _t=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Et=()=>{try{return _t()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ALGOLIA_API_KEY:"b94f7163a6855940c1a0d94e635a307c",REACT_APP_ALGOLIA_APP_ID:"7PVTC2J64R",REACT_APP_ALGOLIA_INDEX_NAME:"searches",REACT_APP_API_URL:"https://sideeye-backend-production.up.railway.app",REACT_APP_FIREBASE_API_KEY:"AIzaSyBI9pvyseKR-5dw3eXuZgTLnG3OcvNGbeI",REACT_APP_FIREBASE_APP_ID:"1:864667627333:web:1ec087179141d1e91a982c",REACT_APP_FIREBASE_AUTH_DOMAIN:"sideeye.uk",REACT_APP_FIREBASE_DATABASE_URL:"https://sideeye-bafda-default-rtdb.europe-west1.firebasedatabase.app",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"864667627333",REACT_APP_FIREBASE_PROJECT_ID:"sideeye-bafda",REACT_APP_FIREBASE_STORAGE_BUCKET:"sideeye-bafda.firebasestorage.app",REACT_APP_SHOTSTACK_API_KEY:"c0Bpc85oj7cHuDdfhz54eQJmmoEI1qauJyodpw9d"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(JS){return}const t=e&&gt(e[1]);return t&&JSON.parse(t)})()}catch(JS){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${JS}`)}},bt=e=>{var t,n;return null===(n=null===(t=Et())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},wt=e=>{const t=bt(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},St=()=>{var e;return null===(e=Et())||void 0===e?void 0:e.config},Tt=e=>{var t;return null===(t=Et())||void 0===t?void 0:t[`_${e}`]};class Ct{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function At(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[mt(JSON.stringify({alg:"none",type:"JWT"})),mt(JSON.stringify(o)),""].join(".")}function Rt(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function It(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Rt())}function xt(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function Ot(){return!0===st||!0===at}function kt(){return!function(){var e;const t=null===(e=Et())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(JS){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nt(){try{return"object"===typeof indexedDB}catch(JS){return!1}}class Pt extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Pt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Dt.prototype.create)}}class Dt{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(Lt,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(r,t):"Error",o=`${this.serviceName}: ${i} (${n}).`;return new Pt(n,o,t)}}const Lt=/\{\$([^}]+)}/g;function Mt(e){return JSON.parse(e)}function jt(e){return JSON.stringify(e)}const Ut=function(e){let t={},n={},r={},i="";try{const o=e.split(".");t=Mt(gt(o[0])||""),n=Mt(gt(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(JS){}return{header:t,claims:n,data:r,signature:i}};function Vt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ft(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Bt(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Wt(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function zt(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],o=t[i];if(Ht(n)&&Ht(o)){if(!zt(n,o))return!1}else if(n!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Ht(e){return null!==e&&"object"===typeof e}function Gt(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function qt(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function Kt(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class $t{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,o=this.chain_[0],s=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=c^s&(a^c),i=1518500249):(r=s^a^c,i=1859775393):u<60?(r=s&a|c&(s|a),i=2400959708):(r=s^a^c,i=3395469782);const e=(o<<5|o>>>27)+r+l+i+n[u]&4294967295;l=c,c=a,a=4294967295&(s<<30|s>>>2),s=o,o=e}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class Yt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Xt),void 0===r.error&&(r.error=Xt),void 0===r.complete&&(r.complete=Xt);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(JS){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(JS){"undefined"!==typeof console&&console.error&&console.error(JS)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Xt(){}function Jt(e,t){return`${e} failed: ${t} argument `}const Qt=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function Zt(e){return e&&e._delegate?e._delegate:e}class en{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const tn="[DEFAULT]";class nn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Ct;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(JS){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(JS){if(r)return null;throw JS}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:tn})}catch(JS){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(JS){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tn;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tn;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tn;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&o.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:rn(t),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(i){}return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tn;return this.component?this.component.multipleInstances?e:tn:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function rn(e){return e===tn?void 0:e}class on{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new nn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const sn=[];var an;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(an||(an={}));const cn={debug:an.DEBUG,verbose:an.VERBOSE,info:an.INFO,warn:an.WARN,error:an.ERROR,silent:an.SILENT},ln=an.INFO,un={[an.DEBUG]:"log",[an.VERBOSE]:"log",[an.INFO]:"info",[an.WARN]:"warn",[an.ERROR]:"error"},dn=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=un[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];console[r](`[${n}]  ${e.name}:`,...o)};class hn{constructor(e){this.name=e,this._logLevel=ln,this._logHandler=dn,this._userLogHandler=null,sn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in an))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?cn[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,an.DEBUG,...t),this._logHandler(this,an.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,an.VERBOSE,...t),this._logHandler(this,an.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,an.INFO,...t),this._logHandler(this,an.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,an.WARN,...t),this._logHandler(this,an.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,an.ERROR,...t),this._logHandler(this,an.ERROR,...t)}}let pn,fn;const mn=new WeakMap,gn=new WeakMap,vn=new WeakMap,yn=new WeakMap,_n=new WeakMap;let En={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return gn.get(e);if("objectStoreNames"===t)return e.objectStoreNames||vn.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Sn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function bn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(fn||(fn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(Tn(this),n),Sn(mn.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Sn(e.apply(Tn(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const o=e.call(Tn(this),t,...r);return vn.set(o,t.sort?t.sort():[t]),Sn(o)}}function wn(e){return"function"===typeof e?bn(e):(e instanceof IDBTransaction&&function(e){if(gn.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));gn.set(e,t)}(e),t=e,(pn||(pn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,En):e);var t}function Sn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(Sn(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&mn.set(t,e)})).catch((()=>{})),_n.set(t,e),t}(e);if(yn.has(e))return yn.get(e);const t=wn(e);return t!==e&&(yn.set(e,t),_n.set(t,e)),t}const Tn=e=>_n.get(e);const Cn=["get","getKey","getAll","getAllKeys","count"],An=["put","add","delete","clear"],Rn=new Map;function In(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Rn.get(t))return Rn.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=An.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Cn.includes(n))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];return r&&(o=o.index(a.shift())),(await Promise.all([o[n](...a),i&&t.done]))[0]};return Rn.set(t,o),o}En=(e=>({...e,get:(t,n,r)=>In(t,n)||e.get(t,n,r),has:(t,n)=>!!In(t,n)||e.has(t,n)}))(En);class xn{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const On="@firebase/app",kn="0.11.4",Nn=new hn("@firebase/app"),Pn="@firebase/app-compat",Dn="@firebase/analytics-compat",Ln="@firebase/analytics",Mn="@firebase/app-check-compat",jn="@firebase/app-check",Un="@firebase/auth",Vn="@firebase/auth-compat",Fn="@firebase/database",Bn="@firebase/data-connect",Wn="@firebase/database-compat",zn="@firebase/functions",Hn="@firebase/functions-compat",Gn="@firebase/installations",qn="@firebase/installations-compat",Kn="@firebase/messaging",$n="@firebase/messaging-compat",Yn="@firebase/performance",Xn="@firebase/performance-compat",Jn="@firebase/remote-config",Qn="@firebase/remote-config-compat",Zn="@firebase/storage",er="@firebase/storage-compat",tr="@firebase/firestore",nr="@firebase/vertexai",rr="@firebase/firestore-compat",ir="firebase",or="[DEFAULT]",sr={[On]:"fire-core",[Pn]:"fire-core-compat",[Ln]:"fire-analytics",[Dn]:"fire-analytics-compat",[jn]:"fire-app-check",[Mn]:"fire-app-check-compat",[Un]:"fire-auth",[Vn]:"fire-auth-compat",[Fn]:"fire-rtdb",[Bn]:"fire-data-connect",[Wn]:"fire-rtdb-compat",[zn]:"fire-fn",[Hn]:"fire-fn-compat",[Gn]:"fire-iid",[qn]:"fire-iid-compat",[Kn]:"fire-fcm",[$n]:"fire-fcm-compat",[Yn]:"fire-perf",[Xn]:"fire-perf-compat",[Jn]:"fire-rc",[Qn]:"fire-rc-compat",[Zn]:"fire-gcs",[er]:"fire-gcs-compat",[tr]:"fire-fst",[rr]:"fire-fst-compat",[nr]:"fire-vertex","fire-js":"fire-js",[ir]:"fire-js-all"},ar=new Map,cr=new Map,lr=new Map;function ur(e,t){try{e.container.addComponent(t)}catch(JS){Nn.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,JS)}}function dr(e){const t=e.name;if(lr.has(t))return Nn.debug(`There were multiple attempts to register component ${t}.`),!1;lr.set(t,e);for(const n of ar.values())ur(n,e);for(const n of cr.values())ur(n,e);return!0}function hr(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function pr(e){return null!==e&&void 0!==e&&void 0!==e.settings}const fr=new Dt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class mr{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new en("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fr.create("app-deleted",{appName:this._name})}}const gr="11.6.0";function vr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:or,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw fr.create("bad-app-name",{appName:String(i)});if(n||(n=St()),!n)throw fr.create("no-options");const o=ar.get(i);if(o){if(zt(n,o.options)&&zt(r,o.config))return o;throw fr.create("duplicate-app",{appName:i})}const s=new on(i);for(const c of lr.values())s.addComponent(c);const a=new mr(n,r,s);return ar.set(i,a),a}function yr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:or;const t=ar.get(e);if(!t&&e===or&&St())return vr();if(!t)throw fr.create("no-app",{appName:e});return t}function _r(e,t,n){var r;let i=null!==(r=sr[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const o=i.match(/\s|\//),s=t.match(/\s|\//);if(o||s){const e=[`Unable to register library "${i}" with version "${t}":`];return o&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Nn.warn(e.join(" "))}dr(new en(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Er="firebase-heartbeat-store";let br=null;function wr(){return br||(br=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=Sn(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(Sn(s.result),e.oldVersion,e.newVersion,Sn(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Er)}catch(JS){console.warn(JS)}}}).catch((e=>{throw fr.create("idb-open",{originalErrorMessage:e.message})}))),br}async function Sr(e,t){try{const n=(await wr()).transaction(Er,"readwrite"),r=n.objectStore(Er);await r.put(t,Tr(e)),await n.done}catch(JS){if(JS instanceof Pt)Nn.warn(JS.message);else{const t=fr.create("idb-set",{originalErrorMessage:null===JS||void 0===JS?void 0:JS.message});Nn.warn(t.message)}}}function Tr(e){return`${e.name}!${e.options.appId}`}class Cr{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Rr(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ar();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(JS){Nn.warn(JS)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ar(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Ir(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ir(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=mt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(JS){return Nn.warn(JS),""}}}function Ar(){return(new Date).toISOString().substring(0,10)}class Rr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Nt()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(k_){t(k_)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await wr()).transaction(Er),n=await t.objectStore(Er).get(Tr(e));return await t.done,n}catch(JS){if(JS instanceof Pt)Nn.warn(JS.message);else{const t=fr.create("idb-get",{originalErrorMessage:null===JS||void 0===JS?void 0:JS.message});Nn.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Sr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Sr(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ir(e){return mt(JSON.stringify({version:2,heartbeats:e})).length}var xr;xr="",dr(new en("platform-logger",(e=>new xn(e)),"PRIVATE")),dr(new en("heartbeat",(e=>new Cr(e)),"PRIVATE")),_r(On,kn,xr),_r(On,kn,"esm2017"),_r("fire-js","");_r("firebase","11.6.0","app");function Or(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function kr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nr=kr,Pr=new Dt("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Dr=new hn("@firebase/auth");function Lr(e){if(Dr.logLevel<=an.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Dr.error(`Auth (${gr}): ${e}`,...n)}}function Mr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Fr(e,...n)}function jr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Fr(e,...n)}function Ur(e,t,n){const r=Object.assign(Object.assign({},Nr()),{[t]:n});return new Dt("auth","Firebase",r).create(t,{appName:e.name})}function Vr(e){return Ur(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return Pr.create(e,...n)}function Br(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw Fr(t,...r)}}function Wr(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Lr(t),new Error(t)}function zr(e,t){e||Wr(t)}function Hr(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Gr(){return"http:"===qr()||"https:"===qr()}function qr(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Kr(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Gr()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class $r{constructor(e,t){this.shortDelay=e,this.longDelay=t,zr(t>e,"Short delay should be less than long delay!"),this.isMobile=It()||xt()}get(){return Kr()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Yr(e,t){zr(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Xr{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Wr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Wr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Wr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Jr={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Qr=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zr=new $r(3e4,6e4);function ei(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function ti(e,t,n,r){return ni(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},(async()=>{let i={},o={};r&&("GET"===t?o=r:i={body:JSON.stringify(r)});const s=Gt(Object.assign({key:e.config.apiKey},o)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},i);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),Xr.fetch()(await ii(e,e.config.apiHost,n,s),c)}))}async function ni(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Jr),t);try{const t=new si(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw ai(e,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const t=i.ok?o.errorMessage:o.error.message,[n,s]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ai(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw ai(e,"email-already-in-use",o);if("USER_DISABLED"===n)throw ai(e,"user-disabled",o);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw Ur(e,a,s);Mr(e,a)}}catch(JS){if(JS instanceof Pt)throw JS;Mr(e,"network-request-failed",{message:String(JS)})}}async function ri(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=await ti(e,t,n,r,i);return"mfaPendingCredential"in o&&Mr(e,"multi-factor-auth-required",{_serverResponse:o}),o}async function ii(e,t,n,r){const i=`${t}${n}?${r}`,o=e,s=o.config.emulator?Yr(e.config,i):`${e.config.apiScheme}://${i}`;if(Qr.includes(n)&&(await o._persistenceManagerAvailable,"COOKIE"===o._getPersistenceType())){return o._getPersistence()._getFinalTarget(s).toString()}return s}function oi(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class si{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(jr(this.auth,"network-request-failed"))),Zr.get())}))}}function ai(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=jr(e,t,r);return i.customData._tokenResponse=n,i}function ci(e){return void 0!==e&&void 0!==e.enterprise}class li{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return oi(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ui(e,t){return ti(e,"GET","/v2/recaptchaConfig",ei(e,t))}async function di(e,t){return ti(e,"POST","/v1/accounts:lookup",t)}function hi(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(JS){}}function pi(e){return 1e3*Number(e)}function fi(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Lr("JWT malformed, contained fewer than 3 sections"),null;try{const e=gt(n);return e?JSON.parse(e):(Lr("Failed to decode base64 JWT payload"),null)}catch(JS){return Lr("Caught error parsing JWT payload as JSON",null===JS||void 0===JS?void 0:JS.toString()),null}}function mi(e){const t=fi(e);return Br(t,"internal-error"),Br("undefined"!==typeof t.exp,"internal-error"),Br("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function gi(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(JS){throw JS instanceof Pt&&function(e){let{code:t}=e;return"auth/user-disabled"===t||"auth/user-token-expired"===t}(JS)&&e.auth.currentUser===e&&await e.auth.signOut(),JS}}class vi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(JS){return void("auth/network-request-failed"===(null===JS||void 0===JS?void 0:JS.code)&&this.schedule(!0))}this.schedule()}}class yi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=hi(this.lastLoginAt),this.creationTime=hi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function _i(e){var t;const n=e.auth,r=await e.getIdToken(),i=await gi(e,di(n,{idToken:r}));Br(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const o=i.users[0];e._notifyReloadListener(o);const s=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?Ei(o.providerUserInfo):[],a=function(e,t){const n=e.filter((e=>!t.some((t=>t.providerId===e.providerId))));return[...n,...t]}(e.providerData,s),c=e.isAnonymous,l=!(e.email&&o.passwordHash)&&!(null===a||void 0===a?void 0:a.length),u=!!c&&l,d={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new yi(o.createdAt,o.lastLoginAt),isAnonymous:u};Object.assign(e,d)}function Ei(e){return e.map((e=>{var{providerId:t}=e,n=Or(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class bi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Br(e.idToken,"internal-error"),Br("undefined"!==typeof e.idToken,"internal-error"),Br("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):mi(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Br(0!==e.length,"internal-error");const t=mi(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(Br(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await ni(e,{},(async()=>{const n=Gt({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,o=await ii(e,r,"/v1/token",`key=${i}`),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",Xr.fetch()(o,{method:"POST",headers:s,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,o=new bi;return n&&(Br("string"===typeof n,"internal-error",{appName:e}),o.refreshToken=n),r&&(Br("string"===typeof r,"internal-error",{appName:e}),o.accessToken=r),i&&(Br("number"===typeof i,"internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new bi,this.toJSON())}_performRefresh(){return Wr("not implemented")}}function wi(e,t){Br("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Si{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Or(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new vi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new yi(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await gi(this,this.stsTokenManager.getToken(this.auth,e));return Br(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Zt(e),r=await n.getIdToken(t),i=fi(r);Br(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o="object"===typeof i.firebase?i.firebase:void 0,s=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:i,token:r,authTime:hi(pi(i.auth_time)),issuedAtTime:hi(pi(i.iat)),expirationTime:hi(pi(i.exp)),signInProvider:s||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Zt(e);await _i(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Br(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Si(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Br(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await _i(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(pr(this.auth.app))return Promise.reject(Vr(this.auth));const e=await this.getIdToken();return await gi(this,async function(e,t){return ti(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,o,s,a,c,l;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(o=t.photoURL)&&void 0!==o?o:void 0,f=null!==(s=t.tenantId)&&void 0!==s?s:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:_,isAnonymous:E,providerData:b,stsTokenManager:w}=t;Br(y&&w,e,"internal-error");const S=bi.fromJSON(this.name,w);Br("string"===typeof y,e,"internal-error"),wi(u,e.name),wi(d,e.name),Br("boolean"===typeof _,e,"internal-error"),Br("boolean"===typeof E,e,"internal-error"),wi(h,e.name),wi(p,e.name),wi(f,e.name),wi(m,e.name),wi(g,e.name),wi(v,e.name);const T=new Si({uid:y,auth:e,email:d,emailVerified:_,displayName:u,isAnonymous:E,photoURL:p,phoneNumber:h,tenantId:f,stsTokenManager:S,createdAt:g,lastLoginAt:v});return b&&Array.isArray(b)&&(T.providerData=b.map((e=>Object.assign({},e)))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new bi;r.updateFromServerResponse(t);const i=new Si({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await _i(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Br(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Ei(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),s=new bi;s.updateFromIdToken(n);const a=new Si({uid:r.localId,auth:e,stsTokenManager:s,isAnonymous:o}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new yi(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(a,c),a}}const Ti=new Map;function Ci(e){zr(e instanceof Function,"Expected a class definition");let t=Ti.get(e);return t?(zr(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Ti.set(e,t),t)}class Ai{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ai.type="NONE";const Ri=Ai;function Ii(e,t,n){return`firebase:${e}:${t}:${n}`}class xi{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Ii(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ii("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await di(this.auth,{idToken:e}).catch((()=>{}));return t?Si._fromGetAccountInfoResponse(this.auth,t,e):null}return Si._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new xi(Ci(Ri),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Ci(Ri);const o=Ii(n,e.config.apiKey,e.name);let s=null;for(const l of t)try{const t=await l._get(o);if(t){let n;if("string"===typeof t){const r=await di(e,{idToken:t}).catch((()=>{}));if(!r)break;n=await Si._fromGetAccountInfoResponse(e,r,t)}else n=Si._fromJSON(e,t);l!==i&&(s=n),i=l;break}}catch(c){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],s&&await i._set(o,s.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(o)}catch(c){}}))),new xi(i,e,n)):new xi(i,e,n)}}function Oi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Di(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ki(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Mi(t))return"Blackberry";if(ji(t))return"Webos";if(Ni(t))return"Safari";if((t.includes("chrome/")||Pi(t))&&!t.includes("edge/"))return"Chrome";if(Li(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function ki(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/firefox\//i.test(e)}function Ni(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Pi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/crios\//i.test(e)}function Di(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/iemobile/i.test(e)}function Li(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/android/i.test(e)}function Mi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/blackberry/i.test(e)}function ji(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/webos/i.test(e)}function Ui(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Vi(){return function(){const e=Rt();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Fi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt();return Ui(e)||Li(e)||ji(e)||Mi(e)||/windows phone/i.test(e)||Di(e)}function Bi(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Oi(Rt());break;case"Worker":t=`${Oi(Rt())}-${e}`;break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return`${t}/JsCore/${gr}/${r}`}class Wi{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(JS){r(JS)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(JS){t.reverse();for(const n of t)try{n()}catch(DT){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===JS||void 0===JS?void 0:JS.message})}}}class zi{constructor(e){var t,n,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=o.minPasswordLength)&&void 0!==t?t:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,o,s;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNumericCharacter)||void 0===o||o),a.isValid&&(a.isValid=null===(s=a.containsNonAlphanumericCharacter)||void 0===s||s),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Hi{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new qi(this),this.idTokenSubscription=new qi(this),this.beforeStateQueue=new Wi(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pr,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ci(t)),this._initializationPromise=this.queue((async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await xi.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(JS){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await di(this,{idToken:e}),n=await Si._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(pr(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,o=null===r||void 0===r?void 0:r._redirectEventId,s=await this.tryRedirectSignIn(e);n&&n!==o||!(null===s||void 0===s?void 0:s.user)||(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(JS){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(JS)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Br(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(JS){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _i(e)}catch(JS){if("auth/network-request-failed"!==(null===JS||void 0===JS?void 0:JS.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(pr(this.app))return Promise.reject(Vr(this));const t=e?Zt(e):null;return t&&Br(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&Br(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return pr(this.app)?Promise.reject(Vr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return pr(this.app)?Promise.reject(Vr(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Ci(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return ti(e,"GET","/v2/passwordPolicy",ei(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new zi(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Dt("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return ti(e,"POST","/v2/accounts:revokeToken",ei(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ci(e)||this._popupRedirectResolver;Br(t,this,"argument-error"),this.redirectPersistenceManager=await xi.create(this,[Ci(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let o=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Br(s,this,"internal-error"),s.then((()=>{o||i(this.currentUser)})),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{o=!0,i()}}{const n=e.addObserver(t);return()=>{o=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Br(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Bi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(pr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Dr.logLevel<=an.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Dr.warn(`Auth (${gr}): ${e}`,...n)}}(`Error while retrieving App Check token: ${t.error}`),null===t||void 0===t?void 0:t.token}}function Gi(e){return Zt(e)}class qi{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Yt(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Br(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ki={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function $i(e){return Ki.loadJS(e)}function Yi(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Xi{constructor(){this.enterprise=new Ji}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Ji{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Qi="NO_RECAPTCHA";class Zi{constructor(e){this.type="recaptcha-enterprise",this.auth=Gi(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;ci(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(Qi)}))})):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Xi).execute("siteKey",{action:"verify"})}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{ui(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new li(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&ci(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Ki.recaptchaEnterpriseScript;0!==t.length&&(t+=i),$i(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function eo(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=new Zi(e);let s;if(i)s=Qi;else try{s=await o.verify(n)}catch(k_){s=await o.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function to(e,t,n,r,i){var o,s;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await eo(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await eo(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}if("PHONE_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("PHONE_PROVIDER")){const i=await eo(e,t,n);return r(e,i).catch((async i=>{var o;if("AUDIT"===(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await eo(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)}))}{const i=await eo(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function no(e){const t=Gi(e),n=await ui(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new li(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new Zi(t).verify()}}function ro(e,t,n){const r=Gi(e);Br(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),o=io(t),{host:s,port:a}=function(e){const t=io(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:oo(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:oo(t)}}}(t),c={url:`${o}//${s}${null===a?"":`:${a}`}/`},l=Object.freeze({host:s,port:a,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return Br(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void Br(zt(c,r.config.emulator)&&zt(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=c,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function io(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function oo(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class so{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Wr("not implemented")}_getIdTokenResponse(e){return Wr("not implemented")}_linkToIdToken(e,t){return Wr("not implemented")}_getReauthenticationResolver(e){return Wr("not implemented")}}async function ao(e,t){return ti(e,"POST","/v1/accounts:signUp",t)}async function co(e,t){return ri(e,"POST","/v1/accounts:signInWithPassword",ei(e,t))}async function lo(e,t){return ti(e,"POST","/v1/accounts:sendOobCode",ei(e,t))}async function uo(e,t){return lo(e,t)}class ho extends so{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ho(e,t,"password")}static _fromEmailAndCode(e,t){return new ho(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return to(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",co,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return ri(e,"POST","/v1/accounts:signInWithEmailLink",ei(e,t))}(e,{email:this._email,oobCode:this._password});default:Mr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return to(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ao,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return ri(e,"POST","/v1/accounts:signInWithEmailLink",ei(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Mr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function po(e,t){return ri(e,"POST","/v1/accounts:signInWithIdp",ei(e,t))}class fo extends so{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new fo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Mr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Or(t,["providerId","signInMethod"]);if(!n||!r)return null;const o=new fo(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return po(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,po(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,po(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Gt(t)}return e}}async function mo(e,t){return ti(e,"POST","/v1/accounts:sendVerificationCode",ei(e,t))}const go={USER_NOT_FOUND:"user-not-found"};class vo extends so{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new vo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new vo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ri(e,"POST","/v1/accounts:signInWithPhoneNumber",ei(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ri(e,"POST","/v1/accounts:signInWithPhoneNumber",ei(e,t));if(n.temporaryProof)throw ai(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ri(e,"POST","/v1/accounts:signInWithPhoneNumber",ei(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),go)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new vo({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class yo{constructor(e){var t,n,r,i,o,s;const a=qt(Kt(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Br(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(o=a.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=a.tenantId)&&void 0!==s?s:null}static parseLink(e){const t=function(e){const t=qt(Kt(e)).link,n=t?qt(Kt(t)).deep_link_id:null,r=qt(Kt(e)).deep_link_id;return(r?qt(Kt(r)).link:null)||r||n||t||e}(e);try{return new yo(t)}catch(n){return null}}}class _o{constructor(){this.providerId=_o.PROVIDER_ID}static credential(e,t){return ho._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=yo.parseLink(t);return Br(n,"argument-error"),ho._fromEmailAndCode(e,n.code,n.tenantId)}}_o.PROVIDER_ID="password",_o.EMAIL_PASSWORD_SIGN_IN_METHOD="password",_o.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Eo{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class bo extends Eo{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class wo extends bo{constructor(){super("facebook.com")}static credential(e){return fo._fromParams({providerId:wo.PROVIDER_ID,signInMethod:wo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wo.credentialFromTaggedObject(e)}static credentialFromError(e){return wo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return wo.credential(t.oauthAccessToken)}catch(n){return null}}}wo.FACEBOOK_SIGN_IN_METHOD="facebook.com",wo.PROVIDER_ID="facebook.com";class So extends bo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fo._fromParams({providerId:So.PROVIDER_ID,signInMethod:So.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return So.credentialFromTaggedObject(e)}static credentialFromError(e){return So.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return So.credential(n,r)}catch(i){return null}}}So.GOOGLE_SIGN_IN_METHOD="google.com",So.PROVIDER_ID="google.com";class To extends bo{constructor(){super("github.com")}static credential(e){return fo._fromParams({providerId:To.PROVIDER_ID,signInMethod:To.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return To.credentialFromTaggedObject(e)}static credentialFromError(e){return To.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return To.credential(t.oauthAccessToken)}catch(n){return null}}}To.GITHUB_SIGN_IN_METHOD="github.com",To.PROVIDER_ID="github.com";class Co extends bo{constructor(){super("twitter.com")}static credential(e,t){return fo._fromParams({providerId:Co.PROVIDER_ID,signInMethod:Co.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Co.credentialFromTaggedObject(e)}static credentialFromError(e){return Co.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return Co.credential(n,r)}catch(i){return null}}}async function Ao(e,t){return ri(e,"POST","/v1/accounts:signUp",ei(e,t))}Co.TWITTER_SIGN_IN_METHOD="twitter.com",Co.PROVIDER_ID="twitter.com";class Ro{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Si._fromIdTokenResponse(e,n,r),o=Io(n);return new Ro({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Io(n);return new Ro({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Io(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class xo extends Pt{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,xo.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new xo(e,t,n,r)}}function Oo(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw xo._fromErrorAndOperation(e,n,t,r);throw n}))}async function ko(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await gi(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Ro._forOperation(e,"link",r)}async function No(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(pr(r.app))return Promise.reject(Vr(r));const i="reauthenticate";try{const o=await gi(e,Oo(r,i,t,e),n);Br(o.idToken,r,"internal-error");const s=fi(o.idToken);Br(s,r,"internal-error");const{sub:a}=s;return Br(e.uid===a,r,"user-mismatch"),Ro._forOperation(e,i,o)}catch(JS){throw"auth/user-not-found"===(null===JS||void 0===JS?void 0:JS.code)&&Mr(r,"user-mismatch"),JS}}async function Po(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(pr(e.app))return Promise.reject(Vr(e));const r="signIn",i=await Oo(e,r,t),o=await Ro._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(o.user),o}async function Do(e,t){return Po(Gi(e),t)}async function Lo(e,t){return No(Zt(e),t)}function Mo(e,t,n){var r;Br((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),Br("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),Br("undefined"===typeof n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Br(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(Br(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function jo(e){const t=Gi(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Uo(e,t){const n=Zt(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Mo(n.auth,r,t);const{email:i}=await async function(e,t){return lo(e,t)}(n.auth,r);i!==e.email&&await e.reload()}async function Vo(e,t){let{displayName:n,photoURL:r}=t;if(void 0===n&&void 0===r)return;const i=Zt(e),o={idToken:await i.getIdToken(),displayName:n,photoUrl:r,returnSecureToken:!0},s=await gi(i,async function(e,t){return ti(e,"POST","/v1/accounts:update",t)}(i.auth,o));i.displayName=s.displayName||null,i.photoURL=s.photoUrl||null;const a=i.providerData.find((e=>{let{providerId:t}=e;return"password"===t}));a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(s)}function Fo(e,t,n,r){return Zt(e).onAuthStateChanged(t,n,r)}function Bo(e){return Zt(e).signOut()}function Wo(e,t){return ti(e,"POST","/v2/accounts/mfaEnrollment:start",ei(e,t))}new WeakMap;const zo="__sak";class Ho{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zo,"1"),this.storage.removeItem(zo),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Go extends Ho{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Fi(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);Vi()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Go.type="LOCAL";const qo=Go;function Ko(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp(`${r}=([^;]+)`);return null!==(n=null===(t=document.cookie.match(i))||void 0===t?void 0:t[1])&&void 0!==n?n:null}function $o(e){return`${"http:"===window.location.protocol?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}class Yo{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=$o(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return Ko(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=$o(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch((()=>{}))}_addListener(e,t){if(!this._isAvailable())return;const n=$o(e);if(window.cookieStore){const e=e=>{const r=e.changed.find((e=>e.name===n));r&&t(r.value);e.deleted.find((e=>e.name===n))&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=Ko(n);const i=setInterval((()=>{const e=Ko(n);e!==r&&(t(e),r=e)}),1e3);this.listenerUnsubscribes.set(t,(()=>clearInterval(i)))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Yo.type="COOKIE";class Xo extends Ho{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Xo.type="SESSION";const Jo=Xo;class Qo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Qo(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(null===o||void 0===o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const s=Array.from(o).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(s);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Zo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Qo.receivers=[];class es{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise(((s,a)=>{const c=Zo("",20);r.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);o={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),s(t.data.response);break;default:clearTimeout(l),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function ts(){return window}function ns(){return"undefined"!==typeof ts().WorkerGlobalScope&&"function"===typeof ts().importScripts}const rs="firebaseLocalStorageDb",is="firebaseLocalStorage",os="fbase_key";class ss{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function as(e,t){return e.transaction([is],t?"readwrite":"readonly").objectStore(is)}function cs(){const e=indexedDB.open(rs,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(is,{keyPath:os})}catch(JS){n(JS)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(is)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(rs);return new ss(e).toPromise()}(),t(await cs()))}))}))}async function ls(e,t,n){const r=as(e,!0).put({[os]:t,value:n});return new ss(r).toPromise()}function us(e,t){const n=as(e,!0).delete(t);return new ss(n).toPromise()}class ds{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await cs()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(JS){if(t++>3)throw JS;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ns()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qo._getInstance(ns()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new es(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await cs();return await ls(e,zo,"1"),await us(e,zo),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>ls(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=as(e,!1).get(t),r=await new ss(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>us(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=as(e,!1).getAll();return new ss(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ds.type="LOCAL";const hs=ds;function ps(e,t){return ti(e,"POST","/v2/accounts/mfaSignIn:start",ei(e,t))}Yi("rcb"),new $r(3e4,6e4);const fs="recaptcha";async function ms(e,t,n){var r;if(!e._getRecaptchaConfig())try{await no(e)}catch(k_){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){Br("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},o=to(e,r,"mfaSmsEnrollment",(async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Qi){Br((null===n||void 0===n?void 0:n.type)===fs,e,"argument-error");return Wo(e,await gs(e,t,n))}return Wo(e,t)}),"PHONE_PROVIDER"),s=await o.catch((e=>Promise.reject(e)));return s.phoneSessionInfo.sessionInfo}{Br("signin"===t.type,e,"internal-error");const o=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;Br(o,e,"missing-multi-factor-info");const s={mfaPendingCredential:t.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=to(e,s,"mfaSmsSignIn",(async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Qi){Br((null===n||void 0===n?void 0:n.type)===fs,e,"argument-error");return ps(e,await gs(e,t,n))}return ps(e,t)}),"PHONE_PROVIDER"),c=await a.catch((e=>Promise.reject(e)));return c.phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=to(e,t,"sendVerificationCode",(async(e,t)=>{if(t.captchaResponse===Qi){Br((null===n||void 0===n?void 0:n.type)===fs,e,"argument-error");return mo(e,await gs(e,t,n))}return mo(e,t)}),"PHONE_PROVIDER"),o=await r.catch((e=>Promise.reject(e)));return o.sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function gs(e,t,n){Br(n.type===fs,e,"argument-error");const r=await n.verify();Br("string"===typeof r,e,"argument-error");const i=Object.assign({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,o=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:o}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class vs{constructor(e){this.providerId=vs.PROVIDER_ID,this.auth=Gi(e)}verifyPhoneNumber(e,t){return ms(this.auth,e,Zt(t))}static credential(e,t){return vo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return vs.credentialFromTaggedObject(t)}static credentialFromError(e){return vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?vo._fromTokenResponse(n,r):null}}function ys(e,t){return t?Ci(t):(Br(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}vs.PROVIDER_ID="phone",vs.PHONE_SIGN_IN_METHOD="phone";class _s extends so{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return po(e,this._buildIdpRequest())}_linkToIdToken(e,t){return po(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return po(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Es(e){return Po(e.auth,new _s(e),e.bypassAuthState)}function bs(e){const{auth:t,user:n}=e;return Br(n,t,"internal-error"),No(n,new _s(e),e.bypassAuthState)}async function ws(e){const{auth:t,user:n}=e;return Br(n,t,"internal-error"),ko(n,new _s(e),e.bypassAuthState)}class Ss{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(JS){this.reject(JS)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:o,type:s}=e;if(o)return void this.reject(o);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(a))}catch(JS){this.reject(JS)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Es;case"linkViaPopup":case"linkViaRedirect":return ws;case"reauthViaPopup":case"reauthViaRedirect":return bs;default:Mr(this.auth,"internal-error")}}resolve(e){zr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){zr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ts=new $r(2e3,1e4);class Cs extends Ss{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Cs.currentPopupAction&&Cs.currentPopupAction.cancel(),Cs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Br(e,this.auth,"internal-error"),e}async onExecution(){zr(1===this.filter.length,"Popup operations only handle one event");const e=Zo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(jr(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(jr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Cs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(jr(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Ts.get())};e()}}Cs.currentPopupAction=null;const As=new Map;class Rs extends Ss{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=As.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Os(t),r=xs(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(JS){e=()=>Promise.reject(JS)}As.set(this.auth._key(),e)}return this.bypassAuthState||As.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Is(e,t){As.set(e._key(),t)}function xs(e){return Ci(e._redirectPersistence)}function Os(e){return Ii("pendingRedirect",e.config.apiKey,e.name)}async function ks(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(pr(e.app))return Promise.reject(Vr(e));const r=Gi(e),i=ys(r,t),o=new Rs(r,i,n),s=await o.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}class Ns{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ds(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Ds(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(jr(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ps(e))}saveEventToCache(e){this.cachedEventUids.add(Ps(e)),this.lastProcessedEventTime=Date.now()}}function Ps(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Ds(e){let{type:t,error:n}=e;return"unknown"===t&&"auth/no-auth-event"===(null===n||void 0===n?void 0:n.code)}const Ls=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ms=/^https?/;async function js(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return ti(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(Us(r))return}catch(n){}Mr(e,"unauthorized-domain")}function Us(e){const t=Hr(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Ms.test(n))return!1;if(Ls.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Vs=new $r(3e4,6e4);function Fs(){const e=ts().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Bs(e){return new Promise(((t,n)=>{var r,i,o;function s(){Fs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Fs(),n(jr(e,"network-request-failed"))},timeout:Vs.get()})}if(null===(i=null===(r=ts().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(o=ts().gapi)||void 0===o?void 0:o.load)){const t=Yi("iframefcb");return ts()[t]=()=>{gapi.load?s():n(jr(e,"network-request-failed"))},$i(`${Ki.gapiScript}?onload=${t}`).catch((e=>n(e)))}s()}})).catch((e=>{throw Ws=null,e}))}let Ws=null;const zs=new $r(5e3,15e3),Hs={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Gs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function qs(e){const t=e.config;Br(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Yr(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:gr},i=Gs.get(e.config.apiHost);i&&(r.eid=i);const o=e._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Gt(r).slice(1)}`}async function Ks(e){const t=await function(e){return Ws=Ws||Bs(e),Ws}(e),n=ts().gapi;return Br(n,e,"internal-error"),t.open({where:document.body,url:qs(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Hs,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=jr(e,"network-request-failed"),o=ts().setTimeout((()=>{r(i)}),zs.get());function s(){ts().clearTimeout(o),n(t)}t.ping(s).then(s,(()=>{r(i)}))}))))}const $s={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ys{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(JS){}}}function Xs(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},$s),{width:r.toString(),height:i.toString(),top:o,left:s}),l=Rt().toLowerCase();n&&(a=Pi(l)?"_blank":n),ki(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce(((e,t)=>{let[n,r]=t;return`${e}${n}=${r},`}),"");if(function(){var e;return Ui(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Ys(null);const d=window.open(t||"",a,u);Br(d,e,"popup-blocked");try{d.focus()}catch(JS){}return new Ys(d)}const Js="__/auth/handler",Qs="emulator/auth/handler",Zs=encodeURIComponent("fac");async function ea(e,t,n,r,i,o){Br(e.config.authDomain,e,"auth-domain-config-required"),Br(e.config.apiKey,e,"invalid-api-key");const s={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:gr,eventId:i};if(t instanceof Eo){t.setDefaultLanguage(e.languageCode),s.providerId=t.providerId||"",Bt(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))s[e]=t}if(t instanceof bo){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(s.scopes=e.join(","))}e.tenantId&&(s.tid=e.tenantId);const a=s;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const c=await e._getAppCheckToken(),l=c?`#${Zs}=${encodeURIComponent(c)}`:"";return`${function(e){let{config:t}=e;if(!t.emulator)return`https://${t.authDomain}/${Js}`;return Yr(t,Qs)}(e)}?${Gt(a).slice(1)}${l}`}const ta="webStorageSupport";const na=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Jo,this._completeRedirectFn=ks,this._overrideRedirectResult=Is}async _openPopup(e,t,n,r){var i;zr(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Xs(e,await ea(e,t,n,Hr(),r),Zo())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){ts().location.href=e}(await ea(e,t,n,Hr(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(zr(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await Ks(e),n=new Ns(e);return t.register("authEvent",(t=>{Br(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ta,{type:ta},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[ta];void 0!==i&&t(!!i),Mr(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=js(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Fi()||Ni()||Ui()}};var ra="@firebase/auth",ia="1.10.0";class oa{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Br(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const sa=Tt("authIdTokenMaxAge")||300;let aa=null;var ca;!function(e){Ki=e}({loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=jr("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),ca="Browser",dr(new en("auth",((e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options;Br(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:s,authDomain:a,clientPlatform:ca,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Bi(ca)},l=new Hi(r,i,o,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ci);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),dr(new en("auth-internal",(e=>(e=>new oa(e))(Gi(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),_r(ra,ia,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(ca)),_r(ra,ia,"esm2017");var la,ua,da="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},ha={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var o=e.g[3],s=t+(o^n&(i^o))+r[0]+3614090360&4294967295;s=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=n+(s<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[3]+3250441966&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[4]+4118548399&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[7]+4249261313&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[8]+1770035416&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[11]+2304563134&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[12]+1804603682&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[15]+1236535329&4294967295)<<22&4294967295|s>>>10))+((s=t+(i^o&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[11]+643717713&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[0]+3921069994&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[15]+3634488961&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[4]+3889429448&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[3]+4107603335&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[8]+1163531501&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[7]+1735328473&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[12]+2368359562&4294967295)<<20&4294967295|s>>>12))+((s=t+(n^i^o)+r[5]+4294588738&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[14]+4259657740&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[1]+2763975236&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[10]+3200236656&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[13]+681279174&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[6]+76029189&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[9]+3654602809&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[15]+530742520&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[2]+3299628645&4294967295)<<23&4294967295|s>>>9))+((s=t+(i^(n|~o))+r[0]+4096336452&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[14]+2878612391&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~o))+r[12]+1700485571&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[10]+4293915773&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~o))+r[8]+1873313359&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[6]+2734768916&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|s>>>11))+((o=(t=n+((s=t+(i^(n|~o))+r[4]+4149444226&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|s>>>22))^((i=o+((s=i+(t^(o|~n))+r[2]+718787259&4294967295)<<15&4294967295|s>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+o&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var o=0|e[i];r&&o==t||(n[i]=o,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,o=this.h,s=0;s<t;){if(0==o)for(;s<=r;)n(this,e,s),s+=this.blockSize;if("string"===typeof e){for(;s<t;)if(i[o++]=e.charCodeAt(s++),o==this.blockSize){n(this,i),o=0;break}}else for(;s<t;)if(i[o++]=e[s++],o==this.blockSize){n(this,i),o=0;break}}this.h=o,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function o(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new r([0|e],0>e?-1:0)})):new r([0|e],0>e?-1:0)}function s(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return h(s(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var a=o(0),c=o(1),l=o(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function p(e,t){return e.add(h(t))}function f(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(a,a);if(d(e))return t=g(h(e),t),new m(h(t.g),h(t.h));if(d(t))return t=g(e,h(t)),new m(h(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=v(n),r=v(r);var i=y(n,1),o=y(r,1);for(r=y(r,2),n=y(n,2);!u(r);){var l=o.add(r);0>=l.l(e)&&(i=i.add(n),o=l),r=y(r,1),n=y(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),l=(o=s(n)).j(t);d(l)||0<l.l(e);)l=(o=s(n-=r)).j(t);u(o)&&(o=c),i=i.add(o),e=p(e,l)}return new m(i,e)}function v(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function y(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,o=[],s=0;s<i;s++)o[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new r(o,e.h)}(e=r.prototype).m=function(){if(d(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(d(this))return"-"+h(this).toString(e);for(var t=s(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,o=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=i))return o+r;for(;6>o.length;)o="0"+o;r=o+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=p(this,e))?-1:u(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,o=0;o<=t;o++){var s=i+(65535&this.i(o))+(65535&e.i(o)),a=(s>>>16)+(this.i(o)>>>16)+(e.i(o)>>>16);i=a>>>16,s&=65535,a&=65535,n[o]=a<<16|s}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(0>this.l(l)&&0>e.l(l))return s(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var o=0;o<e.g.length;o++){var c=this.i(i)>>>16,p=65535&this.i(i),m=e.i(o)>>>16,g=65535&e.i(o);n[2*i+2*o]+=p*g,f(n,2*i+2*o),n[2*i+2*o+1]+=c*g,f(n,2*i+2*o+1),n[2*i+2*o+1]+=p*m,f(n,2*i+2*o+1),n[2*i+2*o+2]+=c*m,f(n,2*i+2*o+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,ua=ha.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=s,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=s(Math.pow(n,8)),i=a,o=0;o<t.length;o+=8){var c=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+c),n);8>c?(c=s(Math.pow(n,c)),i=i.j(c).add(s(l))):i=(i=i.j(r)).add(s(l))}return i},la=ha.Integer=r}).apply("undefined"!==typeof da?da:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var pa,fa,ma,ga,va,ya,_a,Ea,ba="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},wa={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ba&&ba];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var o=0;o<e.length-1;o++){var s=e[o];if(!(s in i))break e;i=i[s]}(r=r(o=i[e=e[e.length-1]]))!=o&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function s(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(o(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function f(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var v=-1!=m().indexOf("Gecko")&&!(-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge"))&&!(-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE"))&&-1==m().indexOf("Edge");function y(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function _(e){const t={};for(const n in e)t[n]=e[n];return t}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<E.length;t++)n=E[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function w(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){i.setTimeout((()=>{throw e}),0)}function T(){var e=x;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var C=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new A),(e=>e.reset()));class A{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let R,I=!1,x=new class{constructor(){this.h=this.g=null}add(e,t){const n=C.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const e=i.Promise.resolve(void 0);R=()=>{e.then(k)}};var k=()=>{for(var e;e=T();){try{e.h.call(e.g)}catch(rT){S(rT)}var t=C;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}I=!1};function N(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(rT){}return e}();function L(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(v){e:{try{g(t.nodeName);var i=!0;break e}catch(cT){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}d(L,P);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var j="closure_listenable_"+(1e6*Math.random()|0),U=0;function V(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++U,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function W(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],o=Array.prototype.indexOf.call(i,t,void 0);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.da&&o.listener==t&&o.capture==!!n&&o.ha==r)return i}return-1}B.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.g[o])||(e=this.g[o]=[],this.h++);var s=z(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):((t=new V(t,this.src,o,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),G={};function q(e,t,n,r,i){if(r&&r.once)return $(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)q(e,t[o],n,r,i);return null}return n=te(n),e&&e[j]?e.K(t,n,s(r)?!!r.capture:!!r,i):K(e,t,n,!1,r,i)}function K(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=s(i)?!!i.capture:!!i,c=Z(e);if(c||(e[H]=c=new B(e)),(n=c.add(t,n,r,a,o)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=Q;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)D||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function $(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)$(e,t[o],n,r,i);return null}return n=te(n),e&&e[j]?e.L(t,n,s(r)?!!r.capture:!!r,i):K(e,t,n,!0,r,i)}function Y(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)Y(e,t[o],n,r,i);else r=s(r)?!!r.capture:!!r,n=te(n),e&&e[j]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=z(o=e.g[t],n,r,i))&&(F(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.g[t],e.h--)))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,r,i)),(n=-1<e?t[e]:null)&&X(n))}function X(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[j])W(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(J(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Z(t))?(W(n,e),0==n.h&&(n.src=null,t[H]=null)):F(e)}}}function J(e){return e in G?G[e]:G[e]="on"+e}function Q(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&X(e),e=n.call(r,t)}return e}function Z(e){return(e=e[H])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){N.call(this),this.i=new B(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;b(t=new P(r,e),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=ie(s,r,!0,t)&&i}if(i=ie(s=t.g=e,r,!0,t)&&i,i=ie(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)i=ie(s=t.g=n[o],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.da&&s.capture==n){var a=s.listener,c=s.ha||s.src;s.fa&&W(e.i,s),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function oe(e,t,n){if("function"===typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function se(e){e.g=oe((()=>{e.g=null,e.i&&(e.i=!1,se(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(ne,N),ne.prototype[j]=!0,ne.prototype.removeEventListener=function(e,t,n,r){Y(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)F(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ae extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:se(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){N.call(this),this.h=e,this.g={}}d(ce,N);var le=[];function ue(e){y(e.g,(function(e,t){this.g.hasOwnProperty(t)&&X(e)}),e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),ue(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=i.JSON.stringify,he=i.JSON.parse,pe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function fe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}fe.prototype.h=null;var ve={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ye(){P.call(this,"d")}function _e(){P.call(this,"c")}d(ye,P),d(_e,P);var Ee={},be=null;function we(){return be=be||new ne}function Se(e){P.call(this,Ee.La,e)}function Te(e){const t=we();re(t,new Se(t))}function Ce(e,t){P.call(this,Ee.STAT_EVENT,e),this.stat=t}function Ae(e){const t=we();re(t,new Ce(t,e))}function Re(e,t){P.call(this,Ee.Ma,e),this.size=t}function Ie(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function xe(){this.g=!0}function Oe(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return de(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}Ee.La="serverreachability",d(Se,P),Ee.STAT_EVENT="statevent",d(Ce,P),Ee.Ma="timingevent",d(Re,P),xe.prototype.xa=function(){this.g=!1},xe.prototype.info=function(){};var ke,Ne={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Le(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Me}function Me(){this.i=null,this.g="",this.h=!1}d(De,fe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},ke=new De;var je={},Ue={};function Ve(e,t,n){e.L=1,e.v=dt(st(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),ze(e),e.A=st(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Tt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Me,e.g=hn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(le[0]=i.toString()),i=le);for(var o=0;o<i.length;o++){var s=q(n,i[o],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}t=e.H?_(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Te(),function(e,t,n,r,i,o){e.info((function(){if(e.g)if(o)for(var s="",a=o.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");s=2<=d.length&&"type"==d[1]?s+(u+"=")+l+"&":s+(u+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+s}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function We(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ue:(n=Number(t.substring(n,r)),isNaN(n)?je:(r+=1)+n>t.length?Ue:(t=t.slice(r,r+n),e.C=r+n,t))}function ze(e){e.S=Date.now()+e.I,He(e,e.I)}function He(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ie(l(e.ba,e),t)}function Ge(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function qe(e){0==e.j.G||e.J||an(e.j,e)}function Ke(e){Ge(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function $e(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(ZS){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;sn(n),Yt(n)}nn(n),Ae(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ie(l(n.Za,n),6e3));if(1>=Qe(n.h)&&n.ca){try{n.ca()}catch(ZS){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&sn(n),!f(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=l[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=l[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var o=r.h;o.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(et(o,o.h),o.h=null))}if(r.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ut(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var s=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),s.K){tt(r.h,s);var a=s,c=r.L;c&&(a.I=c),a.B&&(Ge(a),ze(a)),r.g=s}else tn(r);0<n.i.length&&Jt(n)}else"stop"!=l[0]&&"close"!=l[0]||ln(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?ln(n,7):$t(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Te()}catch(ZS){}}Le.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Ht(e)?t.j():this.Y(e)},Le.prototype.Y=function(e){try{if(e==this.g)e:{const h=Ht(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Gt(this.g)))){this.J||4!=h||7==t||Te(),Ge(this);var n=this.g.Z();this.X=n;t:if(Be(this)){var r=Gt(this.g);e="";var o=r.length,s=4==Ht(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ke(this),qe(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<o;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==o-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,o,s){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+o+" "+s}))}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!f(c)){var u=c;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Ae(12),Ke(this),qe(this);break e}Oe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,$e(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=We(this,a),e==Ue){4==h&&(this.s=4,Ae(14),n=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(e==je){this.s=4,Ae(15),Oe(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Oe(this.i,this.l,e,null),$e(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=a.length||this.h.h||(this.s=1,Ae(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),rn(d),d.M=!0,Ae(11))}}else Oe(this.i,this.l,a,"[Invalid Chunked Response]"),Ke(this),qe(this)}else Oe(this.i,this.l,a,null),$e(this,a);4==h&&Ke(this),this.o&&!this.J&&(4==h?an(this.j,this):(this.o=!1,ze(this)))}else(function(e){const t={};e=(e.g&&2<=Ht(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(f(e[r]))continue;var n=w(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const o=t[i]||[];t[i]=o,o.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),Ke(this),qe(this)}}}catch(h){}},Le.prototype.cancel=function(){this.J=!0,Ke(this)},Le.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Te(),Ae(17)),Ke(this),this.s=2,qe(this)):He(this,this.S-e)};var Ye=class{constructor(e,t){this.g=e,this.map=t}};function Xe(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Je(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Qe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(o(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}Xe.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ot(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof ot){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new Et;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),lt(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,at(this,t[1]||"",!0),this.o=ht(t[2]||""),this.g=ht(t[3]||"",!0),ct(this,t[4]),this.l=ht(t[5]||"",!0),lt(this,t[6]||"",!0),this.m=ht(t[7]||"")):(this.h=!1,this.i=new Et(null,this.h))}function st(e){return new ot(e)}function at(e,t,n){e.j=n?ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function lt(e,t,n){t instanceof Et?(e.i=t,function(e,t){t&&!e.j&&(bt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(wt(this,t),Tt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=pt(t,yt)),e.i=new Et(t,e.h))}function ut(e,t,n){e.i.set(t,n)}function dt(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function pt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,ft),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ft(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ot.prototype.toString=function(){var e=[],t=this.j;t&&e.push(pt(t,mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(pt(t,mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(pt(n,"/"==n.charAt(0)?vt:gt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",pt(n,_t)),e.join("")};var mt=/[#\/\?@]/g,gt=/[#\?:]/g,vt=/[#\?]/g,yt=/[#\?@]/g,_t=/#/g;function Et(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function bt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function wt(e,t){bt(e),t=Ct(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function St(e,t){return bt(e),t=Ct(e,t),e.g.has(t)}function Tt(e,t,n){wt(e,t),0<n.length&&(e.i=null,e.g.set(Ct(e,t),h(n)),e.h+=n.length)}function Ct(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function At(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(cT){}}function Rt(){this.g=new pe}function It(e,t,n){const r=n||"";try{rt(e,(function(e,n){let i=e;s(e)&&(i=de(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(JS){throw t.push(r+"type="+encodeURIComponent("_badmap")),JS}}function xt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Ot(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function kt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Nt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Pt(e)}function Pt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Dt(e){let t="";return y(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Lt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Dt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):ut(e,t,n))}function Mt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Et.prototype).add=function(e,t){bt(this),this.i=null,e=Ct(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){bt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){bt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){bt(this);let t=[];if("string"===typeof e)St(this,e)&&(t=t.concat(this.g.get(Ct(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return bt(this),this.i=null,St(this,e=Ct(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const o=encodeURIComponent(String(r)),s=this.V(r);for(r=0;r<s.length;r++){var i=o;""!==s[r]&&(i+="="+encodeURIComponent(String(s[r]))),e.push(i)}}return this.i=e.join("&")},d(xt,fe),xt.prototype.g=function(){return new Ot(this.l,this.j)},xt.prototype.i=function(e){return function(){return e}}({}),d(Ot,ne),(e=Ot.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Pt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Nt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pt(this)),this.g&&(this.readyState=3,Pt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;kt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Nt(this):Pt(this),3==this.readyState&&kt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Nt(this))},e.Qa=function(e){this.g&&(this.response=e,Nt(this))},e.ga=function(){this.g&&Nt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ot.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Mt,ne);var jt=/^https?$/i,Ut=["POST","PUT"];function Vt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),Wt(e)}function Ft(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function Bt(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=Ht(e)||2!=e.Z()))if(e.u&&4==Ht(e))oe(e.Ea,0,e);else if(re(e,"readystatechange"),4==Ht(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var o;if(o=0===r){var s=String(e.D).match(it)[1]||null;!s&&i.self&&i.self.location&&(s=i.self.location.protocol.slice(0,-1)),o=!jt.test(s?s.toLowerCase():"")}n=o}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var a=2<Ht(e)?e.g.statusText:""}catch(c){a=""}e.l=a+" ["+e.Z()+"]",Ft(e)}}finally{Wt(e)}}}function Wt(e,t){if(e.g){zt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(JS){}}}function zt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Ht(e){return e.g?e.g.readyState:0}function Gt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(Ta){return null}}function qt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Kt(e){this.Aa=0,this.i=[],this.j=new xe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=qt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=qt("baseRetryDelayMs",5e3,e),this.cb=qt("retryDelaySeedMs",1e4,e),this.Wa=qt("forwardChannelMaxRetries",2,e),this.wa=qt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Xe(e&&e.concurrentRequestLimit),this.Da=new Rt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function $t(e){if(Xt(e),3==e.G){var t=e.U++,n=st(e.I);if(ut(n,"SID",e.K),ut(n,"RID",t),ut(n,"TYPE","terminate"),Zt(e,n),(t=new Le(e,e.j,t)).L=2,t.v=dt(st(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(aT){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=hn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ze(t)}un(e)}function Yt(e){e.g&&(rn(e),e.g.cancel(),e.g=null)}function Xt(e){Yt(e),e.u&&(i.clearTimeout(e.u),e.u=null),sn(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Jt(e){if(!Je(e.h)&&!e.s){e.s=!0;var t=e.Ga;R||O(),I||(R(),I=!0),x.add(t,e),e.B=0}}function Qt(e,t){var n;n=t?t.l:e.U++;const r=st(e.I);ut(r,"SID",e.K),ut(r,"RID",n),ut(r,"AID",e.T),Zt(e,r),e.m&&e.o&&Lt(r,e.m,e.o),n=new Le(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=en(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Ve(n,r,t)}function Zt(e,t){e.H&&y(e.H,(function(e,n){ut(t,n,e)})),e.l&&rt({},(function(e,n){ut(t,n,e)}))}function en(e,t,n){n=Math.min(e.i.length,n);var r=e.l?l(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g;const c=i[a].map;if(n-=t,0>n)t=Math.max(0,i[a].g-100),s=!1;else try{It(c,e,"req"+n+"_")}catch(o){r&&r(c)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function tn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;R||O(),I||(R(),I=!0),x.add(t,e),e.v=0}}function nn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ie(l(e.Fa,e),cn(e,e.v)),e.v++,!0)}function rn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function on(e){e.g=new Le(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=st(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),Zt(e,t),e.m&&e.o&&Lt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=dt(st(t)),n.m=null,n.P=!0,Fe(n,e)}function sn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function an(e,t){var n=null;if(e.g==t){sn(e),rn(e),e.g=null;var r=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=we(),new Re(r,n)),Jt(e)}else tn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Qe(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Ie(l(e.Ga,e,t),cn(e,e.B)),e.B++,!0))}(e,t)||2==r&&nn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function cn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),r=e.Xa;const t=!r;r=new ot(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||at(r,"https"),dt(r),t?function(e,t){const n=new xe;if(i.Image){const r=new Image;r.onload=u(At,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(At,n,"TestLoadImage: error",!1,t,r),r.onabort=u(At,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(At,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new xe;const n=new AbortController,r=setTimeout((()=>{n.abort(),At(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?At(0,0,!0,t):At(0,0,!1,t)})).catch((()=>{clearTimeout(r),At(0,0,!1,t)}))}(r.toString(),n)}else Ae(2);e.G=0,e.l&&e.l.sa(t),un(e),Xt(e)}function un(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof ot?st(n):new ot(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ct(r,r.s);else{var o=i.location;r=o.protocol,t=t?t+"."+o.hostname:o.hostname,o=+o.port;var s=new ot(null);r&&at(s,r),t&&(s.g=t),o&&ct(s,o),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&ut(r,n,t),ut(r,"VER",e.la),Zt(e,r),r}function hn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Mt(new xt({eb:n})):new Mt(e.pa)).Ha(e.J),t}function pn(){}function fn(){}function mn(e,t){ne.call(this),this.g=new Kt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!f(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!f(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new yn(this)}function gn(e){ye.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function vn(){_e.call(this),this.status=1}function yn(e){this.g=e}(e=Mt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ke.g(),this.v=this.o?me(this.o):me(ke),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(cT){return void Vt(this,cT)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var o in r)n.set(o,r[o]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),o=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ut,t,void 0))||r||o||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,s]of n)this.g.setRequestHeader(i,s);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zt(this),this.u=!0,this.g.send(e),this.u=!1}catch(cT){Vt(this,cT)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),Wt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Wt(this,!0)),Mt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Bt(this):this.bb())},e.bb=function(){Bt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Ht(this)?this.g.status:-1}catch(eT){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(eT){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Kt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ae(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Jt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Le(this,this.j,e);let o=this.o;if(this.S&&(o?(o=_(o),b(o,this.S)):o=this.S),null!==this.m||this.O||(i.H=o,o=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=en(this,i,t),ut(n=st(this.I),"RID",e),ut(n,"CVER",22),this.D&&ut(n,"X-HTTP-Session-Id",this.D),Zt(this,n),o&&(this.O?t="headers="+encodeURIComponent(String(Dt(o)))+"&"+t:this.m&&Lt(n,this.m,o)),et(this.h,i),this.Ua&&ut(n,"TYPE","init"),this.P?(ut(n,"$req",t),ut(n,"SID","null"),i.T=!0,Ve(i,n,null)):Ve(i,n,t),this.G=2}}else 3==this.G&&(e?Qt(this,e):0==this.i.length||Je(this.h)||Qt(this))},e.Fa=function(){if(this.u=null,on(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ie(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Yt(this),on(this))},e.Za=function(){null!=this.C&&(this.C=null,Yt(this),nn(this),Ae(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=pn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},fn.prototype.g=function(e,t){return new mn(e,t)},d(mn,ne),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){$t(this.g)},mn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=de(e),e=n);t.i.push(new Ye(t.Ya++,e)),3==t.G&&Jt(t)},mn.prototype.N=function(){this.g.l=null,delete this.j,$t(this.g),delete this.g,mn.aa.N.call(this)},d(gn,ye),d(vn,_e),d(yn,pn),yn.prototype.ua=function(){re(this.g,"a")},yn.prototype.ta=function(e){re(this.g,new gn(e))},yn.prototype.sa=function(e){re(this.g,new vn)},yn.prototype.ra=function(){re(this.g,"b")},fn.prototype.createWebChannel=fn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,Ea=wa.createWebChannelTransport=function(){return new fn},_a=wa.getStatEventTarget=function(){return we()},ya=wa.Event=Ee,va=wa.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,ga=wa.ErrorCode=Ne,Pe.COMPLETE="complete",ma=wa.EventType=Pe,ge.EventType=ve,ve.OPEN="a",ve.CLOSE="b",ve.ERROR="c",ve.MESSAGE="d",ne.prototype.listen=ne.prototype.K,fa=wa.WebChannel=ge,wa.FetchXmlHttpFactory=xt,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,pa=wa.XhrIo=Mt}).apply("undefined"!==typeof ba?ba:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const Sa="@firebase/firestore",Ta="4.7.10";class Ca{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ca.UNAUTHENTICATED=new Ca(null),Ca.GOOGLE_CREDENTIALS=new Ca("google-credentials-uid"),Ca.FIRST_PARTY=new Ca("first-party-uid"),Ca.MOCK_USER=new Ca("mock-user");let Aa="11.5.0";const Ra=new hn("@firebase/firestore");function Ia(){return Ra.logLevel}function xa(e){if(Ra.logLevel<=an.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Na);Ra.debug(`Firestore (${Aa}): ${e}`,...i)}}function Oa(e){if(Ra.logLevel<=an.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Na);Ra.error(`Firestore (${Aa}): ${e}`,...i)}}function ka(e){if(Ra.logLevel<=an.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Na);Ra.warn(`Firestore (${Aa}): ${e}`,...i)}}function Na(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(QS){return e}}function Pa(){const e=`FIRESTORE (${Aa}) INTERNAL ASSERTION FAILED: `+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state");throw Oa(e),new Error(e)}function Da(e,t){e||Pa()}function La(e,t){return e}const Ma={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ja extends Pt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ua{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Va{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fa{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ca.UNAUTHENTICATED)))}shutdown(){}}class Ba{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Wa{constructor(e){this.t=e,this.currentUser=Ca.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Da(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ua;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ua,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},s=e=>{xa("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((e=>s(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?s(e):(xa("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ua)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(xa("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Da("string"==typeof t.accessToken),new Va(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Da(null===e||"string"==typeof e),new Ca(e)}}class za{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ca.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Ha{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new za(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Ca.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ga{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qa{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,pr(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){Da(void 0===this.o);const n=e=>{null!=e.error&&xa("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,xa("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{xa("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):xa("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.V)return Promise.resolve(new Ga(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Da("string"==typeof e.token),this.R=e.token,new Ga(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ka(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}function $a(){return new TextEncoder}class Ya{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Ka(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Xa(e,t){return e<t?-1:e>t?1:0}function Ja(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return Xa(r,i);{const o=$a(),s=Za(o.encode(Qa(e,n)),o.encode(Qa(t,n)));return 0!==s?s:Xa(r,i)}}n+=r>65535?2:1}return Xa(e.length,t.length)}function Qa(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function Za(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return Xa(e[n],t[n]);return Xa(e.length,t.length)}function ec(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}const tc=-62135596800,nc=1e6;class rc{static now(){return rc.fromMillis(Date.now())}static fromDate(e){return rc.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*nc);return new rc(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ja(Ma.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ja(Ma.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<tc)throw new ja(Ma.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ja(Ma.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/nc}_compareTo(e){return this.seconds===e.seconds?Xa(this.nanoseconds,e.nanoseconds):Xa(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-tc;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ic{static fromTimestamp(e){return new ic(e)}static min(){return new ic(new rc(0,0))}static max(){return new ic(new rc(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const oc="__name__";class sc{constructor(e,t,n){void 0===t?t=0:t>e.length&&Pa(),void 0===n?n=e.length-t:n>e.length-t&&Pa(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sc.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sc?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=sc.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Xa(e.length,t.length)}static compareSegments(e,t){const n=sc.isNumericId(e),r=sc.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?sc.extractNumericId(e).compare(sc.extractNumericId(t)):Ja(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return la.fromString(e.substring(4,e.length-2))}}class ac extends sc{construct(e,t,n){return new ac(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new ja(Ma.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter((e=>e.length>0)))}return new ac(e)}static emptyPath(){return new ac([])}}const cc=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class lc extends sc{construct(e,t,n){return new lc(e,t,n)}static isValidIdentifier(e){return cc.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),lc.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===oc}static keyField(){return new lc([oc])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new ja(Ma.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new ja(Ma.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ja(Ma.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(o=!o,r++):"."!==t||o?(n+=t,r++):(i(),r++)}if(i(),o)throw new ja(Ma.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new lc(t)}static emptyPath(){return new lc([])}}class uc{constructor(e){this.path=e}static fromPath(e){return new uc(ac.fromString(e))}static fromName(e){return new uc(ac.fromString(e).popFirst(5))}static empty(){return new uc(ac.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ac.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ac.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new uc(new ac(e.slice()))}}const dc=-1;class hc{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}hc.UNKNOWN_ID=-1;function pc(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ic.fromTimestamp(1e9===r?new rc(n+1,0):new rc(n,r));return new mc(i,uc.empty(),t)}function fc(e){return new mc(e.readTime,e.key,dc)}class mc{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new mc(ic.min(),uc.empty(),dc)}static max(){return new mc(ic.max(),uc.empty(),dc)}}function gc(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=uc.comparator(e.documentKey,t.documentKey),0!==n?n:Xa(e.largestBatchId,t.largestBatchId))}const vc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function _c(e){if(e.code!==Ma.FAILED_PRECONDITION||e.message!==vc)throw e;xa("LocalStore","Unexpectedly lost primary lease")}class Ec{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Pa(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ec(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ec?t:Ec.resolve(t)}catch(e){return Ec.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ec.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ec.reject(t)}static resolve(e){return new Ec(((t,n)=>{t(e)}))}static reject(e){return new Ec(((t,n)=>{n(e)}))}static waitFor(e){return new Ec(((t,n)=>{let r=0,i=0,o=!1;e.forEach((e=>{++r,e.next((()=>{++i,o&&i===r&&t()}),(e=>n(e)))})),o=!0,i===r&&t()}))}static or(e){let t=Ec.resolve(!1);for(const n of e)t=t.next((e=>e?Ec.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Ec(((n,r)=>{const i=e.length,o=new Array(i);let s=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{o[c]=e,++s,s===i&&n(o)}),(e=>r(e)))}}))}static doWhile(e,t){return new Ec(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function bc(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function wc(e){return"IndexedDbTransactionError"===e.name}class Sc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}Sc.ae=-1;const Tc=-1;function Cc(e){return null==e}function Ac(e){return 0===e&&1/e==-1/0}function Rc(e){return"number"==typeof e&&Number.isInteger(e)&&!Ac(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Ic="\x01";function xc(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=kc(t)),t=Oc(e.get(n),t);return kc(t)}function Oc(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case Ic:n+="\x01\x11";break;default:n+=t}}return n}function kc(e){return e+Ic+"\x01"}const Nc="remoteDocuments",Pc="owner",Dc="mutationQueues",Lc="mutations";const Mc="documentMutations",jc="remoteDocumentsV14",Uc="remoteDocumentGlobal",Vc="targets",Fc="targetDocuments",Bc="targetGlobal",Wc="collectionParents",zc="clientMetadata",Hc="bundles",Gc="namedQueries",qc="indexConfiguration",Kc="indexState",$c="indexEntries",Yc="documentOverlays",Xc="globals",Jc=[Dc,Lc,Mc,Nc,Vc,Pc,Bc,Fc,zc,Uc,Wc,Hc,Gc],Qc=[Dc,Lc,Mc,jc,Vc,Pc,Bc,Fc,zc,Uc,Wc,Hc,Gc,Yc],Zc=Qc,el=[...Zc,qc,Kc,$c];function tl(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function nl(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function rl(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class il{constructor(e,t){this.comparator=e,this.root=t||sl.EMPTY}insert(e,t){return new il(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sl.BLACK,null,null))}remove(e){return new il(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ol(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ol(this.root,e,this.comparator,!1)}getReverseIterator(){return new ol(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ol(this.root,e,this.comparator,!0)}}class ol{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sl{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:sl.RED,this.left=null!=r?r:sl.EMPTY,this.right=null!=i?i:sl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new sl(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return sl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return sl.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,sl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,sl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Pa();if(this.right.isRed())throw Pa();const e=this.left.check();if(e!==this.right.check())throw Pa();return e+(this.isRed()?0:1)}}sl.EMPTY=null,sl.RED=!0,sl.BLACK=!1,sl.EMPTY=new class{constructor(){this.size=0}get key(){throw Pa()}get value(){throw Pa()}get color(){throw Pa()}get left(){throw Pa()}get right(){throw Pa()}copy(e,t,n,r,i){return this}insert(e,t,n){return new sl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class al{constructor(e){this.comparator=e,this.data=new il(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cl(this.data.getIterator())}getIteratorFrom(e){return new cl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof al))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new al(this.comparator);return t.data=e,t}}class cl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ll{constructor(e){this.fields=e,e.sort(lc.comparator)}static empty(){return new ll([])}unionWith(e){let t=new al(lc.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ll(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ec(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ul extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class dl{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ul("Invalid base64 string: "+e):e}}(e);return new dl(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new dl(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xa(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}dl.EMPTY_BYTE_STRING=new dl("");const hl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pl(e){if(Da(!!e),"string"==typeof e){let t=0;const n=hl.exec(e);if(Da(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:fl(e.seconds),nanos:fl(e.nanos)}}function fl(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ml(e){return"string"==typeof e?dl.fromBase64String(e):dl.fromUint8Array(e)}const gl="server_timestamp",vl="__type__",yl="__previous_value__",_l="__local_write_time__";function El(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[vl])||void 0===n?void 0:n.stringValue)===gl}function bl(e){const t=e.mapValue.fields[yl];return El(t)?bl(t):t}function wl(e){const t=pl(e.mapValue.fields[_l].timestampValue);return new rc(t.seconds,t.nanos)}class Sl{constructor(e,t,n,r,i,o,s,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=a,this.useFetchStreams=c}}const Tl="(default)";class Cl{constructor(e,t){this.projectId=e,this.database=t||Tl}static empty(){return new Cl("","")}get isDefaultDatabase(){return this.database===Tl}isEqual(e){return e instanceof Cl&&e.projectId===this.projectId&&e.database===this.database}}const Al="__type__",Rl="__max__",Il={mapValue:{fields:{__type__:{stringValue:Rl}}}},xl="__vector__",Ol="value";function kl(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?El(e)?4:$l(e)?9007199254740991:ql(e)?10:11:Pa()}function Nl(e,t){if(e===t)return!0;const n=kl(e);if(n!==kl(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return wl(e).isEqual(wl(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=pl(e.timestampValue),r=pl(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ml(e.bytesValue).isEqual(ml(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return fl(e.geoPointValue.latitude)===fl(t.geoPointValue.latitude)&&fl(e.geoPointValue.longitude)===fl(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return fl(e.integerValue)===fl(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=fl(e.doubleValue),r=fl(t.doubleValue);return n===r?Ac(n)===Ac(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ec(e.arrayValue.values||[],t.arrayValue.values||[],Nl);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(tl(n)!==tl(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Nl(n[i],r[i])))return!1;return!0}(e,t);default:return Pa()}}function Pl(e,t){return void 0!==(e.values||[]).find((e=>Nl(e,t)))}function Dl(e,t){if(e===t)return 0;const n=kl(e),r=kl(t);if(n!==r)return Xa(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Xa(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=fl(e.integerValue||e.doubleValue),r=fl(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ll(e.timestampValue,t.timestampValue);case 4:return Ll(wl(e),wl(t));case 5:return Ja(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ml(e),r=ml(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=Xa(n[i],r[i]);if(0!==e)return e}return Xa(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Xa(fl(e.latitude),fl(t.latitude));return 0!==n?n:Xa(fl(e.longitude),fl(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Ml(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,o;const s=e.fields||{},a=t.fields||{},c=null===(n=s[Ol])||void 0===n?void 0:n.arrayValue,l=null===(r=a[Ol])||void 0===r?void 0:r.arrayValue,u=Xa((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(o=null==l?void 0:l.values)||void 0===o?void 0:o.length)||0);return 0!==u?u:Ml(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Il.mapValue&&t===Il.mapValue)return 0;if(e===Il.mapValue)return 1;if(t===Il.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(let s=0;s<r.length&&s<o.length;++s){const e=Ja(r[s],o[s]);if(0!==e)return e;const t=Dl(n[r[s]],i[o[s]]);if(0!==t)return t}return Xa(r.length,o.length)}(e.mapValue,t.mapValue);default:throw Pa()}}function Ll(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Xa(e,t);const n=pl(e),r=pl(t),i=Xa(n.seconds,r.seconds);return 0!==i?i:Xa(n.nanos,r.nanos)}function Ml(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Dl(n[i],r[i]);if(e)return e}return Xa(n.length,r.length)}function jl(e){return Ul(e)}function Ul(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=pl(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ml(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return uc.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Ul(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Ul(e.fields[i])}`;return n+"}"}(e.mapValue):Pa()}function Vl(e){switch(kl(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=bl(e);return t?16+Vl(t):16;case 5:return 2*e.stringValue.length;case 6:return ml(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+Vl(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return nl(e.fields,((e,n)=>{t+=e.length+Vl(n)})),t}(e.mapValue);default:throw Pa()}}function Fl(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Bl(e){return!!e&&"integerValue"in e}function Wl(e){return!!e&&"arrayValue"in e}function zl(e){return!!e&&"nullValue"in e}function Hl(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Gl(e){return!!e&&"mapValue"in e}function ql(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[Al])||void 0===n?void 0:n.stringValue)===xl}function Kl(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return nl(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Kl(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Kl(e.arrayValue.values[n]);return t}return Object.assign({},e)}function $l(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Rl}class Yl{constructor(e){this.value=e}static empty(){return new Yl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Gl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Kl(t)}setAll(e){let t=lc.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Kl(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Gl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Gl(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){nl(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new Yl(Kl(this.value))}}function Xl(e){const t=[];return nl(e.fields,((e,n)=>{const r=new lc([e]);if(Gl(n)){const e=Xl(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new ll(t)}class Jl{constructor(e,t,n,r,i,o,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=o,this.documentState=s}static newInvalidDocument(e){return new Jl(e,0,ic.min(),ic.min(),ic.min(),Yl.empty(),0)}static newFoundDocument(e,t,n,r){return new Jl(e,1,t,ic.min(),n,r,0)}static newNoDocument(e,t){return new Jl(e,2,t,ic.min(),ic.min(),Yl.empty(),0)}static newUnknownDocument(e,t){return new Jl(e,3,t,ic.min(),ic.min(),Yl.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ic.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ic.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Jl&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ql{constructor(e,t){this.position=e,this.inclusive=t}}function Zl(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const o=t[i],s=e.position[i];if(r=o.field.isKeyField()?uc.comparator(uc.fromName(s.referenceValue),n.key):Dl(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return r}function eu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Nl(e.position[n],t.position[n]))return!1;return!0}class tu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function nu(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ru{}class iu extends ru{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new hu(e,t,n):"array-contains"===t?new gu(e,n):"in"===t?new vu(e,n):"not-in"===t?new yu(e,n):"array-contains-any"===t?new _u(e,n):new iu(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new pu(e,n):new fu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Dl(t,this.value)):null!==t&&kl(this.value)===kl(t)&&this.matchesComparison(Dl(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Pa()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ou extends ru{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new ou(e,t)}matches(e){return su(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function su(e){return"and"===e.op}function au(e){return cu(e)&&su(e)}function cu(e){for(const t of e.filters)if(t instanceof ou)return!1;return!0}function lu(e){if(e instanceof iu)return e.field.canonicalString()+e.op.toString()+jl(e.value);if(au(e))return e.filters.map((e=>lu(e))).join(",");{const t=e.filters.map((e=>lu(e))).join(",");return`${e.op}(${t})`}}function uu(e,t){return e instanceof iu?function(e,t){return t instanceof iu&&e.op===t.op&&e.field.isEqual(t.field)&&Nl(e.value,t.value)}(e,t):e instanceof ou?function(e,t){return t instanceof ou&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&uu(n,t.filters[r])),!0)}(e,t):void Pa()}function du(e){return e instanceof iu?function(e){return`${e.field.canonicalString()} ${e.op} ${jl(e.value)}`}(e):e instanceof ou?function(e){return e.op.toString()+" {"+e.getFilters().map(du).join(" ,")+"}"}(e):"Filter"}class hu extends iu{constructor(e,t,n){super(e,t,n),this.key=uc.fromName(n.referenceValue)}matches(e){const t=uc.comparator(e.key,this.key);return this.matchesComparison(t)}}class pu extends iu{constructor(e,t){super(e,"in",t),this.keys=mu("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class fu extends iu{constructor(e,t){super(e,"not-in",t),this.keys=mu("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function mu(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>uc.fromName(e.referenceValue)))}class gu extends iu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Wl(t)&&Pl(t.arrayValue,this.value)}}class vu extends iu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Pl(this.value.arrayValue,t)}}class yu extends iu{constructor(e,t){super(e,"not-in",t)}matches(e){if(Pl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Pl(this.value.arrayValue,t)}}class _u extends iu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Wl(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Pl(this.value.arrayValue,e)))}}class Eu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.le=null}}function bu(e){return new Eu(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function wu(e){const t=La(e);if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>lu(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Cc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>jl(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>jl(e))).join(",")),t.le=e}return t.le}function Su(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!nu(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!uu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!eu(e.startAt,t.startAt)&&eu(e.endAt,t.endAt)}function Tu(e){return uc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Cu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Au(e,t,n,r,i,o,s,a){return new Cu(e,t,n,r,i,o,s,a)}function Ru(e){return new Cu(e)}function Iu(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function xu(e){return null!==e.collectionGroup}function Ou(e){const t=La(e);if(null===t.he){t.he=[];const e=new Set;for(const i of t.explicitOrderBy)t.he.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new al(lc.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.he.push(new tu(r,n))})),e.has(lc.keyField().canonicalString())||t.he.push(new tu(lc.keyField(),n))}return t.he}function ku(e){const t=La(e);return t.Pe||(t.Pe=Nu(t,Ou(e))),t.Pe}function Nu(e,t){if("F"===e.limitType)return bu(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new tu(e.field,t)}));const n=e.endAt?new Ql(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ql(e.startAt.position,e.startAt.inclusive):null;return bu(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Pu(e,t){const n=e.filters.concat([t]);return new Cu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Du(e,t,n){return new Cu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Lu(e,t){return Su(ku(e),ku(t))&&e.limitType===t.limitType}function Mu(e){return`${wu(ku(e))}|lt:${e.limitType}`}function ju(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>du(e))).join(", ")}]`),Cc(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>jl(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>jl(e))).join(",")),`Target(${t})`}(ku(e))}; limitType=${e.limitType})`}function Uu(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):uc.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ou(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Zl(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Ou(e),t))&&!(e.endAt&&!function(e,t,n){const r=Zl(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Ou(e),t))}(e,t)}function Vu(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Fu(e){return(t,n)=>{let r=!1;for(const i of Ou(e)){const e=Bu(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Bu(e,t,n){const r=e.field.isKeyField()?uc.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Dl(r,i):Pa()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Pa()}}class Wu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){nl(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return rl(this.inner)}size(){return this.innerSize}}const zu=new il(uc.comparator);function Hu(){return zu}const Gu=new il(uc.comparator);function qu(){let e=Gu;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function Ku(e){let t=Gu;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function $u(){return Xu()}function Yu(){return Xu()}function Xu(){return new Wu((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Ju=new il(uc.comparator),Qu=new al(uc.comparator);function Zu(){let e=Qu;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const ed=new al(Xa);function td(){return ed}function nd(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ac(t)?"-0":t}}function rd(e){return{integerValue:""+e}}function id(e,t){return Rc(t)?rd(t):nd(e,t)}class od{constructor(){this._=void 0}}function sd(e,t,n){return e instanceof ld?function(e,t){const n={fields:{[vl]:{stringValue:gl},[_l]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&El(t)&&(t=bl(t)),t&&(n.fields[yl]=t),{mapValue:n}}(n,t):e instanceof ud?dd(e,t):e instanceof hd?pd(e,t):function(e,t){const n=cd(e,t),r=md(n)+md(e.Ie);return Bl(n)&&Bl(e.Ie)?rd(r):nd(e.serializer,r)}(e,t)}function ad(e,t,n){return e instanceof ud?dd(e,t):e instanceof hd?pd(e,t):n}function cd(e,t){return e instanceof fd?function(e){return Bl(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class ld extends od{}class ud extends od{constructor(e){super(),this.elements=e}}function dd(e,t){const n=gd(t);for(const r of e.elements)n.some((e=>Nl(e,r)))||n.push(r);return{arrayValue:{values:n}}}class hd extends od{constructor(e){super(),this.elements=e}}function pd(e,t){let n=gd(t);for(const r of e.elements)n=n.filter((e=>!Nl(e,r)));return{arrayValue:{values:n}}}class fd extends od{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function md(e){return fl(e.integerValue||e.doubleValue)}function gd(e){return Wl(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class vd{constructor(e,t){this.field=e,this.transform=t}}class yd{constructor(e,t){this.version=e,this.transformResults=t}}class _d{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _d}static exists(e){return new _d(void 0,e)}static updateTime(e){return new _d(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ed(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class bd{}function wd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Nd(e.key,_d.none()):new Rd(e.key,e.data,_d.none());{const n=e.data,r=Yl.empty();let i=new al(lc.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Id(e.key,r,new ll(i.toArray()),_d.none())}}function Sd(e,t,n){e instanceof Rd?function(e,t,n){const r=e.value.clone(),i=Od(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Id?function(e,t,n){if(!Ed(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Od(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(xd(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Td(e,t,n,r){return e instanceof Rd?function(e,t,n,r){if(!Ed(e.precondition,t))return n;const i=e.value.clone(),o=kd(e.fieldTransforms,r,t);return i.setAll(o),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Id?function(e,t,n,r){if(!Ed(e.precondition,t))return n;const i=kd(e.fieldTransforms,r,t),o=t.data;return o.setAll(xd(e)),o.setAll(i),t.convertToFoundDocument(t.version,o).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Ed(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Cd(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=cd(r.transform,e||null);null!=i&&(null===n&&(n=Yl.empty()),n.set(r.field,i))}return n||null}function Ad(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ec(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ud&&t instanceof ud||e instanceof hd&&t instanceof hd?ec(e.elements,t.elements,Nl):e instanceof fd&&t instanceof fd?Nl(e.Ie,t.Ie):e instanceof ld&&t instanceof ld}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Rd extends bd{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Id extends bd{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function xd(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Od(e,t,n){const r=new Map;Da(e.length===n.length);for(let i=0;i<n.length;i++){const o=e[i],s=o.transform,a=t.data.field(o.field);r.set(o.field,ad(s,a,n[i]))}return r}function kd(e,t,n){const r=new Map;for(const i of e){const e=i.transform,o=n.data.field(i.field);r.set(i.field,sd(e,o,t))}return r}class Nd extends bd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Pd extends bd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Dd{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Sd(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Td(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Td(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Yu();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let s=this.applyToLocalView(o,i.mutatedFields);s=t.has(r.key)?null:s;const a=wd(o,s);null!==a&&n.set(r.key,a),o.isValidDocument()||o.convertToNoDocument(ic.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Zu())}isEqual(e){return this.batchId===e.batchId&&ec(this.mutations,e.mutations,((e,t)=>Ad(e,t)))&&ec(this.baseMutations,e.baseMutations,((e,t)=>Ad(e,t)))}}class Ld{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Da(e.mutations.length===n.length);let r=Ju;const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Ld(e,t,n,r)}}class Md{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class jd{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ud,Vd;function Fd(e){switch(e){case Ma.OK:return Pa();case Ma.CANCELLED:case Ma.UNKNOWN:case Ma.DEADLINE_EXCEEDED:case Ma.RESOURCE_EXHAUSTED:case Ma.INTERNAL:case Ma.UNAVAILABLE:case Ma.UNAUTHENTICATED:return!1;case Ma.INVALID_ARGUMENT:case Ma.NOT_FOUND:case Ma.ALREADY_EXISTS:case Ma.PERMISSION_DENIED:case Ma.FAILED_PRECONDITION:case Ma.ABORTED:case Ma.OUT_OF_RANGE:case Ma.UNIMPLEMENTED:case Ma.DATA_LOSS:return!0;default:return Pa()}}function Bd(e){if(void 0===e)return Oa("GRPC error has no .code"),Ma.UNKNOWN;switch(e){case Ud.OK:return Ma.OK;case Ud.CANCELLED:return Ma.CANCELLED;case Ud.UNKNOWN:return Ma.UNKNOWN;case Ud.DEADLINE_EXCEEDED:return Ma.DEADLINE_EXCEEDED;case Ud.RESOURCE_EXHAUSTED:return Ma.RESOURCE_EXHAUSTED;case Ud.INTERNAL:return Ma.INTERNAL;case Ud.UNAVAILABLE:return Ma.UNAVAILABLE;case Ud.UNAUTHENTICATED:return Ma.UNAUTHENTICATED;case Ud.INVALID_ARGUMENT:return Ma.INVALID_ARGUMENT;case Ud.NOT_FOUND:return Ma.NOT_FOUND;case Ud.ALREADY_EXISTS:return Ma.ALREADY_EXISTS;case Ud.PERMISSION_DENIED:return Ma.PERMISSION_DENIED;case Ud.FAILED_PRECONDITION:return Ma.FAILED_PRECONDITION;case Ud.ABORTED:return Ma.ABORTED;case Ud.OUT_OF_RANGE:return Ma.OUT_OF_RANGE;case Ud.UNIMPLEMENTED:return Ma.UNIMPLEMENTED;case Ud.DATA_LOSS:return Ma.DATA_LOSS;default:return Pa()}}(Vd=Ud||(Ud={}))[Vd.OK=0]="OK",Vd[Vd.CANCELLED=1]="CANCELLED",Vd[Vd.UNKNOWN=2]="UNKNOWN",Vd[Vd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vd[Vd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vd[Vd.NOT_FOUND=5]="NOT_FOUND",Vd[Vd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vd[Vd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vd[Vd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vd[Vd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vd[Vd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vd[Vd.ABORTED=10]="ABORTED",Vd[Vd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vd[Vd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vd[Vd.INTERNAL=13]="INTERNAL",Vd[Vd.UNAVAILABLE=14]="UNAVAILABLE",Vd[Vd.DATA_LOSS=15]="DATA_LOSS";let Wd=null;const zd=new la([4294967295,4294967295],0);function Hd(e){const t=$a().encode(e),n=new ua;return n.update(t),new Uint8Array(n.digest())}function Gd(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new la([n,r],0),new la([i,o],0)]}class qd{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Kd(`Invalid padding: ${t}`);if(n<0)throw new Kd(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Kd(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Kd(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=la.fromNumber(this.Ee)}Ae(e,t,n){let r=e.add(t.multiply(la.fromNumber(n)));return 1===r.compare(zd)&&(r=new la([r.getBits(0),r.getBits(1)],0)),r.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;const t=Hd(e),[n,r]=Gd(t);for(let i=0;i<this.hashCount;i++){const e=this.Ae(n,r,i);if(!this.Re(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new qd(i,r,t);return n.forEach((e=>o.insert(e))),o}insert(e){if(0===this.Ee)return;const t=Hd(e),[n,r]=Gd(t);for(let i=0;i<this.hashCount;i++){const e=this.Ae(n,r,i);this.Ve(e)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Kd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $d{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Yd.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $d(ic.min(),r,new il(Xa),Hu(),Zu())}}class Yd{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Yd(n,t,Zu(),Zu(),Zu())}}class Xd{constructor(e,t,n,r){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=r}}class Jd{constructor(e,t){this.targetId=e,this.ge=t}}class Qd{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dl.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Zd{constructor(){this.pe=0,this.ye=nh(),this.we=dl.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Zu(),t=Zu(),n=Zu();return this.ye.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Pa()}})),new Yd(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=nh()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Da(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class eh{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Hu(),this.$e=th(),this.Ue=th(),this.Ke=new il(Xa)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,(t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:Pa()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach(((e,n)=>{this.Je(n)&&t(n)}))}Ze(e){const t=e.targetId,n=e.ge.count,r=this.Xe(t);if(r){const i=r.target;if(Tu(i))if(0===n){const e=new uc(i.path);this.ze(t,e,Jl.newNoDocument(e,ic.min()))}else Da(1===n);else{const r=this.et(t);if(r!==n){const n=this.tt(e),i=n?this.nt(n,e,r):1;if(0!==i){this.Ye(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==Wd||Wd.rt(function(e,t,n,r,i){var o,s,a,c,l,u;const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===i,hashCount:null!==(o=null==h?void 0:h.hashCount)&&void 0!==o?o:0,bitmapLength:null!==(c=null===(a=null===(s=null==h?void 0:h.bits)||void 0===s?void 0:s.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(u=null===(l=null==h?void 0:h.bits)||void 0===l?void 0:l.padding)&&void 0!==u?u:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),d}(r,e.ge,this.ke.it(),n,i))}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let o,s;try{o=ml(n).toUint8Array()}catch(e){if(e instanceof ul)return ka("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new qd(o,r,i)}catch(e){return ka(e instanceof Kd?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Ee?null:s}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){const n=this.ke.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.ke.it(),o=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(o)||(this.ze(t,n,null),r++)})),r}ot(e){const t=new Map;this.qe.forEach(((n,r)=>{const i=this.Xe(r);if(i){if(n.current&&Tu(i.target)){const t=new uc(i.target.path);this._t(t).has(r)||this.ut(r,t)||this.ze(r,t,Jl.newNoDocument(t,e))}n.ve&&(t.set(r,n.Fe()),n.Me())}}));let n=Zu();this.Ue.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Qe.forEach(((t,n)=>n.setReadTime(e)));const r=new $d(e,t,this.Ke,this.Qe,n);return this.Qe=Hu(),this.$e=th(),this.Ue=th(),this.Ke=new il(Xa),r}Ge(e,t){if(!this.Je(e))return;const n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const r=this.He(e);this.ut(e,t)?r.xe(t,1):r.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Zd,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new al(Xa),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new al(Xa),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||xa("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Zd),this.ke.getRemoteKeysForTarget(e).forEach((t=>{this.ze(e,t,null)}))}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function th(){return new il(uc.comparator)}function nh(){return new il(uc.comparator)}const rh={asc:"ASCENDING",desc:"DESCENDING"},ih={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oh={and:"AND",or:"OR"};class sh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ah(e,t){return e.useProto3Json||Cc(t)?t:{value:t}}function ch(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function uh(e,t){return ch(e,t.toTimestamp())}function dh(e){return Da(!!e),ic.fromTimestamp(function(e){const t=pl(e);return new rc(t.seconds,t.nanos)}(e))}function hh(e,t){return ph(e,t).canonicalString()}function ph(e,t){const n=function(e){return new ac(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function fh(e){const t=ac.fromString(e);return Da(Dh(t)),t}function mh(e,t){return hh(e.databaseId,t.path)}function gh(e,t){const n=fh(t);if(n.get(1)!==e.databaseId.projectId)throw new ja(Ma.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ja(Ma.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new uc(Eh(n))}function vh(e,t){return hh(e.databaseId,t)}function yh(e){const t=fh(e);return 4===t.length?ac.emptyPath():Eh(t)}function _h(e){return new ac(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Eh(e){return Da(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function bh(e,t,n){return{name:mh(e,t),fields:n.value.mapValue.fields}}function wh(e,t){let n;if(t instanceof Rd)n={update:bh(e,t.key,t.value)};else if(t instanceof Nd)n={delete:mh(e,t.key)};else if(t instanceof Id)n={update:bh(e,t.key,t.data),updateMask:Ph(t.fieldMask)};else{if(!(t instanceof Pd))return Pa();n={verify:mh(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof ld)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ud)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof hd)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof fd)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw Pa()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:uh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Pa()}(e,t.precondition)),n}function Sh(e,t){return{documents:[vh(e,t.path)]}}function Th(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=vh(e,i);const o=function(e){if(0!==e.length)return Nh(ou.create(e,"and"))}(t.filters);o&&(n.structuredQuery.where=o);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Oh(e.field),direction:Rh(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const a=ah(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ht:n,parent:i}}function Ch(e){let t=yh(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Da(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let o=[];n.where&&(o=function(e){const t=Ah(e);return t instanceof ou&&au(t)?t.getFilters():[t]}(n.where));let s=[];n.orderBy&&(s=function(e){return e.map((e=>function(e){return new tu(kh(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Cc(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Ql(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new Ql(n,t)}(n.endAt)),Au(t,i,s,o,a,"F",c,l)}function Ah(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=kh(e.unaryFilter.field);return iu.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=kh(e.unaryFilter.field);return iu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=kh(e.unaryFilter.field);return iu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=kh(e.unaryFilter.field);return iu.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Pa()}}(e):void 0!==e.fieldFilter?function(e){return iu.create(kh(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Pa()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ou.create(e.compositeFilter.filters.map((e=>Ah(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Pa()}}(e.compositeFilter.op))}(e):Pa()}function Rh(e){return rh[e]}function Ih(e){return ih[e]}function xh(e){return oh[e]}function Oh(e){return{fieldPath:e.canonicalString()}}function kh(e){return lc.fromServerFormat(e.fieldPath)}function Nh(e){return e instanceof iu?function(e){if("=="===e.op){if(Hl(e.value))return{unaryFilter:{field:Oh(e.field),op:"IS_NAN"}};if(zl(e.value))return{unaryFilter:{field:Oh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Hl(e.value))return{unaryFilter:{field:Oh(e.field),op:"IS_NOT_NAN"}};if(zl(e.value))return{unaryFilter:{field:Oh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oh(e.field),op:Ih(e.op),value:e.value}}}(e):e instanceof ou?function(e){const t=e.getFilters().map((e=>Nh(e)));return 1===t.length?t[0]:{compositeFilter:{op:xh(e.op),filters:t}}}(e):Pa()}function Ph(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Dh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Lh{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ic.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ic.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:dl.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s,this.expectedCount=a}withSequenceNumber(e){return new Lh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Lh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Lh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Lh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Mh{constructor(e){this.Tt=e}}function jh(e){const t=Ch({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Du(t,t.limit,"L"):t}class Uh{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt(fl(e.integerValue));else if("doubleValue"in e){const n=fl(e.doubleValue);isNaN(n)?this.ft(t,13):(this.ft(t,15),Ac(n)?t.gt(0):t.gt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ft(t,20),"string"==typeof n&&(n=pl(n)),t.yt(`${n.seconds||""}`),t.gt(n.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.St(t);else if("bytesValue"in e)this.ft(t,30),t.bt(ml(e.bytesValue)),this.St(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ft(t,45),t.gt(n.latitude||0),t.gt(n.longitude||0)}else"mapValue"in e?$l(e)?this.ft(t,Number.MAX_SAFE_INTEGER):ql(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.St(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.St(t)):Pa()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){const n=e.fields||{};this.ft(t,55);for(const r of Object.keys(n))this.wt(r,t),this.Rt(n[r],t)}vt(e,t){var n,r;const i=e.fields||{};this.ft(t,53);const o=Ol,s=(null===(r=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.ft(t,15),t.gt(fl(s)),this.wt(o,t),this.Rt(i[o],t)}Ft(e,t){const n=e.values||[];this.ft(t,50);for(const r of n)this.Rt(r,t)}Dt(e,t){this.ft(t,37),uc.fromName(e).path.forEach((e=>{this.ft(t,60),this.Mt(e,t)}))}ft(e,t){e.gt(t)}St(e){e.gt(2)}}Uh.xt=new Uh;class Vh{constructor(){this.Tn=new Fh}addToCollectionParentIndex(e,t){return this.Tn.add(t),Ec.resolve()}getCollectionParents(e,t){return Ec.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return Ec.resolve()}deleteFieldIndex(e,t){return Ec.resolve()}deleteAllFieldIndexes(e){return Ec.resolve()}createTargetIndexes(e,t){return Ec.resolve()}getDocumentsMatchingTarget(e,t){return Ec.resolve(null)}getIndexType(e,t){return Ec.resolve(0)}getFieldIndexes(e,t){return Ec.resolve([])}getNextCollectionGroupToUpdate(e){return Ec.resolve(null)}getMinOffset(e,t){return Ec.resolve(mc.min())}getMinOffsetFromCollectionGroup(e,t){return Ec.resolve(mc.min())}updateCollectionGroup(e,t,n){return Ec.resolve()}updateIndexEntries(e,t){return Ec.resolve()}}class Fh{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new al(ac.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new al(ac.comparator)).toArray()}}new Uint8Array(0);const Bh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wh=41943040;class zh{static withCacheSize(e){return new zh(e,zh.DEFAULT_COLLECTION_PERCENTILE,zh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}zh.DEFAULT_COLLECTION_PERCENTILE=10,zh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zh.DEFAULT=new zh(Wh,zh.DEFAULT_COLLECTION_PERCENTILE,zh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zh.DISABLED=new zh(-1,0,0);class Hh{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new Hh(0)}static Kn(){return new Hh(-1)}}const Gh="LruGarbageCollector",qh=1048576;function Kh(e,t){let[n,r]=e,[i,o]=t;const s=Xa(n,i);return 0===s?Xa(r,o):s}class $h{constructor(e){this.Hn=e,this.buffer=new al(Kh),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Kh(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Yh{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(e){xa(Gh,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){wc(e)?xa(Gh,"Ignoring IndexedDB error during garbage collection: ",e):await _c(e)}await this.er(3e5)}))}}class Xh{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Ec.resolve(Sc.ae);const n=new $h(t);return this.tr.forEachTarget(e,(e=>n.Zn(e.sequenceNumber))).next((()=>this.tr.rr(e,(e=>n.Zn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(xa("LruGarbageCollector","Garbage collection skipped; disabled"),Ec.resolve(Bh)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(xa("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bh):this.ir(e,t)))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,r,i,o,s,a,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(xa("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,o=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,s=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Ia()<=an.DEBUG&&xa("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${r} in `+(s-o)+"ms\n"+`\tRemoved ${i} targets in `+(a-s)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-l}ms`),Ec.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function Jh(e,t){return new Xh(e,t)}class Qh{constructor(){this.changes=new Wu((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jl.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ec.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Zh{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ep{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Td(n.mutation,e,ll.empty(),rc.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Zu()).next((()=>t))))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zu();const r=$u();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=qu();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=$u();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Zu())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Hu();const o=Xu(),s=Xu();return t.forEach(((e,t)=>{const s=n.get(t.key);r.has(t.key)&&(void 0===s||s.mutation instanceof Id)?i=i.insert(t.key,t):void 0!==s?(o.set(t.key,s.mutation.getFieldMask()),Td(s.mutation,t,s.mutation.getFieldMask(),rc.now())):o.set(t.key,ll.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>o.set(e,t))),t.forEach(((e,t)=>{var n;return s.set(e,new Zh(t,null!==(n=o.get(e))&&void 0!==n?n:null))})),s)))}recalculateAndSaveOverlays(e,t){const n=Xu();let r=new il(((e,t)=>e-t)),i=Zu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const o=t.get(e);if(null===o)return;let s=n.get(e)||ll.empty();s=i.applyToLocalView(o,s),n.set(e,s);const a=(r.get(i.batchId)||Zu()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const o=[],s=r.getReverseIterator();for(;s.hasNext();){const r=s.getNext(),a=r.key,c=r.value,l=Yu();c.forEach((e=>{if(!i.has(e)){const r=wd(t.get(e),n.get(e));null!==r&&l.set(e,r),i=i.add(e)}})),o.push(this.documentOverlayCache.saveOverlays(e,a,l))}return Ec.waitFor(o)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return uc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Ec.resolve($u());let s=dc,a=i;return o.next((t=>Ec.forEach(t,((t,n)=>(s<n.largestBatchId&&(s=n.largestBatchId),i.get(t)?Ec.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Zu()))).next((e=>({batchId:s,changes:Ku(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new uc(t)).next((e=>{let t=qu();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let o=qu();return this.indexManager.getCollectionParents(e,i).next((s=>Ec.forEach(s,(s=>{const a=function(e,t){return new Cu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{o=o.insert(e,t)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Jl.newInvalidDocument(r)))}));let n=qu();return e.forEach(((e,r)=>{const o=i.get(e);void 0!==o&&Td(o.mutation,r,ll.empty(),rc.now()),Uu(t,r)&&(n=n.insert(e,r))})),n}))}}class tp{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return Ec.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:dh(e.createTime)}}(t)),Ec.resolve()}getNamedQuery(e,t){return Ec.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(e){return{name:e.name,query:jh(e.bundledQuery),readTime:dh(e.readTime)}}(t)),Ec.resolve()}}class np{constructor(){this.overlays=new il(uc.comparator),this.Rr=new Map}getOverlay(e,t){return Ec.resolve(this.overlays.get(t))}getOverlays(e,t){const n=$u();return Ec.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.Et(e,t,r)})),Ec.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Rr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Rr.delete(n)),Ec.resolve()}getOverlaysForCollection(e,t,n){const r=$u(),i=t.length+1,o=new uc(t.child("")),s=this.overlays.getIteratorFrom(o);for(;s.hasNext();){const e=s.getNext().value,o=e.getKey();if(!t.isPrefixOf(o.path))break;o.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ec.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new il(((e,t)=>e-t));const o=this.overlays.getIterator();for(;o.hasNext();){const e=o.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=$u(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const s=$u(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>s.set(e,t))),!(s.size()>=r)););return Ec.resolve(s)}Et(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Rr.get(r.largestBatchId).delete(n.key);this.Rr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Md(t,n));let i=this.Rr.get(t);void 0===i&&(i=Zu(),this.Rr.set(t,i)),this.Rr.set(t,i.add(n.key))}}class rp{constructor(){this.sessionToken=dl.EMPTY_BYTE_STRING}getSessionToken(e){return Ec.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ec.resolve()}}class ip{constructor(){this.Vr=new al(op.mr),this.gr=new al(op.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const n=new op(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.wr(new op(e,t))}Sr(e,t){e.forEach((e=>this.removeReference(e,t)))}br(e){const t=new uc(new ac([])),n=new op(t,e),r=new op(t,e+1),i=[];return this.gr.forEachInRange([n,r],(e=>{this.wr(e),i.push(e.key)})),i}Dr(){this.Vr.forEach((e=>this.wr(e)))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new uc(new ac([])),n=new op(t,e),r=new op(t,e+1);let i=Zu();return this.gr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new op(e,0),n=this.Vr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class op{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return uc.comparator(e.key,t.key)||Xa(e.Cr,t.Cr)}static pr(e,t){return Xa(e.Cr,t.Cr)||uc.comparator(e.key,t.key)}}class sp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new al(op.mr)}checkEmpty(e){return Ec.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Dd(i,t,n,r);this.mutationQueue.push(o);for(const s of r)this.Mr=this.Mr.add(new op(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return Ec.resolve(o)}lookupMutationBatch(e,t){return Ec.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Nr(n),i=r<0?0:r;return Ec.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ec.resolve(0===this.mutationQueue.length?Tc:this.Fr-1)}getAllMutationBatches(e){return Ec.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new op(t,0),r=new op(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([n,r],(e=>{const t=this.Or(e.Cr);i.push(t)})),Ec.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new al(Xa);return t.forEach((e=>{const t=new op(e,0),r=new op(e,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([t,r],(e=>{n=n.add(e.Cr)}))})),Ec.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;uc.isDocumentKey(i)||(i=i.child(""));const o=new op(new uc(i),0);let s=new al(Xa);return this.Mr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.Cr)),!0)}),o),Ec.resolve(this.Br(s))}Br(e){const t=[];return e.forEach((e=>{const n=this.Or(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Da(0===this.Lr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Mr;return Ec.forEach(t.mutations,(r=>{const i=new op(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Mr=n}))}qn(e){}containsKey(e,t){const n=new op(t,0),r=this.Mr.firstAfterOrEqual(n);return Ec.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ec.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ap{constructor(e){this.kr=e,this.docs=new il(uc.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,o=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ec.resolve(n?n.document.mutableCopy():Jl.newInvalidDocument(t))}getEntries(e,t){let n=Hu();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Jl.newInvalidDocument(e))})),Ec.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Hu();const o=t.path,s=new uc(o.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(s);for(;a.hasNext();){const{key:e,value:{document:s}}=a.getNext();if(!o.isPrefixOf(e.path))break;e.path.length>o.length+1||gc(fc(s),n)<=0||(r.has(s.key)||Uu(t,s))&&(i=i.insert(s.key,s.mutableCopy()))}return Ec.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Pa()}qr(e,t){return Ec.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new cp(this)}getSize(e){return Ec.resolve(this.size)}}class cp extends Qh{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(n)})),Ec.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}class lp{constructor(e){this.persistence=e,this.Qr=new Wu((e=>wu(e)),Su),this.lastRemoteSnapshotVersion=ic.min(),this.highestTargetId=0,this.$r=0,this.Ur=new ip,this.targetCount=0,this.Kr=Hh.Un()}forEachTarget(e,t){return this.Qr.forEach(((e,n)=>t(n))),Ec.resolve()}getLastRemoteSnapshotVersion(e){return Ec.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ec.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Ec.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),Ec.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new Hh(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,Ec.resolve()}updateTargetData(e,t){return this.zn(t),Ec.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,Ec.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Qr.forEach(((o,s)=>{s.sequenceNumber<=t&&null===n.get(s.targetId)&&(this.Qr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,s.targetId)),r++)})),Ec.waitFor(i).next((()=>r))}getTargetCount(e){return Ec.resolve(this.targetCount)}getTargetData(e,t){const n=this.Qr.get(t)||null;return Ec.resolve(n)}addMatchingKeys(e,t,n){return this.Ur.yr(t,n),Ec.resolve()}removeMatchingKeys(e,t,n){this.Ur.Sr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ec.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),Ec.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ur.vr(t);return Ec.resolve(n)}containsKey(e,t){return Ec.resolve(this.Ur.containsKey(t))}}class up{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new Sc(0),this.zr=!1,this.zr=!0,this.jr=new rp,this.referenceDelegate=e(this),this.Hr=new lp(this),this.indexManager=new Vh,this.remoteDocumentCache=function(e){return new ap(e)}((e=>this.referenceDelegate.Jr(e))),this.serializer=new Mh(t),this.Yr=new tp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new np,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new sp(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){xa("MemoryPersistence","Starting transaction:",e);const r=new dp(this.Gr.next());return this.referenceDelegate.Zr(),n(r).next((e=>this.referenceDelegate.Xr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}ei(e,t){return Ec.or(Object.values(this.Wr).map((n=>()=>n.containsKey(e,t))))}}class dp extends yc{constructor(e){super(),this.currentSequenceNumber=e}}class hp{constructor(e){this.persistence=e,this.ti=new ip,this.ni=null}static ri(e){return new hp(e)}get ii(){if(this.ni)return this.ni;throw Pa()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),Ec.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),Ec.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),Ec.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach((e=>this.ii.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.ii.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ec.forEach(this.ii,(n=>{const r=uc.fromPath(n);return this.si(e,r).next((e=>{e||t.removeEntry(r,ic.min())}))})).next((()=>(this.ni=null,t.apply(e))))}updateLimboDocument(e,t){return this.si(e,t).next((e=>{e?this.ii.delete(t.toString()):this.ii.add(t.toString())}))}Jr(e){return 0}si(e,t){return Ec.or([()=>Ec.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class pp{constructor(e,t){this.persistence=e,this.oi=new Wu((e=>xc(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=Jh(this,t)}static ri(e,t){return new pp(e,t)}Zr(){}Xr(e){return Ec.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}sr(e){let t=0;return this.rr(e,(e=>{t++})).next((()=>t))}rr(e,t){return Ec.forEach(this.oi,((n,r)=>this.ar(e,n,r).next((e=>e?Ec.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.qr(e,(r=>this.ar(e,r,t).next((e=>{e||(n++,i.removeEntry(r,ic.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),Ec.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Ec.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Ec.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),Ec.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Vl(e.data.value)),t}ar(e,t,n){return Ec.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.oi.get(t);return Ec.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fp{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=r}static Yi(e,t){let n=Zu(),r=Zu();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new fp(e,t.fromCache,n,r)}}class mp{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class gp{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=kt()?8:bc(Rt())>0?6:4}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.rs(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.ss(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new mp;return this._s(e,t,n).next((r=>{if(i.result=r,this.Xi)return this.us(e,t,n,r.size)}))})).next((()=>i.result))}us(e,t,n,r){return n.documentReadCount<this.es?(Ia()<=an.DEBUG&&xa("QueryEngine","SDK will not create cache indexes for query:",ju(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Ec.resolve()):(Ia()<=an.DEBUG&&xa("QueryEngine","Query:",ju(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ts*r?(Ia()<=an.DEBUG&&xa("QueryEngine","The SDK decides to create cache indexes for query:",ju(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ku(t))):Ec.resolve())}rs(e,t){if(Iu(t))return Ec.resolve(null);let n=ku(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Du(t,null,"F"),n=ku(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Zu(...r);return this.ns.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const o=this.cs(t,r);return this.ls(t,o,i,n.readTime)?this.rs(e,Du(t,null,"F")):this.hs(e,o,t,n)}))))})))))}ss(e,t,n,r){return Iu(t)||r.isEqual(ic.min())?Ec.resolve(null):this.ns.getDocuments(e,n).next((i=>{const o=this.cs(t,i);return this.ls(t,o,n,r)?Ec.resolve(null):(Ia()<=an.DEBUG&&xa("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ju(t)),this.hs(e,o,t,pc(r,dc)).next((e=>e)))}))}cs(e,t){let n=new al(Fu(e));return t.forEach(((t,r)=>{Uu(e,r)&&(n=n.add(r))})),n}ls(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}_s(e,t,n){return Ia()<=an.DEBUG&&xa("QueryEngine","Using full collection scan to execute query:",ju(t)),this.ns.getDocumentsMatchingQuery(e,t,mc.min(),n)}hs(e,t,n,r){return this.ns.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const vp="LocalStore";class yp{constructor(e,t,n,r){this.persistence=e,this.Ps=t,this.serializer=r,this.Ts=new il(Xa),this.Is=new Wu((e=>wu(e)),Su),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ep(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ts)))}}function _p(e,t,n,r){return new yp(e,t,n,r)}async function Ep(e,t){const n=La(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.As(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],o=[];let s=Zu();for(const e of r){i.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}for(const e of t){o.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}return n.localDocuments.getDocuments(e,s).next((e=>({Rs:e,removedBatchIds:i,addedBatchIds:o})))}))}))}function bp(e){const t=La(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Hr.getLastRemoteSnapshotVersion(e)))}function wp(e,t,n){let r=Zu(),i=Zu();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Hu();return n.forEach(((n,o)=>{const s=e.get(n);o.isFoundDocument()!==s.isFoundDocument()&&(i=i.add(n)),o.isNoDocument()&&o.version.isEqual(ic.min())?(t.removeEntry(n,o.readTime),r=r.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(o),r=r.insert(n,o)):xa(vp,"Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),{Vs:r,fs:i}}))}function Sp(e,t){const n=La(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=Tc),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Tp(e,t){const n=La(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Hr.getTargetData(e,t).next((i=>i?(r=i,Ec.resolve(r)):n.Hr.allocateTargetId(e).next((i=>(r=new Lh(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Hr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ts.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(e.targetId,e),n.Is.set(t,e.targetId)),e}))}async function Cp(e,t,n){const r=La(e),i=r.Ts.get(t),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!wc(e))throw e;xa(vp,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ts=r.Ts.remove(t),r.Is.delete(i.target)}function Ap(e,t,n){const r=La(e);let i=ic.min(),o=Zu();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=La(e),i=r.Is.get(n);return void 0!==i?Ec.resolve(r.Ts.get(i)):r.Hr.getTargetData(t,n)}(r,e,ku(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{o=e}))})).next((()=>r.Ps.getDocumentsMatchingQuery(e,t,n?i:ic.min(),n?o:Zu()))).next((e=>(Rp(r,Vu(t),e),{documents:e,gs:o})))))}function Rp(e,t,n){let r=e.Es.get(t)||ic.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Es.set(t,r)}class Ip{constructor(){this.activeTargetIds=td()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xp{constructor(){this.ho=new Ip,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new Ip,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Op{To(e){}shutdown(){}}const kp="ConnectivityMonitor";class Np{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){xa(kp,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){xa(kp,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Pp=null;function Dp(){return null===Pp?Pp=268435456+Math.round(2147483648*Math.random()):Pp++,"0x"+Pp.toString(16)}const Lp="RestConnection",Mp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jp{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${r}`,this.wo=this.databaseId.database===Tl?`project_id=${n}`:`project_id=${n}&database_id=${r}`}So(e,t,n,r,i){const o=Dp(),s=this.bo(e,t.toUriEncodedString());xa(Lp,`Sending RPC '${e}' ${o}:`,s,n);const a={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(a,r,i),this.vo(e,s,a,n).then((t=>(xa(Lp,`Received RPC '${e}' ${o}: `,t),t)),(t=>{throw ka(Lp,`RPC '${e}' ${o} failed with error: `,t,"url: ",s,"request:",n),t}))}Co(e,t,n,r,i,o){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Aa,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=Mp[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}class Up{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}const Vp="WebChannelConnection";class Fp extends jp{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,r){const i=Dp();return new Promise(((o,s)=>{const a=new pa;a.setWithCredentials(!0),a.listenOnce(ma.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case ga.NO_ERROR:const t=a.getResponseJson();xa(Vp,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),o(t);break;case ga.TIMEOUT:xa(Vp,`RPC '${e}' ${i} timed out`),s(new ja(Ma.DEADLINE_EXCEEDED,"Request time out"));break;case ga.HTTP_ERROR:const n=a.getStatus();if(xa(Vp,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ma).indexOf(t)>=0?t:Ma.UNKNOWN}(t.status);s(new ja(e,t.message))}else s(new ja(Ma.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new ja(Ma.UNAVAILABLE,"Connection failed."));break;default:Pa()}}finally{xa(Vp,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);xa(Vp,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Wo(e,t,n){const r=Dp(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ea(),s=_a(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=i.join("");xa(Vp,`Creating RPC '${e}' stream ${r}: ${l}`,a);const u=o.createWebChannel(l,a);let d=!1,h=!1;const p=new Up({Fo:t=>{h?xa(Vp,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(xa(Vp,`Opening RPC '${e}' stream ${r} transport.`),u.open(),d=!0),xa(Vp,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Mo:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,fa.EventType.OPEN,(()=>{h||(xa(Vp,`RPC '${e}' stream ${r} transport opened.`),p.Qo())})),f(u,fa.EventType.CLOSE,(()=>{h||(h=!0,xa(Vp,`RPC '${e}' stream ${r} transport closed`),p.Uo())})),f(u,fa.EventType.ERROR,(t=>{h||(h=!0,ka(Vp,`RPC '${e}' stream ${r} transport errored:`,t),p.Uo(new ja(Ma.UNAVAILABLE,"The operation could not be completed")))})),f(u,fa.EventType.MESSAGE,(t=>{var n;if(!h){const i=t.data[0];Da(!!i);const o=i,s=(null==o?void 0:o.error)||(null===(n=o[0])||void 0===n?void 0:n.error);if(s){xa(Vp,`RPC '${e}' stream ${r} received error:`,s);const t=s.status;let n=function(e){const t=Ud[e];if(void 0!==t)return Bd(t)}(t),i=s.message;void 0===n&&(n=Ma.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),h=!0,p.Uo(new ja(n,i)),u.close()}else xa(Vp,`RPC '${e}' stream ${r} received:`,i),p.Ko(i)}})),f(s,ya.STAT_EVENT,(t=>{t.stat===va.PROXY?xa(Vp,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===va.NOPROXY&&xa(Vp,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.$o()}),0),p}}function Bp(){return"undefined"!=typeof document?document:null}function Wp(e){return new sh(e,!0)}class zp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Ti=e,this.timerId=t,this.Go=n,this.zo=r,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),r=Math.max(0,t-n);r>0&&xa("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,(()=>(this.Yo=Date.now(),e()))),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}const Hp="PersistentStream";class Gp{constructor(e,t,n,r,i,o,s,a){this.Ti=e,this.n_=n,this.r_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=a,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new zp(e,t)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,(()=>this.T_())))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,4!==e?this.a_.reset():t&&t.code===Ma.RESOURCE_EXHAUSTED?(Oa(t.toString()),Oa("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===Ma.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((e=>{let[n,r]=e;this.i_===t&&this.V_(n,r)}),(t=>{e((()=>{const e=new ja(Ma.UNKNOWN,"Fetching auth token failed: "+t.message);return this.m_(e)}))}))}V_(e,t){const n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo((()=>{n((()=>this.listener.xo()))})),this.stream.No((()=>{n((()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,(()=>(this.c_()&&(this.state=3),Promise.resolve()))),this.listener.No())))})),this.stream.Lo((e=>{n((()=>this.m_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.__?this.g_(e):this.onNext(e)))}))}l_(){this.state=5,this.a_.Xo((async()=>{this.state=0,this.start()}))}m_(e){return xa(Hp,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget((()=>this.i_===e?t():(xa(Hp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class qp extends Gp{constructor(e,t,n,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Pa()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(Da(void 0===t||"string"==typeof t),dl.fromBase64String(t||"")):(Da(void 0===t||t instanceof Buffer||t instanceof Uint8Array),dl.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&function(e){const t=void 0===e.code?Ma.UNKNOWN:Bd(e.code);return new ja(t,e.message||"")}(s);n=new Qd(r,i,o,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=gh(e,r.document.name),o=dh(r.document.updateTime),s=r.document.createTime?dh(r.document.createTime):ic.min(),a=new Yl({mapValue:{fields:r.document.fields}}),c=Jl.newFoundDocument(i,o,s,a),l=r.targetIds||[],u=r.removedTargetIds||[];n=new Xd(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=gh(e,r.document),o=r.readTime?dh(r.readTime):ic.min(),s=Jl.newNoDocument(i,o),a=r.removedTargetIds||[];n=new Xd([],a,s.key,s)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=gh(e,r.document),o=r.removedTargetIds||[];n=new Xd([],o,i,null)}else{if(!("filter"in t))return Pa();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,o=new jd(r,i),s=e.targetId;n=new Jd(s,o)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ic.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ic.min():t.readTime?dh(t.readTime):ic.min()}(e);return this.listener.p_(t,n)}y_(e){const t={};t.database=_h(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Tu(r)?{documents:Sh(e,r)}:{query:Th(e,r).ht},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=lh(e,t.resumeToken);const r=ah(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ic.min())>0){n.readTime=ch(e,t.snapshotVersion.toTimestamp());const r=ah(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Pa()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){const t={};t.database=_h(this.serializer),t.removeTarget=e,this.I_(t)}}class Kp extends Gp{constructor(e,t,n,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return Da(!!e.streamToken),this.lastStreamToken=e.streamToken,Da(!e.writeResults||0===e.writeResults.length),this.listener.D_()}onNext(e){Da(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=function(e,t){return e&&e.length>0?(Da(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?dh(e.updateTime):dh(t);return n.isEqual(ic.min())&&(n=dh(t)),new yd(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=dh(e.commitTime);return this.listener.v_(n,t)}C_(){const e={};e.database=_h(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>wh(this.serializer,e)))};this.I_(t)}}class $p{}class Yp extends $p{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new ja(Ma.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((i=>{let[o,s]=i;return this.connection.So(e,ph(t,n),r,o,s)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ma.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ja(Ma.UNKNOWN,e.toString())}))}Co(e,t,n,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((o=>{let[s,a]=o;return this.connection.Co(e,ph(t,n),r,s,a,i)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ma.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ja(Ma.UNKNOWN,e.toString())}))}terminate(){this.F_=!0,this.connection.terminate()}}class Xp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve()))))}q_(e){"Online"===this.state?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,"Online"===e&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Oa(t),this.N_=!1):xa("OnlineStateTracker",t)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}const Jp="RemoteStore";class Qp{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To((e=>{n.enqueueAndForget((async()=>{cf(this)&&(xa(Jp,"Restarting streams for network reachability change."),await async function(e){const t=La(e);t.W_.add(4),await ef(t),t.j_.set("Unknown"),t.W_.delete(4),await Zp(t)}(this))}))})),this.j_=new Xp(n,r)}}async function Zp(e){if(cf(e))for(const t of e.G_)await t(!0)}async function ef(e){for(const t of e.G_)await t(!1)}function tf(e,t){const n=La(e);n.K_.has(t.targetId)||(n.K_.set(t.targetId,t),af(n)?sf(n):Rf(n).c_()&&rf(n,t))}function nf(e,t){const n=La(e),r=Rf(n);n.K_.delete(t),r.c_()&&of(n,t),0===n.K_.size&&(r.c_()?r.P_():cf(n)&&n.j_.set("Unknown"))}function rf(e,t){if(e.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ic.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Rf(e).y_(t)}function of(e,t){e.H_.Ne(t),Rf(e).w_(t)}function sf(e){e.H_=new eh({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.K_.get(t)||null,it:()=>e.datastore.serializer.databaseId}),Rf(e).start(),e.j_.B_()}function af(e){return cf(e)&&!Rf(e).u_()&&e.K_.size>0}function cf(e){return 0===La(e).W_.size}function lf(e){e.H_=void 0}async function uf(e){e.j_.set("Online")}async function df(e){e.K_.forEach(((t,n)=>{rf(e,t)}))}async function hf(e,t){lf(e),af(e)?(e.j_.q_(t),sf(e)):e.j_.set("Unknown")}async function pf(e,t,n){if(e.j_.set("Online"),t instanceof Qd&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.K_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.K_.delete(r),e.H_.removeTarget(r))}(e,t)}catch(n){xa(Jp,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ff(e,n)}else if(t instanceof Xd?e.H_.We(t):t instanceof Jd?e.H_.Ze(t):e.H_.je(t),!n.isEqual(ic.min()))try{const t=await bp(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.H_.ot(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.K_.get(r);i&&e.K_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.K_.get(t);if(!r)return;e.K_.set(t,r.withResumeToken(dl.EMPTY_BYTE_STRING,r.snapshotVersion)),of(e,t);const i=new Lh(r.target,t,n,r.sequenceNumber);rf(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){xa(Jp,"Failed to raise snapshot:",t),await ff(e,t)}}async function ff(e,t,n){if(!wc(t))throw t;e.W_.add(1),await ef(e),e.j_.set("Offline"),n||(n=()=>bp(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{xa(Jp,"Retrying IndexedDB access"),await n(),e.W_.delete(1),await Zp(e)}))}function mf(e,t){return t().catch((n=>ff(e,n,t)))}async function gf(e){const t=La(e),n=If(t);let r=t.U_.length>0?t.U_[t.U_.length-1].batchId:Tc;for(;vf(t);)try{const e=await Sp(t.localStore,r);if(null===e){0===t.U_.length&&n.P_();break}r=e.batchId,yf(t,e)}catch(e){await ff(t,e)}_f(t)&&Ef(t)}function vf(e){return cf(e)&&e.U_.length<10}function yf(e,t){e.U_.push(t);const n=If(e);n.c_()&&n.S_&&n.b_(t.mutations)}function _f(e){return cf(e)&&!If(e).u_()&&e.U_.length>0}function Ef(e){If(e).start()}async function bf(e){If(e).C_()}async function wf(e){const t=If(e);for(const n of e.U_)t.b_(n.mutations)}async function Sf(e,t,n){const r=e.U_.shift(),i=Ld.from(r,t,n);await mf(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await gf(e)}async function Tf(e,t){t&&If(e).S_&&await async function(e,t){if(function(e){return Fd(e)&&e!==Ma.ABORTED}(t.code)){const n=e.U_.shift();If(e).h_(),await mf(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await gf(e)}}(e,t),_f(e)&&Ef(e)}async function Cf(e,t){const n=La(e);n.asyncQueue.verifyOperationInProgress(),xa(Jp,"RemoteStore received new credentials");const r=cf(n);n.W_.add(3),await ef(n),r&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.W_.delete(3),await Zp(n)}async function Af(e,t){const n=La(e);t?(n.W_.delete(2),await Zp(n)):t||(n.W_.add(2),await ef(n),n.j_.set("Unknown"))}function Rf(e){return e.J_||(e.J_=function(e,t,n){const r=La(e);return r.M_(),new qp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:uf.bind(null,e),No:df.bind(null,e),Lo:hf.bind(null,e),p_:pf.bind(null,e)}),e.G_.push((async t=>{t?(e.J_.h_(),af(e)?sf(e):e.j_.set("Unknown")):(await e.J_.stop(),lf(e))}))),e.J_}function If(e){return e.Y_||(e.Y_=function(e,t,n){const r=La(e);return r.M_(),new Kp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:()=>Promise.resolve(),No:bf.bind(null,e),Lo:Tf.bind(null,e),D_:wf.bind(null,e),v_:Sf.bind(null,e)}),e.G_.push((async t=>{t?(e.Y_.h_(),await gf(e)):(await e.Y_.stop(),e.U_.length>0&&(xa(Jp,`Stopping write stream with ${e.U_.length} pending writes`),e.U_=[]))}))),e.Y_}class xf{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ua,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const o=Date.now()+n,s=new xf(e,t,o,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ja(Ma.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Of(e,t){if(Oa("AsyncQueue",`${t}: ${e}`),wc(e))return new ja(Ma.UNAVAILABLE,`${t}: ${e}`);throw e}class kf{static emptySet(e){return new kf(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||uc.comparator(t.key,n.key):(e,t)=>uc.comparator(e.key,t.key),this.keyedMap=qu(),this.sortedSet=new il(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof kf))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new kf;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Nf{constructor(){this.Z_=new il(uc.comparator)}track(e){const t=e.doc.key,n=this.Z_.get(t);n?0!==e.type&&3===n.type?this.Z_=this.Z_.insert(t,e):3===e.type&&1!==n.type?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Z_=this.Z_.remove(t):1===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):Pa():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Pf{constructor(e,t,n,r,i,o,s,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const o=[];return t.forEach((e=>{o.push({type:0,doc:e})})),new Pf(e,t,kf.emptySet(t),o,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Lu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Df{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some((e=>e.ra()))}}class Lf{constructor(){this.queries=Mf(),this.onlineState="Unknown",this.ia=new Set}terminate(){!function(e,t){const n=La(e),r=n.queries;n.queries=Mf(),r.forEach(((e,n)=>{for(const r of n.ta)r.onError(t)}))}(this,new ja(Ma.ABORTED,"Firestore shutting down"))}}function Mf(){return new Wu((e=>Mu(e)),Lu)}async function jf(e,t){const n=La(e);let r=3;const i=t.query;let o=n.queries.get(i);o?!o.na()&&t.ra()&&(r=2):(o=new Df,r=t.ra()?0:1);try{switch(r){case 0:o.ea=await n.onListen(i,!0);break;case 1:o.ea=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Of(e,`Initialization of query '${ju(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,o),o.ta.push(t),t.sa(n.onlineState),o.ea&&t.oa(o.ea)&&Bf(n)}async function Uf(e,t){const n=La(e),r=t.query;let i=3;const o=n.queries.get(r);if(o){const e=o.ta.indexOf(t);e>=0&&(o.ta.splice(e,1),0===o.ta.length?i=t.ra()?0:1:!o.na()&&t.ra()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Vf(e,t){const n=La(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.ta)e.oa(i)&&(r=!0);t.ea=i}}r&&Bf(n)}function Ff(e,t,n){const r=La(e),i=r.queries.get(t);if(i)for(const o of i.ta)o.onError(n);r.queries.delete(t)}function Bf(e){e.ia.forEach((e=>{e.next()}))}var Wf,zf;(zf=Wf||(Wf={}))._a="default",zf.Cache="cache";class Hf{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Pf(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache)return!0;if(!this.ra())return!0;const n="Offline"!==t;return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Pa(e){e=Pf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Wf.Cache}}class Gf{constructor(e){this.key=e}}class qf{constructor(e){this.key=e}}class Kf{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Zu(),this.mutatedKeys=Zu(),this.ya=Fu(e),this.wa=new kf(this.ya)}get Sa(){return this.fa}ba(e,t){const n=t?t.Da:new Nf,r=t?t.wa:this.wa;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,s=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const l=r.get(e),u=Uu(this.query,t)?t:null,d=!!l&&this.mutatedKeys.has(l.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;l&&u?l.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),p=!0):this.va(l,u)||(n.track({type:2,doc:u}),p=!0,(a&&this.ya(u,a)>0||c&&this.ya(u,c)<0)&&(s=!0)):!l&&u?(n.track({type:0,doc:u}),p=!0):l&&!u&&(n.track({type:1,doc:l}),p=!0,(a||c)&&(s=!0)),p&&(u?(o=o.add(u),i=h?i.add(e):i.delete(e)):(o=o.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;o.size>this.query.limit;){const e="F"===this.query.limitType?o.last():o.first();o=o.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{wa:o,Da:n,ls:s,mutatedKeys:i}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const o=e.Da.X_();o.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pa()}};return n(e)-n(t)}(e.type,t.type)||this.ya(e.doc,t.doc))),this.Ca(n),r=null!=r&&r;const s=t&&!r?this.Fa():[],a=0===this.pa.size&&this.current&&!r?1:0,c=a!==this.ga;return this.ga=a,0!==o.length||c?{snapshot:new Pf(this.query,e.wa,i,o,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:s}:{Ma:s}}sa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Nf,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach((e=>this.fa=this.fa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.fa=this.fa.delete(e))),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Zu(),this.wa.forEach((e=>{this.xa(e.key)&&(this.pa=this.pa.add(e.key))}));const t=[];return e.forEach((e=>{this.pa.has(e)||t.push(new qf(e))})),this.pa.forEach((n=>{e.has(n)||t.push(new Gf(n))})),t}Oa(e){this.fa=e.gs,this.pa=Zu();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Pf.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}const $f="SyncEngine";class Yf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Xf{constructor(e){this.key=e,this.Ba=!1}}class Jf{constructor(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new Wu((e=>Mu(e)),Lu),this.qa=new Map,this.Qa=new Set,this.$a=new il(uc.comparator),this.Ua=new Map,this.Ka=new ip,this.Wa={},this.Ga=new Map,this.za=Hh.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}async function Qf(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=_m(e);let i;const o=r.ka.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Na()):i=await em(r,t,n,!0),i}async function Zf(e,t){const n=_m(e);await em(n,t,!0,!1)}async function em(e,t,n,r){const i=await Tp(e.localStore,ku(t)),o=i.targetId,s=e.sharedClientState.addLocalQueryTarget(o,n);let a;return r&&(a=await tm(e,t,o,"current"===s,i.resumeToken)),e.isPrimaryClient&&n&&tf(e.remoteStore,i),a}async function tm(e,t,n,r,i){e.Ha=(t,n,r)=>async function(e,t,n,r){let i=t.view.ba(n);i.ls&&(i=await Ap(e.localStore,t.query,!1).then((e=>{let{documents:n}=e;return t.view.ba(n,i)})));const o=r&&r.targetChanges.get(t.targetId),s=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,o,s);return pm(e,t.targetId,a.Ma),a.snapshot}(e,t,n,r);const o=await Ap(e.localStore,t,!0),s=new Kf(t,o.gs),a=s.ba(o.documents),c=Yd.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),l=s.applyChanges(a,e.isPrimaryClient,c);pm(e,n,l.Ma);const u=new Yf(t,n,s);return e.ka.set(t,u),e.qa.has(n)?e.qa.get(n).push(t):e.qa.set(n,[t]),l.snapshot}async function nm(e,t,n){const r=La(e),i=r.ka.get(t),o=r.qa.get(i.targetId);if(o.length>1)return r.qa.set(i.targetId,o.filter((e=>!Lu(e,t)))),void r.ka.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Cp(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&nf(r.remoteStore,i.targetId),dm(r,i.targetId)})).catch(_c)):(dm(r,i.targetId),await Cp(r.localStore,i.targetId,!0))}async function rm(e,t){const n=La(e),r=n.ka.get(t),i=n.qa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),nf(n.remoteStore,r.targetId))}async function im(e,t){const n=La(e);try{const e=await function(e,t){const n=La(e),r=t.snapshotVersion;let i=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const o=n.ds.newChangeBuffer({trackRemovals:!0});i=n.Ts;const s=[];t.targetChanges.forEach(((o,a)=>{const c=i.get(a);if(!c)return;s.push(n.Hr.removeMatchingKeys(e,o.removedDocuments,a).next((()=>n.Hr.addMatchingKeys(e,o.addedDocuments,a))));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?l=l.withResumeToken(dl.EMPTY_BYTE_STRING,ic.min()).withLastLimboFreeSnapshotVersion(ic.min()):o.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(o.resumeToken,r)),i=i.insert(a,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,l,o)&&s.push(n.Hr.updateTargetData(e,l))}));let a=Hu(),c=Zu();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),s.push(wp(e,o,t.documentUpdates).next((e=>{a=e.Vs,c=e.fs}))),!r.isEqual(ic.min())){const t=n.Hr.getLastRemoteSnapshotVersion(e).next((t=>n.Hr.setTargetsMetadata(e,e.currentSequenceNumber,r)));s.push(t)}return Ec.waitFor(s).next((()=>o.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ts=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ua.get(t);r&&(Da(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Ba=!0:e.modifiedDocuments.size>0?Da(r.Ba):e.removedDocuments.size>0&&(Da(r.Ba),r.Ba=!1))})),await gm(n,e,t)}catch(e){await _c(e)}}function om(e,t,n){const r=La(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ka.forEach(((n,r)=>{const i=r.view.sa(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=La(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.ta)i.sa(t)&&(r=!0)})),r&&Bf(n)}(r.eventManager,t),e.length&&r.La.p_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function sm(e,t,n){const r=La(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Ua.get(t),o=i&&i.key;if(o){let e=new il(uc.comparator);e=e.insert(o,Jl.newNoDocument(o,ic.min()));const n=Zu().add(o),i=new $d(ic.min(),new Map,new il(Xa),e,n);await im(r,i),r.$a=r.$a.remove(o),r.Ua.delete(t),mm(r)}else await Cp(r.localStore,t,!1).then((()=>dm(r,t,n))).catch(_c)}async function am(e,t){const n=La(e),r=t.batch.batchId;try{const e=await function(e,t){const n=La(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.ds.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,o=i.keys();let s=Ec.resolve();return o.forEach((e=>{s=s.next((()=>r.getEntry(t,e))).next((t=>{const o=n.docVersions.get(e);Da(null!==o),t.version.compareTo(o)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),s.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Zu();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);um(n,r,null),lm(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await gm(n,e)}catch(e){await _c(e)}}async function cm(e,t,n){const r=La(e);try{const e=await function(e,t){const n=La(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Da(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);um(r,t,n),lm(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await gm(r,e)}catch(n){await _c(n)}}function lm(e,t){(e.Ga.get(t)||[]).forEach((e=>{e.resolve()})),e.Ga.delete(t)}function um(e,t,n){const r=La(e);let i=r.Wa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Wa[r.currentUser.toKey()]=i}}function dm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.qa.get(t))e.ka.delete(r),n&&e.La.Ja(r,n);e.qa.delete(t),e.isPrimaryClient&&e.Ka.br(t).forEach((t=>{e.Ka.containsKey(t)||hm(e,t)}))}function hm(e,t){e.Qa.delete(t.path.canonicalString());const n=e.$a.get(t);null!==n&&(nf(e.remoteStore,n),e.$a=e.$a.remove(t),e.Ua.delete(n),mm(e))}function pm(e,t,n){for(const r of n)r instanceof Gf?(e.Ka.addReference(r.key,t),fm(e,r)):r instanceof qf?(xa($f,"Document no longer in limbo: "+r.key),e.Ka.removeReference(r.key,t),e.Ka.containsKey(r.key)||hm(e,r.key)):Pa()}function fm(e,t){const n=t.key,r=n.path.canonicalString();e.$a.get(n)||e.Qa.has(r)||(xa($f,"New document in limbo: "+n),e.Qa.add(r),mm(e))}function mm(e){for(;e.Qa.size>0&&e.$a.size<e.maxConcurrentLimboResolutions;){const t=e.Qa.values().next().value;e.Qa.delete(t);const n=new uc(ac.fromString(t)),r=e.za.next();e.Ua.set(r,new Xf(n)),e.$a=e.$a.insert(n,r),tf(e.remoteStore,new Lh(ku(Ru(n.path)),r,"TargetPurposeLimboResolution",Sc.ae))}}async function gm(e,t,n){const r=La(e),i=[],o=[],s=[];r.ka.isEmpty()||(r.ka.forEach(((e,a)=>{s.push(r.Ha(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=fp.Yi(a.targetId,e);o.push(t)}})))})),await Promise.all(s),r.La.p_(i),await async function(e,t){const n=La(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ec.forEach(t,(t=>Ec.forEach(t.Hi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ec.forEach(t.Ji,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!wc(e))throw e;xa(vp,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ts.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ts=n.Ts.insert(e,i)}}}(r.localStore,o))}async function vm(e,t){const n=La(e);if(!n.currentUser.isEqual(t)){xa($f,"User change. New user:",t.toKey());const e=await Ep(n.localStore,t);n.currentUser=t,function(e,t){e.Ga.forEach((e=>{e.forEach((e=>{e.reject(new ja(Ma.CANCELLED,t))}))})),e.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await gm(n,e.Rs)}}function ym(e,t){const n=La(e),r=n.Ua.get(t);if(r&&r.Ba)return Zu().add(r.key);{let e=Zu();const r=n.qa.get(t);if(!r)return e;for(const t of r){const r=n.ka.get(t);e=e.unionWith(r.view.Sa)}return e}}function _m(e){const t=La(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=im.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ym.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=sm.bind(null,t),t.La.p_=Vf.bind(null,t.eventManager),t.La.Ja=Ff.bind(null,t.eventManager),t}function Em(e){const t=La(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=am.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=cm.bind(null,t),t}class bm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Wp(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return _p(this.persistence,new gp,e.initialUser,this.serializer)}Xa(e){return new up(hp.ri,this.serializer)}Za(e){return new xp}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bm.provider={build:()=>new bm};class wm extends bm{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){Da(this.persistence.referenceDelegate instanceof pp);const n=this.persistence.referenceDelegate.garbageCollector;return new Yh(n,e.asyncQueue,t)}Xa(e){const t=void 0!==this.cacheSizeBytes?zh.withCacheSize(this.cacheSizeBytes):zh.DEFAULT;return new up((e=>pp.ri(e,t)),this.serializer)}}class Sm{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>om(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=vm.bind(null,this.syncEngine),await Af(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Lf}createDatastore(e){const t=Wp(e.databaseInfo.databaseId),n=function(e){return new Fp(e)}(e.databaseInfo);return function(e,t,n,r){return new Yp(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Qp(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>om(this.syncEngine,e,0)),Np.D()?new Np:new Op)}createSyncEngine(e,t){return function(e,t,n,r,i,o,s){const a=new Jf(e,t,n,r,i,o);return s&&(a.ja=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=La(e);xa(Jp,"RemoteStore shutting down."),t.W_.add(5),await ef(t),t.z_.shutdown(),t.j_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Sm.provider={build:()=>new Sm};class Tm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Oa("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Cm{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ja(Ma.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=La(e),r={documents:t.map((e=>mh(n.serializer,e)))},i=await n.Co("BatchGetDocuments",n.serializer.databaseId,ac.emptyPath(),r,t.length),o=new Map;i.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Da(!!t.found),t.found.name,t.found.updateTime;const n=gh(e,t.found.name),r=dh(t.found.updateTime),i=t.found.createTime?dh(t.found.createTime):ic.min(),o=new Yl({mapValue:{fields:t.found.fields}});return Jl.newFoundDocument(n,r,i,o)}(e,t):"missing"in t?function(e,t){Da(!!t.missing),Da(!!t.readTime);const n=gh(e,t.missing),r=dh(t.readTime);return Jl.newNoDocument(n,r)}(e,t):Pa()}(n.serializer,e);o.set(t.key.toString(),t)}));const s=[];return t.forEach((e=>{const t=o.get(e.toString());Da(!!t),s.push(t)})),s}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Nd(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=uc.fromPath(t);this.mutations.push(new Pd(n,this.precondition(n)))})),await async function(e,t){const n=La(e),r={writes:t.map((e=>wh(n.serializer,e)))};await n.So("Commit",n.serializer.databaseId,ac.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Pa();t=ic.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new ja(Ma.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ic.min())?_d.exists(!1):_d.updateTime(t):_d.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ic.min()))throw new ja(Ma.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _d.updateTime(t)}return _d.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Am{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Tu=n.maxAttempts,this.a_=new zp(this.asyncQueue,"transaction_retry")}Iu(){this.Tu-=1,this.Eu()}Eu(){this.a_.Xo((async()=>{const e=new Cm(this.datastore),t=this.du(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Au(e)}))))})).catch((e=>{this.Au(e)}))}))}du(e){try{const t=this.updateFunction(e);return!Cc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Au(e){this.Tu>0&&this.Ru(e)?(this.Tu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Eu(),Promise.resolve())))):this.deferred.reject(e)}Ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Fd(t)}return!1}}const Rm="FirestoreClient";class Im{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ca.UNAUTHENTICATED,this.clientId=Ya.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{xa(Rm,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(xa(Rm,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ua;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(QS){const n=Of(QS,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function xm(e,t){e.asyncQueue.verifyOperationInProgress(),xa(Rm,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Ep(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Om(e,t){e.asyncQueue.verifyOperationInProgress();const n=await km(e);xa(Rm,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Cf(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Cf(t.remoteStore,n))),e._onlineComponents=t}async function km(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){xa(Rm,"Using user provided OfflineComponentProvider");try{await xm(e,e._uninitializedComponentsProvider._offline)}catch(QS){const n=QS;if(!function(e){return"FirebaseError"===e.name?e.code===Ma.FAILED_PRECONDITION||e.code===Ma.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;ka("Error using user provided cache. Falling back to memory cache: "+n),await xm(e,new bm)}}else xa(Rm,"Using default OfflineComponentProvider"),await xm(e,new wm(void 0));return e._offlineComponents}async function Nm(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(xa(Rm,"Using user provided OnlineComponentProvider"),await Om(e,e._uninitializedComponentsProvider._online)):(xa(Rm,"Using default OnlineComponentProvider"),await Om(e,new Sm))),e._onlineComponents}function Pm(e){return Nm(e).then((e=>e.syncEngine))}function Dm(e){return Nm(e).then((e=>e.datastore))}async function Lm(e){const t=await Nm(e),n=t.eventManager;return n.onListen=Qf.bind(null,t.syncEngine),n.onUnlisten=nm.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Zf.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=rm.bind(null,t.syncEngine),n}function Mm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Ua;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const o=new Tm({next:a=>{o.su(),t.enqueueAndForget((()=>Uf(e,s)));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new ja(Ma.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new ja(Ma.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),s=new Hf(Ru(n.path),o,{includeMetadataChanges:!0,Ta:!0});return jf(e,s)}(await Lm(e),e.asyncQueue,t,n,r))),r.promise}function jm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Ua;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const o=new Tm({next:n=>{o.su(),t.enqueueAndForget((()=>Uf(e,s))),n.fromCache&&"server"===r.source?i.reject(new ja(Ma.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),s=new Hf(n,o,{includeMetadataChanges:!0,Ta:!0});return jf(e,s)}(await Lm(e),e.asyncQueue,t,n,r))),r.promise}function Um(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Vm=new Map;function Fm(e,t,n){if(!n)throw new ja(Ma.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Bm(e){if(!uc.isDocumentKey(e))throw new ja(Ma.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Wm(e){if(uc.isDocumentKey(e))throw new ja(Ma.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function zm(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Pa()}function Hm(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ja(Ma.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=zm(e);throw new ja(Ma.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Gm(e,t){if(t<=0)throw new ja(Ma.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const qm="firestore.googleapis.com",Km=!0;class $m{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ja(Ma.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=qm,this.ssl=Km}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Km;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Wh;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<qh)throw new ja(Ma.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new ja(Ma.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Um(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ja(Ma.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ja(Ma.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ja(Ma.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ym{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $m({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ja(Ma.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ja(Ma.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $m(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Fa;switch(e.type){case"firstParty":return new Ha(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ja(Ma.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Vm.get(e);t&&(xa("ComponentProvider","Removing Datastore"),Vm.delete(e),t.terminate())}(this),Promise.resolve()}}class Xm{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Xm(this.firestore,e,this._query)}}class Jm{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Qm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Jm(this.firestore,e,this._key)}}class Qm extends Xm{constructor(e,t,n){super(e,t,Ru(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Jm(this.firestore,null,new uc(e))}withConverter(e){return new Qm(this.firestore,e,this._path)}}function Zm(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=Zt(e),Fm("collection","path",t),e instanceof Ym){const n=ac.fromString(t,...r);return Wm(n),new Qm(e,null,n)}{if(!(e instanceof Jm||e instanceof Qm))throw new ja(Ma.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(ac.fromString(t,...r));return Wm(n),new Qm(e.firestore,null,n)}}function eg(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=Zt(e),1===arguments.length&&(t=Ya.newId()),Fm("doc","path",t),e instanceof Ym){const n=ac.fromString(t,...r);return Bm(n),new Jm(e,null,new uc(n))}{if(!(e instanceof Jm||e instanceof Qm))throw new ja(Ma.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(ac.fromString(t,...r));return Bm(n),new Jm(e.firestore,e instanceof Qm?e.converter:null,new uc(n))}}const tg="AsyncQueue";class ng{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new zp(this,"async_queue_retry"),this.Su=()=>{const e=Bp();e&&xa(tg,"Visibility state changed to "+e.visibilityState),this.a_.t_()},this.bu=e;const t=Bp();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=Bp();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise((()=>{}));const t=new Ua;return this.vu((()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Vu.push(e),this.Cu())))}async Cu(){if(0!==this.Vu.length){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(JS){if(!wc(JS))throw JS;xa(tg,"Operation failed with retryable error: "+JS)}this.Vu.length>0&&this.a_.Xo((()=>this.Cu()))}}vu(e){const t=this.bu.then((()=>(this.pu=!0,e().catch((e=>{this.gu=e,this.pu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Oa("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.pu=!1,e))))));return this.bu=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const r=xf.createAndSchedule(this,e,t,n,(e=>this.Fu(e)));return this.fu.push(r),r}Du(){this.gu&&Pa()}verifyOperationInProgress(){}async Mu(){let e;do{e=this.bu,await e}while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then((()=>{this.fu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.fu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Mu()}))}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}function rg(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class ig extends Ym{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ng,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ng(e),this._firestoreClient=void 0,await e}}}function og(e,t){const n="object"==typeof e?e:yr(),r="string"==typeof e?e:t||Tl,i=hr(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=wt("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const o=(e=Hm(e,Ym))._getSettings(),s=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),a=`${t}:${n}`;o.host!==qm&&o.host!==a&&ka("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=Object.assign(Object.assign({},o),{host:a,ssl:!1,emulatorOptions:r});if(!zt(c,s)&&(e._setSettings(c),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ca.MOCK_USER;else{t=At(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new ja(Ma.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ca(o)}e._authCredentials=new Ba(new Va(t,n))}}(i,...e)}return i}function sg(e){if(e._terminated)throw new ja(Ma.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||ag(e),e._firestoreClient}function ag(e){var t,n,r;const i=e._freezeSettings(),o=function(e,t,n,r){return new Sl(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Um(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Im(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class cg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cg(dl.fromBase64String(e))}catch(e){throw new ja(Ma.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cg(dl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lg{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new ja(Ma.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lc(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ug{constructor(e){this._methodName=e}}class dg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ja(Ma.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ja(Ma.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Xa(this._lat,e._lat)||Xa(this._long,e._long)}}class hg{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const pg=/^__.*__$/;class fg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Id(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rd(e,this.data,t,this.fieldTransforms)}}class mg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Id(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gg(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pa()}}class vg{constructor(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new vg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.$u(e),r}Uu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.Bu(),r}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return jg(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(0===e.length)throw this.Wu("Document fields must not be empty");if(gg(this.Lu)&&pg.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class yg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Wp(e)}ju(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new vg({Lu:e,methodName:t,zu:n,path:lc.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _g(e){const t=e._freezeSettings(),n=Wp(e._databaseId);return new yg(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Eg(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=e.ju(o.merge||o.mergeFields?2:0,t,n,i);Pg("Data must be an object, but it was:",s,r);const a=kg(r,s);let c,l;if(o.merge)c=new ll(s.fieldMask),l=s.fieldTransforms;else if(o.mergeFields){const e=[];for(const r of o.mergeFields){const i=Dg(t,r,n);if(!s.contains(i))throw new ja(Ma.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ug(e,i)||e.push(i)}c=new ll(e),l=s.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=s.fieldTransforms;return new fg(new Yl(a),c,l)}class bg extends ug{_toFieldTransform(e){if(2!==e.Lu)throw 1===e.Lu?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof bg}}function wg(e,t,n){return new vg({Lu:3,zu:t.settings.zu,methodName:e._methodName,Qu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Sg extends ug{_toFieldTransform(e){return new vd(e.path,new ld)}isEqual(e){return e instanceof Sg}}class Tg extends ug{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){const t=wg(this,e,!0),n=this.Hu.map((e=>Og(e,t))),r=new ud(n);return new vd(e.path,r)}isEqual(e){return e instanceof Tg&&zt(this.Hu,e.Hu)}}class Cg extends ug{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){const t=wg(this,e,!0),n=this.Hu.map((e=>Og(e,t))),r=new hd(n);return new vd(e.path,r)}isEqual(e){return e instanceof Cg&&zt(this.Hu,e.Hu)}}class Ag extends ug{constructor(e,t){super(e),this.Ju=t}_toFieldTransform(e){const t=new fd(e.serializer,id(e.serializer,this.Ju));return new vd(e.path,t)}isEqual(e){return e instanceof Ag&&this.Ju===e.Ju}}function Rg(e,t,n,r){const i=e.ju(1,t,n);Pg("Data must be an object, but it was:",i,r);const o=[],s=Yl.empty();nl(r,((e,r)=>{const a=Mg(t,e,n);r=Zt(r);const c=i.Uu(a);if(r instanceof bg)o.push(a);else{const e=Og(r,c);null!=e&&(o.push(a),s.set(a,e))}}));const a=new ll(o);return new mg(s,a,i.fieldTransforms)}function Ig(e,t,n,r,i,o){const s=e.ju(1,t,n),a=[Dg(t,r,n)],c=[i];if(o.length%2!=0)throw new ja(Ma.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<o.length;h+=2)a.push(Dg(t,o[h])),c.push(o[h+1]);const l=[],u=Yl.empty();for(let h=a.length-1;h>=0;--h)if(!Ug(l,a[h])){const e=a[h];let t=c[h];t=Zt(t);const n=s.Uu(e);if(t instanceof bg)l.push(e);else{const r=Og(t,n);null!=r&&(l.push(e),u.set(e,r))}}const d=new ll(l);return new mg(u,d,s.fieldTransforms)}function xg(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Og(n,e.ju(r?4:3,t))}function Og(e,t){if(Ng(e=Zt(e)))return Pg("Unsupported field value:",t,e),kg(e,t);if(e instanceof ug)return function(e,t){if(!gg(t.Lu))throw t.Wu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Wu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Qu&&4!==t.Lu)throw t.Wu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Og(i,t.Ku(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Zt(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return id(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=rc.fromDate(e);return{timestampValue:ch(t.serializer,n)}}if(e instanceof rc){const n=new rc(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ch(t.serializer,n)}}if(e instanceof dg)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cg)return{bytesValue:lh(t.serializer,e._byteString)};if(e instanceof Jm){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Wu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hh(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof hg)return function(e,t){return{mapValue:{fields:{[Al]:{stringValue:xl},[Ol]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Wu("VectorValues must only contain numeric values.");return nd(t.serializer,e)}))}}}}}}(e,t);throw t.Wu(`Unsupported field value: ${zm(e)}`)}(e,t)}function kg(e,t){const n={};return rl(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nl(e,((e,r)=>{const i=Og(r,t.qu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Ng(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof rc||e instanceof dg||e instanceof cg||e instanceof Jm||e instanceof ug||e instanceof hg)}function Pg(e,t,n){if(!Ng(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=zm(n);throw"an object"===r?t.Wu(e+" a custom object"):t.Wu(e+" "+r)}}function Dg(e,t,n){if((t=Zt(t))instanceof lg)return t._internalPath;if("string"==typeof t)return Mg(e,t);throw jg("Field path arguments must be of type string or ",e,!1,void 0,n)}const Lg=new RegExp("[~\\*/\\[\\]]");function Mg(e,t,n){if(t.search(Lg)>=0)throw jg(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new lg(...t.split("."))._internalPath}catch(r){throw jg(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function jg(e,t,n,r,i){const o=r&&!r.isEmpty(),s=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(o||s)&&(c+=" (found",o&&(c+=` in field ${r}`),s&&(c+=` in document ${i}`),c+=")"),new ja(Ma.INVALID_ARGUMENT,a+e+c)}function Ug(e,t){return e.some((e=>e.isEqual(t)))}class Vg{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Jm(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Fg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bg("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Fg extends Vg{data(){return super.data()}}function Bg(e,t){return"string"==typeof t?Mg(e,t):t instanceof lg?t._internalPath:t._delegate._internalPath}function Wg(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ja(Ma.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zg{}class Hg extends zg{}function Gg(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];t instanceof zg&&n.push(t),n=n.concat(i),function(e){const t=e.filter((e=>e instanceof $g)).length,n=e.filter((e=>e instanceof qg)).length;if(t>1||t>0&&n>0)throw new ja(Ma.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)e=s._apply(e);return e}class qg extends Hg{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new qg(e,t,n)}_apply(e){const t=this._parse(e);return tv(e._query,t),new Xm(e.firestore,e.converter,Pu(e._query,t))}_parse(e){const t=_g(e.firestore),n=function(e,t,n,r,i,o,s){let a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new ja(Ma.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){ev(s,o);const t=[];for(const n of s)t.push(Zg(r,e,n));a={arrayValue:{values:t}}}else a=Zg(r,e,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||ev(s,o),a=xg(n,t,s,"in"===o||"not-in"===o);return iu.create(i,o,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Kg(e,t,n){const r=t,i=Bg("where",e);return qg._create(i,r,n)}class $g extends zg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new $g(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:ou.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)tv(n,i),n=Pu(n,i)}(e._query,t),new Xm(e.firestore,e.converter,Pu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Yg extends Hg{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Yg(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new ja(Ma.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ja(Ma.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new tu(t,n)}(e._query,this._field,this._direction);return new Xm(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Cu(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Xg(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Bg("orderBy",e);return Yg._create(n,t)}class Jg extends Hg{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Jg(e,t,n)}_apply(e){return new Xm(e.firestore,e.converter,Du(e._query,this._limit,this._limitType))}}function Qg(e){return Gm("limit",e),Jg._create("limit",e,"F")}function Zg(e,t,n){if("string"==typeof(n=Zt(n))){if(""===n)throw new ja(Ma.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xu(t)&&-1!==n.indexOf("/"))throw new ja(Ma.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ac.fromString(n));if(!uc.isDocumentKey(r))throw new ja(Ma.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fl(e,new uc(r))}if(n instanceof Jm)return Fl(e,n._key);throw new ja(Ma.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${zm(n)}.`)}function ev(e,t){if(!Array.isArray(e)||0===e.length)throw new ja(Ma.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function tv(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new ja(Ma.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ja(Ma.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class nv{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(kl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fl(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ml(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Pa()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return nl(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Ol].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>fl(e.doubleValue)));return new hg(i)}convertGeoPoint(e){return new dg(fl(e.latitude),fl(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=bl(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(wl(e));default:return null}}convertTimestamp(e){const t=pl(e);return new rc(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ac.fromString(e);Da(Dh(n));const r=new Cl(n.get(1),n.get(3)),i=new uc(n.popFirst(5));return r.isEqual(t)||Oa(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function rv(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class iv extends nv{constructor(e){super(),this.firestore=e}convertBytes(e){return new cg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Jm(this.firestore,null,t)}}class ov{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sv extends Vg{constructor(e,t,n,r,i,o){super(e,t,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new av(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Bg("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class av extends sv{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class cv{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ov(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new av(this._firestore,this._userDataWriter,n.key,n,new ov(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ja(Ma.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new av(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ov(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new av(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ov(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,o=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),o=n.indexOf(t.doc.key)),{type:lv(t.type),doc:r,oldIndex:i,newIndex:o}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function lv(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pa()}}function uv(e){e=Hm(e,Jm);const t=Hm(e.firestore,ig);return Mm(sg(t),e._key).then((n=>_v(t,e,n)))}class dv extends nv{constructor(e){super(),this.firestore=e}convertBytes(e){return new cg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Jm(this.firestore,null,t)}}function hv(e){e=Hm(e,Xm);const t=Hm(e.firestore,ig),n=sg(t),r=new dv(t);return Wg(e._query),jm(n,e._query).then((n=>new cv(t,r,e,n)))}function pv(e,t,n){e=Hm(e,Jm);const r=Hm(e.firestore,ig),i=rv(e.converter,t,n);return yv(r,[Eg(_g(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,_d.none())])}function fv(e,t,n){e=Hm(e,Jm);const r=Hm(e.firestore,ig),i=_g(r);let o;for(var s=arguments.length,a=new Array(s>3?s-3:0),c=3;c<s;c++)a[c-3]=arguments[c];return o="string"==typeof(t=Zt(t))||t instanceof lg?Ig(i,"updateDoc",e._key,t,n,a):Rg(i,"updateDoc",e._key,t),yv(r,[o.toMutation(e._key,_d.exists(!0))])}function mv(e){return yv(Hm(e.firestore,ig),[new Nd(e._key,_d.none())])}function gv(e,t){const n=Hm(e.firestore,ig),r=eg(e),i=rv(e.converter,t);return yv(n,[Eg(_g(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,_d.exists(!1))]).then((()=>r))}function vv(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,o,s;e=Zt(e);let a={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof n[c]||rg(n[c])||(a=n[c],c++);const l={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(rg(n[c])){const e=n[c];n[c]=null===(i=e.next)||void 0===i?void 0:i.bind(e),n[c+1]=null===(o=e.error)||void 0===o?void 0:o.bind(e),n[c+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let u,d,h;if(e instanceof Jm)d=Hm(e.firestore,ig),h=Ru(e._key.path),u={next:t=>{n[c]&&n[c](_v(d,e,t))},error:n[c+1],complete:n[c+2]};else{const t=Hm(e,Xm);d=Hm(t.firestore,ig),h=t._query;const r=new dv(d);u={next:e=>{n[c]&&n[c](new cv(d,r,t,e))},error:n[c+1],complete:n[c+2]},Wg(e._query)}return function(e,t,n,r){const i=new Tm(r),o=new Hf(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>jf(await Lm(e),o))),()=>{i.su(),e.asyncQueue.enqueueAndForget((async()=>Uf(await Lm(e),o)))}}(sg(d),h,l,u)}function yv(e,t){return function(e,t){const n=new Ua;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Em(e);try{const e=await function(e,t){const n=La(e),r=rc.now(),i=t.reduce(((e,t)=>e.add(t.key)),Zu());let o,s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Hu(),c=Zu();return n.ds.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{o=i;const s=[];for(const e of t){const t=Cd(e,o.get(e.key).overlayedDocument);null!=t&&s.push(new Id(e.key,t,Xl(t.value.mapValue),_d.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,s,t)})).next((t=>{s=t;const r=t.applyToLocalDocumentSet(o,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:s.batchId,changes:Ku(o)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Wa[e.currentUser.toKey()];r||(r=new il(Xa)),r=r.insert(t,n),e.Wa[e.currentUser.toKey()]=r}(r,e.batchId,n),await gm(r,e.changes),await gf(r.remoteStore)}catch(e){const t=Of(e,"Failed to persist write");n.reject(t)}}(await Pm(e),t,n))),n.promise}(sg(e),t)}function _v(e,t,n){const r=n.docs.get(t._key),i=new dv(e);return new sv(e,i,t._key,r,new ov(n.hasPendingWrites,n.fromCache),t.converter)}const Ev={maxAttempts:5};class bv{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=_g(e)}set(e,t,n){this._verifyNotCommitted();const r=wv(e,this._firestore),i=rv(r.converter,t,n),o=Eg(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,_d.none())),this}update(e,t,n){this._verifyNotCommitted();const r=wv(e,this._firestore);let i;for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];return i="string"==typeof(t=Zt(t))||t instanceof lg?Ig(this._dataReader,"WriteBatch.update",r._key,t,n,s):Rg(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(i.toMutation(r._key,_d.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=wv(e,this._firestore);return this._mutations=this._mutations.concat(new Nd(t._key,_d.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ja(Ma.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function wv(e,t){if((e=Zt(e)).firestore!==t)throw new ja(Ma.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Sv{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=_g(e)}get(e){const t=wv(e,this._firestore),n=new iv(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Pa();const r=e[0];if(r.isFoundDocument())return new Vg(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Vg(this._firestore,n,t._key,null,t.converter);throw Pa()}))}set(e,t,n){const r=wv(e,this._firestore),i=rv(r.converter,t,n),o=Eg(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this}update(e,t,n){const r=wv(e,this._firestore);let i;for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];return i="string"==typeof(t=Zt(t))||t instanceof lg?Ig(this._dataReader,"Transaction.update",r._key,t,n,s):Rg(this._dataReader,"Transaction.update",r._key,t),this._transaction.update(r._key,i),this}delete(e){const t=wv(e,this._firestore);return this._transaction.delete(t._key),this}}class Tv extends Sv{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=wv(e,this._firestore),n=new dv(this._firestore);return super.get(e).then((e=>new sv(this._firestore,n,t._key,e._document,new ov(!1,!1),t.converter)))}}function Cv(e,t,n){e=Hm(e,ig);const r=Object.assign(Object.assign({},Ev),n);return function(e){if(e.maxAttempts<1)throw new ja(Ma.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Ua;return e.asyncQueue.enqueueAndForget((async()=>{const i=await Dm(e);new Am(e.asyncQueue,i,n,t,r).Iu()})),r.promise}(sg(e),(n=>t(new Tv(e,n))),r)}function Av(){return new Sg("serverTimestamp")}function Rv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Tg("arrayUnion",t)}function Iv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Cg("arrayRemove",t)}function xv(e){return new Ag("increment",e)}function Ov(e){return sg(e=Hm(e,ig)),new bv(e,(t=>yv(e,t)))}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Aa=e}(gr),dr(new en("firestore",((e,n)=>{let{instanceIdentifier:r,options:i}=n;const o=e.getProvider("app").getImmediate(),s=new ig(new Wa(e.getProvider("auth-internal")),new qa(o,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ja(Ma.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cl(e.options.projectId,t)}(o,r),o);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),_r(Sa,Ta,e),_r(Sa,Ta,"esm2017")}();const kv="firebasestorage.googleapis.com",Nv="storageBucket";class Pv extends Pt{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(Mv(e),`Firebase Storage: ${t} (${Mv(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Pv.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Mv(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Dv,Lv;function Mv(e){return"storage/"+e}function jv(){return new Pv(Dv.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Uv(){return new Pv(Dv.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Vv(){return new Pv(Dv.CANCELED,"User canceled the upload/download.")}function Fv(){return new Pv(Dv.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Bv(e){return new Pv(Dv.INVALID_ARGUMENT,e)}function Wv(){return new Pv(Dv.APP_DELETED,"The Firebase app was deleted.")}function zv(e,t){return new Pv(Dv.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Hv(e){throw new Pv(Dv.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Dv||(Dv={}));class Gv{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Gv.makeFromUrl(e,t)}catch(JS){return new Gv(e,"")}if(""===n.path)return n;throw r=e,new Pv(Dv.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function o(e){e.path_=decodeURIComponent(e.path)}const s=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${s}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp(`^https?://${t===kv?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let c=0;c<a.length;c++){const t=a[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new Gv(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new Pv(Dv.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class qv{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function Kv(e){return"string"===typeof e||e instanceof String}function $v(e){return Yv()&&e instanceof Blob}function Yv(){return"undefined"!==typeof Blob}function Xv(e,t,n,r){if(r<t)throw Bv(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Bv(`Invalid value for '${e}'. Expected ${n} or less.`)}function Jv(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Qv(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function Zv(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Lv||(Lv={}));class ey{constructor(e,t,n,r,i,o,s,a,c,l,u){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=s,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new ty(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Lv.NO_ERROR,i=n.getStatus();if(!t||Zv(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Lv.ABORT;return void e(!1,new ty(!1,null,t))}const o=-1!==this.successCodes_.indexOf(i);e(!0,new ty(o,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(JS){r(JS)}else if(null!==i){const e=jv();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?Wv():Vv())}else{r(Uv())}};this.canceled_?t(0,new ty(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,o=null,s=!1,a=0;function c(){return 2===a}let l=!1;function u(){if(!l){l=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function d(t){i=setTimeout((()=>{i=null,e(p,c())}),t)}function h(){o&&clearTimeout(o)}function p(e){if(l)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e)return h(),void u.call(null,e,...n);if(c()||s)return h(),void u.call(null,e,...n);let o;r<64&&(r*=2),1===a?(a=2,o=0):o=1e3*(r+Math.random()),d(o)}let f=!1;function m(e){f||(f=!0,h(),l||(null!==i?(e||(a=2),clearTimeout(i),d(0)):e||(a=1)))}return d(0),o=setTimeout((()=>{s=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class ty{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function ny(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function ry(){const e=ny();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(Yv())return new Blob(n);throw new Pv(Dv.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function iy(e){if("undefined"===typeof atob)throw t="base-64",new Pv(Dv.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const oy="raw",sy="base64",ay="base64url",cy="data_url";class ly{constructor(e,t){this.data=e,this.contentType=t||null}}function uy(e,t){switch(e){case oy:return new ly(dy(t));case sy:case ay:return new ly(hy(e,t));case cy:return new ly(function(e){const t=new py(e);return t.base64?hy(sy,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(JS){throw zv(cy,"Malformed data URL.")}return dy(t)}(t.rest)}(t),new py(t).contentType)}throw jv()}function dy(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function hy(e,t){switch(e){case sy:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw zv(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case ay:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw zv(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=iy(t)}catch(JS){if(JS.message.includes("polyfill"))throw JS;throw zv(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class py{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw zv(cy,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){const n=e.length>=t.length;if(!n)return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class fy{constructor(e,t){let n=0,r="";$v(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if($v(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new fy(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new fy(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Yv()){const e=t.map((e=>e instanceof fy?e.data_:e));return new fy(ry.apply(null,e))}{const e=t.map((e=>Kv(e)?uy(oy,e).data:e.data_));let n=0;e.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return e.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new fy(r,!0)}}uploadData(){return this.data_}}function my(e){let t;try{t=JSON.parse(e)}catch(JS){return null}return function(e){return"object"===typeof e&&!Array.isArray(e)}(t)?t:null}function gy(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function vy(e,t){return t}class yy{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||vy}}let _y=null;function Ey(){if(_y)return _y;const e=[];e.push(new yy("bucket")),e.push(new yy("generation")),e.push(new yy("metageneration")),e.push(new yy("name","fullPath",!0));const t=new yy("name");t.xform=function(e,t){return function(e){return!Kv(e)||e.length<2?e:gy(e)}(t)},e.push(t);const n=new yy("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new yy("timeCreated")),e.push(new yy("updated")),e.push(new yy("md5Hash",null,!0)),e.push(new yy("cacheControl",null,!0)),e.push(new yy("contentDisposition",null,!0)),e.push(new yy("contentEncoding",null,!0)),e.push(new yy("contentLanguage",null,!0)),e.push(new yy("contentType",null,!0)),e.push(new yy("metadata","customMetadata",!0)),_y=e,_y}function by(e,t,n){const r={type:"file"},i=n.length;for(let o=0;o<i;o++){const e=n[o];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new Gv(n,r);return t._makeStorageReference(i)}})}(r,e),r}function wy(e,t,n){const r=my(t);if(null===r)return null;return by(e,r,n)}function Sy(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class Ty{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Cy(e){if(!e)throw jv()}function Ay(e,t){return function(n,r){const i=wy(e,r,t);return Cy(null!==i),i}}function Ry(e,t){return function(n,r){const i=wy(e,r,t);return Cy(null!==i),function(e,t,n,r){const i=my(t);if(null===i)return null;if(!Kv(i.downloadTokens))return null;const o=i.downloadTokens;if(0===o.length)return null;const s=encodeURIComponent;return o.split(",").map((t=>{const i=e.bucket,o=e.fullPath;return Jv("/b/"+s(i)+"/o/"+s(o),n,r)+Qv({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}function Iy(e){return function(t,n){let r;var i,o;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Pv(Dv.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Pv(Dv.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(o=e.bucket,r=new Pv(Dv.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Pv(Dv.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function xy(e){const t=Iy(e);return function(n,r){let i=t(n,r);var o;return 404===n.getStatus()&&(o=e.path,i=new Pv(Dv.OBJECT_NOT_FOUND,"Object '"+o+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function Oy(e,t,n){const r=Jv(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,o=new Ty(r,"GET",Ay(e,n),i);return o.errorHandler=xy(t),o}function ky(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function Ny(e,t,n,r,i){const o=t.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();s["Content-Type"]="multipart/related; boundary="+a;const c=ky(t,r,i),l="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Sy(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",u="\r\n--"+a+"--",d=fy.getBlob(l,r,u);if(null===d)throw Fv();const h={name:c.fullPath},p=Jv(o,e.host,e._protocol),f=e.maxUploadRetryTime,m=new Ty(p,"POST",Ay(e,n),f);return m.urlParams=h,m.headers=s,m.body=d.uploadData(),m.errorHandler=Iy(t),m}class Py{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function Dy(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(JS){Cy(!1)}return Cy(!!n&&-1!==(t||["active"]).indexOf(n)),n}const Ly=262144;function My(e,t,n,r,i,o,s,a){const c=new Py(0,0);if(s?(c.current=s.current,c.total=s.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Pv(Dv.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const l=c.total-c.current;let u=l;i>0&&(u=Math.min(u,i));const d=c.current,h=d+u;let p="";p=0===u?"finalize":l===u?"upload, finalize":"upload";const f={"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":`${c.current}`},m=r.slice(d,h);if(null===m)throw Fv();const g=t.maxUploadRetryTime,v=new Ty(n,"POST",(function(e,n){const i=Dy(e,["active","final"]),s=c.current+u,a=r.size();let l;return l="final"===i?Ay(t,o)(e,n):null,new Py(s,a,"final"===i,l)}),g);return v.headers=f,v.body=m.uploadData(),v.progressCallback=a||null,v.errorHandler=Iy(e),v}const jy="running",Uy="paused",Vy="success",Fy="canceled",By="error";function Wy(e){switch(e){case"running":case"pausing":case"canceling":return jy;case"paused":return Uy;case"success":return Vy;case"canceled":return Fy;default:return By}}class zy{constructor(e,t,n){const r=function(e){return"function"===typeof e}(e)||null!=t||null!=n;if(r)this.next=e,this.error=null!==t&&void 0!==t?t:void 0,this.complete=null!==n&&void 0!==n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function Hy(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];Promise.resolve().then((()=>e(...n)))}}class Gy{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Lv.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Lv.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Lv.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Hv("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Hv("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Hv("cannot .getStatus() before sending");try{return this.xhr_.status}catch(JS){return-1}}getResponse(){if(!this.sent_)throw Hv("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Hv("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class qy extends Gy{initXhr(){this.xhr_.responseType="text"}}function Ky(){return new qy}class $y{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=Ey(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(Dv.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(Zv(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=Uv()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(Dv.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((t=>{let[n,r]=t;switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const o=t.bucketOnlyServerUrl(),s=ky(t,r,i),a={name:s.fullPath},c=Jv(o,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},u=Sy(s,n),d=e.maxUploadRetryTime,h=new Ty(c,"POST",(function(e){let t;Dy(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(JS){Cy(!1)}return Cy(Kv(t)),t}),d);return h.urlParams=a,h.headers=l,h.body=u,h.errorHandler=Iy(t),h}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Ky,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,o=new Ty(n,"POST",(function(e){const t=Dy(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(JS){Cy(!1)}n||Cy(!1);const i=Number(n);return Cy(!isNaN(i)),new Py(i,r.size(),"final"===t)}),i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=Iy(t),o}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Ky,t,n);this._request=i,i.getPromise().then((e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=Ly*this._chunkMultiplier,t=new Py(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let o;try{o=My(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(JS){return this._error=JS,void this._transition("error")}const s=this._ref.storage._makeRequest(o,Ky,r,i,!1);this._request=s,s.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){2*(Ly*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=Oy(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Ky,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=Ny(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Ky,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=Vv(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Wy(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new zy(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Wy(this._state)){case Vy:Hy(this._resolve.bind(null,this.snapshot))();break;case Fy:case By:Hy(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Wy(this._state)){case jy:case Uy:e.next&&Hy(e.next.bind(e,this.snapshot))();break;case Vy:e.complete&&Hy(e.complete.bind(e))();break;default:e.error&&Hy(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Yy{constructor(e,t){this._service=e,this._location=t instanceof Gv?t:Gv.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Yy(e,t)}get root(){const e=new Gv(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gy(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Gv(this._location.bucket,e);return new Yy(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Pv(Dv.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Xy(e,t,n){e._throwIfRoot("uploadBytes");const r=Ny(e.storage,e._location,Ey(),new fy(t,!0),n);return e.storage.makeRequestWithTokens(r,Ky).then((t=>({metadata:t,ref:e})))}function Jy(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Jv(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,o=new Ty(r,"GET",Ry(e,n),i);return o.errorHandler=xy(t),o}(e.storage,e._location,Ey());return e.storage.makeRequestWithTokens(t,Ky).then((e=>{if(null===e)throw new Pv(Dv.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function Qy(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=Jv(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new Ty(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=xy(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Ky)}function Zy(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new Gv(e._location.bucket,n);return new Yy(e.storage,r)}function e_(e,t){if(e instanceof r_){const n=e;if(null==n._bucket)throw new Pv(Dv.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Nv+"' property when initializing the app?");const r=new Yy(n,n._bucket);return null!=t?e_(r,t):r}return void 0!==t?Zy(e,t):e}function t_(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof r_)return new Yy(e,t);throw Bv("To use ref(service, url), the first argument must be a Storage instance.")}return e_(e,t)}function n_(e,t){const n=null===t||void 0===t?void 0:t[Nv];return null==n?null:Gv.makeFromBucketSpec(n,e)}class r_{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=kv,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Gv.makeFromBucketSpec(r,this._host):n_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Gv.makeFromBucketSpec(this._url,e):this._bucket=n_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Xv("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Xv("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(pr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Yy(this,e)}_makeRequest(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new qv(Wv());{const o=function(e,t,n,r,i,o){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=Qv(e.urlParams),c=e.url+a,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(l,o),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,r),new ey(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,s)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then((()=>this._requests.delete(o)),(()=>this._requests.delete(o))),o}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const i_="@firebase/storage",o_="0.13.7",s_="storage";function a_(e,t,n){return Xy(e=Zt(e),t,n)}function c_(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new $y(e,new fy(t),n)}(e=Zt(e),t,n)}function l_(e){return Jy(e=Zt(e))}function u_(e,t){return t_(e=Zt(e),t)}function d_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr(),t=arguments.length>1?arguments[1]:void 0;e=Zt(e);const n=hr(e,s_).getImmediate({identifier:t}),r=wt("storage");return r&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:At(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}function h_(e,t){let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new r_(r,i,o,n,gr)}dr(new en(s_,h_,"PUBLIC").setMultipleInstances(!0)),_r(i_,o_,""),_r(i_,o_,"esm2017");const p_="@firebase/database",f_="1.0.14";let m_="";function g_(e){m_=e}class v_{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),jt(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Mt(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class y_{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Vt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const __=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new v_(t)}}catch(JS){}return new y_},E_=__("localStorage"),b_=__("sessionStorage"),w_=new hn("@firebase/database"),S_=function(){let e=1;return function(){return e++}}(),T_=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,lt(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new $t;n.update(t);const r=n.digest();return ht.encodeByteArray(r)},C_=function(){let e="";for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=C_.apply(null,n):e+="object"===typeof n?jt(n):n,e+=" "}return e};let A_=null,R_=!0;const I_=function(e,t){lt(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(w_.logLevel=an.VERBOSE,A_=w_.log.bind(w_),t&&b_.set("logging_enabled",!0)):"function"===typeof e?A_=e:(A_=null,b_.remove("logging_enabled"))},x_=function(){if(!0===R_&&(R_=!1,null===A_&&!0===b_.get("logging_enabled")&&I_(!0)),A_){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=C_.apply(null,t);A_(r)}},O_=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];x_(e,...n)}},k_=function(){const e="FIREBASE INTERNAL ERROR: "+C_(...arguments);w_.error(e)},N_=function(){const e=`FIREBASE FATAL ERROR: ${C_(...arguments)}`;throw w_.error(e),new Error(e)},P_=function(){const e="FIREBASE WARNING: "+C_(...arguments);w_.warn(e)},D_=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},L_="[MIN_NAME]",M_="[MAX_NAME]",j_=function(e,t){if(e===t)return 0;if(e===L_||t===M_)return-1;if(t===L_||e===M_)return 1;{const n=G_(e),r=G_(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},U_=function(e,t){return e===t?0:e<t?-1:1},V_=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+jt(t))},F_=function(e){if("object"!==typeof e||null===e)return jt(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=jt(t[r]),n+=":",n+=F_(e[t[r]]);return n+="}",n},B_=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function W_(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const z_=function(e){lt(!D_(e),"Invalid JSON number");const t=1023;let n,r,i,o,s;0===e?(r=0,i=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=o+t,i=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(c.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()};const H_=new RegExp("^-?(0*)\\d{1,10}$"),G_=function(e){if(H_.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},q_=function(e){try{e()}catch(JS){setTimeout((()=>{const t=JS.stack||"";throw P_("Exception was thrown by user callback.",t),JS}),Math.floor(0))}},K_=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class $_{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,pr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then((e=>this.appCheck=e))}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){P_(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Y_{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(x_("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',P_(e)}}class X_{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}X_.OWNER="owner";const J_="5",Q_=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Z_="ac",eE="websocket",tE="long_polling";class nE{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=a,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=E_.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&E_.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function rE(e,t,n){let r;if(lt("string"===typeof t,"typeof type must == string"),lt("object"===typeof n,"typeof params must == object"),t===eE)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==tE)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return W_(n,((e,t)=>{i.push(e+"="+t)})),r+i.join("&")}class iE{constructor(){this.counters_={}}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Vt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return vt(this.counters_)}}const oE={},sE={};function aE(e){const t=e.toString();return oE[t]||(oE[t]=new iE),oE[t]}class cE{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&q_((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const lE="start";class uE{constructor(e,t,n,r,i,o,s){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=O_(e),this.stats_=aE(t),this.urlFn=e=>(this.appCheckToken&&(e[Z_]=this.appCheckToken),rE(t,tE,e))}open(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new cE(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Ot()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new dE((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,o,s,a,c]=t;if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===lE)n.id=o,n.password=s;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(()=>{n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,o]=t;n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[lE]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=J_,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Z_]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&Q_.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){uE.forceAllow_=!0}static forceDisallow(){uE.forceDisallow_=!0}static isAvailable(){return!Ot()&&(!!uE.forceAllow_||!uE.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=jt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=ft(t),r=B_(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ot())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=jt(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class dE{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Ot())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=S_(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=dE.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(JS){x_("frame writing exception"),JS.stack&&x_(JS.stack),x_(JS)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||x_("No IE domain setting required")}catch(JS){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){Ot()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{x_("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(JS){}}),Math.floor(1))}}let hE=null;"undefined"!==typeof MozWebSocket?hE=MozWebSocket:"undefined"!==typeof WebSocket&&(hE=WebSocket);class pE{constructor(e,t,n,r,i,o,s){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=O_(this.connId),this.stats_=aE(t),this.connURL=pE.connectionURL_(t,o,s,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const o={};return o.v=J_,!Ot()&&"undefined"!==typeof location&&location.hostname&&Q_.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),r&&(o[Z_]=r),i&&(o.p=i),rE(e,eE,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,E_.set("previous_websocket_failure",!0);try{let e;if(Ot()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${J_}/${m_}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ALGOLIA_API_KEY:"b94f7163a6855940c1a0d94e635a307c",REACT_APP_ALGOLIA_APP_ID:"7PVTC2J64R",REACT_APP_ALGOLIA_INDEX_NAME:"searches",REACT_APP_API_URL:"https://sideeye-backend-production.up.railway.app",REACT_APP_FIREBASE_API_KEY:"AIzaSyBI9pvyseKR-5dw3eXuZgTLnG3OcvNGbeI",REACT_APP_FIREBASE_APP_ID:"1:864667627333:web:1ec087179141d1e91a982c",REACT_APP_FIREBASE_AUTH_DOMAIN:"sideeye.uk",REACT_APP_FIREBASE_DATABASE_URL:"https://sideeye-bafda-default-rtdb.europe-west1.firebasedatabase.app",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"864667627333",REACT_APP_FIREBASE_PROJECT_ID:"sideeye-bafda",REACT_APP_FIREBASE_STORAGE_BUCKET:"sideeye-bafda.firebasestorage.app",REACT_APP_SHOTSTACK_API_KEY:"c0Bpc85oj7cHuDdfhz54eQJmmoEI1qauJyodpw9d"},r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new hE(this.connURL,[],e)}catch(JS){this.log_("Error instantiating WebSocket.");const t=JS.message||JS.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){pE.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==hE&&!pE.forceDisallow_}static previouslyFailed(){return E_.isInMemoryStorage||!0===E_.get("previous_websocket_failure")}markConnectionHealthy(){E_.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Mt(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(lt(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=jt(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=B_(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(JS){this.log_("Exception thrown from WebSocket.send():",JS.message||JS.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}pE.responsesRequiredToBeHealthy=2,pE.healthyTimeout=3e4;class fE{static get ALL_TRANSPORTS(){return[uE,pE]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=pE&&pE.isAvailable();let n=t&&!pE.previouslyFailed();if(e.webSocketOnly&&(t||P_("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[pE];else{const e=this.transports_=[];for(const t of fE.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);fE.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}fE.globalTransportInitialized_=!1;class mE{constructor(e,t,n,r,i,o,s,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=O_("c:"+this.id+":"),this.transportManager_=new fE(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=K_((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=V_("t",e),n=V_("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=V_("t",e),n=V_("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=V_("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?k_("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):k_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),J_!==n&&P_("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),K_((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):K_((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(E_.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class gE{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class vE{constructor(e){this.allowedEvents_=e,this.listeners_={},lt(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(let e=0;e<i.length;e++)i[e].callback.apply(i[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){lt(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class yE extends vE{static getInstance(){return new yE}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||It()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(e){return lt("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class _E{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function EE(){return new _E("")}function bE(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function wE(e){return e.pieces_.length-e.pieceNum_}function SE(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new _E(e.pieces_,t)}function TE(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function CE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function AE(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new _E(t,0)}function RE(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof _E)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new _E(n,0)}function IE(e){return e.pieceNum_>=e.pieces_.length}function xE(e,t){const n=bE(e),r=bE(t);if(null===n)return t;if(n===r)return xE(SE(e),SE(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function OE(e,t){if(wE(e)!==wE(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function kE(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(wE(e)>wE(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class NE{constructor(e,t){this.errorPrefix_=t,this.parts_=CE(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Qt(this.parts_[n]);PE(this)}}function PE(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+DE(e))}function DE(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class LE extends vE{static getInstance(){return new LE}constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}getInitialEvent(e){return lt("visible"===e,"Unknown event type: "+e),[this.visible_]}}const ME=1e3;class jE extends gE{constructor(e,t,n,r,i,o,s,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=s,this.authOverride_=a,this.id=jE.nextPersistentConnectionId_++,this.log_=O_("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ME,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!Ot())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");LE.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&yE.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(jt(i)),lt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Ct,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),lt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),lt(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,(i=>{const o=i.d,s=i.s;jE.warnOnListenWarnings_(o,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==s&&this.removeListen_(n,r),e.onComplete&&e.onComplete(s,o))}))}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&Vt(e,"w")){const n=Ft(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();P_(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Ut(e).claims;return"object"===typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Ut(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),lt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(e=>{r&&setTimeout((()=>{r(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+jt(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):k_("Unrecognized action received from server: "+jt(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){lt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ME,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ME,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ME),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+jE.nextConnectionId_++,i=this.lastSessionId;let o=!1,s=null;const a=function(){s?s.close():(o=!0,n())},c=function(e){lt(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(e)};this.realtime_={close:a,sendRequest:c};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?x_("getToken() completed but was canceled"):(x_("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=c&&c.token,s=new mE(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{P_(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(k_){this.log_("Failed to get token: "+k_),o||(this.repoInfo_.nodeAdmin&&P_(k_),a())}}}interrupt(e){x_("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){x_("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Bt(this.interruptReasons_)&&(this.reconnectDelay_=ME,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>F_(e))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new _E(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){x_("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){x_("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";Ot()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+m_.replace(/\./g,"-")]=1,It()?e["framework.cordova"]=1:xt()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=yE.getInstance().currentlyOnline();return Bt(this.interruptReasons_)&&e}}jE.nextPersistentConnectionId_=0,jE.nextConnectionId_=0;class UE{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new UE(e,t)}}class VE{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new UE(L_,e),r=new UE(L_,t);return 0!==this.compare(n,r)}minPost(){return UE.MIN}}let FE;class BE extends VE{static get __EMPTY_NODE(){return FE}static set __EMPTY_NODE(e){FE=e}compare(e,t){return j_(e.name,t.name)}isDefinedOn(e){throw ut("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return UE.MIN}maxPost(){return new UE(M_,FE)}makePost(e,t){return lt("string"===typeof e,"KeyIndex indexValue must always be a string."),new UE(e,FE)}toString(){return".key"}}const WE=new BE;class zE{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class HE{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:HE.RED,this.left=null!=r?r:GE.EMPTY_NODE,this.right=null!=i?i:GE.EMPTY_NODE}copy(e,t,n,r,i){return new HE(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return GE.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return GE.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,HE.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,HE.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}HE.RED=!0,HE.BLACK=!1;class GE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:GE.EMPTY_NODE;this.comparator_=e,this.root_=t}insert(e,t){return new GE(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,HE.BLACK,null,null))}remove(e){return new GE(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,HE.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new zE(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new zE(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new zE(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new zE(this.root_,null,this.comparator_,!0,e)}}function qE(e,t){return j_(e.name,t.name)}function KE(e,t){return j_(e,t)}let $E;GE.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new HE(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const YE=function(e){return"number"===typeof e?"number:"+z_(e):"string:"+e},XE=function(e){if(e.isLeafNode()){const t=e.val();lt("string"===typeof t||"number"===typeof t||"object"===typeof t&&Vt(t,".sv"),"Priority must be a string or number.")}else lt(e===$E||e.isEmpty(),"priority of unexpected type.");lt(e===$E||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let JE,QE,ZE;class eb{static set __childrenNodeConstructor(e){JE=e}static get __childrenNodeConstructor(){return JE}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eb.__childrenNodeConstructor.EMPTY_NODE;this.value_=e,this.priorityNode_=t,this.lazyHash_=null,lt(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),XE(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new eb(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:eb.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return IE(e)?this:".priority"===bE(e)?this.priorityNode_:eb.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:eb.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=bE(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(lt(".priority"!==n||1===wE(e),".priority must be the last token in a path"),this.updateImmediateChild(n,eb.__childrenNodeConstructor.EMPTY_NODE.updateChild(SE(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+YE(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?z_(this.value_):this.value_,this.lazyHash_=T_(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===eb.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof eb.__childrenNodeConstructor?-1:(lt(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=eb.VALUE_TYPE_ORDER.indexOf(t),i=eb.VALUE_TYPE_ORDER.indexOf(n);return lt(r>=0,"Unknown leaf type: "+t),lt(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}eb.VALUE_TYPE_ORDER=["object","boolean","number","string"];const tb=new class extends VE{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?j_(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return UE.MIN}maxPost(){return new UE(M_,new eb("[PRIORITY-POST]",ZE))}makePost(e,t){const n=QE(e);return new UE(t,new eb("[PRIORITY-POST]",n))}toString(){return".priority"}},nb=Math.log(2);class rb{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/nb,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ib=function(e,t,n,r){e.sort(t);const i=function(t,r){const o=r-t;let s,a;if(0===o)return null;if(1===o)return s=e[t],a=n?n(s):s,new HE(a,s.node,HE.BLACK,null,null);{const c=parseInt(o/2,10)+t,l=i(t,c),u=i(c+1,r);return s=e[c],a=n?n(s):s,new HE(a,s.node,HE.BLACK,l,u)}},o=function(t){let r=null,o=null,s=e.length;const a=function(t,r){const o=s-t,a=s;s-=t;const l=i(o+1,a),u=e[o],d=n?n(u):u;c(new HE(d,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(o=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,HE.BLACK):(a(r,HE.BLACK),a(r,HE.RED))}return o}(new rb(e.length));return new GE(r||t,o)};let ob;const sb={};class ab{static get Default(){return lt(sb&&tb,"ChildrenNode.ts has not been loaded"),ob=ob||new ab({".priority":sb},{".priority":tb}),ob}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ft(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof GE?t:null}hasIndex(e){return Vt(this.indexSet_,e.toString())}addIndex(e,t){lt(e!==WE,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(UE.Wrap);let o,s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();o=r?ib(n,e.getCompare()):sb;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=o,new ab(l,c)}addToIndexes(e,t){const n=Wt(this.indexes_,((n,r)=>{const i=Ft(this.indexSet_,r);if(lt(i,"Missing index implementation for "+r),n===sb){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(UE.Wrap);let o=r.getNext();for(;o;)o.name!==e.name&&n.push(o),o=r.getNext();return n.push(e),ib(n,i.getCompare())}return sb}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new UE(e.name,r))),i.insert(e,e.node)}}));return new ab(n,this.indexSet_)}removeFromIndexes(e,t){const n=Wt(this.indexes_,(n=>{if(n===sb)return n;{const r=t.get(e.name);return r?n.remove(new UE(e.name,r)):n}}));return new ab(n,this.indexSet_)}}let cb;class lb{static get EMPTY_NODE(){return cb||(cb=new lb(new GE(KE),null,ab.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&XE(this.priorityNode_),this.children_.isEmpty()&&lt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||cb}updatePriority(e){return this.children_.isEmpty()?this:new lb(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?cb:t}}getChild(e){const t=bE(e);return null===t?this:this.getImmediateChild(t).getChild(SE(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(lt(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new UE(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const o=r.isEmpty()?cb:this.priorityNode_;return new lb(r,o,i)}}updateChild(e,t){const n=bE(e);if(null===n)return t;{lt(".priority"!==bE(e)||1===wE(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(SE(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(tb,((o,s)=>{t[o]=s.val(e),n++,i&&lb.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+YE(this.getPriority().val())+":"),this.forEachChild(tb,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":T_(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new UE(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new UE(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new UE(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,UE.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,UE.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ub?-1:0}withIndex(e){if(e===WE||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new lb(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===WE||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(tb),n=t.getIterator(tb);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===WE?null:this.indexMap_.get(e.toString())}}lb.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ub=new class extends lb{constructor(){super(new GE(KE),lb.EMPTY_NODE,ab.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return lb.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(UE,{MIN:{value:new UE(L_,lb.EMPTY_NODE)},MAX:{value:new UE(M_,ub)}}),BE.__EMPTY_NODE=lb.EMPTY_NODE,eb.__childrenNodeConstructor=lb,$E=ub,function(e){ZE=e}(ub);function db(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return lb.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),lt(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new eb(e,db(t))}if(e instanceof Array){let n=lb.EMPTY_NODE;return W_(e,((t,r)=>{if(Vt(e,t)&&"."!==t.substring(0,1)){const e=db(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(db(t))}{const n=[];let r=!1;if(W_(e,((e,t)=>{if("."!==e.substring(0,1)){const i=db(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new UE(e,i)))}})),0===n.length)return lb.EMPTY_NODE;const i=ib(n,qE,(e=>e.name),KE);if(r){const e=ib(n,tb.getCompare());return new lb(i,db(t),new ab({".priority":e},{".priority":tb}))}return new lb(i,db(t),ab.Default)}}!function(e){QE=e}(db);class hb extends VE{constructor(e){super(),this.indexPath_=e,lt(!IE(e)&&".priority"!==bE(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?j_(e.name,t.name):i}makePost(e,t){const n=db(e),r=lb.EMPTY_NODE.updateChild(this.indexPath_,n);return new UE(t,r)}maxPost(){const e=lb.EMPTY_NODE.updateChild(this.indexPath_,ub);return new UE(M_,e)}toString(){return CE(this.indexPath_,0).join("/")}}const pb=new class extends VE{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?j_(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return UE.MIN}maxPost(){return UE.MAX}makePost(e,t){const n=db(e);return new UE(t,n)}toString(){return".value"}};function fb(e){return{type:"value",snapshotNode:e}}function mb(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function gb(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function vb(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class yb{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=tb}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return lt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return lt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:L_}hasEnd(){return this.endSet_}getIndexEndValue(){return lt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return lt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:M_}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return lt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===tb}copy(){const e=new yb;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function _b(e){const t={};if(e.isDefault())return t;let n;if(e.index_===tb?n="$priority":e.index_===pb?n="$value":e.index_===WE?n="$key":(lt(e.index_ instanceof hb,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=jt(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=jt(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+jt(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=jt(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+jt(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Eb(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==tb&&(t.i=e.index_.toString()),t}class bb extends gE{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(lt(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=O_("p:rest:"),this.listens_={}}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=bb.getListenId_(e,n),s={};this.listens_[o]=s;const a=_b(e._queryParams);this.restRequest_(i+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),Ft(this.listens_,o)===s){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=bb.getListenId_(e,t);delete this.listens_[n]}get(e){const t=_b(e._queryParams),n=e._path.toString(),r=new Ct;return this.restRequest_(n+".json",t,((e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(e){}restRequest_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((r=>{let[i,o]=r;i&&i.accessToken&&(t.auth=i.accessToken),o&&o.token&&(t.ac=o.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Gt(t);this.log_("Sending REST request for "+s);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=Mt(a.responseText)}catch(JS){P_("Failed to parse JSON response for "+s+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&P_("Got unsuccessful REST response for "+s+" Status: "+a.status),n(a.status);n=null}},a.open("GET",s,!0),a.send()}))}}class wb{constructor(){this.rootNode_=lb.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Sb(){return{value:null,children:new Map}}function Tb(e,t,n){if(IE(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=bE(t);e.children.has(r)||e.children.set(r,Sb());Tb(e.children.get(r),t=SE(t),n)}}function Cb(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Cb(r,new _E(t.toString()+"/"+e),n)}))}class Ab{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&W_(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Rb{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ab(e);const n=1e4+2e4*Math.random();K_(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;W_(e,((e,r)=>{r>0&&Vt(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),K_(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ib;function xb(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Ib||(Ib={}));class Ob{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ib.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(IE(this.path)){if(null!=this.affectedTree.value)return lt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new _E(e));return new Ob(EE(),t,this.revert)}}return lt(bE(this.path)===e,"operationForChild called for unrelated child."),new Ob(SE(this.path),this.affectedTree,this.revert)}}class kb{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ib.OVERWRITE}operationForChild(e){return IE(this.path)?new kb(this.source,EE(),this.snap.getImmediateChild(e)):new kb(this.source,SE(this.path),this.snap)}}class Nb{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ib.MERGE}operationForChild(e){if(IE(this.path)){const t=this.children.subtree(new _E(e));return t.isEmpty()?null:t.value?new kb(this.source,EE(),t.value):new Nb(this.source,EE(),t)}return lt(bE(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Nb(this.source,SE(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Pb{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(IE(e))return this.isFullyInitialized()&&!this.filtered_;const t=bE(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Db(e,t,n,r,i,o){const s=r.filter((e=>e.type===n));s.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw ut("Should only compare child_ events.");const r=new UE(t.childName,t.snapshotNode),i=new UE(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n))),s.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);i.forEach((i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function Lb(e,t){return{eventCache:e,serverCache:t}}function Mb(e,t,n,r){return Lb(new Pb(t,n,r),e.serverCache)}function jb(e,t,n,r){return Lb(e.eventCache,new Pb(t,n,r))}function Ub(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Vb(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Fb;class Bb{static fromObject(e){let t=new Bb(null);return W_(e,((e,n)=>{t=t.set(new _E(e),n)})),t}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(Fb||(Fb=new GE(U_)),Fb);this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:EE(),value:this.value};if(IE(e))return null;{const n=bE(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(SE(e),t);if(null!=i){return{path:RE(new _E(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(IE(e))return this;{const t=bE(e),n=this.children.get(t);return null!==n?n.subtree(SE(e)):new Bb(null)}}set(e,t){if(IE(e))return new Bb(t,this.children);{const n=bE(e),r=(this.children.get(n)||new Bb(null)).set(SE(e),t),i=this.children.insert(n,r);return new Bb(this.value,i)}}remove(e){if(IE(e))return this.children.isEmpty()?new Bb(null):new Bb(null,this.children);{const t=bE(e),n=this.children.get(t);if(n){const r=n.remove(SE(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Bb(null):new Bb(this.value,i)}return this}}get(e){if(IE(e))return this.value;{const t=bE(e),n=this.children.get(t);return n?n.get(SE(e)):null}}setTree(e,t){if(IE(e))return t;{const n=bE(e),r=(this.children.get(n)||new Bb(null)).setTree(SE(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Bb(this.value,i)}}fold(e){return this.fold_(EE(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(RE(e,r),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,EE(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(IE(e))return null;{const r=bE(e),i=this.children.get(r);return i?i.findOnPath_(SE(e),RE(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,EE(),t)}foreachOnPath_(e,t,n){if(IE(e))return this;{this.value&&n(t,this.value);const r=bE(e),i=this.children.get(r);return i?i.foreachOnPath_(SE(e),RE(t,r),n):new Bb(null)}}foreach(e){this.foreach_(EE(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(RE(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Wb{constructor(e){this.writeTree_=e}static empty(){return new Wb(new Bb(null))}}function zb(e,t,n){if(IE(t))return new Wb(new Bb(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let o=r.value;const s=xE(i,t);return o=o.updateChild(s,n),new Wb(e.writeTree_.set(i,o))}{const r=new Bb(n),i=e.writeTree_.setTree(t,r);return new Wb(i)}}}function Hb(e,t,n){let r=e;return W_(n,((e,n)=>{r=zb(r,RE(t,e),n)})),r}function Gb(e,t){if(IE(t))return Wb.empty();{const n=e.writeTree_.setTree(t,new Bb(null));return new Wb(n)}}function qb(e,t){return null!=Kb(e,t)}function Kb(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(xE(n.path,t)):null}function $b(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(tb,((e,n)=>{t.push(new UE(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new UE(e,n.value))})),t}function Yb(e,t){if(IE(t))return e;{const n=Kb(e,t);return new Wb(null!=n?new Bb(n):e.writeTree_.subtree(t))}}function Xb(e){return e.writeTree_.isEmpty()}function Jb(e,t){return Qb(EE(),e.writeTree_,t)}function Qb(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,i)=>{".priority"===t?(lt(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Qb(RE(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(RE(e,".priority"),r)),n}}function Zb(e,t){return hw(t,e)}function ew(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));lt(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,o=!1,s=e.allWrites.length-1;for(;i&&s>=0;){const t=e.allWrites[s];t.visible&&(s>=n&&tw(t,r.path)?i=!1:kE(r.path,t.path)&&(o=!0)),s--}if(i){if(o)return function(e){e.visibleWrites=rw(e.allWrites,nw,EE()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=Gb(e.visibleWrites,r.path);else{W_(r.children,(t=>{e.visibleWrites=Gb(e.visibleWrites,RE(r.path,t))}))}return!0}return!1}function tw(e,t){if(e.snap)return kE(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&kE(RE(e.path,n),t))return!0;return!1}function nw(e){return e.visible}function rw(e,t,n){let r=Wb.empty();for(let i=0;i<e.length;++i){const o=e[i];if(t(o)){const e=o.path;let t;if(o.snap)kE(n,e)?(t=xE(n,e),r=zb(r,t,o.snap)):kE(e,n)&&(t=xE(e,n),r=zb(r,EE(),o.snap.getChild(t)));else{if(!o.children)throw ut("WriteRecord should have .snap or .children");if(kE(n,e))t=xE(n,e),r=Hb(r,t,o.children);else if(kE(e,n))if(t=xE(e,n),IE(t))r=Hb(r,EE(),o.children);else{const e=Ft(o.children,bE(t));if(e){const n=e.getChild(SE(t));r=zb(r,EE(),n)}}}}}return r}function iw(e,t,n,r,i){if(r||i){const o=Yb(e.visibleWrites,t);if(!i&&Xb(o))return n;if(i||null!=n||qb(o,EE())){const o=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(kE(e.path,t)||kE(t,e.path))};return Jb(rw(e.allWrites,o,t),n||lb.EMPTY_NODE)}return null}{const r=Kb(e.visibleWrites,t);if(null!=r)return r;{const r=Yb(e.visibleWrites,t);if(Xb(r))return n;if(null!=n||qb(r,EE())){return Jb(r,n||lb.EMPTY_NODE)}return null}}}function ow(e,t,n,r){return iw(e.writeTree,e.treePath,t,n,r)}function sw(e,t){return function(e,t,n){let r=lb.EMPTY_NODE;const i=Kb(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(tb,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const i=Yb(e.visibleWrites,t);return n.forEachChild(tb,((e,t)=>{const n=Jb(Yb(i,new _E(e)),t);r=r.updateImmediateChild(e,n)})),$b(i).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return $b(Yb(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function aw(e,t,n,r){return function(e,t,n,r,i){lt(r||i,"Either existingEventSnap or existingServerSnap must exist");const o=RE(t,n);if(qb(e.visibleWrites,o))return null;{const t=Yb(e.visibleWrites,o);return Xb(t)?i.getChild(n):Jb(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function cw(e,t){return function(e,t){return Kb(e.visibleWrites,t)}(e.writeTree,RE(e.treePath,t))}function lw(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){let a;const c=Yb(e.visibleWrites,t),l=Kb(c,EE());if(null!=l)a=l;else{if(null==n)return[];a=Jb(c,n)}if(a=a.withIndex(s),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=s.getCompare(),n=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,o)}function uw(e,t,n){return function(e,t,n,r){const i=RE(t,n),o=Kb(e.visibleWrites,i);if(null!=o)return o;if(r.isCompleteForChild(n))return Jb(Yb(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function dw(e,t){return hw(RE(e.treePath,t),e.writeTree)}function hw(e,t){return{treePath:e,writeTree:t}}class pw{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;lt("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),lt(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,vb(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,gb(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,mb(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ut("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,vb(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const fw=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class mw{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Pb(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return uw(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Vb(this.viewCache_),i=lw(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function gw(e,t,n,r,i){const o=new pw;let s,a;if(n.type===Ib.OVERWRITE){const c=n;c.source.fromUser?s=_w(e,t,c.path,c.snap,r,i,o):(lt(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!IE(c.path),s=yw(e,t,c.path,c.snap,r,i,a,o))}else if(n.type===Ib.MERGE){const c=n;c.source.fromUser?s=function(e,t,n,r,i,o,s){let a=t;return r.foreach(((r,c)=>{const l=RE(n,r);Ew(t,bE(l))&&(a=_w(e,a,l,c,i,o,s))})),r.foreach(((r,c)=>{const l=RE(n,r);Ew(t,bE(l))||(a=_w(e,a,l,c,i,o,s))})),a}(e,t,c.path,c.children,r,i,o):(lt(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),s=ww(e,t,c.path,c.children,r,i,a,o))}else if(n.type===Ib.ACK_USER_WRITE){const a=n;s=a.revert?function(e,t,n,r,i,o){let s;if(null!=cw(r,n))return t;{const a=new mw(r,t,i),c=t.eventCache.getNode();let l;if(IE(n)||".priority"===bE(n)){let n;if(t.serverCache.isFullyInitialized())n=ow(r,Vb(t));else{const e=t.serverCache.getNode();lt(e instanceof lb,"serverChildren would be complete if leaf node"),n=sw(r,e)}l=e.filter.updateFullNode(c,n,o)}else{const i=bE(n);let u=uw(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),l=null!=u?e.filter.updateChild(c,i,u,SE(n),a,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,lb.EMPTY_NODE,SE(n),a,o):c,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(s=ow(r,Vb(t)),s.isLeafNode()&&(l=e.filter.updateFullNode(l,s,o)))}return s=t.serverCache.isFullyInitialized()||null!=cw(r,EE()),Mb(t,l,s,e.filter.filtersNodes())}}(e,t,a.path,r,i,o):function(e,t,n,r,i,o,s){if(null!=cw(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(IE(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return yw(e,t,n,c.getNode().getChild(n),i,o,a,s);if(IE(n)){let r=new Bb(null);return c.getNode().forEachChild(WE,((e,t)=>{r=r.set(new _E(e),t)})),ww(e,t,n,r,i,o,a,s)}return t}{let l=new Bb(null);return r.foreach(((e,t)=>{const r=RE(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))})),ww(e,t,n,l,i,o,a,s)}}(e,t,a.path,a.affectedTree,r,i,o)}else{if(n.type!==Ib.LISTEN_COMPLETE)throw ut("Unknown operation type: "+n.type);s=function(e,t,n,r,i){const o=t.serverCache,s=jb(t,o.getNode(),o.isFullyInitialized()||IE(n),o.isFiltered());return vw(e,s,n,r,fw,i)}(e,t,n.path,r,o)}const c=o.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Ub(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(fb(Ub(t)))}}(t,s,c),{viewCache:s,changes:c}}function vw(e,t,n,r,i,o){const s=t.eventCache;if(null!=cw(r,n))return t;{let a,c;if(IE(n))if(lt(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Vb(t),i=sw(r,n instanceof lb?n:lb.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=ow(r,Vb(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const l=bE(n);if(".priority"===l){lt(1===wE(n),"Can't have a priority with additional path components");const i=s.getNode();c=t.serverCache.getNode();const o=aw(r,n,i,c);a=null!=o?e.filter.updatePriority(i,o):s.getNode()}else{const u=SE(n);let d;if(s.isCompleteForChild(l)){c=t.serverCache.getNode();const e=aw(r,n,s.getNode(),c);d=null!=e?s.getNode().getImmediateChild(l).updateChild(u,e):s.getNode().getImmediateChild(l)}else d=uw(r,l,t.serverCache);a=null!=d?e.filter.updateChild(s.getNode(),l,d,u,i,o):s.getNode()}}return Mb(t,a,s.isFullyInitialized()||IE(n),e.filter.filtersNodes())}}function yw(e,t,n,r,i,o,s,a){const c=t.serverCache;let l;const u=s?e.filter:e.filter.getIndexedFilter();if(IE(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{const e=bE(n);if(!c.isCompleteForPath(n)&&wE(n)>1)return t;const i=SE(n),o=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),o):u.updateChild(c.getNode(),e,o,i,fw,null)}const d=jb(t,l,c.isFullyInitialized()||IE(n),u.filtersNodes());return vw(e,d,n,i,new mw(i,d,o),a)}function _w(e,t,n,r,i,o,s){const a=t.eventCache;let c,l;const u=new mw(i,t,o);if(IE(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,s),c=Mb(t,l,!0,e.filter.filtersNodes());else{const i=bE(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=Mb(t,l,a.isFullyInitialized(),a.isFiltered());else{const o=SE(n),l=a.getNode().getImmediateChild(i);let d;if(IE(o))d=r;else{const e=u.getCompleteChild(i);d=null!=e?".priority"===TE(o)&&e.getChild(AE(o)).isEmpty()?e:e.updateChild(o,r):lb.EMPTY_NODE}if(l.equals(d))c=t;else{c=Mb(t,e.filter.updateChild(a.getNode(),i,d,o,u,s),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function Ew(e,t){return e.eventCache.isCompleteForChild(t)}function bw(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function ww(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=IE(n)?r:new Bb(null).setTree(n,r);const u=t.serverCache.getNode();return c.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const c=bw(0,t.serverCache.getNode().getImmediateChild(n),r);l=yw(e,l,new _E(n),c,i,o,s,a)}})),c.children.inorderTraversal(((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!c){const c=bw(0,t.serverCache.getNode().getImmediateChild(n),r);l=yw(e,l,new _E(n),c,i,o,s,a)}})),l}function Sw(e,t){const n=Vb(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!IE(t)&&!n.getImmediateChild(bE(t)).isEmpty())?n.getChild(t):null}function Tw(e,t,n,r){t.type===Ib.MERGE&&null!==t.source.queryId&&(lt(Vb(e.viewCache_),"We should always have a full cache before handling merges"),lt(Ub(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,o=gw(e.processor_,i,t,n,r);var s,a;return s=e.processor_,a=o.viewCache,lt(a.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),lt(a.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed"),lt(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Cw(e,o.changes,o.viewCache.eventCache.getNode(),null)}function Cw(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],o=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Db(e,i,"child_removed",t,r,n),Db(e,i,"child_added",t,r,n),Db(e,i,"child_moved",o,r,n),Db(e,i,"child_changed",t,r,n),Db(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let Aw,Rw;function Iw(e,t,n,r){const i=t.source.queryId;if(null!==i){const o=e.views.get(i);return lt(null!=o,"SyncTree gave us an op for an invalid query."),Tw(o,t,n,r)}{let i=[];for(const o of e.views.values())i=i.concat(Tw(o,t,n,r));return i}}function xw(e,t){let n=null;for(const r of e.views.values())n=n||Sw(r,t);return n}class Ow{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Bb(null),this.pendingWriteTree_={visibleWrites:Wb.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function kw(e,t,n,r,i){return function(e,t,n,r,i){lt(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=zb(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?Mw(e,new kb({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Nw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(ew(e.pendingWriteTree_,t)){let t=new Bb(null);return null!=r.snap?t=t.set(EE(),!0):W_(r.children,(e=>{t=t.set(new _E(e),!0)})),Mw(e,new Ob(r.path,t,n))}return[]}function Pw(e,t,n){return Mw(e,new kb({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Dw(e,t,n,r){const i=Vw(e,r);if(null!=i){const r=Fw(i),o=r.path,s=r.queryId,a=xE(o,t);return Bw(e,o,new kb(xb(s),a,n))}return[]}function Lw(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,((e,n)=>{const r=xw(n,xE(e,t));if(r)return r}));return iw(r,t,i,n,!0)}function Mw(e,t){return jw(t,e.syncPointTree_,null,Zb(e.pendingWriteTree_,EE()))}function jw(e,t,n,r){if(IE(e.path))return Uw(e,t,n,r);{const i=t.get(EE());null==n&&null!=i&&(n=xw(i,EE()));let o=[];const s=bE(e.path),a=e.operationForChild(s),c=t.children.get(s);if(c&&a){const e=n?n.getImmediateChild(s):null,t=dw(r,s);o=o.concat(jw(a,c,e,t))}return i&&(o=o.concat(Iw(i,e,r,n))),o}}function Uw(e,t,n,r){const i=t.get(EE());null==n&&null!=i&&(n=xw(i,EE()));let o=[];return t.children.inorderTraversal(((t,i)=>{const s=n?n.getImmediateChild(t):null,a=dw(r,t),c=e.operationForChild(t);c&&(o=o.concat(Uw(c,i,s,a)))})),i&&(o=o.concat(Iw(i,e,r,n))),o}function Vw(e,t){return e.tagToQueryMap.get(t)}function Fw(e){const t=e.indexOf("$");return lt(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new _E(e.substr(0,t))}}function Bw(e,t,n){const r=e.syncPointTree_.get(t);lt(r,"Missing sync point for query tag that we're tracking");return Iw(r,n,Zb(e.pendingWriteTree_,t),null)}class Ww{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Ww(t)}node(){return this.node_}}class zw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=RE(this.path_,e);return new zw(this.syncTree_,t)}node(){return Lw(this.syncTree_,this.path_)}}const Hw=function(e,t,n){return e&&"object"===typeof e?(lt(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?Gw(e[".sv"],t,n):"object"===typeof e[".sv"]?qw(e[".sv"],t):void lt(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Gw=function(e,t,n){if("timestamp"===e)return n.timestamp;lt(!1,"Unexpected server value: "+e)},qw=function(e,t,n){e.hasOwnProperty("increment")||lt(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!==typeof r&&lt(!1,"Unexpected increment value: "+r);const i=t.node();if(lt(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return"number"!==typeof o?r:o+r},Kw=function(e,t,n,r){return Yw(t,new zw(n,e),r)},$w=function(e,t,n){return Yw(e,new Ww(t),n)};function Yw(e,t,n){const r=e.getPriority().val(),i=Hw(r,t.getImmediateChild(".priority"),n);let o;if(e.isLeafNode()){const r=e,o=Hw(r.getValue(),t,n);return o!==r.getValue()||i!==r.getPriority().val()?new eb(o,db(i)):e}{const r=e;return o=r,i!==r.getPriority().val()&&(o=o.updatePriority(new eb(i))),r.forEachChild(tb,((e,r)=>{const i=Yw(r,t.getImmediateChild(e),n);i!==r&&(o=o.updateImmediateChild(e,i))})),o}}class Xw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=e,this.parent=t,this.node=n}}function Jw(e,t){let n=t instanceof _E?t:new _E(t),r=e,i=bE(n);for(;null!==i;){const e=Ft(r.node.children,i)||{children:{},childCount:0};r=new Xw(i,r,e),n=SE(n),i=bE(n)}return r}function Qw(e){return e.node.value}function Zw(e,t){e.node.value=t,iS(e)}function eS(e){return e.node.childCount>0}function tS(e,t){W_(e.node.children,((n,r)=>{t(new Xw(n,e,r))}))}function nS(e,t,n,r){n&&!r&&t(e),tS(e,(e=>{nS(e,t,!0,r)})),n&&r&&t(e)}function rS(e){return new _E(null===e.parent?e.name:rS(e.parent)+"/"+e.name)}function iS(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===Qw(e)&&!eS(e)}(n),i=Vt(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,iS(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,iS(e))}(e.parent,e.name,e)}const oS=/[\[\].#$\/\u0000-\u001F\u007F]/,sS=/[\[\].#$\u0000-\u001F\u007F]/,aS=10485760,cS=function(e){return"string"===typeof e&&0!==e.length&&!oS.test(e)},lS=function(e){return"string"===typeof e&&0!==e.length&&!sS.test(e)},uS=function(e,t,n){const r=n instanceof _E?new NE(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+DE(r));if("function"===typeof t)throw new Error(e+"contains a function "+DE(r)+" with contents = "+t.toString());if(D_(t))throw new Error(e+"contains "+t.toString()+" "+DE(r));if("string"===typeof t&&t.length>aS/3&&Qt(t)>aS)throw new Error(e+"contains a string greater than "+aS+" utf8 bytes "+DE(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,i=!1;if(W_(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!cS(t)))throw new Error(e+" contains an invalid key ("+t+") "+DE(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Qt(t),PE(e)}(r,t),uS(e,o,r),function(e){const t=e.parts_.pop();e.byteLength_-=Qt(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),n&&i)throw new Error(e+' contains ".value" child '+DE(r)+" in addition to actual children.")}},dS=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!cS(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),lS(e)}(n))throw new Error(Jt(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class hS{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function pS(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],o=i.getPath();null===n||OE(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function fS(e,t,n){pS(e,n),mS(e,(e=>kE(e,t)||kE(t,e)))}function mS(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(gS(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function gS(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();A_&&x_("event: "+n.toString()),q_(r)}}}const vS="repo_interrupt";class yS{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new hS,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Sb(),this.transactionQueueTree_=new Xw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function _S(e,t,n){if(e.stats_=aE(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new bb(e.repoInfo_,((t,n,r,i)=>{wS(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>SS(e,!0)),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{jt(n)}catch(JS){throw new Error("Invalid authOverride provided: "+JS)}}e.persistentConnection_=new jE(e.repoInfo_,t,((t,n,r,i)=>{wS(e,t,n,r,i)}),(t=>{SS(e,t)}),(t=>{!function(e,t){W_(t,((t,n)=>{TS(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return sE[n]||(sE[n]=t()),sE[n]}(e.repoInfo_,(()=>new Rb(e.stats_,e.server_))),e.infoData_=new wb,e.infoSyncTree_=new Ow({startListening:(t,n,r,i)=>{let o=[];const s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=Pw(e.infoSyncTree_,t._path,s),setTimeout((()=>{i("ok")}),0)),o},stopListening:()=>{}}),TS(e,"connected",!1),e.serverSyncTree_=new Ow({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,((n,r)=>{const o=i(n,r);fS(e.eventQueue_,t._path,o)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function ES(e){const t=e.infoData_.getNode(new _E(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function bS(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:ES(e)})}function wS(e,t,n,r,i){e.dataUpdateCount++;const o=new _E(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let s=[];if(i)if(r){const t=Wt(n,(e=>db(e)));s=function(e,t,n,r){const i=Vw(e,r);if(i){const r=Fw(i),o=r.path,s=r.queryId,a=xE(o,t),c=Bb.fromObject(n);return Bw(e,o,new Nb(xb(s),a,c))}return[]}(e.serverSyncTree_,o,t,i)}else{const t=db(n);s=Dw(e.serverSyncTree_,o,t,i)}else if(r){const t=Wt(n,(e=>db(e)));s=function(e,t,n){const r=Bb.fromObject(n);return Mw(e,new Nb({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,o,t)}else{const t=db(n);s=Pw(e.serverSyncTree_,o,t)}let a=o;s.length>0&&(a=OS(e,o)),fS(e.eventQueue_,a,s)}function SS(e,t){TS(e,"connected",t),!1===t&&function(e){RS(e,"onDisconnectEvents");const t=bS(e),n=Sb();Cb(e.onDisconnect_,EE(),((r,i)=>{const o=Kw(r,i,e.serverSyncTree_,t);Tb(n,r,o)}));let r=[];Cb(n,EE(),((t,n)=>{r=r.concat(Pw(e.serverSyncTree_,t,n));const i=LS(e,t);OS(e,i)})),e.onDisconnect_=Sb(),fS(e.eventQueue_,EE(),r)}(e)}function TS(e,t,n){const r=new _E("/.info/"+t),i=db(n);e.infoData_.updateSnapshot(r,i);const o=Pw(e.infoSyncTree_,r,i);fS(e.eventQueue_,r,o)}function CS(e){return e.nextWriteId_++}function AS(e){e.persistentConnection_&&e.persistentConnection_.interrupt(vS)}function RS(e){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];x_(t,...r)}function IS(e,t,n){return Lw(e.serverSyncTree_,t,n)||lb.EMPTY_NODE}function xS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||DS(e,t),Qw(t)){const n=NS(e,t);lt(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),i=IS(e,t,r);let o=i;const s=i.hash();for(let l=0;l<n.length;l++){const e=n[l];lt(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=xE(t,e.path);o=o.updateChild(r,e.currentOutputSnapshotRaw)}const a=o.val(!0),c=t;e.server_.put(c.toString(),a,(r=>{RS(e,"transaction put response",{path:c.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(Nw(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();DS(e,Jw(e.transactionQueueTree_,t)),xS(e,e.transactionQueueTree_),fS(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)q_(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{P_("transaction at "+c.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}OS(e,t)}}),s)}(e,rS(t),n)}else eS(t)&&tS(t,(t=>{xS(e,t)}))}function OS(e,t){const n=kS(e,t),r=rS(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const o=t.filter((e=>0===e.status)),s=o.map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const o=t[c],l=xE(n,o.path);let u,d=!1;if(lt(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)d=!0,u=o.abortReason,i=i.concat(Nw(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=25)d=!0,u="maxretry",i=i.concat(Nw(e.serverSyncTree_,o.currentWriteId,!0));else{const n=IS(e,o.path,s);o.currentInputSnapshot=n;const r=t[c].update(n.val());if(void 0!==r){uS("transaction failed: Data returned ",r,o.path);let t=db(r);"object"===typeof r&&null!=r&&Vt(r,".priority")||(t=t.updatePriority(n.getPriority()));const a=o.currentWriteId,c=bS(e),l=$w(t,n,c);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=l,o.currentWriteId=CS(e),s.splice(s.indexOf(a),1),i=i.concat(kw(e.serverSyncTree_,o.path,l,o.currentWriteId,o.applyLocally)),i=i.concat(Nw(e.serverSyncTree_,a,!0))}else d=!0,u="nodata",i=i.concat(Nw(e.serverSyncTree_,o.currentWriteId,!0))}fS(e.eventQueue_,n,i),i=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?r.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):r.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;DS(e,e.transactionQueueTree_);for(let c=0;c<r.length;c++)q_(r[c]);xS(e,e.transactionQueueTree_)}(e,NS(e,n),r),r}function kS(e,t){let n,r=e.transactionQueueTree_;for(n=bE(t);null!==n&&void 0===Qw(r);)r=Jw(r,n),n=bE(t=SE(t));return r}function NS(e,t){const n=[];return PS(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function PS(e,t,n){const r=Qw(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);tS(t,(t=>{PS(e,t,n)}))}function DS(e,t){const n=Qw(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Zw(t,n.length>0?n:void 0)}tS(t,(t=>{DS(e,t)}))}function LS(e,t){const n=rS(kS(e,t)),r=Jw(e.transactionQueueTree_,t);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,(t=>{MS(e,t)})),MS(e,r),nS(r,(t=>{MS(e,t)})),n}function MS(e,t){const n=Qw(t);if(n){const r=[];let i=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(lt(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(lt(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(Nw(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Zw(t,void 0):n.length=o+1,fS(e.eventQueue_,rS(t),i);for(let e=0;e<r.length;e++)q_(r[e])}}const jS=function(e,t){const n=US(e),r=n.namespace;"firebase.com"===n.domain&&N_(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||N_("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&P_("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new nE(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new _E(n.pathString)}},US=function(e){let t="",n="",r="",i="",o="",s=!0,a="https",c=443;if("string"===typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(u,d)),u<d&&(i=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(JS){}t+="/"+e}return t}(e.substring(u,d)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):P_(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,d)));l=t.indexOf(":"),l>=0?(s="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),o=r}"ns"in h&&(o=h.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}},VS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class FS{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return IE(this._path)?null:TE(this._path)}get ref(){return new BS(this._repo,this._path)}get _queryIdentifier(){const e=Eb(this._queryParams),t=F_(e);return"{}"===t?"default":t}get _queryObject(){return Eb(this._queryParams)}isEqual(e){if(!((e=Zt(e))instanceof FS))return!1;const t=this._repo===e._repo,n=OE(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class BS extends FS{constructor(e,t){super(e,t,new yb,!1)}get parent(){const e=AE(this._path);return null===e?null:new BS(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}!function(e){lt(!Aw,"__referenceConstructor has already been defined"),Aw=e}(BS),function(e){lt(!Rw,"__referenceConstructor has already been defined"),Rw=e}(BS);const WS={};let zS=!1;function HS(e,t,n,r,i){let o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||N_("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),x_("Using default host for project ",e.options.projectId),o=`${e.options.projectId}-default-rtdb.firebaseio.com`);let s,a,c=jS(o,i),l=c.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ALGOLIA_API_KEY:"b94f7163a6855940c1a0d94e635a307c",REACT_APP_ALGOLIA_APP_ID:"7PVTC2J64R",REACT_APP_ALGOLIA_INDEX_NAME:"searches",REACT_APP_API_URL:"https://sideeye-backend-production.up.railway.app",REACT_APP_FIREBASE_API_KEY:"AIzaSyBI9pvyseKR-5dw3eXuZgTLnG3OcvNGbeI",REACT_APP_FIREBASE_APP_ID:"1:864667627333:web:1ec087179141d1e91a982c",REACT_APP_FIREBASE_AUTH_DOMAIN:"sideeye.uk",REACT_APP_FIREBASE_DATABASE_URL:"https://sideeye-bafda-default-rtdb.europe-west1.firebasedatabase.app",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"864667627333",REACT_APP_FIREBASE_PROJECT_ID:"sideeye-bafda",REACT_APP_FIREBASE_STORAGE_BUCKET:"sideeye-bafda.firebasestorage.app",REACT_APP_SHOTSTACK_API_KEY:"c0Bpc85oj7cHuDdfhz54eQJmmoEI1qauJyodpw9d"}.FIREBASE_DATABASE_EMULATOR_HOST),a?(s=!0,o=`http://${a}?ns=${l.namespace}`,c=jS(o,i),l=c.repoInfo):s=!c.repoInfo.secure;const u=i&&s?new X_(X_.OWNER):new Y_(e.name,e.options,t);dS("Invalid Firebase Database URL",c),IE(c.path)||N_("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,r){let i=WS[t.name];i||(i={},WS[t.name]=i);let o=i[e.toURLString()];o&&N_("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return o=new yS(e,zS,n,r),i[e.toURLString()]=o,o}(l,e,u,new $_(e,n));return new GS(d,e)}class GS{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(_S(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new BS(this._repo,EE())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=WS[t];n&&n[e.key]===e||N_(`Database ${t}(${e.repoInfo_}) has already been deleted.`),AS(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&N_("Cannot call "+e+" on a deleted database.")}}jE.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},jE.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){g_(gr),dr(new en("database",((e,t)=>{let{instanceIdentifier:n}=t;return HS(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)}),"PUBLIC").setMultipleInstances(!0)),_r(p_,f_,e),_r(p_,f_,"esm2017")}();const qS=0===Array.from(ar.values()).length?vr({apiKey:"AIzaSyBI9pvyseKR-5dw3eXuZgTLnG3OcvNGbeI",authDomain:"sideeye.uk",projectId:"sideeye-bafda",storageBucket:"sideeye-bafda.firebasestorage.app",messagingSenderId:"864667627333",appId:"1:864667627333:web:1ec087179141d1e91a982c",databaseURL:"https://sideeye-bafda-default-rtdb.europe-west1.firebasedatabase.app"},{automaticDataCollectionEnabled:!1}):yr();console.log("Initializing Firebase app");const KS=function(e,t,n){n||(n=Tl);const r=hr(e,"firestore");if(r.isInitialized(n)){const e=r.getImmediate({identifier:n});if(zt(r.getOptions(n),t))return e;throw new ja(Ma.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new ja(Ma.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<qh)throw new ja(Ma.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})}(qS,{cacheSizeBytes:-1,experimentalForceLongPolling:!0}),$S=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr();const t=hr(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=hr(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(zt(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Mr(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:na,persistence:[hs,qo,Jo]}),r=Tt("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>sa)return;const r=null===t||void 0===t?void 0:t.token;aa!==r&&(aa=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){Zt(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){Zt(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}var i;const o=bt("auth");return o&&ro(n,`http://${o}`),n}(qS),YS=d_(qS),XS=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yr(),t=arguments.length>1?arguments[1]:void 0;const n=hr(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=wt("database");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Zt(e),e._checkNotDeleted("useEmulator");const i=`${t}:${n}`,o=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&zt(r,o.repoInfo_.emulatorOptions))return;N_("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let s;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&N_('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new X_(X_.OWNER);else if(r.mockUserToken){const t="string"===typeof r.mockUserToken?r.mockUserToken:At(r.mockUserToken,e.app.options.projectId);s=new X_(t)}!function(e,t,n,r){e.repoInfo_=new nE(t,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(e.authTokenProvider_=r)}(o,i,r,s)}(n,...e)}return n}(qS);Fo($S,(e=>{console.log("Firebase auth state changed:",e?"User logged in":"No user")}));(()=>{{console.log("Checking Firebase configuration in production..."),console.log("Firebase App:",qS.name),console.log("Firebase Auth:",$S.app.name),console.log("Firestore:",KS.app.name),console.log("Realtime Database:",XS.app.name);const e=qS.options.projectId;console.log("Firebase Project ID:",e);const t=qS.options.apiKey;console.log("Firebase API Key:",t?"Present":"Missing");const n=qS.options.authDomain;console.log("Firebase Auth Domain:",n),e&&t&&n||(console.error("Firebase configuration is incomplete!"),console.error("Project ID:",e),console.error("API Key:",t?"Present":"Missing"),console.error("Auth Domain:",n))}})();let JS={data:""},QS=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||JS,ZS=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,eT=/\/\*[^]*?\*\/|  +/g,tT=/\n+/g,nT=(e,t)=>{let n="",r="",i="";for(let o in e){let s=e[o];"@"==o[0]?"i"==o[1]?n=o+" "+s+";":r+="f"==o[1]?nT(s,o):o+"{"+nT(s,"k"==o[1]?"":t)+"}":"object"==typeof s?r+=nT(s,t?t.replace(/([^,])+/g,(e=>o.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):o):null!=s&&(o=/^--/.test(o)?o:o.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=nT.p?nT.p(o,s):o+":"+s+";")}return n+(t&&i?t+"{"+i+"}":i)+r},rT={},iT=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+iT(e[n]);return t}return e},oT=(e,t,n,r,i)=>{let o=iT(e),s=rT[o]||(rT[o]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(o));if(!rT[s]){let t=o!==e?e:(e=>{let t,n,r=[{}];for(;t=ZS.exec(e.replace(eT,""));)t[4]?r.shift():t[3]?(n=t[3].replace(tT," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(tT," ").trim();return r[0]})(e);rT[s]=nT(i?{["@keyframes "+s]:t}:t,n?"":"."+s)}let a=n&&rT.g?rT.g:null;return n&&(rT.g=rT[s]),((e,t,n,r)=>{r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(rT[s],t,r,a),s};function sT(e){let t=this||{},n=e.call?e(t.p):e;return oT(n.unshift?n.raw?((e,t,n)=>e.reduce(((e,r,i)=>{let o=t[i];if(o&&o.call){let e=o(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;o=t?"."+t:e&&"object"==typeof e?e.props?"":nT(e,""):!1===e?"":e}return e+r+(null==o?"":o)}),""))(n,[].slice.call(arguments,1),t.p):n.reduce(((e,n)=>Object.assign(e,n&&n.call?n(t.p):n)),{}):n,QS(t.target),t.g,t.o,t.k)}sT.bind({g:1});let aT,cT,lT,uT=sT.bind({k:1});function dT(e,t){let n=this||{};return function(){let r=arguments;function i(o,s){let a=Object.assign({},o),c=a.className||i.className;n.p=Object.assign({theme:cT&&cT()},a),n.o=/ *go\d+/.test(c),a.className=sT.apply(n,r)+(c?" "+c:""),t&&(a.ref=s);let l=e;return e[0]&&(l=a.as||e,delete a.as),lT&&l[0]&&lT(a),aT(l,a)}return t?t(i):i}}var hT=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,pT=(()=>{let e=0;return()=>(++e).toString()})(),fT=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),mT=(e,t)=>{switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,20)};case 1:return{...e,toasts:e.toasts.map((e=>e.id===t.toast.id?{...e,...t.toast}:e))};case 2:let{toast:n}=t;return mT(e,{type:e.toasts.find((e=>e.id===n.id))?1:0,toast:n});case 3:let{toastId:r}=t;return{...e,toasts:e.toasts.map((e=>e.id===r||void 0===r?{...e,dismissed:!0,visible:!1}:e))};case 4:return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter((e=>e.id!==t.toastId))};case 5:return{...e,pausedAt:t.time};case 6:let i=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map((e=>({...e,pauseDuration:e.pauseDuration+i})))}}},gT=[],vT={toasts:[],pausedAt:void 0},yT=e=>{vT=mT(vT,e),gT.forEach((e=>{e(vT)}))},_T={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},ET=e=>(t,n)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return{createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(null==n?void 0:n.id)||pT()}}(t,e,n);return yT({type:2,toast:r}),r.id},bT=(e,t)=>ET("blank")(e,t);bT.error=ET("error"),bT.success=ET("success"),bT.loading=ET("loading"),bT.custom=ET("custom"),bT.dismiss=e=>{yT({type:3,toastId:e})},bT.remove=e=>yT({type:4,toastId:e}),bT.promise=(e,t,n)=>{let r=bT.loading(t.loading,{...n,...null==n?void 0:n.loading});return"function"==typeof e&&(e=e()),e.then((e=>{let i=t.success?hT(t.success,e):void 0;return i?bT.success(i,{id:r,...n,...null==n?void 0:n.success}):bT.dismiss(r),e})).catch((e=>{let i=t.error?hT(t.error,e):void 0;i?bT.error(i,{id:r,...n,...null==n?void 0:n.error}):bT.dismiss(r)})),e};var wT=(e,t)=>{yT({type:1,toast:{id:e,height:t}})},ST=()=>{yT({type:5,time:Date.now()})},TT=new Map,CT=e=>{let{toasts:n,pausedAt:r}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[n,r]=(0,t.useState)(vT),i=(0,t.useRef)(vT);(0,t.useEffect)((()=>(i.current!==vT&&r(vT),gT.push(r),()=>{let e=gT.indexOf(r);e>-1&&gT.splice(e,1)})),[]);let o=n.toasts.map((t=>{var n,r,i;return{...e,...e[t.type],...t,removeDelay:t.removeDelay||(null==(n=e[t.type])?void 0:n.removeDelay)||(null==e?void 0:e.removeDelay),duration:t.duration||(null==(r=e[t.type])?void 0:r.duration)||(null==e?void 0:e.duration)||_T[t.type],style:{...e.style,...null==(i=e[t.type])?void 0:i.style,...t.style}}}));return{...n,toasts:o}}(e);(0,t.useEffect)((()=>{if(r)return;let e=Date.now(),t=n.map((t=>{if(t.duration===1/0)return;let n=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(n<0))return setTimeout((()=>bT.dismiss(t.id)),n);t.visible&&bT.dismiss(t.id)}));return()=>{t.forEach((e=>e&&clearTimeout(e)))}}),[n,r]);let i=(0,t.useCallback)((()=>{r&&yT({type:6,time:Date.now()})}),[r]),o=(0,t.useCallback)(((e,t)=>{let{reverseOrder:r=!1,gutter:i=8,defaultPosition:o}=t||{},s=n.filter((t=>(t.position||o)===(e.position||o)&&t.height)),a=s.findIndex((t=>t.id===e.id)),c=s.filter(((e,t)=>t<a&&e.visible)).length;return s.filter((e=>e.visible)).slice(...r?[c+1]:[0,c]).reduce(((e,t)=>e+(t.height||0)+i),0)}),[n]);return(0,t.useEffect)((()=>{n.forEach((e=>{if(e.dismissed)!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(TT.has(e))return;let n=setTimeout((()=>{TT.delete(e),yT({type:4,toastId:e})}),t);TT.set(e,n)}(e.id,e.removeDelay);else{let t=TT.get(e.id);t&&(clearTimeout(t),TT.delete(e.id))}}))}),[n]),{toasts:n,handlers:{updateHeight:wT,startPause:ST,endPause:i,calculateOffset:o}}},AT=uT`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,RT=uT`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,IT=uT`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,xT=dT("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${AT} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${RT} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${IT} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,OT=uT`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,kT=dT("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${OT} 1s linear infinite;
`,NT=uT`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,PT=uT`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,DT=dT("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${NT} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${PT} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,LT=dT("div")`
  position: absolute;
`,MT=dT("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,jT=uT`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,UT=dT("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${jT} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,VT=e=>{let{toast:n}=e,{icon:r,type:i,iconTheme:o}=n;return void 0!==r?"string"==typeof r?t.createElement(UT,null,r):r:"blank"===i?null:t.createElement(MT,null,t.createElement(kT,{...o}),"loading"!==i&&t.createElement(LT,null,"error"===i?t.createElement(xT,{...o}):t.createElement(DT,{...o})))},FT=e=>`\n0% {transform: translate3d(0,${-200*e}%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n`,BT=e=>`\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,${-150*e}%,-1px) scale(.6); opacity:0;}\n`,WT=dT("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,zT=dT("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,HT=t.memo((e=>{let{toast:n,position:r,style:i,children:o}=e,s=n.height?((e,t)=>{let n=e.includes("top")?1:-1,[r,i]=fT()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[FT(n),BT(n)];return{animation:t?`${uT(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${uT(i)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}})(n.position||r||"top-center",n.visible):{opacity:0},a=t.createElement(VT,{toast:n}),c=t.createElement(zT,{...n.ariaProps},hT(n.message,n));return t.createElement(WT,{className:n.className,style:{...s,...i,...n.style}},"function"==typeof o?o({icon:a,message:c}):t.createElement(t.Fragment,null,a,c))}));!function(e,t,n,r){nT.p=t,aT=e,cT=n,lT=r}(t.createElement);var GT=e=>{let{id:n,className:r,style:i,onHeightUpdate:o,children:s}=e,a=t.useCallback((e=>{if(e){let t=()=>{let t=e.getBoundingClientRect().height;o(n,t)};t(),new MutationObserver(t).observe(e,{subtree:!0,childList:!0,characterData:!0})}}),[n,o]);return t.createElement("div",{ref:a,className:r,style:i},s)},qT=sT`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,KT=e=>{let{reverseOrder:n,position:r="top-center",toastOptions:i,gutter:o,children:s,containerStyle:a,containerClassName:c}=e,{toasts:l,handlers:u}=CT(i);return t.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none",...a},className:c,onMouseEnter:u.startPause,onMouseLeave:u.endPause},l.map((e=>{let i=e.position||r,a=((e,t)=>{let n=e.includes("top"),r=n?{top:0}:{bottom:0},i=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:fT()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(n?1:-1)}px)`,...r,...i}})(i,u.calculateOffset(e,{reverseOrder:n,gutter:o,defaultPosition:r}));return t.createElement(GT,{id:e.id,key:e.id,onHeightUpdate:u.updateHeight,className:e.visible?qT:"",style:a},"custom"===e.type?hT(e.message,e):s?s(e):t.createElement(HT,{toast:e,position:i}))})))},$T=bT,YT=n(185),XT=n.n(YT);const JT=(0,t.createContext)({user:null,loading:!0,error:null,login:async()=>{},register:async()=>{},logout:async()=>{},resetPassword:async()=>{},sendEmailVerification:async()=>{},setError:()=>{},forceCheckEmailVerification:async()=>!1,currentUser:null,userProfile:null,setUserProfile:()=>{},verifySourceCodeAndCompleteLogin:async()=>{},tempUserForSourceCode:null}),QT=e=>{var n;let{children:r}=e;const[i,o]=(0,t.useState)(null),[s,a]=(0,t.useState)(!0),[c,l]=(0,t.useState)(null),[u,d]=(0,t.useState)(null),h=Q();(0,t.useEffect)((()=>{console.log("Setting up auth state listener");const e=Fo($S,(async e=>{if(console.log("Auth state changed:",e?"User logged in":"No user"),e)try{const t=await uv(eg(KS,"users",e.uid));if(t.exists()){const n=t.data();o({...e,profile:n}),console.log("User data loaded successfully:",e.uid)}else console.error("User document not found in Firestore:",e.uid),o(null)}catch(c){console.error("Error loading user data:",c),o(null)}else o(null);a(!1)}));return()=>{console.log("Cleaning up auth state listener"),e()}}),[]),(0,t.useEffect)((()=>{if(null===i||void 0===i||!i.uid||!KS)return;const e=vv(eg(KS,"users",i.uid),(e=>{if(e.exists()){var t;const n=e.data(),r=null===(t=i.profile)||void 0===t?void 0:t.isPrivate;o((e=>e?{...e,profile:n}:null)),o((e=>e?{...e,isPrivate:n.isPrivate||!1,followers:n.followers||[],following:n.following||[]}:null)),r!==n.isPrivate&&(bT.success("Account is now "+(n.isPrivate?"private":"public")),window.location.pathname.includes("/profile")&&window.location.reload())}}),(e=>{console.error("Error listening to privacy changes:",e),bT.error("Failed to sync privacy settings")}));return()=>e()}),[null===i||void 0===i?void 0:i.uid,KS,null===i||void 0===i||null===(n=i.profile)||void 0===n?void 0:n.isPrivate]),(0,t.useEffect)((()=>{i&&!s&&(i.emailVerified||bT.error("Please verify your email to continue",{duration:5e3,id:"email-verification-needed"}),i.profile&&!i.profile.sourceCodeSetupComplete&&bT.error("Please set up your source code to continue",{duration:5e3,id:"source-code-setup-needed"}))}),[i,s]);const p=async e=>{try{console.log("Starting forceCheckEmailVerification for user:",e.uid),console.log("Initial emailVerified status:",e.emailVerified),await e.reload();const n=$S.currentUser;if(!n)return console.error("User disappeared after reload"),!1;const r=n.emailVerified;if(console.log("Email verification status after reload:",r),r&&KS)try{const e=eg(KS,"users",n.uid),t=await uv(e);if(t.exists()){if(!t.data().isVerified){const t=await(async e=>{if(!KS)return!1;try{return(await uv(eg(KS,"admins",e))).exists()}catch(c){return console.log("Error checking admin status:",c),!1}})(n.uid);t?(await fv(e,{isVerified:!0,updatedAt:Av()}),console.log("Updated user profile verification status in Firestore")):console.log("User is not admin, skipping verification status update")}}}catch(c){console.log("Could not access user profile in Firestore")}try{const e=await n.getIdTokenResult(!0);return console.log("Token verification status:",e.claims.email_verified),e.claims.email_verified&&!r?(await n.reload(),n.emailVerified):!0===e.claims.email_verified}catch(t){return console.error("Error checking token verification status:",t),r}}catch(c){return console.error("Failed to check email verification status:",c),!1}},f={user:i,loading:s,error:c,login:async(e,t)=>{a(!0),l(null);try{if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e))throw new Error("auth/invalid-email");console.log("Starting login process for:",e),await function(e,t){return Zt(e).setPersistence(t)}($S,qo),console.log("Persistence set to LOCAL");const n=await function(e,t,n){return pr(e.app)?Promise.reject(Vr(e)):Do(Zt(e),_o.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&jo(e),t}))}($S,e,t),r=n.user;console.log("Firebase Auth login successful for user:",r.uid);const i=await p(r);if(console.log("Email verification status:",i),!i)return console.log("Email not verified, redirecting to verification page..."),l("Please verify your email before logging in."),await Bo($S),a(!1),void h("/verify-email",{replace:!0});const s=await uv(eg(KS,"users",r.uid));if(s.exists()){const e=s.data();if(console.log("Retrieved user profile:",e),!e.sourceCodeSetupComplete)return console.log("Source code setup not complete, redirecting to setup..."),a(!1),void h("/setup-source-code",{replace:!0});o({...r,profile:e}),a(!1),console.log("Login complete, redirecting to feed..."),h("/",{replace:!0})}else{console.log("User profile not found, creating default profile...");const e={name:r.displayName||"",username:r.displayName||"",email:r.email||"",profilePic:r.photoURL||"",bio:"",location:"",website:"",followers:[],following:[],connections:[],isVerified:!1,sourceCodeHash:null,sourceCodeSetupComplete:!1,createdAt:rc.fromDate(new Date),lastLogin:rc.fromDate(new Date),dateOfBirth:rc.fromDate(new Date(2e3,0,1)),settings:{theme:"light",notifications:!0,privacy:"public"},preferences:{theme:"light",language:"en",notifications:!0,emailNotifications:!0,pushNotifications:!0}};await pv(eg(KS,"users",r.uid),e),console.log("Created default user profile");const t=(await uv(eg(KS,"users",r.uid))).data();if(!t.sourceCodeSetupComplete)return console.log("Source code setup not complete, redirecting to setup..."),a(!1),void h("/setup-source-code",{replace:!0});o({...r,profile:t}),a(!1),console.log("Login complete, redirecting to feed..."),h("/",{replace:!0})}}catch(c){console.error("Login function error:",c);let t="An error occurred during login.";"auth/invalid-credential"===c.code||"auth/invalid-credential"===c.message?t="Invalid email or password. Please check your credentials and try again.":"auth/user-not-found"===c.code||"auth/user-not-found"===c.message?t="No account found with this email.":"auth/wrong-password"===c.code||"auth/wrong-password"===c.message?t="Incorrect password.":"auth/too-many-requests"===c.code||"auth/too-many-requests"===c.message?t="Too many failed attempts. Please try again later.":"auth/network-request-failed"===c.code||"auth/network-request-failed"===c.message?t="Network error. Please check your connection.":"auth/invalid-email"===c.code||"auth/invalid-email"===c.message?t="Invalid email address. Please check the format.":"User profile not found"===c.message&&(t="User profile not found. Please contact support."),l(t),o(null),a(!1),((e,t)=>{console.error(`[${t}] Error:`,e)})(c,"Login Function")}},register:async(e,t,n,r)=>{a(!0),l(null);try{const i=await async function(e,t,n){if(pr(e.app))return Promise.reject(Vr(e));const r=Gi(e),i=to(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ao,"EMAIL_PASSWORD_PROVIDER"),o=await i.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&jo(e),t})),s=await Ro._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(s.user),s}($S,e,t),s=i.user;if(console.log("User created successfully with UID:",s.uid),await Vo(s,{displayName:n}),console.log("User profile updated with username:",n),await Uo(s),console.log("Verification email sent to:",s.email),KS){const t={theme:"light",language:"en",notifications:!0,emailNotifications:!0,pushNotifications:!0},i={name:n,username:n,email:e||"",profilePic:s.photoURL||"",bio:"",location:"",website:"",followers:[],following:[],connections:[],isVerified:!1,sourceCodeHash:null,sourceCodeSetupComplete:!1,createdAt:rc.fromDate(new Date),lastLogin:rc.fromDate(new Date),dateOfBirth:r,settings:{theme:"light",notifications:!0,privacy:"public"},preferences:t};await pv(eg(KS,"users",s.uid),i),console.log("Basic user profile created in Firestore")}o(s)}catch(c){throw console.error("Registration error:",c),l(eC(c.code)),c}finally{a(!1)}},logout:async()=>{try{a(!0),await Bo($S),o(null),h("/login")}catch(c){console.error("Error logging out:",c),bT.error("Failed to log out")}finally{a(!1)}},resetPassword:async e=>{try{a(!0),await async function(e,t,n){const r=Gi(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&Mo(r,i,n),await to(r,i,"getOobCode",uo,"EMAIL_PASSWORD_PROVIDER")}($S,e)}catch(c){throw l(c.message),c}finally{a(!1)}},sendEmailVerification:async()=>{const e=$S.currentUser;if(e)try{a(!0),await e.reload();const t=$S.currentUser;if(!t)return void l("User not found");if(t.emailVerified)return await p(t),void h("/setup-source-code");await Uo(t,{url:`${window.location.origin}/verify-email`,handleCodeInApp:!0}),KS&&await fv(eg(KS,"users",t.uid),{lastVerificationAttempt:Av(),verificationStatus:"pending"}),bT.success("Verification email sent")}catch(c){console.error("Error sending verification email:",c),l(eC(c.code||c.message))}finally{a(!1)}else l("No user available to send verification email")},setError:l,forceCheckEmailVerification:p,currentUser:i,userProfile:(null===i||void 0===i?void 0:i.profile)||null,setUserProfile:e=>{i&&o({...i,profile:e})},verifySourceCodeAndCompleteLogin:async e=>{if(!u||!KS)return l("No user logged in"),void console.error("verifySourceCodeAndCompleteLogin: No temporary user found");try{a(!0),l(null);const t=eg(KS,"users",u.uid),n=await uv(t);if(!n.exists())return l("User profile not found"),void console.error("verifySourceCodeAndCompleteLogin: User profile not found");const r=n.data();if(!r.sourceCodeHash)return l("Source code not set up"),void console.error("verifySourceCodeAndCompleteLogin: No source code hash found");if(!await XT().compare(e,r.sourceCodeHash))return void l("Invalid source code");o({...u,profile:r}),d(null),a(!1),setTimeout((()=>{h("/")}),0)}catch(c){console.error("Error verifying source code:",c),l("Failed to verify source code"),a(!1)}},tempUserForSourceCode:u};return(0,We.jsx)(JT.Provider,{value:f,children:r})},ZT=()=>{const e=(0,t.useContext)(JT);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},eC=e=>{switch(e){case"auth/invalid-email":return"Invalid email address";case"auth/user-disabled":return"This account has been disabled";case"auth/user-not-found":return"No account found with this email";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"Email is already in use";case"auth/weak-password":return"Password is too weak";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/too-many-requests":return"Too many attempts. Please try again later";default:return"An error occurred. Please try again"}},tC=()=>{const{user:e}=ZT();return{canViewProfile:t=>{var n,r,i;if(!e)return!1;if(e.uid===t)return!0;const o=null===(n=e.profile)||void 0===n||null===(r=n.followers)||void 0===r?void 0:r.includes(t);return!(null!==(i=e.profile)&&void 0!==i&&i.isPrivate)||o},canViewContent:t=>{var n,r,i;if(!e)return!1;if(e.uid===t)return!0;const o=null===(n=e.profile)||void 0===n||null===(r=n.following)||void 0===r?void 0:r.includes(t);return!(null!==(i=e.profile)&&void 0!==i&&i.isPrivate)||o}}},nC=(0,t.createContext)(void 0),rC=e=>{let{children:n}=e;const{currentUser:r}=ZT(),[i,o]=(0,t.useState)([]),[s,a]=(0,t.useState)(0),[c,l]=(0,t.useState)(!0),[u,d]=(0,t.useState)(!1),h=(0,t.useCallback)((async e=>{if(!e)return;l(!0);const t=vv(Gg(Zm(KS,"notifications"),Kg("recipientId","==",e),Xg("createdAt","desc"),Qg(50)),(e=>{const t=e.docs.map((e=>{var t;const n=e.data();return{id:e.id,...n,createdAt:null!==(t=n.createdAt)&&void 0!==t&&t.toDate?n.createdAt.toDate():new Date}}));o(t);const n=t.filter((e=>!e.isRead)).length;a(n),u||d(!0),l(!1)}),(e=>{console.error("Error fetching notifications: ",e),l(!1)}));return t}),[u]);(0,t.useEffect)((()=>{let e;if(null!==r&&void 0!==r&&r.uid){h(r.uid).then((t=>{t&&(e=t)})).catch((e=>{console.error("Failed to setup notification listener:",e)}))}else o([]),a(0),l(!0),d(!1);return()=>{e&&e()}}),[r,h]);const p={notifications:i,unreadCount:s,loading:c,fetchNotifications:h,markAsRead:async e=>{try{const t=eg(KS,"notifications",e);await fv(t,{isRead:!0})}catch(k_){console.error("Error marking notification as read: ",k_)}},markAllAsRead:async e=>{if(e){l(!0);try{const t=Gg(Zm(KS,"notifications"),Kg("recipientId","==",e),Kg("isRead","==",!1)),n=(await hv(t)).docs.map((e=>fv(eg(KS,"notifications",e.id),{isRead:!0})));await Promise.all(n)}catch(k_){console.error("Error marking all notifications as read: ",k_)}}},deleteNotification:async e=>{try{const t=eg(KS,"notifications",e);await mv(t)}catch(k_){console.error("Error deleting notification: ",k_)}},addNotification:async e=>{try{await gv(Zm(KS,"notifications"),{...e,isRead:!1,createdAt:Av()})}catch(k_){console.error("Error adding notification: ",k_)}}};return(0,We.jsx)(nC.Provider,{value:p,children:n})},iC=()=>{const e=(0,t.useContext)(nC);if(void 0===e)throw new Error("useNotifications must be used within a NotificationProvider");return e};const oC=t.createContext(null);function sC(){return t.useContext(oC)}const aC="function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";const cC=function(e){const{children:n,theme:r}=e,i=sC(),o=t.useMemo((()=>{const e=null===i?r:function(e,t){if("function"===typeof t)return t(e);return(0,ke.A)({},e,t)}(i,r);return null!=e&&(e[aC]=null!==i),e}),[r,i]);return(0,We.jsx)(oC.Provider,{value:o,children:n})},lC=["value"],uC=t.createContext();const dC=()=>{const e=t.useContext(uC);return null!=e&&e},hC=function(e){let{value:t}=e,n=(0,Ne.A)(e,lC);return(0,We.jsx)(uC.Provider,(0,ke.A)({value:null==t||t},n))};var pC=n(6171);const fC={};function mC(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.useMemo((()=>{const t=e&&n[e]||n;if("function"===typeof r){const o=r(t),s=e?(0,ke.A)({},n,{[e]:o}):o;return i?()=>s:s}return e?(0,ke.A)({},n,{[e]:r}):(0,ke.A)({},n,r)}),[e,n,r,i])}const gC=function(e){const{children:t,theme:n,themeId:r}=e,i=Ve(fC),o=sC()||fC,s=mC(r,i,n),a=mC(r,o,n,!0),c="rtl"===s.direction;return(0,We.jsx)(cC,{theme:a,children:(0,We.jsx)(Ue.T.Provider,{value:s,children:(0,We.jsx)(hC,{value:c,children:(0,We.jsx)(pC.A,{value:null==s?void 0:s.components,children:t})})})})},vC=["theme"];function yC(e){let{theme:t}=e,n=(0,Ne.A)(e,vC);const r=t[qe.A];let i=r||t;return"function"!==typeof t&&(r&&!r.vars?i=(0,ke.A)({},r,{vars:null}):t&&!t.vars&&(i=(0,ke.A)({},t,{vars:null}))),(0,We.jsx)(gC,(0,ke.A)({},n,{themeId:r?qe.A:void 0,theme:i}))}const _C=(0,t.createContext)(void 0),EC=e=>{let{children:n}=e;const[r,i]=(0,t.useState)((()=>{const e=localStorage.getItem("darkMode");return!!e&&JSON.parse(e)}));(0,t.useEffect)((()=>{localStorage.setItem("darkMode",JSON.stringify(r))}),[r]);const o=(0,Ge.A)({palette:{mode:r?"dark":"light",primary:{main:"#1976d2"},secondary:{main:"#dc004e"},background:{default:r?"#121212":"#ffffff",paper:r?"#1e1e1e":"#ffffff"}},components:{MuiPaper:{styleOverrides:{root:{backgroundImage:"none"}}}}});return(0,We.jsx)(_C.Provider,{value:{isDarkMode:r,toggleDarkMode:()=>{i(!r)}},children:(0,We.jsx)(yC,{theme:o,children:n})})};var bC=n(8465),wC=n(9254),SC=n(1676),TC=n(9269);const CC=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};var AC=n(423);function RC(e){return(0,AC.Ay)("MuiPaper",e)}(0,Ke.A)("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const IC=["className","component","elevation","square","variant"],xC=(0,wC.Ay)("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t[`elevation${n.elevation}`]]}})((e=>{let{theme:t,ownerState:n}=e;var r;return(0,ke.A)({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!n.square&&{borderRadius:t.shape.borderRadius},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.divider}`},"elevation"===n.variant&&(0,ke.A)({boxShadow:(t.vars||t).shadows[n.elevation]},!t.vars&&"dark"===t.palette.mode&&{backgroundImage:`linear-gradient(${(0,TC.X4)("#fff",CC(n.elevation))}, ${(0,TC.X4)("#fff",CC(n.elevation))})`},t.vars&&{backgroundImage:null==(r=t.vars.overlays)?void 0:r[n.elevation]}))})),OC=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiPaper"}),{className:r,component:i="div",elevation:o=1,square:s=!1,variant:a="elevation"}=n,c=(0,Ne.A)(n,IC),l=(0,ke.A)({},n,{component:i,elevation:o,square:s,variant:a}),u=(e=>{const{square:t,elevation:n,variant:r,classes:i}=e,o={root:["root",r,!t&&"rounded","elevation"===r&&`elevation${n}`]};return(0,bC.A)(o,RC,i)})(l);return(0,We.jsx)(xC,(0,ke.A)({as:i,ownerState:l,className:(0,Pe.A)(u.root,r),ref:t},c))})),kC=OC;function NC(e){return(0,AC.Ay)("MuiAppBar",e)}(0,Ke.A)("MuiAppBar",["root","positionFixed","positionAbsolute","positionSticky","positionStatic","positionRelative","colorDefault","colorPrimary","colorSecondary","colorInherit","colorTransparent","colorError","colorInfo","colorSuccess","colorWarning"]);const PC=["className","color","enableColorOnDark","position"],DC=(e,t)=>e?`${null==e?void 0:e.replace(")","")}, ${t})`:t,LC=(0,wC.Ay)(kC,{name:"MuiAppBar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`position${(0,SC.A)(n.position)}`],t[`color${(0,SC.A)(n.color)}`]]}})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[900];return(0,ke.A)({display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",flexShrink:0},"fixed"===n.position&&{position:"fixed",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0,"@media print":{position:"absolute"}},"absolute"===n.position&&{position:"absolute",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0},"sticky"===n.position&&{position:"sticky",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0},"static"===n.position&&{position:"static"},"relative"===n.position&&{position:"relative"},!t.vars&&(0,ke.A)({},"default"===n.color&&{backgroundColor:r,color:t.palette.getContrastText(r)},n.color&&"default"!==n.color&&"inherit"!==n.color&&"transparent"!==n.color&&{backgroundColor:t.palette[n.color].main,color:t.palette[n.color].contrastText},"inherit"===n.color&&{color:"inherit"},"dark"===t.palette.mode&&!n.enableColorOnDark&&{backgroundColor:null,color:null},"transparent"===n.color&&(0,ke.A)({backgroundColor:"transparent",color:"inherit"},"dark"===t.palette.mode&&{backgroundImage:"none"})),t.vars&&(0,ke.A)({},"default"===n.color&&{"--AppBar-background":n.enableColorOnDark?t.vars.palette.AppBar.defaultBg:DC(t.vars.palette.AppBar.darkBg,t.vars.palette.AppBar.defaultBg),"--AppBar-color":n.enableColorOnDark?t.vars.palette.text.primary:DC(t.vars.palette.AppBar.darkColor,t.vars.palette.text.primary)},n.color&&!n.color.match(/^(default|inherit|transparent)$/)&&{"--AppBar-background":n.enableColorOnDark?t.vars.palette[n.color].main:DC(t.vars.palette.AppBar.darkBg,t.vars.palette[n.color].main),"--AppBar-color":n.enableColorOnDark?t.vars.palette[n.color].contrastText:DC(t.vars.palette.AppBar.darkColor,t.vars.palette[n.color].contrastText)},!["inherit","transparent"].includes(n.color)&&{backgroundColor:"var(--AppBar-background)"},{color:"inherit"===n.color?"inherit":"var(--AppBar-color)"},"transparent"===n.color&&{backgroundImage:"none",backgroundColor:"transparent",color:"inherit"}))})),MC=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiAppBar"}),{className:r,color:i="primary",enableColorOnDark:o=!1,position:s="fixed"}=n,a=(0,Ne.A)(n,PC),c=(0,ke.A)({},n,{color:i,position:s,enableColorOnDark:o}),l=(e=>{const{color:t,position:n,classes:r}=e,i={root:["root",`color${(0,SC.A)(t)}`,`position${(0,SC.A)(n)}`]};return(0,bC.A)(i,NC,r)})(c);return(0,We.jsx)(LC,(0,ke.A)({square:!0,component:"header",ownerState:c,elevation:4,className:(0,Pe.A)(l.root,r,"fixed"===s&&"mui-fixed"),ref:t},a))})),jC=MC;function UC(e){return(0,AC.Ay)("MuiToolbar",e)}(0,Ke.A)("MuiToolbar",["root","gutters","regular","dense"]);const VC=["className","component","disableGutters","variant"],FC=(0,wC.Ay)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableGutters&&t.gutters,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({position:"relative",display:"flex",alignItems:"center"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}},"dense"===n.variant&&{minHeight:48})}),(e=>{let{theme:t,ownerState:n}=e;return"regular"===n.variant&&t.mixins.toolbar})),BC=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiToolbar"}),{className:r,component:i="div",disableGutters:o=!1,variant:s="regular"}=n,a=(0,Ne.A)(n,VC),c=(0,ke.A)({},n,{component:i,disableGutters:o,variant:s}),l=(e=>{const{classes:t,disableGutters:n,variant:r}=e,i={root:["root",!n&&"gutters",r]};return(0,bC.A)(i,UC,t)})(c);return(0,We.jsx)(FC,(0,ke.A)({as:i,className:(0,Pe.A)(l.root,r),ref:t,ownerState:c},a))})),WC=BC;var zC=n(3235);const HC=(0,zC.A)((0,We.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function GC(e){return(0,AC.Ay)("MuiAvatar",e)}(0,Ke.A)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var qC=n(5393);const KC=function(e){return"string"===typeof e};const $C=function(e,t,n){return void 0===e||KC(e)?t:(0,ke.A)({},t,{ownerState:(0,ke.A)({},t.ownerState,n)})};const YC=function(e,t,n){return"function"===typeof e?e(t,n):e};const XC=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n};const JC=function(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t]))).forEach((n=>{t[n]=e[n]})),t};const QC=function(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:r,externalForwardedProps:i,className:o}=e;if(!t){const e=(0,Pe.A)(null==n?void 0:n.className,o,null==i?void 0:i.className,null==r?void 0:r.className),t=(0,ke.A)({},null==n?void 0:n.style,null==i?void 0:i.style,null==r?void 0:r.style),s=(0,ke.A)({},n,i,r);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const s=XC((0,ke.A)({},i,r)),a=JC(r),c=JC(i),l=t(s),u=(0,Pe.A)(null==l?void 0:l.className,null==n?void 0:n.className,o,null==i?void 0:i.className,null==r?void 0:r.className),d=(0,ke.A)({},null==l?void 0:l.style,null==n?void 0:n.style,null==i?void 0:i.style,null==r?void 0:r.style),h=(0,ke.A)({},l,n,c,a);return u.length>0&&(h.className=u),Object.keys(d).length>0&&(h.style=d),{props:h,internalRef:l.ref}},ZC=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],eA=["component","slots","slotProps"],tA=["component"];function nA(e,t){const{className:n,elementType:r,ownerState:i,externalForwardedProps:o,getSlotOwnerState:s,internalForwardedProps:a}=t,c=(0,Ne.A)(t,ZC),{component:l,slots:u={[e]:void 0},slotProps:d={[e]:void 0}}=o,h=(0,Ne.A)(o,eA),p=u[e]||r,f=YC(d[e],i),m=QC((0,ke.A)({className:n},c,{externalForwardedProps:"root"===e?h:void 0,externalSlotProps:f})),{props:{component:g},internalRef:v}=m,y=(0,Ne.A)(m.props,tA),_=(0,qC.A)(v,null==f?void 0:f.ref,t.ref),E=s?s(y):{},b=(0,ke.A)({},i,E),w="root"===e?g||l:g,S=$C(p,(0,ke.A)({},"root"===e&&!l&&!u[e]&&a,"root"!==e&&!u[e]&&a,y,w&&{as:w},{ref:_}),b);return Object.keys(E).forEach((e=>{delete S[e]})),[p,S]}const rA=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],iA=(0,wC.Ay)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],n.colorDefault&&t.colorDefault]}})((e=>{let{theme:t}=e;return{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,ke.A)({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:(0,ke.A)({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]}})),oA=(0,wC.Ay)("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),sA=(0,wC.Ay)(HC,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"});const aA=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiAvatar"}),{alt:i,children:o,className:s,component:a="div",slots:c={},slotProps:l={},imgProps:u,sizes:d,src:h,srcSet:p,variant:f="circular"}=r,m=(0,Ne.A)(r,rA);let g=null;const v=function(e){let{crossOrigin:n,referrerPolicy:r,src:i,srcSet:o}=e;const[s,a]=t.useState(!1);return t.useEffect((()=>{if(!i&&!o)return;a(!1);let e=!0;const t=new Image;return t.onload=()=>{e&&a("loaded")},t.onerror=()=>{e&&a("error")},t.crossOrigin=n,t.referrerPolicy=r,t.src=i,o&&(t.srcset=o),()=>{e=!1}}),[n,r,i,o]),s}((0,ke.A)({},u,{src:h,srcSet:p})),y=h||p,_=y&&"error"!==v,E=(0,ke.A)({},r,{colorDefault:!_,component:a,variant:f}),b=(e=>{const{classes:t,variant:n,colorDefault:r}=e,i={root:["root",n,r&&"colorDefault"],img:["img"],fallback:["fallback"]};return(0,bC.A)(i,GC,t)})(E),[w,S]=nA("img",{className:b.img,elementType:oA,externalForwardedProps:{slots:c,slotProps:{img:(0,ke.A)({},u,l.img)}},additionalProps:{alt:i,src:h,srcSet:p,sizes:d},ownerState:E});return g=_?(0,We.jsx)(w,(0,ke.A)({},S)):o||0===o?o:y&&i?i[0]:(0,We.jsx)(sA,{ownerState:E,className:b.fallback}),(0,We.jsx)(iA,(0,ke.A)({as:a,ownerState:E,className:(0,Pe.A)(b.root,s),ref:n},m,{children:g}))})),cA=aA;function lA(e){return(0,AC.Ay)("MuiTypography",e)}(0,Ke.A)("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const uA=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],dA=(0,wC.Ay)("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t[`align${(0,SC.A)(n.align)}`],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({margin:0},"inherit"===n.variant&&{font:"inherit"},"inherit"!==n.variant&&t.typography[n.variant],"inherit"!==n.align&&{textAlign:n.align},n.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n.gutterBottom&&{marginBottom:"0.35em"},n.paragraph&&{marginBottom:16})})),hA={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},pA={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},fA=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiTypography"}),r=(e=>pA[e]||e)(n.color),i=(0,Me.A)((0,ke.A)({},n,{color:r})),{align:o="inherit",className:s,component:a,gutterBottom:c=!1,noWrap:l=!1,paragraph:u=!1,variant:d="body1",variantMapping:h=hA}=i,p=(0,Ne.A)(i,uA),f=(0,ke.A)({},i,{align:o,color:r,className:s,component:a,gutterBottom:c,noWrap:l,paragraph:u,variant:d,variantMapping:h}),m=a||(u?"p":h[d]||hA[d])||"span",g=(e=>{const{align:t,gutterBottom:n,noWrap:r,paragraph:i,variant:o,classes:s}=e,a={root:["root",o,"inherit"!==e.align&&`align${(0,SC.A)(t)}`,n&&"gutterBottom",r&&"noWrap",i&&"paragraph"]};return(0,bC.A)(a,lA,s)})(f);return(0,We.jsx)(dA,(0,ke.A)({as:m,ref:t,ownerState:f,className:(0,Pe.A)(g.root,s)},p))})),mA=fA;var gA=n(1506),vA=n(1976),yA=n(2937);function _A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function EA(e,t){return EA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},EA(e,t)}function bA(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,EA(e,t)}const wA=t.createContext(null);function SA(e,n){var r=Object.create(null);return e&&t.Children.map(e,(function(e){return e})).forEach((function(e){r[e.key]=function(e){return n&&(0,t.isValidElement)(e)?n(e):e}(e)})),r}function TA(e,t,n){return null!=n[t]?n[t]:e.props[t]}function CA(e,n,r){var i=SA(e.children),o=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,i=Object.create(null),o=[];for(var s in e)s in t?o.length&&(i[s]=o,o=[]):o.push(s);var a={};for(var c in t){if(i[c])for(r=0;r<i[c].length;r++){var l=i[c][r];a[i[c][r]]=n(l)}a[c]=n(c)}for(r=0;r<o.length;r++)a[o[r]]=n(o[r]);return a}(n,i);return Object.keys(o).forEach((function(s){var a=o[s];if((0,t.isValidElement)(a)){var c=s in n,l=s in i,u=n[s],d=(0,t.isValidElement)(u)&&!u.props.in;!l||c&&!d?l||!c||d?l&&c&&(0,t.isValidElement)(u)&&(o[s]=(0,t.cloneElement)(a,{onExited:r.bind(null,a),in:u.props.in,exit:TA(a,"exit",e),enter:TA(a,"enter",e)})):o[s]=(0,t.cloneElement)(a,{in:!1}):o[s]=(0,t.cloneElement)(a,{onExited:r.bind(null,a),in:!0,exit:TA(a,"exit",e),enter:TA(a,"enter",e)})}})),o}var AA=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},RA=function(e){function n(t,n){var r,i=(r=e.call(this,t,n)||this).handleExited.bind(_A(r));return r.state={contextValue:{isMounting:!0},handleExited:i,firstRender:!0},r}bA(n,e);var r=n.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},n.getDerivedStateFromProps=function(e,n){var r,i,o=n.children,s=n.handleExited;return{children:n.firstRender?(r=e,i=s,SA(r.children,(function(e){return(0,t.cloneElement)(e,{onExited:i.bind(null,e),in:!0,appear:TA(e,"appear",r),enter:TA(e,"enter",r),exit:TA(e,"exit",r)})}))):CA(e,o,s),firstRender:!1}},r.handleExited=function(e,t){var n=SA(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,ke.A)({},t.children);return delete n[e.key],{children:n}})))},r.render=function(){var e=this.props,n=e.component,r=e.childFactory,i=(0,Ne.A)(e,["component","childFactory"]),o=this.state.contextValue,s=AA(this.state.children).map(r);return delete i.appear,delete i.enter,delete i.exit,null===n?t.createElement(wA.Provider,{value:o},s):t.createElement(wA.Provider,{value:o},t.createElement(n,i,s))},n}(t.Component);RA.propTypes={},RA.defaultProps={component:"div",childFactory:function(e){return e}};const IA=RA;var xA=n(8283),OA=n(1824);const kA=function(e){const{className:n,classes:r,pulsate:i=!1,rippleX:o,rippleY:s,rippleSize:a,in:c,onExited:l,timeout:u}=e,[d,h]=t.useState(!1),p=(0,Pe.A)(n,r.ripple,r.rippleVisible,i&&r.ripplePulsate),f={width:a,height:a,top:-a/2+s,left:-a/2+o},m=(0,Pe.A)(r.child,d&&r.childLeaving,i&&r.childPulsate);return c||d||h(!0),t.useEffect((()=>{if(!c&&null!=l){const e=setTimeout(l,u);return()=>{clearTimeout(e)}}}),[l,c,u]),(0,We.jsx)("span",{className:p,style:f,children:(0,We.jsx)("span",{className:m})})};const NA=(0,Ke.A)("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),PA=["center","classes","className"];let DA,LA,MA,jA,UA=e=>e;const VA=(0,xA.i7)(DA||(DA=UA`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),FA=(0,xA.i7)(LA||(LA=UA`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),BA=(0,xA.i7)(MA||(MA=UA`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),WA=(0,wC.Ay)("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),zA=(0,wC.Ay)(kA,{name:"MuiTouchRipple",slot:"Ripple"})(jA||(jA=UA`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),NA.rippleVisible,VA,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),NA.ripplePulsate,(e=>{let{theme:t}=e;return t.transitions.duration.shorter}),NA.child,NA.childLeaving,FA,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),NA.childPulsate,BA,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut})),HA=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiTouchRipple"}),{center:i=!1,classes:o={},className:s}=r,a=(0,Ne.A)(r,PA),[c,l]=t.useState([]),u=t.useRef(0),d=t.useRef(null);t.useEffect((()=>{d.current&&(d.current(),d.current=null)}),[c]);const h=t.useRef(!1),p=(0,OA.A)(),f=t.useRef(null),m=t.useRef(null),g=t.useCallback((e=>{const{pulsate:t,rippleX:n,rippleY:r,rippleSize:i,cb:s}=e;l((e=>[...e,(0,We.jsx)(zA,{classes:{ripple:(0,Pe.A)(o.ripple,NA.ripple),rippleVisible:(0,Pe.A)(o.rippleVisible,NA.rippleVisible),ripplePulsate:(0,Pe.A)(o.ripplePulsate,NA.ripplePulsate),child:(0,Pe.A)(o.child,NA.child),childLeaving:(0,Pe.A)(o.childLeaving,NA.childLeaving),childPulsate:(0,Pe.A)(o.childPulsate,NA.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:i},u.current)])),u.current+=1,d.current=s}),[o]),v=t.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:r=!1,center:o=i||t.pulsate,fakeElement:s=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&h.current)return void(h.current=!1);"touchstart"===(null==e?void 0:e.type)&&(h.current=!0);const a=s?null:m.current,c=a?a.getBoundingClientRect():{width:0,height:0,left:0,top:0};let l,u,d;if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)l=Math.round(c.width/2),u=Math.round(c.height/2);else{const{clientX:t,clientY:n}=e.touches&&e.touches.length>0?e.touches[0]:e;l=Math.round(t-c.left),u=Math.round(n-c.top)}if(o)d=Math.sqrt((2*c.width**2+c.height**2)/3),d%2===0&&(d+=1);else{const e=2*Math.max(Math.abs((a?a.clientWidth:0)-l),l)+2,t=2*Math.max(Math.abs((a?a.clientHeight:0)-u),u)+2;d=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===f.current&&(f.current=()=>{g({pulsate:r,rippleX:l,rippleY:u,rippleSize:d,cb:n})},p.start(80,(()=>{f.current&&(f.current(),f.current=null)}))):g({pulsate:r,rippleX:l,rippleY:u,rippleSize:d,cb:n})}),[i,g,p]),y=t.useCallback((()=>{v({},{pulsate:!0})}),[v]),_=t.useCallback(((e,t)=>{if(p.clear(),"touchend"===(null==e?void 0:e.type)&&f.current)return f.current(),f.current=null,void p.start(0,(()=>{_(e,t)}));f.current=null,l((e=>e.length>0?e.slice(1):e)),d.current=t}),[p]);return t.useImperativeHandle(n,(()=>({pulsate:y,start:v,stop:_})),[y,v,_]),(0,We.jsx)(WA,(0,ke.A)({className:(0,Pe.A)(NA.root,o.root,s),ref:m},a,{children:(0,We.jsx)(IA,{component:null,exit:!0,children:c})}))})),GA=HA;function qA(e){return(0,AC.Ay)("MuiButtonBase",e)}const KA=(0,Ke.A)("MuiButtonBase",["root","disabled","focusVisible"]),$A=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],YA=(0,wC.Ay)("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${KA.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),XA=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiButtonBase"}),{action:i,centerRipple:o=!1,children:s,className:a,component:c="button",disabled:l=!1,disableRipple:u=!1,disableTouchRipple:d=!1,focusRipple:h=!1,LinkComponent:p="a",onBlur:f,onClick:m,onContextMenu:g,onDragLeave:v,onFocus:y,onFocusVisible:_,onKeyDown:E,onKeyUp:b,onMouseDown:w,onMouseLeave:S,onMouseUp:T,onTouchEnd:C,onTouchMove:A,onTouchStart:R,tabIndex:I=0,TouchRippleProps:x,touchRippleRef:O,type:k}=r,N=(0,Ne.A)(r,$A),P=t.useRef(null),D=t.useRef(null),L=(0,gA.A)(D,O),{isFocusVisibleRef:M,onFocus:j,onBlur:U,ref:V}=(0,yA.A)(),[F,B]=t.useState(!1);l&&F&&B(!1),t.useImperativeHandle(i,(()=>({focusVisible:()=>{B(!0),P.current.focus()}})),[]);const[W,z]=t.useState(!1);t.useEffect((()=>{z(!0)}),[]);const H=W&&!u&&!l;function G(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d;return(0,vA.A)((r=>{t&&t(r);return!n&&D.current&&D.current[e](r),!0}))}t.useEffect((()=>{F&&h&&!u&&W&&D.current.pulsate()}),[u,h,F,W]);const q=G("start",w),K=G("stop",g),$=G("stop",v),Y=G("stop",T),X=G("stop",(e=>{F&&e.preventDefault(),S&&S(e)})),J=G("start",R),Q=G("stop",C),Z=G("stop",A),ee=G("stop",(e=>{U(e),!1===M.current&&B(!1),f&&f(e)}),!1),te=(0,vA.A)((e=>{P.current||(P.current=e.currentTarget),j(e),!0===M.current&&(B(!0),_&&_(e)),y&&y(e)})),ne=()=>{const e=P.current;return c&&"button"!==c&&!("A"===e.tagName&&e.href)},re=t.useRef(!1),ie=(0,vA.A)((e=>{h&&!re.current&&F&&D.current&&" "===e.key&&(re.current=!0,D.current.stop(e,(()=>{D.current.start(e)}))),e.target===e.currentTarget&&ne()&&" "===e.key&&e.preventDefault(),E&&E(e),e.target===e.currentTarget&&ne()&&"Enter"===e.key&&!l&&(e.preventDefault(),m&&m(e))})),oe=(0,vA.A)((e=>{h&&" "===e.key&&D.current&&F&&!e.defaultPrevented&&(re.current=!1,D.current.stop(e,(()=>{D.current.pulsate(e)}))),b&&b(e),m&&e.target===e.currentTarget&&ne()&&" "===e.key&&!e.defaultPrevented&&m(e)}));let se=c;"button"===se&&(N.href||N.to)&&(se=p);const ae={};"button"===se?(ae.type=void 0===k?"button":k,ae.disabled=l):(N.href||N.to||(ae.role="button"),l&&(ae["aria-disabled"]=l));const ce=(0,gA.A)(n,V,P);const le=(0,ke.A)({},r,{centerRipple:o,component:c,disabled:l,disableRipple:u,disableTouchRipple:d,focusRipple:h,tabIndex:I,focusVisible:F}),ue=(e=>{const{disabled:t,focusVisible:n,focusVisibleClassName:r,classes:i}=e,o={root:["root",t&&"disabled",n&&"focusVisible"]},s=(0,bC.A)(o,qA,i);return n&&r&&(s.root+=` ${r}`),s})(le);return(0,We.jsxs)(YA,(0,ke.A)({as:se,className:(0,Pe.A)(ue.root,a),ownerState:le,onBlur:ee,onClick:m,onContextMenu:K,onFocus:te,onKeyDown:ie,onKeyUp:oe,onMouseDown:q,onMouseLeave:X,onMouseUp:Y,onDragLeave:$,onTouchEnd:Q,onTouchMove:Z,onTouchStart:J,ref:ce,tabIndex:l?-1:I,type:k},ae,N,{children:[s,H?(0,We.jsx)(GA,(0,ke.A)({ref:L,center:o},x)):null]}))})),JA=XA;function QA(e){return(0,AC.Ay)("MuiIconButton",e)}const ZA=(0,Ke.A)("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),eR=["edge","children","className","color","disabled","disableFocusRipple","size"],tR=(0,wC.Ay)(JA,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"default"!==n.color&&t[`color${(0,SC.A)(n.color)}`],n.edge&&t[`edge${(0,SC.A)(n.edge)}`],t[`size${(0,SC.A)(n.size)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest})},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===n.edge&&{marginLeft:"small"===n.size?-3:-12},"end"===n.edge&&{marginRight:"small"===n.size?-3:-12})}),(e=>{let{theme:t,ownerState:n}=e;var r;const i=null==(r=(t.vars||t).palette)?void 0:r[n.color];return(0,ke.A)({},"inherit"===n.color&&{color:"inherit"},"inherit"!==n.color&&"default"!==n.color&&(0,ke.A)({color:null==i?void 0:i.main},!n.disableRipple&&{"&:hover":(0,ke.A)({},i&&{backgroundColor:t.vars?`rgba(${i.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(i.main,t.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),"small"===n.size&&{padding:5,fontSize:t.typography.pxToRem(18)},"large"===n.size&&{padding:12,fontSize:t.typography.pxToRem(28)},{[`&.${ZA.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}})})),nR=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiIconButton"}),{edge:r=!1,children:i,className:o,color:s="default",disabled:a=!1,disableFocusRipple:c=!1,size:l="medium"}=n,u=(0,Ne.A)(n,eR),d=(0,ke.A)({},n,{edge:r,color:s,disabled:a,disableFocusRipple:c,size:l}),h=(e=>{const{classes:t,disabled:n,color:r,edge:i,size:o}=e,s={root:["root",n&&"disabled","default"!==r&&`color${(0,SC.A)(r)}`,i&&`edge${(0,SC.A)(i)}`,`size${(0,SC.A)(o)}`]};return(0,bC.A)(s,QA,t)})(d);return(0,We.jsx)(tR,(0,ke.A)({className:(0,Pe.A)(h.root,o),centerRipple:!0,focusRipple:!c,disabled:a,ref:t},u,{ownerState:d,children:i}))})),rR=nR,iR=e=>{const n=t.useRef({});return t.useEffect((()=>{n.current=e})),n.current},oR=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];const sR=function(e){var t;const{elementType:n,externalSlotProps:r,ownerState:i,skipResolvingSlotProps:o=!1}=e,s=(0,Ne.A)(e,oR),a=o?{}:YC(r,i),{props:c,internalRef:l}=QC((0,ke.A)({},s,{externalSlotProps:a})),u=(0,qC.A)(l,null==a?void 0:a.ref,null==(t=e.additionalProps)?void 0:t.ref);return $C(n,(0,ke.A)({},c,{ref:u}),i)};const aR=function(e){const{badgeContent:t,invisible:n=!1,max:r=99,showZero:i=!1}=e,o=iR({badgeContent:t,max:r});let s=n;!1!==n||0!==t||i||(s=!0);const{badgeContent:a,max:c=r}=s?o:e;return{badgeContent:a,invisible:s,max:c,displayValue:a&&Number(a)>c?`${c}+`:a}};function cR(e){return(0,AC.Ay)("MuiBadge",e)}const lR=(0,Ke.A)("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),uR=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],dR=(0,wC.Ay)("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),hR=(0,wC.Ay)("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.badge,t[n.variant],t[`anchorOrigin${(0,SC.A)(n.anchorOrigin.vertical)}${(0,SC.A)(n.anchorOrigin.horizontal)}${(0,SC.A)(n.overlap)}`],"default"!==n.color&&t[`color${(0,SC.A)(n.color)}`],n.invisible&&t.invisible]}})((e=>{let{theme:t}=e;var n;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.keys((null!=(n=t.vars)?n:t).palette).filter((e=>{var n,r;return(null!=(n=t.vars)?n:t).palette[e].main&&(null!=(r=t.vars)?r:t).palette[e].contrastText})).map((e=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main,color:(t.vars||t).palette[e].contrastText}}))),{props:{variant:"dot"},style:{borderRadius:4,height:8,minWidth:8,padding:0}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${lR.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}})),pR=t.forwardRef((function(e,t){var n,r,i,o,s,a;const c=(0,Qe.b)({props:e,name:"MuiBadge"}),{anchorOrigin:l={vertical:"top",horizontal:"right"},className:u,component:d,components:h={},componentsProps:p={},children:f,overlap:m="rectangular",color:g="default",invisible:v=!1,max:y=99,badgeContent:_,slots:E,slotProps:b,showZero:w=!1,variant:S="standard"}=c,T=(0,Ne.A)(c,uR),{badgeContent:C,invisible:A,max:R,displayValue:I}=aR({max:y,invisible:v,badgeContent:_,showZero:w}),x=iR({anchorOrigin:l,color:g,overlap:m,variant:S,badgeContent:_}),O=A||null==C&&"dot"!==S,{color:k=g,overlap:N=m,anchorOrigin:P=l,variant:D=S}=O?x:c,L="dot"!==D?I:void 0,M=(0,ke.A)({},c,{badgeContent:C,invisible:O,max:R,displayValue:L,showZero:w,anchorOrigin:P,color:k,overlap:N,variant:D}),j=(e=>{const{color:t,anchorOrigin:n,invisible:r,overlap:i,variant:o,classes:s={}}=e,a={root:["root"],badge:["badge",o,r&&"invisible",`anchorOrigin${(0,SC.A)(n.vertical)}${(0,SC.A)(n.horizontal)}`,`anchorOrigin${(0,SC.A)(n.vertical)}${(0,SC.A)(n.horizontal)}${(0,SC.A)(i)}`,`overlap${(0,SC.A)(i)}`,"default"!==t&&`color${(0,SC.A)(t)}`]};return(0,bC.A)(a,cR,s)})(M),U=null!=(n=null!=(r=null==E?void 0:E.root)?r:h.Root)?n:dR,V=null!=(i=null!=(o=null==E?void 0:E.badge)?o:h.Badge)?i:hR,F=null!=(s=null==b?void 0:b.root)?s:p.root,B=null!=(a=null==b?void 0:b.badge)?a:p.badge,W=sR({elementType:U,externalSlotProps:F,externalForwardedProps:T,additionalProps:{ref:t,as:d},ownerState:M,className:(0,Pe.A)(null==F?void 0:F.className,j.root,u)}),z=sR({elementType:V,externalSlotProps:B,ownerState:M,className:(0,Pe.A)(j.badge,null==B?void 0:B.className)});return(0,We.jsxs)(U,(0,ke.A)({},W,{children:[f,(0,We.jsx)(V,(0,ke.A)({},z,{children:L}))]}))})),fR=pR;var mR=n(5537),gR=n(9608);function vR(e){return(0,AC.Ay)("MuiButton",e)}const yR=(0,Ke.A)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);const _R=t.createContext({});const ER=t.createContext(void 0),bR=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],wR=e=>(0,ke.A)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),SR=(0,wC.Ay)(JA,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`${n.variant}${(0,SC.A)(n.color)}`],t[`size${(0,SC.A)(n.size)}`],t[`${n.variant}Size${(0,SC.A)(n.size)}`],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((e=>{let{theme:t,ownerState:n}=e;var r,i;const o="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],s="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return(0,ke.A)({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":(0,ke.A)({textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===n.variant&&"inherit"!==n.color&&{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===n.variant&&"inherit"!==n.color&&{border:`1px solid ${(t.vars||t).palette[n.color].main}`,backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===n.variant&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:s,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},"contained"===n.variant&&"inherit"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}),"&:active":(0,ke.A)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[8]}),[`&.${yR.focusVisible}`]:(0,ke.A)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[6]}),[`&.${yR.disabled}`]:(0,ke.A)({color:(t.vars||t).palette.action.disabled},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"contained"===n.variant&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},"text"===n.variant&&{padding:"6px 8px"},"text"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main},"outlined"===n.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:t.vars?`1px solid rgba(${t.vars.palette[n.color].mainChannel} / 0.5)`:`1px solid ${(0,TC.X4)(t.palette[n.color].main,.5)}`},"contained"===n.variant&&{color:t.vars?t.vars.palette.text.primary:null==(r=(i=t.palette).getContrastText)?void 0:r.call(i,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:o,boxShadow:(t.vars||t).shadows[2]},"contained"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main},"inherit"===n.color&&{color:"inherit",borderColor:"currentColor"},"small"===n.size&&"text"===n.variant&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"text"===n.variant&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"outlined"===n.variant&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"outlined"===n.variant&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"contained"===n.variant&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"contained"===n.variant&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},n.fullWidth&&{width:"100%"})}),(e=>{let{ownerState:t}=e;return t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${yR.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${yR.disabled}`]:{boxShadow:"none"}}})),TR=(0,wC.Ay)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.startIcon,t[`iconSize${(0,SC.A)(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},wR(t))})),CR=(0,wC.Ay)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.endIcon,t[`iconSize${(0,SC.A)(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},wR(t))})),AR=t.forwardRef((function(e,n){const r=t.useContext(_R),i=t.useContext(ER),o=(0,mR.A)(r,e),s=(0,Qe.b)({props:o,name:"MuiButton"}),{children:a,color:c="primary",component:l="button",className:u,disabled:d=!1,disableElevation:h=!1,disableFocusRipple:p=!1,endIcon:f,focusVisibleClassName:m,fullWidth:g=!1,size:v="medium",startIcon:y,type:_,variant:E="text"}=s,b=(0,Ne.A)(s,bR),w=(0,ke.A)({},s,{color:c,component:l,disabled:d,disableElevation:h,disableFocusRipple:p,fullWidth:g,size:v,type:_,variant:E}),S=(e=>{const{color:t,disableElevation:n,fullWidth:r,size:i,variant:o,classes:s}=e,a={root:["root",o,`${o}${(0,SC.A)(t)}`,`size${(0,SC.A)(i)}`,`${o}Size${(0,SC.A)(i)}`,`color${(0,SC.A)(t)}`,n&&"disableElevation",r&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${(0,SC.A)(i)}`],endIcon:["icon","endIcon",`iconSize${(0,SC.A)(i)}`]},c=(0,bC.A)(a,vR,s);return(0,ke.A)({},s,c)})(w),T=y&&(0,We.jsx)(TR,{className:S.startIcon,ownerState:w,children:y}),C=f&&(0,We.jsx)(CR,{className:S.endIcon,ownerState:w,children:f}),A=i||"";return(0,We.jsxs)(SR,(0,ke.A)({ownerState:w,className:(0,Pe.A)(r.className,S.root,u,A),component:l,disabled:d,focusRipple:!p,focusVisibleClassName:(0,Pe.A)(S.focusVisible,m),ref:n,type:_},b,{classes:S,children:[T,a,C]}))})),RR=AR;var IR=n(7402);const xR=t.createContext({});function OR(e){return(0,AC.Ay)("MuiList",e)}(0,Ke.A)("MuiList",["root","padding","dense","subheader"]);const kR=["children","className","component","dense","disablePadding","subheader"],NR=(0,wC.Ay)("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disablePadding&&t.padding,n.dense&&t.dense,n.subheader&&t.subheader]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})})),PR=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiList"}),{children:i,className:o,component:s="ul",dense:a=!1,disablePadding:c=!1,subheader:l}=r,u=(0,Ne.A)(r,kR),d=t.useMemo((()=>({dense:a})),[a]),h=(0,ke.A)({},r,{component:s,dense:a,disablePadding:c}),p=(e=>{const{classes:t,disablePadding:n,dense:r,subheader:i}=e,o={root:["root",!n&&"padding",r&&"dense",i&&"subheader"]};return(0,bC.A)(o,OR,t)})(h);return(0,We.jsx)(xR.Provider,{value:d,children:(0,We.jsxs)(NR,(0,ke.A)({as:s,className:(0,Pe.A)(p.root,o),ref:n,ownerState:h},u,{children:[l,i]}))})})),DR=PR;function LR(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}const MR=LR;var jR=n(9044);const UR=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function VR(e,t,n){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:n?null:e.firstChild}function FR(e,t,n){return e===t?n?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:n?null:e.lastChild}function BR(e,t){if(void 0===t)return!0;let n=e.innerText;return void 0===n&&(n=e.textContent),n=n.trim().toLowerCase(),0!==n.length&&(t.repeating?n[0]===t.keys[0]:0===n.indexOf(t.keys.join("")))}function WR(e,t,n,r,i,o){let s=!1,a=i(e,t,!!t&&n);for(;a;){if(a===e.firstChild){if(s)return!1;s=!0}const t=!r&&(a.disabled||"true"===a.getAttribute("aria-disabled"));if(a.hasAttribute("tabindex")&&BR(a,o)&&!t)return a.focus(),!0;a=i(e,a,n)}return!1}const zR=t.forwardRef((function(e,n){const{actions:r,autoFocus:i=!1,autoFocusItem:o=!1,children:s,className:a,disabledItemsFocusable:c=!1,disableListWrap:l=!1,onKeyDown:u,variant:d="selectedMenu"}=e,h=(0,Ne.A)(e,UR),p=t.useRef(null),f=t.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});(0,jR.A)((()=>{i&&p.current.focus()}),[i]),t.useImperativeHandle(r,(()=>({adjustStyleForScrollbar:(e,t)=>{let{direction:n}=t;const r=!p.current.style.width;if(e.clientHeight<p.current.clientHeight&&r){const t=`${MR((0,IR.A)(e))}px`;p.current.style["rtl"===n?"paddingLeft":"paddingRight"]=t,p.current.style.width=`calc(100% + ${t})`}return p.current}})),[]);const m=(0,gA.A)(p,n);let g=-1;t.Children.forEach(s,((e,n)=>{t.isValidElement(e)?(e.props.disabled||("selectedMenu"===d&&e.props.selected||-1===g)&&(g=n),g===n&&(e.props.disabled||e.props.muiSkipListHighlight||e.type.muiSkipListHighlight)&&(g+=1,g>=s.length&&(g=-1))):g===n&&(g+=1,g>=s.length&&(g=-1))}));const v=t.Children.map(s,((e,n)=>{if(n===g){const n={};return o&&(n.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===d&&(n.tabIndex=0),t.cloneElement(e,n)}return e}));return(0,We.jsx)(DR,(0,ke.A)({role:"menu",ref:m,className:a,onKeyDown:e=>{const t=p.current,n=e.key,r=(0,IR.A)(t).activeElement;if("ArrowDown"===n)e.preventDefault(),WR(t,r,l,c,VR);else if("ArrowUp"===n)e.preventDefault(),WR(t,r,l,c,FR);else if("Home"===n)e.preventDefault(),WR(t,null,l,c,VR);else if("End"===n)e.preventDefault(),WR(t,null,l,c,FR);else if(1===n.length){const i=f.current,o=n.toLowerCase(),s=performance.now();i.keys.length>0&&(s-i.lastTime>500?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&o!==i.keys[0]&&(i.repeating=!1)),i.lastTime=s,i.keys.push(o);const a=r&&!i.repeating&&BR(r,i);i.previousKeyMatched&&(a||WR(t,r,!1,c,VR,i))?e.preventDefault():i.previousKeyMatched=!1}u&&u(e)},tabIndex:i?0:-1},h,{children:v}))})),HR=zR;var GR=n(1209),qR=n(827);function KR(e){var n;return parseInt(t.version,10)>=19?(null==e||null==(n=e.props)?void 0:n.ref)||null:(null==e?void 0:e.ref)||null}const $R=!1;var YR=function(e){return e.scrollTop},XR="unmounted",JR="exited",QR="entering",ZR="entered",eI="exiting",tI=function(e){function n(t,n){var r;r=e.call(this,t,n)||this;var i,o=n&&!n.isMounting?t.enter:t.appear;return r.appearStatus=null,t.in?o?(i=JR,r.appearStatus=QR):i=ZR:i=t.unmountOnExit||t.mountOnEnter?XR:JR,r.state={status:i},r.nextCallback=null,r}bA(n,e),n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===XR?{status:JR}:null};var r=n.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==QR&&n!==ZR&&(t=QR):n!==QR&&n!==ZR||(t=eI)}this.updateStatus(!1,t)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var e,t,n,r=this.props.timeout;return e=t=n=r,null!=r&&"number"!==typeof r&&(e=r.exit,t=r.enter,n=void 0!==r.appear?r.appear:t),{exit:e,enter:t,appear:n}},r.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===QR){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:_e.findDOMNode(this);n&&YR(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===JR&&this.setState({status:XR})},r.performEnter=function(e){var t=this,n=this.props.enter,r=this.context?this.context.isMounting:e,i=this.props.nodeRef?[r]:[_e.findDOMNode(this),r],o=i[0],s=i[1],a=this.getTimeouts(),c=r?a.appear:a.enter;!e&&!n||$R?this.safeSetState({status:ZR},(function(){t.props.onEntered(o)})):(this.props.onEnter(o,s),this.safeSetState({status:QR},(function(){t.props.onEntering(o,s),t.onTransitionEnd(c,(function(){t.safeSetState({status:ZR},(function(){t.props.onEntered(o,s)}))}))})))},r.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),r=this.props.nodeRef?void 0:_e.findDOMNode(this);t&&!$R?(this.props.onExit(r),this.safeSetState({status:eI},(function(){e.props.onExiting(r),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:JR},(function(){e.props.onExited(r)}))}))}))):this.safeSetState({status:JR},(function(){e.props.onExited(r)}))},r.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},r.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},r.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:_e.findDOMNode(this),r=null==e&&!this.props.addEndListener;if(n&&!r){if(this.props.addEndListener){var i=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=i[0],s=i[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},r.render=function(){var e=this.state.status;if(e===XR)return null;var n=this.props,r=n.children,i=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,(0,Ne.A)(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return t.createElement(wA.Provider,{value:null},"function"===typeof r?r(e,i):t.cloneElement(t.Children.only(r),i))},n}(t.Component);function nI(){}tI.contextType=wA,tI.propTypes={},tI.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:nI,onEntering:nI,onEntered:nI,onExit:nI,onExiting:nI,onExited:nI},tI.UNMOUNTED=XR,tI.EXITED=JR,tI.ENTERING=QR,tI.ENTERED=ZR,tI.EXITING=eI;const rI=tI;function iI(){const e=Be(tt.A);return e[qe.A]||e}const oI=e=>e.scrollTop;function sI(e,t){var n,r;const{timeout:i,easing:o,style:s={}}=e;return{duration:null!=(n=s.transitionDuration)?n:"number"===typeof i?i:i[t.mode]||0,easing:null!=(r=s.transitionTimingFunction)?r:"object"===typeof o?o[t.mode]:o,delay:s.transitionDelay}}const aI=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function cI(e){return`scale(${e}, ${e**2})`}const lI={entering:{opacity:1,transform:cI(1)},entered:{opacity:1,transform:"none"}},uI="undefined"!==typeof navigator&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),dI=t.forwardRef((function(e,n){const{addEndListener:r,appear:i=!0,children:o,easing:s,in:a,onEnter:c,onEntered:l,onEntering:u,onExit:d,onExited:h,onExiting:p,style:f,timeout:m="auto",TransitionComponent:g=rI}=e,v=(0,Ne.A)(e,aI),y=(0,OA.A)(),_=t.useRef(),E=iI(),b=t.useRef(null),w=(0,gA.A)(b,KR(o),n),S=e=>t=>{if(e){const n=b.current;void 0===t?e(n):e(n,t)}},T=S(u),C=S(((e,t)=>{oI(e);const{duration:n,delay:r,easing:i}=sI({style:f,timeout:m,easing:s},{mode:"enter"});let o;"auto"===m?(o=E.transitions.getAutoHeightDuration(e.clientHeight),_.current=o):o=n,e.style.transition=[E.transitions.create("opacity",{duration:o,delay:r}),E.transitions.create("transform",{duration:uI?o:.666*o,delay:r,easing:i})].join(","),c&&c(e,t)})),A=S(l),R=S(p),I=S((e=>{const{duration:t,delay:n,easing:r}=sI({style:f,timeout:m,easing:s},{mode:"exit"});let i;"auto"===m?(i=E.transitions.getAutoHeightDuration(e.clientHeight),_.current=i):i=t,e.style.transition=[E.transitions.create("opacity",{duration:i,delay:n}),E.transitions.create("transform",{duration:uI?i:.666*i,delay:uI?n:n||.333*i,easing:r})].join(","),e.style.opacity=0,e.style.transform=cI(.75),d&&d(e)})),x=S(h);return(0,We.jsx)(g,(0,ke.A)({appear:i,in:a,nodeRef:b,onEnter:C,onEntered:A,onEntering:T,onExit:I,onExited:x,onExiting:R,addEndListener:e=>{"auto"===m&&y.start(_.current||0,e),r&&r(b.current,e)},timeout:"auto"===m?null:m},v,{children:(e,n)=>t.cloneElement(o,(0,ke.A)({style:(0,ke.A)({opacity:0,transform:cI(.75),visibility:"exited"!==e||a?void 0:"hidden"},lI[e],f,o.props.style),ref:w},n))}))}));dI.muiSupportAuto=!0;const hI=dI;var pI=n(6907);const fI=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function mI(e){const t=[],n=[];return Array.from(e.querySelectorAll(fI)).forEach(((e,r)=>{const i=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==i&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let n=t(`[name="${e.name}"]:checked`);return n||(n=t(`[name="${e.name}"]`)),n!==e}(e))}(e)&&(0===i?t.push(e):n.push({documentOrder:r,tabIndex:i,node:e}))})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function gI(){return!0}const vI=function(e){const{children:n,disableAutoFocus:r=!1,disableEnforceFocus:i=!1,disableRestoreFocus:o=!1,getTabbable:s=mI,isEnabled:a=gI,open:c}=e,l=t.useRef(!1),u=t.useRef(null),d=t.useRef(null),h=t.useRef(null),p=t.useRef(null),f=t.useRef(!1),m=t.useRef(null),g=(0,qC.A)(KR(n),m),v=t.useRef(null);t.useEffect((()=>{c&&m.current&&(f.current=!r)}),[r,c]),t.useEffect((()=>{if(!c||!m.current)return;const e=(0,pI.A)(m.current);return m.current.contains(e.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),f.current&&m.current.focus()),()=>{o||(h.current&&h.current.focus&&(l.current=!0,h.current.focus()),h.current=null)}}),[c]),t.useEffect((()=>{if(!c||!m.current)return;const e=(0,pI.A)(m.current),t=t=>{v.current=t,!i&&a()&&"Tab"===t.key&&e.activeElement===m.current&&t.shiftKey&&(l.current=!0,d.current&&d.current.focus())},n=()=>{const t=m.current;if(null===t)return;if(!e.hasFocus()||!a()||l.current)return void(l.current=!1);if(t.contains(e.activeElement))return;if(i&&e.activeElement!==u.current&&e.activeElement!==d.current)return;if(e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!f.current)return;let n=[];if(e.activeElement!==u.current&&e.activeElement!==d.current||(n=s(m.current)),n.length>0){var r,o;const e=Boolean((null==(r=v.current)?void 0:r.shiftKey)&&"Tab"===(null==(o=v.current)?void 0:o.key)),t=n[0],i=n[n.length-1];"string"!==typeof t&&"string"!==typeof i&&(e?i.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const r=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()}),50);return()=>{clearInterval(r),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}}),[r,i,o,a,c,s]);const y=e=>{null===h.current&&(h.current=e.relatedTarget),f.current=!0};return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)("div",{tabIndex:c?0:-1,onFocus:y,ref:u,"data-testid":"sentinelStart"}),t.cloneElement(n,{ref:g,onFocus:e=>{null===h.current&&(h.current=e.relatedTarget),f.current=!0,p.current=e.target;const t=n.props.onFocus;t&&t(e)}}),(0,We.jsx)("div",{tabIndex:c?0:-1,onFocus:y,ref:d,"data-testid":"sentinelEnd"})]})};var yI=n(1399),_I=n(5587);const EI=t.forwardRef((function(e,n){const{children:r,container:i,disablePortal:o=!1}=e,[s,a]=t.useState(null),c=(0,qC.A)(t.isValidElement(r)?KR(r):null,n);if((0,yI.A)((()=>{o||a(function(e){return"function"===typeof e?e():e}(i)||document.body)}),[i,o]),(0,yI.A)((()=>{if(s&&!o)return(0,_I.A)(n,s),()=>{(0,_I.A)(n,null)}}),[n,s,o]),o){if(t.isValidElement(r)){const e={ref:c};return t.cloneElement(r,e)}return(0,We.jsx)(t.Fragment,{children:r})}return(0,We.jsx)(t.Fragment,{children:s?_e.createPortal(r,s):s})})),bI=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],wI={entering:{opacity:1},entered:{opacity:1}},SI=t.forwardRef((function(e,n){const r=iI(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:o,appear:s=!0,children:a,easing:c,in:l,onEnter:u,onEntered:d,onEntering:h,onExit:p,onExited:f,onExiting:m,style:g,timeout:v=i,TransitionComponent:y=rI}=e,_=(0,Ne.A)(e,bI),E=t.useRef(null),b=(0,gA.A)(E,KR(a),n),w=e=>t=>{if(e){const n=E.current;void 0===t?e(n):e(n,t)}},S=w(h),T=w(((e,t)=>{oI(e);const n=sI({style:g,timeout:v,easing:c},{mode:"enter"});e.style.webkitTransition=r.transitions.create("opacity",n),e.style.transition=r.transitions.create("opacity",n),u&&u(e,t)})),C=w(d),A=w(m),R=w((e=>{const t=sI({style:g,timeout:v,easing:c},{mode:"exit"});e.style.webkitTransition=r.transitions.create("opacity",t),e.style.transition=r.transitions.create("opacity",t),p&&p(e)})),I=w(f);return(0,We.jsx)(y,(0,ke.A)({appear:s,in:l,nodeRef:E,onEnter:T,onEntered:C,onEntering:S,onExit:R,onExited:I,onExiting:A,addEndListener:e=>{o&&o(E.current,e)},timeout:v},_,{children:(e,n)=>t.cloneElement(a,(0,ke.A)({style:(0,ke.A)({opacity:0,visibility:"exited"!==e||l?void 0:"hidden"},wI[e],g,a.props.style),ref:b},n))}))})),TI=SI;function CI(e){return(0,AC.Ay)("MuiBackdrop",e)}(0,Ke.A)("MuiBackdrop",["root","invisible"]);const AI=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],RI=(0,wC.Ay)("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.invisible&&t.invisible]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})})),II=t.forwardRef((function(e,t){var n,r,i;const o=(0,Qe.b)({props:e,name:"MuiBackdrop"}),{children:s,className:a,component:c="div",components:l={},componentsProps:u={},invisible:d=!1,open:h,slotProps:p={},slots:f={},TransitionComponent:m=TI,transitionDuration:g}=o,v=(0,Ne.A)(o,AI),y=(0,ke.A)({},o,{component:c,invisible:d}),_=(e=>{const{classes:t,invisible:n}=e,r={root:["root",n&&"invisible"]};return(0,bC.A)(r,CI,t)})(y),E=null!=(n=p.root)?n:u.root;return(0,We.jsx)(m,(0,ke.A)({in:h,timeout:g},v,{children:(0,We.jsx)(RI,(0,ke.A)({"aria-hidden":!0},E,{as:null!=(r=null!=(i=f.root)?i:l.Root)?r:c,className:(0,Pe.A)(_.root,a,null==E?void 0:E.className),ownerState:(0,ke.A)({},y,null==E?void 0:E.ownerState),classes:_,ref:t,children:s}))}))})),xI=II;var OI=n(2529),kI=n(5511),NI=n(8635);function PI(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function DI(e){return parseInt((0,NI.A)(e).getComputedStyle(e).paddingRight,10)||0}function LI(e,t,n,r,i){const o=[t,n,...r];[].forEach.call(e.children,(e=>{const t=-1===o.indexOf(e),n=!function(e){const t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}(e);t&&n&&PI(e,i)}))}function MI(e,t){let n=-1;return e.some(((e,r)=>!!t(e)&&(n=r,!0))),n}function jI(e,t){const n=[],r=e.container;if(!t.disableScrollLock){if(function(e){const t=(0,pI.A)(e);return t.body===e?(0,NI.A)(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(r)){const e=LR((0,pI.A)(r));n.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight=`${DI(r)+e}px`;const t=(0,pI.A)(r).querySelectorAll(".mui-fixed");[].forEach.call(t,(t=>{n.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight=`${DI(t)+e}px`}))}let e;if(r.parentNode instanceof DocumentFragment)e=(0,pI.A)(r).body;else{const t=r.parentElement,n=(0,NI.A)(r);e="HTML"===(null==t?void 0:t.nodeName)&&"scroll"===n.getComputedStyle(t).overflowY?t:r}n.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{n.forEach((e=>{let{value:t,el:n,property:r}=e;t?n.style.setProperty(r,t):n.style.removeProperty(r)}))}}const UI=new class{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&PI(e.modalRef,!1);const r=function(e){const t=[];return[].forEach.call(e.children,(e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);LI(t,e.mount,e.modalRef,r,!0);const i=MI(this.containers,(e=>e.container===t));return-1!==i?(this.containers[i].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:r}),n)}mount(e,t){const n=MI(this.containers,(t=>-1!==t.modals.indexOf(e))),r=this.containers[n];r.restore||(r.restore=jI(r,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.modals.indexOf(e);if(-1===n)return n;const r=MI(this.containers,(t=>-1!==t.modals.indexOf(e))),i=this.containers[r];if(i.modals.splice(i.modals.indexOf(e),1),this.modals.splice(n,1),0===i.modals.length)i.restore&&i.restore(),e.modalRef&&PI(e.modalRef,t),LI(i.container,e.mount,e.modalRef,i.hiddenSiblings,!1),this.containers.splice(r,1);else{const e=i.modals[i.modals.length-1];e.modalRef&&PI(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};const VI=function(e){const{container:n,disableEscapeKeyDown:r=!1,disableScrollLock:i=!1,manager:o=UI,closeAfterTransition:s=!1,onTransitionEnter:a,onTransitionExited:c,children:l,onClose:u,open:d,rootRef:h}=e,p=t.useRef({}),f=t.useRef(null),m=t.useRef(null),g=(0,qC.A)(m,h),[v,y]=t.useState(!d),_=function(e){return!!e&&e.props.hasOwnProperty("in")}(l);let E=!0;"false"!==e["aria-hidden"]&&!1!==e["aria-hidden"]||(E=!1);const b=()=>(p.current.modalRef=m.current,p.current.mount=f.current,p.current),w=()=>{o.mount(b(),{disableScrollLock:i}),m.current&&(m.current.scrollTop=0)},S=(0,OI.A)((()=>{const e=function(e){return"function"===typeof e?e():e}(n)||(0,pI.A)(f.current).body;o.add(b(),e),m.current&&w()})),T=t.useCallback((()=>o.isTopModal(b())),[o]),C=(0,OI.A)((e=>{f.current=e,e&&(d&&T()?w():m.current&&PI(m.current,E))})),A=t.useCallback((()=>{o.remove(b(),E)}),[E,o]);t.useEffect((()=>()=>{A()}),[A]),t.useEffect((()=>{d?S():_&&s||A()}),[d,A,_,s,S]);const R=e=>t=>{var n;null==(n=e.onKeyDown)||n.call(e,t),"Escape"===t.key&&229!==t.which&&T()&&(r||(t.stopPropagation(),u&&u(t,"escapeKeyDown")))},I=e=>t=>{var n;null==(n=e.onClick)||n.call(e,t),t.target===t.currentTarget&&u&&u(t,"backdropClick")};return{getRootProps:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=XC(e);delete n.onTransitionEnter,delete n.onTransitionExited;const r=(0,ke.A)({},n,t);return(0,ke.A)({role:"presentation"},r,{onKeyDown:R(r),ref:g})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ke.A)({"aria-hidden":!0},e,{onClick:I(e),open:d})},getTransitionProps:()=>({onEnter:(0,kI.A)((()=>{y(!1),a&&a()}),null==l?void 0:l.props.onEnter),onExited:(0,kI.A)((()=>{y(!0),c&&c(),s&&A()}),null==l?void 0:l.props.onExited)}),rootRef:g,portalRef:C,isTopModal:T,exited:v,hasTransition:_}};function FI(e){return(0,AC.Ay)("MuiModal",e)}(0,Ke.A)("MuiModal",["root","hidden","backdrop"]);const BI=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],WI=(0,wC.Ay)("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.open&&n.exited&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),zI=(0,wC.Ay)(xI,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),HI=t.forwardRef((function(e,n){var r,i,o,s,a,c;const l=(0,Qe.b)({name:"MuiModal",props:e}),{BackdropComponent:u=zI,BackdropProps:d,className:h,closeAfterTransition:p=!1,children:f,container:m,component:g,components:v={},componentsProps:y={},disableAutoFocus:_=!1,disableEnforceFocus:E=!1,disableEscapeKeyDown:b=!1,disablePortal:w=!1,disableRestoreFocus:S=!1,disableScrollLock:T=!1,hideBackdrop:C=!1,keepMounted:A=!1,onBackdropClick:R,open:I,slotProps:x,slots:O}=l,k=(0,Ne.A)(l,BI),N=(0,ke.A)({},l,{closeAfterTransition:p,disableAutoFocus:_,disableEnforceFocus:E,disableEscapeKeyDown:b,disablePortal:w,disableRestoreFocus:S,disableScrollLock:T,hideBackdrop:C,keepMounted:A}),{getRootProps:P,getBackdropProps:D,getTransitionProps:L,portalRef:M,isTopModal:j,exited:U,hasTransition:V}=VI((0,ke.A)({},N,{rootRef:n})),F=(0,ke.A)({},N,{exited:U}),B=(e=>{const{open:t,exited:n,classes:r}=e,i={root:["root",!t&&n&&"hidden"],backdrop:["backdrop"]};return(0,bC.A)(i,FI,r)})(F),W={};if(void 0===f.props.tabIndex&&(W.tabIndex="-1"),V){const{onEnter:e,onExited:t}=L();W.onEnter=e,W.onExited=t}const z=null!=(r=null!=(i=null==O?void 0:O.root)?i:v.Root)?r:WI,H=null!=(o=null!=(s=null==O?void 0:O.backdrop)?s:v.Backdrop)?o:u,G=null!=(a=null==x?void 0:x.root)?a:y.root,q=null!=(c=null==x?void 0:x.backdrop)?c:y.backdrop,K=sR({elementType:z,externalSlotProps:G,externalForwardedProps:k,getSlotProps:P,additionalProps:{ref:n,as:g},ownerState:F,className:(0,Pe.A)(h,null==G?void 0:G.className,null==B?void 0:B.root,!F.open&&F.exited&&(null==B?void 0:B.hidden))}),$=sR({elementType:H,externalSlotProps:q,additionalProps:d,getSlotProps:e=>D((0,ke.A)({},e,{onClick:t=>{R&&R(t),null!=e&&e.onClick&&e.onClick(t)}})),className:(0,Pe.A)(null==q?void 0:q.className,null==d?void 0:d.className,null==B?void 0:B.backdrop),ownerState:F});return A||I||V&&!U?(0,We.jsx)(EI,{ref:M,container:m,disablePortal:w,children:(0,We.jsxs)(z,(0,ke.A)({},K,{children:[!C&&u?(0,We.jsx)(H,(0,ke.A)({},$)):null,(0,We.jsx)(vI,{disableEnforceFocus:E,disableAutoFocus:_,disableRestoreFocus:S,isEnabled:j,open:I,children:t.cloneElement(f,W)})]}))}):null})),GI=HI;function qI(e){return(0,AC.Ay)("MuiPopover",e)}(0,Ke.A)("MuiPopover",["root","paper"]);const KI=["onEntering"],$I=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"],YI=["slotProps"];function XI(e,t){let n=0;return"number"===typeof t?n=t:"center"===t?n=e.height/2:"bottom"===t&&(n=e.height),n}function JI(e,t){let n=0;return"number"===typeof t?n=t:"center"===t?n=e.width/2:"right"===t&&(n=e.width),n}function QI(e){return[e.horizontal,e.vertical].map((e=>"number"===typeof e?`${e}px`:e)).join(" ")}function ZI(e){return"function"===typeof e?e():e}const ex=(0,wC.Ay)(GI,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),tx=(0,wC.Ay)(kC,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),nx=t.forwardRef((function(e,n){var r,i,o;const s=(0,Qe.b)({props:e,name:"MuiPopover"}),{action:a,anchorEl:c,anchorOrigin:l={vertical:"top",horizontal:"left"},anchorPosition:u,anchorReference:d="anchorEl",children:h,className:p,container:f,elevation:m=8,marginThreshold:g=16,open:v,PaperProps:y={},slots:_,slotProps:E,transformOrigin:b={vertical:"top",horizontal:"left"},TransitionComponent:w=hI,transitionDuration:S="auto",TransitionProps:{onEntering:T}={},disableScrollLock:C=!1}=s,A=(0,Ne.A)(s.TransitionProps,KI),R=(0,Ne.A)(s,$I),I=null!=(r=null==E?void 0:E.paper)?r:y,x=t.useRef(),O=(0,gA.A)(x,I.ref),k=(0,ke.A)({},s,{anchorOrigin:l,anchorReference:d,elevation:m,marginThreshold:g,externalPaperSlotProps:I,transformOrigin:b,TransitionComponent:w,transitionDuration:S,TransitionProps:A}),N=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],paper:["paper"]},qI,t)})(k),P=t.useCallback((()=>{if("anchorPosition"===d)return u;const e=ZI(c),t=(e&&1===e.nodeType?e:(0,IR.A)(x.current).body).getBoundingClientRect();return{top:t.top+XI(t,l.vertical),left:t.left+JI(t,l.horizontal)}}),[c,l.horizontal,l.vertical,u,d]),D=t.useCallback((e=>({vertical:XI(e,b.vertical),horizontal:JI(e,b.horizontal)})),[b.horizontal,b.vertical]),L=t.useCallback((e=>{const t={width:e.offsetWidth,height:e.offsetHeight},n=D(t);if("none"===d)return{top:null,left:null,transformOrigin:QI(n)};const r=P();let i=r.top-n.vertical,o=r.left-n.horizontal;const s=i+t.height,a=o+t.width,l=(0,qR.A)(ZI(c)),u=l.innerHeight-g,h=l.innerWidth-g;if(null!==g&&i<g){const e=i-g;i-=e,n.vertical+=e}else if(null!==g&&s>u){const e=s-u;i-=e,n.vertical+=e}if(null!==g&&o<g){const e=o-g;o-=e,n.horizontal+=e}else if(a>h){const e=a-h;o-=e,n.horizontal+=e}return{top:`${Math.round(i)}px`,left:`${Math.round(o)}px`,transformOrigin:QI(n)}}),[c,d,P,D,g]),[M,j]=t.useState(v),U=t.useCallback((()=>{const e=x.current;if(!e)return;const t=L(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin,j(!0)}),[L]);t.useEffect((()=>(C&&window.addEventListener("scroll",U),()=>window.removeEventListener("scroll",U))),[c,C,U]);t.useEffect((()=>{v&&U()})),t.useImperativeHandle(a,(()=>v?{updatePosition:()=>{U()}}:null),[v,U]),t.useEffect((()=>{if(!v)return;const e=(0,GR.A)((()=>{U()})),t=(0,qR.A)(c);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[c,v,U]);let V=S;"auto"!==S||w.muiSupportAuto||(V=void 0);const F=f||(c?(0,IR.A)(ZI(c)).body:void 0),B=null!=(i=null==_?void 0:_.root)?i:ex,W=null!=(o=null==_?void 0:_.paper)?o:tx,z=sR({elementType:W,externalSlotProps:(0,ke.A)({},I,{style:M?I.style:(0,ke.A)({},I.style,{opacity:0})}),additionalProps:{elevation:m,ref:O},ownerState:k,className:(0,Pe.A)(N.paper,null==I?void 0:I.className)}),H=sR({elementType:B,externalSlotProps:(null==E?void 0:E.root)||{},externalForwardedProps:R,additionalProps:{ref:n,slotProps:{backdrop:{invisible:!0}},container:F,open:v},ownerState:k,className:(0,Pe.A)(N.root,p)}),{slotProps:G}=H,q=(0,Ne.A)(H,YI);return(0,We.jsx)(B,(0,ke.A)({},q,!KC(B)&&{slotProps:G,disableScrollLock:C},{children:(0,We.jsx)(w,(0,ke.A)({appear:!0,in:v,onEntering:(e,t)=>{T&&T(e,t),U()},onExited:()=>{j(!1)},timeout:V},A,{children:(0,We.jsx)(W,(0,ke.A)({},z,{children:h}))}))}))})),rx=nx;function ix(e){return(0,AC.Ay)("MuiMenu",e)}(0,Ke.A)("MuiMenu",["root","paper","list"]);const ox=["onEntering"],sx=["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"],ax={vertical:"top",horizontal:"right"},cx={vertical:"top",horizontal:"left"},lx=(0,wC.Ay)(rx,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),ux=(0,wC.Ay)(tx,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),dx=(0,wC.Ay)(HR,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),hx=t.forwardRef((function(e,n){var r,i;const o=(0,Qe.b)({props:e,name:"MuiMenu"}),{autoFocus:s=!0,children:a,className:c,disableAutoFocusItem:l=!1,MenuListProps:u={},onClose:d,open:h,PaperProps:p={},PopoverClasses:f,transitionDuration:m="auto",TransitionProps:{onEntering:g}={},variant:v="selectedMenu",slots:y={},slotProps:_={}}=o,E=(0,Ne.A)(o.TransitionProps,ox),b=(0,Ne.A)(o,sx),w=dC(),S=(0,ke.A)({},o,{autoFocus:s,disableAutoFocusItem:l,MenuListProps:u,onEntering:g,PaperProps:p,transitionDuration:m,TransitionProps:E,variant:v}),T=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],paper:["paper"],list:["list"]},ix,t)})(S),C=s&&!l&&h,A=t.useRef(null);let R=-1;t.Children.map(a,((e,n)=>{t.isValidElement(e)&&(e.props.disabled||("selectedMenu"===v&&e.props.selected||-1===R)&&(R=n))}));const I=null!=(r=y.paper)?r:ux,x=null!=(i=_.paper)?i:p,O=sR({elementType:y.root,externalSlotProps:_.root,ownerState:S,className:[T.root,c]}),k=sR({elementType:I,externalSlotProps:x,ownerState:S,className:T.paper});return(0,We.jsx)(lx,(0,ke.A)({onClose:d,anchorOrigin:{vertical:"bottom",horizontal:w?"right":"left"},transformOrigin:w?ax:cx,slots:{paper:I,root:y.root},slotProps:{root:O,paper:k},open:h,ref:n,transitionDuration:m,TransitionProps:(0,ke.A)({onEntering:(e,t)=>{A.current&&A.current.adjustStyleForScrollbar(e,{direction:w?"rtl":"ltr"}),g&&g(e,t)}},E),ownerState:S},b,{classes:f,children:(0,We.jsx)(dx,(0,ke.A)({onKeyDown:e=>{"Tab"===e.key&&(e.preventDefault(),d&&d(e,"tabKeyDown"))},actions:A,autoFocus:s&&(-1===R||l),autoFocusItem:C,variant:v},u,{className:(0,Pe.A)(T.list,u.className),children:a}))}))})),px=hx;function fx(e){return(0,AC.Ay)("MuiDivider",e)}const mx=(0,Ke.A)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);function gx(e){return(0,AC.Ay)("MuiListItemIcon",e)}const vx=(0,Ke.A)("MuiListItemIcon",["root","alignItemsFlexStart"]);function yx(e){return(0,AC.Ay)("MuiListItemText",e)}const _x=(0,Ke.A)("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function Ex(e){return(0,AC.Ay)("MuiMenuItem",e)}const bx=(0,Ke.A)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),wx=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Sx=(0,wC.Ay)(JA,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.divider&&t.divider,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${bx.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${bx.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${bx.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${bx.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${bx.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${mx.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${mx.inset}`]:{marginLeft:52},[`& .${_x.root}`]:{marginTop:0,marginBottom:0},[`& .${_x.inset}`]:{paddingLeft:36},[`& .${vx.root}`]:{minWidth:36}},!n.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&(0,ke.A)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${vx.root} svg`]:{fontSize:"1.25rem"}}))})),Tx=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiMenuItem"}),{autoFocus:i=!1,component:o="li",dense:s=!1,divider:a=!1,disableGutters:c=!1,focusVisibleClassName:l,role:u="menuitem",tabIndex:d,className:h}=r,p=(0,Ne.A)(r,wx),f=t.useContext(xR),m=t.useMemo((()=>({dense:s||f.dense||!1,disableGutters:c})),[f.dense,s,c]),g=t.useRef(null);(0,jR.A)((()=>{i&&g.current&&g.current.focus()}),[i]);const v=(0,ke.A)({},r,{dense:m.dense,divider:a,disableGutters:c}),y=(e=>{const{disabled:t,dense:n,divider:r,disableGutters:i,selected:o,classes:s}=e,a={root:["root",n&&"dense",t&&"disabled",!i&&"gutters",r&&"divider",o&&"selected"]},c=(0,bC.A)(a,Ex,s);return(0,ke.A)({},s,c)})(r),_=(0,gA.A)(g,n);let E;return r.disabled||(E=void 0!==d?d:-1),(0,We.jsx)(xR.Provider,{value:m,children:(0,We.jsx)(Sx,(0,ke.A)({ref:_,role:u,tabIndex:E,component:o,focusVisibleClassName:(0,Pe.A)(y.focusVisible,l),className:(0,Pe.A)(y.root,h)},p,{ownerState:v,classes:y}))})})),Cx=Tx,Ax=["className"],Rx=(0,wC.Ay)("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"flex-start"===n.alignItems&&t.alignItemsFlexStart]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex"},"flex-start"===n.alignItems&&{marginTop:8})})),Ix=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiListItemIcon"}),{className:i}=r,o=(0,Ne.A)(r,Ax),s=t.useContext(xR),a=(0,ke.A)({},r,{alignItems:s.alignItems}),c=(e=>{const{alignItems:t,classes:n}=e,r={root:["root","flex-start"===t&&"alignItemsFlexStart"]};return(0,bC.A)(r,gx,n)})(a);return(0,We.jsx)(Rx,(0,ke.A)({className:(0,Pe.A)(c.root,i),ownerState:a,ref:n},o))})),xx=Ix,Ox=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],kx=(0,wC.Ay)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${_x.primary}`]:t.primary},{[`& .${_x.secondary}`]:t.secondary},t.root,n.inset&&t.inset,n.primary&&n.secondary&&t.multiline,n.dense&&t.dense]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},t.primary&&t.secondary&&{marginTop:6,marginBottom:6},t.inset&&{paddingLeft:56})})),Nx=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiListItemText"}),{children:i,className:o,disableTypography:s=!1,inset:a=!1,primary:c,primaryTypographyProps:l,secondary:u,secondaryTypographyProps:d}=r,h=(0,Ne.A)(r,Ox),{dense:p}=t.useContext(xR);let f=null!=c?c:i,m=u;const g=(0,ke.A)({},r,{disableTypography:s,inset:a,primary:!!f,secondary:!!m,dense:p}),v=(e=>{const{classes:t,inset:n,primary:r,secondary:i,dense:o}=e,s={root:["root",n&&"inset",o&&"dense",r&&i&&"multiline"],primary:["primary"],secondary:["secondary"]};return(0,bC.A)(s,yx,t)})(g);return null==f||f.type===mA||s||(f=(0,We.jsx)(mA,(0,ke.A)({variant:p?"body2":"body1",className:v.primary,component:null!=l&&l.variant?void 0:"span",display:"block"},l,{children:f}))),null==m||m.type===mA||s||(m=(0,We.jsx)(mA,(0,ke.A)({variant:"body2",className:v.secondary,color:"text.secondary",display:"block"},d,{children:m}))),(0,We.jsxs)(kx,(0,ke.A)({className:(0,Pe.A)(v.root,o),ownerState:g,ref:n},h,{children:[f,m]}))})),Px=Nx,Dx=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],Lx=(0,wC.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.absolute&&t.absolute,t[n.variant],n.light&&t.light,"vertical"===n.orientation&&t.vertical,n.flexItem&&t.flexItem,n.children&&t.withChildren,n.children&&"vertical"===n.orientation&&t.withChildrenVertical,"right"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignRight,"left"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignLeft]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin"},n.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},n.light&&{borderColor:t.vars?`rgba(${t.vars.palette.dividerChannel} / 0.08)`:(0,TC.X4)(t.palette.divider,.08)},"inset"===n.variant&&{marginLeft:72},"middle"===n.variant&&"horizontal"===n.orientation&&{marginLeft:t.spacing(2),marginRight:t.spacing(2)},"middle"===n.variant&&"vertical"===n.orientation&&{marginTop:t.spacing(1),marginBottom:t.spacing(1)},"vertical"===n.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},n.flexItem&&{alignSelf:"stretch",height:"auto"})}),(e=>{let{ownerState:t}=e;return(0,ke.A)({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},n.children&&"vertical"!==n.orientation&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`,borderTopStyle:"inherit"}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},n.children&&"vertical"===n.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`,borderLeftStyle:"inherit"}})}),(e=>{let{ownerState:t}=e;return(0,ke.A)({},"right"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})})),Mx=(0,wC.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.wrapper,"vertical"===n.orientation&&t.wrapperVertical]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`},"vertical"===n.orientation&&{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`})})),jx=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiDivider"}),{absolute:r=!1,children:i,className:o,component:s=(i?"div":"hr"),flexItem:a=!1,light:c=!1,orientation:l="horizontal",role:u=("hr"!==s?"separator":void 0),textAlign:d="center",variant:h="fullWidth"}=n,p=(0,Ne.A)(n,Dx),f=(0,ke.A)({},n,{absolute:r,component:s,flexItem:a,light:c,orientation:l,role:u,textAlign:d,variant:h}),m=(e=>{const{absolute:t,children:n,classes:r,flexItem:i,light:o,orientation:s,textAlign:a,variant:c}=e,l={root:["root",t&&"absolute",c,o&&"light","vertical"===s&&"vertical",i&&"flexItem",n&&"withChildren",n&&"vertical"===s&&"withChildrenVertical","right"===a&&"vertical"!==s&&"textAlignRight","left"===a&&"vertical"!==s&&"textAlignLeft"],wrapper:["wrapper","vertical"===s&&"wrapperVertical"]};return(0,bC.A)(l,fx,r)})(f);return(0,We.jsx)(Lx,(0,ke.A)({as:s,className:(0,Pe.A)(m.root,o),role:u,ref:t,ownerState:f},p,{children:i?(0,We.jsx)(Mx,{className:m.wrapper,ownerState:f,children:i}):null}))}));jx.muiSkipListHighlight=!0;const Ux=jx,Vx=(0,zC.A)((0,We.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications"),Fx=(0,zC.A)((0,We.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),Bx=(0,zC.A)([(0,We.jsx)("path",{d:"M13 8.57c-.79 0-1.43.64-1.43 1.43s.64 1.43 1.43 1.43 1.43-.64 1.43-1.43-.64-1.43-1.43-1.43"},"0"),(0,We.jsx)("path",{d:"M13 3C9.25 3 6.2 5.94 6.02 9.64L4.1 12.2c-.25.33-.01.8.4.8H6v3c0 1.1.9 2 2 2h1v3h7v-4.68c2.36-1.12 4-3.53 4-6.32 0-3.87-3.13-7-7-7m3 7c0 .13-.01.26-.02.39l.83.66c.08.06.1.16.05.25l-.8 1.39c-.05.09-.16.12-.24.09l-.99-.4c-.21.16-.43.29-.67.39L14 13.83c-.01.1-.1.17-.2.17h-1.6c-.1 0-.18-.07-.2-.17l-.15-1.06c-.25-.1-.47-.23-.68-.39l-.99.4c-.09.03-.2 0-.25-.09l-.8-1.39c-.05-.08-.03-.19.05-.25l.84-.66c-.01-.13-.02-.26-.02-.39s.02-.27.04-.39l-.85-.66c-.08-.06-.1-.16-.05-.26l.8-1.38c.05-.09.15-.12.24-.09l1 .4c.2-.15.43-.29.67-.39L12 6.17c.02-.1.1-.17.2-.17h1.6c.1 0 .18.07.2.17l.15 1.06c.24.1.46.23.67.39l1-.4c.09-.03.2 0 .24.09l.8 1.38c.05.09.03.2-.05.26l-.85.66c.03.12.04.25.04.39"},"1")],"Psychology"),Wx=(0,zC.A)((0,We.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),zx=(0,zC.A)((0,We.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),Hx=()=>{const e=Q(),[n,r]=(0,t.useState)(null),{currentUser:i,logout:o}=ZT(),{unreadCount:s}=iC(),a=()=>{r(null)},c=t=>{a(),setTimeout((()=>{e(t,{replace:!0})}),50)};return(0,We.jsx)(We.Fragment,{children:(0,We.jsx)(jC,{position:"static",elevation:0,sx:{backgroundColor:"transparent",backgroundImage:"none",boxShadow:"none",borderBottom:"none",padding:"0 24px"},children:(0,We.jsxs)(WC,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 0",minHeight:"auto"},disableGutters:!0,children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:3},children:[(0,We.jsx)(cA,{src:"/logo.png",alt:"Side Eye",sx:{width:40,height:40,cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>e("/")}),(0,We.jsx)(mA,{variant:"h5",component:"div",sx:{fontWeight:"bold",cursor:"pointer",color:"primary.main","&:hover":{opacity:.8}},onClick:()=>e("/"),children:"SideEye"})]}),(0,We.jsx)(Je,{sx:{display:"flex",alignItems:"center",gap:2},children:i?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(rR,{color:s>0?"error":"inherit",onClick:()=>e("/notifications"),sx:{color:"text.primary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:(0,We.jsx)(fR,{badgeContent:s,color:"error",children:(0,We.jsx)(Vx,{})})}),(0,We.jsx)(rR,{color:"inherit",onClick:e=>{r(e.currentTarget)},sx:{color:"text.primary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:(0,We.jsx)(Fx,{})})]}):(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(RR,{color:"inherit",onClick:()=>e("/login"),sx:{color:"text.primary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:"Login"}),(0,We.jsx)(RR,{color:"inherit",onClick:()=>e("/register"),sx:{color:"text.primary","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:"Register"})]})}),(0,We.jsxs)(px,{anchorEl:n,open:Boolean(n),onClose:a,sx:{"& .MuiPaper-root":{borderRadius:2,boxShadow:"0 4px 20px rgba(0,0,0,0.1)",minWidth:200,border:"none"}},children:[(0,We.jsxs)(Cx,{onClick:()=>c("/sade-ai"),children:[(0,We.jsx)(xx,{children:(0,We.jsx)(Bx,{})}),(0,We.jsx)(Px,{primary:"Sade AI"})]}),(0,We.jsx)(Ux,{}),(0,We.jsxs)(Cx,{onClick:()=>c("/settings"),children:[(0,We.jsx)(xx,{children:(0,We.jsx)(Wx,{})}),(0,We.jsx)(Px,{primary:"Settings"})]}),(0,We.jsx)(Ux,{}),(0,We.jsxs)(Cx,{onClick:async()=>{await o(),a()},children:[(0,We.jsx)(xx,{children:(0,We.jsx)(zx,{})}),(0,We.jsx)(Px,{children:"Logout"})]})]})]})})})};var Gx=n(3828);function qx(e){return(0,AC.Ay)("MuiListItem",e)}const Kx=(0,Ke.A)("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]);function $x(e){return(0,AC.Ay)("MuiListItemButton",e)}const Yx=(0,Ke.A)("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);function Xx(e){return(0,AC.Ay)("MuiListItemSecondaryAction",e)}(0,Ke.A)("MuiListItemSecondaryAction",["root","disableGutters"]);const Jx=["className"],Qx=(0,wC.Ay)("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.disableGutters&&t.disableGutters]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})})),Zx=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiListItemSecondaryAction"}),{className:i}=r,o=(0,Ne.A)(r,Jx),s=t.useContext(xR),a=(0,ke.A)({},r,{disableGutters:s.disableGutters}),c=(e=>{const{disableGutters:t,classes:n}=e,r={root:["root",t&&"disableGutters"]};return(0,bC.A)(r,Xx,n)})(a);return(0,We.jsx)(Qx,(0,ke.A)({className:(0,Pe.A)(c.root,i),ownerState:a,ref:n},o))}));Zx.muiName="ListItemSecondaryAction";const eO=Zx,tO=["className"],nO=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],rO=(0,wC.Ay)("div",{name:"MuiListItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,"flex-start"===n.alignItems&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters,!n.disablePadding&&t.padding,n.button&&t.button,n.hasSecondaryAction&&t.secondaryAction]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!n.disablePadding&&(0,ke.A)({paddingTop:8,paddingBottom:8},n.dense&&{paddingTop:4,paddingBottom:4},!n.disableGutters&&{paddingLeft:16,paddingRight:16},!!n.secondaryAction&&{paddingRight:48}),!!n.secondaryAction&&{[`& > .${Yx.root}`]:{paddingRight:48}},{[`&.${Kx.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Kx.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${Kx.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${Kx.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"flex-start"===n.alignItems&&{alignItems:"flex-start"},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},n.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Kx.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}}},n.hasSecondaryAction&&{paddingRight:48})})),iO=(0,wC.Ay)("li",{name:"MuiListItem",slot:"Container",overridesResolver:(e,t)=>t.container})({position:"relative"}),oO=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiListItem"}),{alignItems:i="center",autoFocus:o=!1,button:s=!1,children:a,className:c,component:l,components:u={},componentsProps:d={},ContainerComponent:h="li",ContainerProps:{className:p}={},dense:f=!1,disabled:m=!1,disableGutters:g=!1,disablePadding:v=!1,divider:y=!1,focusVisibleClassName:_,secondaryAction:E,selected:b=!1,slotProps:w={},slots:S={}}=r,T=(0,Ne.A)(r.ContainerProps,tO),C=(0,Ne.A)(r,nO),A=t.useContext(xR),R=t.useMemo((()=>({dense:f||A.dense||!1,alignItems:i,disableGutters:g})),[i,A.dense,f,g]),I=t.useRef(null);(0,jR.A)((()=>{o&&I.current&&I.current.focus()}),[o]);const x=t.Children.toArray(a),O=x.length&&(0,Gx.A)(x[x.length-1],["ListItemSecondaryAction"]),k=(0,ke.A)({},r,{alignItems:i,autoFocus:o,button:s,dense:R.dense,disabled:m,disableGutters:g,disablePadding:v,divider:y,hasSecondaryAction:O,selected:b}),N=(e=>{const{alignItems:t,button:n,classes:r,dense:i,disabled:o,disableGutters:s,disablePadding:a,divider:c,hasSecondaryAction:l,selected:u}=e,d={root:["root",i&&"dense",!s&&"gutters",!a&&"padding",c&&"divider",o&&"disabled",n&&"button","flex-start"===t&&"alignItemsFlexStart",l&&"secondaryAction",u&&"selected"],container:["container"]};return(0,bC.A)(d,qx,r)})(k),P=(0,gA.A)(I,n),D=S.root||u.Root||rO,L=w.root||d.root||{},M=(0,ke.A)({className:(0,Pe.A)(N.root,L.className,c),disabled:m},C);let j=l||"li";return s&&(M.component=l||"div",M.focusVisibleClassName=(0,Pe.A)(Kx.focusVisible,_),j=JA),O?(j=M.component||l?j:"div","li"===h&&("li"===j?j="div":"li"===M.component&&(M.component="div")),(0,We.jsx)(xR.Provider,{value:R,children:(0,We.jsxs)(iO,(0,ke.A)({as:h,className:(0,Pe.A)(N.container,p),ref:P,ownerState:k},T,{children:[(0,We.jsx)(D,(0,ke.A)({},L,!KC(D)&&{as:j,ownerState:(0,ke.A)({},k,L.ownerState)},M,{children:x})),x.pop()]}))})):(0,We.jsx)(xR.Provider,{value:R,children:(0,We.jsxs)(D,(0,ke.A)({},L,{as:j,ref:P},!KC(D)&&{ownerState:(0,ke.A)({},k,L.ownerState)},M,{children:[x,E&&(0,We.jsx)(eO,{children:E})]}))})})),sO=oO;function aO(e){return(0,AC.Ay)("MuiListItemAvatar",e)}(0,Ke.A)("MuiListItemAvatar",["root","alignItemsFlexStart"]);const cO=["className"],lO=(0,wC.Ay)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"flex-start"===n.alignItems&&t.alignItemsFlexStart]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({minWidth:56,flexShrink:0},"flex-start"===t.alignItems&&{marginTop:8})})),uO=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiListItemAvatar"}),{className:i}=r,o=(0,Ne.A)(r,cO),s=t.useContext(xR),a=(0,ke.A)({},r,{alignItems:s.alignItems}),c=(e=>{const{alignItems:t,classes:n}=e,r={root:["root","flex-start"===t&&"alignItemsFlexStart"]};return(0,bC.A)(r,aO,n)})(a);return(0,We.jsx)(lO,(0,ke.A)({className:(0,Pe.A)(c.root,i),ownerState:a,ref:n},o))})),dO=uO;var hO=n(3539);function pO(e){return(0,AC.Ay)("MuiDialog",e)}const fO=(0,Ke.A)("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]);const mO=t.createContext({}),gO=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],vO=(0,wC.Ay)(xI,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),yO=(0,wC.Ay)(GI,{name:"MuiDialog",slot:"Root",overridesResolver:(e,t)=>t.root})({"@media print":{position:"absolute !important"}}),_O=(0,wC.Ay)("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.container,t[`scroll${(0,SC.A)(n.scroll)}`]]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({height:"100%","@media print":{height:"auto"},outline:0},"paper"===t.scroll&&{display:"flex",justifyContent:"center",alignItems:"center"},"body"===t.scroll&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})})),EO=(0,wC.Ay)(kC,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.paper,t[`scrollPaper${(0,SC.A)(n.scroll)}`],t[`paperWidth${(0,SC.A)(String(n.maxWidth))}`],n.fullWidth&&t.paperFullWidth,n.fullScreen&&t.paperFullScreen]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},"paper"===n.scroll&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},"body"===n.scroll&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!n.maxWidth&&{maxWidth:"calc(100% - 64px)"},"xs"===n.maxWidth&&{maxWidth:"px"===t.breakpoints.unit?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${fO.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}},n.maxWidth&&"xs"!==n.maxWidth&&{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`,[`&.${fO.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[n.maxWidth]+64)]:{maxWidth:"calc(100% - 64px)"}}},n.fullWidth&&{width:"calc(100% - 64px)"},n.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${fO.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})})),bO=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiDialog"}),i=iI(),o={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{"aria-describedby":s,"aria-labelledby":a,BackdropComponent:c,BackdropProps:l,children:u,className:d,disableEscapeKeyDown:h=!1,fullScreen:p=!1,fullWidth:f=!1,maxWidth:m="sm",onBackdropClick:g,onClick:v,onClose:y,open:_,PaperComponent:E=kC,PaperProps:b={},scroll:w="paper",TransitionComponent:S=TI,transitionDuration:T=o,TransitionProps:C}=r,A=(0,Ne.A)(r,gO),R=(0,ke.A)({},r,{disableEscapeKeyDown:h,fullScreen:p,fullWidth:f,maxWidth:m,scroll:w}),I=(e=>{const{classes:t,scroll:n,maxWidth:r,fullWidth:i,fullScreen:o}=e,s={root:["root"],container:["container",`scroll${(0,SC.A)(n)}`],paper:["paper",`paperScroll${(0,SC.A)(n)}`,`paperWidth${(0,SC.A)(String(r))}`,i&&"paperFullWidth",o&&"paperFullScreen"]};return(0,bC.A)(s,pO,t)})(R),x=t.useRef(),O=(0,hO.A)(a),k=t.useMemo((()=>({titleId:O})),[O]);return(0,We.jsx)(yO,(0,ke.A)({className:(0,Pe.A)(I.root,d),closeAfterTransition:!0,components:{Backdrop:vO},componentsProps:{backdrop:(0,ke.A)({transitionDuration:T,as:c},l)},disableEscapeKeyDown:h,onClose:y,open:_,ref:n,onClick:e=>{v&&v(e),x.current&&(x.current=null,g&&g(e),y&&y(e,"backdropClick"))},ownerState:R},A,{children:(0,We.jsx)(S,(0,ke.A)({appear:!0,in:_,timeout:T,role:"presentation"},C,{children:(0,We.jsx)(_O,{className:(0,Pe.A)(I.container),onMouseDown:e=>{x.current=e.target===e.currentTarget},ownerState:R,children:(0,We.jsx)(EO,(0,ke.A)({as:E,elevation:24,role:"dialog","aria-describedby":s,"aria-labelledby":O},b,{className:(0,Pe.A)(I.paper,b.className),ownerState:R,children:(0,We.jsx)(mO.Provider,{value:k,children:u})}))})}))}))})),wO=bO;var SO=n(7483),TO=n(8099),CO=n(1927);const AO=["onChange","maxRows","minRows","style","value"];function RO(e){return parseInt(e,10)||0}const IO={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"};function xO(e){return function(e){for(const t in e)return!1;return!0}(e)||0===e.outerHeightStyle&&!e.overflowing}const OO=t.forwardRef((function(e,n){const{onChange:r,maxRows:i,minRows:o=1,style:s,value:a}=e,c=(0,Ne.A)(e,AO),{current:l}=t.useRef(null!=a),u=t.useRef(null),d=(0,qC.A)(n,u),h=t.useRef(null),p=t.useRef(null),f=t.useCallback((()=>{const t=u.current,n=p.current;if(!t||!n)return;const r=(0,NI.A)(t).getComputedStyle(t);if("0px"===r.width)return{outerHeightStyle:0,overflowing:!1};n.style.width=r.width,n.value=t.value||e.placeholder||"x","\n"===n.value.slice(-1)&&(n.value+=" ");const s=r.boxSizing,a=RO(r.paddingBottom)+RO(r.paddingTop),c=RO(r.borderBottomWidth)+RO(r.borderTopWidth),l=n.scrollHeight;n.value="x";const d=n.scrollHeight;let h=l;o&&(h=Math.max(Number(o)*d,h)),i&&(h=Math.min(Number(i)*d,h)),h=Math.max(h,d);return{outerHeightStyle:h+("border-box"===s?a+c:0),overflowing:Math.abs(h-l)<=1}}),[i,o,e.placeholder]),m=(0,OI.A)((()=>{const e=u.current,t=f();if(!e||!t||xO(t))return!1;const n=t.outerHeightStyle;return null!=h.current&&h.current!==n})),g=t.useCallback((()=>{const e=u.current,t=f();if(!e||!t||xO(t))return;const n=t.outerHeightStyle;h.current!==n&&(h.current=n,e.style.height=`${n}px`),e.style.overflow=t.overflowing?"hidden":""}),[f]),v=t.useRef(-1);(0,yI.A)((()=>{const e=(0,CO.A)(g),t=null==u?void 0:u.current;if(!t)return;const n=(0,NI.A)(t);let r;return n.addEventListener("resize",e),"undefined"!==typeof ResizeObserver&&(r=new ResizeObserver((()=>{m()&&(r.unobserve(t),cancelAnimationFrame(v.current),g(),v.current=requestAnimationFrame((()=>{r.observe(t)})))})),r.observe(t)),()=>{e.clear(),cancelAnimationFrame(v.current),n.removeEventListener("resize",e),r&&r.disconnect()}}),[f,g,m]),(0,yI.A)((()=>{g()}));return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)("textarea",(0,ke.A)({value:a,onChange:e=>{l||g(),r&&r(e)},ref:d,rows:o,style:s},c)),(0,We.jsx)("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:p,tabIndex:-1,style:(0,ke.A)({},IO,s,{paddingTop:0,paddingBottom:0})})]})})),kO=OO;function NO(e){let{props:t,states:n,muiFormControl:r}=e;return n.reduce(((e,n)=>(e[n]=t[n],r&&"undefined"===typeof t[n]&&(e[n]=r[n]),e)),{})}const PO=t.createContext(void 0);function DO(){return t.useContext(PO)}function LO(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function MO(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(LO(e.value)&&""!==e.value||t&&LO(e.defaultValue)&&""!==e.defaultValue)}function jO(e){return(0,AC.Ay)("MuiInputBase",e)}const UO=(0,Ke.A)("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),VO=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],FO=(e,t)=>{const{ownerState:n}=e;return[t.root,n.formControl&&t.formControl,n.startAdornment&&t.adornedStart,n.endAdornment&&t.adornedEnd,n.error&&t.error,"small"===n.size&&t.sizeSmall,n.multiline&&t.multiline,n.color&&t[`color${(0,SC.A)(n.color)}`],n.fullWidth&&t.fullWidth,n.hiddenLabel&&t.hiddenLabel]},BO=(e,t)=>{const{ownerState:n}=e;return[t.input,"small"===n.size&&t.inputSizeSmall,n.multiline&&t.inputMultiline,"search"===n.type&&t.inputTypeSearch,n.startAdornment&&t.inputAdornedStart,n.endAdornment&&t.inputAdornedEnd,n.hiddenLabel&&t.inputHiddenLabel]},WO=(0,wC.Ay)("div",{name:"MuiInputBase",slot:"Root",overridesResolver:FO})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},t.typography.body1,{color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${UO.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"}},n.multiline&&(0,ke.A)({padding:"4px 0 5px"},"small"===n.size&&{paddingTop:1}),n.fullWidth&&{width:"100%"})})),zO=(0,wC.Ay)("input",{name:"MuiInputBase",slot:"Input",overridesResolver:BO})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode,i=(0,ke.A)({color:"currentColor"},t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5},{transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})}),o={opacity:"0 !important"},s=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5};return(0,ke.A)({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&:-ms-input-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${UO.formControl} &`]:{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&:-ms-input-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s},[`&.${UO.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},"small"===n.size&&{paddingTop:1},n.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},"search"===n.type&&{MozAppearance:"textfield"})})),HO=(0,We.jsx)(nt,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),GO=t.forwardRef((function(e,n){var r;const i=(0,Qe.b)({props:e,name:"MuiInputBase"}),{"aria-describedby":o,autoComplete:s,autoFocus:a,className:c,components:l={},componentsProps:u={},defaultValue:d,disabled:h,disableInjectingGlobalStyles:p,endAdornment:f,fullWidth:m=!1,id:g,inputComponent:v="input",inputProps:y={},inputRef:_,maxRows:E,minRows:b,multiline:w=!1,name:S,onBlur:T,onChange:C,onClick:A,onFocus:R,onKeyDown:I,onKeyUp:x,placeholder:O,readOnly:k,renderSuffix:N,rows:P,slotProps:D={},slots:L={},startAdornment:M,type:j="text",value:U}=i,V=(0,Ne.A)(i,VO),F=null!=y.value?y.value:U,{current:B}=t.useRef(null!=F),W=t.useRef(),z=t.useCallback((e=>{0}),[]),H=(0,gA.A)(W,_,y.ref,z),[G,q]=t.useState(!1),K=DO();const $=NO({props:i,muiFormControl:K,states:["color","disabled","error","hiddenLabel","size","required","filled"]});$.focused=K?K.focused:G,t.useEffect((()=>{!K&&h&&G&&(q(!1),T&&T())}),[K,h,G,T]);const Y=K&&K.onFilled,X=K&&K.onEmpty,J=t.useCallback((e=>{MO(e)?Y&&Y():X&&X()}),[Y,X]);(0,jR.A)((()=>{B&&J({value:F})}),[F,J,B]);t.useEffect((()=>{J(W.current)}),[]);let Q=v,Z=y;w&&"input"===Q&&(Z=P?(0,ke.A)({type:void 0,minRows:P,maxRows:P},Z):(0,ke.A)({type:void 0,maxRows:E,minRows:b},Z),Q=kO);t.useEffect((()=>{K&&K.setAdornedStart(Boolean(M))}),[K,M]);const ee=(0,ke.A)({},i,{color:$.color||"primary",disabled:$.disabled,endAdornment:f,error:$.error,focused:$.focused,formControl:K,fullWidth:m,hiddenLabel:$.hiddenLabel,multiline:w,size:$.size,startAdornment:M,type:j}),te=(e=>{const{classes:t,color:n,disabled:r,error:i,endAdornment:o,focused:s,formControl:a,fullWidth:c,hiddenLabel:l,multiline:u,readOnly:d,size:h,startAdornment:p,type:f}=e,m={root:["root",`color${(0,SC.A)(n)}`,r&&"disabled",i&&"error",c&&"fullWidth",s&&"focused",a&&"formControl",h&&"medium"!==h&&`size${(0,SC.A)(h)}`,u&&"multiline",p&&"adornedStart",o&&"adornedEnd",l&&"hiddenLabel",d&&"readOnly"],input:["input",r&&"disabled","search"===f&&"inputTypeSearch",u&&"inputMultiline","small"===h&&"inputSizeSmall",l&&"inputHiddenLabel",p&&"inputAdornedStart",o&&"inputAdornedEnd",d&&"readOnly"]};return(0,bC.A)(m,jO,t)})(ee),ne=L.root||l.Root||WO,re=D.root||u.root||{},ie=L.input||l.Input||zO;return Z=(0,ke.A)({},Z,null!=(r=D.input)?r:u.input),(0,We.jsxs)(t.Fragment,{children:[!p&&HO,(0,We.jsxs)(ne,(0,ke.A)({},re,!KC(ne)&&{ownerState:(0,ke.A)({},ee,re.ownerState)},{ref:n,onClick:e=>{W.current&&e.currentTarget===e.target&&W.current.focus(),A&&A(e)}},V,{className:(0,Pe.A)(te.root,re.className,c,k&&"MuiInputBase-readOnly"),children:[M,(0,We.jsx)(PO.Provider,{value:null,children:(0,We.jsx)(ie,(0,ke.A)({ownerState:ee,"aria-invalid":$.error,"aria-describedby":o,autoComplete:s,autoFocus:a,defaultValue:d,disabled:$.disabled,id:g,onAnimationStart:e=>{J("mui-auto-fill-cancel"===e.animationName?W.current:{value:"x"})},name:S,placeholder:O,readOnly:k,required:$.required,rows:P,value:F,onKeyDown:I,onKeyUp:x,type:j},Z,!KC(ie)&&{as:Q,ownerState:(0,ke.A)({},ee,Z.ownerState)},{ref:H,className:(0,Pe.A)(te.input,Z.className,k&&"MuiInputBase-readOnly"),onBlur:e=>{T&&T(e),y.onBlur&&y.onBlur(e),K&&K.onBlur?K.onBlur(e):q(!1)},onChange:function(e){if(!B){const t=e.target||W.current;if(null==t)throw new Error((0,TO.A)(1));J({value:t.value})}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];y.onChange&&y.onChange(e,...n),C&&C(e,...n)},onFocus:e=>{$.disabled?e.stopPropagation():(R&&R(e),y.onFocus&&y.onFocus(e),K&&K.onFocus?K.onFocus(e):q(!0))}}))}),f,N?N((0,ke.A)({},$,{startAdornment:M})):null]}))]})})),qO=GO;function KO(e){return(0,AC.Ay)("MuiInput",e)}const $O=(0,ke.A)({},UO,(0,Ke.A)("MuiInput",["root","underline","input"])),YO=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],XO=(0,wC.Ay)(WO,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...FO(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;let r="light"===t.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(r=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),(0,ke.A)({position:"relative"},n.formControl&&{"label + &":{marginTop:16}},!n.disableUnderline&&{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[n.color].main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${$O.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${$O.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${$O.disabled}, .${$O.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${$O.disabled}:before`]:{borderBottomStyle:"dotted"}})})),JO=(0,wC.Ay)(zO,{name:"MuiInput",slot:"Input",overridesResolver:BO})({}),QO=t.forwardRef((function(e,t){var n,r,i,o;const s=(0,Qe.b)({props:e,name:"MuiInput"}),{disableUnderline:a,components:c={},componentsProps:l,fullWidth:u=!1,inputComponent:d="input",multiline:h=!1,slotProps:p,slots:f={},type:m="text"}=s,g=(0,Ne.A)(s,YO),v=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,bC.A)(r,KO,t);return(0,ke.A)({},t,i)})(s),y={root:{ownerState:{disableUnderline:a}}},_=(null!=p?p:l)?(0,SO.A)(null!=p?p:l,y):y,E=null!=(n=null!=(r=f.root)?r:c.Root)?n:XO,b=null!=(i=null!=(o=f.input)?o:c.Input)?i:JO;return(0,We.jsx)(qO,(0,ke.A)({slots:{root:E,input:b},slotProps:_,fullWidth:u,inputComponent:d,multiline:h,ref:t,type:m},g,{classes:v}))}));QO.muiName="Input";const ZO=QO;function ek(e){return(0,AC.Ay)("MuiFilledInput",e)}const tk=(0,ke.A)({},UO,(0,Ke.A)("MuiFilledInput",["root","underline","input"])),nk=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],rk=(0,wC.Ay)(WO,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...FO(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;var r;const i="light"===t.palette.mode,o=i?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=i?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",a=i?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",c=i?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return(0,ke.A)({position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:a,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s}},[`&.${tk.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s},[`&.${tk.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:c}},!n.disableUnderline&&{"&::after":{borderBottom:`2px solid ${null==(r=(t.vars||t).palette[n.color||"primary"])?void 0:r.main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${tk.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${tk.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:o}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${tk.disabled}, .${tk.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${tk.disabled}:before`]:{borderBottomStyle:"dotted"}},n.startAdornment&&{paddingLeft:12},n.endAdornment&&{paddingRight:12},n.multiline&&(0,ke.A)({padding:"25px 12px 8px"},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9}))})),ik=(0,wC.Ay)(zO,{name:"MuiFilledInput",slot:"Input",overridesResolver:BO})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9},n.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})})),ok=t.forwardRef((function(e,t){var n,r,i,o;const s=(0,Qe.b)({props:e,name:"MuiFilledInput"}),{components:a={},componentsProps:c,fullWidth:l=!1,inputComponent:u="input",multiline:d=!1,slotProps:h,slots:p={},type:f="text"}=s,m=(0,Ne.A)(s,nk),g=(0,ke.A)({},s,{fullWidth:l,inputComponent:u,multiline:d,type:f}),v=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,bC.A)(r,ek,t);return(0,ke.A)({},t,i)})(s),y={root:{ownerState:g},input:{ownerState:g}},_=(null!=h?h:c)?(0,SO.A)(y,null!=h?h:c):y,E=null!=(n=null!=(r=p.root)?r:a.Root)?n:rk,b=null!=(i=null!=(o=p.input)?o:a.Input)?i:ik;return(0,We.jsx)(qO,(0,ke.A)({slots:{root:E,input:b},componentsProps:_,fullWidth:l,inputComponent:u,multiline:d,ref:t,type:f},m,{classes:v}))}));ok.muiName="Input";const sk=ok;var ak;const ck=["children","classes","className","label","notched"],lk=(0,wC.Ay)("fieldset",{shouldForwardProp:gR.A})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),uk=(0,wC.Ay)("legend",{shouldForwardProp:gR.A})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({float:"unset",width:"auto",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:n.transitions.create("width",{duration:150,easing:n.transitions.easing.easeOut})},t.withLabel&&(0,ke.A)({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:n.transitions.create("max-width",{duration:50,easing:n.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:n.transitions.create("max-width",{duration:100,easing:n.transitions.easing.easeOut,delay:50})}))}));function dk(e){return(0,AC.Ay)("MuiOutlinedInput",e)}const hk=(0,ke.A)({},UO,(0,Ke.A)("MuiOutlinedInput",["root","notchedOutline","input"])),pk=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],fk=(0,wC.Ay)(WO,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiOutlinedInput",slot:"Root",overridesResolver:FO})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return(0,ke.A)({position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${hk.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${hk.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:r}},[`&.${hk.focused} .${hk.notchedOutline}`]:{borderColor:(t.vars||t).palette[n.color].main,borderWidth:2},[`&.${hk.error} .${hk.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${hk.disabled} .${hk.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}},n.startAdornment&&{paddingLeft:14},n.endAdornment&&{paddingRight:14},n.multiline&&(0,ke.A)({padding:"16.5px 14px"},"small"===n.size&&{padding:"8.5px 14px"}))})),mk=(0,wC.Ay)((function(e){const{className:t,label:n,notched:r}=e,i=(0,Ne.A)(e,ck),o=null!=n&&""!==n,s=(0,ke.A)({},e,{notched:r,withLabel:o});return(0,We.jsx)(lk,(0,ke.A)({"aria-hidden":!0,className:t,ownerState:s},i,{children:(0,We.jsx)(uk,{ownerState:s,children:o?(0,We.jsx)("span",{children:n}):ak||(ak=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"}))})}))}),{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:n}})),gk=(0,wC.Ay)(zO,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:BO})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{padding:"8.5px 14px"},n.multiline&&{padding:0},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0})})),vk=t.forwardRef((function(e,n){var r,i,o,s,a;const c=(0,Qe.b)({props:e,name:"MuiOutlinedInput"}),{components:l={},fullWidth:u=!1,inputComponent:d="input",label:h,multiline:p=!1,notched:f,slots:m={},type:g="text"}=c,v=(0,Ne.A)(c,pk),y=(e=>{const{classes:t}=e,n=(0,bC.A)({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},dk,t);return(0,ke.A)({},t,n)})(c),_=DO(),E=NO({props:c,muiFormControl:_,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),b=(0,ke.A)({},c,{color:E.color||"primary",disabled:E.disabled,error:E.error,focused:E.focused,formControl:_,fullWidth:u,hiddenLabel:E.hiddenLabel,multiline:p,size:E.size,type:g}),w=null!=(r=null!=(i=m.root)?i:l.Root)?r:fk,S=null!=(o=null!=(s=m.input)?s:l.Input)?o:gk;return(0,We.jsx)(qO,(0,ke.A)({slots:{root:w,input:S},renderSuffix:e=>(0,We.jsx)(mk,{ownerState:b,className:y.notchedOutline,label:null!=h&&""!==h&&E.required?a||(a=(0,We.jsxs)(t.Fragment,{children:[h,"\u2009","*"]})):h,notched:"undefined"!==typeof f?f:Boolean(e.startAdornment||e.filled||e.focused)}),fullWidth:u,inputComponent:d,multiline:p,ref:n,type:g},v,{classes:(0,ke.A)({},y,{notchedOutline:null})}))}));vk.muiName="Input";const yk=vk;function _k(e){return(0,AC.Ay)("MuiFormLabel",e)}const Ek=(0,Ke.A)("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),bk=["children","className","color","component","disabled","error","filled","focused","required"],wk=(0,wC.Ay)("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,ke.A)({},t.root,"secondary"===n.color&&t.colorSecondary,n.filled&&t.filled)}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({color:(t.vars||t).palette.text.secondary},t.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${Ek.focused}`]:{color:(t.vars||t).palette[n.color].main},[`&.${Ek.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Ek.error}`]:{color:(t.vars||t).palette.error.main}})})),Sk=(0,wC.Ay)("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${Ek.error}`]:{color:(t.vars||t).palette.error.main}}})),Tk=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiFormLabel"}),{children:r,className:i,component:o="label"}=n,s=(0,Ne.A)(n,bk),a=NO({props:n,muiFormControl:DO(),states:["color","required","focused","disabled","error","filled"]}),c=(0,ke.A)({},n,{color:a.color||"primary",component:o,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),l=(e=>{const{classes:t,color:n,focused:r,disabled:i,error:o,filled:s,required:a}=e,c={root:["root",`color${(0,SC.A)(n)}`,i&&"disabled",o&&"error",s&&"filled",r&&"focused",a&&"required"],asterisk:["asterisk",o&&"error"]};return(0,bC.A)(c,_k,t)})(c);return(0,We.jsxs)(wk,(0,ke.A)({as:o,ownerState:c,className:(0,Pe.A)(l.root,i),ref:t},s,{children:[r,a.required&&(0,We.jsxs)(Sk,{ownerState:c,"aria-hidden":!0,className:l.asterisk,children:["\u2009","*"]})]}))})),Ck=Tk;function Ak(e){return(0,AC.Ay)("MuiInputLabel",e)}(0,Ke.A)("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const Rk=["disableAnimation","margin","shrink","variant","className"],Ik=(0,wC.Ay)(Ck,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${Ek.asterisk}`]:t.asterisk},t.root,n.formControl&&t.formControl,"small"===n.size&&t.sizeSmall,n.shrink&&t.shrink,!n.disableAnimation&&t.animated,n.focused&&t.focused,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},n.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},"small"===n.size&&{transform:"translate(0, 17px) scale(1)"},n.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!n.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},"filled"===n.variant&&(0,ke.A)({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(12px, 13px) scale(1)"},n.shrink&&(0,ke.A)({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},"small"===n.size&&{transform:"translate(12px, 4px) scale(0.75)"})),"outlined"===n.variant&&(0,ke.A)({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(14px, 9px) scale(1)"},n.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))})),xk=t.forwardRef((function(e,t){const n=(0,Qe.b)({name:"MuiInputLabel",props:e}),{disableAnimation:r=!1,shrink:i,className:o}=n,s=(0,Ne.A)(n,Rk),a=DO();let c=i;"undefined"===typeof c&&a&&(c=a.filled||a.focused||a.adornedStart);const l=NO({props:n,muiFormControl:a,states:["size","variant","required","focused"]}),u=(0,ke.A)({},n,{disableAnimation:r,formControl:a,shrink:c,size:l.size,variant:l.variant,required:l.required,focused:l.focused}),d=(e=>{const{classes:t,formControl:n,size:r,shrink:i,disableAnimation:o,variant:s,required:a}=e,c={root:["root",n&&"formControl",!o&&"animated",i&&"shrink",r&&"normal"!==r&&`size${(0,SC.A)(r)}`,s],asterisk:[a&&"asterisk"]},l=(0,bC.A)(c,Ak,t);return(0,ke.A)({},t,l)})(u);return(0,We.jsx)(Ik,(0,ke.A)({"data-shrink":c,ownerState:u,ref:t,className:(0,Pe.A)(d.root,o)},s,{classes:d}))})),Ok=xk;function kk(e){return(0,AC.Ay)("MuiFormControl",e)}(0,Ke.A)("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Nk=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],Pk=(0,wC.Ay)("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,ke.A)({},t.root,t[`margin${(0,SC.A)(n.margin)}`],n.fullWidth&&t.fullWidth)}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},"normal"===t.margin&&{marginTop:16,marginBottom:8},"dense"===t.margin&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})})),Dk=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiFormControl"}),{children:i,className:o,color:s="primary",component:a="div",disabled:c=!1,error:l=!1,focused:u,fullWidth:d=!1,hiddenLabel:h=!1,margin:p="none",required:f=!1,size:m="medium",variant:g="outlined"}=r,v=(0,Ne.A)(r,Nk),y=(0,ke.A)({},r,{color:s,component:a,disabled:c,error:l,fullWidth:d,hiddenLabel:h,margin:p,required:f,size:m,variant:g}),_=(e=>{const{classes:t,margin:n,fullWidth:r}=e,i={root:["root","none"!==n&&`margin${(0,SC.A)(n)}`,r&&"fullWidth"]};return(0,bC.A)(i,kk,t)})(y),[E,b]=t.useState((()=>{let e=!1;return i&&t.Children.forEach(i,(t=>{if(!(0,Gx.A)(t,["Input","Select"]))return;const n=(0,Gx.A)(t,["Select"])?t.props.input:t;n&&n.props.startAdornment&&(e=!0)})),e})),[w,S]=t.useState((()=>{let e=!1;return i&&t.Children.forEach(i,(t=>{(0,Gx.A)(t,["Input","Select"])&&(MO(t.props,!0)||MO(t.props.inputProps,!0))&&(e=!0)})),e})),[T,C]=t.useState(!1);c&&T&&C(!1);const A=void 0===u||c?T:u;let R;const I=t.useMemo((()=>({adornedStart:E,setAdornedStart:b,color:s,disabled:c,error:l,filled:w,focused:A,fullWidth:d,hiddenLabel:h,size:m,onBlur:()=>{C(!1)},onEmpty:()=>{S(!1)},onFilled:()=>{S(!0)},onFocus:()=>{C(!0)},registerEffect:R,required:f,variant:g})),[E,s,c,l,w,A,d,h,R,f,m,g]);return(0,We.jsx)(PO.Provider,{value:I,children:(0,We.jsx)(Pk,(0,ke.A)({as:a,ownerState:y,className:(0,Pe.A)(_.root,o),ref:n},v,{children:i}))})})),Lk=Dk;function Mk(e){return(0,AC.Ay)("MuiFormHelperText",e)}const jk=(0,Ke.A)("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var Uk;const Vk=["children","className","component","disabled","error","filled","focused","margin","required","variant"],Fk=(0,wC.Ay)("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.size&&t[`size${(0,SC.A)(n.size)}`],n.contained&&t.contained,n.filled&&t.filled]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({color:(t.vars||t).palette.text.secondary},t.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${jk.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${jk.error}`]:{color:(t.vars||t).palette.error.main}},"small"===n.size&&{marginTop:4},n.contained&&{marginLeft:14,marginRight:14})})),Bk=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiFormHelperText"}),{children:r,className:i,component:o="p"}=n,s=(0,Ne.A)(n,Vk),a=NO({props:n,muiFormControl:DO(),states:["variant","size","disabled","error","filled","focused","required"]}),c=(0,ke.A)({},n,{component:o,contained:"filled"===a.variant||"outlined"===a.variant,variant:a.variant,size:a.size,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),l=(e=>{const{classes:t,contained:n,size:r,disabled:i,error:o,filled:s,focused:a,required:c}=e,l={root:["root",i&&"disabled",o&&"error",r&&`size${(0,SC.A)(r)}`,n&&"contained",a&&"focused",s&&"filled",c&&"required"]};return(0,bC.A)(l,Mk,t)})(c);return(0,We.jsx)(Fk,(0,ke.A)({as:o,ownerState:c,className:(0,Pe.A)(l.root,i),ref:t},s,{children:" "===r?Uk||(Uk=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"})):r}))})),Wk=Bk;function zk(e){return(0,AC.Ay)("MuiNativeSelect",e)}const Hk=(0,Ke.A)("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Gk=["className","disabled","error","IconComponent","inputRef","variant"],qk=e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":(0,ke.A)({},n.vars?{backgroundColor:`rgba(${n.vars.palette.common.onBackgroundChannel} / 0.05)`}:{backgroundColor:"light"===n.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},[`&.${Hk.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(n.vars||n).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},"filled"===t.variant&&{"&&&":{paddingRight:32}},"outlined"===t.variant&&{borderRadius:(n.vars||n).shape.borderRadius,"&:focus":{borderRadius:(n.vars||n).shape.borderRadius},"&&&":{paddingRight:32}})},Kk=(0,wC.Ay)("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:gR.A,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.select,t[n.variant],n.error&&t.error,{[`&.${Hk.multiple}`]:t.multiple}]}})(qk),$k=e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(n.vars||n).palette.action.active,[`&.${Hk.disabled}`]:{color:(n.vars||n).palette.action.disabled}},t.open&&{transform:"rotate(180deg)"},"filled"===t.variant&&{right:7},"outlined"===t.variant&&{right:7})},Yk=(0,wC.Ay)("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t[`icon${(0,SC.A)(n.variant)}`],n.open&&t.iconOpen]}})($k),Xk=t.forwardRef((function(e,n){const{className:r,disabled:i,error:o,IconComponent:s,inputRef:a,variant:c="standard"}=e,l=(0,Ne.A)(e,Gk),u=(0,ke.A)({},e,{disabled:i,variant:c,error:o}),d=(e=>{const{classes:t,variant:n,disabled:r,multiple:i,open:o,error:s}=e,a={select:["select",n,r&&"disabled",i&&"multiple",s&&"error"],icon:["icon",`icon${(0,SC.A)(n)}`,o&&"iconOpen",r&&"disabled"]};return(0,bC.A)(a,zk,t)})(u);return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)(Kk,(0,ke.A)({ownerState:u,className:(0,Pe.A)(d.select,r),disabled:i,ref:a||n},l)),e.multiple?null:(0,We.jsx)(Yk,{as:s,ownerState:u,className:d.icon})]})})),Jk=Xk;var Qk=n(1960),Zk=n(8733);function eN(e){return(0,AC.Ay)("MuiSelect",e)}const tN=(0,Ke.A)("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var nN;const rN=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],iN=(0,wC.Ay)("div",{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`&.${tN.select}`]:t.select},{[`&.${tN.select}`]:t[n.variant]},{[`&.${tN.error}`]:t.error},{[`&.${tN.multiple}`]:t.multiple}]}})(qk,{[`&.${tN.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),oN=(0,wC.Ay)("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t[`icon${(0,SC.A)(n.variant)}`],n.open&&t.iconOpen]}})($k),sN=(0,wC.Ay)("input",{shouldForwardProp:e=>(0,Qk.A)(e)&&"classes"!==e,name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function aN(e,t){return"object"===typeof t&&null!==t?e===t:String(e)===String(t)}function cN(e){return null==e||"string"===typeof e&&!e.trim()}const lN=t.forwardRef((function(e,n){var r;const{"aria-describedby":i,"aria-label":o,autoFocus:s,autoWidth:a,children:c,className:l,defaultOpen:u,defaultValue:d,disabled:h,displayEmpty:p,error:f=!1,IconComponent:m,inputRef:g,labelId:v,MenuProps:y={},multiple:_,name:E,onBlur:b,onChange:w,onClose:S,onFocus:T,onOpen:C,open:A,readOnly:R,renderValue:I,SelectDisplayProps:x={},tabIndex:O,value:k,variant:N="standard"}=e,P=(0,Ne.A)(e,rN),[D,L]=(0,Zk.A)({controlled:k,default:d,name:"Select"}),[M,j]=(0,Zk.A)({controlled:A,default:u,name:"Select"}),U=t.useRef(null),V=t.useRef(null),[F,B]=t.useState(null),{current:W}=t.useRef(null!=A),[z,H]=t.useState(),G=(0,gA.A)(n,g),q=t.useCallback((e=>{V.current=e,e&&B(e)}),[]),K=null==F?void 0:F.parentNode;t.useImperativeHandle(G,(()=>({focus:()=>{V.current.focus()},node:U.current,value:D})),[D]),t.useEffect((()=>{u&&M&&F&&!W&&(H(a?null:K.clientWidth),V.current.focus())}),[F,a]),t.useEffect((()=>{s&&V.current.focus()}),[s]),t.useEffect((()=>{if(!v)return;const e=(0,IR.A)(V.current).getElementById(v);if(e){const t=()=>{getSelection().isCollapsed&&V.current.focus()};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}}),[v]);const $=(e,t)=>{e?C&&C(t):S&&S(t),W||(H(a?null:K.clientWidth),j(e))},Y=t.Children.toArray(c),X=e=>t=>{let n;if(t.currentTarget.hasAttribute("tabindex")){if(_){n=Array.isArray(D)?D.slice():[];const t=D.indexOf(e.props.value);-1===t?n.push(e.props.value):n.splice(t,1)}else n=e.props.value;if(e.props.onClick&&e.props.onClick(t),D!==n&&(L(n),w)){const r=t.nativeEvent||t,i=new r.constructor(r.type,r);Object.defineProperty(i,"target",{writable:!0,value:{value:n,name:E}}),w(i,e)}_||$(!1,t)}},J=null!==F&&M;let Q,Z;delete P["aria-invalid"];const ee=[];let te=!1,ne=!1;(MO({value:D})||p)&&(I?Q=I(D):te=!0);const re=Y.map((e=>{if(!t.isValidElement(e))return null;let n;if(_){if(!Array.isArray(D))throw new Error((0,TO.A)(2));n=D.some((t=>aN(t,e.props.value))),n&&te&&ee.push(e.props.children)}else n=aN(D,e.props.value),n&&te&&(Z=e.props.children);return n&&(ne=!0),t.cloneElement(e,{"aria-selected":n?"true":"false",onClick:X(e),onKeyUp:t=>{" "===t.key&&t.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(t)},role:"option",selected:n,value:void 0,"data-value":e.props.value})}));te&&(Q=_?0===ee.length?null:ee.reduce(((e,t,n)=>(e.push(t),n<ee.length-1&&e.push(", "),e)),[]):Z);let ie,oe=z;!a&&W&&F&&(oe=K.clientWidth),ie="undefined"!==typeof O?O:h?null:0;const se=x.id||(E?`mui-component-select-${E}`:void 0),ae=(0,ke.A)({},e,{variant:N,value:D,open:J,error:f}),ce=(e=>{const{classes:t,variant:n,disabled:r,multiple:i,open:o,error:s}=e,a={select:["select",n,r&&"disabled",i&&"multiple",s&&"error"],icon:["icon",`icon${(0,SC.A)(n)}`,o&&"iconOpen",r&&"disabled"],nativeInput:["nativeInput"]};return(0,bC.A)(a,eN,t)})(ae),le=(0,ke.A)({},y.PaperProps,null==(r=y.slotProps)?void 0:r.paper),ue=(0,hO.A)();return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)(iN,(0,ke.A)({ref:q,tabIndex:ie,role:"combobox","aria-controls":ue,"aria-disabled":h?"true":void 0,"aria-expanded":J?"true":"false","aria-haspopup":"listbox","aria-label":o,"aria-labelledby":[v,se].filter(Boolean).join(" ")||void 0,"aria-describedby":i,onKeyDown:e=>{if(!R){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),$(!0,e))}},onMouseDown:h||R?null:e=>{0===e.button&&(e.preventDefault(),V.current.focus(),$(!0,e))},onBlur:e=>{!J&&b&&(Object.defineProperty(e,"target",{writable:!0,value:{value:D,name:E}}),b(e))},onFocus:T},x,{ownerState:ae,className:(0,Pe.A)(x.className,ce.select,l),id:se,children:cN(Q)?nN||(nN=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"})):Q})),(0,We.jsx)(sN,(0,ke.A)({"aria-invalid":f,value:Array.isArray(D)?D.join(","):D,name:E,ref:U,"aria-hidden":!0,onChange:e=>{const t=Y.find((t=>t.props.value===e.target.value));void 0!==t&&(L(t.props.value),w&&w(e,t))},tabIndex:-1,disabled:h,className:ce.nativeInput,autoFocus:s,ownerState:ae},P)),(0,We.jsx)(oN,{as:m,className:ce.icon,ownerState:ae}),(0,We.jsx)(px,(0,ke.A)({id:`menu-${E||""}`,anchorEl:K,open:J,onClose:e=>{$(!1,e)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},y,{MenuListProps:(0,ke.A)({"aria-labelledby":v,role:"listbox","aria-multiselectable":_?"true":void 0,disableListWrap:!0,id:ue},y.MenuListProps),slotProps:(0,ke.A)({},y.slotProps,{paper:(0,ke.A)({},le,{style:(0,ke.A)({minWidth:oe},null!=le?le.style:null)})}),children:re}))]})})),uN=lN,dN=(0,zC.A)((0,We.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),hN=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],pN=["root"],fN={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>(0,gR.A)(e)&&"variant"!==e,slot:"Root"},mN=(0,wC.Ay)(ZO,fN)(""),gN=(0,wC.Ay)(yk,fN)(""),vN=(0,wC.Ay)(sk,fN)(""),yN=t.forwardRef((function(e,n){const r=(0,Qe.b)({name:"MuiSelect",props:e}),{autoWidth:i=!1,children:o,classes:s={},className:a,defaultOpen:c=!1,displayEmpty:l=!1,IconComponent:u=dN,id:d,input:h,inputProps:p,label:f,labelId:m,MenuProps:g,multiple:v=!1,native:y=!1,onClose:_,onOpen:E,open:b,renderValue:w,SelectDisplayProps:S,variant:T="outlined"}=r,C=(0,Ne.A)(r,hN),A=y?Jk:uN,R=NO({props:r,muiFormControl:DO(),states:["variant","error"]}),I=R.variant||T,x=(0,ke.A)({},r,{variant:I,classes:s}),O=(e=>{const{classes:t}=e;return t})(x),k=(0,Ne.A)(O,pN),N=h||{standard:(0,We.jsx)(mN,{ownerState:x}),outlined:(0,We.jsx)(gN,{label:f,ownerState:x}),filled:(0,We.jsx)(vN,{ownerState:x})}[I],P=(0,gA.A)(n,KR(N));return(0,We.jsx)(t.Fragment,{children:t.cloneElement(N,(0,ke.A)({inputComponent:A,inputProps:(0,ke.A)({children:o,error:R.error,IconComponent:u,variant:I,type:void 0,multiple:v},y?{id:d}:{autoWidth:i,defaultOpen:c,displayEmpty:l,labelId:m,MenuProps:g,onClose:_,onOpen:E,open:b,renderValue:w,SelectDisplayProps:(0,ke.A)({id:d},S)},p,{classes:p?(0,SO.A)(k,p.classes):k},h?h.props.inputProps:{})},(v&&y||l)&&"outlined"===I?{notched:!0}:{},{ref:P,className:(0,Pe.A)(N.props.className,a,O.root)},!h&&{variant:I},C))})}));yN.muiName="Select";const _N=yN;function EN(e){return(0,AC.Ay)("MuiTextField",e)}(0,Ke.A)("MuiTextField",["root"]);const bN=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],wN={standard:ZO,filled:sk,outlined:yk},SN=(0,wC.Ay)(Lk,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),TN=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiTextField"}),{autoComplete:r,autoFocus:i=!1,children:o,className:s,color:a="primary",defaultValue:c,disabled:l=!1,error:u=!1,FormHelperTextProps:d,fullWidth:h=!1,helperText:p,id:f,InputLabelProps:m,inputProps:g,InputProps:v,inputRef:y,label:_,maxRows:E,minRows:b,multiline:w=!1,name:S,onBlur:T,onChange:C,onFocus:A,placeholder:R,required:I=!1,rows:x,select:O=!1,SelectProps:k,type:N,value:P,variant:D="outlined"}=n,L=(0,Ne.A)(n,bN),M=(0,ke.A)({},n,{autoFocus:i,color:a,disabled:l,error:u,fullWidth:h,multiline:w,required:I,select:O,variant:D}),j=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},EN,t)})(M);const U={};"outlined"===D&&(m&&"undefined"!==typeof m.shrink&&(U.notched=m.shrink),U.label=_),O&&(k&&k.native||(U.id=void 0),U["aria-describedby"]=void 0);const V=(0,hO.A)(f),F=p&&V?`${V}-helper-text`:void 0,B=_&&V?`${V}-label`:void 0,W=wN[D],z=(0,We.jsx)(W,(0,ke.A)({"aria-describedby":F,autoComplete:r,autoFocus:i,defaultValue:c,fullWidth:h,multiline:w,name:S,rows:x,maxRows:E,minRows:b,type:N,value:P,id:V,inputRef:y,onBlur:T,onChange:C,onFocus:A,placeholder:R,inputProps:g},U,v));return(0,We.jsxs)(SN,(0,ke.A)({className:(0,Pe.A)(j.root,s),disabled:l,error:u,fullWidth:h,ref:t,required:I,color:a,variant:D,ownerState:M},L,{children:[null!=_&&""!==_&&(0,We.jsx)(Ok,(0,ke.A)({htmlFor:V,id:B},m,{children:_})),O?(0,We.jsx)(_N,(0,ke.A)({"aria-describedby":F,id:V,labelId:B,value:P,input:z},k,{children:o})):z,p&&(0,We.jsx)(Wk,(0,ke.A)({id:F},d,{children:p}))]}))})),CN=TN;function AN(e){return(0,AC.Ay)("MuiCircularProgress",e)}(0,Ke.A)("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const RN=["className","color","disableShrink","size","style","thickness","value","variant"];let IN,xN,ON,kN,NN=e=>e;const PN=44,DN=(0,xA.i7)(IN||(IN=NN`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),LN=(0,xA.i7)(xN||(xN=NN`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),MN=(0,wC.Ay)("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`color${(0,SC.A)(n.color)}`]]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({display:"inline-block"},"determinate"===t.variant&&{transition:n.transitions.create("transform")},"inherit"!==t.color&&{color:(n.vars||n).palette[t.color].main})}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&(0,xA.AH)(ON||(ON=NN`
      animation: ${0} 1.4s linear infinite;
    `),DN)})),jN=(0,wC.Ay)("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),UN=(0,wC.Ay)("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.circle,t[`circle${(0,SC.A)(n.variant)}`],n.disableShrink&&t.circleDisableShrink]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({stroke:"currentColor"},"determinate"===t.variant&&{transition:n.transitions.create("stroke-dashoffset")},"indeterminate"===t.variant&&{strokeDasharray:"80px, 200px",strokeDashoffset:0})}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&!t.disableShrink&&(0,xA.AH)(kN||(kN=NN`
      animation: ${0} 1.4s ease-in-out infinite;
    `),LN)})),VN=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiCircularProgress"}),{className:r,color:i="primary",disableShrink:o=!1,size:s=40,style:a,thickness:c=3.6,value:l=0,variant:u="indeterminate"}=n,d=(0,Ne.A)(n,RN),h=(0,ke.A)({},n,{color:i,disableShrink:o,size:s,thickness:c,value:l,variant:u}),p=(e=>{const{classes:t,variant:n,color:r,disableShrink:i}=e,o={root:["root",n,`color${(0,SC.A)(r)}`],svg:["svg"],circle:["circle",`circle${(0,SC.A)(n)}`,i&&"circleDisableShrink"]};return(0,bC.A)(o,AN,t)})(h),f={},m={},g={};if("determinate"===u){const e=2*Math.PI*((PN-c)/2);f.strokeDasharray=e.toFixed(3),g["aria-valuenow"]=Math.round(l),f.strokeDashoffset=`${((100-l)/100*e).toFixed(3)}px`,m.transform="rotate(-90deg)"}return(0,We.jsx)(MN,(0,ke.A)({className:(0,Pe.A)(p.root,r),style:(0,ke.A)({width:s,height:s},m,a),ownerState:h,ref:t,role:"progressbar"},g,d,{children:(0,We.jsx)(jN,{className:p.svg,ownerState:h,viewBox:"22 22 44 44",children:(0,We.jsx)(UN,{className:p.circle,style:f,ownerState:h,cx:PN,cy:PN,r:(PN-c)/2,fill:"none",strokeWidth:c})})}))})),FN=VN;var BN=n(5501);function WN(e){const{theme:t,name:n,props:r}=e;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?(0,mR.A)(t.components[n].defaultProps,r):r}function zN(e){let{props:t,name:n,defaultTheme:r,themeId:i}=e,o=Be(r);i&&(o=o[i]||o);return WN({theme:o,name:n,props:t})}const HN=["ownerState"],GN=["variants"],qN=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function KN(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const $N=(0,je.A)(),YN=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function XN(e){let{defaultTheme:t,theme:n,themeId:r}=e;return i=n,0===Object.keys(i).length?t:n[r]||n;var i}function JN(e){return e?(t,n)=>n[e]:null}function QN(e,t){let{ownerState:n}=t,r=(0,Ne.A)(t,HN);const i="function"===typeof e?e((0,ke.A)({ownerState:n},r)):e;if(Array.isArray(i))return i.flatMap((e=>QN(e,(0,ke.A)({ownerState:n},r))));if(i&&"object"===typeof i&&Array.isArray(i.variants)){const{variants:e=[]}=i;let t=(0,Ne.A)(i,GN);return e.forEach((e=>{let i=!0;"function"===typeof e.props?i=e.props((0,ke.A)({ownerState:n},r,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&r[t]!==e.props[t]&&(i=!1)})),i&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,ke.A)({ownerState:n},r,n)):e.style))})),t}return i}const ZN=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=$N,rootShouldForwardProp:r=KN,slotShouldForwardProp:i=KN}=e,o=e=>(0,Le.A)((0,ke.A)({},e,{theme:XN((0,ke.A)({},e,{defaultTheme:n,themeId:t}))}));return o.__mui_systemSx=!0,function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,De.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:a,slot:c,skipVariantsResolver:l,skipSx:u,overridesResolver:d=JN(YN(c))}=s,h=(0,Ne.A)(s,qN),p=void 0!==l?l:c&&"Root"!==c&&"root"!==c||!1,f=u||!1;let m=KN;"Root"===c||"root"===c?m=r:c?m=i:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(m=void 0);const g=(0,De.default)(e,(0,ke.A)({shouldForwardProp:m,label:undefined},h)),v=e=>"function"===typeof e&&e.__emotion_real!==e||(0,SO.Q)(e)?r=>QN(e,(0,ke.A)({},r,{theme:XN({theme:r.theme,defaultTheme:n,themeId:t})})):e,y=function(r){let i=v(r);for(var s=arguments.length,c=new Array(s>1?s-1:0),l=1;l<s;l++)c[l-1]=arguments[l];const u=c?c.map(v):[];a&&d&&u.push((e=>{const r=XN((0,ke.A)({},e,{defaultTheme:n,themeId:t}));if(!r.components||!r.components[a]||!r.components[a].styleOverrides)return null;const i=r.components[a].styleOverrides,o={};return Object.entries(i).forEach((t=>{let[n,i]=t;o[n]=QN(i,(0,ke.A)({},e,{theme:r}))})),d(e,o)})),a&&!p&&u.push((e=>{var r;const i=XN((0,ke.A)({},e,{defaultTheme:n,themeId:t}));return QN({variants:null==i||null==(r=i.components)||null==(r=r[a])?void 0:r.variants},(0,ke.A)({},e,{theme:i}))})),f||u.push(o);const h=u.length-c.length;if(Array.isArray(r)&&h>0){const e=new Array(h).fill("");i=[...r,...e],i.raw=[...r.raw,...e]}const m=g(i,...u);return e.muiName&&(m.muiName=e.muiName),m};return g.withConfig&&(y.withConfig=g.withConfig),y}}(),eP=ZN,tP=["className","component","disableGutters","fixed","maxWidth","classes"],nP=(0,je.A)(),rP=eP("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`maxWidth${(0,BN.A)(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),iP=e=>zN({props:e,name:"MuiContainer",defaultTheme:nP});const oP=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:n=rP,useThemeProps:r=iP,componentName:i="MuiContainer"}=e,o=n((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})}),(e=>{let{theme:t,ownerState:n}=e;return n.fixed&&Object.keys(t.breakpoints.values).reduce(((e,n)=>{const r=n,i=t.breakpoints.values[r];return 0!==i&&(e[t.breakpoints.up(r)]={maxWidth:`${i}${t.breakpoints.unit}`}),e}),{})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},"xs"===n.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},n.maxWidth&&"xs"!==n.maxWidth&&{[t.breakpoints.up(n.maxWidth)]:{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`}})})),s=t.forwardRef((function(e,t){const n=r(e),{className:s,component:a="div",disableGutters:c=!1,fixed:l=!1,maxWidth:u="lg"}=n,d=(0,Ne.A)(n,tP),h=(0,ke.A)({},n,{component:a,disableGutters:c,fixed:l,maxWidth:u}),p=((e,t)=>{const{classes:n,fixed:r,disableGutters:i,maxWidth:o}=e,s={root:["root",o&&`maxWidth${(0,BN.A)(String(o))}`,r&&"fixed",i&&"disableGutters"]};return(0,bC.A)(s,(e=>(0,AC.Ay)(t,e)),n)})(h,i);return(0,We.jsx)(o,(0,ke.A)({as:a,ownerState:h,className:(0,Pe.A)(p.root,s),ref:t},d))}));return s}({createStyledComponent:(0,wC.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`maxWidth${(0,SC.A)(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,Qe.b)({props:e,name:"MuiContainer"})}),sP=oP;let aP;function cP(){if(aP)return aP;const e=document.createElement("div"),t=document.createElement("div");return t.style.width="10px",t.style.height="1px",e.appendChild(t),e.dir="rtl",e.style.fontSize="14px",e.style.width="4px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.overflow="scroll",document.body.appendChild(e),aP="reverse",e.scrollLeft>0?aP="default":(e.scrollLeft=1,0===e.scrollLeft&&(aP="negative")),document.body.removeChild(e),aP}function lP(e,t){const n=e.scrollLeft;if("rtl"!==t)return n;switch(cP()){case"negative":return e.scrollWidth-e.clientWidth+n;case"reverse":return e.scrollWidth-e.clientWidth-n;default:return n}}function uP(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}const dP=["onChange"],hP={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};const pP=(0,zC.A)((0,We.jsx)("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft"),fP=(0,zC.A)((0,We.jsx)("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight");function mP(e){return(0,AC.Ay)("MuiTabScrollButton",e)}const gP=(0,Ke.A)("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),vP=["className","slots","slotProps","direction","orientation","disabled"],yP=(0,wC.Ay)(JA,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.orientation&&t[n.orientation]]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({width:40,flexShrink:0,opacity:.8,[`&.${gP.disabled}`]:{opacity:0}},"vertical"===t.orientation&&{width:"100%",height:40,"& svg":{transform:`rotate(${t.isRtl?-90:90}deg)`}})})),_P=t.forwardRef((function(e,t){var n,r;const i=(0,Qe.b)({props:e,name:"MuiTabScrollButton"}),{className:o,slots:s={},slotProps:a={},direction:c}=i,l=(0,Ne.A)(i,vP),u=dC(),d=(0,ke.A)({isRtl:u},i),h=(e=>{const{classes:t,orientation:n,disabled:r}=e,i={root:["root",n,r&&"disabled"]};return(0,bC.A)(i,mP,t)})(d),p=null!=(n=s.StartScrollButtonIcon)?n:pP,f=null!=(r=s.EndScrollButtonIcon)?r:fP,m=sR({elementType:p,externalSlotProps:a.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:d}),g=sR({elementType:f,externalSlotProps:a.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:d});return(0,We.jsx)(yP,(0,ke.A)({component:"div",className:(0,Pe.A)(h.root,o),ref:t,role:null,ownerState:d,tabIndex:null},l,{children:"left"===c?(0,We.jsx)(p,(0,ke.A)({},m)):(0,We.jsx)(f,(0,ke.A)({},g))}))})),EP=_P;function bP(e){return(0,AC.Ay)("MuiTabs",e)}const wP=(0,Ke.A)("MuiTabs",["root","vertical","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),SP=["aria-label","aria-labelledby","action","centered","children","className","component","allowScrollButtonsMobile","indicatorColor","onChange","orientation","ScrollButtonComponent","scrollButtons","selectionFollowsFocus","slots","slotProps","TabIndicatorProps","TabScrollButtonProps","textColor","value","variant","visibleScrollbar"],TP=(e,t)=>e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:e.firstChild,CP=(e,t)=>e===t?e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:e.lastChild,AP=(e,t,n)=>{let r=!1,i=n(e,t);for(;i;){if(i===e.firstChild){if(r)return;r=!0}const t=i.disabled||"true"===i.getAttribute("aria-disabled");if(i.hasAttribute("tabindex")&&!t)return void i.focus();i=n(e,i)}},RP=(0,wC.Ay)("div",{name:"MuiTabs",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${wP.scrollButtons}`]:t.scrollButtons},{[`& .${wP.scrollButtons}`]:n.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,n.vertical&&t.vertical]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex"},t.vertical&&{flexDirection:"column"},t.scrollButtonsHideMobile&&{[`& .${wP.scrollButtons}`]:{[n.breakpoints.down("sm")]:{display:"none"}}})})),IP=(0,wC.Ay)("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.scroller,n.fixed&&t.fixed,n.hideScrollbar&&t.hideScrollbar,n.scrollableX&&t.scrollableX,n.scrollableY&&t.scrollableY]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap"},t.fixed&&{overflowX:"hidden",width:"100%"},t.hideScrollbar&&{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},t.scrollableX&&{overflowX:"auto",overflowY:"hidden"},t.scrollableY&&{overflowY:"auto",overflowX:"hidden"})})),xP=(0,wC.Ay)("div",{name:"MuiTabs",slot:"FlexContainer",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.flexContainer,n.vertical&&t.flexContainerVertical,n.centered&&t.centered]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"flex"},t.vertical&&{flexDirection:"column"},t.centered&&{justifyContent:"center"})})),OP=(0,wC.Ay)("span",{name:"MuiTabs",slot:"Indicator",overridesResolver:(e,t)=>t.indicator})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({position:"absolute",height:2,bottom:0,width:"100%",transition:n.transitions.create()},"primary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.primary.main},"secondary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.secondary.main},t.vertical&&{height:"100%",width:2,right:0})})),kP=(0,wC.Ay)((function(e){const{onChange:n}=e,r=(0,Ne.A)(e,dP),i=t.useRef(),o=t.useRef(null),s=()=>{i.current=o.current.offsetHeight-o.current.clientHeight};return(0,jR.A)((()=>{const e=(0,GR.A)((()=>{const e=i.current;s(),e!==i.current&&n(i.current)})),t=(0,qR.A)(o.current);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[n]),t.useEffect((()=>{s(),n(i.current)}),[n]),(0,We.jsx)("div",(0,ke.A)({style:hP},r,{ref:o}))}))({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),NP={};const PP=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiTabs"}),i=iI(),o=dC(),{"aria-label":s,"aria-labelledby":a,action:c,centered:l=!1,children:u,className:d,component:h="div",allowScrollButtonsMobile:p=!1,indicatorColor:f="primary",onChange:m,orientation:g="horizontal",ScrollButtonComponent:v=EP,scrollButtons:y="auto",selectionFollowsFocus:_,slots:E={},slotProps:b={},TabIndicatorProps:w={},TabScrollButtonProps:S={},textColor:T="primary",value:C,variant:A="standard",visibleScrollbar:R=!1}=r,I=(0,Ne.A)(r,SP),x="scrollable"===A,O="vertical"===g,k=O?"scrollTop":"scrollLeft",N=O?"top":"left",P=O?"bottom":"right",D=O?"clientHeight":"clientWidth",L=O?"height":"width",M=(0,ke.A)({},r,{component:h,allowScrollButtonsMobile:p,indicatorColor:f,orientation:g,vertical:O,scrollButtons:y,textColor:T,variant:A,visibleScrollbar:R,fixed:!x,hideScrollbar:x&&!R,scrollableX:x&&!O,scrollableY:x&&O,centered:l&&!x,scrollButtonsHideMobile:!p}),j=(e=>{const{vertical:t,fixed:n,hideScrollbar:r,scrollableX:i,scrollableY:o,centered:s,scrollButtonsHideMobile:a,classes:c}=e,l={root:["root",t&&"vertical"],scroller:["scroller",n&&"fixed",r&&"hideScrollbar",i&&"scrollableX",o&&"scrollableY"],flexContainer:["flexContainer",t&&"flexContainerVertical",s&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",a&&"scrollButtonsHideMobile"],scrollableX:[i&&"scrollableX"],hideScrollbar:[r&&"hideScrollbar"]};return(0,bC.A)(l,bP,c)})(M),U=sR({elementType:E.StartScrollButtonIcon,externalSlotProps:b.startScrollButtonIcon,ownerState:M}),V=sR({elementType:E.EndScrollButtonIcon,externalSlotProps:b.endScrollButtonIcon,ownerState:M});const[F,B]=t.useState(!1),[W,z]=t.useState(NP),[H,G]=t.useState(!1),[q,K]=t.useState(!1),[$,Y]=t.useState(!1),[X,J]=t.useState({overflow:"hidden",scrollbarWidth:0}),Q=new Map,Z=t.useRef(null),ee=t.useRef(null),te=()=>{const e=Z.current;let t,n;if(e){const n=e.getBoundingClientRect();t={clientWidth:e.clientWidth,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop,scrollLeftNormalized:lP(e,o?"rtl":"ltr"),scrollWidth:e.scrollWidth,top:n.top,bottom:n.bottom,left:n.left,right:n.right}}if(e&&!1!==C){const e=ee.current.children;if(e.length>0){const t=e[Q.get(C)];0,n=t?t.getBoundingClientRect():null}}return{tabsMeta:t,tabMeta:n}},ne=(0,vA.A)((()=>{const{tabsMeta:e,tabMeta:t}=te();let n,r=0;if(O)n="top",t&&e&&(r=t.top-e.top+e.scrollTop);else if(n=o?"right":"left",t&&e){const i=o?e.scrollLeftNormalized+e.clientWidth-e.scrollWidth:e.scrollLeft;r=(o?-1:1)*(t[n]-e[n]+i)}const i={[n]:r,[L]:t?t[L]:0};if(isNaN(W[n])||isNaN(W[L]))z(i);else{const e=Math.abs(W[n]-i[n]),t=Math.abs(W[L]-i[L]);(e>=1||t>=1)&&z(i)}})),re=function(e){let{animation:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t?function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const{ease:o=uP,duration:s=300}=r;let a=null;const c=t[e];let l=!1;const u=()=>{l=!0},d=r=>{if(l)return void i(new Error("Animation cancelled"));null===a&&(a=r);const u=Math.min(1,(r-a)/s);t[e]=o(u)*(n-c)+c,u>=1?requestAnimationFrame((()=>{i(null)})):requestAnimationFrame(d)};c===n?i(new Error("Element already at target position")):requestAnimationFrame(d)}(k,Z.current,e,{duration:i.transitions.duration.standard}):Z.current[k]=e},ie=e=>{let t=Z.current[k];O?t+=e:(t+=e*(o?-1:1),t*=o&&"reverse"===cP()?-1:1),re(t)},oe=()=>{const e=Z.current[D];let t=0;const n=Array.from(ee.current.children);for(let r=0;r<n.length;r+=1){const i=n[r];if(t+i[D]>e){0===r&&(t=e);break}t+=i[D]}return t},se=()=>{ie(-1*oe())},ae=()=>{ie(oe())},ce=t.useCallback((e=>{J({overflow:null,scrollbarWidth:e})}),[]),le=(0,vA.A)((e=>{const{tabsMeta:t,tabMeta:n}=te();if(n&&t)if(n[N]<t[N]){const r=t[k]+(n[N]-t[N]);re(r,{animation:e})}else if(n[P]>t[P]){const r=t[k]+(n[P]-t[P]);re(r,{animation:e})}})),ue=(0,vA.A)((()=>{x&&!1!==y&&Y(!$)}));t.useEffect((()=>{const e=(0,GR.A)((()=>{Z.current&&ne()}));let t;const n=n=>{n.forEach((e=>{e.removedNodes.forEach((e=>{var n;null==(n=t)||n.unobserve(e)})),e.addedNodes.forEach((e=>{var n;null==(n=t)||n.observe(e)}))})),e(),ue()},r=(0,qR.A)(Z.current);let i;return r.addEventListener("resize",e),"undefined"!==typeof ResizeObserver&&(t=new ResizeObserver(e),Array.from(ee.current.children).forEach((e=>{t.observe(e)}))),"undefined"!==typeof MutationObserver&&(i=new MutationObserver(n),i.observe(ee.current,{childList:!0})),()=>{var n,o;e.clear(),r.removeEventListener("resize",e),null==(n=i)||n.disconnect(),null==(o=t)||o.disconnect()}}),[ne,ue]),t.useEffect((()=>{const e=Array.from(ee.current.children),t=e.length;if("undefined"!==typeof IntersectionObserver&&t>0&&x&&!1!==y){const n=e[0],r=e[t-1],i={root:Z.current,threshold:.99},o=new IntersectionObserver((e=>{G(!e[0].isIntersecting)}),i);o.observe(n);const s=new IntersectionObserver((e=>{K(!e[0].isIntersecting)}),i);return s.observe(r),()=>{o.disconnect(),s.disconnect()}}}),[x,y,$,null==u?void 0:u.length]),t.useEffect((()=>{B(!0)}),[]),t.useEffect((()=>{ne()})),t.useEffect((()=>{le(NP!==W)}),[le,W]),t.useImperativeHandle(c,(()=>({updateIndicator:ne,updateScrollButtons:ue})),[ne,ue]);const de=(0,We.jsx)(OP,(0,ke.A)({},w,{className:(0,Pe.A)(j.indicator,w.className),ownerState:M,style:(0,ke.A)({},W,w.style)}));let he=0;const pe=t.Children.map(u,(e=>{if(!t.isValidElement(e))return null;const n=void 0===e.props.value?he:e.props.value;Q.set(n,he);const r=n===C;return he+=1,t.cloneElement(e,(0,ke.A)({fullWidth:"fullWidth"===A,indicator:r&&!F&&de,selected:r,selectionFollowsFocus:_,onChange:m,textColor:T,value:n},1!==he||!1!==C||e.props.tabIndex?{}:{tabIndex:0}))})),fe=(()=>{const e={};e.scrollbarSizeListener=x?(0,We.jsx)(kP,{onChange:ce,className:(0,Pe.A)(j.scrollableX,j.hideScrollbar)}):null;const t=x&&("auto"===y&&(H||q)||!0===y);return e.scrollButtonStart=t?(0,We.jsx)(v,(0,ke.A)({slots:{StartScrollButtonIcon:E.StartScrollButtonIcon},slotProps:{startScrollButtonIcon:U},orientation:g,direction:o?"right":"left",onClick:se,disabled:!H},S,{className:(0,Pe.A)(j.scrollButtons,S.className)})):null,e.scrollButtonEnd=t?(0,We.jsx)(v,(0,ke.A)({slots:{EndScrollButtonIcon:E.EndScrollButtonIcon},slotProps:{endScrollButtonIcon:V},orientation:g,direction:o?"left":"right",onClick:ae,disabled:!q},S,{className:(0,Pe.A)(j.scrollButtons,S.className)})):null,e})();return(0,We.jsxs)(RP,(0,ke.A)({className:(0,Pe.A)(j.root,d),ownerState:M,ref:n,as:h},I,{children:[fe.scrollButtonStart,fe.scrollbarSizeListener,(0,We.jsxs)(IP,{className:j.scroller,ownerState:M,style:{overflow:X.overflow,[O?"margin"+(o?"Left":"Right"):"marginBottom"]:R?void 0:-X.scrollbarWidth},ref:Z,children:[(0,We.jsx)(xP,{"aria-label":s,"aria-labelledby":a,"aria-orientation":"vertical"===g?"vertical":null,className:j.flexContainer,ownerState:M,onKeyDown:e=>{const t=ee.current,n=(0,IR.A)(t).activeElement;if("tab"!==n.getAttribute("role"))return;let r="horizontal"===g?"ArrowLeft":"ArrowUp",i="horizontal"===g?"ArrowRight":"ArrowDown";switch("horizontal"===g&&o&&(r="ArrowRight",i="ArrowLeft"),e.key){case r:e.preventDefault(),AP(t,n,CP);break;case i:e.preventDefault(),AP(t,n,TP);break;case"Home":e.preventDefault(),AP(t,null,TP);break;case"End":e.preventDefault(),AP(t,null,CP)}},ref:ee,role:"tablist",children:pe}),F&&de]}),fe.scrollButtonEnd]}))})),DP=PP;function LP(e){return(0,AC.Ay)("MuiTab",e)}const MP=(0,Ke.A)("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper"]),jP=["className","disabled","disableFocusRipple","fullWidth","icon","iconPosition","indicator","label","onChange","onClick","onFocus","selected","selectionFollowsFocus","textColor","value","wrapped"],UP=(0,wC.Ay)(JA,{name:"MuiTab",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.label&&n.icon&&t.labelIcon,t[`textColor${(0,SC.A)(n.textColor)}`],n.fullWidth&&t.fullWidth,n.wrapped&&t.wrapped,{[`& .${MP.iconWrapper}`]:t.iconWrapper}]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},t.typography.button,{maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center"},n.label&&{flexDirection:"top"===n.iconPosition||"bottom"===n.iconPosition?"column":"row"},{lineHeight:1.25},n.icon&&n.label&&{minHeight:72,paddingTop:9,paddingBottom:9,[`& > .${MP.iconWrapper}`]:(0,ke.A)({},"top"===n.iconPosition&&{marginBottom:6},"bottom"===n.iconPosition&&{marginTop:6},"start"===n.iconPosition&&{marginRight:t.spacing(1)},"end"===n.iconPosition&&{marginLeft:t.spacing(1)})},"inherit"===n.textColor&&{color:"inherit",opacity:.6,[`&.${MP.selected}`]:{opacity:1},[`&.${MP.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"primary"===n.textColor&&{color:(t.vars||t).palette.text.secondary,[`&.${MP.selected}`]:{color:(t.vars||t).palette.primary.main},[`&.${MP.disabled}`]:{color:(t.vars||t).palette.text.disabled}},"secondary"===n.textColor&&{color:(t.vars||t).palette.text.secondary,[`&.${MP.selected}`]:{color:(t.vars||t).palette.secondary.main},[`&.${MP.disabled}`]:{color:(t.vars||t).palette.text.disabled}},n.fullWidth&&{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"},n.wrapped&&{fontSize:t.typography.pxToRem(12)})})),VP=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiTab"}),{className:i,disabled:o=!1,disableFocusRipple:s=!1,fullWidth:a,icon:c,iconPosition:l="top",indicator:u,label:d,onChange:h,onClick:p,onFocus:f,selected:m,selectionFollowsFocus:g,textColor:v="inherit",value:y,wrapped:_=!1}=r,E=(0,Ne.A)(r,jP),b=(0,ke.A)({},r,{disabled:o,disableFocusRipple:s,selected:m,icon:!!c,iconPosition:l,label:!!d,fullWidth:a,textColor:v,wrapped:_}),w=(e=>{const{classes:t,textColor:n,fullWidth:r,wrapped:i,icon:o,label:s,selected:a,disabled:c}=e,l={root:["root",o&&s&&"labelIcon",`textColor${(0,SC.A)(n)}`,r&&"fullWidth",i&&"wrapped",a&&"selected",c&&"disabled"],iconWrapper:["iconWrapper"]};return(0,bC.A)(l,LP,t)})(b),S=c&&d&&t.isValidElement(c)?t.cloneElement(c,{className:(0,Pe.A)(w.iconWrapper,c.props.className)}):c;return(0,We.jsxs)(UP,(0,ke.A)({focusRipple:!s,className:(0,Pe.A)(w.root,i),ref:n,role:"tab","aria-selected":m,disabled:o,onClick:e=>{!m&&h&&h(e,y),p&&p(e)},onFocus:e=>{g&&!m&&h&&h(e,y),f&&f(e)},ownerState:b,tabIndex:m?0:-1},E,{children:["top"===l||"start"===l?(0,We.jsxs)(t.Fragment,{children:[S,d]}):(0,We.jsxs)(t.Fragment,{children:[d,S]}),u]}))})),FP=VP,BP=(0,t.createContext)({db:null,loading:!1,error:null}),WP=()=>{const e=(0,t.useContext)(BP);if(void 0===e)throw new Error("useFirestore must be used within a FirestoreProvider");return null===e.db&&console.warn("useFirestore called before db was initialized or initialization failed"),e},zP=e=>{let{children:t}=e;const n={db:KS,loading:!1,error:null};return(0,We.jsx)(BP.Provider,{value:n,children:t})};var HP={};function GP(){return HP}function qP(e){return qP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qP(e)}function KP(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function $P(e){KP(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===qP(e)&&"[object Date]"===t?new Date(e.getTime()):"number"===typeof e||"[object Number]"===t?new Date(e):("string"!==typeof e&&"[object String]"!==t||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function YP(e,t){KP(2,arguments);var n=$P(e),r=$P(t),i=n.getTime()-r.getTime();return i<0?-1:i>0?1:i}function XP(e){KP(1,arguments);var t=$P(e);return t.setHours(23,59,59,999),t}function JP(e){KP(1,arguments);var t=$P(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function QP(e,t){KP(2,arguments);var n,r=$P(e),i=$P(t),o=YP(r,i),s=Math.abs(function(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return 12*(n.getFullYear()-r.getFullYear())+(n.getMonth()-r.getMonth())}(r,i));if(s<1)n=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*s);var a=YP(r,i)===-o;(function(e){KP(1,arguments);var t=$P(e);return XP(t).getTime()===JP(t).getTime()})($P(e))&&1===s&&1===YP(e,i)&&(a=!1),n=o*(s-Number(a))}return 0===n?0:n}function ZP(e,t){return KP(2,arguments),$P(e).getTime()-$P(t).getTime()}var eD={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}};function tD(e){return e?eD[e]:eD.trunc}function nD(e,t,n){KP(2,arguments);var r=ZP(e,t)/1e3;return tD(null===n||void 0===n?void 0:n.roundingMethod)(r)}var rD={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const iD=function(e,t,n){var r,i=rD[e];return r="string"===typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function oD(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}var sD={date:oD({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:oD({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:oD({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var aD={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function cD(e){return function(t,n){var r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,o=null!==n&&void 0!==n&&n.width?String(n.width):i;r=e.formattingValues[o]||e.formattingValues[i]}else{var s=e.defaultWidth,a=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[a]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function lD(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],o=t.match(i);if(!o)return null;var s,a=o[0],c=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(c)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return}(c,(function(e){return e.test(a)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n;return}(c,(function(e){return e.test(a)}));return s=e.valueCallback?e.valueCallback(l):l,{value:s=n.valueCallback?n.valueCallback(s):s,rest:t.slice(a.length)}}}var uD;const dD={code:"en-US",formatDistance:iD,formatLong:sD,formatRelative:function(e,t,n,r){return aD[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:cD({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:cD({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:cD({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:cD({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:cD({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(uD={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(uD.matchPattern);if(!n)return null;var r=n[0],i=e.match(uD.parsePattern);if(!i)return null;var o=uD.valueCallback?uD.valueCallback(i[0]):i[0];return{value:o=t.valueCallback?t.valueCallback(o):o,rest:e.slice(r.length)}}),era:lD({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:lD({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:lD({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:lD({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:lD({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},hD=dD;function pD(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function fD(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}var mD=43200;function gD(e,t,n){var r,i;KP(2,arguments);var o=GP(),s=null!==(r=null!==(i=null===n||void 0===n?void 0:n.locale)&&void 0!==i?i:o.locale)&&void 0!==r?r:hD;if(!s.formatDistance)throw new RangeError("locale must contain formatDistance property");var a=YP(e,t);if(isNaN(a))throw new RangeError("Invalid time value");var c,l,u=pD(pD({},n),{addSuffix:Boolean(null===n||void 0===n?void 0:n.addSuffix),comparison:a});a>0?(c=$P(t),l=$P(e)):(c=$P(e),l=$P(t));var d,h=nD(l,c),p=(fD(l)-fD(c))/1e3,f=Math.round((h-p)/60);if(f<2)return null!==n&&void 0!==n&&n.includeSeconds?h<5?s.formatDistance("lessThanXSeconds",5,u):h<10?s.formatDistance("lessThanXSeconds",10,u):h<20?s.formatDistance("lessThanXSeconds",20,u):h<40?s.formatDistance("halfAMinute",0,u):h<60?s.formatDistance("lessThanXMinutes",1,u):s.formatDistance("xMinutes",1,u):0===f?s.formatDistance("lessThanXMinutes",1,u):s.formatDistance("xMinutes",f,u);if(f<45)return s.formatDistance("xMinutes",f,u);if(f<90)return s.formatDistance("aboutXHours",1,u);if(f<1440){var m=Math.round(f/60);return s.formatDistance("aboutXHours",m,u)}if(f<2520)return s.formatDistance("xDays",1,u);if(f<mD){var g=Math.round(f/1440);return s.formatDistance("xDays",g,u)}if(f<86400)return d=Math.round(f/mD),s.formatDistance("aboutXMonths",d,u);if((d=QP(l,c))<12){var v=Math.round(f/mD);return s.formatDistance("xMonths",v,u)}var y=d%12,_=Math.floor(d/12);return y<3?s.formatDistance("aboutXYears",_,u):y<9?s.formatDistance("overXYears",_,u):s.formatDistance("almostXYears",_+1,u)}function vD(e,t){return KP(1,arguments),gD(e,Date.now(),t)}const yD=e=>{try{return vD(e)}catch(k_){return e instanceof Date?e.toLocaleString():new Date(e).toLocaleString()}},_D=e=>{if(!e)return"";try{return e.toDate?yD(e.toDate()):e instanceof Date?yD(e):yD(new Date(e))}catch(k_){return console.error("Error formatting timestamp:",k_),""}};var ED=n(2183),bD=n(6832),wD=n(8154),SD=n(6319),TD=n(9693),CD=n(4453),AD=n(7988);const RD=["addEndListener","appear","children","container","direction","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function ID(e,t,n){var r;const i=function(e,t,n){const r=t.getBoundingClientRect(),i=n&&n.getBoundingClientRect(),o=(0,qR.A)(t);let s;if(t.fakeTransform)s=t.fakeTransform;else{const e=o.getComputedStyle(t);s=e.getPropertyValue("-webkit-transform")||e.getPropertyValue("transform")}let a=0,c=0;if(s&&"none"!==s&&"string"===typeof s){const e=s.split("(")[1].split(")")[0].split(",");a=parseInt(e[4],10),c=parseInt(e[5],10)}return"left"===e?i?`translateX(${i.right+a-r.left}px)`:`translateX(${o.innerWidth+a-r.left}px)`:"right"===e?i?`translateX(-${r.right-i.left-a}px)`:`translateX(-${r.left+r.width-a}px)`:"up"===e?i?`translateY(${i.bottom+c-r.top}px)`:`translateY(${o.innerHeight+c-r.top}px)`:i?`translateY(-${r.top-i.top+r.height-c}px)`:`translateY(-${r.top+r.height-c}px)`}(e,t,"function"===typeof(r=n)?r():r);i&&(t.style.webkitTransform=i,t.style.transform=i)}const xD=t.forwardRef((function(e,n){const r=iI(),i={enter:r.transitions.easing.easeOut,exit:r.transitions.easing.sharp},o={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:s,appear:a=!0,children:c,container:l,direction:u="down",easing:d=i,in:h,onEnter:p,onEntered:f,onEntering:m,onExit:g,onExited:v,onExiting:y,style:_,timeout:E=o,TransitionComponent:b=rI}=e,w=(0,Ne.A)(e,RD),S=t.useRef(null),T=(0,gA.A)(KR(c),S,n),C=e=>t=>{e&&(void 0===t?e(S.current):e(S.current,t))},A=C(((e,t)=>{ID(u,e,l),oI(e),p&&p(e,t)})),R=C(((e,t)=>{const n=sI({timeout:E,style:_,easing:d},{mode:"enter"});e.style.webkitTransition=r.transitions.create("-webkit-transform",(0,ke.A)({},n)),e.style.transition=r.transitions.create("transform",(0,ke.A)({},n)),e.style.webkitTransform="none",e.style.transform="none",m&&m(e,t)})),I=C(f),x=C(y),O=C((e=>{const t=sI({timeout:E,style:_,easing:d},{mode:"exit"});e.style.webkitTransition=r.transitions.create("-webkit-transform",t),e.style.transition=r.transitions.create("transform",t),ID(u,e,l),g&&g(e)})),k=C((e=>{e.style.webkitTransition="",e.style.transition="",v&&v(e)})),N=t.useCallback((()=>{S.current&&ID(u,S.current,l)}),[u,l]);return t.useEffect((()=>{if(h||"down"===u||"right"===u)return;const e=(0,GR.A)((()=>{S.current&&ID(u,S.current,l)})),t=(0,qR.A)(S.current);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[u,h,l]),t.useEffect((()=>{h||N()}),[h,N]),(0,We.jsx)(b,(0,ke.A)({nodeRef:S,onEnter:A,onEntered:I,onEntering:R,onExit:O,onExited:k,onExiting:x,addEndListener:e=>{s&&s(S.current,e)},appear:a,in:h,timeout:E},w,{children:(e,n)=>t.cloneElement(c,(0,ke.A)({ref:T,style:(0,ke.A)({visibility:"exited"!==e||h?void 0:"hidden"},_,c.props.style)},n))}))})),OD=xD,kD=t.forwardRef((function(e,t){return(0,We.jsx)(OD,{direction:"up",ref:t,...e})}));function ND(e){const{children:t,value:n,index:r,...i}=e;return(0,We.jsx)("div",{role:"tabpanel",hidden:n!==r,id:`feed-tabpanel-${r}`,"aria-labelledby":`feed-tab-${r}`,...i,children:n===r&&(0,We.jsx)(Je,{sx:{py:3},children:t})})}const PD=()=>{const{currentUser:e,loading:n}=ZT(),{db:r}=WP(),[i,o]=(Q(),(0,t.useState)([])),[s,a]=(0,t.useState)([]),[c,l]=(0,t.useState)(!0),[u,d]=(0,t.useState)(null),[h,p]=(0,t.useState)([]),[f,m]=(0,t.useState)(null),[g,v]=(0,t.useState)(!1),[y,_]=(0,t.useState)(null),[E,b]=(0,t.useState)(!1),[w,S]=(0,t.useState)(""),T=(0,t.useRef)(null),[C,A]=(0,t.useState)([]),[R,I]=(0,t.useState)(!1),[x,O]=(0,t.useState)(null),[k,N]=(0,t.useState)(null),P=Boolean(x),[D,L]=(0,t.useState)(!1),[M,j]=(0,t.useState)(!1),[U,V]=(0,t.useState)(0);(0,t.useEffect)((()=>{if(n||!e||!r)return;console.log("Feed: Auth finished, currentUser exists. Loading user profile...");(async()=>{try{const t=await uv(eg(r,"users",e.uid));if(!t.exists())return d("User profile not found"),void l(!1);const n=t.data();m(n),p(n.connections||[]),v(!0),l(!1)}catch(u){console.error("Error loading user profile:",u),d("Failed to load user profile"),l(!1)}})()}),[e,r,n]),(0,t.useEffect)((()=>{if(!r||!e)return void l(!1);(async()=>{try{j(!0);const t=Zm(r,"users",e.uid,"following"),n=(await hv(t)).docs.map((e=>e.id)).filter(Boolean),i=[...n,e.uid].filter(Boolean);if(0===i.length)return o([]),l(!1),void j(!1);const s=vv(Gg(Zm(r,"posts"),Kg("authorId","in",i),Xg("timestamp","desc")),(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));o(t),j(!1),l(!1)}));return()=>s()}catch(u){console.error("Error setting up posts listener:",u),d("Failed to load posts"),j(!1),l(!1)}})()}),[r,e]),(0,t.useEffect)((()=>{if(!r)return;(async()=>{try{j(!0);const e=vv(Gg(Zm(r,"posts"),Xg("timestamp","desc"),Qg(50)),(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));a(t),j(!1)}));return()=>e()}catch(u){console.error("Error setting up discover posts listener:",u),d("Failed to load discover posts"),j(!1)}})()}),[r]);const F=async t=>{if(!r||!e)return;console.log(`handleLike triggered for postId: ${t} by user: ${e.uid}`);const n=eg(r,"posts",t),i=Zm(r,"notifications"),o=e.uid;try{await Cv(r,(async r=>{console.log("[Transaction] Getting post document...");const i=await r.get(n);if(!i.exists())throw console.error("[Transaction] Post document not found!"),new Error("Post not found");const s=i.data();let a=s.likedBy||[],c=null;var l,u;a.includes(o)?(console.log("[Transaction] User already liked. Unliking..."),a=a.filter((e=>e!==o)),r.update(n,{likedBy:a,likes:a.length}),console.log("[Transaction] Unlike update prepared.")):(console.log("[Transaction] User has not liked yet. Liking..."),a=[...a,o],r.update(n,{likedBy:a,likes:a.length}),console.log("[Transaction] Like update prepared."),s.authorId!==o&&(c={type:"like",senderId:o,senderName:e.displayName||(null===(l=e.email)||void 0===l?void 0:l.split("@")[0])||"Someone",senderAvatar:e.photoURL||"",recipientId:s.authorId,postId:t,content:`${e.displayName||(null===(u=e.email)||void 0===u?void 0:u.split("@")[0])||"Someone"} liked your post`,createdAt:Av(),isRead:!1},console.log("[Transaction] Notification data prepared.")))})),console.log("Transaction completed successfully.");const c=await uv(n);if(c.exists()){var s;const r=c.data();if(r.authorId!==o&&(null===(s=r.likedBy)||void 0===s||!s.includes(o))){const r=await uv(n);if(r.exists()){const n=r.data();if((n.likedBy||[]).includes(o)&&n.authorId!==o){var a;console.log("Creating notification for post owner (post-transaction)...");const r=e.displayName||(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"Someone",s={type:"like",senderId:o,senderName:r,senderAvatar:e.photoURL||"",recipientId:n.authorId,postId:t,content:`${r} liked your post`,createdAt:Av(),isRead:!1};await gv(i,s),console.log("Notification created successfully (post-transaction).")}}}}else console.log("Not creating notification (user unliked or liked own post).")}catch(u){console.error("Error in like transaction or notification creation:",u),bT.error("Failed to update like")}},B=async t=>{if(!e||!r)return void bT.error("You must be logged in to repost");const n=i.find((e=>e.id===t));if(!n)return void bT.error("Post not found");const s=i.some((n=>n.isRepost&&n.id===t&&n.repostedById===e.uid));try{if(s)A((e=>[...e,{postId:t,added:!1}])),o((n=>n.map((e=>e.id!==t||e.isRepost?e:{...e,reposts:Math.max(0,(e.reposts||0)-1)})).filter((n=>!(n.isRepost&&n.id===t&&n.repostedById===e.uid))))),bT.success("Repost removed");else{if(A((e=>[...e,{postId:t,added:!0}])),o((r=>[{...n,timestamp:rc.now(),isRepost:!0,repostedById:e.uid,reposts:(n.reposts||0)+1},...r.map((e=>e.id!==t||e.isRepost?e:{...e,reposts:(e.reposts||0)+1}))])),n.authorId!==e.uid){var a;const i=e.displayName||(null===(a=e.email)||void 0===a?void 0:a.split("@")[0])||"Someone",o={type:"repost",senderId:e.uid,senderName:i,senderAvatar:e.photoURL||"",recipientId:n.authorId,postId:t,content:`${i} reposted your post`,createdAt:Av(),isRead:!1};await gv(Zm(r,"notifications"),o)}bT.success("Post reposted!")}await G()}catch(u){console.error("Error handling repost:",u),bT.error("Failed to process repost. Changes will sync later.")}},W=async t=>{if(r&&e)try{const n=eg(r,"posts",t),i=await uv(n);if(i.exists()){const r=i.data();if(r.authorId!==e.uid)throw new Error("You can only delete your own posts");if(r.imageUrl)try{const e=u_(YS,r.imageUrl);await function(e){return Qy(e=Zt(e))}(e)}catch(u){console.error("Error deleting image:",u)}await mv(n),o((e=>e.filter((e=>e.id!==t)))),bT.success("Post deleted successfully")}}catch(u){console.error("Error deleting post:",u),d("Failed to delete post"),bT.error("Failed to delete post")}},z=()=>{O(null),N(null)},H=t=>{var n,r;return(0,We.jsxs)(sO,{divider:!0,sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"},mb:2,borderRadius:2,backgroundColor:"background.paper",boxShadow:1},onClick:()=>{_(t),b(!0)},children:[t.isRepost&&(0,We.jsx)(Je,{sx:{position:"absolute",top:-12,left:20,backgroundColor:"primary.main",color:"white",borderRadius:1,px:1,py:.5,fontSize:"0.75rem",zIndex:1},children:"Reposted"}),(0,We.jsx)(dO,{children:(0,We.jsx)(Ie,{to:`/profile/${t.authorId}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:t.authorAvatar||void 0})})}),(0,We.jsx)(Px,{primary:(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,We.jsxs)(Je,{children:[(0,We.jsx)(Ie,{to:`/profile/${t.authorId}`,style:{textDecoration:"none",color:"inherit"},children:(0,We.jsx)(mA,{variant:"subtitle1",component:"span",sx:{"&:hover":{textDecoration:"underline"}},children:t.authorName})}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",component:"span",sx:{ml:1},children:_D(t.timestamp)}),!t.isRepost&&t.reposts>0&&(0,We.jsxs)(mA,{variant:"body2",color:"text.secondary",component:"span",sx:{ml:1},children:["\u2022 ",t.reposts," repost",1!==t.reposts?"s":""]})]}),t.authorId===(null===e||void 0===e?void 0:e.uid)&&(0,We.jsx)(rR,{size:"small",onClick:e=>{return n=e,r=t.id,n.stopPropagation(),O(n.currentTarget),void N(r);var n,r},children:(0,We.jsx)(CD.A,{})})]}),secondary:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"body1",sx:{mt:1},children:t.content}),t.isEdited&&(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:"(edited)"}),(0,We.jsxs)(Je,{sx:{mt:2},children:[t.comments&&t.comments.length>0&&(0,We.jsxs)(Je,{sx:{backgroundColor:"background.default",borderRadius:1,p:1,mt:1},children:[t.comments.slice(0,2).map(((e,t)=>(0,We.jsxs)(Je,{sx:{mb:1},children:[(0,We.jsx)(mA,{variant:"subtitle2",component:"span",children:e.authorName}),(0,We.jsx)(mA,{variant:"body2",component:"span",sx:{ml:1},children:e.content})]},t))),t.comments.length>2&&(0,We.jsxs)(mA,{variant:"body2",color:"primary",sx:{cursor:"pointer"},onClick:e=>{e.stopPropagation(),_(t),b(!0)},children:["View all ",t.comments.length," comments"]})]}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1,mt:2},children:[(0,We.jsxs)(rR,{edge:"end","aria-label":"likes",onClick:e=>{e.stopPropagation(),F(t.id)},children:[(0,We.jsx)(ED.A,{color:null!==(n=t.likedBy)&&void 0!==n&&n.includes((null===e||void 0===e?void 0:e.uid)||"")?"error":"inherit"}),(0,We.jsx)(mA,{variant:"body2",component:"span",sx:{ml:1},children:t.likes||0})]}),(0,We.jsxs)(rR,{edge:"end","aria-label":"repost",onClick:e=>{e.stopPropagation(),B(t.id)},children:[(0,We.jsx)(bD.A,{color:t.isRepost&&t.repostedById===(null===e||void 0===e?void 0:e.uid)?"primary":"inherit"}),(0,We.jsx)(mA,{variant:"body2",component:"span",sx:{ml:1},children:t.reposts||0})]}),(0,We.jsxs)(rR,{edge:"end","aria-label":"comment",onClick:e=>{e.stopPropagation(),_(t),b(!0)},children:[(0,We.jsx)(wD.A,{}),(0,We.jsx)(mA,{variant:"body2",component:"span",sx:{ml:1},children:(null===(r=t.comments)||void 0===r?void 0:r.length)||0})]})]})]})]})})]},`${t.id}-${t.isRepost?"repost":"post"}`)},G=async()=>{if(r&&e&&0!==C.length){I(!0);try{const t=Ov(r),n=Zm(r,"reposts");for(const r of C){const{postId:i,added:o}=r,s=eg(n,`${e.uid}_${i}`);o?t.set(s,{originalPostId:i,userId:e.uid,timestamp:rc.now()}):t.delete(s)}await t.commit(),A([]),bT.success("Reposts synced successfully!")}catch(u){console.error("Error syncing reposts:",u),bT.error("Failed to sync reposts. Try again later.")}finally{I(!1)}}};return n?(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,We.jsx)(FN,{})}):e?u?(0,We.jsx)(Je,{sx:{p:3,textAlign:"center"},children:(0,We.jsx)(mA,{color:"error",children:u})}):(0,We.jsxs)(sP,{maxWidth:"lg",children:[(0,We.jsxs)(Je,{sx:{width:"100%"},children:[(0,We.jsx)(Je,{sx:{borderBottom:0,position:"sticky",top:0,backgroundColor:"background.paper",zIndex:1e3,mb:2},children:(0,We.jsxs)(DP,{value:U,onChange:(e,t)=>{V(t)},variant:"fullWidth",sx:{"& .MuiTab-root":{fontWeight:"bold",fontSize:"1rem"}},children:[(0,We.jsx)(FP,{label:"Following"}),(0,We.jsx)(FP,{label:"Discover"})]})}),(0,We.jsx)(ND,{value:U,index:0,children:M?(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,We.jsx)(FN,{})}):0===i.length?(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",align:"center",children:"No posts yet. Follow some users to see their posts!"}):(0,We.jsx)(DR,{children:i.map(H)})}),(0,We.jsx)(ND,{value:U,index:1,children:M?(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,We.jsx)(FN,{})}):0===s.length?(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",align:"center",children:"No posts to discover yet."}):(0,We.jsx)(DR,{children:s.map(H)})})]}),(()=>{var t,n;return y?(0,We.jsxs)(wO,{fullScreen:!0,open:E,onClose:()=>b(!1),TransitionComponent:kD,children:[(0,We.jsx)(jC,{sx:{position:"relative"},children:(0,We.jsxs)(WC,{children:[(0,We.jsx)(rR,{edge:"start",color:"inherit",onClick:()=>b(!1),"aria-label":"close",children:(0,We.jsx)(SD.A,{})}),(0,We.jsx)(mA,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:y.isRepost?"Reposted Post":"Post"})]})}),(0,We.jsxs)(Je,{sx:{p:2},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,We.jsx)(Ie,{to:`/profile/${y.authorId}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:y.authorAvatar||void 0,sx:{width:48,height:48,mr:2}})}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(Ie,{to:`/profile/${y.authorId}`,style:{textDecoration:"none",color:"inherit"},children:(0,We.jsx)(mA,{variant:"h6",sx:{"&:hover":{textDecoration:"underline"}},children:y.authorName})}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:_D(y.timestamp)})]})]}),(0,We.jsx)(mA,{variant:"body1",sx:{mb:3},children:y.content}),y.imageUrl&&(0,We.jsx)(Je,{sx:{mb:3,display:"flex",justifyContent:"center"},children:(0,We.jsx)("img",{src:y.imageUrl,alt:"Post attachment",style:{maxWidth:"100%",maxHeight:"400px",borderRadius:"8px"}})}),(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,We.jsxs)(RR,{startIcon:(0,We.jsx)(ED.A,{color:null!==(t=y.likedBy)&&void 0!==t&&t.includes((null===e||void 0===e?void 0:e.uid)||"")?"error":"inherit"}),onClick:()=>F(y.id),children:[y.likes||0," Likes"]}),(0,We.jsxs)(RR,{startIcon:(0,We.jsx)(bD.A,{color:y.isRepost&&y.repostedById===(null===e||void 0===e?void 0:e.uid)?"primary":"inherit"}),onClick:()=>B(y.id),children:[y.reposts||0," Reposts"]}),(0,We.jsxs)(RR,{startIcon:(0,We.jsx)(wD.A,{}),onClick:()=>{var e;return null===(e=T.current)||void 0===e?void 0:e.focus()},children:[(null===(n=y.comments)||void 0===n?void 0:n.length)||0," Comments"]})]}),(0,We.jsx)(Ux,{sx:{mb:3}}),(0,We.jsx)(mA,{variant:"h6",sx:{mb:2},children:"Comments"}),y.comments&&y.comments.length>0?(0,We.jsx)(DR,{children:y.comments.map(((e,t)=>(0,We.jsxs)(sO,{alignItems:"flex-start",divider:!0,children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.authorAvatar||void 0})}),(0,We.jsx)(Px,{primary:(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,We.jsx)(mA,{variant:"subtitle2",children:e.authorName}),(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:e.timestamp?_D(e.timestamp)+" ago":""})]}),secondary:(0,We.jsx)(mA,{component:"span",variant:"body2",color:"text.primary",sx:{display:"inline",mt:1},children:e.content})})]},t)))}):(0,We.jsx)(mA,{color:"text.secondary",sx:{mb:2},children:"No comments yet. Be the first to comment!"}),(0,We.jsxs)(Je,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,bgcolor:"background.paper",boxShadow:3,zIndex:10,display:"flex",gap:1},children:[(0,We.jsx)(CN,{fullWidth:!0,variant:"outlined",placeholder:"Add a comment...",value:w,onChange:e=>S(e.target.value),inputRef:T,InputProps:{sx:{borderRadius:4}}}),(0,We.jsx)(rR,{color:"primary",disabled:!w.trim(),onClick:()=>{w.trim()&&((async(t,n)=>{if(r&&e)try{const s=eg(r,"posts",t),a=(await uv(s)).data(),c={content:n,authorId:e.uid,authorName:e.displayName||"Anonymous",authorAvatar:e.photoURL||"",timestamp:Av(),likes:0};if(await fv(s,{comments:Rv(c)}),a&&a.authorId!==e.uid){var i;const o=e.displayName||(null===(i=e.email)||void 0===i?void 0:i.split("@")[0])||"Someone",s={type:"comment",senderId:e.uid,senderName:o,senderAvatar:e.photoURL||"",recipientId:a.authorId,postId:t,content:`${o} commented on your post: "${n}"`,createdAt:Av(),isRead:!1};await gv(Zm(r,"notifications"),s)}const l=n.match(/@(\w+)/g);if(l){const i=Array.from(new Set(l));for(const s of i){const i=s.slice(1),c=Gg(Zm(r,"users"),Kg("username","==",i),Qg(1)),l=await hv(c);if(!l.empty){const i=l.docs[0];if(a&&i.id!==e.uid&&i.id!==a.authorId){var o;const s=e.displayName||(null===(o=e.email)||void 0===o?void 0:o.split("@")[0])||"Someone",a={type:"mention",senderId:e.uid,senderName:s,senderAvatar:e.photoURL||"",recipientId:i.id,postId:t,content:`${s} mentioned you in a comment: "${n}"`,createdAt:Av(),isRead:!1};await gv(Zm(r,"notifications"),a)}}}}}catch(u){console.error("Error adding comment:",u),d("Failed to add comment")}})(y.id,w.trim()),S(""))},children:(0,We.jsx)(TD.A,{})})]}),(0,We.jsx)(Je,{sx:{height:"64px"}})]})]}):null})(),0===C.length?null:(0,We.jsx)(Je,{sx:{position:"fixed",bottom:20,right:20,zIndex:1e3},children:(0,We.jsxs)(RR,{variant:"contained",color:"primary",onClick:G,startIcon:(0,We.jsx)(bD.A,{}),children:["Sync ",C.length," Repost",1!==C.length?"s":""]})}),(0,We.jsx)(px,{anchorEl:x,open:P,onClose:z,onClick:e=>e.stopPropagation(),children:(0,We.jsxs)(Cx,{onClick:()=>{k&&W(k),z()},children:[(0,We.jsx)(xx,{children:(0,We.jsx)(AD.A,{fontSize:"small"})}),"Delete Post"]})})]}):(0,We.jsx)(sP,{maxWidth:"md",children:(0,We.jsx)(Je,{sx:{py:4,textAlign:"center"},children:(0,We.jsx)(mA,{variant:"h6",children:"Please sign in to view your feed"})})})};function DD(e){return(0,AC.Ay)("MuiAlert",e)}const LD=(0,Ke.A)("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),MD=(0,zC.A)((0,We.jsx)("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),jD=(0,zC.A)((0,We.jsx)("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),UD=(0,zC.A)((0,We.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),VD=(0,zC.A)((0,We.jsx)("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),FD=(0,zC.A)((0,We.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),BD=["action","children","className","closeText","color","components","componentsProps","icon","iconMapping","onClose","role","severity","slotProps","slots","variant"],WD=(0,wC.Ay)(kC,{name:"MuiAlert",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`${n.variant}${(0,SC.A)(n.color||n.severity)}`]]}})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?TC.e$:TC.a,r="light"===t.palette.mode?TC.a:TC.e$;return(0,ke.A)({},t.typography.body2,{backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.light})).map((e=>{let[i]=e;return{props:{colorSeverity:i,variant:"standard"},style:{color:t.vars?t.vars.palette.Alert[`${i}Color`]:n(t.palette[i].light,.6),backgroundColor:t.vars?t.vars.palette.Alert[`${i}StandardBg`]:r(t.palette[i].light,.9),[`& .${LD.icon}`]:t.vars?{color:t.vars.palette.Alert[`${i}IconColor`]}:{color:t.palette[i].main}}}})),...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.light})).map((e=>{let[r]=e;return{props:{colorSeverity:r,variant:"outlined"},style:{color:t.vars?t.vars.palette.Alert[`${r}Color`]:n(t.palette[r].light,.6),border:`1px solid ${(t.vars||t).palette[r].light}`,[`& .${LD.icon}`]:t.vars?{color:t.vars.palette.Alert[`${r}IconColor`]}:{color:t.palette[r].main}}}})),...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.dark})).map((e=>{let[n]=e;return{props:{colorSeverity:n,variant:"filled"},style:(0,ke.A)({fontWeight:t.typography.fontWeightMedium},t.vars?{color:t.vars.palette.Alert[`${n}FilledColor`],backgroundColor:t.vars.palette.Alert[`${n}FilledBg`]}:{backgroundColor:"dark"===t.palette.mode?t.palette[n].dark:t.palette[n].main,color:t.palette.getContrastText(t.palette[n].main)})}}))]})})),zD=(0,wC.Ay)("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(e,t)=>t.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),HD=(0,wC.Ay)("div",{name:"MuiAlert",slot:"Message",overridesResolver:(e,t)=>t.message})({padding:"8px 0",minWidth:0,overflow:"auto"}),GD=(0,wC.Ay)("div",{name:"MuiAlert",slot:"Action",overridesResolver:(e,t)=>t.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),qD={success:(0,We.jsx)(MD,{fontSize:"inherit"}),warning:(0,We.jsx)(jD,{fontSize:"inherit"}),error:(0,We.jsx)(UD,{fontSize:"inherit"}),info:(0,We.jsx)(VD,{fontSize:"inherit"})},KD=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiAlert"}),{action:r,children:i,className:o,closeText:s="Close",color:a,components:c={},componentsProps:l={},icon:u,iconMapping:d=qD,onClose:h,role:p="alert",severity:f="success",slotProps:m={},slots:g={},variant:v="standard"}=n,y=(0,Ne.A)(n,BD),_=(0,ke.A)({},n,{color:a,severity:f,variant:v,colorSeverity:a||f}),E=(e=>{const{variant:t,color:n,severity:r,classes:i}=e,o={root:["root",`color${(0,SC.A)(n||r)}`,`${t}${(0,SC.A)(n||r)}`,`${t}`],icon:["icon"],message:["message"],action:["action"]};return(0,bC.A)(o,DD,i)})(_),b={slots:(0,ke.A)({closeButton:c.CloseButton,closeIcon:c.CloseIcon},g),slotProps:(0,ke.A)({},l,m)},[w,S]=nA("closeButton",{elementType:rR,externalForwardedProps:b,ownerState:_}),[T,C]=nA("closeIcon",{elementType:FD,externalForwardedProps:b,ownerState:_});return(0,We.jsxs)(WD,(0,ke.A)({role:p,elevation:0,ownerState:_,className:(0,Pe.A)(E.root,o),ref:t},y,{children:[!1!==u?(0,We.jsx)(zD,{ownerState:_,className:E.icon,children:u||d[f]||qD[f]}):null,(0,We.jsx)(HD,{ownerState:_,className:E.message,children:i}),null!=r?(0,We.jsx)(GD,{ownerState:_,className:E.action,children:r}):null,null==r&&h?(0,We.jsx)(GD,{ownerState:_,className:E.action,children:(0,We.jsx)(w,(0,ke.A)({size:"small","aria-label":s,title:s,color:"inherit",onClick:h},S,{children:(0,We.jsx)(T,(0,ke.A)({fontSize:"small"},C))}))}):null]}))})),$D=KD;var YD=n(8286);const XD=t.createContext();function JD(e){return(0,AC.Ay)("MuiGrid",e)}const QD=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],ZD=(0,Ke.A)("MuiGrid",["root","container","item","zeroMinWidth",...[0,1,2,3,4,5,6,7,8,9,10].map((e=>`spacing-xs-${e}`)),...["column-reverse","column","row-reverse","row"].map((e=>`direction-xs-${e}`)),...["nowrap","wrap-reverse","wrap"].map((e=>`wrap-xs-${e}`)),...QD.map((e=>`grid-xs-${e}`)),...QD.map((e=>`grid-sm-${e}`)),...QD.map((e=>`grid-md-${e}`)),...QD.map((e=>`grid-lg-${e}`)),...QD.map((e=>`grid-xl-${e}`))]),eL=ZD,tL=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function nL(e){const t=parseFloat(e);return`${t}${String(e).replace(String(t),"")||"px"}`}function rL(e){let{breakpoints:t,values:n}=e,r="";Object.keys(n).forEach((e=>{""===r&&0!==n[e]&&(r=e)}));const i=Object.keys(t).sort(((e,n)=>t[e]-t[n]));return i.slice(0,i.indexOf(r))}const iL=(0,wC.Ay)("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{container:r,direction:i,item:o,spacing:s,wrap:a,zeroMinWidth:c,breakpoints:l}=n;let u=[];r&&(u=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||e<=0)return[];if("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e)return[n[`spacing-xs-${String(e)}`]];const r=[];return t.forEach((t=>{const i=e[t];Number(i)>0&&r.push(n[`spacing-${t}-${String(i)}`])})),r}(s,l,t));const d=[];return l.forEach((e=>{const r=n[e];r&&d.push(t[`grid-${e}-${String(r)}`])})),[t.root,r&&t.container,o&&t.item,c&&t.zeroMinWidth,...u,"row"!==i&&t[`direction-xs-${String(i)}`],"wrap"!==a&&t[`wrap-xs-${String(a)}`],...d]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},"wrap"!==t.wrap&&{flexWrap:t.wrap})}),(function(e){let{theme:t,ownerState:n}=e;const r=(0,YD.kW)({values:n.direction,breakpoints:t.breakpoints.values});return(0,YD.NI)({theme:t},r,(e=>{const t={flexDirection:e};return 0===e.indexOf("column")&&(t[`& > .${eL.item}`]={maxWidth:"none"}),t}))}),(function(e){let{theme:t,ownerState:n}=e;const{container:r,rowSpacing:i}=n;let o={};if(r&&0!==i){const e=(0,YD.kW)({values:i,breakpoints:t.breakpoints.values});let n;"object"===typeof e&&(n=rL({breakpoints:t.breakpoints.values,values:e})),o=(0,YD.NI)({theme:t},e,((e,r)=>{var i;const o=t.spacing(e);return"0px"!==o?{marginTop:`-${nL(o)}`,[`& > .${eL.item}`]:{paddingTop:nL(o)}}:null!=(i=n)&&i.includes(r)?{}:{marginTop:0,[`& > .${eL.item}`]:{paddingTop:0}}}))}return o}),(function(e){let{theme:t,ownerState:n}=e;const{container:r,columnSpacing:i}=n;let o={};if(r&&0!==i){const e=(0,YD.kW)({values:i,breakpoints:t.breakpoints.values});let n;"object"===typeof e&&(n=rL({breakpoints:t.breakpoints.values,values:e})),o=(0,YD.NI)({theme:t},e,((e,r)=>{var i;const o=t.spacing(e);return"0px"!==o?{width:`calc(100% + ${nL(o)})`,marginLeft:`-${nL(o)}`,[`& > .${eL.item}`]:{paddingLeft:nL(o)}}:null!=(i=n)&&i.includes(r)?{}:{width:"100%",marginLeft:0,[`& > .${eL.item}`]:{paddingLeft:0}}}))}return o}),(function(e){let t,{theme:n,ownerState:r}=e;return n.breakpoints.keys.reduce(((e,i)=>{let o={};if(r[i]&&(t=r[i]),!t)return e;if(!0===t)o={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if("auto"===t)o={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const s=(0,YD.kW)({values:r.columns,breakpoints:n.breakpoints.values}),a="object"===typeof s?s[i]:s;if(void 0===a||null===a)return e;const c=Math.round(t/a*1e8)/1e6+"%";let l={};if(r.container&&r.item&&0!==r.columnSpacing){const e=n.spacing(r.columnSpacing);if("0px"!==e){const t=`calc(${c} + ${nL(e)})`;l={flexBasis:t,maxWidth:t}}}o=(0,ke.A)({flexBasis:c,flexGrow:0,maxWidth:c},l)}return 0===n.breakpoints.values[i]?Object.assign(e,o):e[n.breakpoints.up(i)]=o,e}),{})}));const oL=e=>{const{classes:t,container:n,direction:r,item:i,spacing:o,wrap:s,zeroMinWidth:a,breakpoints:c}=e;let l=[];n&&(l=function(e,t){if(!e||e<=0)return[];if("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e)return[`spacing-xs-${String(e)}`];const n=[];return t.forEach((t=>{const r=e[t];if(Number(r)>0){const e=`spacing-${t}-${String(r)}`;n.push(e)}})),n}(o,c));const u=[];c.forEach((t=>{const n=e[t];n&&u.push(`grid-${t}-${String(n)}`)}));const d={root:["root",n&&"container",i&&"item",a&&"zeroMinWidth",...l,"row"!==r&&`direction-xs-${String(r)}`,"wrap"!==s&&`wrap-xs-${String(s)}`,...u]};return(0,bC.A)(d,JD,t)},sL=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiGrid"}),{breakpoints:i}=iI(),o=(0,Me.A)(r),{className:s,columns:a,columnSpacing:c,component:l="div",container:u=!1,direction:d="row",item:h=!1,rowSpacing:p,spacing:f=0,wrap:m="wrap",zeroMinWidth:g=!1}=o,v=(0,Ne.A)(o,tL),y=p||f,_=c||f,E=t.useContext(XD),b=u?a||12:E,w={},S=(0,ke.A)({},v);i.keys.forEach((e=>{null!=v[e]&&(w[e]=v[e],delete S[e])}));const T=(0,ke.A)({},o,{columns:b,container:u,direction:d,item:h,rowSpacing:y,columnSpacing:_,wrap:m,zeroMinWidth:g,spacing:f},w,{breakpoints:i.keys}),C=oL(T);return(0,We.jsx)(XD.Provider,{value:b,children:(0,We.jsx)(iL,(0,ke.A)({ownerState:T,className:(0,Pe.A)(C.root,s),as:l,ref:n},S))})}));const aL=sL;function cL(e){return(0,AC.Ay)("MuiLink",e)}const lL=(0,Ke.A)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var uL=n(2703);const dL={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},hL=e=>{let{theme:t,ownerState:n}=e;const r=(e=>dL[e]||e)(n.color),i=(0,uL.Yn)(t,`palette.${r}`,!1)||n.color,o=(0,uL.Yn)(t,`palette.${r}Channel`);return"vars"in t&&o?`rgba(${o} / 0.4)`:(0,TC.X4)(i,.4)},pL=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],fL=(0,wC.Ay)(mA,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`underline${(0,SC.A)(n.underline)}`],"button"===n.component&&t.button]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},"none"===n.underline&&{textDecoration:"none"},"hover"===n.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===n.underline&&(0,ke.A)({textDecoration:"underline"},"inherit"!==n.color&&{textDecorationColor:hL({theme:t,ownerState:n})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===n.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${lL.focusVisible}`]:{outline:"auto"}})})),mL=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiLink"}),{className:i,color:o="primary",component:s="a",onBlur:a,onFocus:c,TypographyClasses:l,underline:u="always",variant:d="inherit",sx:h}=r,p=(0,Ne.A)(r,pL),{isFocusVisibleRef:f,onBlur:m,onFocus:g,ref:v}=(0,yA.A)(),[y,_]=t.useState(!1),E=(0,gA.A)(n,v),b=(0,ke.A)({},r,{color:o,component:s,focusVisible:y,underline:u,variant:d}),w=(e=>{const{classes:t,component:n,focusVisible:r,underline:i}=e,o={root:["root",`underline${(0,SC.A)(i)}`,"button"===n&&"button",r&&"focusVisible"]};return(0,bC.A)(o,cL,t)})(b);return(0,We.jsx)(fL,(0,ke.A)({color:o,className:(0,Pe.A)(w.root,i),classes:l,component:s,onBlur:e=>{m(e),!1===f.current&&_(!1),a&&a(e)},onFocus:e=>{g(e),!0===f.current&&_(!0),c&&c(e)},ref:E,ownerState:b,variant:d,sx:[...Object.keys(dL).includes(o)?[]:[{color:o}],...Array.isArray(h)?h:[h]]},p))})),gL=mL,vL=()=>{const[e,n]=(0,t.useState)(""),[r,i]=(0,t.useState)(""),[o,s]=(0,t.useState)(!1),[a,c]=(0,t.useState)(null),{login:l,loading:u,error:d,setError:h,currentUser:p,userProfile:f}=ZT(),m=Q();(0,t.useEffect)((()=>{c(null)}),[e,r]),(0,t.useEffect)((()=>{p&&f&&f.sourceCodeSetupComplete&&m("/")}),[p,f,m]),(0,t.useEffect)((()=>{d&&c({type:"error",message:d})}),[d]);const g=u||o;return(0,We.jsx)(sP,{maxWidth:"xs",children:(0,We.jsxs)(kC,{elevation:0,sx:{mt:8,p:4},children:[(0,We.jsx)(mA,{component:"h1",variant:"h5",align:"center",sx:{mb:2},children:"Login to Side Eye"}),(0,We.jsxs)(Je,{component:"form",onSubmit:async t=>{if(t.preventDefault(),h&&h(null),c(null),!e.trim())return void c({type:"error",message:"Email is required"});if(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e.trim()))if(r)try{s(!0),c({type:"info",message:"Logging in..."}),await l(e.trim(),r),c({type:"success",message:"Login successful! Redirecting..."})}catch(n){console.error("Login component caught error:",n),"auth/too-many-requests"===n.code||"auth/too-many-requests"===n.message?c({type:"error",message:"Too many failed login attempts. Please try again later or reset your password."}):"auth/invalid-credential"===n.code||"auth/invalid-credential"===n.message?c({type:"error",message:"Invalid email or password. Please try again."}):"auth/invalid-email"===n.code||"auth/invalid-email"===n.message?c({type:"error",message:"Invalid email address. Please check the format."}):c({type:"error",message:n.message||"Login failed. Please try again."})}finally{s(!1)}else c({type:"error",message:"Password is required"});else c({type:"error",message:"Please enter a valid email address"})},noValidate:!0,sx:{mt:1},children:[(0,We.jsx)(CN,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:e,onChange:e=>n(e.target.value),disabled:g}),(0,We.jsx)(CN,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:r,onChange:e=>i(e.target.value),disabled:g}),a&&(0,We.jsx)($D,{severity:a.type,sx:{mt:2},children:a.message}),(0,We.jsx)(RR,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:g,children:g?(0,We.jsx)(FN,{size:24}):"Sign In"}),(0,We.jsxs)(aL,{container:!0,justifyContent:"space-between",children:[(0,We.jsx)(aL,{item:!0,children:(0,We.jsx)(gL,{component:Ie,to:"/reset-password",variant:"body2",children:"Forgot password?"})}),(0,We.jsx)(aL,{item:!0,children:(0,We.jsx)(gL,{component:Ie,to:"/register",variant:"body2",children:"Don't have an account? Sign Up"})})]})]})]})})};function yL(e){return(0,AC.Ay)("MuiInputAdornment",e)}const _L=(0,Ke.A)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var EL;const bL=["children","className","component","disablePointerEvents","disableTypography","position","variant"],wL=(0,wC.Ay)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`position${(0,SC.A)(n.position)}`],!0===n.disablePointerEvents&&t.disablePointerEvents,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active},"filled"===n.variant&&{[`&.${_L.positionStart}&:not(.${_L.hiddenLabel})`]:{marginTop:16}},"start"===n.position&&{marginRight:8},"end"===n.position&&{marginLeft:8},!0===n.disablePointerEvents&&{pointerEvents:"none"})})),SL=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiInputAdornment"}),{children:i,className:o,component:s="div",disablePointerEvents:a=!1,disableTypography:c=!1,position:l,variant:u}=r,d=(0,Ne.A)(r,bL),h=DO()||{};let p=u;u&&h.variant,h&&!p&&(p=h.variant);const f=(0,ke.A)({},r,{hiddenLabel:h.hiddenLabel,size:h.size,disablePointerEvents:a,position:l,variant:p}),m=(e=>{const{classes:t,disablePointerEvents:n,hiddenLabel:r,position:i,size:o,variant:s}=e,a={root:["root",n&&"disablePointerEvents",i&&`position${(0,SC.A)(i)}`,s,r&&"hiddenLabel",o&&`size${(0,SC.A)(o)}`]};return(0,bC.A)(a,yL,t)})(f);return(0,We.jsx)(PO.Provider,{value:null,children:(0,We.jsx)(wL,(0,ke.A)({as:s,ownerState:f,className:(0,Pe.A)(m.root,o),ref:n},d,{children:"string"!==typeof i||c?(0,We.jsxs)(t.Fragment,{children:["start"===l?EL||(EL=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"})):null,i]}):(0,We.jsx)(mA,{color:"text.secondary",children:i})}))})})),TL=SL;function CL(e,n,r,i,o){const[s,a]=t.useState((()=>o&&r?r(e).matches:i?i(e).matches:n));return(0,yI.A)((()=>{let t=!0;if(!r)return;const n=r(e),i=()=>{t&&a(n.matches)};return i(),n.addListener(i),()=>{t=!1,n.removeListener(i)}}),[e,r]),s}const AL=r.useSyncExternalStore;function RL(e,n,r,i,o){const s=t.useCallback((()=>n),[n]),a=t.useMemo((()=>{if(o&&r)return()=>r(e).matches;if(null!==i){const{matches:t}=i(e);return()=>t}return s}),[s,e,i,o,r]),[c,l]=t.useMemo((()=>{if(null===r)return[s,()=>()=>{}];const t=r(e);return[()=>t.matches,e=>(t.addListener(e),()=>{t.removeListener(e)})]}),[s,r,e]);return AL(l,c,a)}function IL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Ve(),r="undefined"!==typeof window&&"undefined"!==typeof window.matchMedia,{defaultMatches:i=!1,matchMedia:o=(r?window.matchMedia:null),ssrMatchMedia:s=null,noSsr:a=!1}=WN({name:"MuiUseMediaQuery",props:t,theme:n});let c="function"===typeof e?e(n):e;c=c.replace(/^@media( ?)/m,"");return(void 0!==AL?RL:CL)(c,i,o,s,a)}function xL(e){let{props:t,name:n}=e;return zN({props:t,name:n,defaultTheme:tt.A,themeId:qe.A})}var OL=n(1942),kL=n.n(OL);function NL(e,t,n){return"function"===typeof e?e(t,n):e}const PL=kL().oneOfType([kL().func,kL().object]),DL=(e,t)=>e.length===t.length&&t.every((t=>e.includes(t))),LL=(e,t,n)=>{let r=t;return r=e.setHours(r,e.getHours(n)),r=e.setMinutes(r,e.getMinutes(n)),r=e.setSeconds(r,e.getSeconds(n)),r},ML=e=>{let{date:t,disableFuture:n,disablePast:r,maxDate:i,minDate:o,isDateDisabled:s,utils:a,timezone:c}=e;const l=LL(a,a.dateWithTimezone(void 0,c),t);r&&a.isBefore(o,l)&&(o=l),n&&a.isAfter(i,l)&&(i=l);let u=t,d=t;for(a.isBefore(t,o)&&(u=o,d=null),a.isAfter(t,i)&&(d&&(d=i),u=null);u||d;){if(u&&a.isAfter(u,i)&&(u=null),d&&a.isBefore(d,o)&&(d=null),u){if(!s(u))return u;u=a.addDays(u,1)}if(d){if(!s(d))return d;d=a.addDays(d,-1)}}return null},jL=(e,t,n)=>null!=t&&e.isValid(t)?t:n,UL=(e,t)=>{const n=[e.startOfYear(t)];for(;n.length<12;){const t=n[n.length-1];n.push(e.addMonths(t,1))}return n},VL=(e,t,n)=>"date"===n?e.startOfDay(e.dateWithTimezone(void 0,t)):e.dateWithTimezone(void 0,t),FL=["year","month","day"],BL=e=>FL.includes(e),WL=(e,t,n)=>{let{format:r,views:i}=t;if(null!=r)return r;const o=e.formats;return DL(i,["year"])?o.year:DL(i,["month"])?o.month:DL(i,["day"])?o.dayOfMonth:DL(i,["month","year"])?`${o.month} ${o.year}`:DL(i,["day","month"])?`${o.month} ${o.dayOfMonth}`:n?/en/.test(e.getCurrentLocaleCode())?o.normalDateWithWeekday:o.normalDate:o.keyboardDate},zL=(e,t)=>{const n=e.startOfWeek(t);return[0,1,2,3,4,5,6].map((t=>e.addDays(n,t)))},HL=["hours","minutes","seconds"],GL=(e,t)=>3600*t.getHours(e)+60*t.getMinutes(e)+t.getSeconds(e),qL={year:1,month:2,day:3,hours:4,minutes:5,seconds:6,milliseconds:7},KL=(e,t,n)=>{if(t===qL.year)return e.startOfYear(n);if(t===qL.month)return e.startOfMonth(n);if(t===qL.day)return e.startOfDay(n);let r=n;return t<qL.minutes&&(r=e.setMinutes(r,0)),t<qL.seconds&&(r=e.setSeconds(r,0)),t<qL.milliseconds&&(r=e.setMilliseconds(r,0)),r},$L=e=>{let{props:t,utils:n,granularity:r,timezone:i,getTodayDate:o}=e;var s;let a=o?o():KL(n,r,VL(n,i));null!=t.minDate&&n.isAfterDay(t.minDate,a)&&(a=KL(n,r,t.minDate)),null!=t.maxDate&&n.isBeforeDay(t.maxDate,a)&&(a=KL(n,r,t.maxDate));const c=((e,t)=>(n,r)=>e?t.isAfter(n,r):GL(n,t)>GL(r,t))(null!=(s=t.disableIgnoringDatePartForTimeValidation)&&s,n);return null!=t.minTime&&c(t.minTime,a)&&(a=KL(n,r,t.disableIgnoringDatePartForTimeValidation?t.minTime:LL(n,a,t.minTime))),null!=t.maxTime&&c(a,t.maxTime)&&(a=KL(n,r,t.disableIgnoringDatePartForTimeValidation?t.maxTime:LL(n,a,t.maxTime))),a},YL=(e,t)=>{const n=e.formatTokenMap[t];if(null==n)throw new Error([`MUI: The token "${t}" is not supported by the Date and Time Pickers.`,"Please try using another token or open an issue on https://github.com/mui/mui-x/issues/new/choose if you think it should be supported."].join("\n"));return"string"===typeof n?{type:n,contentType:"meridiem"===n?"letter":"digit",maxLength:void 0}:{type:n.sectionType,contentType:n.contentType,maxLength:n.maxLength}},XL=(e,t,n)=>{const r=[],i=e.dateWithTimezone(void 0,t),o=e.startOfWeek(i),s=e.endOfWeek(i);let a=o;for(;e.isBefore(a,s);)r.push(a),a=e.addDays(a,1);return r.map((t=>e.formatByString(t,n)))},JL=(e,t,n,r)=>{switch(n){case"month":return UL(e,e.dateWithTimezone(void 0,t)).map((t=>e.formatByString(t,r)));case"weekDay":return XL(e,t,r);case"meridiem":{const n=e.dateWithTimezone(void 0,t);return[e.startOfDay(n),e.endOfDay(n)].map((t=>e.formatByString(t,r)))}default:return[]}},QL=(e,t,n)=>{let r=t;for(r=Number(r).toString();r.length<n;)r=`0${r}`;return r},ZL=(e,t,n,r,i)=>{if("day"===i.type&&"digit-with-letter"===i.contentType){const t=e.setDate(r.longestMonth,n);return e.formatByString(t,i.format)}const o=n.toString();return i.hasLeadingZerosInInput?QL(0,o,i.maxLength):o},eM=(e,t,n,r,i,o,s)=>{const a=(e=>{switch(e){case"ArrowUp":return 1;case"ArrowDown":return-1;case"PageUp":return 5;case"PageDown":return-5;default:return 0}})(r),c="Home"===r,l="End"===r,u=""===n.value||c||l;return"digit"===n.contentType||"digit-with-letter"===n.contentType?(()=>{const r=i[n.type]({currentDate:o,format:n.format,contentType:n.contentType}),d=t=>ZL(e,0,t,r,n),h="minutes"===n.type&&null!=s&&s.minutesStep?s.minutesStep:1;let p=parseInt(n.value,10)+a*h;if(u){if("year"===n.type&&!l&&!c)return e.formatByString(e.dateWithTimezone(void 0,t),n.format);p=a>0||c?r.minimum:r.maximum}return p%h!==0&&((a<0||c)&&(p+=h-(h+p)%h),(a>0||l)&&(p-=p%h)),p>r.maximum?d(r.minimum+(p-r.maximum-1)%(r.maximum-r.minimum+1)):p<r.minimum?d(r.maximum-(r.minimum-p-1)%(r.maximum-r.minimum+1)):d(p)})():(()=>{const r=JL(e,t,n.type,n.format);if(0===r.length)return n.value;if(u)return a>0||c?r[0]:r[r.length-1];const i=r.indexOf(n.value);return r[(i+r.length+a)%r.length]})()},tM=(e,t)=>{let n=e.value||e.placeholder;const r="non-input"===t?e.hasLeadingZerosInFormat:e.hasLeadingZerosInInput;"non-input"===t&&e.hasLeadingZerosInInput&&!e.hasLeadingZerosInFormat&&(n=Number(n).toString());return["input-rtl","input-ltr"].includes(t)&&"digit"===e.contentType&&!r&&1===n.length&&(n=`${n}\u200e`),"input-rtl"===t&&(n=`\u2068${n}\u2069`),n},nM=e=>e.replace(/[\u2066\u2067\u2068\u2069]/g,""),rM=(e,t)=>{let n=0,r=t?1:0;const i=[];for(let o=0;o<e.length;o+=1){const s=e[o],a=tM(s,t?"input-rtl":"input-ltr"),c=`${s.startSeparator}${a}${s.endSeparator}`,l=nM(c).length,u=c.length,d=nM(a),h=r+a.indexOf(d[0])+s.startSeparator.length,p=h+d.length;i.push((0,ke.A)({},s,{start:n,end:n+l,startInInput:h,endInInput:p})),n+=l,r+=u}return i},iM=(e,t,n,r,i)=>{switch(r.type){case"year":return n.fieldYearPlaceholder({digitAmount:e.formatByString(e.dateWithTimezone(void 0,t),i).length,format:i});case"month":return n.fieldMonthPlaceholder({contentType:r.contentType,format:i});case"day":return n.fieldDayPlaceholder({format:i});case"weekDay":return n.fieldWeekDayPlaceholder({contentType:r.contentType,format:i});case"hours":return n.fieldHoursPlaceholder({format:i});case"minutes":return n.fieldMinutesPlaceholder({format:i});case"seconds":return n.fieldSecondsPlaceholder({format:i});case"meridiem":return n.fieldMeridiemPlaceholder({format:i});default:return i}},oM=(e,t,n,r)=>e.formatByString(e.parse(t,n),r),sM=(e,t,n)=>4===e.formatByString(e.dateWithTimezone(void 0,t),n).length,aM=(e,t,n,r,i)=>{if("digit"!==n)return!1;const o=e.dateWithTimezone(void 0,t);switch(r){case"year":if(sM(e,t,i)){return"0001"===e.formatByString(e.setYear(o,1),i)}return"01"===e.formatByString(e.setYear(o,2001),i);case"month":return e.formatByString(e.startOfYear(o),i).length>1;case"day":return e.formatByString(e.startOfMonth(o),i).length>1;case"weekDay":return e.formatByString(e.startOfWeek(o),i).length>1;case"hours":return e.formatByString(e.setHours(o,1),i).length>1;case"minutes":return e.formatByString(e.setMinutes(o,1),i).length>1;case"seconds":return e.formatByString(e.setSeconds(o,1),i).length>1;default:throw new Error("Invalid section type")}},cM=(e,t,n,r,i,o,s,a)=>{let c="";const l=[],u=e.date(),d=r=>{if(""===r)return null;const o=YL(e,r),a=aM(e,t,o.contentType,o.type,r),d=s?a:"digit"===o.contentType,h=null!=i&&e.isValid(i);let p=h?e.formatByString(i,r):"",f=null;if(d)if(a)f=""===p?e.formatByString(u,r).length:p.length;else{if(null==o.maxLength)throw new Error(`MUI: The token ${r} should have a 'maxDigitNumber' property on it's adapter`);f=o.maxLength,h&&(p=QL(0,p,f))}return l.push((0,ke.A)({},o,{format:r,maxLength:f,value:p,placeholder:iM(e,t,n,o,r),hasLeadingZeros:a,hasLeadingZerosInFormat:a,hasLeadingZerosInInput:d,startSeparator:0===l.length?c:"",endSeparator:"",modified:!1})),null};let h=10,p=r,f=e.expandFormat(r);for(;f!==p;)if(p=f,f=e.expandFormat(p),h-=1,h<0)throw new Error("MUI: The format expansion seems to be  enter in an infinite loop. Please open an issue with the format passed to the picker component");const m=f,g=((e,t)=>{const n=[],{start:r,end:i}=e.escapedCharacters,o=new RegExp(`(\\${r}[^\\${i}]*\\${i})+`,"g");let s=null;for(;s=o.exec(t);)n.push({start:s.index,end:o.lastIndex-1});return n})(e,m),v=new RegExp(`^(${Object.keys(e.formatTokenMap).sort(((e,t)=>t.length-e.length)).join("|")})`,"g");let y="";for(let _=0;_<m.length;_+=1){const e=g.find((e=>e.start<=_&&e.end>=_)),t=m[_],n=null!=e,r=`${y}${m.slice(_)}`,i=v.test(r);if(!n&&t.match(/([A-Za-z]+)/)&&i)y=r.slice(0,v.lastIndex),_+=v.lastIndex-1;else{n&&(null==e?void 0:e.start)===_||(null==e?void 0:e.end)===_||(d(y),y="",0===l.length?c+=t:l[l.length-1].endSeparator+=t)}}return d(y),l.map((e=>{const t=e=>{let t=e;return a&&null!==t&&t.includes(" ")&&(t=`\u2069${t}\u2066`),"spacious"===o&&["/",".","-"].includes(t)&&(t=` ${t} `),t};return e.startSeparator=t(e.startSeparator),e.endSeparator=t(e.endSeparator),e}))};const lM=(e,t)=>{0},uM={year:1,month:2,day:3,weekDay:4,hours:5,minutes:6,seconds:7,meridiem:8},dM=(e,t,n,r,i,o)=>[...r].sort(((e,t)=>uM[e.type]-uM[t.type])).reduce(((r,i)=>!o||i.modified?((e,t,n,r,i)=>{switch(n.type){case"year":return e.setYear(i,e.getYear(r));case"month":return e.setMonth(i,e.getMonth(r));case"weekDay":{const i=XL(e,t,n.format),o=e.formatByString(r,n.format),s=i.indexOf(o),a=i.indexOf(n.value)-s;return e.addDays(r,a)}case"day":return e.setDate(i,e.getDate(r));case"meridiem":{const t=e.getHours(r)<12,n=e.getHours(i);return t&&n>=12?e.addHours(i,-12):!t&&n<12?e.addHours(i,12):i}case"hours":return e.setHours(i,e.getHours(r));case"minutes":return e.setMinutes(i,e.getMinutes(r));case"seconds":return e.setSeconds(i,e.getSeconds(r));default:return i}})(e,t,i,n,r):r),i),hM=["value","referenceDate"],pM={emptyValue:null,getTodayValue:VL,getInitialReferenceValue:e=>{let{value:t,referenceDate:n}=e,r=(0,Ne.A)(e,hM);return null!=t&&r.utils.isValid(t)?t:null!=n?n:$L(r)},cleanValue:(e,t)=>null!=t&&e.isValid(t)?t:null,areValuesEqual:(e,t,n)=>!e.isValid(t)&&null!=t&&!e.isValid(n)&&null!=n||e.isEqual(t,n),isSameError:(e,t)=>e===t,hasError:e=>null!=e,defaultErrorState:null,getTimezone:(e,t)=>null!=t&&e.isValid(t)?e.getTimezone(t):null,setTimezone:(e,t,n)=>null==n?null:e.setTimezone(n,t)},fM={updateReferenceValue:(e,t,n)=>null!=t&&e.isValid(t)?t:n,getSectionsFromValue:(e,t,n,r,i)=>!e.isValid(t)&&!!n?n:rM(i(t),r),getValueStrFromSections:(e,t)=>{const n=e.map((e=>{const n=tM(e,t?"input-rtl":"input-ltr");return`${e.startSeparator}${n}${e.endSeparator}`})).join("");return t?`\u2066${n}\u2069`:n},getActiveDateManager:(e,t)=>({date:t.value,referenceDate:t.referenceValue,getSections:e=>e,getNewValuesFromNewActiveDate:n=>({value:n,referenceValue:null!=n&&e.isValid(n)?n:t.referenceValue})}),parseValueStr:(e,t,n)=>n(e.trim(),t)},mM=["localeText"],gM=t.createContext(null);const vM=function(e){var n;const{localeText:r}=e,i=(0,Ne.A)(e,mM),{utils:o,localeText:s}=null!=(n=t.useContext(gM))?n:{utils:void 0,localeText:void 0},a=xL({props:i,name:"MuiLocalizationProvider"}),{children:c,dateAdapter:l,dateFormats:u,dateLibInstance:d,adapterLocale:h,localeText:p}=a,f=t.useMemo((()=>(0,ke.A)({},p,s,r)),[p,s,r]),m=t.useMemo((()=>{if(!l)return o||null;const e=new l({locale:h,formats:u,instance:d});if(!e.isMUIAdapter)throw new Error(["MUI: The date adapter should be imported from `@mui/x-date-pickers` or `@mui/x-date-pickers-pro`, not from `@date-io`","For example, `import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs'` instead of `import AdapterDayjs from '@date-io/dayjs'`","More information on the installation documentation: https://mui.com/x/react-date-pickers/getting-started/#installation"].join("\n"));return e}),[l,h,u,d,o]),g=t.useMemo((()=>m?{minDate:m.date("1900-01-01T00:00:00.000"),maxDate:m.date("2099-12-31T00:00:00.000")}:null),[m]),v=t.useMemo((()=>({utils:m,defaultDates:g,localeText:f})),[g,m,f]);return(0,We.jsx)(gM.Provider,{value:v,children:c})},yM={previousMonth:"Previous month",nextMonth:"Next month",openPreviousView:"open previous view",openNextView:"open next view",calendarViewSwitchingButtonAriaLabel:e=>"year"===e?"year view is open, switch to calendar view":"calendar view is open, switch to year view",start:"Start",end:"End",cancelButtonLabel:"Cancel",clearButtonLabel:"Clear",okButtonLabel:"OK",todayButtonLabel:"Today",datePickerToolbarTitle:"Select date",dateTimePickerToolbarTitle:"Select date & time",timePickerToolbarTitle:"Select time",dateRangePickerToolbarTitle:"Select date range",clockLabelText:(e,t,n)=>`Select ${e}. ${null===t?"No time selected":`Selected time is ${n.format(t,"fullTime")}`}`,hoursClockNumberText:e=>`${e} hours`,minutesClockNumberText:e=>`${e} minutes`,secondsClockNumberText:e=>`${e} seconds`,selectViewText:e=>`Select ${e}`,calendarWeekNumberHeaderLabel:"Week number",calendarWeekNumberHeaderText:"#",calendarWeekNumberAriaLabelText:e=>`Week ${e}`,calendarWeekNumberText:e=>`${e}`,openDatePickerDialogue:(e,t)=>null!==e&&t.isValid(e)?`Choose date, selected date is ${t.format(e,"fullDate")}`:"Choose date",openTimePickerDialogue:(e,t)=>null!==e&&t.isValid(e)?`Choose time, selected time is ${t.format(e,"fullTime")}`:"Choose time",fieldClearLabel:"Clear value",timeTableLabel:"pick time",dateTableLabel:"pick date",fieldYearPlaceholder:e=>"Y".repeat(e.digitAmount),fieldMonthPlaceholder:e=>"letter"===e.contentType?"MMMM":"MM",fieldDayPlaceholder:()=>"DD",fieldWeekDayPlaceholder:e=>"letter"===e.contentType?"EEEE":"EE",fieldHoursPlaceholder:()=>"hh",fieldMinutesPlaceholder:()=>"mm",fieldSecondsPlaceholder:()=>"ss",fieldMeridiemPlaceholder:()=>"aa"},_M=yM;EM=yM,(0,ke.A)({},EM);var EM;const bM=()=>{const e=t.useContext(gM);if(null===e)throw new Error(["MUI: Can not find the date and time pickers localization context.","It looks like you forgot to wrap your component in LocalizationProvider.","This can also happen if you are bundling multiple versions of the `@mui/x-date-pickers` package"].join("\n"));if(null===e.utils)throw new Error(["MUI: Can not find the date and time pickers adapter from its localization context.","It looks like you forgot to pass a `dateAdapter` to your LocalizationProvider."].join("\n"));const n=t.useMemo((()=>(0,ke.A)({},_M,e.localeText)),[e.localeText]);return t.useMemo((()=>(0,ke.A)({},e,{localeText:n})),[e,n])},wM=()=>bM().utils,SM=()=>bM().defaultDates,TM=()=>bM().localeText,CM=e=>{const n=wM(),r=t.useRef();return void 0===r.current&&(r.current=n.dateWithTimezone(void 0,e)),r.current};function AM(e){return(0,AC.Ay)("MuiPickersToolbar",e)}(0,Ke.A)("MuiPickersToolbar",["root","content"]);const RM=(0,wC.Ay)("div",{name:"MuiPickersToolbar",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",padding:t.spacing(2,3)},n.isLandscape&&{height:"auto",maxWidth:160,padding:16,justifyContent:"flex-start",flexWrap:"wrap"})})),IM=(0,wC.Ay)("div",{name:"MuiPickersToolbar",slot:"Content",overridesResolver:(e,t)=>t.content})((e=>{let{ownerState:t}=e;var n;return{display:"flex",flexWrap:"wrap",width:"100%",justifyContent:t.isLandscape?"flex-start":"space-between",flexDirection:t.isLandscape?null!=(n=t.landscapeDirection)?n:"column":"row",flex:1,alignItems:t.isLandscape?"flex-start":"center"}})),xM=t.forwardRef((function(e,t){const n=xL({props:e,name:"MuiPickersToolbar"}),{children:r,className:i,toolbarTitle:o,hidden:s,titleId:a}=n,c=n,l=(e=>{const{classes:t,isLandscape:n}=e,r={root:["root"],content:["content"],penIconButton:["penIconButton",n&&"penIconButtonLandscape"]};return(0,bC.A)(r,AM,t)})(c);return s?null:(0,We.jsxs)(RM,{ref:t,className:(0,Pe.A)(l.root,i),ownerState:c,children:[(0,We.jsx)(mA,{color:"text.secondary",variant:"overline",id:a,children:o}),(0,We.jsx)(IM,{className:l.content,ownerState:c,children:r})]})}));function OM(e){return(0,AC.Ay)("MuiDatePickerToolbar",e)}(0,Ke.A)("MuiDatePickerToolbar",["root","title"]);const kM=["value","isLandscape","onChange","toolbarFormat","toolbarPlaceholder","views","className"],NM=(0,wC.Ay)(xM,{name:"MuiDatePickerToolbar",slot:"Root",overridesResolver:(e,t)=>t.root})({}),PM=(0,wC.Ay)(mA,{name:"MuiDatePickerToolbar",slot:"Title",overridesResolver:(e,t)=>t.title})((e=>{let{ownerState:t}=e;return(0,ke.A)({},t.isLandscape&&{margin:"auto 16px auto auto"})})),DM=t.forwardRef((function(e,n){const r=xL({props:e,name:"MuiDatePickerToolbar"}),{value:i,isLandscape:o,toolbarFormat:s,toolbarPlaceholder:a="\u2013\u2013",views:c,className:l}=r,u=(0,Ne.A)(r,kM),d=wM(),h=TM(),p=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],title:["title"]},OM,t)})(r),f=t.useMemo((()=>{if(!i)return a;const e=WL(d,{format:s,views:c},!0);return d.formatByString(i,e)}),[i,s,a,d,c]),m=r;return(0,We.jsx)(NM,(0,ke.A)({ref:n,toolbarTitle:h.datePickerToolbarTitle,isLandscape:o,className:(0,Pe.A)(p.root,l)},u,{children:(0,We.jsx)(PM,{variant:"h4",align:o?"left":"center",ownerState:m,className:p.title,children:f})}))})),LM=e=>{if(void 0!==e)return Object.keys(e).reduce(((t,n)=>(0,ke.A)({},t,{[`${n.slice(0,1).toLowerCase()}${n.slice(1)}`]:e[n]})),{})};function MM(e,n){var r,i,o,s;const a=wM(),c=SM(),l=xL({props:e,name:n}),u=t.useMemo((()=>{var e;return null==(null==(e=l.localeText)?void 0:e.toolbarTitle)?l.localeText:(0,ke.A)({},l.localeText,{datePickerToolbarTitle:l.localeText.toolbarTitle})}),[l.localeText]),d=null!=(r=l.slots)?r:LM(l.components);return(0,ke.A)({},l,{localeText:u},(e=>{let{openTo:t,defaultOpenTo:n,views:r,defaultViews:i}=e;const o=null!=r?r:i;let s;if(null!=t)s=t;else if(o.includes(n))s=n;else{if(!(o.length>0))throw new Error("MUI: The `views` prop must contain at least one view");s=o[0]}return{views:o,openTo:s}})({views:l.views,openTo:l.openTo,defaultViews:["year","day"],defaultOpenTo:"day"}),{disableFuture:null!=(i=l.disableFuture)&&i,disablePast:null!=(o=l.disablePast)&&o,minDate:jL(a,l.minDate,c.minDate),maxDate:jL(a,l.maxDate,c.maxDate),slots:(0,ke.A)({toolbar:DM},d),slotProps:null!=(s=l.slotProps)?s:l.componentsProps})}const jM=e=>{let{props:t,value:n,adapter:r}=e;if(null===n)return null;const{shouldDisableDate:i,shouldDisableMonth:o,shouldDisableYear:s,disablePast:a,disableFuture:c,timezone:l}=t,u=r.utils.dateWithTimezone(void 0,l),d=jL(r.utils,t.minDate,r.defaultDates.minDate),h=jL(r.utils,t.maxDate,r.defaultDates.maxDate);switch(!0){case!r.utils.isValid(n):return"invalidDate";case Boolean(i&&i(n)):return"shouldDisableDate";case Boolean(o&&o(n)):return"shouldDisableMonth";case Boolean(s&&s(n)):return"shouldDisableYear";case Boolean(c&&r.utils.isAfterDay(n,u)):return"disableFuture";case Boolean(a&&r.utils.isBeforeDay(n,u)):return"disablePast";case Boolean(d&&r.utils.isBeforeDay(n,d)):return"minDate";case Boolean(h&&r.utils.isAfterDay(n,h)):return"maxDate";default:return null}};function UM(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t]))).forEach((n=>{t[n]=e[n]})),t}function VM(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:r,externalForwardedProps:i,className:o}=e;if(!t){const e=(0,Pe.A)(n?.className,o,i?.className,r?.className),t={...n?.style,...i?.style,...r?.style},s={...n,...i,...r};return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n}({...i,...r}),a=UM(r),c=UM(i),l=t(s),u=(0,Pe.A)(l?.className,n?.className,o,i?.className,r?.className),d={...l?.style,...n?.style,...i?.style,...r?.style},h={...l,...n,...c,...a};return u.length>0&&(h.className=u),Object.keys(d).length>0&&(h.style=d),{props:h,internalRef:l.ref}}function FM(e){const{elementType:n,externalSlotProps:r,ownerState:i,skipResolvingSlotProps:o=!1,...s}=e,a=o?{}:NL(r,i),{props:c,internalRef:l}=VM({...s,externalSlotProps:a}),u=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const i=t.useRef(void 0),o=t.useCallback((e=>{const t=n.map((t=>{if(null==t)return null;if("function"===typeof t){const n=t,r=n(e);return"function"===typeof r?r:()=>{n(null)}}return t.current=e,()=>{t.current=null}}));return()=>{t.forEach((e=>e?.()))}}),n);return t.useMemo((()=>n.every((e=>null==e))?null:e=>{i.current&&(i.current(),i.current=void 0),null!=e&&(i.current=o(e))}),n)}(l,a?.ref,e.additionalProps?.ref),d=function(e,t,n){return void 0===e||"string"===typeof e?t:{...t,ownerState:{...t.ownerState,...n}}}(n,{...c,ref:u},i);return d}var BM=n(5329);function WM(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function zM(e){return e instanceof WM(e).Element||e instanceof Element}function HM(e){return e instanceof WM(e).HTMLElement||e instanceof HTMLElement}function GM(e){return"undefined"!==typeof ShadowRoot&&(e instanceof WM(e).ShadowRoot||e instanceof ShadowRoot)}var qM=Math.max,KM=Math.min,$M=Math.round;function YM(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function XM(){return!/^((?!chrome|android).)*safari/i.test(YM())}function JM(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=e.getBoundingClientRect(),i=1,o=1;t&&HM(e)&&(i=e.offsetWidth>0&&$M(r.width)/e.offsetWidth||1,o=e.offsetHeight>0&&$M(r.height)/e.offsetHeight||1);var s=(zM(e)?WM(e):window).visualViewport,a=!XM()&&n,c=(r.left+(a&&s?s.offsetLeft:0))/i,l=(r.top+(a&&s?s.offsetTop:0))/o,u=r.width/i,d=r.height/o;return{width:u,height:d,top:l,right:c+u,bottom:l+d,left:c,x:c,y:l}}function QM(e){var t=WM(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function ZM(e){return e?(e.nodeName||"").toLowerCase():null}function ej(e){return((zM(e)?e.ownerDocument:e.document)||window.document).documentElement}function tj(e){return JM(ej(e)).left+QM(e).scrollLeft}function nj(e){return WM(e).getComputedStyle(e)}function rj(e){var t=nj(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function ij(e,t,n){void 0===n&&(n=!1);var r=HM(t),i=HM(t)&&function(e){var t=e.getBoundingClientRect(),n=$M(t.width)/e.offsetWidth||1,r=$M(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),o=ej(t),s=JM(e,i,n),a={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&(("body"!==ZM(t)||rj(o))&&(a=function(e){return e!==WM(e)&&HM(e)?{scrollLeft:(t=e).scrollLeft,scrollTop:t.scrollTop}:QM(e);var t}(t)),HM(t)?((c=JM(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=tj(o))),{x:s.left+a.scrollLeft-c.x,y:s.top+a.scrollTop-c.y,width:s.width,height:s.height}}function oj(e){var t=JM(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function sj(e){return"html"===ZM(e)?e:e.assignedSlot||e.parentNode||(GM(e)?e.host:null)||ej(e)}function aj(e){return["html","body","#document"].indexOf(ZM(e))>=0?e.ownerDocument.body:HM(e)&&rj(e)?e:aj(sj(e))}function cj(e,t){var n;void 0===t&&(t=[]);var r=aj(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),o=WM(r),s=i?[o].concat(o.visualViewport||[],rj(r)?r:[]):r,a=t.concat(s);return i?a:a.concat(cj(sj(s)))}function lj(e){return["table","td","th"].indexOf(ZM(e))>=0}function uj(e){return HM(e)&&"fixed"!==nj(e).position?e.offsetParent:null}function dj(e){for(var t=WM(e),n=uj(e);n&&lj(n)&&"static"===nj(n).position;)n=uj(n);return n&&("html"===ZM(n)||"body"===ZM(n)&&"static"===nj(n).position)?t:n||function(e){var t=/firefox/i.test(YM());if(/Trident/i.test(YM())&&HM(e)&&"fixed"===nj(e).position)return null;var n=sj(e);for(GM(n)&&(n=n.host);HM(n)&&["html","body"].indexOf(ZM(n))<0;){var r=nj(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}var hj="top",pj="bottom",fj="right",mj="left",gj="auto",vj=[hj,pj,fj,mj],yj="start",_j="end",Ej="viewport",bj="popper",wj=vj.reduce((function(e,t){return e.concat([t+"-"+yj,t+"-"+_j])}),[]),Sj=[].concat(vj,[gj]).reduce((function(e,t){return e.concat([t,t+"-"+yj,t+"-"+_j])}),[]),Tj=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Cj(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}function Aj(e){var t;return function(){return t||(t=new Promise((function(n){Promise.resolve().then((function(){t=void 0,n(e())}))}))),t}}var Rj={placement:"bottom",modifiers:[],strategy:"absolute"};function Ij(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"===typeof e.getBoundingClientRect)}))}function xj(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,o=void 0===i?Rj:i;return function(e,t,n){void 0===n&&(n=o);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},Rj,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},s=[],a=!1,c={state:i,setOptions:function(n){var a="function"===typeof n?n(i.options):n;l(),i.options=Object.assign({},o,i.options,a),i.scrollParents={reference:zM(e)?cj(e):e.contextElement?cj(e.contextElement):[],popper:cj(t)};var u=function(e){var t=Cj(e);return Tj.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}(function(e){var t=e.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(r,i.options.modifiers)));return i.orderedModifiers=u.filter((function(e){return e.enabled})),i.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,o=e.effect;if("function"===typeof o){var a=o({state:i,name:t,instance:c,options:r}),l=function(){};s.push(a||l)}})),c.update()},forceUpdate:function(){if(!a){var e=i.elements,t=e.reference,n=e.popper;if(Ij(t,n)){i.rects={reference:ij(t,dj(n),"fixed"===i.options.strategy),popper:oj(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(e){return i.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var o=i.orderedModifiers[r],s=o.fn,l=o.options,u=void 0===l?{}:l,d=o.name;"function"===typeof s&&(i=s({state:i,options:u,name:d,instance:c})||i)}else i.reset=!1,r=-1}}},update:Aj((function(){return new Promise((function(e){c.forceUpdate(),e(i)}))})),destroy:function(){l(),a=!0}};if(!Ij(e,t))return c;function l(){s.forEach((function(e){return e()})),s=[]}return c.setOptions(n).then((function(e){!a&&n.onFirstUpdate&&n.onFirstUpdate(e)})),c}}var Oj={passive:!0};function kj(e){return e.split("-")[0]}function Nj(e){return e.split("-")[1]}function Pj(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Dj(e){var t,n=e.reference,r=e.element,i=e.placement,o=i?kj(i):null,s=i?Nj(i):null,a=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(o){case hj:t={x:a,y:n.y-r.height};break;case pj:t={x:a,y:n.y+n.height};break;case fj:t={x:n.x+n.width,y:c};break;case mj:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var l=o?Pj(o):null;if(null!=l){var u="y"===l?"height":"width";switch(s){case yj:t[l]=t[l]-(n[u]/2-r[u]/2);break;case _j:t[l]=t[l]+(n[u]/2-r[u]/2)}}return t}var Lj={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Mj(e){var t,n=e.popper,r=e.popperRect,i=e.placement,o=e.variation,s=e.offsets,a=e.position,c=e.gpuAcceleration,l=e.adaptive,u=e.roundOffsets,d=e.isFixed,h=s.x,p=void 0===h?0:h,f=s.y,m=void 0===f?0:f,g="function"===typeof u?u({x:p,y:m}):{x:p,y:m};p=g.x,m=g.y;var v=s.hasOwnProperty("x"),y=s.hasOwnProperty("y"),_=mj,E=hj,b=window;if(l){var w=dj(n),S="clientHeight",T="clientWidth";if(w===WM(n)&&"static"!==nj(w=ej(n)).position&&"absolute"===a&&(S="scrollHeight",T="scrollWidth"),i===hj||(i===mj||i===fj)&&o===_j)E=pj,m-=(d&&w===b&&b.visualViewport?b.visualViewport.height:w[S])-r.height,m*=c?1:-1;if(i===mj||(i===hj||i===pj)&&o===_j)_=fj,p-=(d&&w===b&&b.visualViewport?b.visualViewport.width:w[T])-r.width,p*=c?1:-1}var C,A=Object.assign({position:a},l&&Lj),R=!0===u?function(e,t){var n=e.x,r=e.y,i=t.devicePixelRatio||1;return{x:$M(n*i)/i||0,y:$M(r*i)/i||0}}({x:p,y:m},WM(n)):{x:p,y:m};return p=R.x,m=R.y,c?Object.assign({},A,((C={})[E]=y?"0":"",C[_]=v?"0":"",C.transform=(b.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",C)):Object.assign({},A,((t={})[E]=y?m+"px":"",t[_]=v?p+"px":"",t.transform="",t))}const jj={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];HM(i)&&ZM(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},o=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});HM(r)&&ZM(r)&&(Object.assign(r.style,o),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]};const Uj={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.offset,o=void 0===i?[0,0]:i,s=Sj.reduce((function(e,n){return e[n]=function(e,t,n){var r=kj(e),i=[mj,hj].indexOf(r)>=0?-1:1,o="function"===typeof n?n(Object.assign({},t,{placement:e})):n,s=o[0],a=o[1];return s=s||0,a=(a||0)*i,[mj,fj].indexOf(r)>=0?{x:a,y:s}:{x:s,y:a}}(n,t.rects,o),e}),{}),a=s[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[r]=s}};var Vj={left:"right",right:"left",bottom:"top",top:"bottom"};function Fj(e){return e.replace(/left|right|bottom|top/g,(function(e){return Vj[e]}))}var Bj={start:"end",end:"start"};function Wj(e){return e.replace(/start|end/g,(function(e){return Bj[e]}))}function zj(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&GM(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Hj(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Gj(e,t,n){return t===Ej?Hj(function(e,t){var n=WM(e),r=ej(e),i=n.visualViewport,o=r.clientWidth,s=r.clientHeight,a=0,c=0;if(i){o=i.width,s=i.height;var l=XM();(l||!l&&"fixed"===t)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:o,height:s,x:a+tj(e),y:c}}(e,n)):zM(t)?function(e,t){var n=JM(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):Hj(function(e){var t,n=ej(e),r=QM(e),i=null==(t=e.ownerDocument)?void 0:t.body,o=qM(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=qM(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+tj(e),c=-r.scrollTop;return"rtl"===nj(i||n).direction&&(a+=qM(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:s,x:a,y:c}}(ej(e)))}function qj(e,t,n,r){var i="clippingParents"===t?function(e){var t=cj(sj(e)),n=["absolute","fixed"].indexOf(nj(e).position)>=0&&HM(e)?dj(e):e;return zM(n)?t.filter((function(e){return zM(e)&&zj(e,n)&&"body"!==ZM(e)})):[]}(e):[].concat(t),o=[].concat(i,[n]),s=o[0],a=o.reduce((function(t,n){var i=Gj(e,n,r);return t.top=qM(i.top,t.top),t.right=KM(i.right,t.right),t.bottom=KM(i.bottom,t.bottom),t.left=qM(i.left,t.left),t}),Gj(e,s,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Kj(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function $j(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function Yj(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,o=n.strategy,s=void 0===o?e.strategy:o,a=n.boundary,c=void 0===a?"clippingParents":a,l=n.rootBoundary,u=void 0===l?Ej:l,d=n.elementContext,h=void 0===d?bj:d,p=n.altBoundary,f=void 0!==p&&p,m=n.padding,g=void 0===m?0:m,v=Kj("number"!==typeof g?g:$j(g,vj)),y=h===bj?"reference":bj,_=e.rects.popper,E=e.elements[f?y:h],b=qj(zM(E)?E:E.contextElement||ej(e.elements.popper),c,u,s),w=JM(e.elements.reference),S=Dj({reference:w,element:_,strategy:"absolute",placement:i}),T=Hj(Object.assign({},_,S)),C=h===bj?T:w,A={top:b.top-C.top+v.top,bottom:C.bottom-b.bottom+v.bottom,left:b.left-C.left+v.left,right:C.right-b.right+v.right},R=e.modifiersData.offset;if(h===bj&&R){var I=R[i];Object.keys(A).forEach((function(e){var t=[fj,pj].indexOf(e)>=0?1:-1,n=[hj,pj].indexOf(e)>=0?"y":"x";A[e]+=I[n]*t}))}return A}const Xj={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,o=void 0===i||i,s=n.altAxis,a=void 0===s||s,c=n.fallbackPlacements,l=n.padding,u=n.boundary,d=n.rootBoundary,h=n.altBoundary,p=n.flipVariations,f=void 0===p||p,m=n.allowedAutoPlacements,g=t.options.placement,v=kj(g),y=c||(v===g||!f?[Fj(g)]:function(e){if(kj(e)===gj)return[];var t=Fj(e);return[Wj(e),t,Wj(t)]}(g)),_=[g].concat(y).reduce((function(e,n){return e.concat(kj(n)===gj?function(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,o=n.rootBoundary,s=n.padding,a=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?Sj:c,u=Nj(r),d=u?a?wj:wj.filter((function(e){return Nj(e)===u})):vj,h=d.filter((function(e){return l.indexOf(e)>=0}));0===h.length&&(h=d);var p=h.reduce((function(t,n){return t[n]=Yj(e,{placement:n,boundary:i,rootBoundary:o,padding:s})[kj(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:n,boundary:u,rootBoundary:d,padding:l,flipVariations:f,allowedAutoPlacements:m}):n)}),[]),E=t.rects.reference,b=t.rects.popper,w=new Map,S=!0,T=_[0],C=0;C<_.length;C++){var A=_[C],R=kj(A),I=Nj(A)===yj,x=[hj,pj].indexOf(R)>=0,O=x?"width":"height",k=Yj(t,{placement:A,boundary:u,rootBoundary:d,altBoundary:h,padding:l}),N=x?I?fj:mj:I?pj:hj;E[O]>b[O]&&(N=Fj(N));var P=Fj(N),D=[];if(o&&D.push(k[R]<=0),a&&D.push(k[N]<=0,k[P]<=0),D.every((function(e){return e}))){T=A,S=!1;break}w.set(A,D)}if(S)for(var L=function(e){var t=_.find((function(t){var n=w.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return T=t,"break"},M=f?3:1;M>0;M--){if("break"===L(M))break}t.placement!==T&&(t.modifiersData[r]._skip=!0,t.placement=T,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Jj(e,t,n){return qM(e,KM(t,n))}const Qj={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,o=void 0===i||i,s=n.altAxis,a=void 0!==s&&s,c=n.boundary,l=n.rootBoundary,u=n.altBoundary,d=n.padding,h=n.tether,p=void 0===h||h,f=n.tetherOffset,m=void 0===f?0:f,g=Yj(t,{boundary:c,rootBoundary:l,padding:d,altBoundary:u}),v=kj(t.placement),y=Nj(t.placement),_=!y,E=Pj(v),b="x"===E?"y":"x",w=t.modifiersData.popperOffsets,S=t.rects.reference,T=t.rects.popper,C="function"===typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,A="number"===typeof C?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),R=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,I={x:0,y:0};if(w){if(o){var x,O="y"===E?hj:mj,k="y"===E?pj:fj,N="y"===E?"height":"width",P=w[E],D=P+g[O],L=P-g[k],M=p?-T[N]/2:0,j=y===yj?S[N]:T[N],U=y===yj?-T[N]:-S[N],V=t.elements.arrow,F=p&&V?oj(V):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},W=B[O],z=B[k],H=Jj(0,S[N],F[N]),G=_?S[N]/2-M-H-W-A.mainAxis:j-H-W-A.mainAxis,q=_?-S[N]/2+M+H+z+A.mainAxis:U+H+z+A.mainAxis,K=t.elements.arrow&&dj(t.elements.arrow),$=K?"y"===E?K.clientTop||0:K.clientLeft||0:0,Y=null!=(x=null==R?void 0:R[E])?x:0,X=P+q-Y,J=Jj(p?KM(D,P+G-Y-$):D,P,p?qM(L,X):L);w[E]=J,I[E]=J-P}if(a){var Q,Z="x"===E?hj:mj,ee="x"===E?pj:fj,te=w[b],ne="y"===b?"height":"width",re=te+g[Z],ie=te-g[ee],oe=-1!==[hj,mj].indexOf(v),se=null!=(Q=null==R?void 0:R[b])?Q:0,ae=oe?re:te-S[ne]-T[ne]-se+A.altAxis,ce=oe?te+S[ne]+T[ne]-se-A.altAxis:ie,le=p&&oe?function(e,t,n){var r=Jj(e,t,n);return r>n?n:r}(ae,te,ce):Jj(p?ae:re,te,p?ce:ie);w[b]=le,I[b]=le-te}t.modifiersData[r]=I}},requiresIfExists:["offset"]};const Zj={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,i=e.options,o=n.elements.arrow,s=n.modifiersData.popperOffsets,a=kj(n.placement),c=Pj(a),l=[mj,fj].indexOf(a)>=0?"height":"width";if(o&&s){var u=function(e,t){return Kj("number"!==typeof(e="function"===typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:$j(e,vj))}(i.padding,n),d=oj(o),h="y"===c?hj:mj,p="y"===c?pj:fj,f=n.rects.reference[l]+n.rects.reference[c]-s[c]-n.rects.popper[l],m=s[c]-n.rects.reference[c],g=dj(o),v=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,y=f/2-m/2,_=u[h],E=v-d[l]-u[p],b=v/2-d[l]/2+y,w=Jj(_,b,E),S=c;n.modifiersData[r]=((t={})[S]=w,t.centerOffset=w-b,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!==typeof r||(r=t.elements.popper.querySelector(r)))&&zj(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function eU(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function tU(e){return[hj,fj,pj,mj].some((function(t){return e[t]>=0}))}var nU=xj({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,o=void 0===i||i,s=r.resize,a=void 0===s||s,c=WM(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&l.forEach((function(e){e.addEventListener("scroll",n.update,Oj)})),a&&c.addEventListener("resize",n.update,Oj),function(){o&&l.forEach((function(e){e.removeEventListener("scroll",n.update,Oj)})),a&&c.removeEventListener("resize",n.update,Oj)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=Dj({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,o=n.adaptive,s=void 0===o||o,a=n.roundOffsets,c=void 0===a||a,l={placement:kj(t.placement),variation:Nj(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Mj(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:s,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Mj(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},jj,Uj,Xj,Qj,Zj,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,o=t.modifiersData.preventOverflow,s=Yj(t,{elementContext:"reference"}),a=Yj(t,{altBoundary:!0}),c=eU(s,r),l=eU(a,i,o),u=tU(c),d=tU(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}}]});function rU(e){return(0,AC.Ay)("MuiPopper",e)}(0,Ke.A)("MuiPopper",["root"]);const iU=["anchorEl","children","direction","disablePortal","modifiers","open","placement","popperOptions","popperRef","slotProps","slots","TransitionProps","ownerState"],oU=["anchorEl","children","container","direction","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","style","transition","slotProps","slots"];function sU(e){return"function"===typeof e?e():e}function aU(e){return void 0!==e.nodeType}const cU={},lU=t.forwardRef((function(e,n){var r;const{anchorEl:i,children:o,direction:s,disablePortal:a,modifiers:c,open:l,placement:u,popperOptions:d,popperRef:h,slotProps:p={},slots:f={},TransitionProps:m}=e,g=(0,Ne.A)(e,iU),v=t.useRef(null),y=(0,qC.A)(v,n),_=t.useRef(null),E=(0,qC.A)(_,h),b=t.useRef(E);(0,yI.A)((()=>{b.current=E}),[E]),t.useImperativeHandle(h,(()=>_.current),[]);const w=function(e,t){if("ltr"===t)return e;switch(e){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return e}}(u,s),[S,T]=t.useState(w),[C,A]=t.useState(sU(i));t.useEffect((()=>{_.current&&_.current.forceUpdate()})),t.useEffect((()=>{i&&A(sU(i))}),[i]),(0,yI.A)((()=>{if(!C||!l)return;let e=[{name:"preventOverflow",options:{altBoundary:a}},{name:"flip",options:{altBoundary:a}},{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:e=>{let{state:t}=e;(e=>{T(e.placement)})(t)}}];null!=c&&(e=e.concat(c)),d&&null!=d.modifiers&&(e=e.concat(d.modifiers));const t=nU(C,v.current,(0,ke.A)({placement:w},d,{modifiers:e}));return b.current(t),()=>{t.destroy(),b.current(null)}}),[C,a,c,l,d,w]);const R={placement:S};null!==m&&(R.TransitionProps=m);const I=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},rU,t)})(e),x=null!=(r=f.root)?r:"div",O=sR({elementType:x,externalSlotProps:p.root,externalForwardedProps:g,additionalProps:{role:"tooltip",ref:y},ownerState:e,className:I.root});return(0,We.jsx)(x,(0,ke.A)({},O,{children:"function"===typeof o?o(R):o}))})),uU=t.forwardRef((function(e,n){const{anchorEl:r,children:i,container:o,direction:s="ltr",disablePortal:a=!1,keepMounted:c=!1,modifiers:l,open:u,placement:d="bottom",popperOptions:h=cU,popperRef:p,style:f,transition:m=!1,slotProps:g={},slots:v={}}=e,y=(0,Ne.A)(e,oU),[_,E]=t.useState(!0);if(!c&&!u&&(!m||_))return null;let b;if(o)b=o;else if(r){const e=sU(r);b=e&&aU(e)?(0,pI.A)(e).body:(0,pI.A)(null).body}const w=u||!c||m&&!_?void 0:"none",S=m?{in:u,onEnter:()=>{E(!1)},onExited:()=>{E(!0)}}:void 0;return(0,We.jsx)(EI,{disablePortal:a,container:b,children:(0,We.jsx)(lU,(0,ke.A)({anchorEl:r,direction:s,disablePortal:a,modifiers:l,ref:n,open:m?!_:u,placement:d,popperOptions:h,popperRef:p,slotProps:g,slots:v},y,{style:(0,ke.A)({position:"fixed",top:0,left:0,display:w},f),TransitionProps:S,children:i}))})})),dU=uU,hU=["anchorEl","component","components","componentsProps","container","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","transition","slots","slotProps"],pU=(0,wC.Ay)(dU,{name:"MuiPopper",slot:"Root",overridesResolver:(e,t)=>t.root})({}),fU=t.forwardRef((function(e,t){var n;const r=(0,BM.A)(),i=(0,Qe.b)({props:e,name:"MuiPopper"}),{anchorEl:o,component:s,components:a,componentsProps:c,container:l,disablePortal:u,keepMounted:d,modifiers:h,open:p,placement:f,popperOptions:m,popperRef:g,transition:v,slots:y,slotProps:_}=i,E=(0,Ne.A)(i,hU),b=null!=(n=null==y?void 0:y.root)?n:null==a?void 0:a.Root,w=(0,ke.A)({anchorEl:o,container:l,disablePortal:u,keepMounted:d,modifiers:h,open:p,placement:f,popperOptions:m,popperRef:g,transition:v},E);return(0,We.jsx)(pU,(0,ke.A)({as:s,direction:null==r?void 0:r.direction,slots:{root:b},slotProps:null!=_?_:c},w,{ref:t}))})),mU=fU;function gU(e){return(0,AC.Ay)("MuiPickersPopper",e)}(0,Ke.A)("MuiPickersPopper",["root","paper"]);const vU=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).activeElement;return e?e.shadowRoot?vU(e.shadowRoot):e:null},yU="@media (pointer: fine)",_U="undefined"!==typeof navigator&&navigator.userAgent.match(/android\s(\d+)|OS\s(\d+)/i),EU=_U&&_U[1]?parseInt(_U[1],10):null,bU=_U&&_U[2]?parseInt(_U[2],10):null,wU=EU&&EU<10||bU&&bU<13||!1,SU=()=>IL("@media (prefers-reduced-motion: reduce)",{defaultMatches:!1})||wU,TU=["PaperComponent","popperPlacement","ownerState","children","paperSlotProps","paperClasses","onPaperClick","onPaperTouchStart"],CU=(0,wC.Ay)(mU,{name:"MuiPickersPopper",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{zIndex:t.zIndex.modal}})),AU=(0,wC.Ay)(kC,{name:"MuiPickersPopper",slot:"Paper",overridesResolver:(e,t)=>t.paper})((e=>{let{ownerState:t}=e;return(0,ke.A)({outline:0,transformOrigin:"top center"},t.placement.includes("top")&&{transformOrigin:"bottom center"})}));const RU=t.forwardRef(((e,t)=>{const{PaperComponent:n,popperPlacement:r,ownerState:i,children:o,paperSlotProps:s,paperClasses:a,onPaperClick:c,onPaperTouchStart:l}=e,u=(0,Ne.A)(e,TU),d=(0,ke.A)({},i,{placement:r}),h=FM({elementType:n,externalSlotProps:s,additionalProps:{tabIndex:-1,elevation:8,ref:t},className:a,ownerState:d});return(0,We.jsx)(n,(0,ke.A)({},u,h,{onClick:e=>{var t;c(e),null==(t=h.onClick)||t.call(h,e)},onTouchStart:e=>{var t;l(e),null==(t=h.onTouchStart)||t.call(h,e)},ownerState:d,children:o}))}));function IU(e){var n,r,i,o;const s=xL({props:e,name:"MuiPickersPopper"}),{anchorEl:a,children:c,containerRef:l=null,shouldRestoreFocus:u,onBlur:d,onDismiss:h,open:p,role:f,placement:m,slots:g,slotProps:v,reduceAnimations:y}=s;t.useEffect((()=>{function e(e){!p||"Escape"!==e.key&&"Esc"!==e.key||h()}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[h,p]);const _=t.useRef(null);t.useEffect((()=>{"tooltip"===f||u&&!u()||(p?_.current=vU(document):_.current&&_.current instanceof HTMLElement&&setTimeout((()=>{_.current instanceof HTMLElement&&_.current.focus()})))}),[p,f,u]);const[E,b,w]=function(e,n){const r=t.useRef(!1),i=t.useRef(!1),o=t.useRef(null),s=t.useRef(!1);t.useEffect((()=>{if(e)return document.addEventListener("mousedown",t,!0),document.addEventListener("touchstart",t,!0),()=>{document.removeEventListener("mousedown",t,!0),document.removeEventListener("touchstart",t,!0),s.current=!1};function t(){s.current=!0}}),[e]);const a=(0,OI.A)((e=>{if(!s.current)return;const t=i.current;i.current=!1;const a=(0,pI.A)(o.current);if(!o.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,a))return;if(r.current)return void(r.current=!1);let c;c=e.composedPath?e.composedPath().indexOf(o.current)>-1:!a.documentElement.contains(e.target)||o.current.contains(e.target),c||t||n(e)})),c=()=>{i.current=!0};return t.useEffect((()=>{if(e){const e=(0,pI.A)(o.current),t=()=>{r.current=!0};return e.addEventListener("touchstart",a),e.addEventListener("touchmove",t),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",t)}}}),[e,a]),t.useEffect((()=>{if(e){const e=(0,pI.A)(o.current);return e.addEventListener("click",a),()=>{e.removeEventListener("click",a),i.current=!1}}}),[e,a]),[o,c,c]}(p,null!=d?d:h),S=t.useRef(null),T=(0,qC.A)(S,l),C=(0,qC.A)(T,E),A=s,R=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],paper:["paper"]},gU,t)})(A),I=SU(),x=null!=y?y:I,O=(null!=(n=null==g?void 0:g.desktopTransition)?n:x)?TI:hI,k=null!=(r=null==g?void 0:g.desktopTrapFocus)?r:vI,N=null!=(i=null==g?void 0:g.desktopPaper)?i:AU,P=null!=(o=null==g?void 0:g.popper)?o:CU,D=FM({elementType:P,externalSlotProps:null==v?void 0:v.popper,additionalProps:{transition:!0,role:f,open:p,anchorEl:a,placement:m,onKeyDown:e=>{"Escape"===e.key&&(e.stopPropagation(),h())}},className:R.root,ownerState:s});return(0,We.jsx)(P,(0,ke.A)({},D,{children:e=>{let{TransitionProps:t,placement:n}=e;return(0,We.jsx)(k,(0,ke.A)({open:p,disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:"tooltip"===f,isEnabled:()=>!0},null==v?void 0:v.desktopTrapFocus,{children:(0,We.jsx)(O,(0,ke.A)({},t,null==v?void 0:v.desktopTransition,{children:(0,We.jsx)(RU,{PaperComponent:N,ownerState:A,popperPlacement:n,ref:C,onPaperClick:b,onPaperTouchStart:w,paperClasses:R.paper,paperSlotProps:null==v?void 0:v.desktopPaper,children:c})}))}))}}))}var xU=n(3931);function OU(e,n,r,i){const{value:o,onError:s}=e,a=bM(),c=t.useRef(i),l=n({adapter:a,value:o,props:e});return t.useEffect((()=>{s&&!r(l,c.current)&&s(l,o),c.current=l}),[r,s,c,l,o]),l}const kU=e=>{let{timezone:n,value:r,defaultValue:i,onChange:o,valueManager:s}=e;var a,c;const l=wM(),u=t.useRef(i),d=null!=(a=null!=r?r:u.current)?a:s.emptyValue,h=t.useMemo((()=>s.getTimezone(l,d)),[l,s,d]),p=(0,OI.A)((e=>null==h?e:s.setTimezone(l,h,e))),f=null!=(c=null!=n?n:h)?c:"default";return{value:t.useMemo((()=>s.setTimezone(l,f,d)),[s,l,f,d]),handleValueChange:(0,OI.A)((function(e){const t=p(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];null==o||o(t,...r)})),timezone:f}},NU=e=>{let{name:t,timezone:n,value:r,defaultValue:i,onChange:o,valueManager:s}=e;const[a,c]=(0,xU.A)({name:t,state:"value",controlled:r,default:null!=i?i:s.emptyValue}),l=(0,OI.A)((function(e){c(e);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];null==o||o(e,...n)}));return kU({timezone:n,value:a,defaultValue:void 0,onChange:l,valueManager:s})},PU=e=>{let{props:n,valueManager:r,valueType:i,wrapperVariant:o,validator:s}=e;const{onAccept:a,onChange:c,value:l,defaultValue:u,closeOnSelect:d="desktop"===o,selectedSections:h,onSelectedSectionsChange:p,timezone:f}=n,{current:m}=t.useRef(u),{current:g}=t.useRef(void 0!==l);const v=wM(),y=bM(),[_,E]=(0,xU.A)({controlled:h,default:null,name:"usePickerValue",state:"selectedSections"}),{isOpen:b,setIsOpen:w}=(e=>{let{open:n,onOpen:r,onClose:i}=e;const o=t.useRef("boolean"===typeof n).current,[s,a]=t.useState(!1);return t.useEffect((()=>{if(o){if("boolean"!==typeof n)throw new Error("You must not mix controlling and uncontrolled mode for `open` prop");a(n)}}),[o,n]),{isOpen:s,setIsOpen:t.useCallback((e=>{o||a(e),e&&r&&r(),!e&&i&&i()}),[o,r,i])}})(n),[S,T]=t.useState((()=>{let e;return e=void 0!==l?l:void 0!==m?m:r.emptyValue,{draft:e,lastPublishedValue:e,lastCommittedValue:e,lastControlledValue:l,hasBeenModifiedSinceMount:!1}})),{timezone:C,handleValueChange:A}=kU({timezone:f,value:l,defaultValue:m,onChange:c,valueManager:r});OU((0,ke.A)({},n,{value:S.draft,timezone:C}),s,r.isSameError,r.defaultErrorState);const R=(0,OI.A)((e=>{const t={action:e,dateState:S,hasChanged:t=>!r.areValuesEqual(v,e.value,t),isControlled:g,closeOnSelect:d},i=(e=>{const{action:t,hasChanged:n,dateState:r,isControlled:i}=e,o=!i&&!r.hasBeenModifiedSinceMount;return"setValueFromField"===t.name||("setValueFromAction"===t.name?!(!o||!["accept","today","clear"].includes(t.pickerAction))||n(r.lastPublishedValue):("setValueFromView"===t.name&&"shallow"!==t.selectionState||"setValueFromShortcut"===t.name)&&(!!o||n(r.lastPublishedValue)))})(t),o=(e=>{const{action:t,hasChanged:n,dateState:r,isControlled:i,closeOnSelect:o}=e,s=!i&&!r.hasBeenModifiedSinceMount;return"setValueFromAction"===t.name?!(!s||!["accept","today","clear"].includes(t.pickerAction))||n(r.lastCommittedValue):"setValueFromView"===t.name&&"finish"===t.selectionState&&o?!!s||n(r.lastCommittedValue):"setValueFromShortcut"===t.name&&"accept"===t.changeImportance&&n(r.lastCommittedValue)})(t),c=(e=>{const{action:t,closeOnSelect:n}=e;return"setValueFromAction"===t.name||("setValueFromView"===t.name?"finish"===t.selectionState&&n:"setValueFromShortcut"===t.name&&"accept"===t.changeImportance)})(t);if(T((t=>(0,ke.A)({},t,{draft:e.value,lastPublishedValue:i?e.value:t.lastPublishedValue,lastCommittedValue:o?e.value:t.lastCommittedValue,hasBeenModifiedSinceMount:!0}))),i){const t={validationError:"setValueFromField"===e.name?e.context.validationError:s({adapter:y,value:e.value,props:(0,ke.A)({},n,{value:e.value,timezone:C})})};"setValueFromShortcut"===e.name&&null!=e.shortcut&&(t.shortcut=e.shortcut),A(e.value,t)}o&&a&&a(e.value),c&&w(!1)}));if(void 0!==l&&(void 0===S.lastControlledValue||!r.areValuesEqual(v,S.lastControlledValue,l))){const e=r.areValuesEqual(v,S.draft,l);T((t=>(0,ke.A)({},t,{lastControlledValue:l},e?{}:{lastCommittedValue:l,lastPublishedValue:l,draft:l,hasBeenModifiedSinceMount:!0})))}const I=(0,OI.A)((()=>{R({value:r.emptyValue,name:"setValueFromAction",pickerAction:"clear"})})),x=(0,OI.A)((()=>{R({value:S.lastPublishedValue,name:"setValueFromAction",pickerAction:"accept"})})),O=(0,OI.A)((()=>{R({value:S.lastPublishedValue,name:"setValueFromAction",pickerAction:"dismiss"})})),k=(0,OI.A)((()=>{R({value:S.lastCommittedValue,name:"setValueFromAction",pickerAction:"cancel"})})),N=(0,OI.A)((()=>{R({value:r.getTodayValue(v,C,i),name:"setValueFromAction",pickerAction:"today"})})),P=(0,OI.A)((()=>w(!0))),D=(0,OI.A)((()=>w(!1))),L=(0,OI.A)((function(e){return R({name:"setValueFromView",value:e,selectionState:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"partial"})})),M=(0,OI.A)(((e,t,n)=>R({name:"setValueFromShortcut",value:e,changeImportance:null!=t?t:"accept",shortcut:n}))),j=(0,OI.A)(((e,t)=>R({name:"setValueFromField",value:e,context:t}))),U=(0,OI.A)((e=>{E(e),null==p||p(e)})),V={onClear:I,onAccept:x,onDismiss:O,onCancel:k,onSetToday:N,onOpen:P,onClose:D},F={value:S.draft,onChange:j,selectedSections:_,onSelectedSectionsChange:U},B=t.useMemo((()=>r.cleanValue(v,S.draft)),[v,r,S.draft]),W={value:B,onChange:L,onClose:D,open:b,onSelectedSectionsChange:U},z=(0,ke.A)({},V,{value:B,onChange:L,onSelectShortcut:M,isValid:e=>{const t=s({adapter:y,value:e,props:(0,ke.A)({},n,{value:e,timezone:C})});return!r.hasError(t)}});return{open:b,fieldProps:F,viewProps:W,layoutProps:z,actions:V}};function DU(e){let{onChange:n,onViewChange:r,openTo:i,view:o,views:s,autoFocus:a,focusedView:c,onFocusedViewChange:l}=e;var u,d;const h=t.useRef(i),p=t.useRef(s),f=t.useRef(s.includes(i)?i:s[0]),[m,g]=(0,xU.A)({name:"useViews",state:"view",controlled:o,default:f.current}),v=t.useRef(a?m:null),[y,_]=(0,xU.A)({name:"useViews",state:"focusedView",controlled:c,default:v.current});t.useEffect((()=>{(h.current&&h.current!==i||p.current&&p.current.some((e=>!s.includes(e))))&&(g(s.includes(i)?i:s[0]),p.current=s,h.current=i)}),[i,g,m,s]);const E=s.indexOf(m),b=null!=(u=s[E-1])?u:null,w=null!=(d=s[E+1])?d:null,S=(0,OI.A)(((e,t)=>{_(t?e:t=>e===t?null:t),null==l||l(e,t)})),T=(0,OI.A)((e=>{S(e,!0),e!==m&&(g(e),r&&r(e))})),C=(0,OI.A)((()=>{w&&T(w)})),A=(0,OI.A)(((e,t,r)=>{const i="finish"===t,o=r?s.indexOf(r)<s.length-1:Boolean(w);if(n(e,i&&o?"partial":t,r),r&&r!==m){const e=s[s.indexOf(r)+1];e&&T(e)}else i&&C()}));return{view:m,setView:T,focusedView:y,setFocusedView:S,nextView:w,previousView:b,defaultView:s.includes(i)?i:s[0],goToNextView:C,setValueAndGoToNextView:A}}const LU=["className","sx"],MU=e=>{let{props:n,propsFromPickerValue:r,additionalViewProps:i,inputRef:o,autoFocusView:s}=e;const{onChange:a,open:c,onSelectedSectionsChange:l,onClose:u}=r,{view:d,views:h,openTo:p,onViewChange:f,viewRenderers:m,timezone:g}=n,v=(0,Ne.A)(n,LU),{view:y,setView:_,defaultView:E,focusedView:b,setFocusedView:w,setValueAndGoToNextView:S}=DU({view:d,views:h,openTo:p,onChange:a,onViewChange:f,autoFocus:s}),{hasUIView:T,viewModeLookup:C}=t.useMemo((()=>h.reduce(((e,t)=>{let n;return n=null!=m[t]?"UI":"field",e.viewModeLookup[t]=n,"UI"===n&&(e.hasUIView=!0),e}),{hasUIView:!1,viewModeLookup:{}})),[m,h]),A=t.useMemo((()=>h.reduce(((e,t)=>null!=m[t]&&(e=>HL.includes(e))(t)?e+1:e),0)),[m,h]),R=C[y],I=(0,OI.A)((()=>"UI"===R)),[x,O]=t.useState("UI"===R?y:null);x!==y&&"UI"===C[y]&&O(y),(0,yI.A)((()=>{"field"===R&&c&&(u(),setTimeout((()=>{null==o||o.current.focus(),l(y)})))}),[y]),(0,yI.A)((()=>{if(!c)return;let e=y;"field"===R&&null!=x&&(e=x),e!==E&&"UI"===C[e]&&"UI"===C[E]&&(e=E),e!==y&&_(e),w(e,!0)}),[c]);return{hasUIView:T,shouldRestoreFocus:I,layoutProps:{views:h,view:x,onViewChange:_},renderCurrentView:()=>{if(null==x)return null;const e=m[x];return null==e?null:e((0,ke.A)({},v,i,r,{views:h,timezone:g,onChange:S,view:x,onViewChange:_,focusedView:b,onFocusedViewChange:w,showViewSwitcher:A>1,timeViewsCount:A}))}}};function jU(){return"undefined"===typeof window?"portrait":window.screen&&window.screen.orientation&&window.screen.orientation.angle?90===Math.abs(window.screen.orientation.angle)?"landscape":"portrait":window.orientation&&90===Math.abs(Number(window.orientation))?"landscape":"portrait"}const UU=(e,n)=>{const[r,i]=t.useState(jU);if((0,yI.A)((()=>{const e=()=>{i(jU())};return window.addEventListener("orientationchange",e),()=>{window.removeEventListener("orientationchange",e)}}),[]),o=e,s=["hours","minutes","seconds"],Array.isArray(s)?s.every((e=>-1!==o.indexOf(e))):-1!==o.indexOf(s))return!1;var o,s;return"landscape"===(n||r)},VU=(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning",n=!1;const r=Array.isArray(e)?e.join("\n"):e}(["The `renderInput` prop has been removed in version 6.0 of the Date and Time Pickers.","You can replace it with the `textField` component slot in most cases.","For more information, please have a look at the migration guide (https://mui.com/x/migration/migration-pickers-v5/#input-renderer-required-in-v5)."]),e=>{let{props:t,valueManager:n,valueType:r,wrapperVariant:i,inputRef:o,additionalViewProps:s,validator:a,autoFocusView:c}=e;const l=PU({props:t,valueManager:n,valueType:r,wrapperVariant:i,validator:a}),u=MU({props:t,inputRef:o,additionalViewProps:s,autoFocusView:c,propsFromPickerValue:l.viewProps}),d=(e=>{let{props:t,propsFromPickerValue:n,propsFromPickerViews:r,wrapperVariant:i}=e;const{orientation:o}=t,s=UU(r.views,o);return{layoutProps:(0,ke.A)({},r,n,{isLandscape:s,wrapperVariant:i,disabled:t.disabled,readOnly:t.readOnly})}})({props:t,wrapperVariant:i,propsFromPickerValue:l.layoutProps,propsFromPickerViews:u.layoutProps});return{open:l.open,actions:l.actions,fieldProps:l.fieldProps,renderCurrentView:u.renderCurrentView,hasUIView:u.hasUIView,shouldRestoreFocus:u.shouldRestoreFocus,layoutProps:d.layoutProps}});function FU(e){return(0,AC.Ay)("MuiPickersLayout",e)}const BU=(0,Ke.A)("MuiPickersLayout",["root","landscape","contentWrapper","toolbar","actionBar","tabs","shortcuts"]);function WU(e){return(0,AC.Ay)("MuiDialogActions",e)}(0,Ke.A)("MuiDialogActions",["root","spacing"]);const zU=["className","disableSpacing"],HU=(0,wC.Ay)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),GU=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiDialogActions"}),{className:r,disableSpacing:i=!1}=n,o=(0,Ne.A)(n,zU),s=(0,ke.A)({},n,{disableSpacing:i}),a=(e=>{const{classes:t,disableSpacing:n}=e,r={root:["root",!n&&"spacing"]};return(0,bC.A)(r,WU,t)})(s);return(0,We.jsx)(HU,(0,ke.A)({className:(0,Pe.A)(a.root,r),ownerState:s,ref:t},o))})),qU=GU,KU=["onAccept","onClear","onCancel","onSetToday","actions"];function $U(e){const{onAccept:t,onClear:n,onCancel:r,onSetToday:i,actions:o}=e,s=(0,Ne.A)(e,KU),a=TM();if(null==o||0===o.length)return null;const c=null==o?void 0:o.map((e=>{switch(e){case"clear":return(0,We.jsx)(RR,{onClick:n,children:a.clearButtonLabel},e);case"cancel":return(0,We.jsx)(RR,{onClick:r,children:a.cancelButtonLabel},e);case"accept":return(0,We.jsx)(RR,{onClick:t,children:a.okButtonLabel},e);case"today":return(0,We.jsx)(RR,{onClick:i,children:a.todayButtonLabel},e);default:return null}}));return(0,We.jsx)(qU,(0,ke.A)({},s,{children:c}))}const YU=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");function XU(e){return(0,AC.Ay)("MuiChip",e)}const JU=(0,Ke.A)("MuiChip",["root","sizeSmall","sizeMedium","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),QU=["avatar","className","clickable","color","component","deleteIcon","disabled","icon","label","onClick","onDelete","onKeyDown","onKeyUp","size","variant","tabIndex","skipFocusWhenDisabled"],ZU=(0,wC.Ay)("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{color:r,iconColor:i,clickable:o,onDelete:s,size:a,variant:c}=n;return[{[`& .${JU.avatar}`]:t.avatar},{[`& .${JU.avatar}`]:t[`avatar${(0,SC.A)(a)}`]},{[`& .${JU.avatar}`]:t[`avatarColor${(0,SC.A)(r)}`]},{[`& .${JU.icon}`]:t.icon},{[`& .${JU.icon}`]:t[`icon${(0,SC.A)(a)}`]},{[`& .${JU.icon}`]:t[`iconColor${(0,SC.A)(i)}`]},{[`& .${JU.deleteIcon}`]:t.deleteIcon},{[`& .${JU.deleteIcon}`]:t[`deleteIcon${(0,SC.A)(a)}`]},{[`& .${JU.deleteIcon}`]:t[`deleteIconColor${(0,SC.A)(r)}`]},{[`& .${JU.deleteIcon}`]:t[`deleteIcon${(0,SC.A)(c)}Color${(0,SC.A)(r)}`]},t.root,t[`size${(0,SC.A)(a)}`],t[`color${(0,SC.A)(r)}`],o&&t.clickable,o&&"default"!==r&&t[`clickableColor${(0,SC.A)(r)})`],s&&t.deletable,s&&"default"!==r&&t[`deletableColor${(0,SC.A)(r)}`],t[c],t[`${c}${(0,SC.A)(r)}`]]}})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode?t.palette.grey[700]:t.palette.grey[300];return(0,ke.A)({maxWidth:"100%",fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.action.selected,borderRadius:16,whiteSpace:"nowrap",transition:t.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${JU.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${JU.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:t.vars?t.vars.palette.Chip.defaultAvatarColor:r,fontSize:t.typography.pxToRem(12)},[`& .${JU.avatarColorPrimary}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.dark},[`& .${JU.avatarColorSecondary}`]:{color:(t.vars||t).palette.secondary.contrastText,backgroundColor:(t.vars||t).palette.secondary.dark},[`& .${JU.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:t.typography.pxToRem(10)},[`& .${JU.icon}`]:(0,ke.A)({marginLeft:5,marginRight:-6},"small"===n.size&&{fontSize:18,marginLeft:4,marginRight:-4},n.iconColor===n.color&&(0,ke.A)({color:t.vars?t.vars.palette.Chip.defaultIconColor:r},"default"!==n.color&&{color:"inherit"})),[`& .${JU.deleteIcon}`]:(0,ke.A)({WebkitTapHighlightColor:"transparent",color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.26)`:(0,TC.X4)(t.palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.4)`:(0,TC.X4)(t.palette.text.primary,.4)}},"small"===n.size&&{fontSize:16,marginRight:4,marginLeft:-4},"default"!==n.color&&{color:t.vars?`rgba(${t.vars.palette[n.color].contrastTextChannel} / 0.7)`:(0,TC.X4)(t.palette[n.color].contrastText,.7),"&:hover, &:active":{color:(t.vars||t).palette[n.color].contrastText}})},"small"===n.size&&{height:24},"default"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].main,color:(t.vars||t).palette[n.color].contrastText},n.onDelete&&{[`&.${JU.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,TC.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},n.onDelete&&"default"!==n.color&&{[`&.${JU.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n.color].dark}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},n.clickable&&{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,TC.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity)},[`&.${JU.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,TC.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},"&:active":{boxShadow:(t.vars||t).shadows[1]}},n.clickable&&"default"!==n.color&&{[`&:hover, &.${JU.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n.color].dark}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},"outlined"===n.variant&&{backgroundColor:"transparent",border:t.vars?`1px solid ${t.vars.palette.Chip.defaultBorder}`:`1px solid ${"light"===t.palette.mode?t.palette.grey[400]:t.palette.grey[700]}`,[`&.${JU.clickable}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${JU.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`& .${JU.avatar}`]:{marginLeft:4},[`& .${JU.avatarSmall}`]:{marginLeft:2},[`& .${JU.icon}`]:{marginLeft:4},[`& .${JU.iconSmall}`]:{marginLeft:2},[`& .${JU.deleteIcon}`]:{marginRight:5},[`& .${JU.deleteIconSmall}`]:{marginRight:3}},"outlined"===n.variant&&"default"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / 0.7)`:(0,TC.X4)(t.palette[n.color].main,.7)}`,[`&.${JU.clickable}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity)},[`&.${JU.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.focusOpacity})`:(0,TC.X4)(t.palette[n.color].main,t.palette.action.focusOpacity)},[`& .${JU.deleteIcon}`]:{color:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / 0.7)`:(0,TC.X4)(t.palette[n.color].main,.7),"&:hover, &:active":{color:(t.vars||t).palette[n.color].main}}})})),eV=(0,wC.Ay)("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,t)=>{const{ownerState:n}=e,{size:r}=n;return[t.label,t[`label${(0,SC.A)(r)}`]]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap"},"outlined"===t.variant&&{paddingLeft:11,paddingRight:11},"small"===t.size&&{paddingLeft:8,paddingRight:8},"small"===t.size&&"outlined"===t.variant&&{paddingLeft:7,paddingRight:7})}));function tV(e){return"Backspace"===e.key||"Delete"===e.key}const nV=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiChip"}),{avatar:i,className:o,clickable:s,color:a="default",component:c,deleteIcon:l,disabled:u=!1,icon:d,label:h,onClick:p,onDelete:f,onKeyDown:m,onKeyUp:g,size:v="medium",variant:y="filled",tabIndex:_,skipFocusWhenDisabled:E=!1}=r,b=(0,Ne.A)(r,QU),w=t.useRef(null),S=(0,gA.A)(w,n),T=e=>{e.stopPropagation(),f&&f(e)},C=!(!1===s||!p)||s,A=C||f?JA:c||"div",R=(0,ke.A)({},r,{component:A,disabled:u,size:v,color:a,iconColor:t.isValidElement(d)&&d.props.color||a,onDelete:!!f,clickable:C,variant:y}),I=(e=>{const{classes:t,disabled:n,size:r,color:i,iconColor:o,onDelete:s,clickable:a,variant:c}=e,l={root:["root",c,n&&"disabled",`size${(0,SC.A)(r)}`,`color${(0,SC.A)(i)}`,a&&"clickable",a&&`clickableColor${(0,SC.A)(i)}`,s&&"deletable",s&&`deletableColor${(0,SC.A)(i)}`,`${c}${(0,SC.A)(i)}`],label:["label",`label${(0,SC.A)(r)}`],avatar:["avatar",`avatar${(0,SC.A)(r)}`,`avatarColor${(0,SC.A)(i)}`],icon:["icon",`icon${(0,SC.A)(r)}`,`iconColor${(0,SC.A)(o)}`],deleteIcon:["deleteIcon",`deleteIcon${(0,SC.A)(r)}`,`deleteIconColor${(0,SC.A)(i)}`,`deleteIcon${(0,SC.A)(c)}Color${(0,SC.A)(i)}`]};return(0,bC.A)(l,XU,t)})(R),x=A===JA?(0,ke.A)({component:c||"div",focusVisibleClassName:I.focusVisible},f&&{disableRipple:!0}):{};let O=null;f&&(O=l&&t.isValidElement(l)?t.cloneElement(l,{className:(0,Pe.A)(l.props.className,I.deleteIcon),onClick:T}):(0,We.jsx)(YU,{className:(0,Pe.A)(I.deleteIcon),onClick:T}));let k=null;i&&t.isValidElement(i)&&(k=t.cloneElement(i,{className:(0,Pe.A)(I.avatar,i.props.className)}));let N=null;return d&&t.isValidElement(d)&&(N=t.cloneElement(d,{className:(0,Pe.A)(I.icon,d.props.className)})),(0,We.jsxs)(ZU,(0,ke.A)({as:A,className:(0,Pe.A)(I.root,o),disabled:!(!C||!u)||void 0,onClick:p,onKeyDown:e=>{e.currentTarget===e.target&&tV(e)&&e.preventDefault(),m&&m(e)},onKeyUp:e=>{e.currentTarget===e.target&&(f&&tV(e)?f(e):"Escape"===e.key&&w.current&&w.current.blur()),g&&g(e)},ref:S,tabIndex:E&&u?-1:_,ownerState:R},x,b,{children:[k||N,(0,We.jsx)(eV,{className:(0,Pe.A)(I.label),ownerState:R,children:h}),O]}))})),rV=nV,iV=320,oV=["items","changeImportance","isLandscape","onChange","isValid"],sV=["getValue"];function aV(e){const{items:t,changeImportance:n,onChange:r,isValid:i}=e,o=(0,Ne.A)(e,oV);if(null==t||0===t.length)return null;const s=t.map((e=>{let{getValue:t}=e,o=(0,Ne.A)(e,sV);const s=t({isValid:i});return{label:o.label,onClick:()=>{r(s,n,o)},disabled:!i(s)}}));return(0,We.jsx)(DR,(0,ke.A)({dense:!0,sx:[{maxHeight:334,maxWidth:200,overflow:"auto"},...Array.isArray(o.sx)?o.sx:[o.sx]]},o,{children:s.map((e=>(0,We.jsx)(sO,{children:(0,We.jsx)(rV,(0,ke.A)({},e))},e.label)))}))}const cV=e=>{var t,n;const{wrapperVariant:r,onAccept:i,onClear:o,onCancel:s,onSetToday:a,view:c,views:l,onViewChange:u,value:d,onChange:h,onSelectShortcut:p,isValid:f,isLandscape:m,disabled:g,readOnly:v,children:y,components:_,componentsProps:E,slots:b,slotProps:w}=e,S=null!=b?b:LM(_),T=null!=w?w:E,C=(e=>{const{classes:t,isLandscape:n}=e,r={root:["root",n&&"landscape"],contentWrapper:["contentWrapper"],toolbar:["toolbar"],actionBar:["actionBar"],tabs:["tabs"],landscape:["landscape"],shortcuts:["shortcuts"]};return(0,bC.A)(r,FU,t)})(e),A=null!=(t=null==S?void 0:S.actionBar)?t:$U,R=FM({elementType:A,externalSlotProps:null==T?void 0:T.actionBar,additionalProps:{onAccept:i,onClear:o,onCancel:s,onSetToday:a,actions:"desktop"===r?[]:["cancel","accept"],className:C.actionBar},ownerState:(0,ke.A)({},e,{wrapperVariant:r})}),I=(0,We.jsx)(A,(0,ke.A)({},R)),x=null==S?void 0:S.toolbar,O=FM({elementType:x,externalSlotProps:null==T?void 0:T.toolbar,additionalProps:{isLandscape:m,onChange:h,value:d,view:c,onViewChange:u,views:l,disabled:g,readOnly:v,className:C.toolbar},ownerState:(0,ke.A)({},e,{wrapperVariant:r})}),k=function(e){return null!==e.view}(O)&&x?(0,We.jsx)(x,(0,ke.A)({},O)):null,N=y,P=null==S?void 0:S.tabs,D=c&&P?(0,We.jsx)(P,(0,ke.A)({view:c,onViewChange:u,className:C.tabs},null==T?void 0:T.tabs)):null,L=null!=(n=null==S?void 0:S.shortcuts)?n:aV,M=FM({elementType:L,externalSlotProps:null==T?void 0:T.shortcuts,additionalProps:{isValid:f,isLandscape:m,onChange:p,className:C.shortcuts},ownerState:{isValid:f,isLandscape:m,onChange:p,className:C.shortcuts,wrapperVariant:r}});return{toolbar:k,content:N,tabs:D,actionBar:I,shortcuts:c&&L?(0,We.jsx)(L,(0,ke.A)({},M)):null}},lV=(0,wC.Ay)("div",{name:"MuiPickersLayout",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t,ownerState:n}=e;return{display:"grid",gridAutoColumns:"max-content auto max-content",gridAutoRows:"max-content auto max-content",[`& .${BU.toolbar}`]:n.isLandscape?{gridColumn:"rtl"===t.direction?3:1,gridRow:"2 / 3"}:{gridColumn:"2 / 4",gridRow:1},[`.${BU.shortcuts}`]:n.isLandscape?{gridColumn:"2 / 4",gridRow:1}:{gridColumn:"rtl"===t.direction?3:1,gridRow:"2 / 3"},[`& .${BU.actionBar}`]:{gridColumn:"1 / 4",gridRow:3}}}));lV.propTypes={as:kL().elementType,ownerState:kL().shape({isLandscape:kL().bool.isRequired}).isRequired,sx:kL().oneOfType([kL().arrayOf(kL().oneOfType([kL().func,kL().object,kL().bool])),kL().func,kL().object])};const uV=(0,wC.Ay)("div",{name:"MuiPickersLayout",slot:"ContentWrapper",overridesResolver:(e,t)=>t.contentWrapper})({gridColumn:2,gridRow:2,display:"flex",flexDirection:"column"}),dV=function(e){const n=xL({props:e,name:"MuiPickersLayout"}),{toolbar:r,content:i,tabs:o,actionBar:s,shortcuts:a}=cV(n),{sx:c,className:l,isLandscape:u,ref:d,wrapperVariant:h}=n,p=n,f=(e=>{const{isLandscape:t,classes:n}=e,r={root:["root",t&&"landscape"],contentWrapper:["contentWrapper"]};return(0,bC.A)(r,FU,n)})(p);return(0,We.jsxs)(lV,{ref:d,sx:c,className:(0,Pe.A)(l,f.root),ownerState:p,children:[u?a:r,u?r:a,(0,We.jsx)(uV,{className:f.contentWrapper,children:"desktop"===h?(0,We.jsxs)(t.Fragment,{children:[i,o]}):(0,We.jsxs)(t.Fragment,{children:[o,i]})}),s]})},hV=["props","getOpenDialogAriaText"],pV=["ownerState"],fV=["ownerState"],mV=(0,zC.A)((0,We.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),gV=(0,zC.A)((0,We.jsx)("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"ArrowLeft"),vV=(0,zC.A)((0,We.jsx)("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"ArrowRight"),yV=(0,zC.A)((0,We.jsx)("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}),"Calendar"),_V=((0,zC.A)((0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),(0,We.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Clock"),(0,zC.A)((0,We.jsx)("path",{d:"M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"}),"DateRange"),(0,zC.A)((0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),(0,We.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Time"),(0,zC.A)((0,We.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear")),EV=e=>{const n=wM(),r=TM(),i=bM(),o="rtl"===iI().direction,{valueManager:s,fieldValueManager:a,valueType:c,validator:l,internalProps:u,internalProps:{value:d,defaultValue:h,referenceDate:p,onChange:f,format:m,formatDensity:g="dense",selectedSections:v,onSelectedSectionsChange:y,shouldRespectLeadingZeros:_=!1,timezone:E}}=e,{timezone:b,value:w,handleValueChange:S}=kU({timezone:E,value:d,defaultValue:h,onChange:f,valueManager:s}),T=t.useMemo((()=>((e,t)=>{const n=e.dateWithTimezone(void 0,t),r=e.endOfYear(n),i=e.endOfDay(n),{maxDaysInMonth:o,longestMonth:s}=UL(e,n).reduce(((t,n)=>{const r=e.getDaysInMonth(n);return r>t.maxDaysInMonth?{maxDaysInMonth:r,longestMonth:n}:t}),{maxDaysInMonth:0,longestMonth:null});return{year:n=>{let{format:r}=n;return{minimum:0,maximum:sM(e,t,r)?9999:99}},month:()=>({minimum:1,maximum:e.getMonth(r)+1}),day:t=>{let{currentDate:n}=t;return{minimum:1,maximum:null!=n&&e.isValid(n)?e.getDaysInMonth(n):o,longestMonth:s}},weekDay:n=>{let{format:r,contentType:i}=n;if("digit"===i){const n=XL(e,t,r).map(Number);return{minimum:Math.min(...n),maximum:Math.max(...n)}}return{minimum:1,maximum:7}},hours:t=>{let{format:r}=t;const o=e.getHours(i);return e.formatByString(e.endOfDay(n),r)!==o.toString()?{minimum:1,maximum:Number(e.formatByString(e.startOfDay(n),r))}:{minimum:0,maximum:o}},minutes:()=>({minimum:0,maximum:e.getMinutes(i)}),seconds:()=>({minimum:0,maximum:e.getSeconds(i)}),meridiem:()=>({minimum:0,maximum:0})}})(n,b)),[n,b]),C=t.useCallback((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a.getSectionsFromValue(n,e,t,o,(e=>cM(n,b,r,m,e,g,_,o)))}),[a,m,r,o,_,n,g,b]),A=t.useMemo((()=>a.getValueStrFromSections(C(s.emptyValue),o)),[a,C,s.emptyValue,o]),[R,I]=t.useState((()=>{const e=C(w);lM();const t={sections:e,value:w,referenceValue:s.emptyValue,tempValueStrAndroid:null},r=(e=>Math.max(...e.map((e=>{var t;return null!=(t=qL[e.type])?t:1}))))(e),i=s.getInitialReferenceValue({referenceDate:p,value:w,utils:n,props:u,granularity:r,timezone:b});return(0,ke.A)({},t,{referenceValue:i})})),[x,O]=(0,xU.A)({controlled:v,default:null,name:"useField",state:"selectedSectionIndexes"}),k=e=>{O(e),null==y||y(e),I((e=>(0,ke.A)({},e,{selectedSectionQuery:null})))},N=t.useMemo((()=>{if(null==x)return null;if("all"===x)return{startIndex:0,endIndex:R.sections.length-1,shouldSelectBoundarySelectors:!0};if("number"===typeof x)return{startIndex:x,endIndex:x};if("string"===typeof x){const e=R.sections.findIndex((e=>e.type===x));return{startIndex:e,endIndex:e}}return x}),[x,R.sections]),P=e=>{let{value:t,referenceValue:r,sections:o}=e;if(I((e=>(0,ke.A)({},e,{sections:o,value:t,referenceValue:r,tempValueStrAndroid:null}))),s.areValuesEqual(n,R.value,t))return;const a={validationError:l({adapter:i,value:t,props:(0,ke.A)({},u,{value:t,timezone:b})})};S(t,a)},D=(e,t)=>{const n=[...R.sections];return n[e]=(0,ke.A)({},n[e],{value:t,modified:!0}),rM(n,o)};return t.useEffect((()=>{const e=C(R.value);lM(),I((t=>(0,ke.A)({},t,{sections:e})))}),[m,n.locale]),t.useEffect((()=>{let e=!1;e=!s.areValuesEqual(n,R.value,w)||s.getTimezone(n,R.value)!==s.getTimezone(n,w),e&&I((e=>(0,ke.A)({},e,{value:w,referenceValue:a.updateReferenceValue(n,w,e.referenceValue),sections:C(w)})))}),[w]),{state:R,selectedSectionIndexes:N,setSelectedSections:k,clearValue:()=>{P({value:s.emptyValue,referenceValue:R.referenceValue,sections:C(s.emptyValue)})},clearActiveSection:()=>{if(null==N)return;const e=R.sections[N.startIndex],t=a.getActiveDateManager(n,R,e),r=t.getSections(R.sections).filter((e=>""!==e.value)).length===(""===e.value?0:1),i=D(N.startIndex,""),o=r?null:n.date(new Date("")),s=t.getNewValuesFromNewActiveDate(o);(null!=o&&!n.isValid(o))!==(null!=t.date&&!n.isValid(t.date))?P((0,ke.A)({},s,{sections:i})):I((e=>(0,ke.A)({},e,s,{sections:i,tempValueStrAndroid:null})))},updateSectionValue:e=>{let{activeSection:t,newSectionValue:r,shouldGoToNextSection:i}=e;i&&N&&N.startIndex<R.sections.length-1?k(N.startIndex+1):N&&N.startIndex!==N.endIndex&&k(N.startIndex);const o=a.getActiveDateManager(n,R,t),s=D(N.startIndex,r),c=o.getSections(s),l=((e,t)=>{const n=t.some((e=>"day"===e.type)),r=[],i=[];for(let a=0;a<t.length;a+=1){const e=t[a];n&&"weekDay"===e.type||(r.push(e.format),i.push(tM(e,"non-input")))}const o=r.join(" "),s=i.join(" ");return e.parse(s,o)})(n,c);let u,d;if(null!=l&&n.isValid(l)){const e=dM(n,b,l,c,o.referenceDate,!0);u=o.getNewValuesFromNewActiveDate(e),d=!0}else u=o.getNewValuesFromNewActiveDate(l),d=(null!=l&&!n.isValid(l))!==(null!=o.date&&!n.isValid(o.date));return d?P((0,ke.A)({},u,{sections:s})):I((e=>(0,ke.A)({},e,u,{sections:s,tempValueStrAndroid:null})))},updateValueFromValueStr:e=>{const t=a.parseValueStr(e,R.referenceValue,((e,t)=>{const i=n.parse(e,m);if(null==i||!n.isValid(i))return null;const s=cM(n,b,r,m,i,g,_,o);return dM(n,b,i,s,t,!1)})),i=a.updateReferenceValue(n,t,R.referenceValue);P({value:t,referenceValue:i,sections:C(t,R.sections)})},setTempAndroidValueStr:e=>I((t=>(0,ke.A)({},t,{tempValueStrAndroid:e}))),sectionsValueBoundaries:T,placeholder:A,timezone:b}},bV=e=>null!=e.saveQuery,wV=e=>{let{sections:n,updateSectionValue:r,sectionsValueBoundaries:i,setTempAndroidValueStr:o,timezone:s}=e;const a=wM(),[c,l]=t.useState(null),u=(0,OI.A)((()=>l(null)));t.useEffect((()=>{var e;null!=c&&(null==(e=n[c.sectionIndex])?void 0:e.type)!==c.sectionType&&u()}),[n,c,u]),t.useEffect((()=>{if(null!=c){const e=setTimeout((()=>u()),5e3);return()=>{window.clearTimeout(e)}}return()=>{}}),[c,u]);const d=(e,t,r)=>{let{keyPressed:i,sectionIndex:o}=e;const s=i.toLowerCase(),a=n[o];if(null!=c&&(!r||r(c.value))&&c.sectionIndex===o){const e=`${c.value}${s}`,n=t(e,a);if(!bV(n))return l({sectionIndex:o,value:e,sectionType:a.type}),n}const d=t(s,a);return bV(d)&&!d.saveQuery?(u(),null):(l({sectionIndex:o,value:s,sectionType:a.type}),bV(d)?null:d)},h=(0,OI.A)((e=>{const t=n[e.sectionIndex],c=" "!==e.keyPressed&&!Number.isNaN(Number(e.keyPressed))?(e=>{const t=(e,t)=>{const n=Number(`${e}`),r=i[t.type]({currentDate:null,format:t.format,contentType:t.contentType});if(n>r.maximum)return{saveQuery:!1};if(n<r.minimum)return{saveQuery:!0};const o=Number(`${e}0`)>r.maximum||e.length===r.maximum.toString().length;return{sectionValue:ZL(a,0,n,r,t),shouldGoToNextSection:o}};return d(e,((e,n)=>{if("digit"===n.contentType||"digit-with-letter"===n.contentType)return t(e,n);if("month"===n.type){const r=aM(a,s,"digit","month","MM"),i=t(e,{type:n.type,format:"MM",hasLeadingZerosInFormat:r,hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2});if(bV(i))return i;const o=oM(a,i.sectionValue,"MM",n.format);return(0,ke.A)({},i,{sectionValue:o})}if("weekDay"===n.type){const r=t(e,n);if(bV(r))return r;const i=XL(a,s,n.format)[Number(r.sectionValue)-1];return(0,ke.A)({},r,{sectionValue:i})}return{saveQuery:!1}}),(e=>!Number.isNaN(Number(e))))})(e):(e=>{const t=(e,t,n)=>{const r=t.filter((e=>e.toLowerCase().startsWith(n)));return 0===r.length?{saveQuery:!1}:{sectionValue:r[0],shouldGoToNextSection:1===r.length}},n=(e,n,r,i)=>{const o=e=>JL(a,s,n.type,e);if("letter"===n.contentType)return t(n.format,o(n.format),e);if(r&&null!=i&&"letter"===YL(a,r).contentType){const n=o(r),s=t(0,n,e);return bV(s)?{saveQuery:!1}:(0,ke.A)({},s,{sectionValue:i(s.sectionValue,n)})}return{saveQuery:!1}};return d(e,((e,t)=>{switch(t.type){case"month":{const r=e=>oM(a,e,a.formats.month,t.format);return n(e,t,a.formats.month,r)}case"weekDay":{const r=(e,t)=>t.indexOf(e).toString();return n(e,t,a.formats.weekday,r)}case"meridiem":return n(e,t);default:return{saveQuery:!1}}}))})(e);null==c?o(null):r({activeSection:t,newSectionValue:c.sectionValue,shouldGoToNextSection:c.shouldGoToNextSection})}));return{applyCharacterEditing:h,resetCharacterQuery:u}},SV=["onClick","onKeyDown","onFocus","onBlur","onMouseUp","onPaste","error","clearable","onClear","disabled"],TV=e=>{const n=wM(),{state:r,selectedSectionIndexes:i,setSelectedSections:o,clearValue:s,clearActiveSection:a,updateSectionValue:c,updateValueFromValueStr:l,setTempAndroidValueStr:u,sectionsValueBoundaries:d,placeholder:h,timezone:p}=EV(e),{inputRef:f,internalProps:m,internalProps:{readOnly:g=!1,unstableFieldRef:v,minutesStep:y},forwardedProps:{onClick:_,onKeyDown:E,onFocus:b,onBlur:w,onMouseUp:S,onPaste:T,error:C,clearable:A,onClear:R,disabled:I},fieldValueManager:x,valueManager:O,validator:k}=e,N=(0,Ne.A)(e.forwardedProps,SV),{applyCharacterEditing:P,resetCharacterQuery:D}=wV({sections:r.sections,updateSectionValue:c,sectionsValueBoundaries:d,setTempAndroidValueStr:u,timezone:p}),L=t.useRef(null),M=(0,qC.A)(f,L),j=t.useRef(void 0),U="rtl"===iI().direction,V=t.useMemo((()=>((e,t)=>{const n={};if(!t)return e.forEach(((t,r)=>{const i=0===r?null:r-1,o=r===e.length-1?null:r+1;n[r]={leftIndex:i,rightIndex:o}})),{neighbors:n,startIndex:0,endIndex:e.length-1};const r={},i={};let o=0,s=0,a=e.length-1;for(;a>=0;){s=e.findIndex(((e,t)=>{var n;return t>=o&&(null==(n=e.endSeparator)?void 0:n.includes(" "))&&" / "!==e.endSeparator})),-1===s&&(s=e.length-1);for(let e=s;e>=o;e-=1)i[e]=a,r[a]=e,a-=1;o=s+1}return e.forEach(((t,o)=>{const s=i[o],a=0===s?null:r[s-1],c=s===e.length-1?null:r[s+1];n[o]={leftIndex:a,rightIndex:c}})),{neighbors:n,startIndex:r[0],endIndex:r[e.length-1]}})(r.sections,U)),[r.sections,U]),F=()=>{var e;if(g)return void o(null);const t=null!=(e=L.current.selectionStart)?e:0;let n;n=t<=r.sections[0].startInInput||t>=r.sections[r.sections.length-1].endInInput?1:r.sections.findIndex((e=>e.startInInput-e.startSeparator.length>t));const i=-1===n?r.sections.length-1:n-1;o(i)},B=(0,OI.A)((function(e){if(!e.isDefaultPrevented()){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];null==_||_(e,...n),F()}})),W=(0,OI.A)((e=>{null==S||S(e),e.preventDefault()})),z=(0,OI.A)((function(){null==b||b(...arguments);const e=L.current;window.clearTimeout(j.current),j.current=setTimeout((()=>{e&&e===L.current&&(null!=i||g||(e.value.length&&Number(e.selectionEnd)-Number(e.selectionStart)===e.value.length?o("all"):F()))}))})),H=(0,OI.A)((function(){null==w||w(...arguments),o(null)})),G=(0,OI.A)((e=>{if(null==T||T(e),g)return void e.preventDefault();const t=e.clipboardData.getData("text");if(i&&i.startIndex===i.endIndex){const n=r.sections[i.startIndex],o=/^[a-zA-Z]+$/.test(t),s=/^[0-9]+$/.test(t),a=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(t);if("letter"===n.contentType&&o||"digit"===n.contentType&&s||"digit-with-letter"===n.contentType&&a)return D(),c({activeSection:n,newSectionValue:t,shouldGoToNextSection:!0}),void e.preventDefault();if(o||s)return void e.preventDefault()}e.preventDefault(),D(),l(t)})),q=(0,OI.A)((e=>{if(g)return;const t=e.target.value;if(""===t)return D(),void s();const n=e.nativeEvent.data,o=n&&n.length>1,c=o?n:t,d=nM(c);if(null==i||o)return void l(o?n:d);let h;if(0===i.startIndex&&i.endIndex===r.sections.length-1&&1===d.length)h=d;else{const e=nM(x.getValueStrFromSections(r.sections,U));let t=-1,n=-1;for(let r=0;r<e.length;r+=1)-1===t&&e[r]!==d[r]&&(t=r),-1===n&&e[e.length-r-1]!==d[d.length-r-1]&&(n=r);const o=r.sections[i.startIndex];if(t<o.start||e.length-n-1>o.end)return;const s=d.length-e.length+o.end-nM(o.endSeparator||"").length;h=d.slice(o.start+nM(o.startSeparator||"").length,s)}0!==h.length?P({keyPressed:h,sectionIndex:i.startIndex}):navigator.userAgent.toLowerCase().indexOf("android")>-1?u(c):(D(),a())})),K=(0,OI.A)((e=>{switch(null==E||E(e),!0){case"a"===e.key&&(e.ctrlKey||e.metaKey):e.preventDefault(),o("all");break;case"ArrowRight"===e.key:if(e.preventDefault(),null==i)o(V.startIndex);else if(i.startIndex!==i.endIndex)o(i.endIndex);else{const e=V.neighbors[i.startIndex].rightIndex;null!==e&&o(e)}break;case"ArrowLeft"===e.key:if(e.preventDefault(),null==i)o(V.endIndex);else if(i.startIndex!==i.endIndex)o(i.startIndex);else{const e=V.neighbors[i.startIndex].leftIndex;null!==e&&o(e)}break;case"Delete"===e.key:if(e.preventDefault(),g)break;null==i||0===i.startIndex&&i.endIndex===r.sections.length-1?s():a(),D();break;case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(e.key):{if(e.preventDefault(),g||null==i)break;const t=r.sections[i.startIndex],o=x.getActiveDateManager(n,r,t),s=eM(n,p,t,e.key,d,o.date,{minutesStep:y});c({activeSection:t,newSectionValue:s,shouldGoToNextSection:!1});break}}}));(0,yI.A)((()=>{if(!L.current)return;if(null==i)return void(L.current.scrollLeft&&(L.current.scrollLeft=0));const e=r.sections[i.startIndex],t=r.sections[i.endIndex];let n=e.startInInput,o=t.endInInput;if(i.shouldSelectBoundarySelectors&&(n-=e.startSeparator.length,o+=t.endSeparator.length),n!==L.current.selectionStart||o!==L.current.selectionEnd){const e=L.current.scrollTop;L.current===vU(document)&&L.current.setSelectionRange(n,o),L.current.scrollTop=e}}));const $=OU((0,ke.A)({},m,{value:r.value,timezone:p}),k,O.isSameError,O.defaultErrorState),Y=t.useMemo((()=>void 0!==C?C:O.hasError($)),[O,$,C]);t.useEffect((()=>{Y||i||D()}),[r.referenceValue,i,Y]),t.useEffect((()=>(L.current&&L.current===document.activeElement&&o("all"),()=>window.clearTimeout(j.current))),[]),t.useEffect((()=>{null!=r.tempValueStrAndroid&&null!=i&&(D(),a())}),[r.tempValueStrAndroid]);const X=t.useMemo((()=>{var e;return null!=(e=r.tempValueStrAndroid)?e:x.getValueStrFromSections(r.sections,U)}),[r.sections,x,r.tempValueStrAndroid,U]),J=t.useMemo((()=>null==i||"letter"===r.sections[i.startIndex].contentType?"text":"numeric"),[i,r.sections]),Q=L.current&&L.current===vU(document),Z=O.areValuesEqual(n,r.value,O.emptyValue),ee=!Q&&Z;t.useImperativeHandle(v,(()=>({getSections:()=>r.sections,getActiveSectionIndex:()=>{var e,t,n;const i=null!=(e=L.current.selectionStart)?e:0,o=null!=(t=L.current.selectionEnd)?t:0,s=!(null==(n=L.current)||!n.readOnly);if(0===i&&0===o||s)return null;const a=i<=r.sections[0].startInInput?1:r.sections.findIndex((e=>e.startInInput-e.startSeparator.length>i));return-1===a?r.sections.length-1:a-1},setSelectedSections:e=>o(e)})));const te=(0,OI.A)((function(e){var t;e.preventDefault();for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];null==R||R(e,...r),s(),null==L||null==(t=L.current)||t.focus(),o(0)}));return(0,ke.A)({placeholder:h,autoComplete:"off",disabled:Boolean(I)},N,{value:ee?"":X,inputMode:J,readOnly:g,onClick:B,onFocus:z,onBlur:H,onPaste:G,onChange:q,onKeyDown:K,onMouseUp:W,onClear:te,error:Y,ref:M,clearable:Boolean(A&&!Z&&!g&&!I)})},CV=["disablePast","disableFuture","minDate","maxDate","shouldDisableDate","shouldDisableMonth","shouldDisableYear"],AV=["disablePast","disableFuture","minTime","maxTime","shouldDisableClock","shouldDisableTime","minutesStep","ampm","disableIgnoringDatePartForTimeValidation"],RV=["minDateTime","maxDateTime"],IV=[...CV,...AV,...RV],xV=e=>IV.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{}),OV=["value","defaultValue","referenceDate","format","formatDensity","onChange","timezone","readOnly","onError","shouldRespectLeadingZeros","selectedSections","onSelectedSectionsChange","unstableFieldRef"],kV=e=>{let{props:t,inputRef:n}=e;const r=(e=>{var t,n,r;const i=wM(),o=SM();return(0,ke.A)({},e,{disablePast:null!=(t=e.disablePast)&&t,disableFuture:null!=(n=e.disableFuture)&&n,format:null!=(r=e.format)?r:i.formats.keyboardDate,minDate:jL(i,e.minDate,o.minDate),maxDate:jL(i,e.maxDate,o.maxDate)})})(t),{forwardedProps:i,internalProps:o}=((e,t)=>{const n=(0,ke.A)({},e),r={},i=e=>{n.hasOwnProperty(e)&&(r[e]=n[e],delete n[e])};return OV.forEach(i),"date"===t?CV.forEach(i):"time"===t?AV.forEach(i):"date-time"===t&&(CV.forEach(i),AV.forEach(i),RV.forEach(i)),{forwardedProps:n,internalProps:r}})(r,"date");return TV({inputRef:n,forwardedProps:i,internalProps:o,valueManager:pM,fieldValueManager:fM,validator:jM,valueType:"date"})},NV=["ownerState"],PV=["components","componentsProps","slots","slotProps","InputProps","inputProps"],DV=["inputRef"],LV=["ref","onPaste","onKeyDown","inputMode","readOnly","clearable","onClear"],MV=t.forwardRef((function(e,n){var r,i,o;const s=xL({props:e,name:"MuiDateField"}),{components:a,componentsProps:c,slots:l,slotProps:u,InputProps:d,inputProps:h}=s,p=(0,Ne.A)(s,PV),f=s,m=null!=(r=null!=(i=null==l?void 0:l.textField)?i:null==a?void 0:a.TextField)?r:CN,g=FM({elementType:m,externalSlotProps:null!=(o=null==u?void 0:u.textField)?o:null==c?void 0:c.textField,externalForwardedProps:p,ownerState:f}),{inputRef:v}=g,y=(0,Ne.A)(g,DV);y.inputProps=(0,ke.A)({},h,y.inputProps),y.InputProps=(0,ke.A)({},d,y.InputProps);const _=kV({props:y,inputRef:v}),{ref:E,onPaste:b,onKeyDown:w,inputMode:S,readOnly:T,clearable:C,onClear:A}=_,R=(0,Ne.A)(_,LV),{InputProps:I,fieldProps:x}=(e=>{let{clearable:n,fieldProps:r,InputProps:i,onClear:o,slots:s,slotProps:a,components:c,componentsProps:l}=e;var u,d,h,p,f,m;const g=TM(),v=null!=(u=null!=(d=null==s?void 0:s.clearButton)?d:null==c?void 0:c.ClearButton)?u:rR,y=FM({elementType:v,externalSlotProps:null!=(h=null==a?void 0:a.clearButton)?h:null==l?void 0:l.clearButton,ownerState:{},className:"clearButton",additionalProps:{title:g.fieldClearLabel}}),_=(0,Ne.A)(y,NV),E=null!=(p=null!=(f=null==s?void 0:s.clearIcon)?f:null==c?void 0:c.ClearIcon)?p:_V,b=FM({elementType:E,externalSlotProps:null!=(m=null==a?void 0:a.clearIcon)?m:null==l?void 0:l.clearIcon,ownerState:{}});return{InputProps:(0,ke.A)({},i,{endAdornment:(0,We.jsxs)(t.Fragment,{children:[n&&(0,We.jsx)(TL,{position:"end",sx:{marginRight:null!=i&&i.endAdornment?-1:-1.5},children:(0,We.jsx)(v,(0,ke.A)({},_,{onClick:o,children:(0,We.jsx)(E,(0,ke.A)({fontSize:"small"},b))}))}),null==i?void 0:i.endAdornment]})}),fieldProps:(0,ke.A)({},r,{sx:[{"& .clearButton":{opacity:1},"@media (pointer: fine)":{"& .clearButton":{opacity:0},"&:hover, &:focus-within":{".clearButton":{opacity:1}}}},...Array.isArray(r.sx)?r.sx:[r.sx]]})}})({onClear:A,clearable:C,fieldProps:R,InputProps:R.InputProps,slots:l,slotProps:u,components:a,componentsProps:c});return(0,We.jsx)(m,(0,ke.A)({ref:n},x,{InputProps:(0,ke.A)({},I,{readOnly:T}),inputProps:(0,ke.A)({},R.inputProps,{inputMode:S,onPaste:b,onKeyDown:w,ref:E})}))})),jV=e=>{let{shouldDisableDate:n,shouldDisableMonth:r,shouldDisableYear:i,minDate:o,maxDate:s,disableFuture:a,disablePast:c,timezone:l}=e;const u=bM();return t.useCallback((e=>null!==jM({adapter:u,value:e,props:{shouldDisableDate:n,shouldDisableMonth:r,shouldDisableYear:i,minDate:o,maxDate:s,disableFuture:a,disablePast:c,timezone:l}})),[u,n,r,i,o,s,a,c,l])},UV=e=>{const{value:n,referenceDate:r,defaultCalendarMonth:i,disableFuture:o,disablePast:s,disableSwitchToMonthOnDayFocus:a=!1,maxDate:c,minDate:l,onMonthChange:u,reduceAnimations:d,shouldDisableDate:h,timezone:p}=e,f=wM(),m=t.useRef(((e,t,n)=>(r,i)=>{switch(i.type){case"changeMonth":return(0,ke.A)({},r,{slideDirection:i.direction,currentMonth:i.newMonth,isMonthSwitchingAnimating:!e});case"finishMonthSwitchingAnimation":return(0,ke.A)({},r,{isMonthSwitchingAnimating:!1});case"changeFocusedDay":{if(null!=r.focusedDay&&null!=i.focusedDay&&n.isSameDay(i.focusedDay,r.focusedDay))return r;const o=null!=i.focusedDay&&!t&&!n.isSameMonth(r.currentMonth,i.focusedDay);return(0,ke.A)({},r,{focusedDay:i.focusedDay,isMonthSwitchingAnimating:o&&!e&&!i.withoutMonthSwitchingAnimation,currentMonth:o?n.startOfMonth(i.focusedDay):r.currentMonth,slideDirection:null!=i.focusedDay&&n.isAfterDay(i.focusedDay,r.currentMonth)?"left":"right"})}default:throw new Error("missing support")}})(Boolean(d),a,f)).current,g=t.useMemo((()=>{let t=null;return r?t=r:i&&(t=f.startOfMonth(i)),pM.getInitialReferenceValue({value:n,utils:f,timezone:p,props:e,referenceDate:t,granularity:qL.day})}),[]),[v,y]=t.useReducer(m,{isMonthSwitchingAnimating:!1,focusedDay:g,currentMonth:f.startOfMonth(g),slideDirection:"left"}),_=t.useCallback((e=>{y((0,ke.A)({type:"changeMonth"},e)),u&&u(e.newMonth)}),[u]),E=t.useCallback((e=>{const t=e;f.isSameMonth(t,v.currentMonth)||_({newMonth:f.startOfMonth(t),direction:f.isAfterDay(t,v.currentMonth)?"left":"right"})}),[v.currentMonth,_,f]),b=jV({shouldDisableDate:h,minDate:l,maxDate:c,disableFuture:o,disablePast:s,timezone:p}),w=t.useCallback((()=>{y({type:"finishMonthSwitchingAnimation"})}),[]),S=(0,OI.A)(((e,t)=>{b(e)||y({type:"changeFocusedDay",focusedDay:e,withoutMonthSwitchingAnimation:t})}));return{referenceDate:g,calendarState:v,changeMonth:E,changeFocusedDay:S,isDateDisabled:b,onMonthSwitchingAnimationEnd:w,handleChangeMonth:_}},VV=e=>(0,AC.Ay)("MuiPickersFadeTransitionGroup",e),FV=((0,Ke.A)("MuiPickersFadeTransitionGroup",["root"]),(0,wC.Ay)(IA,{name:"MuiPickersFadeTransitionGroup",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"block",position:"relative"}));function BV(e){const t=xL({props:e,name:"MuiPickersFadeTransitionGroup"}),{children:n,className:r,reduceAnimations:i,transKey:o}=t,s=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},VV,t)})(t),a=iI();return i?n:(0,We.jsx)(FV,{className:(0,Pe.A)(s.root,r),children:(0,We.jsx)(TI,{appear:!1,mountOnEnter:!0,unmountOnExit:!0,timeout:{appear:a.transitions.duration.enteringScreen,enter:a.transitions.duration.enteringScreen,exit:0},children:n},o)})}var WV=n(6747);function zV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,WV.A)(e,t,n)}function HV(e){if(e.type)return e;if("#"===e.charAt(0))return HV(function(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?`rgb${4===n.length?"a":""}(${n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,TO.A)(9,e));let r,i=e.substring(t+1,e.length-1);if("color"===n){if(i=i.split(" "),r=i.shift(),4===i.length&&"/"===i[3].charAt(0)&&(i[3]=i[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error((0,TO.A)(10,r))}else i=i.split(",");return i=i.map((e=>parseFloat(e))),{type:n,values:i,colorSpace:r}}function GV(e){const{type:t,colorSpace:n}=e;let{values:r}=e;return-1!==t.indexOf("rgb")?r=r.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),r=-1!==t.indexOf("color")?`${n} ${r.join(" ")}`:`${r.join(", ")}`,`${t}(${r})`}function qV(e,t){return e=HV(e),t=zV(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,GV(e)}function KV(e){return(0,AC.Ay)("MuiPickersDay",e)}const $V=(0,Ke.A)("MuiPickersDay",["root","dayWithMargin","dayOutsideMonth","hiddenDaySpacingFiller","today","selected","disabled"]),YV=["autoFocus","className","day","disabled","disableHighlightToday","disableMargin","hidden","isAnimating","onClick","onDaySelect","onFocus","onBlur","onKeyDown","onMouseDown","onMouseEnter","outsideCurrentMonth","selected","showDaysOutsideCurrentMonth","children","today","isFirstVisibleCell","isLastVisibleCell"],XV=e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},t.typography.caption,{width:36,height:36,borderRadius:"50%",padding:0,backgroundColor:"transparent",transition:t.transitions.create("background-color",{duration:t.transitions.duration.short}),color:(t.vars||t).palette.text.primary,"@media (pointer: fine)":{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:qV(t.palette.primary.main,t.palette.action.hoverOpacity)}},"&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.focusOpacity})`:qV(t.palette.primary.main,t.palette.action.focusOpacity),[`&.${$V.selected}`]:{willChange:"background-color",backgroundColor:(t.vars||t).palette.primary.dark}},[`&.${$V.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,fontWeight:t.typography.fontWeightMedium,"&:hover":{willChange:"background-color",backgroundColor:(t.vars||t).palette.primary.dark}},[`&.${$V.disabled}:not(.${$V.selected})`]:{color:(t.vars||t).palette.text.disabled},[`&.${$V.disabled}&.${$V.selected}`]:{opacity:.6}},!n.disableMargin&&{margin:"0 2px"},n.outsideCurrentMonth&&n.showDaysOutsideCurrentMonth&&{color:(t.vars||t).palette.text.secondary},!n.disableHighlightToday&&n.today&&{[`&:not(.${$V.selected})`]:{border:`1px solid ${(t.vars||t).palette.text.secondary}`}})},JV=(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableMargin&&t.dayWithMargin,!n.disableHighlightToday&&n.today&&t.today,!n.outsideCurrentMonth&&n.showDaysOutsideCurrentMonth&&t.dayOutsideMonth,n.outsideCurrentMonth&&!n.showDaysOutsideCurrentMonth&&t.hiddenDaySpacingFiller]},QV=(0,wC.Ay)(JA,{name:"MuiPickersDay",slot:"Root",overridesResolver:JV})(XV),ZV=(0,wC.Ay)("div",{name:"MuiPickersDay",slot:"Root",overridesResolver:JV})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({},XV({theme:t,ownerState:n}),{opacity:0,pointerEvents:"none"})})),eF=()=>{},tF=t.forwardRef((function(e,n){const r=xL({props:e,name:"MuiPickersDay"}),{autoFocus:i=!1,className:o,day:s,disabled:a=!1,disableHighlightToday:c=!1,disableMargin:l=!1,isAnimating:u,onClick:d,onDaySelect:h,onFocus:p=eF,onBlur:f=eF,onKeyDown:m=eF,onMouseDown:g=eF,onMouseEnter:v=eF,outsideCurrentMonth:y,selected:_=!1,showDaysOutsideCurrentMonth:E=!1,children:b,today:w=!1}=r,S=(0,Ne.A)(r,YV),T=(0,ke.A)({},r,{autoFocus:i,disabled:a,disableHighlightToday:c,disableMargin:l,selected:_,showDaysOutsideCurrentMonth:E,today:w}),C=(e=>{const{selected:t,disableMargin:n,disableHighlightToday:r,today:i,disabled:o,outsideCurrentMonth:s,showDaysOutsideCurrentMonth:a,classes:c}=e,l=s&&!a,u={root:["root",t&&!l&&"selected",o&&"disabled",!n&&"dayWithMargin",!r&&i&&"today",s&&a&&"dayOutsideMonth",l&&"hiddenDaySpacingFiller"],hiddenDaySpacingFiller:["hiddenDaySpacingFiller"]};return(0,bC.A)(u,KV,c)})(T),A=wM(),R=t.useRef(null),I=(0,qC.A)(R,n);(0,yI.A)((()=>{!i||a||u||y||R.current.focus()}),[i,a,u,y]);return y&&!E?(0,We.jsx)(ZV,{className:(0,Pe.A)(C.root,C.hiddenDaySpacingFiller,o),ownerState:T,role:S.role}):(0,We.jsx)(QV,(0,ke.A)({className:(0,Pe.A)(C.root,o),ref:I,centerRipple:!0,disabled:a,tabIndex:_?0:-1,onKeyDown:e=>m(e,s),onFocus:e=>p(e,s),onBlur:e=>f(e,s),onMouseEnter:e=>v(e,s),onClick:e=>{a||h(s),y&&e.currentTarget.focus(),d&&d(e)},onMouseDown:e=>{g(e),y&&e.preventDefault()}},S,{ownerState:T,children:b||A.format(s,"dayOfMonth")}))})),nF=t.memo(tF);function rF(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var iF=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return r=t,void((n=e).classList?n.classList.remove(r):"string"===typeof n.className?n.className=rF(n.className,r):n.setAttribute("class",rF(n.className&&n.className.baseVal||"",r)));var n,r}))},oF=function(e){function n(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,n){var r=t.resolveArguments(e,n),i=r[0],o=r[1];t.removeClasses(i,"exit"),t.addClass(i,o?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,n)},t.onEntering=function(e,n){var r=t.resolveArguments(e,n),i=r[0],o=r[1]?"appear":"enter";t.addClass(i,o,"active"),t.props.onEntering&&t.props.onEntering(e,n)},t.onEntered=function(e,n){var r=t.resolveArguments(e,n),i=r[0],o=r[1]?"appear":"enter";t.removeClasses(i,o),t.addClass(i,o,"done"),t.props.onEntered&&t.props.onEntered(e,n)},t.onExit=function(e){var n=t.resolveArguments(e)[0];t.removeClasses(n,"appear"),t.removeClasses(n,"enter"),t.addClass(n,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var n=t.resolveArguments(e)[0];t.addClass(n,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var n=t.resolveArguments(e)[0];t.removeClasses(n,"exit"),t.addClass(n,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,n){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,n]},t.getClassNames=function(e){var n=t.props.classNames,r="string"===typeof n,i=r?""+(r&&n?n+"-":"")+e:n[e];return{baseClassName:i,activeClassName:r?i+"-active":n[e+"Active"],doneClassName:r?i+"-done":n[e+"Done"]}},t}bA(n,e);var r=n.prototype;return r.addClass=function(e,t,n){var r=this.getClassNames(t)[n+"ClassName"],i=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===n&&i&&(r+=" "+i),"active"===n&&e&&YR(e),r&&(this.appliedClasses[t][n]=r,function(e,t){e&&t&&t.split(" ").forEach((function(t){return r=t,void((n=e).classList?n.classList.add(r):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(n,r)||("string"===typeof n.className?n.className=n.className+" "+r:n.setAttribute("class",(n.className&&n.className.baseVal||"")+" "+r)));var n,r}))}(e,r))},r.removeClasses=function(e,t){var n=this.appliedClasses[t],r=n.base,i=n.active,o=n.done;this.appliedClasses[t]={},r&&iF(e,r),i&&iF(e,i),o&&iF(e,o)},r.render=function(){var e=this.props,n=(e.classNames,(0,Ne.A)(e,["classNames"]));return t.createElement(rI,(0,ke.A)({},n,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},n}(t.Component);oF.defaultProps={classNames:""},oF.propTypes={};const sF=oF,aF=e=>(0,AC.Ay)("MuiPickersSlideTransition",e),cF=(0,Ke.A)("MuiPickersSlideTransition",["root","slideEnter-left","slideEnter-right","slideEnterActive","slideExit","slideExitActiveLeft-left","slideExitActiveLeft-right"]),lF=["children","className","reduceAnimations","slideDirection","transKey","classes"],uF=(0,wC.Ay)(IA,{name:"MuiPickersSlideTransition",slot:"Root",overridesResolver:(e,t)=>[t.root,{[`.${cF["slideEnter-left"]}`]:t["slideEnter-left"]},{[`.${cF["slideEnter-right"]}`]:t["slideEnter-right"]},{[`.${cF.slideEnterActive}`]:t.slideEnterActive},{[`.${cF.slideExit}`]:t.slideExit},{[`.${cF["slideExitActiveLeft-left"]}`]:t["slideExitActiveLeft-left"]},{[`.${cF["slideExitActiveLeft-right"]}`]:t["slideExitActiveLeft-right"]}]})((e=>{let{theme:t}=e;const n=t.transitions.create("transform",{duration:t.transitions.duration.complex,easing:"cubic-bezier(0.35, 0.8, 0.4, 1)"});return{display:"block",position:"relative",overflowX:"hidden","& > *":{position:"absolute",top:0,right:0,left:0},[`& .${cF["slideEnter-left"]}`]:{willChange:"transform",transform:"translate(100%)",zIndex:1},[`& .${cF["slideEnter-right"]}`]:{willChange:"transform",transform:"translate(-100%)",zIndex:1},[`& .${cF.slideEnterActive}`]:{transform:"translate(0%)",transition:n},[`& .${cF.slideExit}`]:{transform:"translate(0%)"},[`& .${cF["slideExitActiveLeft-left"]}`]:{willChange:"transform",transform:"translate(-100%)",transition:n,zIndex:0},[`& .${cF["slideExitActiveLeft-right"]}`]:{willChange:"transform",transform:"translate(100%)",transition:n,zIndex:0}}}));const dF=e=>(0,AC.Ay)("MuiDayCalendar",e),hF=((0,Ke.A)("MuiDayCalendar",["root","header","weekDayLabel","loadingContainer","slideTransition","monthContainer","weekContainer","weekNumberLabel","weekNumber"]),["parentProps","day","focusableDay","selectedDays","isDateDisabled","currentMonthNumber","isViewFocused"]),pF=["ownerState"],fF=(0,wC.Ay)("div",{name:"MuiDayCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({}),mF=(0,wC.Ay)("div",{name:"MuiDayCalendar",slot:"Header",overridesResolver:(e,t)=>t.header})({display:"flex",justifyContent:"center",alignItems:"center"}),gF=(0,wC.Ay)(mA,{name:"MuiDayCalendar",slot:"WeekDayLabel",overridesResolver:(e,t)=>t.weekDayLabel})((e=>{let{theme:t}=e;return{width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(t.vars||t).palette.text.secondary}})),vF=(0,wC.Ay)(mA,{name:"MuiDayCalendar",slot:"WeekNumberLabel",overridesResolver:(e,t)=>t.weekNumberLabel})((e=>{let{theme:t}=e;return{width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:t.palette.text.disabled}})),yF=(0,wC.Ay)(mA,{name:"MuiDayCalendar",slot:"WeekNumber",overridesResolver:(e,t)=>t.weekNumber})((e=>{let{theme:t}=e;return(0,ke.A)({},t.typography.caption,{width:36,height:36,padding:0,margin:"0 2px",color:t.palette.text.disabled,fontSize:"0.75rem",alignItems:"center",justifyContent:"center",display:"inline-flex"})})),_F=(0,wC.Ay)("div",{name:"MuiDayCalendar",slot:"LoadingContainer",overridesResolver:(e,t)=>t.loadingContainer})({display:"flex",justifyContent:"center",alignItems:"center",minHeight:240}),EF=(0,wC.Ay)((function(e){const n=xL({props:e,name:"MuiPickersSlideTransition"}),{children:r,className:i,reduceAnimations:o,transKey:s}=n,a=(0,Ne.A)(n,lF),c=(e=>{const{classes:t,slideDirection:n}=e,r={root:["root"],exit:["slideExit"],enterActive:["slideEnterActive"],enter:[`slideEnter-${n}`],exitActive:[`slideExitActiveLeft-${n}`]};return(0,bC.A)(r,aF,t)})(n),l=iI();if(o)return(0,We.jsx)("div",{className:(0,Pe.A)(c.root,i),children:r});const u={exit:c.exit,enterActive:c.enterActive,enter:c.enter,exitActive:c.exitActive};return(0,We.jsx)(uF,{className:(0,Pe.A)(c.root,i),childFactory:e=>t.cloneElement(e,{classNames:u}),role:"presentation",children:(0,We.jsx)(sF,(0,ke.A)({mountOnEnter:!0,unmountOnExit:!0,timeout:l.transitions.duration.complex,classNames:u},a,{children:r}),s)})}),{name:"MuiDayCalendar",slot:"SlideTransition",overridesResolver:(e,t)=>t.slideTransition})({minHeight:240}),bF=(0,wC.Ay)("div",{name:"MuiDayCalendar",slot:"MonthContainer",overridesResolver:(e,t)=>t.monthContainer})({overflow:"hidden"}),wF=(0,wC.Ay)("div",{name:"MuiDayCalendar",slot:"WeekContainer",overridesResolver:(e,t)=>t.weekContainer})({margin:"2px 0",display:"flex",justifyContent:"center"});function SF(e){var n,r,i;let{parentProps:o,day:s,focusableDay:a,selectedDays:c,isDateDisabled:l,currentMonthNumber:u,isViewFocused:d}=e,h=(0,Ne.A)(e,hF);const{disabled:p,disableHighlightToday:f,isMonthSwitchingAnimating:m,showDaysOutsideCurrentMonth:g,components:v,componentsProps:y,slots:_,slotProps:E,timezone:b}=o,w=wM(),S=CM(b),T=null!==a&&w.isSameDay(s,a),C=c.some((e=>w.isSameDay(e,s))),A=w.isSameDay(s,S),R=null!=(n=null!=(r=null==_?void 0:_.day)?r:null==v?void 0:v.Day)?n:nF,I=FM({elementType:R,externalSlotProps:null!=(i=null==E?void 0:E.day)?i:null==y?void 0:y.day,additionalProps:(0,ke.A)({disableHighlightToday:f,showDaysOutsideCurrentMonth:g,role:"gridcell",isAnimating:m,"data-timestamp":w.toJsDate(s).valueOf()},h),ownerState:(0,ke.A)({},o,{day:s,selected:C})}),x=(0,Ne.A)(I,pF),O=t.useMemo((()=>p||l(s)),[p,l,s]),k=t.useMemo((()=>w.getMonth(s)!==u),[w,s,u]),N=t.useMemo((()=>{const e=w.startOfMonth(w.setMonth(s,u));return g?w.isSameDay(s,w.startOfWeek(e)):w.isSameDay(s,e)}),[u,s,g,w]),P=t.useMemo((()=>{const e=w.endOfMonth(w.setMonth(s,u));return g?w.isSameDay(s,w.endOfWeek(e)):w.isSameDay(s,e)}),[u,s,g,w]);return(0,We.jsx)(R,(0,ke.A)({},x,{day:s,disabled:O,autoFocus:d&&T,today:A,outsideCurrentMonth:k,isFirstVisibleCell:N,isLastVisibleCell:P,selected:C,tabIndex:T?0:-1,"aria-selected":C,"aria-current":A?"date":void 0}))}function TF(e){const n=xL({props:e,name:"MuiDayCalendar"}),{onFocusedDayChange:r,className:i,currentMonth:o,selectedDays:s,focusedDay:a,loading:c,onSelectedDaysChange:l,onMonthSwitchingAnimationEnd:u,readOnly:d,reduceAnimations:h,renderLoading:p=()=>(0,We.jsx)("span",{children:"..."}),slideDirection:f,TransitionProps:m,disablePast:g,disableFuture:v,minDate:y,maxDate:_,shouldDisableDate:E,shouldDisableMonth:b,shouldDisableYear:w,dayOfWeekFormatter:S,hasFocus:T,onFocusedViewChange:C,gridLabelId:A,displayWeekNumber:R,fixedWeekNumber:I,autoFocus:x,timezone:O}=n,k=CM(O),N=wM(),P=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],header:["header"],weekDayLabel:["weekDayLabel"],loadingContainer:["loadingContainer"],slideTransition:["slideTransition"],monthContainer:["monthContainer"],weekContainer:["weekContainer"],weekNumberLabel:["weekNumberLabel"],weekNumber:["weekNumber"]},dF,t)})(n),D="rtl"===iI().direction,L=S||((e,t)=>N.format(t,"weekdayShort").charAt(0).toUpperCase()),M=jV({shouldDisableDate:E,shouldDisableMonth:b,shouldDisableYear:w,minDate:y,maxDate:_,disablePast:g,disableFuture:v,timezone:O}),j=TM(),[U,V]=(0,xU.A)({name:"DayCalendar",state:"hasFocus",controlled:T,default:null!=x&&x}),[F,B]=t.useState((()=>a||k)),W=(0,OI.A)((e=>{d||l(e)})),z=e=>{M(e)||(r(e),B(e),null==C||C(!0),V(!0))},H=(0,OI.A)(((e,t)=>{switch(e.key){case"ArrowUp":z(N.addDays(t,-7)),e.preventDefault();break;case"ArrowDown":z(N.addDays(t,7)),e.preventDefault();break;case"ArrowLeft":{const n=N.addDays(t,D?1:-1),r=N.addMonths(t,D?1:-1),i=ML({utils:N,date:n,minDate:D?n:N.startOfMonth(r),maxDate:D?N.endOfMonth(r):n,isDateDisabled:M,timezone:O});z(i||n),e.preventDefault();break}case"ArrowRight":{const n=N.addDays(t,D?-1:1),r=N.addMonths(t,D?-1:1),i=ML({utils:N,date:n,minDate:D?N.startOfMonth(r):n,maxDate:D?n:N.endOfMonth(r),isDateDisabled:M,timezone:O});z(i||n),e.preventDefault();break}case"Home":z(N.startOfWeek(t)),e.preventDefault();break;case"End":z(N.endOfWeek(t)),e.preventDefault();break;case"PageUp":z(N.addMonths(t,1)),e.preventDefault();break;case"PageDown":z(N.addMonths(t,-1)),e.preventDefault()}})),G=(0,OI.A)(((e,t)=>z(t))),q=(0,OI.A)(((e,t)=>{U&&N.isSameDay(F,t)&&(null==C||C(!1))})),K=N.getMonth(o),$=t.useMemo((()=>s.filter((e=>!!e)).map((e=>N.startOfDay(e)))),[N,s]),Y=K,X=t.useMemo((()=>t.createRef()),[Y]),J=N.startOfWeek(k),Q=t.useMemo((()=>{const e=N.startOfMonth(o),t=N.endOfMonth(o);return M(F)||N.isAfterDay(F,t)||N.isBeforeDay(F,e)?ML({utils:N,date:F,minDate:e,maxDate:t,disablePast:g,disableFuture:v,isDateDisabled:M,timezone:O}):F}),[o,v,g,F,M,N,O]),Z=t.useMemo((()=>{const e=N.setTimezone(o,O),t=N.getWeekArray(e);let n=N.addMonths(e,1);for(;I&&t.length<I;){const e=N.getWeekArray(n),r=N.isSameDay(t[t.length-1][0],e[0][0]);e.slice(r?1:0).forEach((e=>{t.length<I&&t.push(e)})),n=N.addMonths(n,1)}return t}),[o,I,N,O]);return(0,We.jsxs)(fF,{role:"grid","aria-labelledby":A,className:P.root,children:[(0,We.jsxs)(mF,{role:"row",className:P.header,children:[R&&(0,We.jsx)(vF,{variant:"caption",role:"columnheader","aria-label":j.calendarWeekNumberHeaderLabel,className:P.weekNumberLabel,children:j.calendarWeekNumberHeaderText}),zL(N,k).map(((e,t)=>{var n;const r=N.format(e,"weekdayShort");return(0,We.jsx)(gF,{variant:"caption",role:"columnheader","aria-label":N.format(N.addDays(J,t),"weekday"),className:P.weekDayLabel,children:null!=(n=null==L?void 0:L(r,e))?n:r},r+t.toString())}))]}),c?(0,We.jsx)(_F,{className:P.loadingContainer,children:p()}):(0,We.jsx)(EF,(0,ke.A)({transKey:Y,onExited:u,reduceAnimations:h,slideDirection:f,className:(0,Pe.A)(i,P.slideTransition)},m,{nodeRef:X,children:(0,We.jsx)(bF,{ref:X,role:"rowgroup",className:P.monthContainer,children:Z.map(((e,t)=>(0,We.jsxs)(wF,{role:"row",className:P.weekContainer,"aria-rowindex":t+1,children:[R&&(0,We.jsx)(yF,{className:P.weekNumber,role:"rowheader","aria-label":j.calendarWeekNumberAriaLabelText(N.getWeekNumber(e[0])),children:j.calendarWeekNumberText(N.getWeekNumber(e[0]))}),e.map(((e,t)=>(0,We.jsx)(SF,{parentProps:n,day:e,selectedDays:$,focusableDay:Q,onKeyDown:H,onFocus:G,onBlur:q,onDaySelect:W,isDateDisabled:M,currentMonthNumber:K,isViewFocused:U,"aria-colindex":t+1},e.toString())))]},`week-${e[0]}`)))})}))]})}function CF(e){return(0,AC.Ay)("MuiPickersMonth",e)}const AF=(0,Ke.A)("MuiPickersMonth",["root","monthButton","disabled","selected"]),RF=["autoFocus","children","disabled","selected","value","tabIndex","onClick","onKeyDown","onFocus","onBlur","aria-current","aria-label","monthsPerRow"],IF=(0,wC.Ay)("div",{name:"MuiPickersMonth",slot:"Root",overridesResolver:(e,t)=>[t.root]})((e=>{let{ownerState:t}=e;return{flexBasis:3===t.monthsPerRow?"33.3%":"25%",display:"flex",alignItems:"center",justifyContent:"center"}})),xF=(0,wC.Ay)("button",{name:"MuiPickersMonth",slot:"MonthButton",overridesResolver:(e,t)=>[t.monthButton,{[`&.${AF.disabled}`]:t.disabled},{[`&.${AF.selected}`]:t.selected}]})((e=>{let{theme:t}=e;return(0,ke.A)({color:"unset",backgroundColor:"transparent",border:0,outline:0},t.typography.subtitle1,{margin:"8px 0",height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:qV(t.palette.action.active,t.palette.action.hoverOpacity)},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:qV(t.palette.action.active,t.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${AF.disabled}`]:{color:(t.vars||t).palette.text.secondary},[`&.${AF.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,"&:focus, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}}})})),OF=t.memo((function(e){const n=xL({props:e,name:"MuiPickersMonth"}),{autoFocus:r,children:i,disabled:o,selected:s,value:a,tabIndex:c,onClick:l,onKeyDown:u,onFocus:d,onBlur:h,"aria-current":p,"aria-label":f}=n,m=(0,Ne.A)(n,RF),g=t.useRef(null),v=(e=>{const{disabled:t,selected:n,classes:r}=e,i={root:["root"],monthButton:["monthButton",t&&"disabled",n&&"selected"]};return(0,bC.A)(i,CF,r)})(n);return(0,yI.A)((()=>{var e;r&&(null==(e=g.current)||e.focus())}),[r]),(0,We.jsx)(IF,(0,ke.A)({className:v.root,ownerState:n},m,{children:(0,We.jsx)(xF,{ref:g,disabled:o,type:"button",role:"radio",tabIndex:o?-1:c,"aria-current":p,"aria-checked":s,"aria-label":f,onClick:e=>l(e,a),onKeyDown:e=>u(e,a),onFocus:e=>d(e,a),onBlur:e=>h(e,a),className:v.monthButton,ownerState:n,children:i})}))}));function kF(e){return(0,AC.Ay)("MuiMonthCalendar",e)}(0,Ke.A)("MuiMonthCalendar",["root"]);const NF=["className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","shouldDisableMonth","readOnly","disableHighlightToday","autoFocus","onMonthFocus","hasFocus","onFocusedViewChange","monthsPerRow","timezone","gridLabelId"];const PF=(0,wC.Ay)("div",{name:"MuiMonthCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexWrap:"wrap",alignContent:"stretch",padding:"0 4px",width:iV,boxSizing:"border-box"}),DF=t.forwardRef((function(e,n){const r=function(e,t){const n=wM(),r=SM(),i=xL({props:e,name:t});return(0,ke.A)({disableFuture:!1,disablePast:!1},i,{minDate:jL(n,i.minDate,r.minDate),maxDate:jL(n,i.maxDate,r.maxDate)})}(e,"MuiMonthCalendar"),{className:i,value:o,defaultValue:s,referenceDate:a,disabled:c,disableFuture:l,disablePast:u,maxDate:d,minDate:h,onChange:p,shouldDisableMonth:f,readOnly:m,disableHighlightToday:g,autoFocus:v=!1,onMonthFocus:y,hasFocus:_,onFocusedViewChange:E,monthsPerRow:b=3,timezone:w,gridLabelId:S}=r,T=(0,Ne.A)(r,NF),{value:C,handleValueChange:A,timezone:R}=NU({name:"MonthCalendar",timezone:w,value:o,defaultValue:s,onChange:p,valueManager:pM}),I=CM(R),x=Be(),O=wM(),k=t.useMemo((()=>pM.getInitialReferenceValue({value:C,utils:O,props:r,timezone:R,referenceDate:a,granularity:qL.month})),[]),N=r,P=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},kF,t)})(N),D=t.useMemo((()=>O.getMonth(I)),[O,I]),L=t.useMemo((()=>null!=C?O.getMonth(C):g?null:O.getMonth(k)),[C,O,g,k]),[M,j]=t.useState((()=>L||D)),[U,V]=(0,xU.A)({name:"MonthCalendar",state:"hasFocus",controlled:_,default:null!=v&&v}),F=(0,OI.A)((e=>{V(e),E&&E(e)})),B=t.useCallback((e=>{const t=O.startOfMonth(u&&O.isAfter(I,h)?I:h),n=O.startOfMonth(l&&O.isBefore(I,d)?I:d),r=O.startOfMonth(e);return!!O.isBefore(r,t)||(!!O.isAfter(r,n)||!!f&&f(r))}),[l,u,d,h,I,f,O]),W=(0,OI.A)(((e,t)=>{if(m)return;const n=O.setMonth(null!=C?C:k,t);A(n)})),z=(0,OI.A)((e=>{B(O.setMonth(null!=C?C:k,e))||(j(e),F(!0),y&&y(e))}));t.useEffect((()=>{j((e=>null!==L&&e!==L?L:e))}),[L]);const H=(0,OI.A)(((e,t)=>{const n=12;switch(e.key){case"ArrowUp":z((n+t-3)%n),e.preventDefault();break;case"ArrowDown":z((n+t+3)%n),e.preventDefault();break;case"ArrowLeft":z((n+t+("ltr"===x.direction?-1:1))%n),e.preventDefault();break;case"ArrowRight":z((n+t+("ltr"===x.direction?1:-1))%n),e.preventDefault()}})),G=(0,OI.A)(((e,t)=>{z(t)})),q=(0,OI.A)(((e,t)=>{M===t&&F(!1)}));return(0,We.jsx)(PF,(0,ke.A)({ref:n,className:(0,Pe.A)(P.root,i),ownerState:N,role:"radiogroup","aria-labelledby":S},T,{children:UL(O,null!=C?C:k).map((e=>{const t=O.getMonth(e),n=O.format(e,"monthShort"),r=O.format(e,"month"),i=t===L,o=c||B(e);return(0,We.jsx)(OF,{selected:i,value:t,onClick:W,onKeyDown:H,autoFocus:U&&t===M,disabled:o,tabIndex:t===M?0:-1,onFocus:G,onBlur:q,"aria-current":D===t?"date":void 0,"aria-label":r,monthsPerRow:b,children:n},n)}))}))}));function LF(e){return(0,AC.Ay)("MuiPickersYear",e)}const MF=(0,Ke.A)("MuiPickersYear",["root","yearButton","selected","disabled"]),jF=["autoFocus","className","children","disabled","selected","value","tabIndex","onClick","onKeyDown","onFocus","onBlur","aria-current","yearsPerRow"],UF=(0,wC.Ay)("div",{name:"MuiPickersYear",slot:"Root",overridesResolver:(e,t)=>[t.root]})((e=>{let{ownerState:t}=e;return{flexBasis:3===t.yearsPerRow?"33.3%":"25%",display:"flex",alignItems:"center",justifyContent:"center"}})),VF=(0,wC.Ay)("button",{name:"MuiPickersYear",slot:"YearButton",overridesResolver:(e,t)=>[t.yearButton,{[`&.${MF.disabled}`]:t.disabled},{[`&.${MF.selected}`]:t.selected}]})((e=>{let{theme:t}=e;return(0,ke.A)({color:"unset",backgroundColor:"transparent",border:0,outline:0},t.typography.subtitle1,{margin:"6px 0",height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.focusOpacity})`:qV(t.palette.action.active,t.palette.action.focusOpacity)},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:qV(t.palette.action.active,t.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${MF.disabled}`]:{color:(t.vars||t).palette.text.secondary},[`&.${MF.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,"&:focus, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}}})})),FF=t.memo((function(e){const n=xL({props:e,name:"MuiPickersYear"}),{autoFocus:r,className:i,children:o,disabled:s,selected:a,value:c,tabIndex:l,onClick:u,onKeyDown:d,onFocus:h,onBlur:p,"aria-current":f}=n,m=(0,Ne.A)(n,jF),g=t.useRef(null),v=(e=>{const{disabled:t,selected:n,classes:r}=e,i={root:["root"],yearButton:["yearButton",t&&"disabled",n&&"selected"]};return(0,bC.A)(i,LF,r)})(n);return t.useEffect((()=>{r&&g.current.focus()}),[r]),(0,We.jsx)(UF,(0,ke.A)({className:(0,Pe.A)(v.root,i),ownerState:n},m,{children:(0,We.jsx)(VF,{ref:g,disabled:s,type:"button",role:"radio",tabIndex:s?-1:l,"aria-current":f,"aria-checked":a,onClick:e=>u(e,c),onKeyDown:e=>d(e,c),onFocus:e=>h(e,c),onBlur:e=>p(e,c),className:v.yearButton,ownerState:n,children:o})}))}));function BF(e){return(0,AC.Ay)("MuiYearCalendar",e)}(0,Ke.A)("MuiYearCalendar",["root"]);const WF=["autoFocus","className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","readOnly","shouldDisableYear","disableHighlightToday","onYearFocus","hasFocus","onFocusedViewChange","yearsPerRow","timezone","gridLabelId"];const zF=(0,wC.Ay)("div",{name:"MuiYearCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexDirection:"row",flexWrap:"wrap",overflowY:"auto",height:"100%",padding:"0 4px",width:iV,maxHeight:280,boxSizing:"border-box",position:"relative"}),HF=t.forwardRef((function(e,n){const r=function(e,t){var n;const r=wM(),i=SM(),o=xL({props:e,name:t});return(0,ke.A)({disablePast:!1,disableFuture:!1},o,{yearsPerRow:null!=(n=o.yearsPerRow)?n:3,minDate:jL(r,o.minDate,i.minDate),maxDate:jL(r,o.maxDate,i.maxDate)})}(e,"MuiYearCalendar"),{autoFocus:i,className:o,value:s,defaultValue:a,referenceDate:c,disabled:l,disableFuture:u,disablePast:d,maxDate:h,minDate:p,onChange:f,readOnly:m,shouldDisableYear:g,disableHighlightToday:v,onYearFocus:y,hasFocus:_,onFocusedViewChange:E,yearsPerRow:b,timezone:w,gridLabelId:S}=r,T=(0,Ne.A)(r,WF),{value:C,handleValueChange:A,timezone:R}=NU({name:"YearCalendar",timezone:w,value:s,defaultValue:a,onChange:f,valueManager:pM}),I=CM(R),x=Be(),O=wM(),k=t.useMemo((()=>pM.getInitialReferenceValue({value:C,utils:O,props:r,timezone:R,referenceDate:c,granularity:qL.year})),[]),N=r,P=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},BF,t)})(N),D=t.useMemo((()=>O.getYear(I)),[O,I]),L=t.useMemo((()=>null!=C?O.getYear(C):v?null:O.getYear(k)),[C,O,v,k]),[M,j]=t.useState((()=>L||D)),[U,V]=(0,xU.A)({name:"YearCalendar",state:"hasFocus",controlled:_,default:null!=i&&i}),F=(0,OI.A)((e=>{V(e),E&&E(e)})),B=t.useCallback((e=>{if(d&&O.isBeforeYear(e,I))return!0;if(u&&O.isAfterYear(e,I))return!0;if(p&&O.isBeforeYear(e,p))return!0;if(h&&O.isAfterYear(e,h))return!0;if(!g)return!1;const t=O.startOfYear(e);return g(t)}),[u,d,h,p,I,g,O]),W=(0,OI.A)(((e,t)=>{if(m)return;const n=O.setYear(null!=C?C:k,t);A(n)})),z=(0,OI.A)((e=>{B(O.setYear(null!=C?C:k,e))||(j(e),F(!0),null==y||y(e))}));t.useEffect((()=>{j((e=>null!==L&&e!==L?L:e))}),[L]);const H=(0,OI.A)(((e,t)=>{switch(e.key){case"ArrowUp":z(t-b),e.preventDefault();break;case"ArrowDown":z(t+b),e.preventDefault();break;case"ArrowLeft":z(t+("ltr"===x.direction?-1:1)),e.preventDefault();break;case"ArrowRight":z(t+("ltr"===x.direction?1:-1)),e.preventDefault()}})),G=(0,OI.A)(((e,t)=>{z(t)})),q=(0,OI.A)(((e,t)=>{M===t&&F(!1)})),K=t.useRef(null),$=(0,qC.A)(n,K);return t.useEffect((()=>{if(i||null===K.current)return;const e=K.current.querySelector('[tabindex="0"]');if(!e)return;const t=e.offsetHeight,n=e.offsetTop,r=K.current.clientHeight,o=K.current.scrollTop,s=n+t;t>r||n<o||(K.current.scrollTop=s-r/2-t/2)}),[i]),(0,We.jsx)(zF,(0,ke.A)({ref:$,className:(0,Pe.A)(P.root,o),ownerState:N,role:"radiogroup","aria-labelledby":S},T,{children:O.getYearRange(p,h).map((e=>{const t=O.getYear(e),n=t===L,r=l||B(e);return(0,We.jsx)(FF,{selected:n,value:t,onClick:W,onKeyDown:H,autoFocus:U&&t===M,disabled:r,tabIndex:t===M?0:-1,onFocus:G,onBlur:q,"aria-current":D===t?"date":void 0,yearsPerRow:b,children:O.format(e,"year")},O.format(e,"year"))}))}))}));function GF(e){return(0,AC.Ay)("MuiPickersArrowSwitcher",e)}(0,Ke.A)("MuiPickersArrowSwitcher",["root","spacer","button"]);const qF=["children","className","slots","slotProps","isNextDisabled","isNextHidden","onGoToNext","nextLabel","isPreviousDisabled","isPreviousHidden","onGoToPrevious","previousLabel"],KF=["ownerState"],$F=["ownerState"],YF=(0,wC.Ay)("div",{name:"MuiPickersArrowSwitcher",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex"}),XF=(0,wC.Ay)("div",{name:"MuiPickersArrowSwitcher",slot:"Spacer",overridesResolver:(e,t)=>t.spacer})((e=>{let{theme:t}=e;return{width:t.spacing(3)}})),JF=(0,wC.Ay)(rR,{name:"MuiPickersArrowSwitcher",slot:"Button",overridesResolver:(e,t)=>t.button})((e=>{let{ownerState:t}=e;return(0,ke.A)({},t.hidden&&{visibility:"hidden"})})),QF=t.forwardRef((function(e,t){var n,r,i,o;const s="rtl"===iI().direction,a=xL({props:e,name:"MuiPickersArrowSwitcher"}),{children:c,className:l,slots:u,slotProps:d,isNextDisabled:h,isNextHidden:p,onGoToNext:f,nextLabel:m,isPreviousDisabled:g,isPreviousHidden:v,onGoToPrevious:y,previousLabel:_}=a,E=(0,Ne.A)(a,qF),b=a,w=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],spacer:["spacer"],button:["button"]},GF,t)})(b),S={isDisabled:h,isHidden:p,goTo:f,label:m},T={isDisabled:g,isHidden:v,goTo:y,label:_},C=null!=(n=null==u?void 0:u.previousIconButton)?n:JF,A=FM({elementType:C,externalSlotProps:null==d?void 0:d.previousIconButton,additionalProps:{size:"medium",title:T.label,"aria-label":T.label,disabled:T.isDisabled,edge:"end",onClick:T.goTo},ownerState:(0,ke.A)({},b,{hidden:T.isHidden}),className:w.button}),R=null!=(r=null==u?void 0:u.nextIconButton)?r:JF,I=FM({elementType:R,externalSlotProps:null==d?void 0:d.nextIconButton,additionalProps:{size:"medium",title:S.label,"aria-label":S.label,disabled:S.isDisabled,edge:"start",onClick:S.goTo},ownerState:(0,ke.A)({},b,{hidden:S.isHidden}),className:w.button}),x=null!=(i=null==u?void 0:u.leftArrowIcon)?i:gV,O=FM({elementType:x,externalSlotProps:null==d?void 0:d.leftArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:void 0}),k=(0,Ne.A)(O,KF),N=null!=(o=null==u?void 0:u.rightArrowIcon)?o:vV,P=FM({elementType:N,externalSlotProps:null==d?void 0:d.rightArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:void 0}),D=(0,Ne.A)(P,$F);return(0,We.jsxs)(YF,(0,ke.A)({ref:t,className:(0,Pe.A)(w.root,l),ownerState:b},E,{children:[(0,We.jsx)(C,(0,ke.A)({},A,{children:s?(0,We.jsx)(N,(0,ke.A)({},D)):(0,We.jsx)(x,(0,ke.A)({},k))})),c?(0,We.jsx)(mA,{variant:"subtitle1",component:"span",children:c}):(0,We.jsx)(XF,{className:w.spacer,ownerState:b}),(0,We.jsx)(R,(0,ke.A)({},I,{children:s?(0,We.jsx)(x,(0,ke.A)({},k)):(0,We.jsx)(N,(0,ke.A)({},D))}))]}))}));const ZF=e=>(0,AC.Ay)("MuiPickersCalendarHeader",e),eB=(0,Ke.A)("MuiPickersCalendarHeader",["root","labelContainer","label","switchViewButton","switchViewIcon"]),tB=["slots","slotProps","components","componentsProps","currentMonth","disabled","disableFuture","disablePast","maxDate","minDate","onMonthChange","onViewChange","view","reduceAnimations","views","labelId","className","timezone"],nB=["ownerState"],rB=(0,wC.Ay)("div",{name:"MuiPickersCalendarHeader",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",alignItems:"center",marginTop:16,marginBottom:8,paddingLeft:24,paddingRight:12,maxHeight:30,minHeight:30}),iB=(0,wC.Ay)("div",{name:"MuiPickersCalendarHeader",slot:"LabelContainer",overridesResolver:(e,t)=>t.labelContainer})((e=>{let{theme:t}=e;return(0,ke.A)({display:"flex",overflow:"hidden",alignItems:"center",cursor:"pointer",marginRight:"auto"},t.typography.body1,{fontWeight:t.typography.fontWeightMedium})})),oB=(0,wC.Ay)("div",{name:"MuiPickersCalendarHeader",slot:"Label",overridesResolver:(e,t)=>t.label})({marginRight:6}),sB=(0,wC.Ay)(rR,{name:"MuiPickersCalendarHeader",slot:"SwitchViewButton",overridesResolver:(e,t)=>t.switchViewButton})((e=>{let{ownerState:t}=e;return(0,ke.A)({marginRight:"auto"},"year"===t.view&&{[`.${eB.switchViewIcon}`]:{transform:"rotate(180deg)"}})})),aB=(0,wC.Ay)(mV,{name:"MuiPickersCalendarHeader",slot:"SwitchViewIcon",overridesResolver:(e,t)=>t.switchViewIcon})((e=>{let{theme:t}=e;return{willChange:"transform",transition:t.transitions.create("transform"),transform:"rotate(0deg)"}})),cB=t.forwardRef((function(e,n){var r,i,o,s;const a=TM(),c=wM(),l=xL({props:e,name:"MuiPickersCalendarHeader"}),{slots:u,slotProps:d,components:h,currentMonth:p,disabled:f,disableFuture:m,disablePast:g,maxDate:v,minDate:y,onMonthChange:_,onViewChange:E,view:b,reduceAnimations:w,views:S,labelId:T,className:C,timezone:A}=l,R=(0,Ne.A)(l,tB),I=l,x=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],labelContainer:["labelContainer"],label:["label"],switchViewButton:["switchViewButton"],switchViewIcon:["switchViewIcon"]},ZF,t)})(l),O=null!=(r=null!=(i=null==u?void 0:u.switchViewButton)?i:null==h?void 0:h.SwitchViewButton)?r:sB,k=FM({elementType:O,externalSlotProps:null==d?void 0:d.switchViewButton,additionalProps:{size:"small","aria-label":a.calendarViewSwitchingButtonAriaLabel(b)},ownerState:I,className:x.switchViewButton}),N=null!=(o=null!=(s=null==u?void 0:u.switchViewIcon)?s:null==h?void 0:h.SwitchViewIcon)?o:aB,P=FM({elementType:N,externalSlotProps:null==d?void 0:d.switchViewIcon,ownerState:void 0,className:x.switchViewIcon}),D=(0,Ne.A)(P,nB),L=function(e,n){let{disableFuture:r,maxDate:i,timezone:o}=n;const s=wM();return t.useMemo((()=>{const t=s.dateWithTimezone(void 0,o),n=s.startOfMonth(r&&s.isBefore(t,i)?t:i);return!s.isAfter(n,e)}),[r,i,e,s,o])}(p,{disableFuture:m,maxDate:v,timezone:A}),M=function(e,n){let{disablePast:r,minDate:i,timezone:o}=n;const s=wM();return t.useMemo((()=>{const t=s.dateWithTimezone(void 0,o),n=s.startOfMonth(r&&s.isAfter(t,i)?t:i);return!s.isBefore(n,e)}),[r,i,e,s,o])}(p,{disablePast:g,minDate:y,timezone:A});return 1===S.length&&"year"===S[0]?null:(0,We.jsxs)(rB,(0,ke.A)({},R,{ownerState:I,className:(0,Pe.A)(C,x.root),ref:n,children:[(0,We.jsxs)(iB,{role:"presentation",onClick:()=>{if(1!==S.length&&E&&!f)if(2===S.length)E(S.find((e=>e!==b))||S[0]);else{const e=0!==S.indexOf(b)?0:1;E(S[e])}},ownerState:I,"aria-live":"polite",className:x.labelContainer,children:[(0,We.jsx)(BV,{reduceAnimations:w,transKey:c.format(p,"monthAndYear"),children:(0,We.jsx)(oB,{id:T,ownerState:I,className:x.label,children:c.format(p,"monthAndYear")})}),S.length>1&&!f&&(0,We.jsx)(O,(0,ke.A)({},k,{children:(0,We.jsx)(N,(0,ke.A)({},D))}))]}),(0,We.jsx)(TI,{in:"day"===b,children:(0,We.jsx)(QF,{slots:u,slotProps:d,onGoToPrevious:()=>_(c.addMonths(p,-1),"right"),isPreviousDisabled:M,previousLabel:a.previousMonth,onGoToNext:()=>_(c.addMonths(p,1),"left"),isNextDisabled:L,nextLabel:a.nextMonth})})]}))})),lB=(0,wC.Ay)("div")({overflow:"hidden",width:iV,maxHeight:334,display:"flex",flexDirection:"column",margin:"0 auto"}),uB=e=>(0,AC.Ay)("MuiDateCalendar",e),dB=((0,Ke.A)("MuiDateCalendar",["root","viewTransitionContainer"]),["autoFocus","onViewChange","value","defaultValue","referenceDate","disableFuture","disablePast","defaultCalendarMonth","onChange","onYearChange","onMonthChange","reduceAnimations","shouldDisableDate","shouldDisableMonth","shouldDisableYear","view","views","openTo","className","disabled","readOnly","minDate","maxDate","disableHighlightToday","focusedView","onFocusedViewChange","showDaysOutsideCurrentMonth","fixedWeekNumber","dayOfWeekFormatter","components","componentsProps","slots","slotProps","loading","renderLoading","displayWeekNumber","yearsPerRow","monthsPerRow","timezone"]);const hB=(0,wC.Ay)(lB,{name:"MuiDateCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexDirection:"column",height:334}),pB=(0,wC.Ay)(BV,{name:"MuiDateCalendar",slot:"ViewTransitionContainer",overridesResolver:(e,t)=>t.viewTransitionContainer})({}),fB=t.forwardRef((function(e,n){var r,i,o;const s=wM(),a=(0,hO.A)(),c=function(e,t){var n,r,i,o,s,a,c;const l=wM(),u=SM(),d=SU(),h=xL({props:e,name:t});return(0,ke.A)({},h,{loading:null!=(n=h.loading)&&n,disablePast:null!=(r=h.disablePast)&&r,disableFuture:null!=(i=h.disableFuture)&&i,openTo:null!=(o=h.openTo)?o:"day",views:null!=(s=h.views)?s:["year","day"],reduceAnimations:null!=(a=h.reduceAnimations)?a:d,renderLoading:null!=(c=h.renderLoading)?c:()=>(0,We.jsx)("span",{children:"..."}),minDate:jL(l,h.minDate,u.minDate),maxDate:jL(l,h.maxDate,u.maxDate)})}(e,"MuiDateCalendar"),{autoFocus:l,onViewChange:u,value:d,defaultValue:h,referenceDate:p,disableFuture:f,disablePast:m,defaultCalendarMonth:g,onChange:v,onYearChange:y,onMonthChange:_,reduceAnimations:E,shouldDisableDate:b,shouldDisableMonth:w,shouldDisableYear:S,view:T,views:C,openTo:A,className:R,disabled:I,readOnly:x,minDate:O,maxDate:k,disableHighlightToday:N,focusedView:P,onFocusedViewChange:D,showDaysOutsideCurrentMonth:L,fixedWeekNumber:M,dayOfWeekFormatter:j,components:U,componentsProps:V,slots:F,slotProps:B,loading:W,renderLoading:z,displayWeekNumber:H,yearsPerRow:G,monthsPerRow:q,timezone:K}=c,$=(0,Ne.A)(c,dB),{value:Y,handleValueChange:X,timezone:J}=NU({name:"DateCalendar",timezone:K,value:d,defaultValue:h,onChange:v,valueManager:pM}),{view:Q,setView:Z,focusedView:ee,setFocusedView:te,goToNextView:ne,setValueAndGoToNextView:re}=DU({view:T,views:C,openTo:A,onChange:X,onViewChange:u,autoFocus:l,focusedView:P,onFocusedViewChange:D}),{referenceDate:ie,calendarState:oe,changeFocusedDay:se,changeMonth:ae,handleChangeMonth:ce,isDateDisabled:le,onMonthSwitchingAnimationEnd:ue}=UV({value:Y,defaultCalendarMonth:g,referenceDate:p,reduceAnimations:E,onMonthChange:_,minDate:O,maxDate:k,shouldDisableDate:b,disablePast:m,disableFuture:f,timezone:J}),de=I&&Y||O,he=I&&Y||k,pe=`${a}-grid-label`,fe=null!==ee,me=null!=(r=null!=(i=null==F?void 0:F.calendarHeader)?i:null==U?void 0:U.CalendarHeader)?r:cB,ge=FM({elementType:me,externalSlotProps:null!=(o=null==B?void 0:B.calendarHeader)?o:null==V?void 0:V.calendarHeader,additionalProps:{views:C,view:Q,currentMonth:oe.currentMonth,onViewChange:Z,onMonthChange:(e,t)=>ce({newMonth:e,direction:t}),minDate:de,maxDate:he,disabled:I,disablePast:m,disableFuture:f,reduceAnimations:E,timezone:J,labelId:pe,slots:F,slotProps:B},ownerState:c}),ve=(0,OI.A)((e=>{const t=s.startOfMonth(e),n=s.endOfMonth(e),r=le(e)?ML({utils:s,date:e,minDate:s.isBefore(O,t)?t:O,maxDate:s.isAfter(k,n)?n:k,disablePast:m,disableFuture:f,isDateDisabled:le,timezone:J}):e;r?(re(r,"finish"),null==_||_(t)):(ne(),ae(t)),se(r,!0)})),ye=(0,OI.A)((e=>{const t=s.startOfYear(e),n=s.endOfYear(e),r=le(e)?ML({utils:s,date:e,minDate:s.isBefore(O,t)?t:O,maxDate:s.isAfter(k,n)?n:k,disablePast:m,disableFuture:f,isDateDisabled:le,timezone:J}):e;r?(re(r,"finish"),null==y||y(r)):(ne(),ae(t)),se(r,!0)})),_e=(0,OI.A)((e=>X(e?LL(s,e,null!=Y?Y:ie):e,"finish",Q)));t.useEffect((()=>{null!=Y&&s.isValid(Y)&&ae(Y)}),[Y]);const Ee=c,be=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],viewTransitionContainer:["viewTransitionContainer"]},uB,t)})(Ee),we={disablePast:m,disableFuture:f,maxDate:k,minDate:O},Se={disableHighlightToday:N,readOnly:x,disabled:I,timezone:J,gridLabelId:pe},Te=t.useRef(Q);t.useEffect((()=>{Te.current!==Q&&(ee===Te.current&&te(Q,!0),Te.current=Q)}),[ee,te,Q]);const Ce=t.useMemo((()=>[Y]),[Y]);return(0,We.jsxs)(hB,(0,ke.A)({ref:n,className:(0,Pe.A)(be.root,R),ownerState:Ee},$,{children:[(0,We.jsx)(me,(0,ke.A)({},ge)),(0,We.jsx)(pB,{reduceAnimations:E,className:be.viewTransitionContainer,transKey:Q,ownerState:Ee,children:(0,We.jsxs)("div",{children:["year"===Q&&(0,We.jsx)(HF,(0,ke.A)({},we,Se,{value:Y,onChange:ye,shouldDisableYear:S,hasFocus:fe,onFocusedViewChange:e=>te("year",e),yearsPerRow:G,referenceDate:ie})),"month"===Q&&(0,We.jsx)(DF,(0,ke.A)({},we,Se,{hasFocus:fe,className:R,value:Y,onChange:ve,shouldDisableMonth:w,onFocusedViewChange:e=>te("month",e),monthsPerRow:q,referenceDate:ie})),"day"===Q&&(0,We.jsx)(TF,(0,ke.A)({},oe,we,Se,{onMonthSwitchingAnimationEnd:ue,onFocusedDayChange:se,reduceAnimations:E,selectedDays:Ce,onSelectedDaysChange:_e,shouldDisableDate:b,shouldDisableMonth:w,shouldDisableYear:S,hasFocus:fe,onFocusedViewChange:e=>te("day",e),showDaysOutsideCurrentMonth:L,fixedWeekNumber:M,dayOfWeekFormatter:j,displayWeekNumber:H,components:U,componentsProps:V,slots:F,slotProps:B,loading:W,renderLoading:z}))]})})]}))})),mB=e=>{let{view:t,onViewChange:n,views:r,focusedView:i,onFocusedViewChange:o,value:s,defaultValue:a,referenceDate:c,onChange:l,className:u,classes:d,disableFuture:h,disablePast:p,minDate:f,maxDate:m,shouldDisableDate:g,shouldDisableMonth:v,shouldDisableYear:y,reduceAnimations:_,onMonthChange:E,monthsPerRow:b,onYearChange:w,yearsPerRow:S,defaultCalendarMonth:T,components:C,componentsProps:A,slots:R,slotProps:I,loading:x,renderLoading:O,disableHighlightToday:k,readOnly:N,disabled:P,showDaysOutsideCurrentMonth:D,dayOfWeekFormatter:L,sx:M,autoFocus:j,fixedWeekNumber:U,displayWeekNumber:V,timezone:F}=e;return(0,We.jsx)(fB,{view:t,onViewChange:n,views:r.filter(BL),focusedView:i&&BL(i)?i:null,onFocusedViewChange:o,value:s,defaultValue:a,referenceDate:c,onChange:l,className:u,classes:d,disableFuture:h,disablePast:p,minDate:f,maxDate:m,shouldDisableDate:g,shouldDisableMonth:v,shouldDisableYear:y,reduceAnimations:_,onMonthChange:E,monthsPerRow:b,onYearChange:w,yearsPerRow:S,defaultCalendarMonth:T,components:C,componentsProps:A,slots:R,slotProps:I,loading:x,renderLoading:O,disableHighlightToday:k,readOnly:N,disabled:P,showDaysOutsideCurrentMonth:D,dayOfWeekFormatter:L,sx:M,autoFocus:j,fixedWeekNumber:U,displayWeekNumber:V,timezone:F})},gB=t.forwardRef((function(e,n){var r,i,o,s;const a=TM(),c=wM(),l=MM(e,"MuiDesktopDatePicker"),u=(0,ke.A)({day:mB,month:mB,year:mB},l.viewRenderers),d=(0,ke.A)({},l,{viewRenderers:u,format:WL(c,l,!1),yearsPerRow:null!=(r=l.yearsPerRow)?r:4,slots:(0,ke.A)({openPickerIcon:yV,field:MV},l.slots),slotProps:(0,ke.A)({},l.slotProps,{field:e=>{var t;return(0,ke.A)({},NL(null==(t=l.slotProps)?void 0:t.field,e),xV(l),{ref:n})},toolbar:(0,ke.A)({hidden:!0},null==(i=l.slotProps)?void 0:i.toolbar)})}),{renderPicker:h}=(e=>{var n,r,i,o,s;let{props:a,getOpenDialogAriaText:c}=e,l=(0,Ne.A)(e,hV);const{slots:u,slotProps:d,className:h,sx:p,format:f,formatDensity:m,timezone:g,name:v,label:y,inputRef:_,readOnly:E,disabled:b,autoFocus:w,localeText:S,reduceAnimations:T}=a,C=wM(),A=t.useRef(null),R=t.useRef(null),I=(0,hO.A)(),x=null!=(n=null==d||null==(r=d.toolbar)?void 0:r.hidden)&&n,{open:O,actions:k,hasUIView:N,layoutProps:P,renderCurrentView:D,shouldRestoreFocus:L,fieldProps:M}=VU((0,ke.A)({},l,{props:a,inputRef:A,autoFocusView:!0,additionalViewProps:{},wrapperVariant:"desktop"})),j=null!=(i=u.inputAdornment)?i:TL,U=FM({elementType:j,externalSlotProps:null==d?void 0:d.inputAdornment,additionalProps:{position:"end"},ownerState:a}),V=(0,Ne.A)(U,pV),F=null!=(o=u.openPickerButton)?o:rR,B=FM({elementType:F,externalSlotProps:null==d?void 0:d.openPickerButton,additionalProps:{disabled:b||E,onClick:O?k.onClose:k.onOpen,"aria-label":c(M.value,C),edge:V.position},ownerState:a}),W=(0,Ne.A)(B,fV),z=u.openPickerIcon,H=u.field,G=FM({elementType:H,externalSlotProps:null==d?void 0:d.field,additionalProps:(0,ke.A)({},M,x&&{id:I},{readOnly:E,disabled:b,className:h,sx:p,format:f,formatDensity:m,timezone:g,label:y,name:v,autoFocus:w&&!a.open,focused:!!O||void 0}),ownerState:a});N&&(G.InputProps=(0,ke.A)({},G.InputProps,{ref:R},!a.disableOpenPicker&&{[`${V.position}Adornment`]:(0,We.jsx)(j,(0,ke.A)({},V,{children:(0,We.jsx)(F,(0,ke.A)({},W,{children:(0,We.jsx)(z,(0,ke.A)({},null==d?void 0:d.openPickerIcon))}))}))}));const q=(0,ke.A)({textField:u.textField,clearIcon:u.clearIcon,clearButton:u.clearButton},G.slots),K=null!=(s=u.layout)?s:dV,$=(0,qC.A)(A,G.inputRef,_);let Y=I;x&&(Y=y?`${I}-label`:void 0);const X=(0,ke.A)({},d,{toolbar:(0,ke.A)({},null==d?void 0:d.toolbar,{titleId:I}),popper:(0,ke.A)({"aria-labelledby":Y},null==d?void 0:d.popper)});return{renderPicker:()=>(0,We.jsxs)(vM,{localeText:S,children:[(0,We.jsx)(H,(0,ke.A)({},G,{slots:q,slotProps:X,inputRef:$})),(0,We.jsx)(IU,(0,ke.A)({role:"dialog",placement:"bottom-start",anchorEl:R.current},k,{open:O,slots:u,slotProps:X,shouldRestoreFocus:L,reduceAnimations:T,children:(0,We.jsx)(K,(0,ke.A)({},P,null==X?void 0:X.layout,{slots:u,slotProps:X,children:D()}))}))]})}})({props:d,valueManager:pM,valueType:"date",getOpenDialogAriaText:null!=(o=null==(s=d.localeText)?void 0:s.openDatePickerDialogue)?o:a.openDatePickerDialogue,validator:jM});return h()}));function vB(e){return(0,AC.Ay)("MuiDialogContent",e)}gB.propTypes={autoFocus:kL().bool,className:kL().string,closeOnSelect:kL().bool,components:kL().object,componentsProps:kL().object,dayOfWeekFormatter:kL().func,defaultCalendarMonth:kL().any,defaultValue:kL().any,disabled:kL().bool,disableFuture:kL().bool,disableHighlightToday:kL().bool,disableOpenPicker:kL().bool,disablePast:kL().bool,displayWeekNumber:kL().bool,fixedWeekNumber:kL().number,format:kL().string,formatDensity:kL().oneOf(["dense","spacious"]),inputRef:PL,label:kL().node,loading:kL().bool,localeText:kL().object,maxDate:kL().any,minDate:kL().any,monthsPerRow:kL().oneOf([3,4]),name:kL().string,onAccept:kL().func,onChange:kL().func,onClose:kL().func,onError:kL().func,onMonthChange:kL().func,onOpen:kL().func,onSelectedSectionsChange:kL().func,onViewChange:kL().func,onYearChange:kL().func,open:kL().bool,openTo:kL().oneOf(["day","month","year"]),orientation:kL().oneOf(["landscape","portrait"]),readOnly:kL().bool,reduceAnimations:kL().bool,referenceDate:kL().any,renderLoading:kL().func,selectedSections:kL().oneOfType([kL().oneOf(["all","day","hours","meridiem","minutes","month","seconds","weekDay","year"]),kL().number,kL().shape({endIndex:kL().number.isRequired,startIndex:kL().number.isRequired})]),shouldDisableDate:kL().func,shouldDisableMonth:kL().func,shouldDisableYear:kL().func,showDaysOutsideCurrentMonth:kL().bool,slotProps:kL().object,slots:kL().object,sx:kL().oneOfType([kL().arrayOf(kL().oneOfType([kL().func,kL().object,kL().bool])),kL().func,kL().object]),timezone:kL().string,value:kL().any,view:kL().oneOf(["day","month","year"]),viewRenderers:kL().shape({day:kL().func,month:kL().func,year:kL().func}),views:kL().arrayOf(kL().oneOf(["day","month","year"]).isRequired),yearsPerRow:kL().oneOf([3,4])};(0,Ke.A)("MuiDialogContent",["root","dividers"]);function yB(e){return(0,AC.Ay)("MuiDialogTitle",e)}const _B=(0,Ke.A)("MuiDialogTitle",["root"]),EB=["className","dividers"],bB=(0,wC.Ay)("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dividers&&t.dividers]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},n.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${_B.root} + &`]:{paddingTop:0}})})),wB=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiDialogContent"}),{className:r,dividers:i=!1}=n,o=(0,Ne.A)(n,EB),s=(0,ke.A)({},n,{dividers:i}),a=(e=>{const{classes:t,dividers:n}=e,r={root:["root",n&&"dividers"]};return(0,bC.A)(r,vB,t)})(s);return(0,We.jsx)(bB,(0,ke.A)({className:(0,Pe.A)(a.root,r),ownerState:s,ref:t},o))})),SB=wB,TB=(0,wC.Ay)(wO)({[`& .${fO.container}`]:{outline:0},[`& .${fO.paper}`]:{outline:0,minWidth:iV}}),CB=(0,wC.Ay)(SB)({"&:first-of-type":{padding:0}});function AB(e){var t,n;const{children:r,onDismiss:i,open:o,slots:s,slotProps:a}=e,c=null!=(t=null==s?void 0:s.dialog)?t:TB,l=null!=(n=null==s?void 0:s.mobileTransition)?n:TI;return(0,We.jsx)(c,(0,ke.A)({open:o,onClose:i},null==a?void 0:a.dialog,{TransitionComponent:l,TransitionProps:null==a?void 0:a.mobileTransition,PaperComponent:null==s?void 0:s.mobilePaper,PaperProps:null==a?void 0:a.mobilePaper,children:(0,We.jsx)(CB,{children:r})}))}const RB=["props","getOpenDialogAriaText"],IB=t.forwardRef((function(e,n){var r,i,o;const s=TM(),a=wM(),c=MM(e,"MuiMobileDatePicker"),l=(0,ke.A)({day:mB,month:mB,year:mB},c.viewRenderers),u=(0,ke.A)({},c,{viewRenderers:l,format:WL(a,c,!1),slots:(0,ke.A)({field:MV},c.slots),slotProps:(0,ke.A)({},c.slotProps,{field:e=>{var t;return(0,ke.A)({},NL(null==(t=c.slotProps)?void 0:t.field,e),xV(c),{ref:n})},toolbar:(0,ke.A)({hidden:!1},null==(r=c.slotProps)?void 0:r.toolbar)})}),{renderPicker:d}=(e=>{var n,r,i;let{props:o,getOpenDialogAriaText:s}=e,a=(0,Ne.A)(e,RB);const{slots:c,slotProps:l,className:u,sx:d,format:h,formatDensity:p,timezone:f,name:m,label:g,inputRef:v,readOnly:y,disabled:_,localeText:E}=o,b=wM(),w=t.useRef(null),S=(0,hO.A)(),T=null!=(n=null==l||null==(r=l.toolbar)?void 0:r.hidden)&&n,{open:C,actions:A,layoutProps:R,renderCurrentView:I,fieldProps:x}=VU((0,ke.A)({},a,{props:o,inputRef:w,autoFocusView:!0,additionalViewProps:{},wrapperVariant:"mobile"})),O=c.field,k=FM({elementType:O,externalSlotProps:null==l?void 0:l.field,additionalProps:(0,ke.A)({},x,T&&{id:S},!(_||y)&&{onClick:A.onOpen,onKeyDown:(N=A.onOpen,e=>{"Enter"!==e.key&&" "!==e.key||(N(e),e.preventDefault(),e.stopPropagation()),P&&P(e)})},{readOnly:null==y||y,disabled:_,className:u,sx:d,format:h,formatDensity:p,timezone:f,label:g,name:m}),ownerState:o});var N,P;k.inputProps=(0,ke.A)({},k.inputProps,{"aria-label":s(x.value,b)});const D=(0,ke.A)({textField:c.textField},k.slots),L=null!=(i=c.layout)?i:dV,M=(0,qC.A)(w,k.inputRef,v);let j=S;T&&(j=g?`${S}-label`:void 0);const U=(0,ke.A)({},l,{toolbar:(0,ke.A)({},null==l?void 0:l.toolbar,{titleId:S}),mobilePaper:(0,ke.A)({"aria-labelledby":j},null==l?void 0:l.mobilePaper)});return{renderPicker:()=>(0,We.jsxs)(vM,{localeText:E,children:[(0,We.jsx)(O,(0,ke.A)({},k,{slots:D,slotProps:U,inputRef:M})),(0,We.jsx)(AB,(0,ke.A)({},A,{open:C,slots:c,slotProps:U,children:(0,We.jsx)(L,(0,ke.A)({},R,null==U?void 0:U.layout,{slots:c,slotProps:U,children:I()}))}))]})}})({props:u,valueManager:pM,valueType:"date",getOpenDialogAriaText:null!=(i=null==(o=u.localeText)?void 0:o.openDatePickerDialogue)?i:s.openDatePickerDialogue,validator:jM});return d()}));IB.propTypes={autoFocus:kL().bool,className:kL().string,closeOnSelect:kL().bool,components:kL().object,componentsProps:kL().object,dayOfWeekFormatter:kL().func,defaultCalendarMonth:kL().any,defaultValue:kL().any,disabled:kL().bool,disableFuture:kL().bool,disableHighlightToday:kL().bool,disableOpenPicker:kL().bool,disablePast:kL().bool,displayWeekNumber:kL().bool,fixedWeekNumber:kL().number,format:kL().string,formatDensity:kL().oneOf(["dense","spacious"]),inputRef:PL,label:kL().node,loading:kL().bool,localeText:kL().object,maxDate:kL().any,minDate:kL().any,monthsPerRow:kL().oneOf([3,4]),name:kL().string,onAccept:kL().func,onChange:kL().func,onClose:kL().func,onError:kL().func,onMonthChange:kL().func,onOpen:kL().func,onSelectedSectionsChange:kL().func,onViewChange:kL().func,onYearChange:kL().func,open:kL().bool,openTo:kL().oneOf(["day","month","year"]),orientation:kL().oneOf(["landscape","portrait"]),readOnly:kL().bool,reduceAnimations:kL().bool,referenceDate:kL().any,renderLoading:kL().func,selectedSections:kL().oneOfType([kL().oneOf(["all","day","hours","meridiem","minutes","month","seconds","weekDay","year"]),kL().number,kL().shape({endIndex:kL().number.isRequired,startIndex:kL().number.isRequired})]),shouldDisableDate:kL().func,shouldDisableMonth:kL().func,shouldDisableYear:kL().func,showDaysOutsideCurrentMonth:kL().bool,slotProps:kL().object,slots:kL().object,sx:kL().oneOfType([kL().arrayOf(kL().oneOfType([kL().func,kL().object,kL().bool])),kL().func,kL().object]),timezone:kL().string,value:kL().any,view:kL().oneOf(["day","month","year"]),viewRenderers:kL().shape({day:kL().func,month:kL().func,year:kL().func}),views:kL().arrayOf(kL().oneOf(["day","month","year"]).isRequired),yearsPerRow:kL().oneOf([3,4])};const xB=["desktopModeMediaQuery"],OB=t.forwardRef((function(e,t){const n=xL({props:e,name:"MuiDatePicker"}),{desktopModeMediaQuery:r=yU}=n,i=(0,Ne.A)(n,xB);return IL(r,{defaultMatches:!0})?(0,We.jsx)(gB,(0,ke.A)({ref:t},i)):(0,We.jsx)(IB,(0,ke.A)({ref:t},i))})),kB=(0,zC.A)((0,We.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),NB=(0,zC.A)((0,We.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),PB=()=>{const[e,n]=(0,t.useState)({username:"",email:"",password:"",confirmPassword:"",dateOfBirth:"",name:""}),[r,i]=(0,t.useState)(null),[o,s]=(0,t.useState)({}),[a,c]=(0,t.useState)(!1),[l,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)(null),p=Q(),{register:f}=ZT(),m=e=>{const{name:t,value:r}=e.target;n((e=>({...e,[t]:r}))),o[t]&&s((e=>({...e,[t]:void 0})))};return a?(0,We.jsx)(sP,{maxWidth:"sm",children:(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,We.jsx)(FN,{})})}):(0,We.jsx)(sP,{maxWidth:"sm",children:(0,We.jsx)(Je,{sx:{mt:8},children:(0,We.jsxs)(kC,{elevation:0,sx:{p:4},children:[(0,We.jsx)(mA,{variant:"h4",gutterBottom:!0,align:"center",children:"Create Account"}),(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",paragraph:!0,align:"center",children:"Join SideEye and start sharing your thoughts with the community"}),d&&(0,We.jsx)($D,{severity:"error",sx:{mb:2},children:d}),(0,We.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),h(null),(()=>{const t={};if(e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e.email)||(t.email="Invalid email format"):t.email="Email is required",e.password){const n=e.password;n.length<8?t.password="Password must be at least 8 characters long":/[A-Z]/.test(n)?/[a-z]/.test(n)?/[0-9]/.test(n)?/[!@#$%^&*(),.?":{}|<>]/.test(n)||(t.password="Password must contain at least one special character"):t.password="Password must contain at least one number":t.password="Password must contain at least one lowercase letter":t.password="Password must contain at least one uppercase letter"}else t.password="Password is required";if(e.password!==e.confirmPassword&&(t.confirmPassword="Passwords do not match"),e.username?e.username.length<3?t.username="Username must be at least 3 characters long":/^[a-zA-Z0-9_-]+$/.test(e.username)||(t.username="Username can only contain letters, numbers, underscores, and hyphens"):t.username="Username is required",e.name?e.name.length<2?t.name="Name must be at least 2 characters long":/^[a-zA-Z\s-']+$/.test(e.name)||(t.name="Name can only contain letters, spaces, hyphens, and apostrophes"):t.name="Name is required",r){const e=new Date;let n=e.getFullYear()-r.getFullYear();const i=e.getMonth()-r.getMonth();(i<0||0===i&&e.getDate()<r.getDate())&&n--,n<16?t.dateOfBirth="You must be at least 16 years old":n>120&&(t.dateOfBirth="Please enter a valid date of birth")}else t.dateOfBirth="Date of birth is required";return s(t),0===Object.keys(t).length})())try{if(c(!0),!r||isNaN(r.getTime()))throw new Error("Invalid date of birth");await f(e.email,e.password,e.username,rc.fromDate(r)),p("/verify-email",{replace:!0})}catch(d){console.error("Registration error:",d),"auth/email-already-in-use"===d.code?h("Email is already in use"):"auth/weak-password"===d.code?h("Password is too weak"):"Invalid date of birth"===d.message?h("Please enter a valid date of birth"):h(d.message||"Error creating account. Please try again.")}finally{c(!1)}},children:[(0,We.jsx)(CN,{fullWidth:!0,label:"Full Name",name:"name",value:e.name,onChange:m,margin:"normal",required:!0,error:!!o.name,helperText:o.name}),(0,We.jsx)(CN,{fullWidth:!0,label:"Username",name:"username",value:e.username,onChange:m,margin:"normal",required:!0,error:!!o.username,helperText:o.username}),(0,We.jsx)(CN,{fullWidth:!0,label:"Email",name:"email",type:"email",value:e.email,onChange:m,margin:"normal",required:!0,error:!!o.email,helperText:o.email}),(0,We.jsx)(CN,{fullWidth:!0,label:"Password",name:"password",type:l?"text":"password",value:e.password,onChange:m,margin:"normal",required:!0,error:!!o.password,helperText:o.password,InputProps:{endAdornment:(0,We.jsx)(TL,{position:"end",children:(0,We.jsx)(rR,{onClick:()=>u(!l),edge:"end",children:l?(0,We.jsx)(kB,{}):(0,We.jsx)(NB,{})})})}}),(0,We.jsx)(CN,{fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:l?"text":"password",value:e.confirmPassword,onChange:m,margin:"normal",required:!0,error:!!o.confirmPassword,helperText:o.confirmPassword}),(0,We.jsx)(OB,{label:"Date of Birth",value:r,onChange:e=>{i(e),e&&!isNaN(e.getTime())?n((t=>({...t,dateOfBirth:e.toISOString()}))):n((e=>({...e,dateOfBirth:""}))),o.dateOfBirth&&s((e=>({...e,dateOfBirth:void 0})))},slotProps:{textField:{margin:"normal",required:!0,fullWidth:!0,error:!!o.dateOfBirth,helperText:o.dateOfBirth}},disableFuture:!0,maxDate:new Date}),(0,We.jsx)(RR,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:2},disabled:a,children:"Create Account"}),(0,We.jsxs)(mA,{variant:"body2",sx:{mt:2},align:"center",children:["Already have an account? ",(0,We.jsx)(Ie,{to:"/login",children:"Log in"})]})]})]})})})},DB=()=>{const{resetPassword:e}=ZT(),[n,r]=(Q(),(0,t.useState)("")),[i,o]=(0,t.useState)(!1),[s,a]=(0,t.useState)(null),[c,l]=(0,t.useState)(null);return(0,We.jsx)(sP,{maxWidth:"xs",children:(0,We.jsxs)(kC,{elevation:0,sx:{mt:8,p:4},children:[(0,We.jsx)(mA,{variant:"h5",component:"h1",gutterBottom:!0,align:"center",children:"Reset Password"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",align:"center",paragraph:!0,children:"Enter your email address and we'll send you a link to reset your password."}),(0,We.jsxs)(Je,{component:"form",onSubmit:async t=>{if(t.preventDefault(),o(!0),a(null),l(null),!n)return a("Email is required."),void o(!1);try{await e(n),l("Password reset email sent. Please check your inbox.")}catch(r){console.error("Error sending password reset email:",r),a("Failed to send reset email. Please check the address and try again.")}finally{o(!1)}},noValidate:!0,sx:{mt:1},children:[(0,We.jsx)(CN,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:n,onChange:e=>r(e.target.value),autoFocus:!0}),s&&(0,We.jsx)($D,{severity:"error",sx:{mt:2},children:s}),c&&(0,We.jsx)($D,{severity:"success",sx:{mt:2},children:c}),(0,We.jsx)(RR,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:i,children:i?(0,We.jsx)(FN,{size:24}):"Send Reset Link"}),(0,We.jsx)(Je,{textAlign:"center",children:(0,We.jsx)(gL,{component:Ie,to:"/login",variant:"body2",children:"Back to Login"})})]})]})})},LB=["className","id"],MB=(0,wC.Ay)(mA,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),jB=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiDialogTitle"}),{className:i,id:o}=r,s=(0,Ne.A)(r,LB),a=r,c=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},yB,t)})(a),{titleId:l=o}=t.useContext(mO);return(0,We.jsx)(MB,(0,ke.A)({component:"h2",className:(0,Pe.A)(c.root,i),ownerState:a,ref:n,variant:"h6",id:null!=o?o:l},s))})),UB=jB;function VB(e){return(0,AC.Ay)("MuiDrawer",e)}(0,Ke.A)("MuiDrawer",["root","docked","paper","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const FB=["BackdropProps"],BB=["anchor","BackdropProps","children","className","elevation","hideBackdrop","ModalProps","onClose","open","PaperProps","SlideProps","TransitionComponent","transitionDuration","variant"],WB=(e,t)=>{const{ownerState:n}=e;return[t.root,("permanent"===n.variant||"persistent"===n.variant)&&t.docked,t.modal]},zB=(0,wC.Ay)(GI,{name:"MuiDrawer",slot:"Root",overridesResolver:WB})((e=>{let{theme:t}=e;return{zIndex:(t.vars||t).zIndex.drawer}})),HB=(0,wC.Ay)("div",{shouldForwardProp:gR.A,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:WB})({flex:"0 0 auto"}),GB=(0,wC.Ay)(kC,{name:"MuiDrawer",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.paper,t[`paperAnchor${(0,SC.A)(n.anchor)}`],"temporary"!==n.variant&&t[`paperAnchorDocked${(0,SC.A)(n.anchor)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(t.vars||t).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0},"left"===n.anchor&&{left:0},"top"===n.anchor&&{top:0,left:0,right:0,height:"auto",maxHeight:"100%"},"right"===n.anchor&&{right:0},"bottom"===n.anchor&&{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"},"left"===n.anchor&&"temporary"!==n.variant&&{borderRight:`1px solid ${(t.vars||t).palette.divider}`},"top"===n.anchor&&"temporary"!==n.variant&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`},"right"===n.anchor&&"temporary"!==n.variant&&{borderLeft:`1px solid ${(t.vars||t).palette.divider}`},"bottom"===n.anchor&&"temporary"!==n.variant&&{borderTop:`1px solid ${(t.vars||t).palette.divider}`})})),qB={left:"right",right:"left",top:"down",bottom:"up"};const KB=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiDrawer"}),i=iI(),o=dC(),s={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{anchor:a="left",BackdropProps:c,children:l,className:u,elevation:d=16,hideBackdrop:h=!1,ModalProps:{BackdropProps:p}={},onClose:f,open:m=!1,PaperProps:g={},SlideProps:v,TransitionComponent:y=OD,transitionDuration:_=s,variant:E="temporary"}=r,b=(0,Ne.A)(r.ModalProps,FB),w=(0,Ne.A)(r,BB),S=t.useRef(!1);t.useEffect((()=>{S.current=!0}),[]);const T=function(e,t){let{direction:n}=e;return"rtl"===n&&function(e){return-1!==["left","right"].indexOf(e)}(t)?qB[t]:t}({direction:o?"rtl":"ltr"},a),C=a,A=(0,ke.A)({},r,{anchor:C,elevation:d,open:m,variant:E},w),R=(e=>{const{classes:t,anchor:n,variant:r}=e,i={root:["root"],docked:[("permanent"===r||"persistent"===r)&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${(0,SC.A)(n)}`,"temporary"!==r&&`paperAnchorDocked${(0,SC.A)(n)}`]};return(0,bC.A)(i,VB,t)})(A),I=(0,We.jsx)(GB,(0,ke.A)({elevation:"temporary"===E?d:0,square:!0},g,{className:(0,Pe.A)(R.paper,g.className),ownerState:A,children:l}));if("permanent"===E)return(0,We.jsx)(HB,(0,ke.A)({className:(0,Pe.A)(R.root,R.docked,u),ownerState:A,ref:n},w,{children:I}));const x=(0,We.jsx)(y,(0,ke.A)({in:m,direction:qB[T],timeout:_,appear:S.current},v,{children:I}));return"persistent"===E?(0,We.jsx)(HB,(0,ke.A)({className:(0,Pe.A)(R.root,R.docked,u),ownerState:A,ref:n},w,{children:x})):(0,We.jsx)(zB,(0,ke.A)({BackdropProps:(0,ke.A)({},c,p,{transitionDuration:_}),className:(0,Pe.A)(R.root,R.modal,u),open:m,ownerState:A,onClose:f,hideBackdrop:h,ref:n},w,b,{children:x}))})),$B=KB;function YB(e){return(0,AC.Ay)("MuiCard",e)}(0,Ke.A)("MuiCard",["root"]);const XB=["className","raised"],JB=(0,wC.Ay)(kC,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),QB=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiCard"}),{className:r,raised:i=!1}=n,o=(0,Ne.A)(n,XB),s=(0,ke.A)({},n,{raised:i}),a=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},YB,t)})(s);return(0,We.jsx)(JB,(0,ke.A)({className:(0,Pe.A)(a.root,r),elevation:i?8:void 0,ref:t,ownerState:s},o))})),ZB=QB;function eW(e){return(0,AC.Ay)("MuiCardMedia",e)}(0,Ke.A)("MuiCardMedia",["root","media","img"]);const tW=["children","className","component","image","src","style"],nW=(0,wC.Ay)("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{isMediaComponent:r,isImageComponent:i}=n;return[t.root,r&&t.media,i&&t.img]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t.isMediaComponent&&{width:"100%"},t.isImageComponent&&{objectFit:"cover"})})),rW=["video","audio","picture","iframe","img"],iW=["picture","img"],oW=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiCardMedia"}),{children:r,className:i,component:o="div",image:s,src:a,style:c}=n,l=(0,Ne.A)(n,tW),u=-1!==rW.indexOf(o),d=!u&&s?(0,ke.A)({backgroundImage:`url("${s}")`},c):c,h=(0,ke.A)({},n,{component:o,isMediaComponent:u,isImageComponent:-1!==iW.indexOf(o)}),p=(e=>{const{classes:t,isMediaComponent:n,isImageComponent:r}=e,i={root:["root",n&&"media",r&&"img"]};return(0,bC.A)(i,eW,t)})(h);return(0,We.jsx)(nW,(0,ke.A)({className:(0,Pe.A)(p.root,i),as:o,role:!u&&s?"img":void 0,ref:t,style:d,ownerState:h,src:u?s||a:void 0},l,{children:r}))})),sW=oW;function aW(e){return(0,AC.Ay)("MuiCardContent",e)}(0,Ke.A)("MuiCardContent",["root"]);const cW=["className","component"],lW=(0,wC.Ay)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),uW=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiCardContent"}),{className:r,component:i="div"}=n,o=(0,Ne.A)(n,cW),s=(0,ke.A)({},n,{component:i}),a=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},aW,t)})(s);return(0,We.jsx)(lW,(0,ke.A)({as:i,className:(0,Pe.A)(a.root,r),ownerState:s,ref:t},o))})),dW=uW;function hW(e){return(0,AC.Ay)("MuiCardActions",e)}(0,Ke.A)("MuiCardActions",["root","spacing"]);const pW=["disableSpacing","className"],fW=(0,wC.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),mW=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiCardActions"}),{disableSpacing:r=!1,className:i}=n,o=(0,Ne.A)(n,pW),s=(0,ke.A)({},n,{disableSpacing:r}),a=(e=>{const{classes:t,disableSpacing:n}=e,r={root:["root",!n&&"spacing"]};return(0,bC.A)(r,hW,t)})(s);return(0,We.jsx)(fW,(0,ke.A)({className:(0,Pe.A)(a.root,i),ownerState:s,ref:t},o))})),gW=mW,vW=(0,zC.A)((0,We.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 12H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Message"),yW=(0,zC.A)((0,We.jsx)("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"}),"PersonRemove"),_W=(0,zC.A)((0,We.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd"),EW=(0,zC.A)((0,We.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),bW=(0,zC.A)((0,We.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),wW=((0,zC.A)((0,We.jsx)("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM18 14H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Comment"),(0,zC.A)((0,We.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2z"}),"Repeat")),SW=(0,zC.A)([(0,We.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,We.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),TW=(0,zC.A)((0,We.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),CW=(0,zC.A)((0,We.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),AW=(0,zC.A)((0,We.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),RW=(0,zC.A)((0,We.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group");function IW(e){const{children:t,value:n,index:r,...i}=e;return(0,We.jsx)("div",{role:"tabpanel",hidden:n!==r,id:`profile-tabpanel-${r}`,"aria-labelledby":`profile-tab-${r}`,...i,children:n===r&&(0,We.jsx)(Je,{sx:{p:3},children:t})})}const xW=e=>{let{open:n,onClose:r,followers:i,followersList:o,followingList:s,connections:a,currentUser:c,isLoading:l,handleUnfollow:u,handleFollow:d,initialTab:h}=e;const[p,f]=(0,t.useState)(h);return(0,t.useEffect)((()=>{f(h)}),[h,n]),(0,We.jsxs)(wO,{open:n,onClose:r,maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:(0,We.jsxs)(DP,{value:p,onChange:(e,t)=>f(t),variant:"fullWidth",children:[(0,We.jsx)(FP,{label:`Followers (${i.length})`}),(0,We.jsx)(FP,{label:`Following (${a.length})`})]})}),(0,We.jsx)(SB,{children:(0,We.jsx)(DR,{children:0===p?o.length>0?o.map((e=>(0,We.jsxs)(sO,{divider:!0,children:[(0,We.jsx)(dO,{children:(0,We.jsx)(Ie,{to:`/profile/${e.username||e.id}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:e.profilePic||void 0})})}),(0,We.jsx)(Px,{primary:(0,We.jsx)(Ie,{to:`/profile/${e.username||e.id}`,style:{textDecoration:"none"},children:(0,We.jsx)(mA,{variant:"subtitle1",sx:{color:"text.primary","&:hover":{textDecoration:"underline"}},children:e.name||e.username||"User"})}),secondary:e.username?`@${e.username}`:""}),(null===c||void 0===c?void 0:c.uid)!==e.id&&(0,We.jsx)(eO,{children:(0,We.jsx)(RR,{variant:a.includes(e.id)?"outlined":"contained",color:a.includes(e.id)?"error":"primary",onClick:t=>{t.stopPropagation(),a.includes(e.id)?u(e.id):d()},disabled:l,size:"small",children:l?"Loading...":a.includes(e.id)?"Unfollow":"Follow"})})]},e.id))):(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",sx:{p:2,textAlign:"center"},children:"No followers yet"}):s.length>0?s.map((e=>(0,We.jsxs)(sO,{divider:!0,children:[(0,We.jsx)(dO,{children:(0,We.jsx)(Ie,{to:`/profile/${e.username||e.id}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:e.profilePic||void 0})})}),(0,We.jsx)(Px,{primary:(0,We.jsx)(Ie,{to:`/profile/${e.username||e.id}`,style:{textDecoration:"none"},children:(0,We.jsx)(mA,{variant:"subtitle1",sx:{color:"text.primary","&:hover":{textDecoration:"underline"}},children:e.name||e.username||"User"})}),secondary:e.username?`@${e.username}`:""}),(null===c||void 0===c?void 0:c.uid)!==e.id&&(0,We.jsx)(eO,{children:(0,We.jsx)(RR,{variant:"outlined",color:"error",onClick:t=>{t.stopPropagation(),u(e.id)},disabled:l,size:"small",children:l?"Loading...":"Unfollow"})})]},e.id))):(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",sx:{p:2,textAlign:"center"},children:"Not following anyone yet"})})}),(0,We.jsx)(qU,{children:(0,We.jsx)(RR,{onClick:r,children:"Close"})})]})},OW=()=>{var e;IL(iI().breakpoints.down("sm"));const{currentUser:n,user:r,userProfile:i,loading:o,setUserProfile:s}=ZT(),{db:a}=WP(),{userId:c}=Z(),[l,u]=(0,t.useState)(null),[d,h]=(0,t.useState)(""),[p,f]=(0,t.useState)(""),[m,g]=(0,t.useState)(""),[v,y]=(0,t.useState)(""),[_,E]=(0,t.useState)(!1),[b,w]=(0,t.useState)(0),[S,T]=(0,t.useState)([]),[C,A]=(0,t.useState)([]),[R,I]=(0,t.useState)([]),[x,O]=(0,t.useState)([]),[k,N]=(0,t.useState)(!0),[P,D]=(0,t.useState)(null),[L,M]=(0,t.useState)([]),[j,U]=(0,t.useState)([]),[V,F]=(0,t.useState)(!1),[B,W]=(0,t.useState)(null),[z,H]=(0,t.useState)(!1),[G,q]=(0,t.useState)([]),[K,$]=(0,t.useState)(""),[Y,X]=(0,t.useState)(0),[J,ee]=(0,t.useState)([]),[te,ne]=(0,t.useState)(!1),re=(0,t.useRef)(null),[ie,oe]=(0,t.useState)([]),[se,ae]=(0,t.useState)([]),[ce,le]=(0,t.useState)(!1),[ue,de]=(0,t.useState)(""),[he,pe]=(0,t.useState)(""),[fe,me]=(0,t.useState)(""),[ge,ve]=(0,t.useState)(!1),[ye,_e]=(0,t.useState)(!1),[Ee,be]=(0,t.useState)(!1),[we,Se]=(0,t.useState)(null),[Te,Ce]=(0,t.useState)(null),[Ae,Re]=(0,t.useState)(!1),[xe,Oe]=(0,t.useState)(0),[ke,Ne]=(0,t.useState)(!1),[Pe,De]=(0,t.useState)(!1),[Le,Me]=(0,t.useState)(!1),[je,Ue]=(0,t.useState)([]),[Ve,Fe]=(0,t.useState)(null),[Be,ze]=(0,t.useState)(""),[He,Ge]=(0,t.useState)(!1),[qe,Ke]=(0,t.useState)(!1),[$e,Ye]=(0,t.useState)(!1),[Xe,Qe]=(0,t.useState)(!1),[Ze,et]=(0,t.useState)([]),[tt,nt]=(0,t.useState)(null),[rt,it]=(0,t.useState)([]),[ot,st]=(0,t.useState)([]),[at,ct]=(0,t.useState)([]),[lt,ut]=(0,t.useState)([]),[dt,ht]=(0,t.useState)(!1),[pt,ft]=(Q(),(0,t.useState)(!1)),[mt,gt]=(0,t.useState)([]),vt=l||(null===n||void 0===n?void 0:n.uid)||"";(0,t.useEffect)((()=>{u(c||((null===n||void 0===n?void 0:n.uid)||null))}),[c,null===n||void 0===n?void 0:n.uid]);const yt=(0,t.useCallback)((async()=>{if(a&&l)try{N(!0),D(null);const e=eg(a,"users",l),t=await uv(e);if(!t.exists())return D("Profile not found"),void N(!1);const r=t.data(),i=r.isPrivate||!1,o=(null===n||void 0===n?void 0:n.uid)===l;if(Ne(i),nt(r),h(r.username||""),f(r.name||""),y(r.bio||""),W(r.profilePic||null),o||!i)Me(!0),D(null);else if(null!==n&&void 0!==n&&n.uid){const e=eg(a,`users/${l}/followers/${n.uid}`),t=(await uv(e)).exists();Me(t),t||D("This profile is private")}else Me(!1),D("This profile is private");const[s,c]=await Promise.all([hv(Zm(a,`users/${l}/followers`)),hv(Zm(a,`users/${l}/following`))]),u=s.docs.map((e=>e.id)),d=c.docs.map((e=>e.id));if(U(u),it(d),M(d),Le){const[e,t]=await Promise.all([Promise.all(u.map((e=>uv(eg(a,"users",e))))),Promise.all(d.map((e=>uv(eg(a,"users",e)))))]);oe(e.map((e=>({id:e.id,...e.data()})))),ae(t.map((e=>({id:e.id,...e.data()}))));const[n,r,i]=await Promise.all([hv(Gg(Zm(a,"posts"),Kg("authorId","==",l),Xg("timestamp","desc"))),hv(Gg(Zm(a,"posts"),Kg("likedBy","array-contains",l),Xg("timestamp","desc"))),hv(Gg(Zm(a,"videos"),Kg("userId","==",l),Xg("timestamp","desc")))]);T(n.docs.map((e=>({id:e.id,...e.data()})))),O(r.docs.map((e=>({id:e.id,...e.data()})))),Ue(i.docs.map((e=>({id:e.id,...e.data()}))))}}catch(P){console.error("Error in fetchUserData:",P),D("Failed to load profile data")}finally{N(!1)}else N(!1)}),[a,l,null===n||void 0===n?void 0:n.uid,Le]);(0,t.useEffect)((()=>{if(!a||!l)return;const e=vv(eg(a,"users",l),(async e=>{if(e.exists()){const t=e.data(),r=t.isPrivate||!1,i=(null===n||void 0===n?void 0:n.uid)===l;if(nt(t),Ne(r),h(t.username||""),f(t.name||""),y(t.bio||""),W(t.profilePic||null),i||!r)Me(!0),D(null);else if(null!==n&&void 0!==n&&n.uid){const e=eg(a,`users/${l}/followers/${n.uid}`),t=(await uv(e)).exists();Me(t),t||D("This profile is private")}else Me(!1),D("This profile is private");if(!r&&$e)try{if(null!==n&&void 0!==n&&n.uid){const e=eg(a,"users",l,"followRequests",n.uid);await mv(e),Ye(!1)}}catch(P){console.error("Error clearing follow request:",P)}}}),(e=>{console.error("Error in privacy settings listener:",e),D("Failed to sync privacy settings")}));return()=>e()}),[a,l,null===n||void 0===n?void 0:n.uid,$e]),(0,t.useEffect)((()=>{l&&yt()}),[yt,l]),(0,t.useEffect)((()=>{i&&(de(i.name||""),pe(i.bio||""),me(i.username||""))}),[i]),(0,t.useEffect)((()=>{ve(!(null===n||void 0===n||!n.uid)&&j.includes(n.uid))}),[n,j]),(0,t.useEffect)((()=>{if(null!==n&&void 0!==n&&n.uid&&l&&ke){const e=async()=>{if(a)try{const e=eg(a,"users",l,"followRequests",n.uid),t=await uv(e);Ye(t.exists())}catch(P){console.error("Error checking follow request:",P)}};if(e(),a){const e=vv(eg(a,"users",l,"followRequests",n.uid),(e=>{Ye(e.exists())}));return()=>e()}}}),[null===n||void 0===n?void 0:n.uid,l,ke,a]),(0,t.useEffect)((()=>{if(null!==n&&void 0!==n&&n.uid&&l&&n.uid===l){const e=async()=>{if(a)try{const e=Zm(a,"users",l,"followRequests"),t=(await hv(e)).docs.map((e=>e.id));et(t)}catch(P){console.error("Error fetching pending requests:",P)}};e()}}),[null===n||void 0===n?void 0:n.uid,l,a]),(0,t.useEffect)((()=>{if(!a||!vt||vt!==(null===n||void 0===n?void 0:n.uid))return;const e=vv(Zm(a,"users",vt,"followRequests"),(async e=>{const t=await Promise.all(e.docs.map((async e=>{const t=eg(a,"users",e.id),n=(await uv(t)).data();return{id:e.id,name:n.name||"",username:n.username||"",profilePic:n.profilePic||"",bio:n.bio||"",isPrivate:n.isPrivate||!1,createdAt:n.createdAt?n.createdAt.toDate():new Date}})));ut(t)}));return()=>e()}),[a,vt,n]);const _t=async()=>{if(a&&n&&l)try{if(ke){const e=eg(a,"users",l,"followRequests",n.uid);await pv(e,{timestamp:Av()});const t=eg(Zm(a,"users",l,"notifications"));await pv(t,{type:"follow_request",senderId:n.uid,senderName:n.displayName||"Anonymous",senderAvatar:n.photoURL||"",timestamp:Av(),read:!1}),Ye(!0)}else{const e=eg(a,"users",n.uid,"following",l),t=eg(a,"users",l,"followers",n.uid);await pv(e,{timestamp:Av()}),await pv(t,{timestamp:Av()}),ve(!0)}}catch(P){console.error("Error handling follow:",P),D("Failed to process follow request")}},Et=async e=>{if(!n||!vt||!a)return void D("Database not initialized");const t=e||vt;try{N(!0);const e=eg(a,"users",n.uid,"following",t);await mv(e);const r=eg(a,"users",t,"followers",n.uid);await mv(r),ve(!1),U((e=>e.filter((e=>e!==n.uid)))),it((e=>e.filter((e=>e!==t)))),await yt()}catch(P){console.error("Error unfollowing user:",P),D("Failed to unfollow user")}finally{N(!1)}};(0,t.useEffect)((()=>{if(!a||!vt)return;const e=vv(Zm(a,"users",vt,"followers"),(e=>{const t=e.docs.map((e=>e.id));U(t)}));return()=>e()}),[a,vt]),(0,t.useEffect)((()=>{if(!a||!vt)return;const e=vv(Zm(a,"users",vt,"following"),(e=>{const t=e.docs.map((e=>e.id));M(t)}));return()=>e()}),[a,vt]),(0,t.useEffect)((()=>{if(!a||!n||!vt)return;const e=vv(eg(a,"users",n.uid,"following",vt),(e=>{ve(e.exists())}));return()=>e()}),[a,n,vt]),(0,t.useEffect)((()=>{if(null!==n&&void 0!==n&&n.uid&&l){const e=async()=>{if(a)try{const e=eg(a,"users",l,"followers",n.uid),t=await uv(e);Me(t.exists()||n.uid===l)}catch(P){console.error("Error checking profile visibility:",P)}};e()}}),[null===n||void 0===n?void 0:n.uid,l,a]);const bt=()=>(null===n||void 0===n?void 0:n.uid)!==l&&l?(0,We.jsx)(RR,{variant:ge?"outlined":"contained",color:ge?"error":"primary",startIcon:ge?(0,We.jsx)(yW,{}):(0,We.jsx)(_W,{}),onClick:ge?()=>Et(l):_t,disabled:k||ke&&$e,children:k?"Loading...":ge?"Unfollow":ke&&$e?"Requested":"Follow"}):null,wt=async()=>{if(n&&vt&&K.trim()&&!ce&&a)try{le(!0);const e={senderId:n.uid,receiverId:vt,content:K.trim(),timestamp:Av(),read:!1,senderName:n.displayName||"Anonymous",senderAvatar:(null===i||void 0===i?void 0:i.profilePic)||null};await gv(Zm(a,"messages"),e),$("")}catch(P){console.error("Error sending message:",P),D("Failed to send message")}finally{le(!1)}else D("Database not initialized")},St=async e=>{if(n&&a)try{const t=eg(a,"messages",e);await fv(t,{read:!0})}catch(P){console.error("Error marking message as read:",P)}else D("Database not initialized")};(0,t.useEffect)((()=>{if(z){const e=(async()=>{if($S.currentUser&&vt&&a)try{const e=vv(Gg(Zm(a,"messages"),Kg("receiverId","==",$S.currentUser.uid),Xg("timestamp","desc")),(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));q(t),X(t.filter((e=>!e.read)).length)}));return e}catch(P){console.error("Error fetching messages:",P)}else D("Database not initialized")})();return()=>{e&&e.then((e=>null===e||void 0===e?void 0:e()))}}}),[z]);const Tt=async e=>{if(!n||!a)return;console.log(`Profile: handleLike triggered for postId: ${e}`);const t=eg(a,"posts",e),r=n.uid,i=Zm(a,"notifications");try{await Cv(a,(async e=>{const n=await e.get(t);if(!n.exists())throw new Error("Post not found");let i=n.data().likedBy||[];i.includes(r)?(console.log("[Transaction] Profile: Unliking..."),i=i.filter((e=>e!==r)),e.update(t,{likedBy:i,likes:i.length})):(console.log("[Transaction] Profile: Liking..."),i=[...i,r],e.update(t,{likedBy:i,likes:i.length}))})),console.log("Profile: Like transaction successful.");const o=await uv(t);if(o.exists()){const t=o.data();if((t.likedBy||[]).includes(r)&&t.authorId!==r){console.log("Profile: Creating like notification...");const o={type:"like",senderId:r,senderName:n.displayName||"Anonymous",senderAvatar:n.photoURL||"",recipientId:t.authorId,postId:e,content:`${n.displayName||"Someone"} liked your post`,createdAt:Av(),isRead:!1};await gv(i,o),console.log("Profile: Like notification created.")}}}catch(P){console.error("Profile: Error toggling like:",P),bT.error("Failed to update like")}},Ct=async e=>{if(!n||!a)return;console.log(`Profile: handleRepost triggered for postId: ${e}`);const t=eg(a,"posts",e),r=n.uid,i=Zm(a,"notifications");try{await Cv(a,(async e=>{const n=await e.get(t);if(!n.exists())throw new Error("Post not found");let i=n.data().repostedBy||[];i.includes(r)?(console.log("[Transaction] Profile: Unreposting..."),i=i.filter((e=>e!==r)),e.update(t,{repostedBy:i,reposts:i.length})):(console.log("[Transaction] Profile: Reposting..."),i=[...i,r],e.update(t,{repostedBy:i,reposts:i.length}))})),console.log("Profile: Repost transaction successful.");const o=await uv(t);if(o.exists()){const t=o.data();if((t.repostedBy||[]).includes(r)&&t.authorId!==r){console.log("Profile: Creating repost notification...");const o={type:"repost",senderId:r,senderName:n.displayName||"Anonymous",senderAvatar:n.photoURL||"",recipientId:t.authorId,postId:e,content:`${n.displayName||"Someone"} reposted your post`,createdAt:Av(),isRead:!1};await gv(i,o),console.log("Profile: Repost notification created.")}}}catch(P){console.error("Profile: Error toggling repost:",P),bT.error("Failed to update repost")}},At=()=>{var e;return(0,We.jsx)($B,{anchor:"bottom",open:qe,onClose:()=>Ke(!1),PaperProps:{sx:{height:"80vh",borderTopLeftRadius:16,borderTopRightRadius:16,overflow:"hidden","@media (max-width: 600px)":{height:"90vh"}}},children:(0,We.jsxs)(Je,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(mA,{variant:"h6",children:"Comments"}),(0,We.jsx)(rR,{onClick:()=>Ke(!1),children:(0,We.jsx)(EW,{})})]}),Ve&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Je,{sx:{mb:2},children:(0,We.jsx)("video",{src:Ve.url,style:{width:"100%",maxHeight:"200px",objectFit:"contain",backgroundColor:"black"},controls:!0,playsInline:!0,muted:!0})}),(0,We.jsx)(DR,{sx:{flex:1,overflow:"auto",mb:2},children:null===(e=Ve.commentsList)||void 0===e?void 0:e.map((e=>(0,We.jsxs)(sO,{divider:!0,children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{children:e.username[0]})}),(0,We.jsx)(Px,{primary:e.username,secondary:(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(mA,{variant:"body2",children:e.content}),(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:_D(e.timestamp)})]})})]},e.id)))}),(0,We.jsx)(Je,{sx:{mt:"auto"},children:(0,We.jsx)(CN,{fullWidth:!0,size:"small",placeholder:"Add a comment...",value:Be,onChange:e=>ze(e.target.value),InputProps:{endAdornment:(0,We.jsx)(RR,{size:"small",onClick:()=>Ve&&(async(e,t)=>{if(!n||!t.trim()||!a)return;console.log(`Profile: handleAddComment triggered for postId: ${e}`);const r=eg(a,"posts",e),i=Zm(a,`posts/${e}/comments`),o=n.uid,s=Zm(a,"notifications");let c=null;try{await Cv(a,(async e=>{const t=await e.get(r);if(!t.exists())throw new Error("Post not found");console.log("[Transaction] Profile: Incrementing comment count...");const n=t.data().comments||0;e.update(r,{comments:n+1})})),console.log("Profile: Adding comment document...");const l={content:t.trim(),userId:o,username:n.displayName||"Anonymous",userPhotoURL:n.photoURL||"",timestamp:Av()};c=(await gv(i,l)).id,console.log("Profile: Comment document added.");const u=await uv(r);if(u.exists()){const r=u.data();if(r.authorId!==o){console.log("Profile: Creating comment notification...");const i={type:"comment",senderId:o,senderName:n.displayName||"Anonymous",senderAvatar:n.photoURL||"",recipientId:r.authorId,postId:e,commentId:c,content:`${n.displayName||"Someone"} commented on your post: "${t.trim()}"`,createdAt:Av(),isRead:!1};await gv(s,i),console.log("Profile: Comment notification created."),console.log("Profile: Checking for mentions...");const l=/@(\w+)/g,u=t.match(l);if(u)for(const d of u){const i=d.substring(1),l=Gg(Zm(a,"users"),Kg("username","==",i),Qg(1)),u=await hv(l);if(!u.empty){const a=u.docs[0];if(a.id!==o&&a.id!==r.authorId){console.log(`Profile: Creating mention notification for ${i}...`);const r={type:"mention",senderId:o,senderName:n.displayName||"Anonymous",senderAvatar:n.photoURL||"",recipientId:a.id,postId:e,commentId:c,content:`${n.displayName||"Someone"} mentioned you in a comment: "${t.trim()}"`,createdAt:Av(),isRead:!1};await gv(s,r),console.log(`Profile: Mention notification created for ${i}.`)}}}}}}catch(P){console.error("Profile: Error adding comment:",P),bT.error("Failed to add comment")}})(Ve.id,Be),disabled:!Be.trim()||He,children:"Post"})}})})]})]})})},Rt=()=>{Ce(null)};(0,t.useEffect)((()=>{if(a&&l)try{N(!0),D(null);const e=Gg(Zm(a,"users",l,"sideRooms"),Xg("lastActive","desc")),t=Gg(Zm(a,"sideRooms"),Kg("ownerId","==",l)),n=vv(e,(e=>{const t=e.docs.map((e=>{var t,n;return{id:e.id,...e.data(),joinedAt:null===(t=e.data().joinedAt)||void 0===t?void 0:t.toDate(),lastActive:null===(n=e.data().lastActive)||void 0===n?void 0:n.toDate()}}));st(t)}),(e=>{console.error("Error fetching joined rooms:",e)})),r=vv(t,(e=>{const t=e.docs.map((e=>{var t,n,r;return{id:e.id,roomId:e.id,name:e.data().name,description:e.data().description,memberCount:e.data().memberCount,isPrivate:e.data().isPrivate,category:e.data().category,role:"owner",joinedAt:null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate(),lastActive:null===(n=e.data().lastActive)||void 0===n?void 0:n.toDate(),isOwner:!0,thumbnailUrl:(null===(r=e.data().style)||void 0===r?void 0:r.thumbnailUrl)||null}}));ct(t)}),(e=>{console.error("Error fetching created rooms:",e)}));return()=>{n(),r()}}catch(P){console.error("Error setting up rooms listeners:",P),D("Failed to set up rooms listeners")}finally{N(!1)}else N(!1)}),[a,l]);return(0,t.useEffect)((()=>{if(!a||!l)return;const e=vv(Gg(Zm(a,"marketplace"),Kg("sellerId","==",l),Xg("createdAt","desc")),(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));gt(t)}));return()=>e()}),[a,l]),o||k?(0,We.jsx)(sP,{maxWidth:"lg",children:(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,We.jsx)(FN,{})})}):(0,We.jsxs)(sP,{maxWidth:"lg",sx:{mt:2,mb:4},children:[(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,We.jsxs)(kC,{elevation:0,sx:{p:3,borderRadius:2,backgroundColor:"background.paper"},children:[(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3,alignItems:"center"},children:[(0,We.jsx)(Je,{sx:{position:"relative"},children:(0,We.jsx)(fR,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:(null===n||void 0===n?void 0:n.uid)===l&&(0,We.jsx)(rR,{component:"label",size:"small",onClick:e=>{Ce(e.currentTarget)},sx:{bgcolor:"background.paper","&:hover":{bgcolor:"background.default"}},children:(0,We.jsx)(SW,{fontSize:"small"})}),children:(0,We.jsx)(cA,{src:B||void 0,alt:d,sx:{width:120,height:120}})})}),(0,We.jsxs)(Je,{sx:{flex:1,minWidth:0},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[(0,We.jsx)(mA,{variant:"h4",sx:{fontWeight:"bold"},children:p||"No name set"}),ke&&(0,We.jsx)(TW,{color:"action"}),(null===n||void 0===n?void 0:n.uid)===vt&&(0,We.jsx)(rR,{onClick:()=>E(!0),size:"small",children:(0,We.jsx)(CW,{fontSize:"small"})})]}),(0,We.jsxs)(mA,{variant:"body1",color:"text.secondary",sx:{mb:2},children:["@",d||"No username set"]}),ke&&!Le&&(null===n||void 0===n?void 0:n.uid)!==vt?(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,We.jsx)($D,{severity:"info",sx:{mb:2},children:"This account is private. Follow to see their posts and other content."}),(0,We.jsx)(Je,{sx:{display:"flex",gap:2},children:bt()})]}):(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(mA,{variant:"body1",sx:{mb:2},children:v||"No bio set"}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[bt(),vt?(0,We.jsx)(rR,{color:"primary",onClick:()=>{H(!0),G.forEach((e=>{e.read||St(e.id)}))},sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",opacity:.8},width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,We.jsx)(fR,{badgeContent:Y,color:"error",children:(0,We.jsx)(vW,{})})}):null,(null===n||void 0===n?void 0:n.uid)===vt&&(0,We.jsx)(rR,{color:"error",onClick:()=>_e(!0),sx:{border:"1px solid",borderColor:"error.main","&:hover":{backgroundColor:"error.light",opacity:.8}},children:(0,We.jsx)(AW,{})})]})]})]})]}),(null===n||void 0===n?void 0:n.uid)===vt&&lt.length>0&&(0,We.jsxs)(RR,{startIcon:(0,We.jsx)(_W,{}),onClick:()=>ht(!0),color:"primary",variant:"outlined",sx:{ml:2},children:["Follow Requests (",lt.length,")"]})]}),!ke||Le||(null===n||void 0===n?void 0:n.uid)===vt?(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3},children:[(0,We.jsx)(kC,{elevation:0,sx:{p:2,borderRadius:2,backgroundColor:"background.paper",flex:{md:1}},children:(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-around",gap:2},children:[(0,We.jsxs)(Je,{sx:{textAlign:"center"},children:[(0,We.jsx)(mA,{variant:"h6",children:S.length||0}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Posts"})]}),(0,We.jsxs)(Je,{sx:{textAlign:"center",cursor:"pointer","&:hover":{color:"primary.main"}},onClick:()=>{yt(),Oe(0),F(!0)},children:[(0,We.jsx)(mA,{variant:"h6",children:j.length||0}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Followers"})]}),(0,We.jsxs)(Je,{sx:{textAlign:"center",cursor:"pointer","&:hover":{color:"primary.main"}},onClick:()=>{yt(),Oe(1),F(!0)},children:[(0,We.jsx)(mA,{variant:"h6",children:rt.length||0}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Following"})]})]})}),(0,We.jsx)(xW,{open:V,onClose:()=>F(!1),followers:j,followersList:ie,followingList:se,connections:L,currentUser:n,isLoading:k,handleUnfollow:Et,handleFollow:_t,initialTab:xe}),(0,We.jsx)(Je,{sx:{flex:{md:2}},children:(0,We.jsx)(kC,{elevation:0,sx:{borderRadius:2,backgroundColor:"background.paper"},children:(0,We.jsxs)(DP,{value:b,onChange:(e,t)=>{w(t)},variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:"medium"}},children:[(0,We.jsx)(FP,{label:"Posts"}),(0,We.jsx)(FP,{label:"Marketplace"}),(0,We.jsx)(FP,{label:"Side Rooms"}),(0,We.jsx)(FP,{label:"Liked Posts"}),(null===n||void 0===n?void 0:n.uid)===vt&&(0,We.jsx)(FP,{label:"Deleted Items"})]})})})]}):(0,We.jsx)(kC,{elevation:0,sx:{p:3,borderRadius:2,backgroundColor:"background.paper"},children:(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-around",gap:2},children:[(0,We.jsxs)(Je,{sx:{textAlign:"center"},children:[(0,We.jsx)(mA,{variant:"h6",children:S.length||0}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Posts"})]}),(0,We.jsxs)(Je,{sx:{textAlign:"center"},children:[(0,We.jsx)(mA,{variant:"h6",children:j.length||0}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Followers"})]}),(0,We.jsxs)(Je,{sx:{textAlign:"center"},children:[(0,We.jsx)(mA,{variant:"h6",children:rt.length||0}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Following"})]})]})}),(0,We.jsxs)(Je,{sx:{flex:1},children:[(0,We.jsx)(IW,{value:b,index:0,children:Le?0===S.length?(0,We.jsx)(mA,{children:"No posts yet"}):(0,We.jsx)(DR,{children:S.map((e=>{var t,r;return(0,We.jsxs)(sO,{divider:!0,sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>{Se(e),be(!0)},children:[(0,We.jsx)(dO,{children:(0,We.jsx)(Ie,{to:`/profile/${e.authorName}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:e.authorAvatar||void 0})})}),(0,We.jsx)(Px,{primary:(0,We.jsxs)(Je,{children:[(0,We.jsx)(Ie,{to:`/profile/${e.authorName}`,style:{textDecoration:"none"},children:(0,We.jsx)(mA,{variant:"subtitle1",component:"span",sx:{color:"text.primary","&:hover":{textDecoration:"underline"}},children:e.authorName})}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",component:"span",sx:{ml:1},children:_D(e.timestamp)})]}),secondary:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"body1",sx:{mt:1},children:e.content}),e.isEdited&&(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:"(edited)"})]})}),(0,We.jsx)(eO,{children:(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsxs)(rR,{edge:"end","aria-label":"likes",onClick:t=>{t.stopPropagation(),Tt(e.id)},children:[(0,We.jsx)(bW,{color:null!==(t=e.likedBy)&&void 0!==t&&t.includes((null===n||void 0===n?void 0:n.uid)||"")?"error":"inherit"}),(0,We.jsx)(mA,{variant:"body2",sx:{ml:1},children:e.likes||0})]}),(0,We.jsxs)(rR,{edge:"end","aria-label":"repost",onClick:t=>{t.stopPropagation(),Ct(e.id)},children:[(0,We.jsx)(wW,{color:null!==(r=e.repostedBy)&&void 0!==r&&r.includes((null===n||void 0===n?void 0:n.uid)||"")?"primary":"inherit"}),(0,We.jsx)(mA,{variant:"body2",sx:{ml:1},children:e.reposts||0})]})]})})]},e.id)}))}):(0,We.jsxs)(Je,{sx:{textAlign:"center",py:4},children:[(0,We.jsx)(TW,{sx:{fontSize:40,color:"text.secondary",mb:2}}),(0,We.jsx)(mA,{variant:"h6",color:"text.secondary",children:"This account's posts are private"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Follow this account to see their posts"})]})}),(0,We.jsx)(IW,{value:b,index:1,children:Le?0===mt.length?(0,We.jsxs)(Je,{sx:{textAlign:"center",py:4},children:[(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",children:"No items listed in the marketplace"}),(null===n||void 0===n?void 0:n.uid)===l&&(0,We.jsx)(RR,{variant:"contained",color:"primary",component:Ie,to:"/marketplace/add",sx:{mt:2},children:"Add Item"})]}):(0,We.jsx)(Je,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"1fr 1fr 1fr"},gap:2},children:mt.map((e=>(0,We.jsxs)(ZB,{children:[(0,We.jsx)(sW,{component:"img",height:"200",image:e.images[0],alt:e.title,sx:{objectFit:"cover"}}),(0,We.jsxs)(dW,{children:[(0,We.jsx)(mA,{variant:"h6",noWrap:!0,children:e.title}),(0,We.jsxs)(mA,{variant:"h6",color:"primary",sx:{mt:1},children:["$",e.price.toFixed(2)]}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mt:1},noWrap:!0,children:e.description}),(0,We.jsx)(rV,{label:e.status,color:"available"===e.status?"success":"pending"===e.status?"warning":"default",size:"small",sx:{mt:1}})]}),(0,We.jsx)(gW,{children:(0,We.jsx)(RR,{size:"small",component:Ie,to:`/marketplace/${e.id}`,variant:"contained",fullWidth:!0,children:"View Details"})})]},e.id)))}):(0,We.jsxs)(Je,{sx:{textAlign:"center",py:4},children:[(0,We.jsx)(TW,{sx:{fontSize:40,color:"text.secondary",mb:2}}),(0,We.jsx)(mA,{variant:"h6",color:"text.secondary",children:"This account's marketplace items are private"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Follow this account to see their marketplace items"})]})}),(0,We.jsx)(IW,{value:b,index:2,children:Le?0===at.length&&0===ot.length?(0,We.jsxs)(Je,{sx:{textAlign:"center",py:4},children:[(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",children:"Not a member of any side rooms yet"}),(0,We.jsx)(RR,{variant:"contained",color:"primary",component:Ie,to:"/side-rooms",sx:{mt:2},children:"Browse Side Rooms"})]}):(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:3},children:[at.length>0&&(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h6",sx:{mb:2},children:"Created Rooms"}),(0,We.jsx)(Je,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:at.map((e=>(0,We.jsxs)(ZB,{sx:{display:"flex",flexDirection:"column",height:"100%","&:hover":{boxShadow:6,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.thumbnailUrl&&(0,We.jsx)(sW,{component:"img",height:"140",image:e.thumbnailUrl,alt:e.name,sx:{objectFit:"cover"}}),(0,We.jsxs)(dW,{sx:{flexGrow:1},children:[(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,We.jsx)(mA,{variant:"h6",component:"div",children:e.name}),(0,We.jsx)(rV,{size:"small",label:"Owner",color:"primary"})]}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,We.jsx)(rV,{size:"small",label:`${e.memberCount||0} members`,icon:(0,We.jsx)(RW,{})}),e.category&&(0,We.jsx)(rV,{size:"small",label:e.category,variant:"outlined"}),e.isPrivate&&(0,We.jsx)(rV,{size:"small",icon:(0,We.jsx)(TW,{}),label:"Private",variant:"outlined"})]})]}),(0,We.jsx)(gW,{children:(0,We.jsx)(RR,{size:"small",component:Ie,to:`/side-room/${e.id}`,variant:"contained",fullWidth:!0,children:"Enter Room"})})]},e.id)))})]}),ot.length>0&&(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h6",sx:{mb:2},children:"Joined Rooms"}),(0,We.jsx)(Je,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:ot.map((e=>(0,We.jsxs)(ZB,{sx:{display:"flex",flexDirection:"column",height:"100%","&:hover":{boxShadow:6,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.thumbnailUrl&&(0,We.jsx)(sW,{component:"img",height:"140",image:e.thumbnailUrl,alt:e.name,sx:{objectFit:"cover"}}),(0,We.jsxs)(dW,{sx:{flexGrow:1},children:[(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,We.jsx)(mA,{variant:"h6",component:"div",children:e.name}),(0,We.jsx)(rV,{size:"small",label:"Member"})]}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,We.jsx)(rV,{size:"small",label:`${e.memberCount||0} members`,icon:(0,We.jsx)(RW,{})}),e.category&&(0,We.jsx)(rV,{size:"small",label:e.category,variant:"outlined"}),e.isPrivate&&(0,We.jsx)(rV,{size:"small",icon:(0,We.jsx)(TW,{}),label:"Private",variant:"outlined"})]})]}),(0,We.jsx)(gW,{children:(0,We.jsx)(RR,{size:"small",component:Ie,to:`/side-room/${e.id}`,variant:"contained",fullWidth:!0,children:"Enter Room"})})]},e.id)))})]})]}):(0,We.jsxs)(Je,{sx:{textAlign:"center",py:4},children:[(0,We.jsx)(TW,{sx:{fontSize:40,color:"text.secondary",mb:2}}),(0,We.jsx)(mA,{variant:"h6",color:"text.secondary",children:"This account's side rooms are private"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Follow this account to see their side rooms"})]})}),(0,We.jsx)(IW,{value:b,index:3,children:Le?0===x.length?(0,We.jsx)(mA,{children:"No liked posts yet"}):(0,We.jsx)(DR,{children:x.map((e=>{var t,r;return(0,We.jsxs)(sO,{divider:!0,sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>{Se(e),be(!0)},children:[(0,We.jsx)(dO,{children:(0,We.jsx)(Ie,{to:`/profile/${e.authorName}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:e.authorAvatar||void 0})})}),(0,We.jsx)(Px,{primary:(0,We.jsxs)(Je,{children:[(0,We.jsx)(Ie,{to:`/profile/${e.authorName}`,style:{textDecoration:"none"},children:(0,We.jsx)(mA,{variant:"subtitle1",component:"span",sx:{color:"text.primary","&:hover":{textDecoration:"underline"}},children:e.authorName})}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",component:"span",sx:{ml:1},children:_D(e.timestamp)})]}),secondary:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"body1",sx:{mt:1},children:e.content}),e.isEdited&&(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:"(edited)"})]})}),(0,We.jsx)(eO,{children:(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsxs)(rR,{edge:"end","aria-label":"likes",onClick:t=>{t.stopPropagation(),Tt(e.id)},children:[(0,We.jsx)(bW,{color:null!==(t=e.likedBy)&&void 0!==t&&t.includes((null===n||void 0===n?void 0:n.uid)||"")?"error":"inherit"}),(0,We.jsx)(mA,{variant:"body2",sx:{ml:1},children:e.likes||0})]}),(0,We.jsxs)(rR,{edge:"end","aria-label":"repost",onClick:t=>{t.stopPropagation(),Ct(e.id)},children:[(0,We.jsx)(wW,{color:null!==(r=e.repostedBy)&&void 0!==r&&r.includes((null===n||void 0===n?void 0:n.uid)||"")?"primary":"inherit"}),(0,We.jsx)(mA,{variant:"body2",sx:{ml:1},children:e.reposts||0})]})]})})]},e.id)}))}):(0,We.jsxs)(Je,{sx:{textAlign:"center",py:4},children:[(0,We.jsx)(TW,{sx:{fontSize:40,color:"text.secondary",mb:2}}),(0,We.jsx)(mA,{variant:"h6",color:"text.secondary",children:"This account's liked posts are private"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Follow this account to see their liked posts"})]})}),(null===n||void 0===n?void 0:n.uid)===vt&&(0,We.jsx)(IW,{value:b,index:4,children:0===J.length?(0,We.jsx)(mA,{children:"No deleted items"}):(0,We.jsx)(DR,{children:J.map((e=>(0,We.jsxs)(sO,{divider:!0,children:[(0,We.jsx)(Px,{primary:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle1",children:"post"===e.type?"Post":"room"===e.type?"Side Room":"Forum"}),(0,We.jsx)(mA,{variant:"body1",children:"post"===e.type?e.content.content:e.content.name})]}),secondary:`Deleted ${_D(e.deletedAt)} ago`}),(0,We.jsxs)(eO,{children:[(0,We.jsx)(RR,{variant:"outlined",onClick:()=>(async(e,t)=>{if(a)try{const n=eg(a,"deleted_items",e),r=await uv(n);if(!r.exists())return void D("Item not found in trash");const i=r.data(),o="post"===t?"posts":"room"===t?"sideRooms":"forums";await pv(eg(a,o,e),{...i.content,deletedAt:null,scheduledForPermanentDeletion:null}),await mv(n),ee((t=>t.filter((t=>t.id!==e)))),D("Item restored successfully")}catch(P){console.error("Error restoring item:",P),D("Failed to restore item")}else D("Database not initialized")})(e.id,e.type),children:"Restore"}),(0,We.jsx)(RR,{variant:"outlined",color:"error",onClick:()=>(async e=>{if(a)try{await mv(eg(a,"deleted_items",e)),ee((t=>t.filter((t=>t.id!==e)))),D("Item permanently deleted")}catch(P){console.error("Error permanently deleting item:",P),D("Failed to delete item permanently")}else D("Database not initialized")})(e.id),sx:{ml:1},children:"Delete Permanently"})]})]},e.id)))})})]})]}),(0,We.jsxs)(wO,{open:_,onClose:()=>E(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Edit Profile"}),(0,We.jsx)(SB,{children:(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[(0,We.jsx)(CN,{label:"Name",value:ue,onChange:e=>de(e.target.value),fullWidth:!0,variant:"outlined"}),(0,We.jsx)(CN,{label:"Username",value:fe,onChange:e=>me(e.target.value),fullWidth:!0,variant:"outlined",helperText:"This will be your unique identifier on the platform"}),(0,We.jsx)(CN,{label:"Bio",value:he,onChange:e=>pe(e.target.value),multiline:!0,rows:4,fullWidth:!0,variant:"outlined",helperText:"Tell others about yourself (You can use emojis!)",InputProps:{endAdornment:(0,We.jsx)(rR,{onClick:()=>{const e=window.prompt("Enter an emoji:");e&&pe((t=>t+e))},sx:{color:"primary.main","&:hover":{color:"primary.dark"}},children:(0,We.jsx)("span",{role:"img","aria-label":"emoji",children:"\ud83d\ude0a"})})}})]})}),(0,We.jsxs)(qU,{sx:{p:3},children:[(0,We.jsx)(RR,{variant:"outlined",onClick:()=>E(!1),sx:{minWidth:"120px",borderColor:"text.secondary",color:"text.secondary","&:hover":{borderColor:"text.primary",color:"text.primary"}},children:"Cancel"}),(0,We.jsx)(RR,{variant:"contained",onClick:async()=>{if(n&&a)try{const e=ue.trim(),t=he.trim(),r=fe.trim();await fv(eg(a,"users",n.uid),{name:e,bio:t,username:r}),f(e),y(t),h(r),E(!1),i&&s({...i,name:e,bio:t,username:r})}catch(P){console.error("Error saving profile:",P),D("Failed to save profile")}},disabled:k,sx:{minWidth:"120px",bgcolor:"primary.main","&:hover":{bgcolor:"primary.dark"}},children:k?"Saving...":"Save Changes"})]})]}),(0,We.jsxs)(wO,{open:z,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:(null===n||void 0===n?void 0:n.uid)===vt?"Your Messages":`Message ${d}`}),(0,We.jsx)(SB,{children:(null===n||void 0===n?void 0:n.uid)===vt?(0,We.jsx)(DR,{children:G.map((e=>(0,We.jsxs)(sO,{divider:!0,children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.senderAvatar||void 0})}),(0,We.jsx)(Px,{primary:e.senderName,secondary:e.content}),(0,We.jsx)(eO,{children:(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:_D(e.timestamp)})})]},e.id)))}):(0,We.jsxs)(Je,{sx:{mt:2},children:[(0,We.jsx)(CN,{fullWidth:!0,multiline:!0,rows:4,label:"Your message",value:K,onChange:e=>$(e.target.value),variant:"outlined",sx:{mb:2}}),(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,We.jsx)(RR,{variant:"contained",onClick:wt,disabled:!K.trim()||ce,sx:{minWidth:"100px","@media (max-width: 600px)":{width:"100%"}},children:ce?"Sending...":"Send"})})]})}),(0,We.jsx)(qU,{children:(0,We.jsx)(RR,{onClick:()=>H(!1),children:"Close"})})]}),(0,We.jsxs)(wO,{open:Ee,onClose:()=>be(!1),maxWidth:"md",fullWidth:!0,children:[(0,We.jsx)(UB,{children:(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,We.jsx)(cA,{src:(null===we||void 0===we?void 0:we.authorAvatar)||void 0}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle1",children:null===we||void 0===we?void 0:we.authorName}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:_D(null===we||void 0===we?void 0:we.timestamp)})]})]})}),(0,We.jsxs)(SB,{children:[(0,We.jsx)(mA,{variant:"body1",sx:{mt:2},children:null===we||void 0===we?void 0:we.content}),(null===we||void 0===we?void 0:we.isEdited)&&(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:"(edited)"})]}),(0,We.jsxs)(qU,{children:[(0,We.jsxs)(rR,{children:[(0,We.jsx)(bW,{color:null!==we&&void 0!==we&&null!==(e=we.likedBy)&&void 0!==e&&e.includes((null===n||void 0===n?void 0:n.uid)||"")?"error":"inherit"}),(0,We.jsx)(mA,{variant:"body2",sx:{ml:1},children:(null===we||void 0===we?void 0:we.likes)||0})]}),(0,We.jsx)(RR,{onClick:()=>be(!1),children:"Close"})]})]}),(0,We.jsxs)(px,{anchorEl:Te,open:Boolean(Te),onClose:Rt,children:[(0,We.jsx)(Cx,{onClick:()=>{var e;Rt(),null===(e=re.current)||void 0===e||e.click()},children:"Change Profile Picture"}),(0,We.jsx)(Cx,{onClick:()=>{Rt(),Re(!0)},children:"Add to Story"})]}),(0,We.jsx)(At,{}),(null===n||void 0===n?void 0:n.uid)!==l||0===Ze.length?null:(0,We.jsxs)(RR,{variant:"outlined",color:"primary",onClick:()=>Qe(!0),sx:{ml:2},children:["View Requests (",Ze.length,")"]}),(0,We.jsxs)(wO,{open:dt,onClose:()=>ht(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Follow Requests"}),(0,We.jsx)(SB,{children:(0,We.jsx)(DR,{children:0===lt.length?(0,We.jsx)(sO,{children:(0,We.jsx)(Px,{primary:"No pending follow requests"})}):lt.map((e=>(0,We.jsxs)(sO,{children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.profilePic,alt:e.name,children:e.name[0]})}),(0,We.jsx)(Px,{primary:e.name,secondary:`@${e.username}`}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(RR,{variant:"contained",color:"primary",onClick:()=>(async e=>{if(n&&a)try{ft(!0);const t=eg(a,`users/${n.uid}/followers/${e}`),r=eg(a,`users/${e}/following/${n.uid}`),i=eg(a,`users/${n.uid}/followRequests/${e}`);await Promise.all([pv(t,{timestamp:Av()}),pv(r,{timestamp:Av()}),mv(i)]);const o=eg(Zm(a,"users",e,"notifications"));await pv(o,{type:"follow_accepted",userId:n.uid,username:n.displayName||"Anonymous",timestamp:Av(),read:!1}),bT.success("Follow request accepted")}catch(P){console.error("Error accepting follow request:",P),bT.error("Failed to accept follow request")}finally{ft(!1)}})(e.id),disabled:pt,children:"Accept"}),(0,We.jsx)(RR,{variant:"outlined",color:"error",onClick:()=>(async e=>{if(n&&a)try{ft(!0);const t=eg(a,`users/${n.uid}/followRequests/${e}`);await mv(t);const r=eg(Zm(a,"users",e,"notifications"));await pv(r,{type:"follow_rejected",userId:n.uid,username:n.displayName||"Anonymous",timestamp:Av(),read:!1}),bT.success("Follow request rejected")}catch(P){console.error("Error rejecting follow request:",P),bT.error("Failed to reject follow request")}finally{ft(!1)}})(e.id),disabled:pt,children:"Reject"})]})]},e.id)))})})]})]})};function kW(e){return(0,AC.Ay)("PrivateSwitchBase",e)}(0,Ke.A)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const NW=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],PW=(0,wC.Ay)(JA)((e=>{let{ownerState:t}=e;return(0,ke.A)({padding:9,borderRadius:"50%"},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})})),DW=(0,wC.Ay)("input",{shouldForwardProp:gR.A})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),LW=t.forwardRef((function(e,t){const{autoFocus:n,checked:r,checkedIcon:i,className:o,defaultChecked:s,disabled:a,disableFocusRipple:c=!1,edge:l=!1,icon:u,id:d,inputProps:h,inputRef:p,name:f,onBlur:m,onChange:g,onFocus:v,readOnly:y,required:_=!1,tabIndex:E,type:b,value:w}=e,S=(0,Ne.A)(e,NW),[T,C]=(0,Zk.A)({controlled:r,default:Boolean(s),name:"SwitchBase",state:"checked"}),A=DO();let R=a;A&&"undefined"===typeof R&&(R=A.disabled);const I="checkbox"===b||"radio"===b,x=(0,ke.A)({},e,{checked:T,disabled:R,disableFocusRipple:c,edge:l}),O=(e=>{const{classes:t,checked:n,disabled:r,edge:i}=e,o={root:["root",n&&"checked",r&&"disabled",i&&`edge${(0,SC.A)(i)}`],input:["input"]};return(0,bC.A)(o,kW,t)})(x);return(0,We.jsxs)(PW,(0,ke.A)({component:"span",className:(0,Pe.A)(O.root,o),centerRipple:!0,focusRipple:!c,disabled:R,tabIndex:null,role:void 0,onFocus:e=>{v&&v(e),A&&A.onFocus&&A.onFocus(e)},onBlur:e=>{m&&m(e),A&&A.onBlur&&A.onBlur(e)},ownerState:x,ref:t},S,{children:[(0,We.jsx)(DW,(0,ke.A)({autoFocus:n,checked:r,defaultChecked:s,className:O.input,disabled:R,id:I?d:void 0,name:f,onChange:e=>{if(e.nativeEvent.defaultPrevented)return;const t=e.target.checked;C(t),g&&g(e,t)},readOnly:y,ref:p,required:_,ownerState:x,tabIndex:E,type:b},"checkbox"===b&&void 0===w?{}:{value:w},h)),T?i:u]}))})),MW=LW;function jW(e){return(0,AC.Ay)("MuiSwitch",e)}const UW=(0,Ke.A)("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),VW=["className","color","edge","size","sx"],FW=(0,wC.Ay)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.edge&&t[`edge${(0,SC.A)(n.edge)}`],t[`size${(0,SC.A)(n.size)}`]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${UW.thumb}`]:{width:16,height:16},[`& .${UW.switchBase}`]:{padding:4,[`&.${UW.checked}`]:{transform:"translateX(16px)"}}}}]}),BW=(0,wC.Ay)(MW,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.switchBase,{[`& .${UW.input}`]:t.input},"default"!==n.color&&t[`color${(0,SC.A)(n.color)}`]]}})((e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${"light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${UW.checked}`]:{transform:"translateX(20px)"},[`&.${UW.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${"light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${UW.checked} + .${UW.track}`]:{opacity:.5},[`&.${UW.disabled} + .${UW.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:""+("light"===t.palette.mode?.12:.2)},[`& .${UW.input}`]:{left:"-100%",width:"300%"}}}),(e=>{let{theme:t}=e;return{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.light})).map((e=>{let[n]=e;return{props:{color:n},style:{[`&.${UW.checked}`]:{color:(t.vars||t).palette[n].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)(t.palette[n].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${UW.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n}DisabledColor`]:`${"light"===t.palette.mode?(0,TC.a)(t.palette[n].main,.62):(0,TC.e$)(t.palette[n].main,.55)}`}},[`&.${UW.checked} + .${UW.track}`]:{backgroundColor:(t.vars||t).palette[n].main}}}}))]}})),WW=(0,wC.Ay)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})((e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${"light"===t.palette.mode?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:""+("light"===t.palette.mode?.38:.3)}})),zW=(0,wC.Ay)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})((e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}})),HW=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiSwitch"}),{className:r,color:i="primary",edge:o=!1,size:s="medium",sx:a}=n,c=(0,Ne.A)(n,VW),l=(0,ke.A)({},n,{color:i,edge:o,size:s}),u=(e=>{const{classes:t,edge:n,size:r,color:i,checked:o,disabled:s}=e,a={root:["root",n&&`edge${(0,SC.A)(n)}`,`size${(0,SC.A)(r)}`],switchBase:["switchBase",`color${(0,SC.A)(i)}`,o&&"checked",s&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},c=(0,bC.A)(a,jW,t);return(0,ke.A)({},t,c)})(l),d=(0,We.jsx)(zW,{className:u.thumb,ownerState:l});return(0,We.jsxs)(FW,{className:(0,Pe.A)(u.root,r),sx:a,ownerState:l,children:[(0,We.jsx)(BW,(0,ke.A)({type:"checkbox",icon:d,checkedIcon:d,ref:t,ownerState:l},c,{classes:(0,ke.A)({},u,{root:u.switchBase})})),(0,We.jsx)(WW,{className:u.track,ownerState:l})]})})),GW=HW,qW=(0,zC.A)((0,We.jsx)("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1m-1 9h-4v-7h4z"}),"Devices"),KW=(0,zC.A)((0,We.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security"),$W=(0,zC.A)([(0,We.jsx)("circle",{cx:"10",cy:"8",r:"4"},"0"),(0,We.jsx)("path",{d:"M10.67 13.02c-.22-.01-.44-.02-.67-.02-2.42 0-4.68.67-6.61 1.82-.88.52-1.39 1.5-1.39 2.53V20h9.26c-.79-1.13-1.26-2.51-1.26-4 0-1.07.25-2.07.67-2.98M20.75 16c0-.22-.03-.42-.06-.63l1.14-1.01-1-1.73-1.45.49c-.32-.27-.68-.48-1.08-.63L18 11h-2l-.3 1.49c-.4.15-.76.36-1.08.63l-1.45-.49-1 1.73 1.14 1.01c-.03.21-.06.41-.06.63s.03.42.06.63l-1.14 1.01 1 1.73 1.45-.49c.32.27.68.48 1.08.63L16 21h2l.3-1.49c.4-.15.76-.36 1.08-.63l1.45.49 1-1.73-1.14-1.01c.03-.21.06-.41.06-.63M17 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"},"1")],"ManageAccounts"),YW=(0,zC.A)((0,We.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5z"}),"Shield"),XW=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),JW=(0,zC.A)([(0,We.jsx)("path",{d:"m21 5-9-4-9 4v6c0 5.55 3.84 10.74 9 12 2.3-.56 4.33-1.9 5.88-3.71l-3.12-3.12c-1.94 1.29-4.58 1.07-6.29-.64-1.95-1.95-1.95-5.12 0-7.07 1.95-1.95 5.12-1.95 7.07 0 1.71 1.71 1.92 4.35.64 6.29l2.9 2.9C20.29 15.69 21 13.38 21 11z"},"0"),(0,We.jsx)("circle",{cx:"12",cy:"12",r:"3"},"1")],"Policy"),QW=(0,zC.A)((0,We.jsx)("path",{d:"M21.95 10.99c-1.79-.03-3.7-1.95-2.68-4.22-2.98 1-5.77-1.59-5.19-4.56C6.95.71 2 6.58 2 12c0 5.52 4.48 10 10 10 5.89 0 10.54-5.08 9.95-11.01M8.5 15c-.83 0-1.5-.67-1.5-1.5S7.67 12 8.5 12s1.5.67 1.5 1.5S9.33 15 8.5 15m2-5C9.67 10 9 9.33 9 8.5S9.67 7 10.5 7s1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5 6c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"Cookie"),ZW=(0,zC.A)((0,We.jsx)("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1"}),"DarkMode"),ez=(0,zC.A)((0,We.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen"),tz=(0,zC.A)((0,We.jsx)("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"}),"Code"),nz=(0,zC.A)((0,We.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),rz=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(""),[o,s]=(0,t.useState)("");(0,t.useEffect)((()=>{(async()=>{const e=await navigator.mediaDevices.enumerateDevices();n(e)})()}),[]);return(0,We.jsxs)("div",{children:[(0,We.jsx)("h3",{children:"Select Audio and Video Devices"}),(0,We.jsxs)("div",{children:[(0,We.jsx)("label",{children:"Audio Input:"}),(0,We.jsx)("select",{onChange:e=>{i(e.target.value)},value:r,children:e.filter((e=>"audioinput"===e.kind)).map((e=>(0,We.jsx)("option",{value:e.deviceId,children:e.label||`Microphone ${e.deviceId}`},e.deviceId)))})]}),(0,We.jsxs)("div",{children:[(0,We.jsx)("label",{children:"Video Input:"}),(0,We.jsx)("select",{onChange:e=>{s(e.target.value)},value:o,children:e.filter((e=>"videoinput"===e.kind)).map((e=>(0,We.jsx)("option",{value:e.deviceId,children:e.label||`Camera ${e.deviceId}`},e.deviceId)))})]}),(0,We.jsx)("button",{onClick:async()=>{const e={audio:{deviceId:r?{exact:r}:void 0},video:{deviceId:o?{exact:o}:void 0}};try{await navigator.mediaDevices.getUserMedia(e)}catch(k_){console.error("Error accessing media devices.",k_)}},children:"Start Stream"})]})},iz=()=>{IL(iI().breakpoints.down("sm"));const{isDarkMode:e,toggleDarkMode:n}=(()=>{const e=(0,t.useContext)(_C);if(void 0===e)throw new Error("useThemeContext must be used within a ThemeContextProvider");return e})(),{currentUser:r,userProfile:i}=ZT(),{canViewProfile:o,canViewContent:s}=tC(),[a,c]=(0,t.useState)([]),[l,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)(null),[p,f]=(0,t.useState)(null),[m,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)([]),[_,E]=(0,t.useState)({followers:0,following:0,pendingRequests:0}),[b,w]=(0,t.useState)(!1),[S,T]=(0,t.useState)(!1),[C,A]=(0,t.useState)(""),[R,I]=(0,t.useState)(""),[x,O]=(0,t.useState)(""),[k,N]=(0,t.useState)(!1),[P,D]=(0,t.useState)(""),L=[{title:"Device Management",icon:(0,We.jsx)(qW,{}),path:"#",description:"Manage your connected devices and appearance settings",onClick:()=>u(!0)},{title:"Security & Authentication",icon:(0,We.jsx)(KW,{}),path:"/security",description:"Learn about our authentication flow and security features"},{title:"Account Management",icon:(0,We.jsx)($W,{}),path:"/account-management",description:"Deactivate or delete your account"},{title:"Safety & Community Guidelines",icon:(0,We.jsx)(YW,{}),path:"/safety",description:"Review our safety policies and community guidelines"},{title:"About",icon:(0,We.jsx)(XW,{}),path:"/about",description:"Learn more about SideEye and our mission"},{title:"Privacy Policy",icon:(0,We.jsx)(JW,{}),path:"/privacy-policy",description:"Read our privacy policy and data handling practices"},{title:"Terms of Service",icon:(0,We.jsx)(JW,{}),path:"/terms",description:"Review our terms of service and community guidelines"},{title:"Cookie Policy",icon:(0,We.jsx)(QW,{}),path:"/cookies",description:"Learn about how we use cookies and similar technologies"}];(0,t.useEffect)((()=>{if(r){const e=vv(eg(KS,"users",r.uid),(e=>{if(e.exists()){var t,n;const r=e.data();g(r.isPrivate||!1),E({followers:(null===(t=r.followers)||void 0===t?void 0:t.length)||0,following:(null===(n=r.following)||void 0===n?void 0:n.length)||0,pendingRequests:v.length})}})),t=async()=>{const e=Gg(Zm(KS,`users/${r.uid}/followRequests`),Xg("timestamp","desc")),t=(await hv(e)).docs.map((e=>{const t=e.data();return{id:e.id,userId:t.userId,username:t.username,timestamp:t.timestamp}}));y(t)};return t(),()=>e()}}),[r,v.length]);const M=async(e,t,n)=>{if(r)try{await mv(eg(KS,`users/${r.uid}/followRequests`,e)),n?(await pv(eg(KS,`users/${r.uid}/followers`,t),{timestamp:Av()}),await pv(eg(KS,`users/${t}/following`,r.uid),{timestamp:Av()}),bT.success("Follow request accepted")):bT.success("Follow request declined"),y((t=>t.filter((t=>t.id!==e))))}catch(p){console.error("Error handling follow request:",p),bT.error("Failed to process follow request")}};return(0,We.jsx)(sP,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(Je,{sx:{py:4},children:[(0,We.jsx)(mA,{variant:"h4",sx:{mb:3,fontWeight:"bold"},children:"Settings"}),p&&(0,We.jsx)($D,{severity:"error",sx:{mb:2},children:p}),(0,We.jsx)(kC,{elevation:0,sx:{borderRadius:2},children:(0,We.jsx)(DR,{children:L.map(((e,n)=>(0,We.jsxs)(t.Fragment,{children:[(0,We.jsxs)(sO,{component:e.path?Ie:"div",to:e.path,onClick:e.onClick,sx:{"&:hover":{backgroundColor:"action.hover"},textDecoration:"none",color:"inherit",cursor:"pointer"},children:[(0,We.jsx)(xx,{children:e.icon}),(0,We.jsx)(Px,{primary:e.title,secondary:e.description})]}),n<L.length-1&&(0,We.jsx)(Ux,{})]},e.title)))})}),(0,We.jsxs)(wO,{open:l,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Device Management"}),(0,We.jsx)(SB,{children:(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(ZW,{})}),(0,We.jsx)(Px,{primary:"Dark Mode",secondary:"Toggle between light and dark mode"}),(0,We.jsx)(eO,{children:(0,We.jsx)(GW,{checked:e,onChange:n,color:"primary"})})]}),(0,We.jsx)(Ux,{}),(0,We.jsx)(mA,{variant:"subtitle1",sx:{px:2,py:1,fontWeight:"bold"},children:"Connected Devices"}),a.map((e=>(0,We.jsxs)(sO,{children:[(0,We.jsx)(Px,{primary:e.name,secondary:`Last active: ${e.lastActive}`}),(0,We.jsx)(rR,{edge:"end",onClick:()=>{h(e.id),(async e=>{if(r)try{const t=eg(KS,"users",r.uid);await fv(t,{devices:Iv(e)}),c(a.filter((t=>t.id!==e))),u(!1),h(null)}catch(t){f("Failed to remove device"),console.error("Error removing device:",t)}})(e.id)},children:(0,We.jsx)(AW,{})})]},e.id))),0===a.length&&(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{px:2,py:2},children:"No devices connected"}),(0,We.jsx)(rz,{})]})}),(0,We.jsx)(qU,{children:(0,We.jsx)(RR,{onClick:()=>u(!1),children:"Close"})})]}),(0,We.jsxs)(Je,{sx:{mb:4,mt:4},children:[(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,children:"Privacy Settings"}),(0,We.jsxs)(kC,{elevation:2,sx:{p:3},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:2},children:[m?(0,We.jsx)(TW,{color:"primary"}):(0,We.jsx)(ez,{color:"primary"}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle1",children:"Private Account"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:m?"Only approved followers can see your content":"Anyone can see your content"})]})]}),(0,We.jsx)(GW,{checked:m,onChange:async()=>{if(null!==r&&void 0!==r&&r.uid)try{if(await fv(eg(KS,"users",r.uid),{isPrivate:!m,updatedAt:Av()}),!m)for(const e of v)await M(e.id,e.userId,!0)}catch(p){console.error("Error updating privacy settings:",p),bT.error("Failed to update privacy settings")}},color:"primary"})]}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:3,mt:2,p:2,bgcolor:"background.default",borderRadius:1},children:[(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle2",color:"text.secondary",children:"Followers"}),(0,We.jsx)(mA,{variant:"h6",children:_.followers})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle2",color:"text.secondary",children:"Following"}),(0,We.jsx)(mA,{variant:"h6",children:_.following})]}),m&&(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle2",color:"text.secondary",children:"Pending Requests"}),(0,We.jsx)(mA,{variant:"h6",children:_.pendingRequests})]})]}),(0,We.jsx)($D,{severity:"info",sx:{mt:2},children:m?"When your account is private, only approved followers can see your content. New followers must send a follow request.":"When your account is public, anyone can see your content and follow you without approval."}),(0,We.jsx)(Ux,{}),(0,We.jsxs)(sO,{button:!0,onClick:async()=>{if(r)try{const e=eg(KS,"users",r.uid),t=await uv(e);if(t.exists()){t.data().verificationCode?w(!0):T(!0)}}catch(p){console.error("Error checking verification code:",p),bT.error("Failed to check verification status")}},children:[(0,We.jsx)(xx,{children:(0,We.jsx)(tz,{})}),(0,We.jsx)(Px,{primary:"View Registration Source Code",secondary:"Verify your code to view your registration source code"})]})]})]}),(0,We.jsxs)(wO,{open:S,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Create Verification Code"}),(0,We.jsx)(SB,{children:(0,We.jsx)(CN,{label:"Create a verification code",value:R,onChange:e=>I(e.target.value),fullWidth:!0,margin:"normal",type:"password",inputProps:{maxLength:8,inputMode:"numeric",pattern:"[0-9]*"}})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>T(!1),children:"Cancel"}),(0,We.jsx)(RR,{onClick:async()=>{if(r&&R)try{const e=eg(KS,"users",r.uid);await fv(e,{verificationCode:R}),T(!1),w(!0),bT.success("Verification code created successfully")}catch(p){console.error("Error creating verification code:",p),bT.error("Failed to create verification code")}},variant:"contained",children:"Create"})]})]}),(0,We.jsxs)(wO,{open:b,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Verify Code"}),(0,We.jsx)(SB,{children:(0,We.jsx)(CN,{label:"Enter your verification code",value:C,onChange:e=>A(e.target.value),fullWidth:!0,margin:"normal",type:"password",inputProps:{maxLength:8,inputMode:"numeric",pattern:"[0-9]*"}})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>w(!1),children:"Cancel"}),(0,We.jsx)(RR,{onClick:async()=>{if(r)try{const e=eg(KS,"users",r.uid),t=await uv(e);if(t.exists()){const e=t.data();e.verificationCode===C?(D(e.sourceCodeHash?C:""),N(!0),w(!1),bT.success("Code verified successfully")):bT.error("Invalid verification code")}}catch(p){console.error("Error verifying code:",p),bT.error("Failed to verify code")}},variant:"contained",children:"Verify"})]})]}),(0,We.jsxs)(wO,{open:k,onClose:()=>N(!1),maxWidth:"md",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Your Registration Source Code"}),(0,We.jsxs)(SB,{children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:1,mb:3,color:"info.main"},children:[(0,We.jsx)(XW,{color:"info"}),(0,We.jsx)(mA,{sx:{color:"info.main",fontSize:"1rem"},children:"When your account is used on another device, you will need this Source Code to register your account."})]}),(0,We.jsx)(Je,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,fontFamily:"monospace",whiteSpace:"pre-wrap",overflow:"auto",maxHeight:"60vh",fontSize:"24px",textAlign:"center"},children:P})]}),(0,We.jsx)(qU,{children:(0,We.jsx)(RR,{onClick:()=>N(!1),children:"Close"})})]}),m&&v.length>0&&(0,We.jsxs)(Je,{sx:{mt:3},children:[(0,We.jsx)(mA,{variant:"subtitle1",gutterBottom:!0,children:"Follow Requests"}),(0,We.jsx)(DR,{children:v.map((e=>{var t;return(0,We.jsxs)(sO,{sx:{bgcolor:"background.paper",borderRadius:1,mb:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,We.jsx)(cA,{children:e.username[0]}),(0,We.jsxs)(Je,{children:[(0,We.jsxs)(mA,{variant:"subtitle1",children:["@",e.username]}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:new Date(null===(t=e.timestamp)||void 0===t?void 0:t.toDate()).toLocaleDateString()})]})]}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(rR,{color:"success",onClick:()=>M(e.id,e.userId,!0),children:(0,We.jsx)(nz,{})}),(0,We.jsx)(rR,{color:"error",onClick:()=>M(e.id,e.userId,!1),children:(0,We.jsx)(EW,{})})]})]},e.id)}))})]})]})})},oz=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],sz=(0,wC.Ay)(JA,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiListItemButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,"flex-start"===n.alignItems&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Yx.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${Yx.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${Yx.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,TC.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${Yx.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Yx.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},"flex-start"===n.alignItems&&{alignItems:"flex-start"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.dense&&{paddingTop:4,paddingBottom:4})})),az=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiListItemButton"}),{alignItems:i="center",autoFocus:o=!1,component:s="div",children:a,dense:c=!1,disableGutters:l=!1,divider:u=!1,focusVisibleClassName:d,selected:h=!1,className:p}=r,f=(0,Ne.A)(r,oz),m=t.useContext(xR),g=t.useMemo((()=>({dense:c||m.dense||!1,alignItems:i,disableGutters:l})),[i,m.dense,c,l]),v=t.useRef(null);(0,jR.A)((()=>{o&&v.current&&v.current.focus()}),[o]);const y=(0,ke.A)({},r,{alignItems:i,dense:g.dense,disableGutters:l,divider:u,selected:h}),_=(e=>{const{alignItems:t,classes:n,dense:r,disabled:i,disableGutters:o,divider:s,selected:a}=e,c={root:["root",r&&"dense",!o&&"gutters",s&&"divider",i&&"disabled","flex-start"===t&&"alignItemsFlexStart",a&&"selected"]},l=(0,bC.A)(c,$x,n);return(0,ke.A)({},n,l)})(y),E=(0,gA.A)(v,n);return(0,We.jsx)(xR.Provider,{value:g,children:(0,We.jsx)(sz,(0,ke.A)({ref:E,href:f.href||f.to,component:(f.href||f.to)&&"div"===s?"button":s,focusVisibleClassName:(0,Pe.A)(_.focusVisible,d),ownerState:y,className:(0,Pe.A)(_.root,p)},f,{classes:_,children:a}))})})),cz=az,lz=()=>{const e=Q(),{searchQuery:n}=Z(),{db:r,loading:i,error:o}=WP(),[s,a]=(0,t.useState)([]),[c,l]=(0,t.useState)(!0),[u,d]=(0,t.useState)(null),[h,p]=(0,t.useState)(0);IL(iI().breakpoints.down("sm"));(0,t.useEffect)((()=>{(async()=>{if(n&&r)try{l(!0);const e=[],t=Gg(Zm(r,"users"),Kg("username",">=",n.toLowerCase()),Kg("username","<=",n.toLowerCase()+"\uf8ff"),Qg(20));(await hv(t)).forEach((t=>{const n=t.data();e.push({id:t.id,type:"user",data:n})}));const i=Gg(Zm(r,"posts"),Kg("content",">=",n.toLowerCase()),Kg("content","<=",n.toLowerCase()+"\uf8ff"),Xg("content"),Qg(20)),o=await hv(i);for(const n of o.docs){const t=n.data(),i=(await uv(eg(r,"users",t.authorId))).data();e.push({id:n.id,type:"post",data:{...t,author:i}})}const s=Gg(Zm(r,"forums"),Kg("title",">=",n.toLowerCase()),Kg("title","<=",n.toLowerCase()+"\uf8ff"),Qg(20));(await hv(s)).forEach((t=>{const n=t.data();e.push({id:t.id,type:"forum",data:n})}));const c=Gg(Zm(r,"sideRooms"),Kg("name",">=",n.toLowerCase()),Kg("name","<=",n.toLowerCase()+"\uf8ff"),Qg(20));(await hv(c)).forEach((t=>{const n=t.data();e.push({id:t.id,type:"sideRoom",data:n})})),a(e)}catch(e){console.error("Error searching:",e),d("Failed to search. Please try again later.")}finally{l(!1)}})()}),[n,r]);const f=s.filter((e=>{switch(h){case 0:return"user"===e.type;case 1:return"post"===e.type;case 2:return"forum"===e.type;case 3:return"sideRoom"===e.type;default:return!0}}));return i?(0,We.jsx)("div",{children:"Loading..."}):o?(0,We.jsxs)("div",{children:["Error: ",o.message]}):r?(0,We.jsxs)(sP,{maxWidth:"md",sx:{mt:4},children:[(0,We.jsxs)(mA,{variant:"h4",gutterBottom:!0,children:['Search Results for "',n,'"']}),u&&(0,We.jsx)($D,{severity:"error",sx:{mb:2},children:u}),(0,We.jsx)(Je,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,We.jsxs)(DP,{value:h,onChange:(e,t)=>p(t),children:[(0,We.jsx)(FP,{label:"Users"}),(0,We.jsx)(FP,{label:"Posts"}),(0,We.jsx)(FP,{label:"Forums"}),(0,We.jsx)(FP,{label:"Side Rooms"})]})}),c?(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,We.jsx)(FN,{})}):0===f.length?(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",children:"No results found"}):(0,We.jsx)(DR,{children:f.map((t=>(0,We.jsxs)(cz,{onClick:()=>(t=>{switch(t.type){case"user":e(`/profile/${t.id}`);break;case"post":e(`/post/${t.id}`);break;case"forum":e(`/forum/${t.id}`);break;case"sideRoom":e(`/side-room/${t.id}`)}})(t),sx:{mb:1,borderRadius:1},children:[(0,We.jsx)(dO,{children:"user"===t.type?(0,We.jsx)(cA,{src:t.data.avatar}):(0,We.jsx)(cA,{children:"post"===t.type?"P":"forum"===t.type?"F":"S"})}),(0,We.jsx)(Px,{primary:t.data.title||t.data.username||t.data.name,secondary:"post"===t.type?t.data.content.substring(0,100)+"...":t.data.description})]},t.id)))})]}):(0,We.jsx)("div",{children:"Error: Database connection failed"})},uz=(0,zC.A)((0,We.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),dz=(0,zC.A)((0,We.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),hz=(0,zC.A)((0,We.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People"),pz=(0,zC.A)((0,We.jsx)("path",{d:"M20 4H4v2h16zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6zm-9 4H6v-4h6z"}),"Store"),fz=()=>{const[e,n]=(0,t.useState)(0),[r,i]=(0,t.useState)(""),[o,s]=(0,t.useState)([]),[a,c]=(0,t.useState)([]),[l,u]=(0,t.useState)([]),[d,h]=(0,t.useState)(!0),[p,f]=(0,t.useState)(new Set),m=Q(),{currentUser:g}=ZT(),[v,y]=(0,t.useState)(null),_=async()=>{try{const e=Gg(Zm(KS,"users"),Xg("createdAt","desc"),Qg(20)),t=(await hv(e)).docs.map((e=>({id:e.id,...e.data()})));s(t)}catch(v){console.error("Error fetching users:",v)}finally{h(!1)}},E=async()=>{try{h(!0);const e=Zm(KS,"sideRooms"),t=vv(Gg(e,Xg("createdAt","desc"),Qg(20)),(async e=>{const t=await Promise.all(e.docs.map((async e=>{var t,n,r,i,o;const s=e.data();let a=null;if(s.ownerId){const e=eg(KS,"users",s.ownerId),t=await uv(e);t.exists()&&(a=t.data())}return{id:e.id,name:s.name||"Unnamed Room",description:s.description||"",memberCount:s.memberCount||0,shareCount:s.shareCount||0,isPrivate:s.isPrivate||!1,createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate())||new Date,creatorName:(null===(n=a)||void 0===n?void 0:n.username)||s.creatorName||"",creatorId:s.ownerId||"",creatorAvatar:(null===(r=a)||void 0===r?void 0:r.profilePic)||(null===(i=a)||void 0===i?void 0:i.avatar)||"",tags:s.tags||[],lastActive:(null===(o=s.lastActive)||void 0===o?void 0:o.toDate())||new Date,maxMembers:s.maxMembers||50,activeUsers:s.activeUsers||0,isLive:s.isLive||!1}})));c(t),h(!1)}),(e=>{console.error("Error fetching rooms:",e),bT.error("Failed to load rooms"),h(!1)}));return()=>t()}catch(v){console.error("Error fetching rooms:",v),bT.error("Failed to load rooms"),h(!1)}};(0,t.useEffect)((()=>{_(),E(),b(),g&&w()}),[g]);const b=async()=>{try{const e=Gg(Zm(KS,"videos"),Xg("timestamp","desc"),Qg(20)),t=(await hv(e)).docs.map((e=>({id:e.id,...e.data()})));u(t)}catch(v){console.error("Error fetching videos:",v)}},w=async()=>{if(g)try{const e=Gg(Zm(KS,`users/${g.uid}/following`)),t=await hv(e),n=new Set(t.docs.map((e=>e.id)));f(n)}catch(v){console.error("Error fetching following:",v)}};return d?(0,We.jsx)(Je,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:(0,We.jsx)(FN,{})}):(0,We.jsxs)(sP,{maxWidth:"lg",sx:{mt:4},children:[(0,We.jsxs)(Je,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[(0,We.jsx)(uz,{fontSize:"large",color:"primary"}),(0,We.jsx)(mA,{variant:"h4",component:"h1",children:"Discover"})]}),(0,We.jsx)(kC,{sx:{p:2,mb:4},children:(0,We.jsx)(CN,{fullWidth:!0,placeholder:"Search users and rooms...",value:r,onChange:e=>(async e=>{if(i(e),!g||!KS)return s([]),c([]),void u([]);if(e.length<2)return _(),E(),void b();h(!0),y(null);try{const t=e.toLowerCase(),n=Gg(Zm(KS,"users"),Kg("username_lower",">=",t),Kg("username_lower","<=",t+"\uf8ff"),Qg(20)),r=Gg(Zm(KS,"sideRooms"),Kg("name_lower",">=",t),Kg("name_lower","<=",t+"\uf8ff"),Qg(20)),i=Gg(Zm(KS,"videos"),Kg("title_lower",">=",t),Kg("title_lower","<=",t+"\uf8ff"),Qg(20)),[o,a,l]=await Promise.all([hv(n),hv(r),hv(i)]),d=o.docs.map((e=>({id:e.id,...e.data(),username:e.data().username||"",name:e.data().name||"",bio:e.data().bio||"",profilePic:e.data().profilePic||"",avatar:e.data().avatar||"",createdAt:e.data().createdAt}))).filter((e=>e.username.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)||e.bio&&e.bio.toLowerCase().includes(t))),h=await Promise.all(a.docs.map((async e=>{var t,n,r,i,o;const s=e.data(),a={id:e.id,name:s.name||"",description:s.description||"",ownerId:s.ownerId||"",createdAt:s.createdAt,lastActive:s.lastActive,tags:s.tags||[],isPrivate:s.isPrivate||!1,activeUsers:s.activeUsers||0,isLive:s.isLive||!1};let c=null;if(a.ownerId){const e=eg(KS,"users",a.ownerId),t=await uv(e);if(t.exists()){const e=t.data();c={id:t.id,username:e.username||"",name:e.name||"",profilePic:e.profilePic||"",avatar:e.avatar||"",createdAt:e.createdAt}}}return{id:e.id,name:a.name,description:a.description,memberCount:s.memberCount||0,shareCount:s.shareCount||0,isPrivate:a.isPrivate,createdAt:(null===(t=a.createdAt)||void 0===t?void 0:t.toDate())||new Date,creatorName:(null===(n=c)||void 0===n?void 0:n.username)||s.creatorName||"",creatorId:a.ownerId,creatorAvatar:(null===(r=c)||void 0===r?void 0:r.profilePic)||(null===(i=c)||void 0===i?void 0:i.avatar)||"",tags:a.tags,lastActive:(null===(o=a.lastActive)||void 0===o?void 0:o.toDate())||new Date,maxMembers:s.maxMembers||50,activeUsers:a.activeUsers,isLive:a.isLive}}))),p=h.filter((e=>{var n;return e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||(null===(n=e.tags)||void 0===n?void 0:n.some((e=>e.toLowerCase().includes(t))))})).map((e=>({id:e.id,name:e.name,description:e.description,memberCount:e.memberCount||0,shareCount:e.shareCount||0,isPrivate:e.isPrivate,createdAt:e.createdAt,creatorName:e.creatorName,creatorId:e.creatorId,creatorAvatar:e.creatorAvatar,tags:e.tags||[],lastActive:e.lastActive,maxMembers:e.maxMembers||50,activeUsers:e.activeUsers,isLive:e.isLive}))),f=l.docs.map((e=>{const t=e.data();return{id:e.id,title:t.title||"",description:t.description||"",username:t.username||"",userId:t.userId||"",url:t.url||"",thumbnailUrl:t.thumbnailUrl||"",timestamp:t.timestamp}})).filter((e=>e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.username.toLowerCase().includes(t))),m=d.map((e=>({id:e.id,username:e.username,name:e.name,profilePic:e.profilePic||"",bio:e.bio||"",coverPhoto:e.coverPhoto||"",isPublic:!0,isAuthenticated:!0,createdAt:e.createdAt}))),g=f.map((e=>({id:e.id,title:e.title,description:e.description||"",username:e.username,userId:e.userId,url:e.url,thumbnailUrl:e.thumbnailUrl||"",timestamp:e.timestamp,likes:0,comments:0})));s(m),c(p),u(g)}catch(v){console.error("Search error:",v),y(`Failed to perform search: ${v.message}`),bT.error(`Search failed: ${v.code||v.message}`),_(),E(),b()}finally{h(!1)}})(e.target.value),InputProps:{startAdornment:(0,We.jsx)(TL,{position:"start",children:(0,We.jsx)(dz,{})}),endAdornment:d&&(0,We.jsx)(TL,{position:"end",children:(0,We.jsx)(FN,{size:20})})}})}),(0,We.jsx)(Je,{sx:{width:"100%",mb:4},children:(0,We.jsxs)(DP,{value:e,onChange:(e,t)=>{n(t)},variant:"fullWidth",indicatorColor:"primary",textColor:"primary",children:[(0,We.jsx)(FP,{icon:(0,We.jsx)(hz,{}),label:"People"}),(0,We.jsx)(FP,{icon:(0,We.jsx)(RW,{}),label:"Rooms"}),(0,We.jsx)(FP,{icon:(0,We.jsx)(pz,{}),label:"Marketplace"})]})}),0===e&&(0,We.jsx)(Je,{sx:{display:"flex",flexDirection:"column",gap:3},children:(0,We.jsxs)(kC,{children:[(0,We.jsx)(Je,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,We.jsx)(mA,{variant:"h6",component:"h2",children:"Users"})}),(0,We.jsx)(DR,{children:0===o.length?(0,We.jsx)(sO,{children:(0,We.jsx)(Px,{primary:"No users found",secondary:"Try a different search term"})}):o.map(((e,n)=>(0,We.jsxs)(t.Fragment,{children:[(0,We.jsxs)(sO,{secondaryAction:e.id!==(null===g||void 0===g?void 0:g.uid)&&(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(rR,{edge:"end",onClick:()=>m(`/messages/${e.id}`),title:"Send message",children:(0,We.jsx)(vW,{})}),(0,We.jsx)(rR,{edge:"end",onClick:()=>(async e=>{if(g&&e!==g.uid)try{const r=eg(KS,`users/${g.uid}/following`,e),i=eg(KS,`users/${e}/followers`,g.uid);if(p.has(e))await mv(r),await mv(i),f((t=>{const n=new Set(t);return n.delete(e),n})),bT.success("Unfollowed user");else{var t,n;await pv(r,{timestamp:Av()}),await pv(i,{timestamp:Av()}),f((t=>new Set(t).add(e)));const o={type:"follow",senderId:g.uid,senderName:g.displayName||(null===(t=g.email)||void 0===t?void 0:t.split("@")[0])||"Someone",senderAvatar:g.photoURL||"",recipientId:e,content:`${g.displayName||(null===(n=g.email)||void 0===n?void 0:n.split("@")[0])||"Someone"} started following you`,createdAt:Av(),isRead:!1};await gv(Zm(KS,"notifications"),o),bT.success("Followed user")}}catch(v){console.error("Error toggling follow:",v),bT.error("Failed to update follow status")}})(e.id),title:p.has(e.id)?"Unfollow user":"Follow user",color:p.has(e.id)?"primary":"default",children:(0,We.jsx)(_W,{})})]}),children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.profilePic,alt:e.name,children:e.name[0]})}),(0,We.jsx)(Px,{primary:e.name,secondary:(0,We.jsxs)(t.Fragment,{children:["@",e.username,e.bio&&(0,We.jsx)(mA,{component:"span",variant:"body2",color:"text.secondary",sx:{display:"block"},children:e.bio.length>100?`${e.bio.substring(0,100)}...`:e.bio})]}),onClick:()=>{return t=e.id,void m(`/profile/${t}`);var t},sx:{cursor:"pointer"}})]}),n<o.length-1&&(0,We.jsx)(Ux,{})]},e.id)))})]})}),1===e&&(0,We.jsx)(Je,{sx:{display:"flex",flexDirection:"column",gap:3},children:(0,We.jsxs)(kC,{children:[(0,We.jsx)(Je,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,We.jsx)(mA,{variant:"h6",component:"h2",children:"Rooms"})}),(0,We.jsx)(DR,{children:0===a.length?(0,We.jsx)(sO,{children:(0,We.jsx)(Px,{primary:"No rooms found",secondary:"No side rooms have been created yet."})}):a.map(((e,n)=>(0,We.jsxs)(t.Fragment,{children:[(0,We.jsxs)(sO,{secondaryAction:(0,We.jsxs)(Je,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,We.jsx)(rV,{icon:(0,We.jsx)(hz,{}),label:`${e.activeUsers||0} viewing`,size:"small",color:"primary",variant:"outlined"}),e.isLive&&(0,We.jsx)(rV,{label:"Live",color:"error",size:"small"}),e.isPrivate&&(0,We.jsx)(rV,{label:"Private",color:"secondary",size:"small"})]}),children:[(0,We.jsx)(dO,{children:(0,We.jsx)(Ie,{to:`/profile/${e.creatorId}`,style:{textDecoration:"none"},children:(0,We.jsx)(cA,{src:e.creatorAvatar,alt:e.creatorName,children:e.creatorName?e.creatorName.charAt(0).toUpperCase():"?"})})}),(0,We.jsx)(Px,{primary:(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,We.jsx)(mA,{variant:"subtitle1",children:e.name}),e.tags&&e.tags.map(((e,t)=>(0,We.jsx)(rV,{label:e,size:"small",sx:{height:20}},t)))]}),secondary:(0,We.jsxs)(t.Fragment,{children:[(0,We.jsx)(mA,{component:"span",variant:"body2",color:"text.secondary",sx:{display:"block"},children:e.description}),(0,We.jsxs)(mA,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:["Created by"," ",e.creatorName?(0,We.jsx)(Ie,{to:`/profile/${e.creatorId}`,style:{textDecoration:"none",color:"inherit",fontWeight:"bold"},children:e.creatorName}):(0,We.jsx)("span",{style:{fontStyle:"italic"},children:"deleted user"})," \u2022 ","Last active ",_D(e.lastActive)]})]}),onClick:()=>{return t=e.id,void m(`/side-room/${t}`);var t},sx:{cursor:"pointer"}})]}),n<a.length-1&&(0,We.jsx)(Ux,{})]},e.id)))})]})}),2===e&&(0,We.jsx)(Je,{sx:{display:"flex",flexDirection:"column",gap:3},children:(0,We.jsxs)(kC,{children:[(0,We.jsx)(Je,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,We.jsx)(mA,{variant:"h6",component:"h2",children:"Marketplace"})}),(0,We.jsx)(DR,{})]})})]})},mz=()=>{const{user:e}=ZT(),{db:n}=WP(),[r,i]=(0,t.useState)([]),[o,s]=(0,t.useState)(""),[a,c]=(0,t.useState)(null),[l,u]=(0,t.useState)(!0),[d,h]=(0,t.useState)(null);(0,t.useEffect)((()=>{if(n&&e)try{const t=vv(Gg(Zm(n,"messages"),Kg("participants","array-contains",e.uid),Xg("timestamp","desc")),(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));i(t),u(!1)}));return()=>t()}catch(t){h("Failed to fetch messages"),console.error("Error fetching messages:",t),u(!1)}}),[n,e]);return l?(0,We.jsx)(Je,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,We.jsx)(FN,{})}):d?(0,We.jsx)(Je,{p:3,children:(0,We.jsx)(mA,{color:"error",children:d})}):(0,We.jsxs)(Je,{p:3,children:[(0,We.jsx)(mA,{variant:"h4",gutterBottom:!0,children:"Messages"}),(0,We.jsxs)(Je,{mb:3,children:[(0,We.jsx)(CN,{fullWidth:!0,multiline:!0,rows:3,variant:"outlined",placeholder:"Type your message...",value:o,onChange:e=>s(e.target.value),sx:{mb:2}}),(0,We.jsx)(RR,{variant:"contained",color:"primary",onClick:async()=>{if(n&&e&&a&&o.trim())try{await gv(Zm(n,"messages"),{text:o,senderId:e.uid,receiverId:a,timestamp:new Date,read:!1,participants:[e.uid,a]}),s("")}catch(t){h("Failed to send message"),console.error("Error sending message:",t)}},disabled:!o.trim()||!a,children:"Send"})]}),(0,We.jsxs)(DR,{children:[r.map((n=>{var r;return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:n.senderId===(null===e||void 0===e?void 0:e.uid)&&(null===e||void 0===e?void 0:e.photoURL)||void 0})}),(0,We.jsx)(Px,{primary:n.text,secondary:(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(mA,{component:"span",variant:"body2",color:"text.primary",children:n.senderId===(null===e||void 0===e?void 0:e.uid)?"You":"Other User"})," \u2014 ",new Date(null===(r=n.timestamp)||void 0===r?void 0:r.toDate()).toLocaleString()]})})]}),(0,We.jsx)(Ux,{})]},n.id)})),0===r.length&&(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",children:"No messages yet"})]})]})};var gz=n(1014);function vz(e){return(0,AC.Ay)("MuiTooltip",e)}const yz=(0,Ke.A)("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),_z=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];const Ez=(0,wC.Ay)(mU,{name:"MuiTooltip",slot:"Popper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})((e=>{let{theme:t,ownerState:n,open:r}=e;return(0,ke.A)({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!n.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},n.arrow&&{[`&[data-popper-placement*="bottom"] .${yz.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${yz.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${yz.arrow}`]:(0,ke.A)({},n.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${yz.arrow}`]:(0,ke.A)({},n.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})})),bz=(0,wC.Ay)("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${(0,SC.A)(n.placement.split("-")[0])}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:(0,TC.X4)(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},n.arrow&&{position:"relative",margin:0},n.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:(r=16/14,Math.round(1e5*r)/1e5)+"em",fontWeight:t.typography.fontWeightRegular},{[`.${yz.popper}[data-popper-placement*="left"] &`]:(0,ke.A)({transformOrigin:"right center"},n.isRtl?(0,ke.A)({marginLeft:"14px"},n.touch&&{marginLeft:"24px"}):(0,ke.A)({marginRight:"14px"},n.touch&&{marginRight:"24px"})),[`.${yz.popper}[data-popper-placement*="right"] &`]:(0,ke.A)({transformOrigin:"left center"},n.isRtl?(0,ke.A)({marginRight:"14px"},n.touch&&{marginRight:"24px"}):(0,ke.A)({marginLeft:"14px"},n.touch&&{marginLeft:"24px"})),[`.${yz.popper}[data-popper-placement*="top"] &`]:(0,ke.A)({transformOrigin:"center bottom",marginBottom:"14px"},n.touch&&{marginBottom:"24px"}),[`.${yz.popper}[data-popper-placement*="bottom"] &`]:(0,ke.A)({transformOrigin:"center top",marginTop:"14px"},n.touch&&{marginTop:"24px"})});var r})),wz=(0,wC.Ay)("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(e,t)=>t.arrow})((e=>{let{theme:t}=e;return{overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:(0,TC.X4)(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}}));let Sz=!1;const Tz=new OA.E;let Cz={x:0,y:0};function Az(e,t){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];t&&t(n,...i),e(n,...i)}}const Rz=t.forwardRef((function(e,n){var r,i,o,s,a,c,l,u,d,h,p,f,m,g,v,y,_,E,b;const w=(0,Qe.b)({props:e,name:"MuiTooltip"}),{arrow:S=!1,children:T,components:C={},componentsProps:A={},describeChild:R=!1,disableFocusListener:I=!1,disableHoverListener:x=!1,disableInteractive:O=!1,disableTouchListener:k=!1,enterDelay:N=100,enterNextDelay:P=0,enterTouchDelay:D=700,followCursor:L=!1,id:M,leaveDelay:j=0,leaveTouchDelay:U=1500,onClose:V,onOpen:F,open:B,placement:W="bottom",PopperComponent:z,PopperProps:H={},slotProps:G={},slots:q={},title:K,TransitionComponent:$=hI,TransitionProps:Y}=w,X=(0,Ne.A)(w,_z),J=t.isValidElement(T)?T:(0,We.jsx)("span",{children:T}),Q=iI(),Z=dC(),[ee,te]=t.useState(),[ne,re]=t.useState(null),ie=t.useRef(!1),oe=O||L,se=(0,OA.A)(),ae=(0,OA.A)(),ce=(0,OA.A)(),le=(0,OA.A)(),[ue,de]=(0,Zk.A)({controlled:B,default:!1,name:"Tooltip",state:"open"});let he=ue;const pe=(0,gz.A)(M),fe=t.useRef(),me=(0,vA.A)((()=>{void 0!==fe.current&&(document.body.style.WebkitUserSelect=fe.current,fe.current=void 0),le.clear()}));t.useEffect((()=>me),[me]);const ge=e=>{Tz.clear(),Sz=!0,de(!0),F&&!he&&F(e)},ve=(0,vA.A)((e=>{Tz.start(800+j,(()=>{Sz=!1})),de(!1),V&&he&&V(e),se.start(Q.transitions.duration.shortest,(()=>{ie.current=!1}))})),ye=e=>{ie.current&&"touchstart"!==e.type||(ee&&ee.removeAttribute("title"),ae.clear(),ce.clear(),N||Sz&&P?ae.start(Sz?P:N,(()=>{ge(e)})):ge(e))},_e=e=>{ae.clear(),ce.start(j,(()=>{ve(e)}))},{isFocusVisibleRef:Ee,onBlur:be,onFocus:we,ref:Se}=(0,yA.A)(),[,Te]=t.useState(!1),Ce=e=>{be(e),!1===Ee.current&&(Te(!1),_e(e))},Ae=e=>{ee||te(e.currentTarget),we(e),!0===Ee.current&&(Te(!0),ye(e))},Re=e=>{ie.current=!0;const t=J.props;t.onTouchStart&&t.onTouchStart(e)},Ie=e=>{Re(e),ce.clear(),se.clear(),me(),fe.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",le.start(D,(()=>{document.body.style.WebkitUserSelect=fe.current,ye(e)}))},xe=e=>{J.props.onTouchEnd&&J.props.onTouchEnd(e),me(),ce.start(U,(()=>{ve(e)}))};t.useEffect((()=>{if(he)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)};function e(e){"Escape"!==e.key&&"Esc"!==e.key||ve(e)}}),[ve,he]);const Oe=(0,gA.A)(KR(J),Se,te,n);K||0===K||(he=!1);const De=t.useRef(),Le={},Me="string"===typeof K;R?(Le.title=he||!Me||x?null:K,Le["aria-describedby"]=he?pe:null):(Le["aria-label"]=Me?K:null,Le["aria-labelledby"]=he&&!Me?pe:null);const je=(0,ke.A)({},Le,X,J.props,{className:(0,Pe.A)(X.className,J.props.className),onTouchStart:Re,ref:Oe},L?{onMouseMove:e=>{const t=J.props;t.onMouseMove&&t.onMouseMove(e),Cz={x:e.clientX,y:e.clientY},De.current&&De.current.update()}}:{});const Ue={};k||(je.onTouchStart=Ie,je.onTouchEnd=xe),x||(je.onMouseOver=Az(ye,je.onMouseOver),je.onMouseLeave=Az(_e,je.onMouseLeave),oe||(Ue.onMouseOver=ye,Ue.onMouseLeave=_e)),I||(je.onFocus=Az(Ae,je.onFocus),je.onBlur=Az(Ce,je.onBlur),oe||(Ue.onFocus=Ae,Ue.onBlur=Ce));const Ve=t.useMemo((()=>{var e;let t=[{name:"arrow",enabled:Boolean(ne),options:{element:ne,padding:4}}];return null!=(e=H.popperOptions)&&e.modifiers&&(t=t.concat(H.popperOptions.modifiers)),(0,ke.A)({},H.popperOptions,{modifiers:t})}),[ne,H]),Fe=(0,ke.A)({},w,{isRtl:Z,arrow:S,disableInteractive:oe,placement:W,PopperComponentProp:z,touch:ie.current}),Be=(e=>{const{classes:t,disableInteractive:n,arrow:r,touch:i,placement:o}=e,s={popper:["popper",!n&&"popperInteractive",r&&"popperArrow"],tooltip:["tooltip",r&&"tooltipArrow",i&&"touch",`tooltipPlacement${(0,SC.A)(o.split("-")[0])}`],arrow:["arrow"]};return(0,bC.A)(s,vz,t)})(Fe),ze=null!=(r=null!=(i=q.popper)?i:C.Popper)?r:Ez,He=null!=(o=null!=(s=null!=(a=q.transition)?a:C.Transition)?s:$)?o:hI,Ge=null!=(c=null!=(l=q.tooltip)?l:C.Tooltip)?c:bz,qe=null!=(u=null!=(d=q.arrow)?d:C.Arrow)?u:wz,Ke=$C(ze,(0,ke.A)({},H,null!=(h=G.popper)?h:A.popper,{className:(0,Pe.A)(Be.popper,null==H?void 0:H.className,null==(p=null!=(f=G.popper)?f:A.popper)?void 0:p.className)}),Fe),$e=$C(He,(0,ke.A)({},Y,null!=(m=G.transition)?m:A.transition),Fe),Ye=$C(Ge,(0,ke.A)({},null!=(g=G.tooltip)?g:A.tooltip,{className:(0,Pe.A)(Be.tooltip,null==(v=null!=(y=G.tooltip)?y:A.tooltip)?void 0:v.className)}),Fe),Xe=$C(qe,(0,ke.A)({},null!=(_=G.arrow)?_:A.arrow,{className:(0,Pe.A)(Be.arrow,null==(E=null!=(b=G.arrow)?b:A.arrow)?void 0:E.className)}),Fe);return(0,We.jsxs)(t.Fragment,{children:[t.cloneElement(J,je),(0,We.jsx)(ze,(0,ke.A)({as:null!=z?z:mU,placement:W,anchorEl:L?{getBoundingClientRect:()=>({top:Cz.y,left:Cz.x,right:Cz.x,bottom:Cz.y,width:0,height:0})}:ee,popperRef:De,open:!!ee&&he,id:pe,transition:!0},Ue,Ke,{popperOptions:Ve,children:e=>{let{TransitionProps:t}=e;return(0,We.jsx)(He,(0,ke.A)({timeout:Q.transitions.duration.shorter},t,$e,{children:(0,We.jsxs)(Ge,(0,ke.A)({},Ye,{children:[K,S?(0,We.jsx)(qe,(0,ke.A)({},Xe,{ref:re})):null]}))}))}}))]})})),Iz=Rz,xz=(0,zC.A)((0,We.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var Oz=n(7937);const kz=["component","direction","spacing","divider","children","className","useFlexGap"],Nz=(0,je.A)(),Pz=eP("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function Dz(e){return zN({props:e,name:"MuiStack",defaultTheme:Nz})}function Lz(e,n){const r=t.Children.toArray(e).filter(Boolean);return r.reduce(((e,i,o)=>(e.push(i),o<r.length-1&&e.push(t.cloneElement(n,{key:`separator-${o}`})),e)),[])}const Mz=e=>{let{ownerState:t,theme:n}=e,r=(0,ke.A)({display:"flex",flexDirection:"column"},(0,YD.NI)({theme:n},(0,YD.kW)({values:t.direction,breakpoints:n.breakpoints.values}),(e=>({flexDirection:e}))));if(t.spacing){const e=(0,Oz.LX)(n),i=Object.keys(n.breakpoints.values).reduce(((e,n)=>(("object"===typeof t.spacing&&null!=t.spacing[n]||"object"===typeof t.direction&&null!=t.direction[n])&&(e[n]=!0),e)),{}),o=(0,YD.kW)({values:t.direction,base:i}),s=(0,YD.kW)({values:t.spacing,base:i});"object"===typeof o&&Object.keys(o).forEach(((e,t,n)=>{if(!o[e]){const r=t>0?o[n[t-1]]:"column";o[e]=r}}));const a=(n,r)=>{return t.useFlexGap?{gap:(0,Oz._W)(e,n)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${i=r?o[r]:t.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[i]}`]:(0,Oz._W)(e,n)}};var i};r=(0,SO.A)(r,(0,YD.NI)({theme:n},s,a))}return r=(0,YD.iZ)(n.breakpoints,r),r};const jz=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:n=Pz,useThemeProps:r=Dz,componentName:i="MuiStack"}=e,o=n(Mz),s=t.forwardRef((function(e,t){const n=r(e),s=(0,Me.A)(n),{component:a="div",direction:c="column",spacing:l=0,divider:u,children:d,className:h,useFlexGap:p=!1}=s,f=(0,Ne.A)(s,kz),m={direction:c,spacing:l,useFlexGap:p},g=(0,bC.A)({root:["root"]},(e=>(0,AC.Ay)(i,e)),{});return(0,We.jsx)(o,(0,ke.A)({as:a,ownerState:m,ref:t,className:(0,Pe.A)(g.root,h)},f,{children:u?Lz(d,u):d}))}));return s}({createStyledComponent:(0,wC.Ay)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>(0,Qe.b)({props:e,name:"MuiStack"})}),Uz=jz;function Vz(e){return(0,AC.Ay)("MuiFormControlLabel",e)}const Fz=(0,Ke.A)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Bz=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],Wz=(0,wC.Ay)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${Fz.label}`]:t.label},t.root,t[`labelPlacement${(0,SC.A)(n.labelPlacement)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${Fz.disabled}`]:{cursor:"default"}},"start"===n.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===n.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===n.labelPlacement&&{flexDirection:"column",marginLeft:16},{[`& .${Fz.label}`]:{[`&.${Fz.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})})),zz=(0,wC.Ay)("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${Fz.error}`]:{color:(t.vars||t).palette.error.main}}})),Hz=t.forwardRef((function(e,n){var r,i;const o=(0,Qe.b)({props:e,name:"MuiFormControlLabel"}),{className:s,componentsProps:a={},control:c,disabled:l,disableTypography:u,label:d,labelPlacement:h="end",required:p,slotProps:f={}}=o,m=(0,Ne.A)(o,Bz),g=DO(),v=null!=(r=null!=l?l:c.props.disabled)?r:null==g?void 0:g.disabled,y=null!=p?p:c.props.required,_={disabled:v,required:y};["checked","name","onChange","value","inputRef"].forEach((e=>{"undefined"===typeof c.props[e]&&"undefined"!==typeof o[e]&&(_[e]=o[e])}));const E=NO({props:o,muiFormControl:g,states:["error"]}),b=(0,ke.A)({},o,{disabled:v,labelPlacement:h,required:y,error:E.error}),w=(e=>{const{classes:t,disabled:n,labelPlacement:r,error:i,required:o}=e,s={root:["root",n&&"disabled",`labelPlacement${(0,SC.A)(r)}`,i&&"error",o&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",i&&"error"]};return(0,bC.A)(s,Vz,t)})(b),S=null!=(i=f.typography)?i:a.typography;let T=d;return null==T||T.type===mA||u||(T=(0,We.jsx)(mA,(0,ke.A)({component:"span"},S,{className:(0,Pe.A)(w.label,null==S?void 0:S.className),children:T}))),(0,We.jsxs)(Wz,(0,ke.A)({className:(0,Pe.A)(w.root,s),ownerState:b,ref:n},m,{children:[t.cloneElement(c,_),y?(0,We.jsxs)(Uz,{display:"block",children:[T,(0,We.jsxs)(zz,{ownerState:b,"aria-hidden":!0,className:w.asterisk,children:["\u2009","*"]})]}):T]}))})),Gz=Hz,qz=e=>{let{open:n,onClose:r}=e;const{currentUser:i}=ZT(),o=Q(),[s,a]=(0,t.useState)(!1),[c,l]=(0,t.useState)(null),[u,d]=(0,t.useState)({name:"",description:"",isPrivate:!1,password:"",category:"",tags:[]}),[h,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(""),[g,v]=(0,t.useState)([]),[y,_]=(0,t.useState)(""),[E,b]=(0,t.useState)(""),[w,S]=(0,t.useState)([]),[T,C]=(0,t.useState)(""),[A,R]=(0,t.useState)(!1),[I,x]=(0,t.useState)(!1),O=()=>{y.trim()&&!g.includes(y.trim())&&(v([...g,y.trim()]),_(""))},k=()=>{T.trim()&&!w.includes(T.trim())&&(S([...w,T.trim()]),C(""))};return(0,We.jsxs)(wO,{open:n,onClose:r,maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Create Side Room"}),(0,We.jsxs)(SB,{children:[c&&(0,We.jsx)($D,{severity:"error",sx:{mb:2},children:c}),(0,We.jsx)(CN,{autoFocus:!0,margin:"dense",label:"Room Name",type:"text",fullWidth:!0,value:u.name,onChange:e=>d((t=>({...t,name:e.target.value}))),required:!0,error:!u.name.trim(),helperText:u.name.trim()?"":"Room name is required"}),(0,We.jsx)(CN,{margin:"dense",label:"Description",type:"text",fullWidth:!0,multiline:!0,rows:3,value:u.description,onChange:e=>d((t=>({...t,description:e.target.value}))),required:!0,error:!u.description.trim(),helperText:u.description.trim()?"":"Description is required"}),(0,We.jsxs)(Lk,{fullWidth:!0,margin:"dense",required:!0,error:!u.category,children:[(0,We.jsx)(Ok,{children:"Category"}),(0,We.jsxs)(_N,{value:u.category,onChange:e=>d((t=>({...t,category:e.target.value}))),label:"Category",children:[(0,We.jsx)(Cx,{value:"general",children:"General"}),(0,We.jsx)(Cx,{value:"gaming",children:"Gaming"}),(0,We.jsx)(Cx,{value:"music",children:"Music"}),(0,We.jsx)(Cx,{value:"movies",children:"Movies & TV"}),(0,We.jsx)(Cx,{value:"sports",children:"Sports"}),(0,We.jsx)(Cx,{value:"tech",children:"Technology"}),(0,We.jsx)(Cx,{value:"art",children:"Art & Design"}),(0,We.jsx)(Cx,{value:"education",children:"Education"}),(0,We.jsx)(Cx,{value:"other",children:"Other"})]}),!u.category&&(0,We.jsx)(Wk,{children:"Category is required"})]}),(0,We.jsxs)(Je,{sx:{mt:2},children:[(0,We.jsx)(mA,{variant:"subtitle2",children:"Tags (Optional)"}),(0,We.jsx)(Je,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:1},children:g.map((e=>(0,We.jsx)(rV,{label:e,onDelete:()=>{return t=e,void v(g.filter((e=>e!==t)));var t}},e)))}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(CN,{size:"small",value:y,onChange:e=>_(e.target.value),placeholder:"Add tag",onKeyPress:e=>"Enter"===e.key&&O()}),(0,We.jsx)(rR,{onClick:O,size:"small",children:(0,We.jsx)(xz,{})})]})]}),(0,We.jsxs)(Je,{sx:{mt:2},children:[(0,We.jsx)(mA,{variant:"subtitle2",children:"Rules (Optional)"}),(0,We.jsx)(Je,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:1},children:w.map((e=>(0,We.jsx)(rV,{label:e,onDelete:()=>{return t=e,void S(w.filter((e=>e!==t)));var t}},e)))}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(CN,{size:"small",value:T,onChange:e=>C(e.target.value),placeholder:"Add rule",onKeyPress:e=>"Enter"===e.key&&k()}),(0,We.jsx)(rR,{onClick:k,size:"small",children:(0,We.jsx)(xz,{})})]})]}),(0,We.jsx)(Gz,{control:(0,We.jsx)(GW,{checked:u.isPrivate,onChange:e=>d((t=>({...t,isPrivate:e.target.checked})))}),label:"Private Room"}),u.isPrivate&&(0,We.jsx)(CN,{margin:"dense",label:"Password",type:"password",fullWidth:!0,value:u.password,onChange:e=>d((t=>({...t,password:e.target.value}))),required:!0,error:!u.password.trim(),helperText:u.password.trim()?"":"Password is required for private rooms"})]}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:r,children:"Cancel"}),(0,We.jsx)(RR,{onClick:async e=>{if(e.preventDefault(),i&&KS)if(u.name.trim())if(u.description.trim())if(u.category)if(!u.isPrivate||u.password.trim())try{x(!0);const e={name:u.name,description:u.description,ownerId:i.uid,viewers:[{userId:i.uid,username:i.displayName||"Anonymous",avatar:i.photoURL||"",role:"owner",joinedAt:Av()}],viewerCount:1,createdAt:Av(),isPrivate:u.isPrivate,password:u.isPrivate?u.password:"",category:u.category,tags:u.tags,lastActive:Av(),isLive:!1,liveParticipants:[],activeUsers:0},t=await gv(Zm(KS,"sideRooms"),e);await pv(eg(KS,"users",i.uid,"sideRooms",t.id),{name:u.name,description:u.description,role:"owner",joinedAt:Av(),lastActive:Av()}),bT.success("Room created successfully!"),r(),o(`/side-room/${t.id}`)}catch(c){console.error("Error creating room:",c),bT.error("Failed to create room")}finally{x(!1)}else bT.error("Password is required for private rooms");else bT.error("Category is required");else bT.error("Description is required");else bT.error("Room name is required")},variant:"contained",disabled:I,children:I?"Creating...":"Create Room"})]})]})},Kz=["All","Gaming","Music","Art","Technology","Sports","Education","Entertainment","Social","Other"],$z=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)([]),[o,s]=(0,t.useState)(!0),[a,c]=(0,t.useState)(null),[l,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(null),[m,g]=(0,t.useState)(""),[v,y]=(0,t.useState)(!1),[_,E]=(0,t.useState)(""),[b,w]=(0,t.useState)("All"),[S,T]=(0,t.useState)("newest"),C=Q(),{currentUser:A}=ZT();(0,t.useEffect)((()=>{if(!KS)return c("Firestore not initialized"),void s(!1);try{s(!0);const e=Zm(KS,"sideRooms"),t=vv(Gg(e,Xg("createdAt","desc")),(e=>{const t=e.docs.map((e=>{const t=e.data();return{id:e.id,name:t.name||"",description:t.description,createdAt:t.createdAt,lastActive:t.lastActive,viewerCount:t.viewerCount||0,maxViewers:t.maxViewers||100,viewers:t.viewers,isPrivate:t.isPrivate,password:t.password,genre:t.genre,tags:t.tags,category:t.category}})),r=t.filter((e=>!e.isPrivate));n(r),s(!1),c(null)}),(e=>{console.error("Error fetching side rooms:",e),c("Error fetching rooms. Please check permissions or network."),s(!1)}));return()=>t()}catch(e){console.error("Error setting up side rooms query:",e),c(`Error setting up query: ${e.message}`),s(!1)}}),[KS]),(0,t.useEffect)((()=>{let t=[...e];_&&(t=t.filter((e=>e.name.toLowerCase().includes(_.toLowerCase())||e.description&&e.description.toLowerCase().includes(_.toLowerCase())))),"All"!==b&&(t=t.filter((e=>e.category===b||e.genre===b||e.tags&&e.tags.includes(b)))),t.sort(((e,t)=>{var n,r,i,o;const s=(null===(n=e.createdAt)||void 0===n?void 0:n.toMillis())||0,a=(null===(r=t.createdAt)||void 0===r?void 0:r.toMillis())||0,c=(null===(i=e.lastActive)||void 0===i?void 0:i.toMillis())||0,l=(null===(o=t.lastActive)||void 0===o?void 0:o.toMillis())||0;switch(S){case"newest":return a-s;case"oldest":return s-a;case"members":return(t.viewerCount||0)-(e.viewerCount||0);case"activity":return l-c;default:return 0}})),i(t)}),[e,_,b,S]);return o?(0,We.jsx)("div",{children:"Loading..."}):a?(0,We.jsxs)("div",{children:["Error: ",a]}):(0,We.jsxs)(Je,{sx:{p:3},children:[(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",children:"Side Rooms \ud83c\udfad"}),(0,We.jsx)(RR,{variant:"contained",color:"primary",startIcon:(0,We.jsx)(xz,{}),onClick:()=>u(!0),children:"Create Room"})]}),l&&(0,We.jsx)(qz,{open:l,onClose:()=>u(!1)}),(0,We.jsx)(kC,{sx:{p:2,mb:3},children:(0,We.jsxs)(aL,{container:!0,spacing:2,alignItems:"center",children:[(0,We.jsx)(aL,{item:!0,xs:12,md:4,children:(0,We.jsx)(CN,{fullWidth:!0,placeholder:"Search rooms by name or genre...",value:_,onChange:e=>E(e.target.value),InputProps:{startAdornment:(0,We.jsx)(TL,{position:"start",children:(0,We.jsx)(dz,{})})}})}),(0,We.jsx)(aL,{item:!0,xs:12,md:3,children:(0,We.jsxs)(Lk,{fullWidth:!0,children:[(0,We.jsx)(Ok,{children:"Genre/Category"}),(0,We.jsx)(_N,{value:b,label:"Genre/Category",onChange:e=>w(e.target.value),children:Kz.map((e=>(0,We.jsx)(Cx,{value:e,children:e},e)))})]})}),(0,We.jsx)(aL,{item:!0,xs:12,md:3,children:(0,We.jsxs)(Lk,{fullWidth:!0,children:[(0,We.jsx)(Ok,{children:"Sort by"}),(0,We.jsxs)(_N,{value:S,label:"Sort by",onChange:e=>T(e.target.value),children:[(0,We.jsx)(Cx,{value:"newest",children:"Newest First"}),(0,We.jsx)(Cx,{value:"oldest",children:"Oldest First"}),(0,We.jsx)(Cx,{value:"members",children:"Most Members"}),(0,We.jsx)(Cx,{value:"activity",children:"Most Active"})]})]})})]})}),(0,We.jsx)(Je,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:0===r.length?(0,We.jsx)(mA,{variant:"body1",sx:{width:"100%",textAlign:"center",mt:4},children:"No rooms found matching your criteria"}):r.map((e=>{var t;return(0,We.jsxs)(ZB,{sx:{width:300,display:"flex",flexDirection:"column"},children:[(0,We.jsxs)(dW,{sx:{flexGrow:1},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[(0,We.jsx)(mA,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.name}),e.isPrivate&&(0,We.jsx)(Iz,{title:"Private Room",children:(0,We.jsx)(TW,{fontSize:"small"})})]}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(e.category||e.genre)&&(0,We.jsx)(rV,{size:"small",label:e.category||e.genre,color:"secondary",variant:"outlined"}),null===(t=e.tags)||void 0===t?void 0:t.map((e=>(0,We.jsx)(rV,{size:"small",label:e,variant:"outlined"},e)))]}),(0,We.jsx)(rV,{size:"small",icon:(0,We.jsx)(RW,{}),label:`${e.viewerCount||0} viewers`,variant:"outlined"})]}),(0,We.jsx)(gW,{children:(0,We.jsx)(RR,{fullWidth:!0,variant:"contained",onClick:()=>(async e=>{if(KS&&A)if(e.isPrivate)f(e),h(!0);else try{y(!0);const t=eg(KS,"sideRooms",e.id);await Cv(KS,(async e=>{const n=await e.get(t);if(!n.exists())throw new Error("Room not found");if((n.data().viewers||[]).some((e=>e.userId===A.uid)))e.update(t,{activeUsers:xv(1),lastActive:Av()});else{const n={userId:A.uid,username:A.displayName||"Anonymous",avatar:A.photoURL||"",role:"viewer",joinedAt:new Date};e.update(t,{viewers:Rv(n),viewerCount:xv(1),activeUsers:xv(1),lastActive:Av()})}})),bT.success("Joined room successfully"),C(`/side-room/${e.id}`)}catch(a){console.error("Error joining room:",a),a instanceof Error?bT.error(a.message):bT.error("Failed to join room")}finally{y(!1)}else bT.error("Not authenticated")})(e),disabled:v||e.viewerCount>=e.maxViewers,sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:v?(0,We.jsx)(FN,{size:24}):e.viewerCount>=e.maxViewers?"Room Full":"Join Room"})})]},e.id)}))}),(0,We.jsxs)(wO,{open:d,onClose:()=>!v&&h(!1),children:[(0,We.jsx)(UB,{children:"Enter Room Password"}),(0,We.jsx)(SB,{children:(0,We.jsx)(CN,{autoFocus:!0,margin:"dense",label:"Password",type:"password",fullWidth:!0,value:m,onChange:e=>g(e.target.value),disabled:v})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>h(!1),disabled:v,children:"Cancel"}),(0,We.jsx)(RR,{onClick:async()=>{if(p&&KS&&A)if(m===p.password)try{y(!0);const e=eg(KS,"sideRooms",p.id);await Cv(KS,(async t=>{const n=await t.get(e);if(!n.exists())throw new Error("Room not found");(n.data().viewers||[]).some((e=>e.userId===A.uid))?t.update(e,{activeUsers:xv(1),lastActive:Av()}):t.update(e,{viewers:Rv({userId:A.uid,username:A.displayName||"Anonymous",avatar:A.photoURL||"",role:"member",joinedAt:new Date}),viewerCount:xv(1),activeUsers:xv(1),lastActive:Av()})})),bT.success("Joined room successfully"),h(!1),g(""),f(null),C(`/side-room/${p.id}`)}catch(a){console.error("Error joining room:",a),bT.error("Failed to join room")}finally{y(!1)}else bT.error("Incorrect password")},variant:"contained",disabled:v||!m,children:v?(0,We.jsx)(FN,{size:24}):"Join"})]})]})]})},Yz=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(""),[o,s]=(0,t.useState)(!1);(0,t.useEffect)((()=>{const e=localStorage.getItem("sadeai_chat_history");e&&n(JSON.parse(e))}),[]),(0,t.useEffect)((()=>{localStorage.setItem("sadeai_chat_history",JSON.stringify(e))}),[e]);const a=async()=>{if(r.trim()){n([...e,{sender:"user",text:r}]),s(!0);try{const e=await fetch("/api/sade-ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r})}),t=await e.json();n((e=>[...e,{sender:"ai",text:t.response||"Sorry, I couldn't think of a reply."}]))}catch(t){n((e=>[...e,{sender:"ai",text:"Sorry, there was an error connecting to Sade AI."}]))}s(!1),i("")}};return(0,We.jsx)(Je,{sx:{minHeight:"100vh",bgcolor:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",pb:{xs:10,sm:7},pt:{xs:2,sm:6}},children:(0,We.jsxs)(kC,{elevation:3,sx:{width:"100%",maxWidth:500,p:{xs:2,sm:4},borderRadius:4,mb:2,mt:2,boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.10)"},children:[(0,We.jsxs)(mA,{variant:"h4",align:"center",fontWeight:700,color:"primary.main",gutterBottom:!0,sx:{letterSpacing:1},children:["Sade AI ",(0,We.jsx)("span",{style:{fontWeight:400,fontSize:"1.2rem",color:"#888"},children:"(SHA-DEY)"})]}),(0,We.jsx)(Ux,{sx:{mb:2}}),(0,We.jsxs)(Je,{sx:{minHeight:320,maxHeight:{xs:350,sm:400},overflowY:"auto",bgcolor:"rgba(255,255,255,0.7)",borderRadius:3,p:2,mb:2,boxShadow:"0 2px 8px 0 rgba(31, 38, 135, 0.05)",transition:"background 0.3s"},children:[0===e.length&&(0,We.jsxs)(mA,{color:"text.secondary",align:"center",sx:{mt:8},children:["Say hello to ",(0,We.jsx)("b",{children:"Sade AI"}),", your friendly AI therapist! \ud83c\udf38"]}),e.map(((e,t)=>(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"user"===e.sender?"flex-end":"flex-start",mb:1.5},children:(0,We.jsx)(Je,{sx:{bgcolor:"user"===e.sender?"primary.main":"#f3f6fb",color:"user"===e.sender?"primary.contrastText":"text.primary",borderRadius:"user"===e.sender?"18px 18px 4px 18px":"18px 18px 18px 4px",px:2,py:1.2,maxWidth:"80%",boxShadow:"user"===e.sender?"0 2px 8px 0 rgba(33, 150, 243, 0.10)":"0 2px 8px 0 rgba(31, 38, 135, 0.05)",fontSize:"1.08rem",wordBreak:"break-word",fontFamily:"inherit"},children:e.text})},t))),o&&(0,We.jsx)(FN,{size:24,sx:{display:"block",mx:"auto",mt:2}})]}),(0,We.jsxs)(Je,{sx:{display:"flex",gap:1,alignItems:"center",position:{xs:"fixed",sm:"static"},bottom:{xs:64,sm:"auto"},left:0,width:{xs:"100vw",sm:"auto"},maxWidth:{xs:"100vw",sm:"none"},bgcolor:{xs:"rgba(255,255,255,0.95)",sm:"transparent"},p:{xs:2,sm:0},borderTop:{xs:"1px solid #eee",sm:"none"},zIndex:1200},children:[(0,We.jsx)(CN,{fullWidth:!0,variant:"outlined",placeholder:"Type your message...",value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a()},disabled:o,sx:{bgcolor:"white",borderRadius:2,boxShadow:"0 1px 4px 0 rgba(31,38,135,0.04)"}}),(0,We.jsx)(RR,{variant:"contained",onClick:a,disabled:o||!r.trim(),sx:{minWidth:80,fontWeight:600},children:"Send"}),(0,We.jsx)(RR,{variant:"outlined",color:"secondary",onClick:()=>{n([]),localStorage.removeItem("sadeai_chat_history")},disabled:o,sx:{minWidth:90,fontWeight:500},children:"Clear Chat"})]})]})})},Xz=(0,zC.A)((0,We.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff"),Jz=(0,zC.A)((0,We.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),Qz=(0,zC.A)((0,We.jsx)("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share"),Zz=(0,zC.A)((0,We.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),eH=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10c1.38 0 2.5-1.12 2.5-2.5 0-.61-.23-1.2-.64-1.67-.08-.1-.13-.21-.13-.33 0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9m5.5 11c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m-3-4c-.83 0-1.5-.67-1.5-1.5S13.67 6 14.5 6s1.5.67 1.5 1.5S15.33 9 14.5 9M5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S7.33 13 6.5 13 5 12.33 5 11.5m6-4c0 .83-.67 1.5-1.5 1.5S8 8.33 8 7.5 8.67 6 9.5 6s1.5.67 1.5 1.5"}),"Palette"),tH=(0,zC.A)((0,We.jsx)("path",{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"ExitToApp"),nH=(0,zC.A)((0,We.jsx)("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"}),"VolumeUp"),rH=e=>{var n;let{open:r,onClose:i,onSubmit:o,initialData:s,title:a,submitButtonText:c,isProcessing:l=!1}=e;const[u,d]=(0,t.useState)({name:(null===s||void 0===s?void 0:s.name)||"",description:(null===s||void 0===s?void 0:s.description)||"",isPrivate:(null===s||void 0===s?void 0:s.isPrivate)||!1,password:(null===s||void 0===s?void 0:s.password)||"",category:(null===s||void 0===s?void 0:s.category)||"",tags:(null===s||void 0===s?void 0:s.tags)||[]});return(0,We.jsx)(wO,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,We.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),await o(u)},children:[(0,We.jsx)(UB,{children:a}),(0,We.jsx)(SB,{children:(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[(0,We.jsx)(CN,{autoFocus:!0,required:!0,label:"Room Name",value:u.name,onChange:e=>d((t=>({...t,name:e.target.value}))),fullWidth:!0}),(0,We.jsx)(CN,{label:"Description",value:u.description,onChange:e=>d((t=>({...t,description:e.target.value}))),multiline:!0,rows:4,fullWidth:!0}),(0,We.jsx)(CN,{label:"Category",value:u.category,onChange:e=>d((t=>({...t,category:e.target.value}))),fullWidth:!0}),(0,We.jsx)(CN,{label:"Tags (comma separated)",value:null===(n=u.tags)||void 0===n?void 0:n.join(", "),onChange:e=>d((t=>({...t,tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"}),(0,We.jsx)(Gz,{control:(0,We.jsx)(GW,{checked:u.isPrivate,onChange:e=>d((t=>({...t,isPrivate:e.target.checked})))}),label:"Private Room"}),u.isPrivate&&(0,We.jsx)(CN,{required:!0,label:"Password",type:"password",value:u.password,onChange:e=>d((t=>({...t,password:e.target.value}))),fullWidth:!0})]})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:i,disabled:l,children:"Cancel"}),(0,We.jsx)(RR,{type:"submit",variant:"contained",disabled:l,children:c})]})]})})};var iH=n(1397),oH=n.n(iH),sH=n(560),aH=n.n(sH);const cH="b67cbd2d25d146c283500b20fa6b24d6",lH="007eJxTYJiqkhTCzh1YZ3Rm+nRTC5aVh0M/bs5uecOiV6Mfu+aTbb4CQ5KZeXJSilGKkWmKoYlZspGFsamBQZKRQVqiWZKRSYpZmjJvRkMgI8Oe1q0MjFAI4nMxBGempCq4VqYqGDEwAAA9qx5e",uH=()=>{const{roomId:e}=Z(),{currentUser:n,loading:r}=ZT(),i=Q(),[o,s]=(0,t.useState)(null),[a,c]=(0,t.useState)(!0),[l,u]=(0,t.useState)(null),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),[m,g]=(0,t.useState)(""),[v,y]=(0,t.useState)(!1),[_,E]=(0,t.useState)(!1),[b,w]=(0,t.useState)(!1),[S,T]=(0,t.useState)(!1),[C,A]=(0,t.useState)(null),[R,I]=(0,t.useState)([]),[x,O]=(0,t.useState)(void 0),[k,N]=(0,t.useState)(""),[P,D]=(0,t.useState)([]),[L,M]=(0,t.useState)([]),[j,U]=(0,t.useState)(!1),[V,F]=(0,t.useState)(!1),[B,W]=(0,t.useState)(!1),[z,H]=(0,t.useState)(!1),[G,q]=(0,t.useState)(!0),[K,$]=(0,t.useState)(!1),[Y,X]=(0,t.useState)(!1),[J,ee]=(0,t.useState)(null),[te,ne]=(0,t.useState)([]),[re,ie]=(0,t.useState)([]),[oe,se]=(0,t.useState)(!1),[ae,ce]=(0,t.useState)(""),le=(0,t.useRef)(null),ue=(0,t.useRef)(null),de=(0,t.useRef)(null),he=(0,t.useRef)(null),pe=(0,t.useRef)(null),fe=(0,t.useMemo)((()=>(null===o||void 0===o?void 0:o.ownerId)===(null===n||void 0===n?void 0:n.uid)),[null===o||void 0===o?void 0:o.ownerId,null===n||void 0===n?void 0:n.uid]),me=(0,t.useMemo)((()=>{var e;return!(null===o||void 0===o||null===(e=o.viewers)||void 0===e||!e.some((e=>e.userId===(null===n||void 0===n?void 0:n.uid))))}),[null===o||void 0===o?void 0:o.viewers,null===n||void 0===n?void 0:n.uid]),ge=fe||me,ve=(0,t.useMemo)((()=>R.filter((e=>e.isOnline))),[R]),ye=(0,t.useMemo)((()=>{var e;return null===o||void 0===o||null===(e=o.viewers)||void 0===e?void 0:e.find((e=>"owner"===e.role))}),[null===o||void 0===o?void 0:o.viewers]);(0,t.useEffect)((()=>{K&&(se(!0),(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const e=await navigator.mediaDevices.enumerateDevices();ie(e.filter((e=>"audioinput"===e.kind)))}catch(e){ie([])}})())}),[K]),(0,t.useEffect)((()=>{oe&&(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const e=await navigator.mediaDevices.enumerateDevices();ie(e.filter((e=>"audioinput"===e.kind)))}catch(e){ie([])}})()}),[oe]);const _e=(0,t.useCallback)(((e,t)=>{console.error(`Error (${t}):`,e);const n=e instanceof Error?e.message:`An unknown error occurred during ${t}.`;u(n),bT.error(`Error: ${n}`)}),[]),Ee=(0,t.useCallback)(oH().debounce((async()=>{if(null!==n&&void 0!==n&&n.uid&&e)try{var t,r;const i=eg(KS,"sideRooms",e,"presence",n.uid),o={userId:n.uid,username:n.displayName||(null===(t=n.email)||void 0===t?void 0:t.split("@")[0])||"",avatar:n.photoURL||"",displayName:n.displayName||(null===(r=n.email)||void 0===r?void 0:r.split("@")[0])||"",lastSeen:Date.now(),isOnline:!0,role:fe?"owner":"viewer",isMuted:B,isSpeaking:z};await pv(i,{...o,lastSeen:Av()},{merge:!0})}catch(i){console.error("Presence update failed:",i)}}),2e3),[null===n||void 0===n?void 0:n.uid,null===n||void 0===n?void 0:n.displayName,null===n||void 0===n?void 0:n.email,null===n||void 0===n?void 0:n.photoURL,e,fe,B,z]),be=(0,t.useCallback)((async()=>{try{J&&(J.close(),ee(null)),le.current&&await le.current.leave(),ne([]),F(!1),H(!1),X(!1),console.log("Successfully left audio channel")}catch(l){console.error("Error leaving audio:",l),bT.error("Failed to leave audio channel")}}),[J]),we=(0,t.useCallback)((async(e,t)=>{try{if(console.log("Starting to join channel:",e,"with uid:",t),console.log("Using App ID:",cH),!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");if(!le.current){console.log("Creating new Agora client");try{le.current=aH().createClient({mode:"rtc",codec:"vp8"}),le.current.on("connection-state-change",((e,t)=>{console.log("Connection state changed:",t,"->",e)})),le.current.on("error",(e=>{console.error("Agora client error:",e),e.message.includes("CAN_NOT_GET_GATEWAY_SERVER")&&console.error("Gateway server error details:",{error:e,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,online:navigator.onLine})})),console.log("Attempting to join channel with simple configuration");try{await le.current.join(cH,"test-channel",lH,t),console.log("Successfully joined test channel"),await le.current.leave(),console.log("Left test channel")}catch(r){if(console.error("Test channel join failed:",r),r instanceof Error&&r.message.includes("CAN_NOT_GET_GATEWAY_SERVER"))throw new Error("Unable to connect to Agora servers. This might be due to: 1) Project status not being active, 2) App ID not being properly configured, or 3) Network restrictions. Please check your Agora Console settings and try again.");throw r}console.log("Attempting to join actual channel:",e),await le.current.join(cH,e,lH,t),console.log("Successfully joined actual channel")}catch(l){if(console.error("Failed to create or join channel:",l),l instanceof Error&&l.message.includes("CAN_NOT_GET_GATEWAY_SERVER"))throw console.error("Gateway server error details:",{error:l,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,online:navigator.onLine}),new Error('Unable to connect to Agora servers. Please check: 1) Your Agora project status is "Active", 2) The App ID is correctly configured, 3) Your network allows connections to Agora servers.');throw l}}console.log("Creating local audio track");try{var n;const e=await aH().createMicrophoneAudioTrack();ee(e),console.log("Publishing local audio track"),await(null===(n=le.current)||void 0===n?void 0:n.publish(e)),e.setVolume(100),await e.play(),K&&await e.setPlaybackDevice("default"),X(!0),console.log("Successfully joined channel and published audio")}catch(l){throw console.error("Failed to create or publish audio track:",l),new Error("Failed to setup audio. Please check your microphone permissions and try again.")}}catch(l){if(console.error("Failed to join channel:",l),l instanceof Error){if(l.message.includes("CAN_NOT_GET_GATEWAY_SERVER"))throw new Error('Unable to connect to Agora servers. Please check: 1) Your Agora project status is "Active", 2) The App ID is correctly configured, 3) Your network allows connections to Agora servers.');if(l.message.includes("INVALID_APP_ID"))throw new Error("Invalid Agora App ID. Please verify your App ID in the Agora Console and ensure it is enabled for RTC functionality.");if(l.message.includes("INVALID_CHANNEL_NAME"))throw new Error("Invalid channel name. Please try again.");if(l.message.includes("NotAllowedError"))throw new Error("Microphone access was denied. Please allow microphone access and try again.");if(l.message.includes("NotFoundError"))throw new Error("No microphone found. Please connect a microphone and try again.");if(l.message.includes("NotReadableError"))throw new Error("Microphone is busy or not accessible. Please check if another application is using it.")}throw J&&(J.close(),ee(null)),le.current&&await le.current.leave(),X(!1),l}}),[K]),Se=(0,t.useCallback)((async()=>{if(!d&&null!==n&&void 0!==n&&n.uid){h(!0);try{if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");console.log("Requesting microphone permissions...");(await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach((e=>e.stop())),console.log("Enumerating audio devices...");const e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind));if(ie(e),0===e.length)throw new Error("No microphones found. Please connect a microphone and try again.");if(1!==e.length)return console.log("Multiple microphones found, showing selection dialog"),void se(!0);console.log("Auto-selecting single microphone:",e[0].label),ce(e[0].deviceId),X(!0),F(!0),W(!1)}catch(l){const t=l instanceof Error?l:new Error(String(l));console.error("Audio setup failed:",t),"NotAllowedError"===t.name?bT.error("Microphone access was denied. Please allow microphone access and try again."):"NotFoundError"===t.name?bT.error("No microphone found. Please connect a microphone and try again."):"NotReadableError"===t.name?bT.error("Microphone is busy or not accessible. Please check if another application is using it."):t.message.includes("No internet connection")?bT.error("No internet connection. Please check your network and try again."):bT.error(`Failed to setup microphone: ${t.message}`)}finally{h(!1)}}}),[null===n||void 0===n?void 0:n.uid,d,ae,e]);(0,t.useEffect)((()=>{if(!e||!ge)return;const t=vv(Gg(Zm(KS,"sideRooms",e,"presence"),Kg("isOnline","==",!0)),(e=>{if(null===n||void 0===n||!n.uid)return;const t=new Map;e.docs.forEach((e=>{t.set(e.id,{userId:e.id,...e.data()})})),I(Array.from(t.values())),Ee()}),(e=>_e(e,"listening to presence")));ge&&Ee();const r=()=>{"hidden"===document.visibilityState&&Ee()},i=()=>{Ee()};return document.addEventListener("visibilitychange",r),window.addEventListener("beforeunload",i),()=>{t(),document.removeEventListener("visibilitychange",r),window.removeEventListener("beforeunload",i),null!==n&&void 0!==n&&n.uid&&pv(eg(KS,"sideRooms",e,"presence",n.uid),{isOnline:!1,lastSeen:Av()},{merge:!0}).catch(console.error)}}),[e,ge,null===n||void 0===n?void 0:n.uid,Ee,_e]);(0,t.useEffect)((()=>{if(!J)return;return(()=>{try{ue.current||(ue.current=new(window.AudioContext||window.webkitAudioContext));const e=ue.current.createAnalyser();e.fftSize=32,de.current=e;const t=new MediaStream([J.getMediaStreamTrack()]);ue.current.createMediaStreamSource(t).connect(e),Te()}catch(e){console.error("Audio analysis setup failed:",e)}})(),()=>{he.current&&cancelAnimationFrame(he.current),pe.current&&clearTimeout(pe.current)}}),[J]);const Te=()=>{if(!de.current)return;const e=de.current,t=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(t);let n=0;for(let i=0;i<t.length;i++)n+=t[i];const r=n/t.length/255>.03;r!==z&&(pe.current&&clearTimeout(pe.current),pe.current=setTimeout((()=>{H(r),Ee()}),300)),he.current=requestAnimationFrame(Te)};(0,t.useEffect)((()=>{let e=!0;async function t(){try{const t=(await navigator.mediaDevices.enumerateDevices()).some((e=>"audioinput"===e.kind));e&&q(t)}catch(t){e&&q(!0)}}return t(),navigator.mediaDevices.addEventListener("devicechange",t),()=>{e=!1,navigator.mediaDevices.removeEventListener("devicechange",t)}}),[]);const Ce=(0,t.useCallback)((e=>{console.log("Admin mute/unmute user:",e),bT("Admin mute functionality not yet implemented.")}),[]),Ae=(0,t.useCallback)((e=>{console.log("Admin remove user:",e.userId),bT("Admin remove functionality not yet implemented.")}),[]),Re=(0,t.useCallback)((()=>{console.log("Share room clicked"),T(!0)}),[]),Ie=(0,t.useCallback)((e=>{A(e.currentTarget)}),[]),xe=(0,t.useCallback)((()=>{A(null)}),[]),Oe=(0,t.useCallback)((()=>{console.log("Edit room clicked"),y(!0),xe()}),[xe]),ke=(0,t.useCallback)((()=>{console.log("Style room clicked"),w(!0),xe()}),[xe]),Ne=(0,t.useCallback)((()=>{console.log("Invite members clicked"),E(!0),xe()}),[xe]),Pe=(0,t.useCallback)((async()=>{if(console.log("Delete room clicked"),xe(),e&&fe&&window.confirm("Are you sure you want to delete this room permanently? This cannot be undone.")){h(!0);try{await mv(eg(KS,"sideRooms",e)),bT.success("Room deleted successfully"),i("/side-rooms")}catch(t){_e(t,"deleting room"),h(!1)}}}),[e,fe,i,_e,xe]),De=(0,t.useCallback)(oH().debounce((async e=>{if(e.trim()){console.log("Searching users:",e);try{const t=Gg(Zm(KS,"users"),Kg("username",">=",e),Kg("username","<=",e+"\uf8ff"),Qg(10)),r=(await hv(t)).docs.map((e=>{const t=e.data();return t?{id:e.id,...t}:null})).filter((e=>null!==e));D(r.filter((e=>e.id!==(null===n||void 0===n?void 0:n.uid))))}catch(t){_e(t,`searching users for query: ${e}`),D([])}}else D([])}),300),[null===n||void 0===n?void 0:n.uid,_e]),Le=(0,t.useCallback)((async()=>{if(e&&L.length&&!j){console.log("Submitting invites for users:",L.map((e=>e.id))),U(!0);try{const t=eg(KS,"sideRooms",e),n=Ov(KS);L.forEach((e=>{const r={userId:e.id,username:e.username,avatar:e.avatar||"",joinedAt:Av(),role:"viewer"};n.update(t,{viewers:Rv(r)})})),await n.commit(),bT.success(`Invited ${L.length} user(s).`),M([]),E(!1)}catch(t){_e(t,"submitting invites")}finally{U(!1)}}}),[e,L,j,_e]),Me=(0,t.useCallback)((async t=>{if(e&&fe){console.log("Submitting room edits:",t),h(!0);try{const n=eg(KS,"sideRooms",e);await fv(n,t),bT.success("Room updated successfully"),y(!1)}catch(n){_e(n,"submitting room edits")}finally{h(!1)}}}),[e,fe,_e]),je=(0,t.useCallback)((()=>{try{J&&(B?(J.setEnabled(!0),console.log("Unmuted microphone")):(J.setEnabled(!1),console.log("Muted microphone"))),W(!B)}catch(l){console.error("Error toggling mute:",l),bT.error("Failed to toggle mute")}}),[B,J]),Ue=(0,t.useCallback)((()=>{console.log("Password submit clicked")}),[]),Ve=(0,t.useCallback)((async()=>{console.log("Leaving room...")}),[]),Fe=(0,t.useCallback)((async()=>{if(ae){se(!1),h(!0);try{console.log("Testing selected microphone:",ae);(await navigator.mediaDevices.getUserMedia({audio:{deviceId:ae,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach((e=>e.stop())),console.log("Joining voice channel with selected device..."),await we(e,n.uid),console.log("Setting up audio analysis...");const t=(new(window.AudioContext||window.webkitAudioContext)).createAnalyser();t.fftSize=2048,F(!0),W(!1);const r=()=>{const e=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(e);const n=e.some((e=>e>30));H(n),requestAnimationFrame(r)};r()}catch(l){const t=l instanceof Error?l:new Error(String(l));console.error("Microphone setup failed:",t),"NotAllowedError"===t.name?bT.error("Microphone access was denied. Please allow microphone access and try again."):"NotFoundError"===t.name?bT.error("Selected microphone not found. Please select another microphone."):"NotReadableError"===t.name?bT.error("Microphone is busy or not accessible. Please check if another application is using it."):bT.error(`Failed to setup microphone: ${t.message}`),await be()}finally{h(!1)}}else bT.error("Please select a microphone")}),[ae,e,n,we,be]);(0,t.useEffect)((()=>()=>{V&&be()}),[V,be]),(0,t.useEffect)((()=>{if(!e||!n||r)return void(r||(c(!1),u("Cannot load room: Missing room ID or user information.")));c(!0),u(null);const t=vv(eg(KS,"sideRooms",e),(t=>{if(t.exists()){var r,i,o;const e={id:t.id,...t.data()};s(e),O(e.style);const a=e.ownerId===n.uid,l=null!==(r=null===(i=e.viewers)||void 0===i?void 0:i.some((e=>e.userId===n.uid)))&&void 0!==r&&r;!(null!==(o=e.isPrivate)&&void 0!==o&&o)||a||l?(f(!1),c(!1)):(f(!0),c(!1))}else u(`Room with ID "${e}" not found.`),s(null),c(!1)}),(e=>{_e(e,"fetching room data"),s(null),c(!1)}));return()=>{t()}}),[e,n,r,i,_e]);const Be=e=>{let{participant:t}=e;return(0,We.jsx)(aL,{item:!0,xs:6,sm:4,md:3,lg:2,children:(0,We.jsxs)(kC,{elevation:t.isSpeaking?4:1,sx:{p:1,textAlign:"center",position:"relative",overflow:"hidden",bgcolor:t.isSpeaking?"primary.light":"background.paper",transition:"all 0.3s ease-in-out",transform:t.isSpeaking?"scale(1.05)":"scale(1)"},children:[(0,We.jsx)(cA,{src:t.avatar,alt:t.displayName,sx:{width:60,height:60,margin:"auto",mb:1,border:t.isSpeaking?"3px solid":"none",borderColor:"primary.main",boxShadow:t.isSpeaking?"0 0 10px rgba(0,0,0,0.2)":"none"}}),(0,We.jsx)(mA,{variant:"caption",display:"block",noWrap:!0,sx:{fontWeight:500},children:t.displayName||t.username}),t.isMuted&&(0,We.jsx)(Xz,{fontSize:"small",sx:{position:"absolute",top:4,right:4,color:"text.secondary",bgcolor:"rgba(255,255,255,0.7)",borderRadius:"50%",p:.2}}),"owner"===t.role&&(0,We.jsx)(rV,{label:"Host",size:"small",color:"primary",sx:{position:"absolute",top:4,left:4,height:18,fontSize:"0.65rem"}}),fe&&t.userId!==(null===n||void 0===n?void 0:n.uid)&&(0,We.jsxs)(Je,{sx:{position:"absolute",bottom:2,right:2,display:"flex",gap:.5},children:[(0,We.jsx)(Iz,{title:t.isMuted?"Request Unmute":"Mute User",children:(0,We.jsx)(rR,{size:"small",onClick:()=>Ce(t.userId),children:t.isMuted?(0,We.jsx)(Jz,{fontSize:"inherit"}):(0,We.jsx)(Xz,{fontSize:"inherit"})})}),(0,We.jsx)(Iz,{title:"Remove User",children:(0,We.jsx)(rR,{size:"small",color:"error",onClick:()=>Ae(t),children:(0,We.jsx)(yW,{fontSize:"inherit"})})})]})]})},t.userId)};return r||a?(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,We.jsx)(FN,{})}):a||!l||o?o||a?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)("div",{id:"remote-audio-container",style:{display:"none"}}),(0,We.jsxs)(Je,{sx:{display:"flex",height:"calc(100vh - 64px)",flexDirection:"column",overflow:"hidden",bgcolor:(null===x||void 0===x?void 0:x.backgroundColor)||"background.default"},children:[(0,We.jsxs)(Je,{sx:{p:{xs:1,sm:1.5},borderBottom:1,borderColor:"divider",background:(null!==x&&void 0!==x&&x.headerGradient,null===x||void 0===x?void 0:x.headerColor),color:(null===x||void 0===x?void 0:x.textColor)||"text.primary"},children:[(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,We.jsxs)(Je,{sx:{overflow:"hidden",mr:1},children:[(0,We.jsx)(mA,{noWrap:!0,variant:"h6",component:"h1",sx:{fontFamily:null===x||void 0===x?void 0:x.font,fontSize:"1.1rem",fontWeight:"bold"},children:null===o||void 0===o?void 0:o.name}),ye&&(0,We.jsxs)(mA,{noWrap:!0,variant:"caption",sx:{opacity:.8},children:["Host: ",ye.username]})]}),(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:0},children:[(0,We.jsx)(Iz,{title:"Share",children:(0,We.jsx)(rR,{size:"small",sx:{color:"inherit"},onClick:Re,children:(0,We.jsx)(Qz,{fontSize:"inherit"})})}),fe&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Iz,{title:"Settings",children:(0,We.jsx)(rR,{size:"small",sx:{color:"inherit"},onClick:Ie,children:(0,We.jsx)(Zz,{fontSize:"inherit"})})}),(0,We.jsxs)(px,{anchorEl:C,open:Boolean(C),onClose:xe,children:[(0,We.jsxs)(Cx,{onClick:Oe,children:[(0,We.jsx)(xx,{children:(0,We.jsx)(CW,{fontSize:"small"})}),"Edit Room"]}),(0,We.jsxs)(Cx,{onClick:ke,children:[(0,We.jsx)(xx,{children:(0,We.jsx)(eH,{fontSize:"small"})}),"Customize"]}),(0,We.jsxs)(Cx,{onClick:Ne,children:[(0,We.jsx)(xx,{children:(0,We.jsx)(_W,{fontSize:"small"})}),"Invite"]}),(0,We.jsxs)(Cx,{onClick:Pe,children:[(0,We.jsx)(xx,{children:(0,We.jsx)(AW,{fontSize:"small"})}),"Delete Room"]})]})]}),(0,We.jsx)(Iz,{title:"Leave",children:(0,We.jsx)(rR,{size:"small",sx:{color:"inherit"},onClick:Ve,disabled:d,children:(0,We.jsx)(tH,{fontSize:"inherit"})})})]})]}),(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,We.jsxs)(mA,{variant:"caption",sx:{color:"inherit",opacity:.8},children:[ve.length," Online"]}),(0,We.jsx)(Je,{sx:{display:"flex",gap:1},children:V?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(RR,{variant:"contained",size:"small",color:B?"secondary":"primary",onClick:je,startIcon:B?(0,We.jsx)(Xz,{}):(0,We.jsx)(Jz,{}),sx:{fontSize:"0.75rem",px:1.5},disabled:d,children:B?"Unmute":"Mute"}),(0,We.jsx)(RR,{variant:"outlined",size:"small",color:"error",onClick:be,sx:{fontSize:"0.75rem",px:1.5},disabled:d,children:"Leave Audio"})]}):(0,We.jsx)(RR,{variant:"contained",size:"small",color:"success",onClick:Se,startIcon:(0,We.jsx)(nH,{}),disabled:!ge||d||!G,sx:{fontSize:"0.75rem",px:1.5},children:"Join Audio"})})]})]}),(0,We.jsx)(Je,{sx:{flexGrow:1,overflow:"hidden"},children:(0,We.jsxs)(Je,{sx:{flexGrow:1,p:2,overflowY:"auto"},children:[(0,We.jsxs)(mA,{variant:"h6",gutterBottom:!0,children:["Participants (",ve.length,")"]}),(0,We.jsxs)(aL,{container:!0,spacing:2,children:[n&&V&&(0,We.jsx)(Be,{participant:{userId:n.uid,avatar:n.photoURL||"",displayName:n.displayName||"You",username:n.displayName||"You",isMuted:B,isOnline:!0,role:fe?"owner":"viewer",lastSeen:Date.now(),isSpeaking:z}}),ve.filter((e=>e.userId!==(null===n||void 0===n?void 0:n.uid))).map((e=>(0,We.jsx)(Be,{participant:e},e.userId)))]}),!V&&ge&&!a&&o&&(0,We.jsx)($D,{severity:"info",sx:{mt:2},children:" Join the audio to start talking or listening. "})]})}),v&&o&&(0,We.jsx)(rH,{open:v,onClose:()=>y(!1),onSubmit:Me,initialData:o?{...o}:void 0,title:"Edit Room",submitButtonText:"Save Changes"}),(0,We.jsxs)(wO,{open:_,onClose:()=>E(!1),maxWidth:"xs",fullWidth:!0,children:[(0,We.jsx)(UB,{children:"Invite Users"}),(0,We.jsxs)(SB,{children:[(0,We.jsx)(CN,{label:"Search Users",variant:"outlined",fullWidth:!0,size:"small",value:k,onChange:e=>{N(e.target.value),De(e.target.value)},InputProps:{startAdornment:(0,We.jsx)(TL,{position:"start",children:(0,We.jsx)(dz,{})})},sx:{mb:2}}),(0,We.jsx)(Je,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:1},children:L.map((e=>(0,We.jsx)(rV,{avatar:(0,We.jsx)(cA,{src:e.avatar}),label:e.username,onDelete:()=>M((t=>t.filter((t=>t.id!==e.id))))},e.id)))}),(0,We.jsx)(DR,{sx:{maxHeight:200,overflow:"auto"},children:P.map((e=>(0,We.jsxs)(sO,{button:!0,onClick:()=>{L.some((t=>t.id===e.id))||M((t=>[...t,e]))},children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.avatar})}),(0,We.jsx)(Px,{primary:e.username})]},e.id)))})]}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>E(!1),children:"Cancel"}),(0,We.jsx)(RR,{onClick:Le,disabled:j||0===L.length,variant:"contained",children:j?"Sending...":"Send Invites"})]})]}),(0,We.jsxs)(wO,{open:oe,onClose:()=>se(!1),children:[(0,We.jsx)(UB,{children:"Select Microphone"}),(0,We.jsx)(SB,{children:(0,We.jsx)(_N,{fullWidth:!0,value:ae,onChange:e=>ce(e.target.value),children:re.map((e=>(0,We.jsx)(Cx,{value:e.deviceId,children:e.label||`Microphone ${re.indexOf(e)+1}`},e.deviceId)))})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>se(!1),children:"Cancel"}),(0,We.jsx)(RR,{onClick:Fe,variant:"contained",disabled:!ae,children:"Confirm"})]})]}),(0,We.jsxs)(wO,{open:p&&!ge,onClose:()=>!d&&i("/side-rooms"),children:[(0,We.jsx)(UB,{children:"Enter Password"}),(0,We.jsx)(SB,{children:(0,We.jsx)(CN,{autoFocus:!0,type:"password",label:"Room Password",value:m,onChange:e=>g(e.target.value),fullWidth:!0})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>i("/side-rooms"),children:"Cancel"}),(0,We.jsx)(RR,{onClick:Ue,variant:"contained",disabled:d,children:"Join"})]})]})]})]}):(0,We.jsx)(Je,{sx:{p:3},children:(0,We.jsx)($D,{severity:"warning",children:"Room not found or access denied."})}):(0,We.jsxs)(Je,{sx:{p:3},children:[(0,We.jsx)($D,{severity:"error",children:l}),(0,We.jsx)(RR,{onClick:()=>i("/side-rooms"),sx:{mt:1},children:"Back to Rooms"})]})},dH=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(""),[o,s]=(0,t.useState)(""),[a,c]=(0,t.useState)(null);(0,t.useEffect)((()=>{const e=vv(Gg(Zm(KS,"messages"),Xg("timestamp","asc")),(e=>{const t=e.docs.map((e=>{var t;return{id:e.id,...e.data(),timestamp:null===(t=e.data().timestamp)||void 0===t?void 0:t.toDate()}}));n(t)}));return()=>e()}),[]);return(0,We.jsx)(sP,{maxWidth:"md",children:(0,We.jsxs)(Je,{sx:{mt:4,mb:4},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",gutterBottom:!0,children:"Chat Room"}),(0,We.jsx)(DR,{sx:{maxHeight:"60vh",overflow:"auto",bgcolor:"background.paper",borderRadius:1},children:e.map((e=>{var t;return(0,We.jsxs)(sO,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,We.jsx)(mA,{variant:"subtitle2",color:"primary",children:e.username}),(0,We.jsx)(mA,{variant:"body1",children:e.text}),(0,We.jsx)(mA,{variant:"caption",color:"text.secondary",children:null===(t=e.timestamp)||void 0===t?void 0:t.toLocaleTimeString()})]},e.id)}))}),(0,We.jsxs)(Je,{component:"form",onSubmit:async e=>{if(e.preventDefault(),""!==r.trim()&&KS)try{var t;await gv(Zm(KS,"messages"),{text:r,userId:null===(t=$S.currentUser)||void 0===t?void 0:t.uid,username:o||"Anonymous",timestamp:Av()}),i("")}catch(a){console.error("Error sending message:",a)}},sx:{mt:2},children:[(0,We.jsx)(CN,{fullWidth:!0,variant:"outlined",placeholder:"Type your message...",value:r,onChange:e=>i(e.target.value),sx:{mb:2}}),(0,We.jsx)(RR,{type:"submit",variant:"contained",color:"primary",children:"Send"})]})]})})};var hH=n(5361);function pH(e){return(0,AC.Ay)("MuiCollapse",e)}(0,Ke.A)("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const fH=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],mH=(0,wC.Ay)("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],"entered"===n.state&&t.entered,"exited"===n.state&&!n.in&&"0px"===n.collapsedSize&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({height:0,overflow:"hidden",transition:t.transitions.create("height")},"horizontal"===n.orientation&&{height:"auto",width:0,transition:t.transitions.create("width")},"entered"===n.state&&(0,ke.A)({height:"auto",overflow:"visible"},"horizontal"===n.orientation&&{width:"auto"}),"exited"===n.state&&!n.in&&"0px"===n.collapsedSize&&{visibility:"hidden"})})),gH=(0,wC.Ay)("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})((e=>{let{ownerState:t}=e;return(0,ke.A)({display:"flex",width:"100%"},"horizontal"===t.orientation&&{width:"auto",height:"100%"})})),vH=(0,wC.Ay)("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})((e=>{let{ownerState:t}=e;return(0,ke.A)({width:"100%"},"horizontal"===t.orientation&&{width:"auto",height:"100%"})})),yH=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiCollapse"}),{addEndListener:i,children:o,className:s,collapsedSize:a="0px",component:c,easing:l,in:u,onEnter:d,onEntered:h,onEntering:p,onExit:f,onExited:m,onExiting:g,orientation:v="vertical",style:y,timeout:_=hH.p0.standard,TransitionComponent:E=rI}=r,b=(0,Ne.A)(r,fH),w=(0,ke.A)({},r,{orientation:v,collapsedSize:a}),S=(e=>{const{orientation:t,classes:n}=e,r={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return(0,bC.A)(r,pH,n)})(w),T=iI(),C=(0,OA.A)(),A=t.useRef(null),R=t.useRef(),I="number"===typeof a?`${a}px`:a,x="horizontal"===v,O=x?"width":"height",k=t.useRef(null),N=(0,gA.A)(n,k),P=e=>t=>{if(e){const n=k.current;void 0===t?e(n):e(n,t)}},D=()=>A.current?A.current[x?"clientWidth":"clientHeight"]:0,L=P(((e,t)=>{A.current&&x&&(A.current.style.position="absolute"),e.style[O]=I,d&&d(e,t)})),M=P(((e,t)=>{const n=D();A.current&&x&&(A.current.style.position="");const{duration:r,easing:i}=sI({style:y,timeout:_,easing:l},{mode:"enter"});if("auto"===_){const t=T.transitions.getAutoHeightDuration(n);e.style.transitionDuration=`${t}ms`,R.current=t}else e.style.transitionDuration="string"===typeof r?r:`${r}ms`;e.style[O]=`${n}px`,e.style.transitionTimingFunction=i,p&&p(e,t)})),j=P(((e,t)=>{e.style[O]="auto",h&&h(e,t)})),U=P((e=>{e.style[O]=`${D()}px`,f&&f(e)})),V=P(m),F=P((e=>{const t=D(),{duration:n,easing:r}=sI({style:y,timeout:_,easing:l},{mode:"exit"});if("auto"===_){const n=T.transitions.getAutoHeightDuration(t);e.style.transitionDuration=`${n}ms`,R.current=n}else e.style.transitionDuration="string"===typeof n?n:`${n}ms`;e.style[O]=I,e.style.transitionTimingFunction=r,g&&g(e)}));return(0,We.jsx)(E,(0,ke.A)({in:u,onEnter:L,onEntered:j,onEntering:M,onExit:U,onExited:V,onExiting:F,addEndListener:e=>{"auto"===_&&C.start(R.current||0,e),i&&i(k.current,e)},nodeRef:k,timeout:"auto"===_?null:_},b,{children:(e,t)=>(0,We.jsx)(mH,(0,ke.A)({as:c,className:(0,Pe.A)(S.root,s,{entered:S.entered,exited:!u&&"0px"===I&&S.hidden}[e]),style:(0,ke.A)({[x?"minWidth":"minHeight"]:I},y),ref:N},t,{ownerState:(0,ke.A)({},w,{state:e}),children:(0,We.jsx)(gH,{ownerState:(0,ke.A)({},w,{state:e}),className:S.wrapper,ref:A,children:(0,We.jsx)(vH,{ownerState:(0,ke.A)({},w,{state:e}),className:S.wrapperInner,children:o})})}))}))}));yH.muiSupportAuto=!0;const _H=yH;const EH=t.createContext({});function bH(e){return(0,AC.Ay)("MuiAccordion",e)}const wH=(0,Ke.A)("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),SH=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],TH=(0,wC.Ay)(kC,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${wH.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t}=e;const n={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],n),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],n)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${wH.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${wH.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}}),(e=>{let{theme:t}=e;return{variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${wH.expanded}`]:{margin:"16px 0"}}}]}})),CH=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiAccordion"}),{children:i,className:o,defaultExpanded:s=!1,disabled:a=!1,disableGutters:c=!1,expanded:l,onChange:u,square:d=!1,slots:h={},slotProps:p={},TransitionComponent:f,TransitionProps:m}=r,g=(0,Ne.A)(r,SH),[v,y]=(0,Zk.A)({controlled:l,default:s,name:"Accordion",state:"expanded"}),_=t.useCallback((e=>{y(!v),u&&u(e,!v)}),[v,u,y]),[E,...b]=t.Children.toArray(i),w=t.useMemo((()=>({expanded:v,disabled:a,disableGutters:c,toggle:_})),[v,a,c,_]),S=(0,ke.A)({},r,{square:d,disabled:a,disableGutters:c,expanded:v}),T=(e=>{const{classes:t,square:n,expanded:r,disabled:i,disableGutters:o}=e,s={root:["root",!n&&"rounded",r&&"expanded",i&&"disabled",!o&&"gutters"],region:["region"]};return(0,bC.A)(s,bH,t)})(S),C=(0,ke.A)({transition:f},h),A=(0,ke.A)({transition:m},p),[R,I]=nA("transition",{elementType:_H,externalForwardedProps:{slots:C,slotProps:A},ownerState:S});return(0,We.jsxs)(TH,(0,ke.A)({className:(0,Pe.A)(T.root,o),ref:n,ownerState:S,square:d},g,{children:[(0,We.jsx)(EH.Provider,{value:w,children:E}),(0,We.jsx)(R,(0,ke.A)({in:v,timeout:"auto"},I,{children:(0,We.jsx)("div",{"aria-labelledby":E.props.id,id:E.props["aria-controls"],role:"region",className:T.region,children:b})}))]}))})),AH=CH;function RH(e){return(0,AC.Ay)("MuiAccordionSummary",e)}const IH=(0,Ke.A)("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),xH=["children","className","expandIcon","focusVisibleClassName","onClick"],OH=(0,wC.Ay)(JA,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;const n={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],n),[`&.${IH.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${IH.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${IH.disabled})`]:{cursor:"pointer"},variants:[{props:e=>!e.disableGutters,style:{[`&.${IH.expanded}`]:{minHeight:64}}}]}})),kH=(0,wC.Ay)("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})((e=>{let{theme:t}=e;return{display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${IH.expanded}`]:{margin:"20px 0"}}}]}})),NH=(0,wC.Ay)("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})((e=>{let{theme:t}=e;return{display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${IH.expanded}`]:{transform:"rotate(180deg)"}}})),PH=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiAccordionSummary"}),{children:i,className:o,expandIcon:s,focusVisibleClassName:a,onClick:c}=r,l=(0,Ne.A)(r,xH),{disabled:u=!1,disableGutters:d,expanded:h,toggle:p}=t.useContext(EH),f=(0,ke.A)({},r,{expanded:h,disabled:u,disableGutters:d}),m=(e=>{const{classes:t,expanded:n,disabled:r,disableGutters:i}=e,o={root:["root",n&&"expanded",r&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]};return(0,bC.A)(o,RH,t)})(f);return(0,We.jsxs)(OH,(0,ke.A)({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":h,className:(0,Pe.A)(m.root,o),focusVisibleClassName:(0,Pe.A)(m.focusVisible,a),onClick:e=>{p&&p(e),c&&c(e)},ref:n,ownerState:f},l,{children:[(0,We.jsx)(kH,{className:m.content,ownerState:f,children:i}),s&&(0,We.jsx)(NH,{className:m.expandIconWrapper,ownerState:f,children:s})]}))})),DH=PH;function LH(e){return(0,AC.Ay)("MuiAccordionDetails",e)}(0,Ke.A)("MuiAccordionDetails",["root"]);const MH=["className"],jH=(0,wC.Ay)("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{padding:t.spacing(1,2,2)}})),UH=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiAccordionDetails"}),{className:r}=n,i=(0,Ne.A)(n,MH),o=n,s=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},LH,t)})(o);return(0,We.jsx)(jH,(0,ke.A)({className:(0,Pe.A)(s.root,r),ref:t,ownerState:o},i))})),VH=UH,FH=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}),"Public"),BH=(0,zC.A)((0,We.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),WH=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),zH=(0,zC.A)((0,We.jsx)("path",{d:"m5.2494 8.0688 2.83-2.8269 14.1343 14.15-2.83 2.8269zm4.2363-4.2415 2.828-2.8289 5.6577 5.656-2.828 2.8289zM.9989 12.3147l2.8284-2.8285 5.6569 5.6569-2.8285 2.8284zM1 21h12v2H1z"}),"Gavel"),HH=(0,zC.A)((0,We.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"VerifiedUser"),GH=(0,zC.A)((0,We.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutline"),qH=(0,zC.A)((0,We.jsx)("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),KH=(0,zC.A)((0,We.jsx)("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3m1-4.3h-2V7h2z"}),"Report"),$H=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),YH=()=>(0,We.jsxs)(Je,{sx:{mx:"auto"},children:[(0,We.jsx)(mA,{variant:"body1",sx:{mb:3},children:"These guidelines help ensure SideEye remains a platform where users can express themselves freely while maintaining a respectful and safe environment for all."}),(0,We.jsxs)(mA,{variant:"body1",sx:{mb:3,bgcolor:"info.light",p:2,borderRadius:1},children:[(0,We.jsx)("strong",{children:"Important Notice:"}),' SideEye uses an AI-powered moderation system that automatically scans all content against our community guidelines. Violations will result in strike points on your account, which can lead to warnings, restrictions, or account suspension. See the "Strike System" section below for more details.']}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(KW,{}),children:(0,We.jsx)(mA,{children:"Our Commitment to Safety"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"We are committed to maintaining a safe and respectful environment for all users. Our platform encourages healthy banter and shade while strictly prohibiting harassment, bullying, harmful content, misinformation, fraud, and cybercrime."}),(0,We.jsx)(mA,{paragraph:!0,children:"We believe in:"}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(YW,{})}),(0,We.jsx)(Px,{primary:"Protecting User Privacy",secondary:"We implement strict data protection measures and transparent privacy policies"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(Bx,{})}),(0,We.jsx)(Px,{primary:"Mental Health Support",secondary:"We provide resources and tools to support users' wellbeing"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(FH,{})}),(0,We.jsx)(Px,{primary:"Inclusive Community",secondary:"We foster an environment that welcomes diverse perspectives and experiences"})]})]})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(BH,{}),children:(0,We.jsx)(mA,{children:"Prohibited Content"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"The following content is not permitted on our platform and may result in content removal, account restrictions, or termination:"}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Harassment & Bullying",secondary:"Targeted attacks, threats, persistent unwanted attention, or content designed to degrade or shame others"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Hate Speech",secondary:"Content that promotes discrimination, hostility, or violence against protected characteristics including race, ethnicity, national origin, religious affiliation, sexual orientation, gender, gender identity, or disability"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Misinformation",secondary:"Deliberate spreading of false information about health, science, elections, or current events that may cause public harm"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Fraud & Scams",secondary:"Financial scams, phishing attempts, pyramid schemes, deceptive business practices, or unauthorized promotions"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Cybercrime",secondary:"Hacking attempts, malware distribution, unauthorized access, or other illegal online activities"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Adult Content & Exploitation",secondary:"Sexually explicit content, non-consensual intimate imagery, sexual exploitation, or content that sexualizes minors"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Violence & Gore",secondary:"Gratuitous violence, content promoting self-harm, suicide, eating disorders, or graphic injury"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Copyright Infringement",secondary:"Content that violates copyright laws, including unauthorized use of intellectual property, especially in Vibits videos"})]})]})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(zH,{}),children:(0,We.jsx)(mA,{children:"Vibits Community Guidelines"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"Our Vibits video sharing feature has specific guidelines to ensure a safe and enjoyable experience for all users:"}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(HH,{})}),(0,We.jsx)(Px,{primary:"Content Ownership",secondary:"Only upload videos that you've created or have permission to use. Respect copyright and intellectual property rights"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Appropriate Content",secondary:"Videos must not contain nudity, pornography, violence, hate speech, dangerous activities, or illegal substances"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(GH,{})}),(0,We.jsx)(Px,{primary:"Privacy & Consent",secondary:"Get consent before featuring identifiable individuals in your videos, especially in private settings"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(XW,{})}),(0,We.jsx)(Px,{primary:"Disclosure",secondary:"Clearly disclose if your content is sponsored, contains affiliate links, or is otherwise commercial in nature"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(YW,{})}),(0,We.jsx)(Px,{primary:"Music & Audio",secondary:"Only use music and audio that you have rights to use or that is available through our platform's licensed library"})]})]}),(0,We.jsx)(mA,{paragraph:!0,children:"Vibits content is subject to both human and AI-powered moderation. Videos that violate these guidelines may be removed, and repeated violations may result in account restrictions or termination."})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(zH,{}),children:(0,We.jsx)(mA,{children:"Content Moderation"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"Our content moderation approach combines technology and human review to enforce our community guidelines fairly and consistently:"}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(HH,{})}),(0,We.jsx)(Px,{primary:"AI-Powered Detection",secondary:"Advanced algorithms detect harmful content, misinformation, and suspicious activities in real-time"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(qH,{})}),(0,We.jsx)(Px,{primary:"Automated Checks",secondary:"Real-time scanning for fraud, cybercrime, and policy violations using pattern recognition"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(GH,{})}),(0,We.jsx)(Px,{primary:"Human Review",secondary:"Trained moderators review flagged content and complex cases with cultural and contextual awareness"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(XW,{})}),(0,We.jsx)(Px,{primary:"Educational Approach",secondary:"First-time or minor violations may result in warnings with educational resources"})]})]}),(0,We.jsx)(Ux,{sx:{my:2}}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,children:"Enforcement Actions"}),(0,We.jsx)(mA,{paragraph:!0,children:"Depending on the severity and frequency of violations, we may take the following actions:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Content removal"}),(0,We.jsx)("li",{children:"Warning notifications"}),(0,We.jsx)("li",{children:"Temporary feature restrictions"}),(0,We.jsx)("li",{children:"Temporary account suspension"}),(0,We.jsx)("li",{children:"Permanent account termination"})]})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(BH,{}),children:(0,We.jsx)(mA,{children:"Strike System"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"SideEye employs a strike system to enforce our community guidelines fairly and consistently:"}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,children:"Strike Points"}),(0,We.jsx)(mA,{paragraph:!0,children:"Violations of our guidelines result in strike points based on severity:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Standard violations:"})," 1 strike point"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Serious violations"})," (misinformation, fraud, violence): 1.5 strike points"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Severe violations"})," (harmful content, cybercrime, exploitation): 2 strike points"]})]}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,children:"Consequences"}),(0,We.jsx)(mA,{paragraph:!0,children:"As strike points accumulate, the following actions will be taken:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"3+ points:"})," Warning and educational resources"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"6+ points:"})," Temporary feature restrictions for 3 days"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"9+ points:"})," Account suspension for 7 days"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"12+ points:"})," Permanent account suspension"]})]}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,children:"Appeals"}),(0,We.jsx)(mA,{paragraph:!0,children:"If you believe a strike was issued in error, you can appeal through your account settings or by contacting support@sideeye.com."}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,children:"Expiration"}),(0,We.jsx)(mA,{paragraph:!0,children:"Strike points remain on your account for 6 months before beginning to expire."})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(KH,{}),children:(0,We.jsx)(mA,{children:"Reporting & Moderation"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"We rely on our community to help maintain a safe environment. If you encounter content that violates our guidelines, please report it immediately."}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(KH,{})}),(0,We.jsx)(Px,{primary:"How to Report",secondary:"Click the three dots menu on any post, comment, or profile and select 'Report' to flag content that violates our guidelines"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(KH,{})}),(0,We.jsx)(Px,{primary:"What Happens Next",secondary:"Our team reviews reports promptly, typically within 24-48 hours, and takes appropriate action based on our guidelines"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(KH,{})}),(0,We.jsx)(Px,{primary:"Appeals Process",secondary:"If you believe a moderation decision was made in error, you can appeal through your account settings or by contacting support@sideeye.com"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(KH,{})}),(0,We.jsx)(Px,{primary:"Transparency",secondary:"We publish regular reports on content moderation actions and policy enforcement to maintain accountability"})]})]})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)($H,{}),children:(0,We.jsx)(mA,{children:"Getting Help"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"We're committed to supporting our users' wellbeing and safety both on and off the platform."}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)($H,{})}),(0,We.jsx)(Px,{primary:"Support Resources",secondary:"Access to mental health resources, crisis helplines, and support services through our Help Center"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)($H,{})}),(0,We.jsx)(Px,{primary:"Safety Tips",secondary:"Guidelines for protecting your privacy, recognizing potential scams, and staying safe online"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)($H,{})}),(0,We.jsx)(Px,{primary:"Contact Us",secondary:"Reach out to our support team at support@sideeye.com for assistance with safety concerns"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)($H,{})}),(0,We.jsx)(Px,{primary:"Emergency Situations",secondary:"If you're experiencing an emergency or believe someone is in immediate danger, please contact local emergency services immediately"})]})]}),(0,We.jsx)(mA,{variant:"body2",sx:{mt:2,fontStyle:"italic"},children:"SideEye is committed to continuously improving our safety measures and community guidelines. We regularly update our policies based on emerging threats, user feedback, and industry best practices."})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(KW,{}),children:(0,We.jsx)(mA,{children:"Vibits Security & Privacy"})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{paragraph:!0,children:"We take the security and privacy of your Vibits videos seriously. Here's how we protect your content:"}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(YW,{})}),(0,We.jsx)(Px,{primary:"Secure Storage",secondary:"All videos are stored using industry-standard encryption and secure cloud storage protocols"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(GH,{})}),(0,We.jsx)(Px,{primary:"Privacy Controls",secondary:"You can delete your videos at any time, and you control who can view, comment on, and share your content"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(HH,{})}),(0,We.jsx)(Px,{primary:"Content Protection",secondary:"We implement measures to prevent unauthorized downloading and redistribution of your videos"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(qH,{})}),(0,We.jsx)(Px,{primary:"Metadata Stripping",secondary:"We remove sensitive metadata from videos that could reveal your location or device information"})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(WH,{})}),(0,We.jsx)(Px,{primary:"Report & Remove",secondary:"We provide tools to report videos that violate our guidelines, and we respond quickly to removal requests"})]})]}),(0,We.jsx)(mA,{paragraph:!0,children:"To enhance your privacy when using Vibits:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Be mindful of what's visible in your videos (addresses, personal documents, etc.)"}),(0,We.jsx)("li",{children:"Consider the environment you're filming in and who might be visible in the background"}),(0,We.jsx)("li",{children:"Review your videos before posting to ensure you're comfortable with all content"}),(0,We.jsx)("li",{children:"Use the reporting tools if you see content that violates our guidelines"})]})]})]})]}),XH=()=>(0,We.jsx)(sP,{maxWidth:"lg",children:(0,We.jsxs)(Je,{sx:{py:4},children:[(0,We.jsx)(mA,{variant:"h4",sx:{mb:3,fontWeight:"bold"},children:"Safety & Community Guidelines"}),(0,We.jsx)(kC,{elevation:3,sx:{p:{xs:2,md:4},borderRadius:2},children:(0,We.jsx)(YH,{})})]})}),JH=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),QH=(0,zC.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),ZH=(0,zC.A)((0,We.jsx)("path",{d:"M11 7 9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8z"}),"Login"),eG=(0,zC.A)((0,We.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),tG=()=>{const{currentUser:e,userProfile:n}=ZT(),{canViewProfile:r,canViewContent:i}=tC(),[o,s]=(0,t.useState)(!1),[a,c]=(0,t.useState)({emailVerified:!1,deviceVerified:!1,lastSecurityUpdate:null});(0,t.useEffect)((()=>{if(null===e||void 0===e||!e.uid)return;const t=vv(eg(KS,"users",e.uid),(t=>{if(t.exists()){const n=t.data();s(n.isPrivate||!1),c({emailVerified:e.emailVerified||!1,deviceVerified:n.sourceCodeSetupComplete||!1,lastSecurityUpdate:n.lastSecurityUpdate||null})}}));return()=>t()}),[null===e||void 0===e?void 0:e.uid,null===e||void 0===e?void 0:e.emailVerified]);return(0,We.jsx)(sP,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(kC,{elevation:3,sx:{p:4},children:[(0,We.jsxs)(mA,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,We.jsx)(KW,{color:"primary"})," Security & Authentication"]}),(0,We.jsx)($D,{severity:"info",sx:{mt:2,mb:4},children:"SideEye takes your security and privacy seriously. Our multi-layer authentication system helps protect your account and data from unauthorized access."}),(0,We.jsxs)(Je,{sx:{mb:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium"},children:"Security Status"}),(0,We.jsx)(Ux,{sx:{mb:3}}),(0,We.jsxs)(Uz,{direction:"row",spacing:2,sx:{mb:3},children:[(0,We.jsx)(rV,{icon:a.emailVerified?(0,We.jsx)(JH,{}):(0,We.jsx)(QH,{}),label:a.emailVerified?"Email Verified":"Email Not Verified",color:a.emailVerified?"success":"error",variant:"outlined"}),(0,We.jsx)(rV,{icon:a.deviceVerified?(0,We.jsx)(JH,{}):(0,We.jsx)(QH,{}),label:a.deviceVerified?"Device Verified":"Device Not Verified",color:a.deviceVerified?"success":"error",variant:"outlined"})]})]}),(0,We.jsxs)(Je,{sx:{mb:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium"},children:"Account Privacy"}),(0,We.jsx)(Ux,{sx:{mb:3}}),(0,We.jsxs)(kC,{elevation:1,sx:{p:3},children:[(0,We.jsx)(Gz,{control:(0,We.jsx)(GW,{checked:o,onChange:async()=>{if(null!==e&&void 0!==e&&e.uid)try{await fv(eg(KS,"users",e.uid),{isPrivate:!o,lastSecurityUpdate:Av()}),bT.success("Account is now "+(o?"public":"private"))}catch(k_){console.error("Error updating privacy settings:",k_),bT.error("Failed to update privacy settings")}},color:"primary"}),label:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle1",children:"Private Account"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:o?"Only approved followers can see your content":"Anyone can see your content"})]})}),(0,We.jsx)($D,{severity:"info",sx:{mt:2},children:o?"When your account is private, only approved followers can see your content. New followers must send a follow request.":"When your account is public, anyone can see your content and follow you without approval."})]})]}),(0,We.jsxs)(Je,{sx:{mb:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium"},children:"Authentication Flow"}),(0,We.jsx)(Ux,{sx:{mb:3}}),(0,We.jsxs)(DR,{children:[(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(ZH,{color:"primary"})}),(0,We.jsx)(Px,{primary:"Step 1: Email & Password Authentication",secondary:"First, you log in with your email and password. This provides the initial layer of account security."})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(HH,{color:"primary"})}),(0,We.jsx)(Px,{primary:"Step 2: Email Verification",secondary:"New accounts must verify their email address before gaining full access to all features."})]}),(0,We.jsxs)(sO,{children:[(0,We.jsx)(xx,{children:(0,We.jsx)(tz,{color:"primary"})}),(0,We.jsx)(Px,{primary:"Step 3: Source Code Authentication",secondary:"When logging in from a new device, you must enter your 8-digit source code as an additional security measure."})]})]})]}),(0,We.jsxs)(AH,{children:[(0,We.jsx)(DH,{expandIcon:(0,We.jsx)(eG,{}),children:(0,We.jsxs)(mA,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,We.jsx)(XW,{fontSize:"small"})," Browser Privacy Settings"]})}),(0,We.jsxs)(VH,{children:[(0,We.jsx)(mA,{variant:"body2",paragraph:!0,children:"Some browsers have strict privacy settings that can affect device registration:"}),(0,We.jsxs)(DR,{dense:!0,children:[(0,We.jsx)(sO,{children:(0,We.jsx)(Px,{primary:"\u2022 Safari users may need to enable website data storage",secondary:"Safari > Preferences > Privacy > Website Data"})}),(0,We.jsx)(sO,{children:(0,We.jsx)(Px,{primary:"\u2022 Private/Incognito browsing may require re-authentication",secondary:"Devices won't be persistently registered in private browsing modes"})}),(0,We.jsx)(sO,{children:(0,We.jsx)(Px,{primary:"\u2022 Clearing browser data will remove device registration",secondary:"You'll need to re-authenticate with your Source Code"})})]})]})]})]})})},nG=()=>(0,We.jsx)(sP,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(kC,{elevation:3,sx:{p:4},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",gutterBottom:!0,children:"Privacy Policy"}),(0,We.jsxs)(mA,{variant:"body1",paragraph:!0,children:["Last updated: ",(new Date).toLocaleDateString()]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"1. Information We Collect"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We collect information that you provide directly to us, including:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Account information (username, email, display name)"}),(0,We.jsx)("li",{children:"Profile information (bio, profile picture, custom avatars)"}),(0,We.jsx)("li",{children:"Content you post (posts, comments, likes, reposts)"}),(0,We.jsx)("li",{children:"Videos you upload to Vibits (including metadata and engagement data)"}),(0,We.jsx)("li",{children:"Connection data (followers, following relationships)"}),(0,We.jsx)("li",{children:"Messages and communications between users"}),(0,We.jsx)("li",{children:"Usage information and interaction with the platform"})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"2. How We Use Your Information"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We use the information we collect to:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Provide and maintain our services"}),(0,We.jsx)("li",{children:"Improve and personalize your experience"}),(0,We.jsx)("li",{children:"Facilitate connections between users"}),(0,We.jsx)("li",{children:"Display relevant content in your feed"}),(0,We.jsx)("li",{children:"Process and deliver messages between users"}),(0,We.jsx)("li",{children:"Recommend relevant videos in Vibits based on your preferences"}),(0,We.jsx)("li",{children:"Monitor and enforce our community guidelines"}),(0,We.jsx)("li",{children:"Communicate with you about updates and changes"}),(0,We.jsx)("li",{children:"Ensure platform safety and security"}),(0,We.jsx)("li",{children:"Comply with legal obligations"})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"3. Sharing Your Information"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We may share your information in the following ways:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"With Other Users:"})," Your profile information, posts, videos, and content are shared with other users according to your privacy settings."]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Service Providers:"})," We may share information with third-party vendors who provide services on our behalf, including video hosting and processing."]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Legal Requirements:"})," We may disclose information if required by law or to protect rights, safety, and security."]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Business Transfers:"})," In connection with a merger, acquisition, or sale of assets."]})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"4. Data Security"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We implement appropriate security measures to protect your personal information, including encryption of sensitive data, secure storage protocols, and regular security audits. However, no method of transmission over the internet is 100% secure, and we cannot guarantee absolute security."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"5. Your Rights"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"You have the right to:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Access your personal information"}),(0,We.jsx)("li",{children:"Correct inaccurate information"}),(0,We.jsx)("li",{children:"Delete your account and associated data"}),(0,We.jsx)("li",{children:"Delete videos you've uploaded to Vibits"}),(0,We.jsx)("li",{children:"Control your privacy settings and follower relationships"}),(0,We.jsx)("li",{children:"Restrict processing of your information"}),(0,We.jsx)("li",{children:"Request a data export of your content"}),(0,We.jsx)("li",{children:"Opt-out of marketing communications"})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"6. Content Removal and Retention"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"When you delete content, it may remain in our backup systems for a limited time. Deleted content is moved to a temporary storage for 24 hours before permanent deletion, allowing for potential recovery if accidentally deleted. For Vibits videos, we may retain non-personally identifiable analytics data even after video deletion."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"7. Cookies and Tracking"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We use cookies and similar tracking technologies to improve your experience, maintain login sessions, and analyze usage patterns. Please see our Cookie Policy for more details on how we use these technologies."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"8. Third-Party Links"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Our service may contain links to third-party websites or services that are not owned or controlled by us. We have no control over and assume no responsibility for the content, privacy policies, or practices of any third-party services."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"9. Vibits Video Information"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"When you upload videos to Vibits, we collect:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Video Content:"})," The actual video file you upload"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Metadata:"})," Information such as upload time, duration, and format"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"User Association:"})," Connection between your account and the video"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Engagement Data:"})," Likes, comments, shares, and viewing statistics"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Device Information:"})," Information about the device used to upload the video"]})]}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We use this information to provide the Vibits service, recommend videos to other users, and improve our platform. You maintain ownership of your videos and can delete them at any time, though we may retain anonymized analytics data."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"10. Children's Privacy"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Our services are not intended for use by children under the age of 13. We do not knowingly collect personal information from children under 13. If you are a parent or guardian and believe your child has provided us with personal information, please contact us."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"11. Changes to This Policy"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:'We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new policy on this page and updating the "Last updated" date.'})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"12. Contact Us"}),(0,We.jsxs)(mA,{variant:"body1",paragraph:!0,children:["If you have any questions about this Privacy Policy, please contact us at:",(0,We.jsx)("br",{}),"Email: privacy@sideeye.com"]})]})]})}),rG=()=>(0,We.jsxs)(sP,{maxWidth:"lg",sx:{py:12},children:[(0,We.jsxs)(kC,{elevation:3,sx:{p:{xs:3,md:6},mb:6},children:[(0,We.jsx)(mA,{variant:"h1",component:"h1",sx:{textAlign:"center",fontWeight:"bold",mb:6,fontSize:{xs:"2.5rem",md:"3.5rem"},color:"primary.main",textTransform:"uppercase",letterSpacing:2},children:"About SideEye"}),(0,We.jsx)(Ux,{sx:{my:6}}),(0,We.jsxs)(Je,{sx:{mb:8},children:[(0,We.jsx)(mA,{variant:"h2",sx:{fontWeight:"medium",mb:4,fontSize:{xs:"2rem",md:"2.5rem"},color:"text.primary"},children:"Our Mission"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"SideEye is a moderated social media platform dedicated to creating a safe and engaging space for users to share their thoughts, connect with others, and express themselves through various forms of content. We believe in fostering meaningful conversations while maintaining a respectful and inclusive environment through our comprehensive moderation system that ensures all users can interact authentically within clear community guidelines."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h2",sx:{fontWeight:"medium",mb:6,fontSize:{xs:"2rem",md:"2.5rem"},color:"text.primary"},children:"Features"}),(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:6},children:[(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"Side Rooms"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Create or join interactive discussion rooms where you can connect with other users in real-time. Side Rooms support live streaming, allowing you to go live and interact directly with your audience. These rooms can be public or private, with customizable settings for membership, moderation, and content focus. Each room provides a dedicated space for conversations around specific interests or topics."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"Feed"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Stay connected with content from users you follow through our personalized Feed. See posts, updates, and activities from your network in real-time. Our Feed is designed to show you the most relevant content based on your interests and connections, creating a tailored experience that keeps you engaged with your community."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"Discover"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Explore new content, find interesting users to follow, and discover trending Side Rooms through our Discover feature. This curated exploration space helps you find content aligned with your interests and introduces you to new communities within the platform. Discover makes it easy to expand your network and find engaging discussions to join."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"AI Moderation"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Our advanced AI moderation system automatically scans all content against our community guidelines, detecting potential violations across multiple categories including harmful content, misinformation, fraud, cybercrime, adult content, and violence. This system helps maintain a safe environment by issuing appropriate warnings or restrictions when needed, while protecting users from harmful interactions."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"User Expression"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Express yourself through various reaction types including sideEye, tea, shade, and petty. Our platform encourages authentic communication with features designed for meaningful social interaction. Whether you're sharing thoughts, connecting with others, or participating in discussions, SideEye provides the tools for genuine self-expression within a respectful framework."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"Vibits"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Share and discover short-form videos through our Vibits feature. Create, upload, and engage with captivating video content in a vertical scrolling format. Interact with videos through likes, comments, and sharing, or follow content creators you enjoy. Vibits offers a dynamic way to express yourself creatively and connect with others through visual storytelling, with built-in moderation to ensure a safe viewing experience."})]}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"h3",sx:{fontWeight:"medium",mb:3,fontSize:{xs:"1.75rem",md:"2rem"},color:"primary.main"},children:"Live Streaming"}),(0,We.jsx)(mA,{variant:"h4",sx:{lineHeight:1.8,color:"text.secondary",fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Go live in Side Rooms to engage with your audience in real-time through video streaming. Host discussions, Q&A sessions, or casual hangouts with followers and community members. Our streaming feature supports interactive elements like viewer comments and reactions, creating an immersive and engaging experience for both hosts and viewers."})]})]})]})]}),(0,We.jsx)(Je,{sx:{textAlign:"center",mt:8},children:(0,We.jsxs)(mA,{variant:"body2",color:"text.secondary",children:["\xa9 ",(new Date).getFullYear()," SideEye | Created by Enoch Asekomhe | All Rights Reserved"]})})]}),iG=()=>(0,We.jsx)(sP,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(kC,{elevation:3,sx:{p:4},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",gutterBottom:!0,children:"Terms of Service"}),(0,We.jsxs)(mA,{variant:"body1",paragraph:!0,children:["Last updated: ",(new Date).toLocaleDateString()]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"1. Acceptance of Terms"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"By accessing or using SideEye, you agree to be bound by these Terms of Service and all applicable laws and regulations. If you do not agree with any of these terms, you are prohibited from using or accessing this site."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"2. User Accounts"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"To use certain features of SideEye, you must create an account. You are responsible for:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Maintaining the confidentiality of your account information"}),(0,We.jsx)("li",{children:"All activities that occur under your account"}),(0,We.jsx)("li",{children:"Providing accurate and complete profile information"}),(0,We.jsx)("li",{children:"Securing your login credentials"}),(0,We.jsx)("li",{children:"Notifying us immediately of any unauthorized use"})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"3. User Conduct"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"You agree not to:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Post or transmit any content that is unlawful, harmful, threatening, abusive, harassing, defamatory, vulgar, obscene, or otherwise objectionable"}),(0,We.jsx)("li",{children:"Upload videos to Vibits that contain inappropriate content, copyright infringement, or violate our Community Guidelines"}),(0,We.jsx)("li",{children:"Harass, bully, intimidate, or stalk other users"}),(0,We.jsx)("li",{children:"Impersonate any person or entity or falsely state or misrepresent your affiliation with a person or entity"}),(0,We.jsx)("li",{children:"Interfere with or disrupt the proper functioning of the service or servers"}),(0,We.jsx)("li",{children:"Attempt to gain unauthorized access to any portion of the service or other systems"}),(0,We.jsx)("li",{children:"Use the service for any illegal purpose or in violation of any local, state, national, or international law"}),(0,We.jsx)("li",{children:"Collect or store personal data about other users without their consent"}),(0,We.jsx)("li",{children:"Create multiple accounts to evade restrictions or limitations"}),(0,We.jsx)("li",{children:"Engage in spamming, phishing, or other deceptive practices"})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"4. Content Ownership and License"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"You retain ownership of any content you post on SideEye, including videos uploaded to Vibits. By posting content, you grant us a worldwide, non-exclusive, royalty-free license (with the right to sublicense) to use, reproduce, process, adapt, modify, publish, transmit, display, and distribute your content in any and all media or distribution methods."}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"This license allows us to make your content available to the rest of the world and to let others do the same. The license continues even if you stop using our services, but you can delete content from public view at any time."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"5. Vibits Video Sharing"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Vibits is our video sharing feature that allows users to upload, view, like, comment on, and share short videos. When using Vibits, you agree to:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Only upload videos that you have created or for which you have the necessary rights and permissions"}),(0,We.jsx)("li",{children:"Not upload videos that infringe on others' intellectual property rights"}),(0,We.jsx)("li",{children:"Not upload videos containing explicit content, hate speech, violence, or any content that violates our Community Guidelines"}),(0,We.jsx)("li",{children:"Allow other users to view, like, comment on, and share your videos according to your privacy settings"}),(0,We.jsx)("li",{children:"Grant us the license as described in Section 4 for videos you upload to Vibits"}),(0,We.jsx)("li",{children:"Understand that we may remove videos that violate our policies without prior notice"})]}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We may provide tools to enhance or edit your videos, but we do not claim ownership of your original content. We reserve the right to display advertisements alongside or within Vibits content without providing compensation to you."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"6. Follower Relationships"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"SideEye allows users to follow other users and be followed by others. When you follow someone, you'll see their posts and activity on your feed. Users you follow will be able to see that you follow them. Similarly, users who follow you will be visible to you and others. You can unfollow users at any time."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"7. Direct Messages"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"SideEye provides a direct messaging feature for users to communicate privately. You are responsible for the content of your messages. While we strive to protect the privacy of your messages, we reserve the right to review content in the case of reported violations. We may take action if messages violate our guidelines."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"8. Content Moderation"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We reserve the right to moderate content posted on our platform, including Vibits videos. We may remove, restrict, or disable access to any content or account that we determine violates these Terms or our Community Guidelines. Content moderation decisions are made in our sole discretion. Users can appeal moderation decisions through our support channels."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"9. Intellectual Property"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"The SideEye service and its original content, features, and functionality are and will remain the exclusive property of SideEye and its licensors. The service is protected by copyright, trademark, and other laws. Our trademarks and trade dress may not be used in connection with any product or service without the prior written consent of SideEye."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"10. Termination"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We reserve the right to terminate or suspend your account and access to the service at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users, us, or third parties, or for any other reason. Upon termination, your right to use the service will immediately cease."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"11. Content Removal and Recovery"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"When you delete content, including Vibits videos, it will be moved to a trash area for 24 hours before permanent deletion, allowing for recovery if accidentally deleted. We reserve the right to retain certain information as required by law or for legitimate business purposes."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"12. Disclaimer"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:'The service is provided "as is" without any warranties, express or implied. We do not guarantee that the service will be uninterrupted, timely, secure, or error-free. We make no warranties or representations about the accuracy or completeness of the content provided by our users.'})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"13. Limitation of Liability"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"In no event shall SideEye be liable for any indirect, incidental, special, consequential, or punitive damages arising out of or related to your use of the service, including but not limited to damages for loss of profits, goodwill, use, data, or other intangible losses."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"14. Indemnification"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"You agree to indemnify and hold harmless SideEye and its officers, directors, employees, and agents from any claims, damages, liabilities, costs, or expenses (including reasonable attorney fees) arising from your use of the service or your violation of these Terms."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"15. DMCA Compliance"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"SideEye respects the intellectual property rights of others. If you believe that your work has been copied in a way that constitutes copyright infringement on Vibits or elsewhere on our platform, please provide our copyright agent with the following information:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"An electronic or physical signature of the person authorized to act on behalf of the copyright owner"}),(0,We.jsx)("li",{children:"A description of the copyrighted work that you claim has been infringed"}),(0,We.jsx)("li",{children:"A description of where the material that you claim is infringing is located on the site"}),(0,We.jsx)("li",{children:"Your address, telephone number, and email address"}),(0,We.jsx)("li",{children:"A statement by you that you have a good faith belief that the disputed use is not authorized by the copyright owner, its agent, or the law"}),(0,We.jsx)("li",{children:"A statement by you, made under penalty of perjury, that the above information is accurate and that you are the copyright owner or authorized to act on the copyright owner's behalf"})]}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Our copyright agent can be reached at: dmca@sideeye.com"})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"16. Changes to Terms"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:'We reserve the right to modify these Terms at any time. We will notify users of any material changes by posting the new Terms on the service and updating the "Last updated" date. Your continued use of the service after such changes constitutes your acceptance of the new Terms.'})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"17. Governing Law"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"These Terms shall be governed by and construed in accordance with the laws of the jurisdiction in which we operate, without regard to its conflict of law provisions."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"18. Contact Information"}),(0,We.jsxs)(mA,{variant:"body1",paragraph:!0,children:["If you have any questions about these Terms, please contact us at:",(0,We.jsx)("br",{}),"Email: legal@sideeye.com"]})]})]})}),oG=()=>(0,We.jsx)(sP,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(kC,{elevation:3,sx:{p:4},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",gutterBottom:!0,children:"Cookie Policy"}),(0,We.jsxs)(mA,{variant:"body1",paragraph:!0,children:["Last updated: ",(new Date).toLocaleDateString()]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Introduction"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"SideEye uses cookies and similar technologies to provide, improve, and secure our services. This Cookie Policy explains how we use cookies, what types we use, their purposes, and how you can control them."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"What Are Cookies?"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:'Cookies are small text files that are stored on your device when you visit a website. They are widely used to make websites work more efficiently and provide information to the website owners. Cookies can be "persistent" or "session" cookies. Persistent cookies remain on your device after you close your browser, while session cookies are deleted when you close your browser.'})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Types of Cookies We Use"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We use the following types of cookies for the purposes explained below:"}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"1. Essential Cookies"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"These cookies are necessary for the functioning of our platform and cannot be switched off. They include:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Authentication cookies to recognize you when you log in"}),(0,We.jsx)("li",{children:"Security cookies to prevent fraudulent activities"}),(0,We.jsx)("li",{children:"Session cookies to maintain your active session"})]}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"2. Performance Cookies"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"These cookies help us understand how visitors interact with our platform by collecting information anonymously. They include:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Analytics cookies to measure user interactions with content"}),(0,We.jsx)("li",{children:"Error monitoring cookies to identify and fix platform issues"}),(0,We.jsx)("li",{children:"Load balancing cookies to distribute traffic to our servers"})]}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"3. Functional Cookies"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"These cookies enable enhanced functionality and personalization. They include:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Preference cookies to remember your settings and choices"}),(0,We.jsx)("li",{children:"Interface customization cookies for personalized layouts"}),(0,We.jsx)("li",{children:"Language preference cookies"})]}),(0,We.jsx)(mA,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"4. Targeting/Advertising Cookies"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"These cookies may be set through our site by our advertising partners to build a profile of your interests. They include:"}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Social media cookies for content sharing and network integration"}),(0,We.jsx)("li",{children:"Recommendation cookies to suggest relevant content"})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Specific Cookies Used by SideEye"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Below are some of the key cookies we use on SideEye:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"sideeye_session"}),": Authentication and session management"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"sideeye_preferences"}),": Stores user preferences like theme and layout settings"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"sideeye_auth"}),": Maintains login state and authentication details"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"sideeye_analytics"}),": Collects anonymous usage data to improve our services"]})]})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Third-Party Cookies"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We may allow third parties to place cookies on your device when you visit our platform. These third parties include:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Analytics providers"})," (such as Google Analytics) to help us understand user behavior"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Social media platforms"})," (such as Twitter, Facebook) when you use social sharing features"]}),(0,We.jsxs)("li",{children:[(0,We.jsx)("strong",{children:"Security services"})," to protect against malicious activities"]})]}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"These third parties may use cookies, web beacons, and similar technologies to collect information about your use of our platform and other websites. We do not control these third-party technologies and their use is governed by the privacy policies of these third parties."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Managing Your Cookie Preferences"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"You can control and/or delete cookies as you wish. You can delete all cookies that are already on your device and you can set most browsers to prevent them from being placed. However, if you do this, you may have to manually adjust some preferences every time you visit our platform, and some services and functionalities may not work."}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"You can manage your cookie preferences through your browser settings:"}),(0,We.jsxs)("ul",{children:[(0,We.jsxs)("li",{children:["Chrome: Settings ","->"," Privacy and Security ","->"," Cookies and other site data"]}),(0,We.jsxs)("li",{children:["Firefox: Options ","->"," Privacy & Security ","->"," Cookies and Site Data"]}),(0,We.jsxs)("li",{children:["Safari: Preferences ","->"," Privacy ","->"," Cookies and website data"]}),(0,We.jsxs)("li",{children:["Edge: Settings ","->"," Cookies and site permissions ","->"," Cookies and site data"]})]}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"For more information about cookies and how to disable them, please visit www.allaboutcookies.org"})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Do Not Track"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:'Some browsers have a "Do Not Track" feature that signals to websites that you visit that you do not want to have your online activity tracked. Given the diverse and evolving state of "Do Not Track" implementations, we may or may not respond to "Do Not Track" signals.'})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Changes to Our Cookie Policy"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We may update our Cookie Policy from time to time. Any changes will be posted on this page with an updated revision date. We encourage you to review this Cookie Policy periodically to stay informed about our use of cookies."})]}),(0,We.jsxs)(Je,{sx:{mt:4},children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Contact Us"}),(0,We.jsxs)(mA,{variant:"body1",paragraph:!0,children:["If you have any questions about our use of cookies, please contact us at:",(0,We.jsx)("br",{}),"Email: privacy@sideeye.com"]})]})]})}),sG=()=>{const e=Q(),{currentUser:n,user:r,loading:i,sendEmailVerification:o,forceCheckEmailVerification:s}=(X(),ZT()),[a,c]=(0,t.useState)(!1),[l,u]=(0,t.useState)(null),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),[m,g]=(0,t.useState)(null);(0,t.useEffect)((()=>{(async()=>{if(!i&&(n||r)){const i=n||r;try{const t=await s(i);console.log("Email verification status on page load:",t),t&&(console.log("User email is verified, redirecting to setup source code..."),e("/setup-source-code",{replace:!0}))}catch(t){console.error("Error checking verification status:",t)}}})()}),[n,r,i,e,s]);const v=async()=>{if(!(n||r))return u("Not logged in. Cannot resend verification email."),void e("/login");try{c(!0),u(null),h(!1),await o(),h(!0),u(null)}catch(l){console.error("Error sending verification email:",l),u(l.message||"Failed to send verification email. Please try again."),h(!1)}finally{c(!1)}};if(i)return(0,We.jsx)(sP,{maxWidth:"sm",children:(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:8},children:(0,We.jsx)(FN,{})})});const y=n||r,_=(null===y||void 0===y?void 0:y.email)||"your registered email";return(0,We.jsx)(sP,{maxWidth:"sm",children:(0,We.jsxs)(kC,{elevation:0,sx:{mt:8,p:4},children:[(0,We.jsx)(mA,{variant:"h4",gutterBottom:!0,align:"center",children:"Verify Your Email"}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,align:"center",children:"A verification email has been sent to:"}),(0,We.jsx)(mA,{variant:"h6",align:"center",gutterBottom:!0,sx:{fontWeight:"bold"},children:_}),(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",paragraph:!0,align:"center",children:"Please check your inbox (and spam folder) and click the verification link."}),l&&(0,We.jsx)($D,{severity:"error",sx:{mb:2},children:l}),d&&(0,We.jsx)($D,{severity:"success",sx:{mb:2},children:"Verification email sent! Please check your inbox (and spam folder)."}),m&&!l&&(0,We.jsxs)($D,{severity:"info",sx:{mb:2},children:["Verification status checked at ",m.toLocaleTimeString(),". Email is not yet verified."]}),(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:2,mt:3},children:[(0,We.jsx)(RR,{variant:"outlined",onClick:async()=>{const t=n||r;if(!t)return u("Not logged in. Cannot check verification status."),void e("/login");try{f(!0),u(null);const n=await s(t);g(new Date),console.log("Manual verification check result:",n),n?e("/setup-source-code",{replace:!0}):u("Email not verified yet. Please check your email and click the verification link.")}catch(l){console.error("Error checking verification status:",l),u(l.message||"Failed to check verification status. Please try again.")}finally{f(!1)}},disabled:a||p,color:"primary",fullWidth:!0,children:p?(0,We.jsx)(FN,{size:24,color:"inherit"}):"I've Verified My Email"}),(0,We.jsx)(RR,{variant:"text",onClick:v,disabled:a||p,color:"secondary",fullWidth:!0,children:a?(0,We.jsx)(FN,{size:24,color:"inherit"}):"Resend Verification Email"})]}),(0,We.jsx)(Ux,{sx:{my:3}}),(0,We.jsxs)(mA,{variant:"body2",color:"text.secondary",align:"center",children:["Having trouble? Try ",(0,We.jsx)(gL,{component:"button",onClick:v,children:"sending the email again"})," or ",(0,We.jsx)(gL,{component:"button",onClick:()=>e("/login"),children:"login with a different account"}),"."]})]})})};var aG=n(5433),cG=n(7813);const lG=()=>{const{currentUser:e}=ZT(),[n,r]=(0,t.useState)([]),[i,o]=(0,t.useState)(!0),[s,a]=(0,t.useState)(null),[c,l]=(0,t.useState)(null),[u,d]=(0,t.useState)(null);(0,t.useEffect)((()=>{e&&h()}),[e]);const h=async()=>{if(e)try{const t=Gg(Zm(KS,"deleted_posts"),Kg("userId","==",e.uid)),n=(await hv(t)).docs.map((e=>{var t,n;return{id:e.id,...e.data(),deletedAt:null===(t=e.data().deletedAt)||void 0===t?void 0:t.toDate(),scheduledForDeletion:null===(n=e.data().scheduledForDeletion)||void 0===n?void 0:n.toDate()}}));r(n)}catch(u){console.error("Error fetching deleted posts:",u),d("Failed to fetch deleted posts")}finally{o(!1)}};return i?(0,We.jsx)(Je,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,We.jsx)(FN,{})}):0===n.length?(0,We.jsx)(mA,{sx:{mt:4,textAlign:"center"},children:"No deleted posts found"}):(0,We.jsx)(Je,{sx:{mt:4},children:n.map((t=>(0,We.jsxs)(kC,{sx:{p:2,mb:2,borderRadius:2},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,We.jsx)(cA,{src:t.authorAvatar,alt:t.authorName||"Anonymous",sx:{mr:2},children:t.authorName?t.authorName.charAt(0):"A"}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle1",fontWeight:"bold",children:t.authorName||"Anonymous"}),(0,We.jsxs)(mA,{variant:"caption",color:"text.secondary",children:["Deleted ",vD(t.deletedAt)," ago"]})]})]}),(0,We.jsx)(mA,{sx:{mb:2},children:t.content}),t.imageUrl&&(0,We.jsx)(Je,{component:"img",src:t.imageUrl,alt:"Post content",sx:{maxWidth:"100%",maxHeight:300,borderRadius:1,mb:2}}),t.tags&&t.tags.length>0&&(0,We.jsx)(Je,{sx:{mb:2},children:t.tags.map((e=>(0,We.jsx)(rV,{label:`#${e}`,size:"small",sx:{mr:1,mb:1}},e)))}),(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[(0,We.jsx)(RR,{variant:"outlined",startIcon:(0,We.jsx)(aG.A,{}),onClick:()=>(async t=>{if(e){a(t);try{const n=eg(KS,"deleted_posts",t),i=(await uv(n)).data();if(!i)throw new Error("Post not found");const o=eg(KS,"posts",t);await fv(o,{...i,deletedAt:null,scheduledForDeletion:null}),await mv(n),await fv(eg(KS,"users",e.uid),{postCount:xv(1)}),r((e=>e.filter((e=>e.id!==t))))}catch(u){console.error("Error restoring post:",u)}finally{a(null)}}})(t.id),disabled:!!s,children:s===t.id?(0,We.jsx)(FN,{size:24}):"Restore"}),(0,We.jsx)(RR,{variant:"outlined",color:"error",startIcon:(0,We.jsx)(cG.A,{}),onClick:()=>(async t=>{if(e){l(t);try{const e=eg(KS,"deleted_posts",t);await mv(e),r((e=>e.filter((e=>e.id!==t))))}catch(u){console.error("Error permanently deleting post:",u),d("Failed to permanently delete post")}finally{l(null)}}})(t.id),disabled:!!c,children:c===t.id?(0,We.jsx)(FN,{size:24}):"Delete Forever"})]})]},t.id)))})},uG=()=>(0,We.jsx)(sP,{maxWidth:"md",children:(0,We.jsxs)(Je,{sx:{py:4},children:[(0,We.jsx)(mA,{variant:"h4",sx:{mb:4},children:"Trash"}),(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Posts in the trash will be automatically deleted after 24 hours. You can restore them before then."}),(0,We.jsx)(lG,{})]})}),dG=()=>{const{userId:e}=Z(),{db:n}=WP(),[r,i]=(0,t.useState)([]),[o,s]=(0,t.useState)(!0),[a,c]=(0,t.useState)(null),{currentUser:l}=ZT();return(0,t.useEffect)((()=>{(async()=>{if(n&&e){console.log("Firestore database initialized:",n),console.log("User ID:",e);try{const t=await uv(eg(n,"users",e));if(!t.exists())return void c("User not found");const r=t.data().isPrivate||!1;if(!(!r||l&&l.uid===e))return void c("This account is private. Follow to see their followers.");const o=Zm(n,"users",e,"followers"),s=await hv(o);console.log("Followers snapshot size:",s.size);const a=s.docs.map((async e=>{const t=e.id,r=await uv(eg(n,"users",t));if(r.exists()){return{...r.data(),id:t}}return null})),u=await Promise.all(a);i(u.filter(Boolean))}catch(t){c("Failed to fetch followers"),console.error("Error fetching followers:",t)}finally{s(!1)}}else console.error("Firestore database or userId is not initialized")})()}),[n,e,l]),o?(0,We.jsx)(Je,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,We.jsx)(FN,{})}):a?(0,We.jsx)(Je,{p:3,children:(0,We.jsx)(mA,{color:"error",children:a})}):(0,We.jsxs)(Je,{p:3,children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Followers"}),(0,We.jsxs)(DR,{children:[r.map((e=>(0,We.jsxs)(sO,{component:Ie,to:`/profile/${e.id}`,sx:{textDecoration:"none",color:"inherit","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.profilePic,alt:e.username})}),(0,We.jsx)(Px,{primary:e.username,secondary:e.name})]},e.id))),0===r.length&&(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",children:"No followers yet"})]})]})},hG=()=>{const{userId:e}=Z(),{db:n}=WP(),[r,i]=(0,t.useState)([]),[o,s]=(0,t.useState)(!0),[a,c]=(0,t.useState)(null);return(0,t.useEffect)((()=>{(async()=>{if(n&&e)try{const t=Zm(n,"users",e,"following"),r=await hv(t);console.log("Following snapshot size:",r.size);const o=r.docs.map((async e=>{const t=e.id,r=await uv(eg(n,"users",t));if(r.exists()){return{...r.data(),id:t}}return null})),s=await Promise.all(o);i(s.filter(Boolean))}catch(t){c("Failed to fetch following"),console.error("Error fetching following:",t)}finally{s(!1)}})()}),[n,e]),o?(0,We.jsx)(Je,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,We.jsx)(FN,{})}):a?(0,We.jsx)(Je,{p:3,children:(0,We.jsx)(mA,{color:"error",children:a})}):(0,We.jsxs)(Je,{p:3,children:[(0,We.jsx)(mA,{variant:"h5",gutterBottom:!0,children:"Following"}),(0,We.jsxs)(DR,{children:[r.map((e=>(0,We.jsxs)(sO,{component:Ie,to:`/profile/${e.id}`,sx:{textDecoration:"none",color:"inherit","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[(0,We.jsx)(dO,{children:(0,We.jsx)(cA,{src:e.profilePic,alt:e.username})}),(0,We.jsx)(Px,{primary:e.username,secondary:e.name})]},e.id))),0===r.length&&(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",children:"Not following anyone yet"})]})]})};function pG(e){return(0,AC.Ay)("MuiDialogContentText",e)}(0,Ke.A)("MuiDialogContentText",["root"]);const fG=["children","className"],mG=(0,wC.Ay)(mA,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),gG=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiDialogContentText"}),{className:r}=n,i=(0,Ne.A)(n,fG),o=(e=>{const{classes:t}=e,n=(0,bC.A)({root:["root"]},pG,t);return(0,ke.A)({},t,n)})(i);return(0,We.jsx)(mG,(0,ke.A)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:i,className:(0,Pe.A)(o.root,r)},n,{classes:o}))})),vG=gG,yG=(0,zC.A)([(0,We.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,We.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber"),_G=(0,zC.A)((0,We.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),EG=(0,zC.A)((0,We.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),bG=()=>{const{currentUser:e,logout:n}=ZT(),r=Q(),[i,o]=(0,t.useState)(!1),[s,a]=(0,t.useState)(!1),[c,l]=(0,t.useState)(!1),[u,d]=(0,t.useState)(""),[h,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(null);return(0,We.jsxs)(sP,{maxWidth:"md",sx:{py:4},children:[(0,We.jsxs)(kC,{elevation:3,sx:{p:4},children:[(0,We.jsxs)(mA,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,We.jsx)(yG,{color:"warning"})," Account Management"]}),(0,We.jsx)($D,{severity:"info",sx:{mt:2,mb:4},children:"You have the right to control your data. You can deactivate your account temporarily or delete it permanently."}),f&&(0,We.jsx)($D,{severity:"error",sx:{mt:2,mb:2},children:f}),(0,We.jsxs)(Je,{sx:{mb:5},children:[(0,We.jsxs)(mA,{variant:"h5",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium",display:"flex",alignItems:"center",gap:1},children:[(0,We.jsx)(_G,{})," Deactivate Account"]}),(0,We.jsx)(Ux,{sx:{mb:3}}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Deactivating your account will temporarily hide your profile, posts, and comments from other users. Your account will remain in our systems, and you can reactivate it at any time by simply logging in again."}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:(0,We.jsx)("strong",{children:"What happens when you deactivate:"})}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Your profile becomes hidden from other users"}),(0,We.jsx)("li",{children:"Your posts and comments are hidden but not deleted"}),(0,We.jsx)("li",{children:"You won't receive notifications"}),(0,We.jsx)("li",{children:"You can reactivate by logging in at any time"})]}),(0,We.jsx)(RR,{variant:"outlined",color:"warning",startIcon:(0,We.jsx)(_G,{}),onClick:()=>o(!0),sx:{mt:2},disabled:h,children:"Deactivate Account"})]}),(0,We.jsxs)(Je,{children:[(0,We.jsxs)(mA,{variant:"h5",gutterBottom:!0,sx:{color:"error.main",fontWeight:"medium",display:"flex",alignItems:"center",gap:1},children:[(0,We.jsx)(EG,{})," Delete Account Permanently"]}),(0,We.jsx)(Ux,{sx:{mb:3}}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"Deleting your account is permanent. All your data will be wiped from our systems and cannot be recovered."}),(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:(0,We.jsx)("strong",{children:"What happens when you delete your account:"})}),(0,We.jsxs)("ul",{children:[(0,We.jsx)("li",{children:"Your profile, posts, comments, and all other data are permanently deleted"}),(0,We.jsx)("li",{children:"You will lose access to your account history and connections"}),(0,We.jsx)("li",{children:"This action cannot be undone"}),(0,We.jsx)("li",{children:"If you want to use SideEye again, you'll need to create a new account"})]}),(0,We.jsx)(RR,{variant:"contained",color:"error",startIcon:(0,We.jsx)(EG,{}),onClick:()=>a(!0),sx:{mt:2},disabled:h,children:"Delete Account Permanently"})]})]}),(0,We.jsxs)(wO,{open:i,onClose:()=>o(!1),children:[(0,We.jsx)(UB,{children:"Confirm Account Deactivation"}),(0,We.jsx)(SB,{children:(0,We.jsx)(vG,{children:"Are you sure you want to deactivate your account? Your profile and content will be hidden until you log in again."})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>o(!1),disabled:h,children:"Cancel"}),(0,We.jsx)(RR,{onClick:async()=>{if(e){p(!0),m(null);try{const t=eg(KS,"users",e.uid);await fv(t,{isActive:!1,deactivatedAt:(new Date).toISOString()}),await n(),bT.success("Your account has been deactivated. You can reactivate it by logging in again."),r("/login")}catch(t){console.error("Error deactivating account:",t),m("Failed to deactivate account. Please try again.")}finally{p(!1),o(!1)}}else m("You must be logged in to deactivate your account")},color:"warning",disabled:h,startIcon:h?(0,We.jsx)(FN,{size:20}):null,children:h?"Deactivating...":"Deactivate Account"})]})]}),(0,We.jsxs)(wO,{open:s,onClose:()=>a(!1),children:[(0,We.jsx)(UB,{children:"Delete Account"}),(0,We.jsxs)(SB,{children:[(0,We.jsx)(vG,{sx:{mb:2},children:"To confirm account deletion, please enter your password. This will permanently delete your account and all associated data."}),(0,We.jsx)(CN,{autoFocus:!0,margin:"dense",label:"Password",type:"password",fullWidth:!0,value:u,onChange:e=>d(e.target.value),variant:"outlined"})]}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>a(!1),disabled:h,children:"Cancel"}),(0,We.jsx)(RR,{onClick:()=>l(!0),color:"error",disabled:h||!u,children:"Proceed"})]})]}),(0,We.jsxs)(wO,{open:c,onClose:()=>l(!1),children:[(0,We.jsxs)(UB,{children:[(0,We.jsx)(yG,{color:"error"})," Final Warning"]}),(0,We.jsx)(SB,{children:(0,We.jsxs)(vG,{children:[(0,We.jsx)("strong",{children:"This action cannot be undone."})," Your account and all your data will be permanently deleted from our servers. Are you absolutely sure you want to proceed?"]})}),(0,We.jsxs)(qU,{children:[(0,We.jsx)(RR,{onClick:()=>l(!1),disabled:h,children:"No, Keep My Account"}),(0,We.jsx)(RR,{onClick:async()=>{if(e)if(u){p(!0),m(null);try{const t=_o.credential(e.email||"",u);await Lo(e,t);const n=eg(KS,"users",e.uid);await mv(n),await async function(e){return Zt(e).delete()}(e),bT.success("Your account has been permanently deleted."),r("/login")}catch(t){console.error("Error deleting account:",t),"auth/wrong-password"===t.code?m("Incorrect password. Please try again."):m("Failed to delete account. Please try again.")}finally{p(!1),l(!1),a(!1)}}else m("Please enter your password to confirm deletion");else m("You must be logged in to delete your account")},color:"error",disabled:h,startIcon:h?(0,We.jsx)(FN,{size:20}):(0,We.jsx)(EG,{}),children:h?"Deleting...":"Yes, Delete Permanently"})]})]})]})},wG=e=>{let{message:t="Loading..."}=e;return(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",p:3,textAlign:"center"},children:[(0,We.jsx)(FN,{size:60,thickness:4}),(0,We.jsx)(mA,{variant:"h6",sx:{mt:2},children:t})]})},SG=e=>{let{children:t,requireAuth:n=!0,requireEmailVerification:r=!0,requireDeviceSetup:i=!0}=e;const{currentUser:o,userProfile:s,loading:a}=ZT();return a?(0,We.jsx)(wG,{message:"Checking authentication..."}):n&&!o?(0,We.jsx)(fe,{to:"/login",replace:!0}):r&&o&&!o.emailVerified?(0,We.jsx)(fe,{to:"/verify-email",replace:!0}):i&&o&&s&&!s.sourceCodeSetupComplete?(0,We.jsx)(fe,{to:"/setup-source-code",replace:!0}):(0,We.jsx)(We.Fragment,{children:t})};class TG extends t.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null},this.handleRetry=()=>{this.setState({hasError:!1,error:null})}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t)}render(){var e;return this.state.hasError?(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",p:3,textAlign:"center"},children:[(0,We.jsx)(mA,{variant:"h4",gutterBottom:!0,children:"Oops! Something went wrong"}),(0,We.jsx)(mA,{variant:"body1",color:"text.secondary",paragraph:!0,children:(null===(e=this.state.error)||void 0===e?void 0:e.message)||"An unexpected error occurred"}),(0,We.jsx)(RR,{variant:"contained",color:"primary",onClick:this.handleRetry,sx:{mt:2},children:"Try Again"})]}):this.props.children}}const CG=TG;const AG=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{autoHideDuration:n=null,disableWindowBlurListener:r=!1,onClose:i,open:o,resumeHideDuration:s}=e,a=(0,OA.A)();t.useEffect((()=>{if(o)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)};function e(e){e.defaultPrevented||"Escape"!==e.key&&"Esc"!==e.key||null==i||i(e,"escapeKeyDown")}}),[o,i]);const c=(0,OI.A)(((e,t)=>{null==i||i(e,t)})),l=(0,OI.A)((e=>{i&&null!=e&&a.start(e,(()=>{c(null,"timeout")}))}));t.useEffect((()=>(o&&l(n),a.clear)),[o,n,l,a]);const u=a.clear,d=t.useCallback((()=>{null!=n&&l(null!=s?s:.5*n)}),[n,s,l]),h=e=>t=>{const n=e.onFocus;null==n||n(t),u()},p=e=>t=>{const n=e.onMouseEnter;null==n||n(t),u()},f=e=>t=>{const n=e.onMouseLeave;null==n||n(t),d()};return t.useEffect((()=>{if(!r&&o)return window.addEventListener("focus",d),window.addEventListener("blur",u),()=>{window.removeEventListener("focus",d),window.removeEventListener("blur",u)}}),[r,o,d,u]),{getRootProps:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=(0,ke.A)({},XC(e),XC(t));return(0,ke.A)({role:"presentation"},t,n,{onBlur:(r=n,e=>{const t=r.onBlur;null==t||t(e),d()}),onFocus:h(n),onMouseEnter:p(n),onMouseLeave:f(n)});var r},onClickAway:e=>{null==i||i(e,"clickaway")}}};function RG(e){return e.substring(2).toLowerCase()}function IG(e){const{children:n,disableReactTree:r=!1,mouseEvent:i="onClick",onClickAway:o,touchEvent:s="onTouchEnd"}=e,a=t.useRef(!1),c=t.useRef(null),l=t.useRef(!1),u=t.useRef(!1);t.useEffect((()=>(setTimeout((()=>{l.current=!0}),0),()=>{l.current=!1})),[]);const d=(0,qC.A)(KR(n),c),h=(0,OI.A)((e=>{const t=u.current;u.current=!1;const n=(0,pI.A)(c.current);if(!l.current||!c.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,n))return;if(a.current)return void(a.current=!1);let i;i=e.composedPath?e.composedPath().indexOf(c.current)>-1:!n.documentElement.contains(e.target)||c.current.contains(e.target),i||!r&&t||o(e)})),p=e=>t=>{u.current=!0;const r=n.props[e];r&&r(t)},f={ref:d};return!1!==s&&(f[s]=p(s)),t.useEffect((()=>{if(!1!==s){const e=RG(s),t=(0,pI.A)(c.current),n=()=>{a.current=!0};return t.addEventListener(e,h),t.addEventListener("touchmove",n),()=>{t.removeEventListener(e,h),t.removeEventListener("touchmove",n)}}}),[h,s]),!1!==i&&(f[i]=p(i)),t.useEffect((()=>{if(!1!==i){const e=RG(i),t=(0,pI.A)(c.current);return t.addEventListener(e,h),()=>{t.removeEventListener(e,h)}}}),[h,i]),(0,We.jsx)(t.Fragment,{children:t.cloneElement(n,f)})}function xG(e){return(0,AC.Ay)("MuiSnackbarContent",e)}(0,Ke.A)("MuiSnackbarContent",["root","message","action"]);const OG=["action","className","message","role"],kG=(0,wC.Ay)(kC,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?.8:.98,r=(0,TC.tL)(t.palette.background.default,n);return(0,ke.A)({},t.typography.body2,{color:t.vars?t.vars.palette.SnackbarContent.color:t.palette.getContrastText(r),backgroundColor:t.vars?t.vars.palette.SnackbarContent.bg:r,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,flexGrow:1,[t.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})})),NG=(0,wC.Ay)("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(e,t)=>t.message})({padding:"8px 0"}),PG=(0,wC.Ay)("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(e,t)=>t.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),DG=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiSnackbarContent"}),{action:r,className:i,message:o,role:s="alert"}=n,a=(0,Ne.A)(n,OG),c=n,l=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"],action:["action"],message:["message"]},xG,t)})(c);return(0,We.jsxs)(kG,(0,ke.A)({role:s,square:!0,elevation:6,className:(0,Pe.A)(l.root,i),ownerState:c,ref:t},a,{children:[(0,We.jsx)(NG,{className:l.message,ownerState:c,children:o}),r?(0,We.jsx)(PG,{className:l.action,ownerState:c,children:r}):null]}))})),LG=DG;function MG(e){return(0,AC.Ay)("MuiSnackbar",e)}(0,Ke.A)("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const jG=["onEnter","onExited"],UG=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],VG=(0,wC.Ay)("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`anchorOrigin${(0,SC.A)(n.anchorOrigin.vertical)}${(0,SC.A)(n.anchorOrigin.horizontal)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({zIndex:(t.vars||t).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},"top"===n.anchorOrigin.vertical?{top:8}:{bottom:8},"left"===n.anchorOrigin.horizontal&&{justifyContent:"flex-start"},"right"===n.anchorOrigin.horizontal&&{justifyContent:"flex-end"},{[t.breakpoints.up("sm")]:(0,ke.A)({},"top"===n.anchorOrigin.vertical?{top:24}:{bottom:24},"center"===n.anchorOrigin.horizontal&&{left:"50%",right:"auto",transform:"translateX(-50%)"},"left"===n.anchorOrigin.horizontal&&{left:24,right:"auto"},"right"===n.anchorOrigin.horizontal&&{right:24,left:"auto"})})})),FG=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiSnackbar"}),i=iI(),o={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{action:s,anchorOrigin:{vertical:a,horizontal:c}={vertical:"bottom",horizontal:"left"},autoHideDuration:l=null,children:u,className:d,ClickAwayListenerProps:h,ContentProps:p,disableWindowBlurListener:f=!1,message:m,open:g,TransitionComponent:v=hI,transitionDuration:y=o,TransitionProps:{onEnter:_,onExited:E}={}}=r,b=(0,Ne.A)(r.TransitionProps,jG),w=(0,Ne.A)(r,UG),S=(0,ke.A)({},r,{anchorOrigin:{vertical:a,horizontal:c},autoHideDuration:l,disableWindowBlurListener:f,TransitionComponent:v,transitionDuration:y}),T=(e=>{const{classes:t,anchorOrigin:n}=e,r={root:["root",`anchorOrigin${(0,SC.A)(n.vertical)}${(0,SC.A)(n.horizontal)}`]};return(0,bC.A)(r,MG,t)})(S),{getRootProps:C,onClickAway:A}=AG((0,ke.A)({},S)),[R,I]=t.useState(!0),x=sR({elementType:VG,getSlotProps:C,externalForwardedProps:w,ownerState:S,additionalProps:{ref:n},className:[T.root,d]});return!g&&R?null:(0,We.jsx)(IG,(0,ke.A)({onClickAway:A},h,{children:(0,We.jsx)(VG,(0,ke.A)({},x,{children:(0,We.jsx)(v,(0,ke.A)({appear:!0,in:g,timeout:y,direction:"top"===a?"down":"up",onEnter:(e,t)=>{I(!1),_&&_(e,t)},onExited:e=>{I(!0),E&&E(e)}},b,{children:u||(0,We.jsx)(LG,(0,ke.A)({message:m,action:s},p))}))}))}))})),BG=FG,WG=e=>{let{children:n,maxRequests:r=10,timeWindow:i=6e4}=e;const[o,s]=(0,t.useState)(null),a=(0,t.useRef)(0),c=(0,t.useRef)(Date.now()),l=(0,t.useCallback)((()=>{const e=Date.now();return e-c.current>=i&&(a.current=0,c.current=e),a.current>=r?(s(`Rate limit exceeded. Please try again in ${Math.ceil((i-(e-c.current))/1e3)} seconds.`),!1):(a.current++,!0)}),[r,i]),u=()=>{s(null)};return(0,We.jsxs)(We.Fragment,{children:[t.Children.map(n,(e=>t.isValidElement(e)?t.cloneElement(e,{checkRateLimit:l}):e)),(0,We.jsx)(BG,{open:!!o,autoHideDuration:6e3,onClose:u,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,We.jsx)($D,{onClose:u,severity:"error",sx:{width:"100%"},children:o})})]})},zG=()=>{const{notifications:e,unreadCount:n,markAllAsRead:r,markAsRead:i,deleteNotification:o,loading:s}=iC(),{currentUser:a}=ZT(),c=Q();(0,t.useEffect)((()=>{}),[n]);return s?(0,We.jsx)(sP,{maxWidth:"sm",sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:(0,We.jsx)(FN,{})}):(0,We.jsxs)(sP,{maxWidth:"sm",sx:{mt:4,mb:4},children:[(0,We.jsxs)(Je,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,We.jsx)(mA,{variant:"h5",component:"h1",children:"Notifications"}),e.length>0&&n>0&&(0,We.jsx)(mA,{variant:"caption",color:"textSecondary",onClick:()=>{null!==a&&void 0!==a&&a.uid&&r(a.uid)},sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:"Mark all as read"})]}),0===e.length?(0,We.jsx)(mA,{textAlign:"center",color:"textSecondary",children:"No notifications yet."}):(0,We.jsx)(DR,{sx:{bgcolor:"background.paper",borderRadius:2},children:e.map(((n,r)=>{return(0,We.jsxs)(t.Fragment,{children:[(0,We.jsxs)(sO,{alignItems:"flex-start",onClick:()=>(e=>{e.isRead||i(e.id);let t="/notifications";switch(e.type){case"like":case"comment":case"mention":case"repost":e.postId&&(t=`/post/${e.postId}`);break;case"vibit_like":case"vibit_comment":case"vibit_mention":e.postId&&(t=`/vibit/${e.postId}`);break;case"follow":e.senderId&&(t=`/profile/${e.senderId}`);break;case"room_invite":case"room_invitation":case"room_removal":e.roomId&&(t=`/side-room/${e.roomId}`);break;default:console.warn(`Unhandled notification type for navigation: ${e.type}`)}console.log(`Navigating to: ${t} for notification type: ${e.type}`),c(t)})(n),sx:{cursor:"pointer",backgroundColor:n.isRead?"transparent":"action.hover","&:hover":{backgroundColor:"action.selected"}},secondaryAction:(0,We.jsx)(rR,{edge:"end","aria-label":"delete",onClick:e=>{return t=e,r=n.id,t.stopPropagation(),void o(r);var t,r},children:(0,We.jsx)(EW,{fontSize:"small"})}),children:[(0,We.jsx)(dO,{sx:{mr:1},children:(0,We.jsx)(Ie,{to:`/profile/${n.senderId}`,onClick:e=>e.stopPropagation(),style:{textDecoration:"none"},children:(0,We.jsx)(cA,{alt:n.senderName||"User",src:n.senderAvatar||void 0,sx:{bgcolor:n.senderAvatar?void 0:"primary.main",width:40,height:40},children:!n.senderAvatar&&n.senderName?n.senderName.charAt(0).toUpperCase():null})})}),(0,We.jsx)(Px,{primary:(0,We.jsx)(mA,{component:"span",variant:"body2",color:"text.primary",children:n.content||"Notification content missing."}),secondary:(0,We.jsx)(mA,{component:"span",variant:"caption",color:"text.secondary",children:(s=n.createdAt,s&&s instanceof Date&&!isNaN(s.getTime())?vD(s,{addSuffix:!0}):"Invalid date")})})]}),r<e.length-1&&(0,We.jsx)(Ux,{variant:"inset",component:"li"})]},n.id);var s}))})]})},HG={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let GG;const qG=new Uint8Array(16);function KG(){if(!GG&&(GG="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!GG))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return GG(qG)}const $G=[];for(let n=0;n<256;++n)$G.push((n+256).toString(16).slice(1));function YG(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return $G[e[t+0]]+$G[e[t+1]]+$G[e[t+2]]+$G[e[t+3]]+"-"+$G[e[t+4]]+$G[e[t+5]]+"-"+$G[e[t+6]]+$G[e[t+7]]+"-"+$G[e[t+8]]+$G[e[t+9]]+"-"+$G[e[t+10]]+$G[e[t+11]]+$G[e[t+12]]+$G[e[t+13]]+$G[e[t+14]]+$G[e[t+15]]}const XG=function(e,t,n){if(HG.randomUUID&&!t&&!e)return HG.randomUUID();const r=(e=e||{}).random||(e.rng||KG)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return YG(r)},JG=()=>{const{currentUser:e,user:n,loading:r,userProfile:i}=ZT(),o=Q(),[s,a]=(0,t.useState)(""),[c,l]=(0,t.useState)(""),[u,d]=(0,t.useState)(null),[h,p]=(0,t.useState)(null),[f,m]=(0,t.useState)(!1),[g,v]=(0,t.useState)("");(0,t.useEffect)((()=>{(async()=>{try{let t="";try{t=localStorage.getItem("deviceId")||""}catch(JS){console.log("localStorage access blocked, generating new device ID")}if(!t){t=XG();try{localStorage.setItem("deviceId",t)}catch(JS){console.log("Failed to store device ID in localStorage")}}if(v(t),r)return;if(!(e||n))return void o("/login");null!==i&&void 0!==i&&i.sourceCodeSetupComplete&&o("/")}catch(t){console.error("Device initialization error:",t),d("Failed to initialize device")}})()}),[e,n,r,o,i]);return r?(0,We.jsx)(sP,{maxWidth:"sm",children:(0,We.jsx)(Je,{display:"flex",justifyContent:"center",mt:8,children:(0,We.jsx)(FN,{})})}):(0,We.jsx)(sP,{maxWidth:"xs",children:(0,We.jsxs)(kC,{elevation:3,sx:{mt:8,p:4},children:[(0,We.jsx)(mA,{variant:"h5",align:"center",gutterBottom:!0,children:"Device Registration"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",align:"center",paragraph:!0,children:g?`Device ID: ${g.slice(0,8)}...`:"Generating device ID..."}),u&&(0,We.jsx)($D,{severity:"error",sx:{mb:2},children:u}),h&&(0,We.jsx)($D,{severity:"success",sx:{mb:2},children:h}),(0,We.jsxs)(Je,{component:"form",onSubmit:async t=>{if(t.preventDefault(),!(/^\d{8}$/.test(s)?s===c||(d("Codes do not match"),0):(d("Source code must be exactly 8 digits"),0)))return;if(!g)return void d("Device identification failed. Please refresh the page.");const r=e||n;if(r&&KS){m(!0),d(null);try{const e=XT().genSaltSync(10),t=XT().hashSync(s,e);if(!g||"string"!==typeof g)throw new Error("Invalid device ID");const n=eg(KS,"users",r.uid);await fv(n,{sourceCodeHash:t,sourceCodeSetupComplete:!0,registeredDevices:Rv(g),lastUpdated:Av()});const i=await uv(n);if(!i.exists()||!i.data().sourceCodeSetupComplete)throw new Error("Failed to update source code settings");localStorage.setItem("deviceId",g),p("Device registration successful! Redirecting..."),setTimeout((()=>o("/")),1500)}catch(i){console.error("Setup error:",i),d("permission-denied"===i.code?"Permission denied. Please contact support.":i.message.includes("device")?"Device registration failed. Please try again.":"Setup failed. Please try again.")}finally{m(!1)}}else d("Authentication error")},sx:{mt:2},children:[(0,We.jsx)(CN,{fullWidth:!0,margin:"normal",label:"8-Digit Security Code",value:s,type:"password",onChange:e=>a(e.target.value.replace(/\D/g,"").slice(0,8)),inputProps:{maxLength:8,inputMode:"numeric",pattern:"[0-9]*"},required:!0}),(0,We.jsx)(CN,{fullWidth:!0,margin:"normal",label:"Confirm Security Code",value:c,type:"password",onChange:e=>l(e.target.value.replace(/\D/g,"").slice(0,8)),inputProps:{maxLength:8,inputMode:"numeric",pattern:"[0-9]*"},required:!0}),(0,We.jsx)(RR,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3},disabled:f||!g,children:f?(0,We.jsx)(FN,{size:24}):"Register This Device"})]})]})})},QG=()=>{const{verifySourceCodeAndCompleteLogin:e,loading:n,error:r,setError:i,tempUserForSourceCode:o,currentUser:s}=ZT(),a=Q(),[c,l]=(0,t.useState)("");(0,t.useEffect)((()=>{if(!s&&!o&&!n)return console.log("No temporary or current user found, redirecting to login."),void a("/login",{replace:!0});i(null)}),[s,o,a,n,i]);return(0,We.jsx)(sP,{maxWidth:"xs",children:(0,We.jsxs)(kC,{elevation:0,sx:{mt:8,p:4},children:[(0,We.jsx)(mA,{variant:"h5",component:"h1",gutterBottom:!0,align:"center",children:"Enter Source Code"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",align:"center",paragraph:!0,children:"Enter your 8-digit source code to complete login."}),(0,We.jsxs)(Je,{component:"form",onSubmit:async t=>{t.preventDefault(),i(null),/^[0-9]{8}$/.test(c)?await e(c):i("Source code must be exactly 8 digits.")},noValidate:!0,sx:{mt:1},children:[(0,We.jsx)(CN,{margin:"normal",required:!0,fullWidth:!0,id:"source-code",label:"8-Digit Source Code",name:"source-code",type:"password",inputProps:{maxLength:8,pattern:"[0-9]*",inputMode:"numeric"},value:c,onChange:e=>l(e.target.value.replace(/\\D/g,"").slice(0,8)),autoFocus:!0}),r&&(0,We.jsx)($D,{severity:"error",sx:{mt:2},children:r}),(0,We.jsx)(RR,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:n,children:n?(0,We.jsx)(FN,{size:24}):"Verify Code"}),(0,We.jsx)(Je,{textAlign:"center",children:(0,We.jsx)(gL,{component:Ie,to:"/reset-source-code",variant:"body2",sx:{mt:1},children:"Forgot Source Code?"})})]})]})})},ZG=()=>{Q();const[e,n]=(0,t.useState)(""),[r,i]=(0,t.useState)(!1),[o,s]=(0,t.useState)(null),[a,c]=(0,t.useState)(null);return(0,We.jsx)(sP,{maxWidth:"xs",children:(0,We.jsxs)(kC,{elevation:0,sx:{mt:8,p:4},children:[(0,We.jsx)(mA,{variant:"h5",component:"h1",gutterBottom:!0,align:"center",children:"Reset Source Code"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",align:"center",paragraph:!0,children:"Enter your account email address to receive a link to reset your 8-digit source code."}),(0,We.jsxs)(Je,{component:"form",onSubmit:async t=>{if(t.preventDefault(),i(!0),s(null),c(null),!e)return s("Email is required."),void i(!1);try{await(async e=>{console.log(`Placeholder: Sending source code reset email to ${e}`),await new Promise((e=>setTimeout(e,1500)))})(e),c("If an account exists for this email, a reset link has been sent. Please check your inbox.")}catch(n){console.error("Error sending source code reset email:",n),s("Failed to send reset email. Please try again later.")}finally{i(!1)}},noValidate:!0,sx:{mt:1},children:[(0,We.jsx)(CN,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:e,onChange:e=>n(e.target.value),autoFocus:!0}),o&&(0,We.jsx)($D,{severity:"error",sx:{mt:2},children:o}),a&&(0,We.jsx)($D,{severity:"success",sx:{mt:2},children:a}),(0,We.jsx)(RR,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:r,children:r?(0,We.jsx)(FN,{size:24}):"Send Reset Link"})]})]})})};function eq(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function tq(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return isNaN(r)?new Date(NaN):r?(n.setDate(n.getDate()+r),n):n}function nq(e,t){KP(2,arguments);var n=$P(e).getTime(),r=eq(t);return new Date(n+r)}function rq(e,t){KP(2,arguments);var n=$P(e),r=eq(t);if(isNaN(r))return new Date(NaN);if(!r)return n;var i=n.getDate(),o=new Date(n.getTime());return o.setMonth(n.getMonth()+r+1,0),i>=o.getDate()?o:(n.setFullYear(o.getFullYear(),o.getMonth(),i),n)}function iq(e,t){return KP(2,arguments),rq(e,12*eq(t))}function oq(e,t){KP(2,arguments);var n=$P(e),r=$P(t),i=YP(n,r),o=Math.abs(function(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return n.getFullYear()-r.getFullYear()}(n,r));n.setFullYear(1584),r.setFullYear(1584);var s=YP(n,r)===-i,a=i*(o-Number(s));return 0===a?0:a}function sq(e){KP(1,arguments);var t=$P(e);return t.setHours(0,0,0,0),t}function aq(e,t){var n=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function cq(e,t){KP(2,arguments);var n=$P(e),r=$P(t),i=aq(n,r),o=Math.abs(function(e,t){KP(2,arguments);var n=sq(e),r=sq(t),i=n.getTime()-fD(n),o=r.getTime()-fD(r);return Math.round((i-o)/864e5)}(n,r));n.setDate(n.getDate()-i*o);var s=i*(o-Number(aq(n,r)===-i));return 0===s?0:s}Math.pow(10,8);var lq=6e4,uq=36e5;function dq(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=GP(),d=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(c=u.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=$P(e),p=h.getDay(),f=6+(p<d?-7:0)-(p-d);return h.setDate(h.getDate()+f),h.setHours(23,59,59,999),h}function hq(e){KP(1,arguments);var t=$P(e),n=t.getFullYear();return t.setFullYear(n+1,0,0),t.setHours(23,59,59,999),t}function pq(e){if(KP(1,arguments),!function(e){return KP(1,arguments),e instanceof Date||"object"===qP(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!==typeof e)return!1;var t=$P(e);return!isNaN(Number(t))}function fq(e,t){return KP(2,arguments),nq(e,-eq(t))}function mq(e){KP(1,arguments);var t=$P(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function gq(e){KP(1,arguments);var t=$P(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=mq(r),o=new Date(0);o.setUTCFullYear(n,0,4),o.setUTCHours(0,0,0,0);var s=mq(o);return t.getTime()>=i.getTime()?n+1:t.getTime()>=s.getTime()?n:n-1}function vq(e){KP(1,arguments);var t=$P(e),n=mq(t).getTime()-function(e){KP(1,arguments);var t=gq(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),mq(n)}(t).getTime();return Math.round(n/6048e5)+1}function yq(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=GP(),d=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(c=u.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=$P(e),p=h.getUTCDay(),f=(p<d?7:0)+p-d;return h.setUTCDate(h.getUTCDate()-f),h.setUTCHours(0,0,0,0),h}function _q(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=$P(e),d=u.getUTCFullYear(),h=GP(),p=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:h.firstWeekContainsDate)&&void 0!==r?r:null===(c=h.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var f=new Date(0);f.setUTCFullYear(d+1,0,p),f.setUTCHours(0,0,0,0);var m=yq(f,t),g=new Date(0);g.setUTCFullYear(d,0,p),g.setUTCHours(0,0,0,0);var v=yq(g,t);return u.getTime()>=m.getTime()?d+1:u.getTime()>=v.getTime()?d:d-1}function Eq(e,t){KP(1,arguments);var n=$P(e),r=yq(n,t).getTime()-function(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=GP(),d=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:u.firstWeekContainsDate)&&void 0!==r?r:null===(c=u.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1),h=_q(e,t),p=new Date(0);return p.setUTCFullYear(h,0,d),p.setUTCHours(0,0,0,0),yq(p,t)}(n,t).getTime();return Math.round(r/6048e5)+1}function bq(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}const wq={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return bq("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):bq(n+1,2)},d:function(e,t){return bq(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return bq(e.getUTCHours()%12||12,t.length)},H:function(e,t){return bq(e.getUTCHours(),t.length)},m:function(e,t){return bq(e.getUTCMinutes(),t.length)},s:function(e,t){return bq(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return bq(Math.floor(r*Math.pow(10,n-3)),t.length)}};var Sq="midnight",Tq="noon",Cq="morning",Aq="afternoon",Rq="evening",Iq="night",xq={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return wq.y(e,t)},Y:function(e,t,n,r){var i=_q(e,r),o=i>0?i:1-i;return"YY"===t?bq(o%100,2):"Yo"===t?n.ordinalNumber(o,{unit:"year"}):bq(o,t.length)},R:function(e,t){return bq(gq(e),t.length)},u:function(e,t){return bq(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return bq(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return bq(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return wq.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return bq(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=Eq(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):bq(i,t.length)},I:function(e,t,n){var r=vq(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):bq(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):wq.d(e,t)},D:function(e,t,n){var r=function(e){KP(1,arguments);var t=$P(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):bq(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),o=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return bq(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),o=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return bq(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return bq(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?Tq:0===i?Sq:i/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?Rq:i>=12?Aq:i>=4?Cq:Iq,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return wq.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):wq.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):bq(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):bq(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):wq.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):wq.s(e,t)},S:function(e,t){return wq.S(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return kq(i);case"XXXX":case"XX":return Nq(i);default:return Nq(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return kq(i);case"xxxx":case"xx":return Nq(i);default:return Nq(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Oq(i,":");default:return"GMT"+Nq(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Oq(i,":");default:return"GMT"+Nq(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return bq(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return bq((r._originalDate||e).getTime(),t.length)}};function Oq(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),o=r%60;if(0===o)return n+String(i);var s=t||"";return n+String(i)+s+bq(o,2)}function kq(e,t){return e%60===0?(e>0?"-":"+")+bq(Math.abs(e)/60,2):Nq(e,t)}function Nq(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+bq(Math.floor(i/60),2)+n+bq(i%60,2)}const Pq=xq;var Dq=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Lq=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Mq={p:Lq,P:function(e,t){var n,r=e.match(/(P+)(p+)?/)||[],i=r[1],o=r[2];if(!o)return Dq(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",Dq(i,t)).replace("{{time}}",Lq(o,t))}};const jq=Mq;var Uq=["D","DD"],Vq=["YY","YYYY"];function Fq(e){return-1!==Uq.indexOf(e)}function Bq(e){return-1!==Vq.indexOf(e)}function Wq(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var zq=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Hq=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Gq=/^'([^]*?)'?$/,qq=/''/g,Kq=/[a-zA-Z]/;function $q(e,t,n){var r,i,o,s,a,c,l,u,d,h,p,f,m,g,v,y,_,E;KP(2,arguments);var b=String(t),w=GP(),S=null!==(r=null!==(i=null===n||void 0===n?void 0:n.locale)&&void 0!==i?i:w.locale)&&void 0!==r?r:hD,T=eq(null!==(o=null!==(s=null!==(a=null!==(c=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==c?c:null===n||void 0===n||null===(l=n.locale)||void 0===l||null===(u=l.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==a?a:w.firstWeekContainsDate)&&void 0!==s?s:null===(d=w.locale)||void 0===d||null===(h=d.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==o?o:1);if(!(T>=1&&T<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var C=eq(null!==(p=null!==(f=null!==(m=null!==(g=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==g?g:null===n||void 0===n||null===(v=n.locale)||void 0===v||null===(y=v.options)||void 0===y?void 0:y.weekStartsOn)&&void 0!==m?m:w.weekStartsOn)&&void 0!==f?f:null===(_=w.locale)||void 0===_||null===(E=_.options)||void 0===E?void 0:E.weekStartsOn)&&void 0!==p?p:0);if(!(C>=0&&C<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!S.localize)throw new RangeError("locale must contain localize property");if(!S.formatLong)throw new RangeError("locale must contain formatLong property");var A=$P(e);if(!pq(A))throw new RangeError("Invalid time value");var R=fq(A,fD(A)),I={firstWeekContainsDate:T,weekStartsOn:C,locale:S,_originalDate:A};return b.match(Hq).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,jq[t])(e,S.formatLong):e})).join("").match(zq).map((function(r){if("''"===r)return"'";var i=r[0];if("'"===i)return function(e){var t=e.match(Gq);if(!t)return e;return t[1].replace(qq,"'")}(r);var o=Pq[i];if(o)return null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||!Bq(r)||Wq(r,t,String(e)),null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!Fq(r)||Wq(r,t,String(e)),o(R,r,S.localize,I);if(i.match(Kq))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return r})).join("")}function Yq(e){KP(1,arguments);var t=$P(e),n=t.getFullYear(),r=t.getMonth(),i=new Date(0);return i.setFullYear(n,r+1,0),i.setHours(0,0,0,0),i.getDate()}function Xq(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=GP(),d=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.weekStartsOn)&&void 0!==i?i:u.weekStartsOn)&&void 0!==r?r:null===(c=u.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=$P(e),p=h.getDay(),f=(p<d?7:0)+p-d;return h.setDate(h.getDate()-f),h.setHours(0,0,0,0),h}function Jq(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=GP(),d=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:u.firstWeekContainsDate)&&void 0!==r?r:null===(c=u.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1),h=function(e,t){var n,r,i,o,s,a,c,l;KP(1,arguments);var u=$P(e),d=u.getFullYear(),h=GP(),p=eq(null!==(n=null!==(r=null!==(i=null!==(o=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==o?o:null===t||void 0===t||null===(s=t.locale)||void 0===s||null===(a=s.options)||void 0===a?void 0:a.firstWeekContainsDate)&&void 0!==i?i:h.firstWeekContainsDate)&&void 0!==r?r:null===(c=h.locale)||void 0===c||null===(l=c.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var f=new Date(0);f.setFullYear(d+1,0,p),f.setHours(0,0,0,0);var m=Xq(f,t),g=new Date(0);g.setFullYear(d,0,p),g.setHours(0,0,0,0);var v=Xq(g,t);return u.getTime()>=m.getTime()?d+1:u.getTime()>=v.getTime()?d:d-1}(e,t),p=new Date(0);return p.setFullYear(h,0,d),p.setHours(0,0,0,0),Xq(p,t)}function Qq(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return n.getTime()>r.getTime()}function Zq(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return n.getTime()<r.getTime()}function eK(e){KP(1,arguments);var t=$P(e);return t.setMinutes(0,0,0),t}function tK(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function nK(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return tK(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tK(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function rK(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&EA(e,t)}function iK(e){return iK=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},iK(e)}function oK(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(oK=function(){return!!e})()}function sK(e){var t=oK();return function(){var n,r=iK(e);if(t){var i=iK(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==qP(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _A(e)}(this,n)}}function aK(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cK(e){var t=function(e,t){if("object"!=qP(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=qP(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==qP(t)?t:t+""}function lK(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,cK(r.key),r)}}function uK(e,t,n){return t&&lK(e.prototype,t),n&&lK(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function dK(e,t,n){return(t=cK(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hK=function(){function e(){aK(this,e),dK(this,"priority",void 0),dK(this,"subPriority",0)}return uK(e,[{key:"validate",value:function(e,t){return!0}}]),e}(),pK=function(e){rK(n,e);var t=sK(n);function n(e,r,i,o,s){var a;return aK(this,n),(a=t.call(this)).value=e,a.validateValue=r,a.setValue=i,a.priority=o,s&&(a.subPriority=s),a}return uK(n,[{key:"validate",value:function(e,t){return this.validateValue(e,this.value,t)}},{key:"set",value:function(e,t,n){return this.setValue(e,t,this.value,n)}}]),n}(hK),fK=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",10),dK(_A(e),"subPriority",-1),e}return uK(n,[{key:"set",value:function(e,t){if(t.timestampIsSet)return e;var n=new Date(0);return n.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),n.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),n}}]),n}(hK),mK=function(){function e(){aK(this,e),dK(this,"incompatibleTokens",void 0),dK(this,"priority",void 0),dK(this,"subPriority",void 0)}return uK(e,[{key:"run",value:function(e,t,n,r){var i=this.parse(e,t,n,r);return i?{setter:new pK(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}},{key:"validate",value:function(e,t,n){return!0}}]),e}(),gK=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",140),dK(_A(e),"incompatibleTokens",["R","u","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}}},{key:"set",value:function(e,t,n){return t.era=n,e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(mK),vK=/^(1[0-2]|0?\d)/,yK=/^(3[0-1]|[0-2]?\d)/,_K=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,EK=/^(5[0-3]|[0-4]?\d)/,bK=/^(2[0-3]|[0-1]?\d)/,wK=/^(2[0-4]|[0-1]?\d)/,SK=/^(1[0-1]|0?\d)/,TK=/^(1[0-2]|0?\d)/,CK=/^[0-5]?\d/,AK=/^[0-5]?\d/,RK=/^\d/,IK=/^\d{1,2}/,xK=/^\d{1,3}/,OK=/^\d{1,4}/,kK=/^-?\d+/,NK=/^-?\d/,PK=/^-?\d{1,2}/,DK=/^-?\d{1,3}/,LK=/^-?\d{1,4}/,MK=/^([+-])(\d{2})(\d{2})?|Z/,jK=/^([+-])(\d{2})(\d{2})|Z/,UK=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,VK=/^([+-])(\d{2}):(\d{2})|Z/,FK=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function BK(e,t){return e?{value:t(e.value),rest:e.rest}:e}function WK(e,t){var n=t.match(e);return n?{value:parseInt(n[0],10),rest:t.slice(n[0].length)}:null}function zK(e,t){var n=t.match(e);if(!n)return null;if("Z"===n[0])return{value:0,rest:t.slice(1)};var r="+"===n[1]?1:-1,i=n[2]?parseInt(n[2],10):0,o=n[3]?parseInt(n[3],10):0,s=n[5]?parseInt(n[5],10):0;return{value:r*(i*uq+o*lq+1e3*s),rest:t.slice(n[0].length)}}function HK(e){return WK(kK,e)}function GK(e,t){switch(e){case 1:return WK(RK,t);case 2:return WK(IK,t);case 3:return WK(xK,t);case 4:return WK(OK,t);default:return WK(new RegExp("^\\d{1,"+e+"}"),t)}}function qK(e,t){switch(e){case 1:return WK(NK,t);case 2:return WK(PK,t);case 3:return WK(DK,t);case 4:return WK(LK,t);default:return WK(new RegExp("^-?\\d{1,"+e+"}"),t)}}function KK(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function $K(e,t){var n,r=t>0,i=r?t:1-t;if(i<=50)n=e||100;else{var o=i+50;n=e+100*Math.floor(o/100)-(e>=o%100?100:0)}return r?n:1-n}function YK(e){return e%400===0||e%4===0&&e%100!==0}var XK=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",130),dK(_A(e),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){var r=function(e){return{year:e,isTwoDigitYear:"yy"===t}};switch(t){case"y":return BK(GK(4,e),r);case"yo":return BK(n.ordinalNumber(e,{unit:"year"}),r);default:return BK(GK(t.length,e),r)}}},{key:"validate",value:function(e,t){return t.isTwoDigitYear||t.year>0}},{key:"set",value:function(e,t,n){var r=e.getUTCFullYear();if(n.isTwoDigitYear){var i=$K(n.year,r);return e.setUTCFullYear(i,0,1),e.setUTCHours(0,0,0,0),e}var o="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(o,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(mK),JK=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",130),dK(_A(e),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){var r=function(e){return{year:e,isTwoDigitYear:"YY"===t}};switch(t){case"Y":return BK(GK(4,e),r);case"Yo":return BK(n.ordinalNumber(e,{unit:"year"}),r);default:return BK(GK(t.length,e),r)}}},{key:"validate",value:function(e,t){return t.isTwoDigitYear||t.year>0}},{key:"set",value:function(e,t,n,r){var i=_q(e,r);if(n.isTwoDigitYear){var o=$K(n.year,i);return e.setUTCFullYear(o,0,r.firstWeekContainsDate),e.setUTCHours(0,0,0,0),yq(e,r)}var s="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(s,0,r.firstWeekContainsDate),e.setUTCHours(0,0,0,0),yq(e,r)}}]),n}(mK),QK=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",130),dK(_A(e),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t){return qK("R"===t?4:t.length,e)}},{key:"set",value:function(e,t,n){var r=new Date(0);return r.setUTCFullYear(n,0,4),r.setUTCHours(0,0,0,0),mq(r)}}]),n}(mK),ZK=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",130),dK(_A(e),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t){return qK("u"===t?4:t.length,e)}},{key:"set",value:function(e,t,n){return e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(mK),e$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",120),dK(_A(e),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"Q":case"QQ":return GK(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=1&&t<=4}},{key:"set",value:function(e,t,n){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e}}]),n}(mK),t$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",120),dK(_A(e),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"q":case"qq":return GK(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=1&&t<=4}},{key:"set",value:function(e,t,n){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e}}]),n}(mK),n$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),dK(_A(e),"priority",110),e}return uK(n,[{key:"parse",value:function(e,t,n){var r=function(e){return e-1};switch(t){case"M":return BK(WK(vK,e),r);case"MM":return BK(GK(2,e),r);case"Mo":return BK(n.ordinalNumber(e,{unit:"month"}),r);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e}}]),n}(mK),r$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",110),dK(_A(e),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){var r=function(e){return e-1};switch(t){case"L":return BK(WK(vK,e),r);case"LL":return BK(GK(2,e),r);case"Lo":return BK(n.ordinalNumber(e,{unit:"month"}),r);case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e}}]),n}(mK);var i$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",100),dK(_A(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"w":return WK(EK,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=53}},{key:"set",value:function(e,t,n,r){return yq(function(e,t,n){KP(2,arguments);var r=$P(e),i=eq(t),o=Eq(r,n)-i;return r.setUTCDate(r.getUTCDate()-7*o),r}(e,n,r),r)}}]),n}(mK);var o$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",100),dK(_A(e),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"I":return WK(EK,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=53}},{key:"set",value:function(e,t,n){return mq(function(e,t){KP(2,arguments);var n=$P(e),r=eq(t),i=vq(n)-r;return n.setUTCDate(n.getUTCDate()-7*i),n}(e,n))}}]),n}(mK),s$=[31,28,31,30,31,30,31,31,30,31,30,31],a$=[31,29,31,30,31,30,31,31,30,31,30,31],c$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",90),dK(_A(e),"subPriority",1),dK(_A(e),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"d":return WK(yK,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){var n=YK(e.getUTCFullYear()),r=e.getUTCMonth();return n?t>=1&&t<=a$[r]:t>=1&&t<=s$[r]}},{key:"set",value:function(e,t,n){return e.setUTCDate(n),e.setUTCHours(0,0,0,0),e}}]),n}(mK),l$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",90),dK(_A(e),"subpriority",1),dK(_A(e),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"D":case"DD":return WK(_K,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return YK(e.getUTCFullYear())?t>=1&&t<=366:t>=1&&t<=365}},{key:"set",value:function(e,t,n){return e.setUTCMonth(0,n),e.setUTCHours(0,0,0,0),e}}]),n}(mK);function u$(e,t,n){var r,i,o,s,a,c,l,u;KP(2,arguments);var d=GP(),h=eq(null!==(r=null!==(i=null!==(o=null!==(s=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==s?s:null===n||void 0===n||null===(a=n.locale)||void 0===a||null===(c=a.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==o?o:d.weekStartsOn)&&void 0!==i?i:null===(l=d.locale)||void 0===l||null===(u=l.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==r?r:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var p=$P(e),f=eq(t),m=((f%7+7)%7<h?7:0)+f-p.getUTCDay();return p.setUTCDate(p.getUTCDate()+m),p}var d$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",90),dK(_A(e),"incompatibleTokens",["D","i","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,r){return(e=u$(e,n,r)).setUTCHours(0,0,0,0),e}}]),n}(mK),h$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",90),dK(_A(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n,r){var i=function(e){var t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return BK(GK(t.length,e),i);case"eo":return BK(n.ordinalNumber(e,{unit:"day"}),i);case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,r){return(e=u$(e,n,r)).setUTCHours(0,0,0,0),e}}]),n}(mK),p$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",90),dK(_A(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n,r){var i=function(e){var t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return BK(GK(t.length,e),i);case"co":return BK(n.ordinalNumber(e,{unit:"day"}),i);case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,r){return(e=u$(e,n,r)).setUTCHours(0,0,0,0),e}}]),n}(mK);var f$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",90),dK(_A(e),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){var r=function(e){return 0===e?7:e};switch(t){case"i":case"ii":return GK(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return BK(n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),r);case"iiiii":return BK(n.day(e,{width:"narrow",context:"formatting"}),r);case"iiiiii":return BK(n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),r);default:return BK(n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),r)}}},{key:"validate",value:function(e,t){return t>=1&&t<=7}},{key:"set",value:function(e,t,n){return e=function(e,t){KP(2,arguments);var n=eq(t);n%7===0&&(n-=7);var r=$P(e),i=((n%7+7)%7<1?7:0)+n-r.getUTCDay();return r.setUTCDate(r.getUTCDate()+i),r}(e,n),e.setUTCHours(0,0,0,0),e}}]),n}(mK),m$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",80),dK(_A(e),"incompatibleTokens",["b","B","H","k","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(KK(n),0,0,0),e}}]),n}(mK),g$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",80),dK(_A(e),"incompatibleTokens",["a","B","H","k","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(KK(n),0,0,0),e}}]),n}(mK),v$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",80),dK(_A(e),"incompatibleTokens",["a","b","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(KK(n),0,0,0),e}}]),n}(mK),y$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",70),dK(_A(e),"incompatibleTokens",["H","K","k","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"h":return WK(TK,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=12}},{key:"set",value:function(e,t,n){var r=e.getUTCHours()>=12;return r&&n<12?e.setUTCHours(n+12,0,0,0):r||12!==n?e.setUTCHours(n,0,0,0):e.setUTCHours(0,0,0,0),e}}]),n}(mK),_$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",70),dK(_A(e),"incompatibleTokens",["a","b","h","K","k","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"H":return WK(bK,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=23}},{key:"set",value:function(e,t,n){return e.setUTCHours(n,0,0,0),e}}]),n}(mK),E$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",70),dK(_A(e),"incompatibleTokens",["h","H","k","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"K":return WK(SK,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.getUTCHours()>=12&&n<12?e.setUTCHours(n+12,0,0,0):e.setUTCHours(n,0,0,0),e}}]),n}(mK),b$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",70),dK(_A(e),"incompatibleTokens",["a","b","h","H","K","t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"k":return WK(wK,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=24}},{key:"set",value:function(e,t,n){var r=n<=24?n%24:n;return e.setUTCHours(r,0,0,0),e}}]),n}(mK),w$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",60),dK(_A(e),"incompatibleTokens",["t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"m":return WK(CK,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=59}},{key:"set",value:function(e,t,n){return e.setUTCMinutes(n,0,0),e}}]),n}(mK),S$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",50),dK(_A(e),"incompatibleTokens",["t","T"]),e}return uK(n,[{key:"parse",value:function(e,t,n){switch(t){case"s":return WK(AK,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return GK(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=59}},{key:"set",value:function(e,t,n){return e.setUTCSeconds(n,0),e}}]),n}(mK),T$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",30),dK(_A(e),"incompatibleTokens",["t","T"]),e}return uK(n,[{key:"parse",value:function(e,t){return BK(GK(t.length,e),(function(e){return Math.floor(e*Math.pow(10,3-t.length))}))}},{key:"set",value:function(e,t,n){return e.setUTCMilliseconds(n),e}}]),n}(mK),C$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",10),dK(_A(e),"incompatibleTokens",["t","T","x"]),e}return uK(n,[{key:"parse",value:function(e,t){switch(t){case"X":return zK(MK,e);case"XX":return zK(jK,e);case"XXXX":return zK(UK,e);case"XXXXX":return zK(FK,e);default:return zK(VK,e)}}},{key:"set",value:function(e,t,n){return t.timestampIsSet?e:new Date(e.getTime()-n)}}]),n}(mK),A$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",10),dK(_A(e),"incompatibleTokens",["t","T","X"]),e}return uK(n,[{key:"parse",value:function(e,t){switch(t){case"x":return zK(MK,e);case"xx":return zK(jK,e);case"xxxx":return zK(UK,e);case"xxxxx":return zK(FK,e);default:return zK(VK,e)}}},{key:"set",value:function(e,t,n){return t.timestampIsSet?e:new Date(e.getTime()-n)}}]),n}(mK),R$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",40),dK(_A(e),"incompatibleTokens","*"),e}return uK(n,[{key:"parse",value:function(e){return HK(e)}},{key:"set",value:function(e,t,n){return[new Date(1e3*n),{timestampIsSet:!0}]}}]),n}(mK),I$=function(e){rK(n,e);var t=sK(n);function n(){var e;aK(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return dK(_A(e=t.call.apply(t,[this].concat(i))),"priority",20),dK(_A(e),"incompatibleTokens","*"),e}return uK(n,[{key:"parse",value:function(e){return HK(e)}},{key:"set",value:function(e,t,n){return[new Date(n),{timestampIsSet:!0}]}}]),n}(mK),x$={G:new gK,y:new XK,Y:new JK,R:new QK,u:new ZK,Q:new e$,q:new t$,M:new n$,L:new r$,w:new i$,I:new o$,d:new c$,D:new l$,E:new d$,e:new h$,c:new p$,i:new f$,a:new m$,b:new g$,B:new v$,h:new y$,H:new _$,K:new E$,k:new b$,m:new w$,s:new S$,S:new T$,X:new C$,x:new A$,t:new R$,T:new I$},O$=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,k$=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,N$=/^'([^]*?)'?$/,P$=/''/g,D$=/\S/,L$=/[a-zA-Z]/;function M$(e,t,n,r){var i,o,s,a,c,l,u,d,h,p,f,m,g,v,y,_,E,b;KP(3,arguments);var w=String(e),S=String(t),T=GP(),C=null!==(i=null!==(o=null===r||void 0===r?void 0:r.locale)&&void 0!==o?o:T.locale)&&void 0!==i?i:hD;if(!C.match)throw new RangeError("locale must contain match property");var A=eq(null!==(s=null!==(a=null!==(c=null!==(l=null===r||void 0===r?void 0:r.firstWeekContainsDate)&&void 0!==l?l:null===r||void 0===r||null===(u=r.locale)||void 0===u||null===(d=u.options)||void 0===d?void 0:d.firstWeekContainsDate)&&void 0!==c?c:T.firstWeekContainsDate)&&void 0!==a?a:null===(h=T.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.firstWeekContainsDate)&&void 0!==s?s:1);if(!(A>=1&&A<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var R=eq(null!==(f=null!==(m=null!==(g=null!==(v=null===r||void 0===r?void 0:r.weekStartsOn)&&void 0!==v?v:null===r||void 0===r||null===(y=r.locale)||void 0===y||null===(_=y.options)||void 0===_?void 0:_.weekStartsOn)&&void 0!==g?g:T.weekStartsOn)&&void 0!==m?m:null===(E=T.locale)||void 0===E||null===(b=E.options)||void 0===b?void 0:b.weekStartsOn)&&void 0!==f?f:0);if(!(R>=0&&R<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===S)return""===w?$P(n):new Date(NaN);var I,x={firstWeekContainsDate:A,weekStartsOn:R,locale:C},O=[new fK],k=S.match(k$).map((function(e){var t=e[0];return t in jq?(0,jq[t])(e,C.formatLong):e})).join("").match(O$),N=[],P=nK(k);try{var D=function(){var t=I.value;null!==r&&void 0!==r&&r.useAdditionalWeekYearTokens||!Bq(t)||Wq(t,S,e),null!==r&&void 0!==r&&r.useAdditionalDayOfYearTokens||!Fq(t)||Wq(t,S,e);var n=t[0],i=x$[n];if(i){var o=i.incompatibleTokens;if(Array.isArray(o)){var s=N.find((function(e){return o.includes(e.token)||e.token===n}));if(s)throw new RangeError("The format string mustn't contain `".concat(s.fullToken,"` and `").concat(t,"` at the same time"))}else if("*"===i.incompatibleTokens&&N.length>0)throw new RangeError("The format string mustn't contain `".concat(t,"` and any other token at the same time"));N.push({token:n,fullToken:t});var a=i.run(w,t,C.match,x);if(!a)return{v:new Date(NaN)};O.push(a.setter),w=a.rest}else{if(n.match(L$))throw new RangeError("Format string contains an unescaped latin alphabet character `"+n+"`");if("''"===t?t="'":"'"===n&&(t=t.match(N$)[1].replace(P$,"'")),0!==w.indexOf(t))return{v:new Date(NaN)};w=w.slice(t.length)}};for(P.s();!(I=P.n()).done;){var L=D();if("object"===qP(L))return L.v}}catch(H){P.e(H)}finally{P.f()}if(w.length>0&&D$.test(w))return new Date(NaN);var M=O.map((function(e){return e.priority})).sort((function(e,t){return t-e})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return O.filter((function(t){return t.priority===e})).sort((function(e,t){return t.subPriority-e.subPriority}))})).map((function(e){return e[0]})),j=$P(n);if(isNaN(j.getTime()))return new Date(NaN);var U,V=fq(j,fD(j)),F={},B=nK(M);try{for(B.s();!(U=B.n()).done;){var W=U.value;if(!W.validate(V,x))return new Date(NaN);var z=W.set(V,F,x);Array.isArray(z)?(V=z[0],pD(F,z[1])):V=z}}catch(H){B.e(H)}finally{B.f()}return V}function j$(e){KP(1,arguments);var t=$P(e);return t.setDate(1),t.setHours(0,0,0,0),t}function U$(e){KP(1,arguments);var t=$P(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function V$(e,t){var n;KP(1,arguments);var r=eq(null!==(n=null===t||void 0===t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==r&&1!==r&&0!==r)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!==typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var i,o=function(e){var t,n={},r=e.split(F$.dateTimeDelimiter);if(r.length>2)return n;/:/.test(r[0])?t=r[0]:(n.date=r[0],t=r[1],F$.timeZoneDelimiter.test(n.date)&&(n.date=e.split(F$.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length)));if(t){var i=F$.timezone.exec(t);i?(n.time=t.replace(i[1],""),n.timezone=i[1]):n.time=t}return n}(e);if(o.date){var s=function(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:NaN,restDateString:""};var i=r[1]?parseInt(r[1]):null,o=r[2]?parseInt(r[2]):null;return{year:null===o?i:100*o,restDateString:e.slice((r[1]||r[2]).length)}}(o.date,r);i=function(e,t){if(null===t)return new Date(NaN);var n=e.match(B$);if(!n)return new Date(NaN);var r=!!n[4],i=H$(n[1]),o=H$(n[2])-1,s=H$(n[3]),a=H$(n[4]),c=H$(n[5])-1;if(r)return function(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}(0,a,c)?function(e,t,n){var r=new Date(0);r.setUTCFullYear(e,0,4);var i=r.getUTCDay()||7,o=7*(t-1)+n+1-i;return r.setUTCDate(r.getUTCDate()+o),r}(t,a,c):new Date(NaN);var l=new Date(0);return function(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(q$[t]||(K$(e)?29:28))}(t,o,s)&&function(e,t){return t>=1&&t<=(K$(e)?366:365)}(t,i)?(l.setUTCFullYear(t,o,Math.max(i,s)),l):new Date(NaN)}(s.restDateString,s.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var a,c=i.getTime(),l=0;if(o.time&&(l=function(e){var t=e.match(W$);if(!t)return NaN;var n=G$(t[1]),r=G$(t[2]),i=G$(t[3]);if(!function(e,t,n){if(24===e)return 0===t&&0===n;return n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}(n,r,i))return NaN;return n*uq+r*lq+1e3*i}(o.time),isNaN(l)))return new Date(NaN);if(!o.timezone){var u=new Date(c+l),d=new Date(0);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return a=function(e){if("Z"===e)return 0;var t=e.match(z$);if(!t)return 0;var n="+"===t[1]?-1:1,r=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,i))return NaN;return n*(r*uq+i*lq)}(o.timezone),isNaN(a)?new Date(NaN):new Date(c+l+a)}var F$={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},B$=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,W$=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,z$=/^([+-])(\d{2})(?::?(\d{2}))?$/;function H$(e){return e?parseInt(e):1}function G$(e){return e&&parseFloat(e.replace(",","."))||0}var q$=[31,null,31,30,31,30,31,31,30,31,30,31];function K$(e){return e%400===0||e%4===0&&e%100!==0}var $$=n(4894),Y$=n.n($$);const X$={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},J$={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",fullDateWithWeekday:"PPPP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",monthAndYear:"LLLL yyyy",monthAndDate:"MMMM d",fullTime:"p",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",fullDateTime:"PP p",fullDateTime12h:"PP hh:mm aa",fullDateTime24h:"PP HH:mm",keyboardDateTime:"P p",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class Q${constructor(e){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib="date-fns",this.locale=void 0,this.formats=void 0,this.formatTokenMap=X$,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=e=>"undefined"===typeof e?new Date:null===e?null:new Date(e),this.dateWithTimezone=e=>this.date(e),this.getTimezone=()=>"default",this.setTimezone=e=>e,this.toJsDate=e=>e,this.getCurrentLocaleCode=()=>{var e;return(null==(e=this.locale)?void 0:e.code)||"en-US"},this.is12HourCycleInCurrentLocale=()=>!this.locale||/a/.test(this.locale.formatLong.time({width:"short"})),this.expandFormat=e=>e.match(/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g).map((e=>{const t=e[0];if("p"===t||"P"===t){return(0,this.longFormatters[t])(e,this.locale.formatLong)}return e})).join(""),this.getFormatHelperText=e=>this.expandFormat(e).replace(/(aaa|aa|a)/g,"(a|p)m").toLocaleLowerCase(),this.isNull=e=>null===e,this.formatNumber=e=>e,this.getMeridiemText=e=>"am"===e?"AM":"PM";const{locale:t,formats:n,longFormatters:r}=e;this.locale=t,this.formats=(0,ke.A)({},J$,n),this.longFormatters=r}}class Z$ extends Q${constructor(){let{locale:e,formats:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({locale:null!=e?e:dD,formats:t,longFormatters:Y$()}),this.parseISO=e=>V$(e),this.toISO=e=>function(e,t){var n,r;KP(1,arguments);var i=$P(e);if(isNaN(i.getTime()))throw new RangeError("Invalid time value");var o=String(null!==(n=null===t||void 0===t?void 0:t.format)&&void 0!==n?n:"extended"),s=String(null!==(r=null===t||void 0===t?void 0:t.representation)&&void 0!==r?r:"complete");if("extended"!==o&&"basic"!==o)throw new RangeError("format must be 'extended' or 'basic'");if("date"!==s&&"time"!==s&&"complete"!==s)throw new RangeError("representation must be 'date', 'time', or 'complete'");var a="",c="",l="extended"===o?"-":"",u="extended"===o?":":"";if("time"!==s){var d=bq(i.getDate(),2),h=bq(i.getMonth()+1,2),p=bq(i.getFullYear(),4);a="".concat(p).concat(l).concat(h).concat(l).concat(d)}if("date"!==s){var f=i.getTimezoneOffset();if(0!==f){var m=Math.abs(f),g=bq(Math.floor(m/60),2),v=bq(m%60,2);c="".concat(f<0?"+":"-").concat(g,":").concat(v)}else c="Z";var y=""===a?"":"T",_=[bq(i.getHours(),2),bq(i.getMinutes(),2),bq(i.getSeconds(),2)].join(u);a="".concat(a).concat(y).concat(_).concat(c)}return a}(e,{format:"extended"}),this.parse=(e,t)=>""===e?null:M$(e,t,new Date,{locale:this.locale}),this.isValid=e=>pq(this.date(e)),this.format=(e,t)=>this.formatByString(e,this.formats[t]),this.formatByString=(e,t)=>$q(e,t,{locale:this.locale}),this.getDiff=(e,t,n)=>{switch(n){case"years":return oq(e,this.date(t));case"quarters":return function(e,t,n){KP(2,arguments);var r=QP(e,t)/3;return tD(null===n||void 0===n?void 0:n.roundingMethod)(r)}(e,this.date(t));case"months":return QP(e,this.date(t));case"weeks":return function(e,t,n){KP(2,arguments);var r=cq(e,t)/7;return tD(null===n||void 0===n?void 0:n.roundingMethod)(r)}(e,this.date(t));case"days":return cq(e,this.date(t));case"hours":return function(e,t,n){KP(2,arguments);var r=ZP(e,t)/uq;return tD(null===n||void 0===n?void 0:n.roundingMethod)(r)}(e,this.date(t));case"minutes":return function(e,t,n){KP(2,arguments);var r=ZP(e,t)/lq;return tD(null===n||void 0===n?void 0:n.roundingMethod)(r)}(e,this.date(t));case"seconds":return nD(e,this.date(t));default:return ZP(e,this.date(t))}},this.isEqual=(e,t)=>null===e&&null===t||function(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return n.getTime()===r.getTime()}(e,t),this.isSameYear=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return n.getFullYear()===r.getFullYear()}(e,t),this.isSameMonth=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=$P(t);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()}(e,t),this.isSameDay=(e,t)=>function(e,t){KP(2,arguments);var n=sq(e),r=sq(t);return n.getTime()===r.getTime()}(e,t),this.isSameHour=(e,t)=>function(e,t){KP(2,arguments);var n=eK(e),r=eK(t);return n.getTime()===r.getTime()}(e,t),this.isAfter=(e,t)=>Qq(e,t),this.isAfterYear=(e,t)=>Qq(e,hq(t)),this.isAfterDay=(e,t)=>Qq(e,XP(t)),this.isBefore=(e,t)=>Zq(e,t),this.isBeforeYear=(e,t)=>Zq(e,U$(t)),this.isBeforeDay=(e,t)=>Zq(e,sq(t)),this.isWithinRange=(e,t)=>{let[n,r]=t;return function(e,t){KP(2,arguments);var n=$P(e).getTime(),r=$P(t.start).getTime(),i=$P(t.end).getTime();if(!(r<=i))throw new RangeError("Invalid interval");return n>=r&&n<=i}(e,{start:n,end:r})},this.startOfYear=e=>U$(e),this.startOfMonth=e=>j$(e),this.startOfWeek=e=>Xq(e,{locale:this.locale}),this.startOfDay=e=>sq(e),this.endOfYear=e=>hq(e),this.endOfMonth=e=>JP(e),this.endOfWeek=e=>dq(e,{locale:this.locale}),this.endOfDay=e=>XP(e),this.addYears=(e,t)=>iq(e,t),this.addMonths=(e,t)=>rq(e,t),this.addWeeks=(e,t)=>function(e,t){return KP(2,arguments),tq(e,7*eq(t))}(e,t),this.addDays=(e,t)=>tq(e,t),this.addHours=(e,t)=>function(e,t){return KP(2,arguments),nq(e,36e5*eq(t))}(e,t),this.addMinutes=(e,t)=>function(e,t){return KP(2,arguments),nq(e,6e4*eq(t))}(e,t),this.addSeconds=(e,t)=>function(e,t){return KP(2,arguments),nq(e,1e3*eq(t))}(e,t),this.getYear=e=>function(e){return KP(1,arguments),$P(e).getFullYear()}(e),this.getMonth=e=>function(e){return KP(1,arguments),$P(e).getMonth()}(e),this.getDate=e=>function(e){return KP(1,arguments),$P(e).getDate()}(e),this.getHours=e=>function(e){return KP(1,arguments),$P(e).getHours()}(e),this.getMinutes=e=>function(e){return KP(1,arguments),$P(e).getMinutes()}(e),this.getSeconds=e=>function(e){return KP(1,arguments),$P(e).getSeconds()}(e),this.getMilliseconds=e=>function(e){return KP(1,arguments),$P(e).getMilliseconds()}(e),this.setYear=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return isNaN(n.getTime())?new Date(NaN):(n.setFullYear(r),n)}(e,t),this.setMonth=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t),i=n.getFullYear(),o=n.getDate(),s=new Date(0);s.setFullYear(i,r,15),s.setHours(0,0,0,0);var a=Yq(s);return n.setMonth(r,Math.min(o,a)),n}(e,t),this.setDate=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return n.setDate(r),n}(e,t),this.setHours=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return n.setHours(r),n}(e,t),this.setMinutes=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return n.setMinutes(r),n}(e,t),this.setSeconds=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return n.setSeconds(r),n}(e,t),this.setMilliseconds=(e,t)=>function(e,t){KP(2,arguments);var n=$P(e),r=eq(t);return n.setMilliseconds(r),n}(e,t),this.getDaysInMonth=e=>Yq(e),this.getNextMonth=e=>rq(e,1),this.getPreviousMonth=e=>rq(e,-1),this.getMonthArray=e=>{const t=[U$(e)];for(;t.length<12;){const e=t[t.length-1];t.push(this.getNextMonth(e))}return t},this.mergeDateAndTime=(e,t)=>this.setSeconds(this.setMinutes(this.setHours(e,this.getHours(t)),this.getMinutes(t)),this.getSeconds(t)),this.getWeekdays=()=>{const e=new Date;return function(e,t){var n;KP(1,arguments);var r=e||{},i=$P(r.start),o=$P(r.end).getTime();if(!(i.getTime()<=o))throw new RangeError("Invalid interval");var s=[],a=i;a.setHours(0,0,0,0);var c=Number(null!==(n=null===t||void 0===t?void 0:t.step)&&void 0!==n?n:1);if(c<1||isNaN(c))throw new RangeError("`options.step` must be a number greater than 1");for(;a.getTime()<=o;)s.push($P(a)),a.setDate(a.getDate()+c),a.setHours(0,0,0,0);return s}({start:Xq(e,{locale:this.locale}),end:dq(e,{locale:this.locale})}).map((e=>this.formatByString(e,"EEEEEE")))},this.getWeekArray=e=>{const t=Xq(j$(e),{locale:this.locale}),n=dq(JP(e),{locale:this.locale});let r=0,i=t;const o=[];for(;Zq(i,n);){const e=Math.floor(r/7);o[e]=o[e]||[],o[e].push(i),i=tq(i,1),r+=1}return o},this.getWeekNumber=e=>function(e,t){KP(1,arguments);var n=$P(e),r=Xq(n,t).getTime()-Jq(n,t).getTime();return Math.round(r/6048e5)+1}(e,{locale:this.locale}),this.getYearRange=(e,t)=>{const n=U$(e),r=hq(t),i=[];let o=n;for(;Zq(o,r);)i.push(o),o=iq(o,1);return i}}}const eY=(0,zC.A)((0,We.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),tY=(0,zC.A)((0,We.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),nY=(0,zC.A)((0,We.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function rY(e){return(0,AC.Ay)("MuiCheckbox",e)}const iY=(0,Ke.A)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),oY=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],sY=(0,wC.Ay)(MW,{shouldForwardProp:e=>(0,gR.A)(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${(0,SC.A)(n.size)}`],"default"!==n.color&&t[`color${(0,SC.A)(n.color)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({color:(t.vars||t).palette.text.secondary},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${"default"===n.color?t.vars.palette.action.activeChannel:t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,TC.X4)("default"===n.color?t.palette.action.active:t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{[`&.${iY.checked}, &.${iY.indeterminate}`]:{color:(t.vars||t).palette[n.color].main},[`&.${iY.disabled}`]:{color:(t.vars||t).palette.action.disabled}})})),aY=(0,We.jsx)(tY,{}),cY=(0,We.jsx)(eY,{}),lY=(0,We.jsx)(nY,{}),uY=t.forwardRef((function(e,n){var r,i;const o=(0,Qe.b)({props:e,name:"MuiCheckbox"}),{checkedIcon:s=aY,color:a="primary",icon:c=cY,indeterminate:l=!1,indeterminateIcon:u=lY,inputProps:d,size:h="medium",className:p}=o,f=(0,Ne.A)(o,oY),m=l?u:c,g=l?u:s,v=(0,ke.A)({},o,{color:a,indeterminate:l,size:h}),y=(e=>{const{classes:t,indeterminate:n,color:r,size:i}=e,o={root:["root",n&&"indeterminate",`color${(0,SC.A)(r)}`,`size${(0,SC.A)(i)}`]},s=(0,bC.A)(o,rY,t);return(0,ke.A)({},t,s)})(v);return(0,We.jsx)(sY,(0,ke.A)({type:"checkbox",inputProps:(0,ke.A)({"data-indeterminate":l},d),icon:t.cloneElement(m,{fontSize:null!=(r=m.props.fontSize)?r:h}),checkedIcon:t.cloneElement(g,{fontSize:null!=(i=g.props.fontSize)?i:h}),ownerState:v,ref:n,className:(0,Pe.A)(y.root,p)},f,{classes:y}))})),dY=uY,hY=()=>{const e=Q(),[n,r]=(0,t.useState)(!1),[i,o]=(0,t.useState)({necessary:!0,functionality:!1,analytics:!1});(0,t.useEffect)((()=>{localStorage.getItem("cookiePreferences")||r(!0)}),[]);const s=e=>t=>{o({...i,[e]:t.target.checked})};return(0,We.jsxs)(wO,{open:n,onClose:()=>{},maxWidth:"sm",fullWidth:!0,PaperProps:{style:{position:"fixed",bottom:20,right:20,margin:0,maxWidth:"500px",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)"}},children:[(0,We.jsxs)(UB,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,We.jsx)(mA,{variant:"h6",component:"div",children:"Cookie Preferences"}),(0,We.jsx)(rR,{onClick:()=>r(!1),size:"small",sx:{color:"text.secondary"},children:(0,We.jsx)(SD.A,{})})]}),(0,We.jsx)(Ux,{}),(0,We.jsxs)(SB,{children:[(0,We.jsx)(mA,{variant:"body1",paragraph:!0,children:"We use cookies to enhance your experience. Please select your preferences:"}),(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,We.jsx)(Gz,{control:(0,We.jsx)(dY,{checked:i.necessary,disabled:!0,color:"primary"}),label:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"body2",fontWeight:"bold",children:"Necessary Cookies"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Required for the app to function properly. Cannot be disabled."})]})}),(0,We.jsx)(Gz,{control:(0,We.jsx)(dY,{checked:i.functionality,onChange:s("functionality"),color:"primary"}),label:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"body2",fontWeight:"bold",children:"Functionality Cookies"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Remember your preferences and settings."})]})}),(0,We.jsx)(Gz,{control:(0,We.jsx)(dY,{checked:i.analytics,onChange:s("analytics"),color:"primary"}),label:(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"body2",fontWeight:"bold",children:"Analytics Cookies"}),(0,We.jsx)(mA,{variant:"body2",color:"text.secondary",children:"Help us understand how you use our app."})]})})]}),(0,We.jsx)(Je,{sx:{mt:2},children:(0,We.jsx)(gL,{component:"button",variant:"body2",onClick:()=>{e("/cookies"),r(!1)},sx:{color:"primary.main"},children:"Learn more about how we use cookies"})})]}),(0,We.jsx)(Ux,{}),(0,We.jsxs)(qU,{sx:{p:2,gap:1},children:[(0,We.jsx)(RR,{onClick:()=>{localStorage.setItem("cookiePreferences",JSON.stringify(i)),r(!1)},variant:"outlined",color:"primary",sx:{minWidth:"120px"},children:"Save Preferences"}),(0,We.jsx)(RR,{onClick:()=>{const e={necessary:!0,functionality:!0,analytics:!0};o(e),localStorage.setItem("cookiePreferences",JSON.stringify(e)),r(!1)},variant:"contained",color:"primary",sx:{minWidth:"120px"},children:"Accept All"})]})]})};function pY(e){return(0,AC.Ay)("MuiBottomNavigation",e)}(0,Ke.A)("MuiBottomNavigation",["root"]);const fY=["children","className","component","onChange","showLabels","value"],mY=(0,wC.Ay)("div",{name:"MuiBottomNavigation",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"center",height:56,backgroundColor:(t.vars||t).palette.background.paper}})),gY=t.forwardRef((function(e,n){const r=(0,Qe.b)({props:e,name:"MuiBottomNavigation"}),{children:i,className:o,component:s="div",onChange:a,showLabels:c=!1,value:l}=r,u=(0,Ne.A)(r,fY),d=(0,ke.A)({},r,{component:s,showLabels:c}),h=(e=>{const{classes:t}=e;return(0,bC.A)({root:["root"]},pY,t)})(d);return(0,We.jsx)(mY,(0,ke.A)({as:s,className:(0,Pe.A)(h.root,o),ref:n,ownerState:d},u,{children:t.Children.map(i,((e,n)=>{if(!t.isValidElement(e))return null;const r=void 0===e.props.value?n:e.props.value;return t.cloneElement(e,{selected:r===l,showLabel:void 0!==e.props.showLabel?e.props.showLabel:c,value:r,onChange:a})}))}))})),vY=gY;function yY(e){return(0,AC.Ay)("MuiBottomNavigationAction",e)}const _Y=(0,Ke.A)("MuiBottomNavigationAction",["root","iconOnly","selected","label"]),EY=["className","icon","label","onChange","onClick","selected","showLabel","value"],bY=(0,wC.Ay)(JA,{name:"MuiBottomNavigationAction",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.showLabel&&!n.selected&&t.iconOnly]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({transition:t.transitions.create(["color","padding-top"],{duration:t.transitions.duration.short}),padding:"0px 12px",minWidth:80,maxWidth:168,color:(t.vars||t).palette.text.secondary,flexDirection:"column",flex:"1"},!n.showLabel&&!n.selected&&{paddingTop:14},!n.showLabel&&!n.selected&&!n.label&&{paddingTop:0},{[`&.${_Y.selected}`]:{color:(t.vars||t).palette.primary.main}})})),wY=(0,wC.Ay)("span",{name:"MuiBottomNavigationAction",slot:"Label",overridesResolver:(e,t)=>t.label})((e=>{let{theme:t,ownerState:n}=e;return(0,ke.A)({fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s"},!n.showLabel&&!n.selected&&{opacity:0,transitionDelay:"0s"},{[`&.${_Y.selected}`]:{fontSize:t.typography.pxToRem(14)}})})),SY=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiBottomNavigationAction"}),{className:r,icon:i,label:o,onChange:s,onClick:a,value:c}=n,l=(0,Ne.A)(n,EY),u=n,d=(e=>{const{classes:t,showLabel:n,selected:r}=e,i={root:["root",!n&&!r&&"iconOnly",r&&"selected"],label:["label",!n&&!r&&"iconOnly",r&&"selected"]};return(0,bC.A)(i,yY,t)})(u);return(0,We.jsxs)(bY,(0,ke.A)({ref:t,className:(0,Pe.A)(d.root,r),focusRipple:!0,onClick:e=>{s&&s(e,c),a&&a(e)},ownerState:u},l,{children:[i,(0,We.jsx)(wY,{className:d.label,ownerState:u,children:o})]}))})),TY=SY,CY=(0,zC.A)((0,We.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home"),AY=(0,zC.A)((0,We.jsx)("path",{d:"M14 6v15H3v-2h2V3h9v1h5v15h2v2h-4V6zm-4 5v2h2v-2z"}),"MeetingRoom"),RY=(0,zC.A)((0,We.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),IY=(0,zC.A)((0,We.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"EmojiEmotions"),xY=e=>{var n;let{open:r,onClose:i}=e;const[o,s]=(0,t.useState)(""),[a,c]=(0,t.useState)(null),[l,u]=(0,t.useState)(null),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(null),[m,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)(0),_=280,E=(0,t.useRef)(null),{currentUser:b,userProfile:w}=ZT();return(0,We.jsxs)(wO,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,maxHeight:"80vh"}},children:[(0,We.jsxs)(UB,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[(0,We.jsxs)(Je,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,We.jsx)(cA,{src:(null===w||void 0===w?void 0:w.profilePic)||(null===b||void 0===b?void 0:b.photoURL)||"",alt:(null===w||void 0===w?void 0:w.name)||(null===b||void 0===b?void 0:b.displayName)||"User",sx:{width:40,height:40}}),(0,We.jsxs)(Je,{children:[(0,We.jsx)(mA,{variant:"subtitle1",fontWeight:"bold",children:(null===w||void 0===w?void 0:w.name)||(null===b||void 0===b?void 0:b.displayName)||"Anonymous"}),(0,We.jsxs)(mA,{variant:"caption",color:"text.secondary",children:["@",(null===w||void 0===w?void 0:w.username)||(null===b||void 0===b||null===(n=b.email)||void 0===n?void 0:n.split("@")[0])||"user"]})]})]}),(0,We.jsx)(rR,{onClick:i,size:"small",children:(0,We.jsx)(EW,{})})]}),(0,We.jsxs)(SB,{children:[(0,We.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),b&&KS&&w)if(o.trim()){h(!0),f(null);try{var t;let e=null;if(a){const t=u_(YS,`posts/${b.uid}/${Date.now()}_${a.name}`);await a_(t,a),e=await l_(t)}const n={content:o.trim(),authorId:b.uid,userId:b.uid,timestamp:Av(),likes:0,likedBy:[],authorName:w.name||b.displayName||"Anonymous",authorAvatar:w.profilePic||b.photoURL||"",authorUsername:w.username||(null===(t=b.email)||void 0===t?void 0:t.split("@")[0])||"user",...e&&{imageUrl:e},comments:[],tags:o.match(/#[a-zA-Z0-9_]+/g)||[],isPrivate:!1,reposts:0,repostedBy:[],views:0,isPinned:!1,isEdited:!1,isArchived:!1,deleted:!1};await gv(Zm(KS,"posts"),n),bT.success("Post created successfully"),s(""),c(null),u(null),y(0),i()}catch(p){console.error("Error creating post:",p),f("Failed to create post. Please try again.")}finally{h(!1)}}else f("Please enter some content");else f("Please sign in and ensure profile is loaded to create a post")},children:[(0,We.jsx)(CN,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",placeholder:"What's on your mind?",value:o,onChange:e=>{const t=e.target.value;s(t),y(t.length),t.length>_?f("Post cannot exceed 280 characters"):f(null)},sx:{mb:2}}),l&&(0,We.jsxs)(Je,{sx:{position:"relative",mb:2},children:[(0,We.jsx)("img",{src:l,alt:"Preview",style:{maxWidth:"100%",maxHeight:"400px",borderRadius:"8px",objectFit:"contain"}}),(0,We.jsx)(rR,{onClick:()=>{c(null),u(null),E.current&&(E.current.value=""),f(null)},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,We.jsx)(AW,{sx:{color:"white"}})})]}),(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,We.jsxs)(Je,{children:[(0,We.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];if(t.size>5242880)return void f("Image size should be less than 5MB");if(!t.type.match(/image\/(jpeg|png|gif)/))return void f("Only JPEG, PNG, and GIF images are allowed");c(t),u(URL.createObjectURL(t)),f(null)}},style:{display:"none"},ref:E}),(0,We.jsx)(rR,{onClick:()=>{var e;return null===(e=E.current)||void 0===e?void 0:e.click()},children:(0,We.jsx)(SW,{})}),(0,We.jsx)(rR,{onClick:e=>{g(!0)},children:(0,We.jsx)(IY,{})})]}),(0,We.jsx)(RR,{variant:"contained",type:"submit",disabled:!o.trim()&&!a||d,children:d?(0,We.jsx)(FN,{size:24}):"Post"})]})]}),p&&(0,We.jsx)($D,{severity:"error",sx:{mt:2},children:p})]})]})},OY=()=>{const e=Q(),n=X(),[r,i]=(0,t.useState)(!1),{currentUser:o}=ZT();return(0,We.jsxs)(We.Fragment,{children:[(0,We.jsxs)(vY,{value:n.pathname,onChange:(t,n)=>{"create-post"===n?i(!0):e(n)},sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider",zIndex:1e3},children:[(0,We.jsx)(TY,{label:"Home",value:"/",icon:(0,We.jsx)(CY,{})}),(0,We.jsx)(TY,{label:"Discover",value:"/discover",icon:(0,We.jsx)(uz,{})}),(0,We.jsx)(TY,{label:"Post",value:"create-post",icon:(0,We.jsx)(xz,{})}),(0,We.jsx)(TY,{label:"Side Rooms",value:"/side-rooms",icon:(0,We.jsx)(AY,{})}),(0,We.jsx)(TY,{label:"Marketplace",value:"/marketplace",icon:(0,We.jsx)(pz,{})}),(0,We.jsx)(TY,{label:"Profile",value:`/profile/${null===o||void 0===o?void 0:o.uid}`,icon:(0,We.jsx)(RY,{})})]}),(0,We.jsx)(wO,{open:r,onClose:()=>i(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,maxHeight:"80vh"}},children:o&&(0,We.jsx)(xY,{open:r,onClose:()=>i(!1)})})]})},kY=(0,Ge.A)({components:{MuiButton:{styleOverrides:{root:{"&.MuiButton-root":{}}}},MuiButtonBase:{styleOverrides:{root:{"&.MuiButtonBase-root":{}}}}}}),NY=e=>{let{children:t}=e;return(0,We.jsxs)(yC,{theme:kY,children:[(0,We.jsx)(ot,{}),t]})};var PY=n(9532);const DY=["All","Groceries","Hair & Beauty","Games","Technology","Home","Clothing","Other"],LY={newest:"Newest First",price_asc:"Price: Low to High",price_desc:"Price: High to Low"},MY=()=>{const e=Q(),[n,r]=(0,t.useState)(""),[i,o]=(0,t.useState)("All"),[s,a]=(0,t.useState)("newest");return(0,We.jsx)(sP,{maxWidth:"lg",children:(0,We.jsxs)(Je,{sx:{my:4},children:[(0,We.jsxs)(Je,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",children:"Marketplace"}),(0,We.jsx)(rR,{color:"primary","aria-label":"add product",onClick:()=>{e("/marketplace/add")},sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.lighter"}},children:(0,We.jsx)(PY.A,{})})]}),(0,We.jsxs)(aL,{container:!0,spacing:2,sx:{mb:4},alignItems:"flex-end",children:[" ",(0,We.jsxs)(aL,{item:!0,xs:12,sm:6,md:5,children:[" ",(0,We.jsx)(CN,{fullWidth:!0,label:"Search Products",variant:"outlined",value:n,onChange:e=>r(e.target.value),size:"small"})]}),(0,We.jsxs)(aL,{item:!0,xs:6,sm:3,md:3,children:[" ",(0,We.jsxs)(Lk,{fullWidth:!0,variant:"outlined",size:"small",children:[" ",(0,We.jsx)(Ok,{id:"category-select-label",children:"Category"}),(0,We.jsx)(_N,{labelId:"category-select-label",id:"category-select",value:i,onChange:e=>o(e.target.value),label:"Category",children:DY.map((e=>(0,We.jsx)(Cx,{value:e,children:e},e)))})]})]}),(0,We.jsxs)(aL,{item:!0,xs:6,sm:3,md:3,children:[" ",(0,We.jsxs)(Lk,{fullWidth:!0,variant:"outlined",size:"small",children:[" ",(0,We.jsx)(Ok,{id:"sort-by-select-label",children:"Sort By"}),(0,We.jsx)(_N,{labelId:"sort-by-select-label",id:"sort-by-select",value:s,onChange:e=>a(e.target.value),label:"Sort By",children:Object.entries(LY).map((e=>{let[t,n]=e;return(0,We.jsx)(Cx,{value:t,children:n},t)}))})]})]})]}),(0,We.jsx)(Je,{sx:{mt:4},children:(0,We.jsxs)(mA,{variant:"body1",sx:{color:"text.secondary",fontStyle:"italic"},children:["Product listings will appear here. (Implement fetching and display logic) Current Filters: Category - ",i,", Sort By - ",LY[s],', Search - "',n||"none",'"']})})]})})};function jY(e){return(0,AC.Ay)("MuiLinearProgress",e)}(0,Ke.A)("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const UY=["className","color","value","valueBuffer","variant"];let VY,FY,BY,WY,zY,HY,GY=e=>e;const qY=(0,xA.i7)(VY||(VY=GY`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),KY=(0,xA.i7)(FY||(FY=GY`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),$Y=(0,xA.i7)(BY||(BY=GY`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),YY=(e,t)=>"inherit"===t?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:"light"===e.palette.mode?(0,TC.a)(e.palette[t].main,.62):(0,TC.e$)(e.palette[t].main,.5),XY=(0,wC.Ay)("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`color${(0,SC.A)(n.color)}`],t[n.variant]]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:YY(n,t.color)},"inherit"===t.color&&"buffer"!==t.variant&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},"buffer"===t.variant&&{backgroundColor:"transparent"},"query"===t.variant&&{transform:"rotate(180deg)"})})),JY=(0,wC.Ay)("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.dashed,t[`dashedColor${(0,SC.A)(n.color)}`]]}})((e=>{let{ownerState:t,theme:n}=e;const r=YY(n,t.color);return(0,ke.A)({position:"absolute",marginTop:0,height:"100%",width:"100%"},"inherit"===t.color&&{opacity:.3},{backgroundImage:`radial-gradient(${r} 0%, ${r} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})}),(0,xA.AH)(WY||(WY=GY`
    animation: ${0} 3s infinite linear;
  `),$Y)),QY=(0,wC.Ay)("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.bar,t[`barColor${(0,SC.A)(n.color)}`],("indeterminate"===n.variant||"query"===n.variant)&&t.bar1Indeterminate,"determinate"===n.variant&&t.bar1Determinate,"buffer"===n.variant&&t.bar1Buffer]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:"inherit"===t.color?"currentColor":(n.vars||n).palette[t.color].main},"determinate"===t.variant&&{transition:"transform .4s linear"},"buffer"===t.variant&&{zIndex:1,transition:"transform .4s linear"})}),(e=>{let{ownerState:t}=e;return("indeterminate"===t.variant||"query"===t.variant)&&(0,xA.AH)(zY||(zY=GY`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),qY)})),ZY=(0,wC.Ay)("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.bar,t[`barColor${(0,SC.A)(n.color)}`],("indeterminate"===n.variant||"query"===n.variant)&&t.bar2Indeterminate,"buffer"===n.variant&&t.bar2Buffer]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ke.A)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},"buffer"!==t.variant&&{backgroundColor:"inherit"===t.color?"currentColor":(n.vars||n).palette[t.color].main},"inherit"===t.color&&{opacity:.3},"buffer"===t.variant&&{backgroundColor:YY(n,t.color),transition:"transform .4s linear"})}),(e=>{let{ownerState:t}=e;return("indeterminate"===t.variant||"query"===t.variant)&&(0,xA.AH)(HY||(HY=GY`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),KY)})),eX=t.forwardRef((function(e,t){const n=(0,Qe.b)({props:e,name:"MuiLinearProgress"}),{className:r,color:i="primary",value:o,valueBuffer:s,variant:a="indeterminate"}=n,c=(0,Ne.A)(n,UY),l=(0,ke.A)({},n,{color:i,variant:a}),u=(e=>{const{classes:t,variant:n,color:r}=e,i={root:["root",`color${(0,SC.A)(r)}`,n],dashed:["dashed",`dashedColor${(0,SC.A)(r)}`],bar1:["bar",`barColor${(0,SC.A)(r)}`,("indeterminate"===n||"query"===n)&&"bar1Indeterminate","determinate"===n&&"bar1Determinate","buffer"===n&&"bar1Buffer"],bar2:["bar","buffer"!==n&&`barColor${(0,SC.A)(r)}`,"buffer"===n&&`color${(0,SC.A)(r)}`,("indeterminate"===n||"query"===n)&&"bar2Indeterminate","buffer"===n&&"bar2Buffer"]};return(0,bC.A)(i,jY,t)})(l),d=dC(),h={},p={bar1:{},bar2:{}};if("determinate"===a||"buffer"===a)if(void 0!==o){h["aria-valuenow"]=Math.round(o),h["aria-valuemin"]=0,h["aria-valuemax"]=100;let e=o-100;d&&(e=-e),p.bar1.transform=`translateX(${e}%)`}else 0;if("buffer"===a)if(void 0!==s){let e=(s||0)-100;d&&(e=-e),p.bar2.transform=`translateX(${e}%)`}else 0;return(0,We.jsxs)(XY,(0,ke.A)({className:(0,Pe.A)(u.root,r),ownerState:l,role:"progressbar"},h,{ref:t},c,{children:["buffer"===a?(0,We.jsx)(JY,{className:u.dashed,ownerState:l}):null,(0,We.jsx)(QY,{className:u.bar1,ownerState:l,style:p.bar1}),"determinate"===a?null:(0,We.jsx)(ZY,{className:u.bar2,ownerState:l,style:p.bar2})]}))})),tX=eX;var nX=n(8522);const rX=["Groceries","Hair & Beauty","Games","Technology","Home","Clothing","Other"],iX=["New","Used - Like New","Used - Good","Used - Fair"],oX=()=>{const e=Q(),{currentUser:n}=ZT(),r=og(),i=d_(),[o,s]=(0,t.useState)(""),[a,c]=(0,t.useState)(""),[l,u]=(0,t.useState)(""),[d,h]=(0,t.useState)(""),[p,f]=(0,t.useState)(""),[m,g]=(0,t.useState)([]),[v,y]=(0,t.useState)([]),[_,E]=(0,t.useState)(null),[b,w]=(0,t.useState)(!1);(0,t.useEffect)((()=>{const e=[];return m.forEach((t=>e.push(URL.createObjectURL(t)))),y(e),()=>{e.forEach((e=>URL.revokeObjectURL(e)))}}),[m]);return(0,We.jsx)(sP,{maxWidth:"md",children:(0,We.jsxs)(Je,{sx:{my:4},children:[(0,We.jsx)(mA,{variant:"h4",component:"h1",gutterBottom:!0,children:"List a New Product"}),(0,We.jsxs)(Je,{component:"form",onSubmit:async t=>{if(t.preventDefault(),!n)return void $T.error("You must be logged in to list a product.");if(!o||!a||!l||!d||!p)return void $T.error("Please fill in all required fields.");if(0===m.length)return void $T.error("Please upload at least one image or video.");const s=parseFloat(l);if(isNaN(s)||s<=0)return void $T.error("Please enter a valid positive price.");w(!0),E(0);let c=[];try{c=await(async e=>{const t=[];E(0);for(let r=0;r<e.length;r++){const o=e[r],s=`${XG()}-${o.name}`,a=c_(u_(i,`products/${(null===n||void 0===n?void 0:n.uid)||"unknown_user"}/${s}`),o);await new Promise(((n,i)=>{a.on("state_changed",(t=>{const n=t.bytesTransferred/t.totalBytes,i=(r+n)/e.length*100;E(i)}),(e=>{console.error("Upload Error:",e),$T.error(`Failed to upload ${o.name}. Error: ${e.code}`),i(e)}),(async()=>{try{const e=await l_(a.snapshot.ref);t.push(e),console.log("File available at",e),n()}catch(e){console.error("Get Download URL Error:",e),$T.error(`Failed to get URL for ${o.name}.`),i(e)}}))}))}return E(null),t})(m);const t={name:o,description:a,price:s,category:d,condition:p,sellerId:n.uid,sellerName:n.displayName||"Anonymous",createdAt:Av(),mediaUrls:c,status:"available"};console.log("Submitting product data to Firestore:",t);const l=await gv(Zm(r,"products"),t);console.log("Document written with ID: ",l.id),$T.success("Product listed successfully!"),e("/marketplace")}catch(k_){console.error("Submission Error (Upload or Firestore): ",k_),$T.error("Failed to list product. Please try again.")}finally{w(!1),E(null)}},noValidate:!0,sx:{mt:3},children:[(0,We.jsxs)(aL,{container:!0,spacing:3,children:[(0,We.jsx)(aL,{item:!0,xs:12,children:(0,We.jsx)(CN,{required:!0,fullWidth:!0,id:"productName",label:"Product Name",name:"productName",autoComplete:"product-name",value:o,onChange:e=>s(e.target.value),disabled:b})}),(0,We.jsx)(aL,{item:!0,xs:12,children:(0,We.jsx)(CN,{required:!0,fullWidth:!0,id:"description",label:"Description",name:"description",multiline:!0,rows:4,value:a,onChange:e=>c(e.target.value),disabled:b})}),(0,We.jsx)(aL,{item:!0,xs:12,sm:6,children:(0,We.jsx)(CN,{required:!0,fullWidth:!0,id:"price",label:"Price ($",type:"number",name:"price",autoComplete:"price",value:l,onChange:e=>u(e.target.value),InputProps:{inputProps:{min:.01,step:.01}},disabled:b})}),(0,We.jsx)(aL,{item:!0,xs:12,sm:6,children:(0,We.jsxs)(Lk,{required:!0,fullWidth:!0,disabled:b,children:[(0,We.jsx)(Ok,{id:"category-label",children:"Category"}),(0,We.jsx)(_N,{labelId:"category-label",id:"category",value:d,label:"Category",onChange:e=>h(e.target.value),children:rX.map((e=>(0,We.jsx)(Cx,{value:e,children:e},e)))})]})}),(0,We.jsx)(aL,{item:!0,xs:12,sm:6,children:(0,We.jsxs)(Lk,{required:!0,fullWidth:!0,disabled:b,children:[(0,We.jsx)(Ok,{id:"condition-label",children:"Condition"}),(0,We.jsx)(_N,{labelId:"condition-label",id:"condition",value:p,label:"Condition",onChange:e=>f(e.target.value),children:iX.map((e=>(0,We.jsx)(Cx,{value:e,children:e},e)))})]})}),(0,We.jsxs)(aL,{item:!0,xs:12,children:[(0,We.jsxs)(mA,{variant:"h6",gutterBottom:!0,children:["Upload Images/Videos (",m.length,"/",5,")"]}),(0,We.jsxs)(RR,{variant:"outlined",component:"label",startIcon:(0,We.jsx)(nX.A,{}),disabled:b||m.length>=5,children:["Select Files",(0,We.jsx)("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*,video/*",onChange:e=>{if(e.target.files){const t=Array.from(e.target.files),n=[];let r=!1;t.forEach((e=>m.length+n.length>=5?($T.error("You can upload a maximum of 5 files."),void(r=!0)):e.size>10485760?($T.error(`File "${e.name}" exceeds the 10MB size limit.`),void(r=!0)):void n.push(e))),!r&&m.length+n.length<=5&&g((e=>[...e,...n])),e.target.value=""}}})]}),(0,We.jsxs)(mA,{variant:"caption",display:"block",sx:{mt:1,color:"text.secondary"},children:["Max ",5," files. Max ",10,"MB per file."]})]}),v.length>0&&(0,We.jsx)(aL,{item:!0,xs:12,children:(0,We.jsx)(Je,{sx:{display:"flex",flexDirection:"row",flexWrap:"nowrap",gap:2,overflowX:"auto",p:1,border:"1px dashed",borderColor:"divider",borderRadius:1,minHeight:100},children:v.map(((e,t)=>{const n=m[t],r=null===n||void 0===n?void 0:n.type.startsWith("video/");return(0,We.jsxs)(Je,{sx:{position:"relative",flexShrink:0},children:[" ",r?(0,We.jsx)("video",{src:e,height:"100",style:{display:"block",borderRadius:"4px"}}):(0,We.jsx)("img",{src:e,alt:`Preview ${t}`,height:"100",style:{display:"block",borderRadius:"4px"}}),(0,We.jsx)(rR,{size:"small",onClick:()=>{return e=t,URL.revokeObjectURL(v[e]),void g((t=>t.filter(((t,n)=>n!==e))));var e},sx:{position:"absolute",top:-5,right:-5,backgroundColor:"rgba(255, 255, 255, 0.7)","&:hover":{backgroundColor:"white"},p:.2},disabled:b,children:(0,We.jsx)(SD.A,{fontSize:"small"})})]},t)}))})}),null!==_&&(0,We.jsx)(aL,{item:!0,xs:12,children:(0,We.jsxs)(Je,{sx:{width:"100%",mb:2},children:[(0,We.jsxs)(mA,{variant:"caption",children:["Uploading ",m.length," file(s)..."]}),(0,We.jsx)(tX,{variant:"determinate",value:_})]})})]}),(0,We.jsx)(RR,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:b||0===m.length,children:b?(0,We.jsx)(FN,{size:24}):"List Product"}),(0,We.jsx)(RR,{fullWidth:!0,variant:"outlined",sx:{mb:2},onClick:()=>e("/marketplace"),disabled:b,children:"Cancel"})]})]})})},sX=()=>{const{currentUser:e}=ZT(),t=X();return!e||["/login","/register"].includes(t.pathname)?null:(0,We.jsx)(OY,{})},aX=()=>{const e="/vibits"===X().pathname;return(0,We.jsxs)(Je,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[!e&&(0,We.jsx)(Hx,{}),(0,We.jsx)(Je,{component:"main",sx:{flexGrow:1,pt:{xs:2,sm:3}},children:(0,We.jsxs)(ve,{children:[(0,We.jsx)(me,{path:"/login",element:(0,We.jsx)(vL,{})}),(0,We.jsx)(me,{path:"/register",element:(0,We.jsx)(PB,{})}),(0,We.jsx)(me,{path:"/reset-password",element:(0,We.jsx)(DB,{})}),(0,We.jsx)(me,{path:"/verify-email",element:(0,We.jsx)(sG,{})}),(0,We.jsx)(me,{path:"/setup-source-code",element:(0,We.jsx)(JG,{})}),(0,We.jsx)(me,{path:"/enter-source-code",element:(0,We.jsx)(QG,{})}),(0,We.jsx)(me,{path:"/reset-source-code",element:(0,We.jsx)(ZG,{})}),(0,We.jsx)(me,{path:"/sade-ai",element:(0,We.jsx)(Yz,{})}),(0,We.jsx)(me,{path:"/",element:(0,We.jsx)(SG,{requireEmailVerification:!0,requireDeviceSetup:!0,children:(0,We.jsx)(PD,{})})}),(0,We.jsx)(me,{path:"/profile/:userId",element:(0,We.jsx)(SG,{requireEmailVerification:!0,requireDeviceSetup:!0,children:(0,We.jsx)(OW,{})})}),(0,We.jsx)(me,{path:"/settings",element:(0,We.jsx)(SG,{requireEmailVerification:!0,requireDeviceSetup:!0,children:(0,We.jsx)(iz,{})})}),(0,We.jsx)(me,{path:"/security",element:(0,We.jsx)(SG,{requireEmailVerification:!0,requireDeviceSetup:!0,children:(0,We.jsx)(tG,{})})}),(0,We.jsx)(me,{path:"/marketplace",element:(0,We.jsx)(SG,{requireEmailVerification:!0,requireDeviceSetup:!0,children:(0,We.jsx)(MY,{})})}),(0,We.jsx)(me,{path:"/marketplace/add",element:(0,We.jsx)(SG,{requireEmailVerification:!0,requireDeviceSetup:!0,children:(0,We.jsx)(oX,{})})}),(0,We.jsx)(me,{path:"/search",element:(0,We.jsx)(SG,{children:(0,We.jsx)(lz,{})})}),(0,We.jsx)(me,{path:"/discover",element:(0,We.jsx)(SG,{children:(0,We.jsx)(fz,{})})}),(0,We.jsx)(me,{path:"/messages",element:(0,We.jsx)(SG,{children:(0,We.jsx)(mz,{})})}),(0,We.jsx)(me,{path:"/side-rooms",element:(0,We.jsx)(SG,{children:(0,We.jsx)($z,{})})}),(0,We.jsx)(me,{path:"/side-room/:roomId",element:(0,We.jsx)(SG,{children:(0,We.jsx)(uH,{})})}),(0,We.jsx)(me,{path:"/chat/:userId",element:(0,We.jsx)(SG,{children:(0,We.jsx)(dH,{})})}),(0,We.jsx)(me,{path:"/safety",element:(0,We.jsx)(XH,{})}),(0,We.jsx)(me,{path:"/privacy-policy",element:(0,We.jsx)(nG,{})}),(0,We.jsx)(me,{path:"/about",element:(0,We.jsx)(rG,{})}),(0,We.jsx)(me,{path:"/terms",element:(0,We.jsx)(iG,{})}),(0,We.jsx)(me,{path:"/cookies",element:(0,We.jsx)(oG,{})}),(0,We.jsx)(me,{path:"/trash",element:(0,We.jsx)(SG,{children:(0,We.jsx)(uG,{})})}),(0,We.jsx)(me,{path:"/profile/:userId/followers",element:(0,We.jsx)(SG,{children:(0,We.jsx)(dG,{})})}),(0,We.jsx)(me,{path:"/profile/:userId/following",element:(0,We.jsx)(SG,{children:(0,We.jsx)(hG,{})})}),(0,We.jsx)(me,{path:"/notifications",element:(0,We.jsx)(SG,{children:(0,We.jsx)(zG,{})})}),(0,We.jsx)(me,{path:"/account-management",element:(0,We.jsx)(SG,{children:(0,We.jsx)(bG,{})})})]})}),(0,We.jsx)(hY,{}),(0,We.jsx)(KT,{position:"bottom-right"}),(0,We.jsx)(sX,{})]})},cX=()=>(0,We.jsx)(CG,{children:(0,We.jsx)(Ce,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:(0,We.jsx)(NY,{children:(0,We.jsxs)(EC,{children:[(0,We.jsx)(ot,{}),(0,We.jsx)(vM,{dateAdapter:Z$,children:(0,We.jsx)(QT,{children:(0,We.jsx)(zP,{children:(0,We.jsx)(rC,{children:(0,We.jsx)(WG,{children:(0,We.jsx)(aX,{})})})})})})]})})})});i.createRoot(document.getElementById("root")).render((0,We.jsx)(cX,{}))})()})();