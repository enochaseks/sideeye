"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[112],{4454:(e,o,n)=>{n.d(o,{A:()=>s});n(9950);var r=n(6491),t=n(2053),i=n(5277),l=n(4414);const s=e=>{let{links:o}=e;return o&&0!==o.length?(0,l.jsxs)(r.A,{mt:1,children:[(0,l.jsx)(t.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,l.jsx)(r.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,l.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},7112:(e,o,n)=>{n.r(o),n.d(o,{default:()=>We});var r=n(9379),t=n(9950),i=n(8429),l=n(2074),s=n(1367),a=n(330),d=n(6220),c=n(5887),u=n(4857),m=n(6491),h=n(2053),p=n(3274),v=n(5333),g=n(4447),x=n(1413),f=n(7591),y=n(3266),b=n(4195),C=n(226),A=n(6639),w=n(3174),j=n(899),S=n(2235),k=n(6583),R=n(33),I=n(8170),E=n(8145),F=n(9739),P=n(249),U=n(6050),T=n(5277),D=n(5979),O=n(3788),z=n(6101),W=n(6497),L=n(7324),H=n(9325),G=n(8614),B=n(3563),M=n(2236),_=n(4142),N=n(7497),V=n(227),X=n(7443),Z=n(5965),Y=n(6904),J=n(9575),K=n(6281),q=n(379),Q=n(1300),$=n(760),ee=n(7319),oe=n(4756),ne=n(4767),re=n(492),te=n(8008),ie=n(1902),le=n(5855),se=n(9939),ae=n(9404),de=n(5379),ce=n(361),ue=n(1675),me=n(9715),he=n(6164),pe=n(5204),ve=n(7341),ge=n(6835),xe=n(1311),fe=n(1673),ye=n(6487),be=n(9460),Ce=n(2600),Ae=n(1770),we=n(7565),je=n(4414);const Se=e=>{var o;let{open:n,onClose:i,onSubmit:l,initialData:s,title:a="Create Room",submitButtonText:d="Create"}=e;const[c,u]=(0,t.useState)({name:(null===s||void 0===s?void 0:s.name)||"",description:(null===s||void 0===s?void 0:s.description)||"",isPrivate:(null===s||void 0===s?void 0:s.isPrivate)||!1,password:(null===s||void 0===s?void 0:s.password)||"",tags:(null===s||void 0===s?void 0:s.tags)||[]}),[p,v]=(0,t.useState)(null);return(0,je.jsx)(k.A,{open:n,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,je.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(c,p)},children:[(0,je.jsx)(R.A,{children:a}),(0,je.jsx)(I.A,{children:(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,je.jsx)(E.A,{label:"Name",value:c.name,onChange:e=>u((o=>(0,r.A)((0,r.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,je.jsx)(E.A,{label:"Description",value:c.description,onChange:e=>u((o=>(0,r.A)((0,r.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,je.jsx)(W.A,{control:(0,je.jsx)(L.A,{checked:c.isPrivate,onChange:e=>u((o=>(0,r.A)((0,r.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,je.jsx)(E.A,{label:"Password",type:"password",value:c.password,onChange:e=>u((o=>(0,r.A)((0,r.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,je.jsxs)(m.A,{sx:{mt:1},children:[(0,je.jsxs)(C.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,je.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?v(e.target.files[0]):v(null)}})]}),p&&(0,je.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",p.name]}),!p&&(null===s||void 0===s?void 0:s.thumbnailUrl)&&(0,je.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",s.thumbnailUrl.substring(s.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,je.jsx)(E.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>u((o=>(0,r.A)((0,r.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,je.jsxs)(F.A,{children:[(0,je.jsx)(C.A,{onClick:i,children:"Cancel"}),(0,je.jsx)(C.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var ke=n(7493),Re=n(9317),Ie=n(6932),Ee=n(9751),Fe=n(2856),Pe=n(1397),Ue=n(3422),Te=n(4454);const De=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],Oe=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],ze=[12,14,16,18,20,24,28,32],We=()=>{var e,o,n,l,M,_;const{roomId:N}=(0,i.g)(),pe=(0,i.Zp)(),{currentUser:ve,blockUser:ge}=(0,s.As)(),xe=(0,u.A)(),[fe,ye]=(0,t.useState)(null),[be,Ce]=(0,t.useState)(!0),[Ae,we]=(0,t.useState)(null),[Ie,We]=(0,t.useState)(!1),[He,Ge]=(0,t.useState)(!1),[Be,Me]=(0,t.useState)(""),[_e,Ne]=(0,t.useState)(!1),[Ve,Xe]=(0,t.useState)(!1),[Ze,Ye]=(0,t.useState)(!1),[Je,Ke]=(0,t.useState)(!1),[qe,Qe]=(0,t.useState)(null),[$e,eo]=(0,t.useState)([]),[oo,no]=(0,t.useState)(null),[ro,to]=((0,t.useRef)(null),(0,t.useState)(null)),[io,lo]=(0,t.useState)(null),[so,ao]=(0,t.useState)(null),[co,uo]=(0,t.useState)(!1),[mo,ho]=(0,t.useState)(!1),[po,vo]=(0,t.useState)(0),[go,xo]=(0,t.useState)(!1),[fo,yo]=(0,t.useState)(null),bo=(0,t.useRef)(null),[Co,Ao]=(0,t.useState)(!1),[wo,jo]=(0,t.useState)(""),[So,ko]=(0,t.useState)(null),[Ro,Io]=(0,t.useState)(""),[Eo,Fo]=(0,t.useState)([]),[Po,Uo]=(0,t.useState)(!1),[To,Do]=(0,t.useState)(null),[Oo,zo]=(0,t.useState)(!1),Wo=(0,t.useRef)(null),[Lo,Ho]=(0,t.useState)(null),[Go,Bo]=(0,t.useState)(!1),[Mo,_o]=(0,t.useState)([]),[No,Vo]=(0,t.useState)(""),[Xo,Zo]=(0,t.useState)(!1),Yo=(0,t.useRef)(null),[Jo,Ko]=(0,t.useState)(""),[qo,Qo]=(0,t.useState)(!1),[$o,en]=(0,t.useState)(30),[on,nn]=(0,t.useState)(!1),[rn,tn]=(0,t.useState)(De[0].name),[ln,sn]=(0,t.useState)(!1),[an,dn]=(0,t.useState)(!1),[cn,un]=(0,t.useState)(Oe[0]),[mn,hn]=(0,t.useState)(ze[2]),[pn,vn]=((0,t.useRef)(null),(0,t.useState)(!1)),[gn,xn]=(0,t.useState)(!1),[fn,yn]=(0,t.useState)(window.innerWidth>1024),[bn,Cn]=(0,t.useState)(null),[An,wn]=(0,t.useState)(null),jn="youtube-player-placeholder",Sn=(0,t.useRef)(0),kn=(0,t.useRef)(0),Rn=(0,t.useRef)(0);(0,t.useEffect)((()=>{const e=()=>{yn(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,t.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,Ue.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),Ho(o)})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),Ho(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),Ho(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),Ho(null)}}),[]),(0,t.useEffect)((()=>{if(Ze)if(null!==fe&&void 0!==fe&&fe.style){const e=fe.style,o=De.find((o=>o.name===e.themeName));tn(o?e.themeName:De[0].name);const n=o||De[0];sn(void 0!==e.headerGradient?e.headerGradient:n.headerGradient||!1),dn(void 0!==e.backgroundGradient?e.backgroundGradient:n.backgroundGradient||!1),un(Oe.includes(e.font)?e.font:Oe[0]),hn(ze.includes(e.headerFontSize)?e.headerFontSize:ze[2])}else tn(De[0].name),sn(De[0].headerGradient||!1),dn(De[0].backgroundGradient||!1),un(Oe[0]),hn(ze[2])}),[Ze,fe]),(0,t.useEffect)((()=>{if(!N||!a.db||0===$e.length)return;const e=$e.filter((e=>e.isOnline)).length,o=Date.now(),n=o-kn.current;if(e!==Sn.current&&n>1e4){console.log("[Active Users Update] Updating count from ".concat(Sn.current," to ").concat(e));const n=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(n,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{Sn.current=e,kn.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}Sn.current=e}),[N,a.db,$e.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===ve||void 0===ve?void 0:ve.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===fe||void 0===fe?void 0:fe.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===fe||void 0===fe?void 0:fe.viewers)||"null/undefined");const In=(0,t.useMemo)((()=>{if(null===ve||void 0===ve||!ve.uid||null===fe||void 0===fe||!fe.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=ve.uid===fe.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===ve||void 0===ve?void 0:ve.uid,null===fe||void 0===fe?void 0:fe.ownerId]),En=(0,t.useMemo)((()=>{if(null===fe||void 0===fe||!fe.viewers||null===ve||void 0===ve||!ve.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=fe.viewers.some((e=>e.userId===ve.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===fe||void 0===fe?void 0:fe.viewers,null===ve||void 0===ve?void 0:ve.uid]),Fn=!!fe&&(In||!0),Pn=(0,t.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",$e);const e=new Map;$e.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[$e]),Un=(0,t.useMemo)((()=>{if(!fe||!fe.viewers||!Array.isArray(fe.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(fe.viewers,null,2));const e=fe.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[fe]),Tn=(0,t.useCallback)((async(e,o,n,r,t)=>{if(!e||null===o||void 0===o||!o.uid||!t)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var l,s;const a=(0,d.H9)(n,"users",i),c=await(0,d.x7)(a);let u="",m="",h=(null===(l=o.email)||void 0===l?void 0:l.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let p="viewer";r?p="owner":null!==(s=t.viewers)&&void 0!==s&&s.some((e=>e.userId===i&&"guest"===e.role))&&(p="guest");const v=(0,d.H9)(n,"sideRooms",e,"presence",i),g={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:p,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(g,null,2)),await(0,d.BN)(v,g,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(a){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),a)}}),[]);(0,t.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(N,", HasAccess: ").concat(Fn,", CurrentUserUID: ").concat(null===ve||void 0===ve?void 0:ve.uid,", IsRoomOwner: ").concat(In,", RoomExists: ").concat(!!fe)),Fn&&N&&ve&&fe?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(ve.uid," in room ").concat(N,".")),Tn(N,ve,a.db,In,fe)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(Fn,", RoomId: ").concat(!!N,", CurrentUser: ").concat(!!ve,", Room: ").concat(!!fe))}),[N,ve,a.db,In,fe,Fn,Tn]),(0,t.useEffect)((()=>{const e=null===ve||void 0===ve?void 0:ve.uid,o=N;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const n=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(n,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[N,null===ve||void 0===ve?void 0:ve.uid,a.db]);const Dn=()=>{Ao(!0)},On=()=>{Ao(!1),jo("")},zn=()=>{if(!N)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!In)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),ko(null),c.oR.success("Shared video cleared.")};(0,t.useEffect)((()=>{if(null===ve||void 0===ve||!ve.uid||!N||!Fn||ro)return;(async()=>{try{console.log("[Stream] Fetching token for user:",ve.uid),console.log("[Stream] Data being sent - User ID:",ve.uid),console.log("[Stream] Data being sent - Display Name:",ve.displayName),console.log("[Stream] Data being sent - Photo URL:",ve.photoURL);const n="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(n));const r=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:ve.uid,userName:ve.displayName||ve.email||"UnknownUser",userImage:ve.photoURL||void 0})});console.log("[Stream] Response status: ".concat(r.status));const t={};if(r.headers.forEach(((e,o)=>{t[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(t,null,2)),!r.ok){var e;let n={error:"HTTP error! Status: ".concat(r.status)};try{const e=await r.text();console.log("[Stream] Non-OK response body (text):",e),n=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),n.error=r.statusText||n.error}throw new Error((null===(e=n)||void 0===e?void 0:e.error)||"HTTP status ".concat(r.status))}const{token:i}=await r.json();if(!i)throw new Error("Stream token was not provided by backend.");to(i),console.log("[Stream] Token fetched successfully.")}catch(Ae){console.error("[Stream] Error fetching token:",Ae),c.oR.error("Stream Token Error: ".concat(Ae.message||"Load failed")),to(null)}})()}),[ve,N,Fn,ro]),(0,t.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!ro||null===ve||void 0===ve||!ve.uid||io)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!ro,", currentUser=").concat(!(null===ve||void 0===ve||!ve.uid),", apiKey=").concat(!0,", clientExists=").concat(!!io));console.log("[Stream] Initializing StreamVideoClient with token.");const n=(null===(e=ve.profile)||void 0===e?void 0:e.name)||ve.displayName||ve.email||ve.uid,r=(null===(o=ve.profile)||void 0===o?void 0:o.profilePic)||ve.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(n,", photoURL: ").concat(r));const t={id:ve.uid,name:n,image:r};try{const e=new ke.Hq({apiKey:"2nufecjmzmzh",user:t,token:ro});lo(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(Ae){console.error("[Stream] Error initializing StreamVideoClient:",Ae),c.oR.error("Failed to initialize Stream video client: ".concat(Ae instanceof Error?Ae.message:String(Ae)))}return()=>{io&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),lo(null))}}),[ro,ve,io]),(0,t.useEffect)((()=>{if(!mo||!io||!N||null===ve||void 0===ve||!ve.uid)return void(mo&&ho(!1));if(so)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void ho(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(N)),uo(!0);try{const e=io.call("default",N);if(await e.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(e.cid)),ao(e),In&&N&&a.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(Ae){console.error("[Stream Call] Error joining or creating call:",Ae),c.oR.error("Failed to connect to audio: ".concat(Ae.message||"Unknown error")),ao(null)}finally{uo(!1),ho(!1)}})(),()=>{ho(!1)}}),[mo,io,N,null===ve||void 0===ve?void 0:ve.uid,so]),(0,t.useEffect)((()=>()=>{so&&(console.log("[Stream Call] Leaving active call ".concat(so.cid," on component unmount or room change.")),so.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(so.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(so.cid,":"),e))).finally((()=>{if(ao(null),In&&N&&a.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[so,N,In,a.db]),(0,t.useEffect)((()=>{if(!N||!ve)return;const e=(0,d.H9)(a.db,"sideRooms",N),o=(0,d.aQ)(e,(e=>{if(e.exists()){const n=(0,r.A)({id:e.id},e.data());if(ye(n),vo(n.heartCount||0),Ce(!1),n.isPrivate&&n.password&&n.ownerId!==ve.uid){var o;(null===(o=n.viewers)||void 0===o?void 0:o.some((e=>e.userId===ve.uid&&"guest"!==e.role)))||Ge(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(N,"' reported as non-existent. Current error: '").concat(Ae,"'. Setting room state to null.")),we("Room not found"),ye(null),Ce(!1)}));let n;if(null!==ve&&void 0!==ve&&ve.uid){const e=(0,d.H9)(a.db,"sideRooms",N,"heartedBy",ve.uid);n=(0,d.aQ)(e,(e=>{xo(e.exists())}))}const t=(0,d.P)((0,d.rJ)(a.db,"sideRooms",N,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(t,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===ve||void 0===ve?void 0:ve.uid)&&o.username&&(yo("".concat(o.username," hearted the room!")),bo.current&&clearTimeout(bo.current),bo.current=setTimeout((()=>{yo(null)}),3e3))}}))}));return()=>{o(),n&&n(),i(),bo.current&&clearTimeout(bo.current)}}),[N,ve]),(0,t.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(N,", HasAccess: ").concat(Fn,", CurrentUserUID: ").concat(null===ve||void 0===ve?void 0:ve.uid)),!N||!Fn||null===ve||void 0===ve||!ve.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(N,", HasAccess: ").concat(Fn,", UserUID: ").concat(null===ve||void 0===ve?void 0:ve.uid)),void eo([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(N));const e=(0,d.rJ)(a.db,"sideRooms",N,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,r.A)({userId:e.id},e.data()))),n=Date.now();let t=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&n-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((n-e.lastSeen)/1e3)," seconds old).")),!t&&a.db&&e.userId!==(null===ve||void 0===ve?void 0:ve.uid)){const o=(0,d.H9)(a.db,"sideRooms",N,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),t=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),eo(i);const l=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(l))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),eo([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(N,".")),o()}}),[N,Fn,null===ve||void 0===ve?void 0:ve.uid,a.db]),(0,t.useEffect)((()=>{const e=null===ve||void 0===ve?void 0:ve.uid,o=N;return()=>{if(e&&o&&a.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const n=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(n,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[N,null===ve||void 0===ve?void 0:ve.uid,a.db]),(0,t.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(N,", HasAccess: ").concat(Fn,", CurrentUserUID: ").concat(null===ve||void 0===ve?void 0:ve.uid,", IsRoomOwner: ").concat(In,", RoomExists: ").concat(!!fe)),!N||null===ve||void 0===ve||!ve.uid||!fe||!Fn){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(N,", UserUID: ").concat(null===ve||void 0===ve?void 0:ve.uid,", HasAccess: ").concat(Fn,", RoomExists: ").concat(!!fe)),null!==ve&&void 0!==ve&&ve.uid&&N){const e=(0,d.H9)(a.db,"sideRooms",N,"presence",ve.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(ve.uid," in room ").concat(N)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(ve.uid,":"),e)}))}return}const e=ve.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(N,"."));let o=null;return(async()=>{try{var n,r;const t=(0,d.H9)(a.db,"users",e),i=await(0,d.x7)(t);let l="",s="",c=(null===(n=ve.email)||void 0===n?void 0:n.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();l=o.name||o.username||"",s=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(l,"', Pic='").concat(s,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),l=ve.displayName||"",s=ve.photoURL||"";let u="viewer";In?u="owner":null!==(r=fe.viewers)&&void 0!==r&&r.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(a.db,"sideRooms",N,"presence",e),h={userId:e,username:c,avatar:s,lastSeen:Date.now(),isOnline:!0,role:u,displayName:l,photoURL:s},p="sideRooms/".concat(N,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",p,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-Rn.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),Rn.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(Ae){console.error("[Presence Heartbeat] Error updating heartbeat:",Ae)}}),6e4))}catch(t){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),t)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(N,". Setting offline."));const n=(0,d.H9)(a.db,"sideRooms",N,"presence",e);(0,d.mZ)(n,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[N,ve,a.db,In,fe,Fn]),(0,t.useEffect)((()=>{if(N)return()=>{}}),[N]),(0,t.useEffect)((()=>{fe&&fe.currentSharedVideoUrl?ko(fe.currentSharedVideoUrl):fe&&!fe.currentSharedVideoUrl&&ko(null)}),[fe]),(0,t.useEffect)((()=>{if(!Lo)return;const e=e=>{c.oR.success(e.message),zo(!1),Io(""),Do(null),Fo([]),Xe(!1)},o=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),zo(!1)},n=e=>{e.roomId===N&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},r=e=>{e.error?(c.oR.error(e.error),Fo([])):Fo(e.users)},t=e=>{e===N&&null!==ve&&void 0!==ve&&ve.uid&&((0,c.oR)("The host has removed you from the room."),null===so||void 0===so||so.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{pe("/side-rooms")})))};return Lo.on("invite-success",e),Lo.on("invite-failed",o),Lo.on("guest-joined",n),Lo.on("user-search-results-for-invite",r),Lo.on("force-remove",t),()=>{Lo.off("invite-success",e),Lo.off("invite-failed",o),Lo.off("guest-joined",n),Lo.off("user-search-results-for-invite",r),Lo.off("force-remove",t)}}),[Lo,N,pe,so,null===ve||void 0===ve?void 0:ve.uid]);const Wn=(0,t.useCallback)((0,Pe.debounce)((e=>{e.trim().length>=2&&(Lo?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),Lo.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[Lo]),Ln=(0,t.useCallback)((()=>{Ke(!0)}),[]),Hn=(0,t.useCallback)((e=>{Qe(e.currentTarget)}),[]),Gn=(0,t.useCallback)((()=>{Qe(null)}),[]),Bn=(0,t.useCallback)((()=>{Ne(!0),Gn()}),[Gn]),Mn=(0,t.useCallback)((()=>{Ye(!0),Gn()}),[Gn]),_n=(0,t.useCallback)((()=>{Xe(!0),Io(""),Do(null),Fo([]),Uo(!1),Gn()}),[Gn]),Nn=(0,t.useCallback)((async()=>{if(zo(!0),Lo&&null!==ve&&void 0!==ve&&ve.uid&&N&&null!==To&&void 0!==To&&To.username){console.log("Emitting invite-user-to-room: ".concat(To.username));try{var e;const o=(0,d.P)((0,d.rJ)(a.db,"users"),(0,d._M)("username","==",To.username)),n=await(0,d.GG)(o);if(n.empty)return c.oR.error("User not found."),void zo(!1);n.docs[0].data();const r=n.docs[0].id,t=(0,d.H9)(a.db,"sideRooms",N),i=await(0,d.x7)(t);if(!i.exists())return c.oR.error("Room not found."),void zo(!1);const l=i.data();if(null===(e=l.viewers)||void 0===e?void 0:e.some((e=>e.userId===r)))return c.oR.error("".concat(To.username," is already in this room.")),void zo(!1);Lo.emit("invite-user-to-room",{roomId:N,inviterId:ve.uid,inviteeUsername:To.username})}catch(Ae){console.error("Error checking if user is in room:",Ae),Lo.emit("invite-user-to-room",{roomId:N,inviterId:ve.uid,inviteeUsername:To.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!Lo,currentUser:!(null===ve||void 0===ve||!ve.uid),roomId:N,selectedInviteeForInvite:To}),c.oR.error("Cannot send invite: connection or user data issue."),zo(!1)}),[null===ve||void 0===ve?void 0:ve.uid,N,To,Lo,a.db]),Vn=(0,t.useCallback)((async()=>{if(N&&In&&(Gn(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){We(!0);try{const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),pe("/side-rooms")}catch(Ae){console.error("Error deleting room:",Ae),c.oR.error("Failed to delete room")}finally{We(!1)}}}),[N,In,pe]),Xn=(0,t.useCallback)((async(e,o)=>{if(!In||!N||e===(null===ve||void 0===ve?void 0:ve.uid))return;console.log("Owner toggling mute for ".concat(e,". Currently muted: ").concat(o));const n=!o,r=(0,d.H9)(a.db,"sideRooms",N,"presence",e);try{await(0,d.mZ)(r,{isMuted:n}),console.warn("[SideRoomComponent] handleForceMuteToggle needs to be connected to the correct signaling (e.g., general Socket.IO emit)"),c.oR.success("User ".concat(n?"muted":"unmuted","."))}catch(Ae){console.error("Error toggling mute for ".concat(e,":"),Ae),c.oR.error("Failed to update mute status.")}}),[In,N,null===ve||void 0===ve?void 0:ve.uid,a.db]),Zn=(0,t.useCallback)(((e,o)=>{if(!In||!N||e===(null===ve||void 0===ve?void 0:ve.uid)||!Lo)return;const n=o||"this user";window.confirm("Are you sure you want to remove ".concat(n," from the room?"))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(N)),Lo.emit("force-remove",{roomId:N,targetUserId:e}),c.oR.success("Removing ".concat(n,"...")))}),[In,N,null===ve||void 0===ve?void 0:ve.uid,Lo]),Yn=(0,t.useCallback)(((e,o)=>{if(!In||!N||e===(null===ve||void 0===ve?void 0:ve.uid))return;const n=o||"this user";if(window.confirm("Are you sure you want to block ".concat(n,"? They will be removed from the room.")))try{ge(e).then((()=>{c.oR.success("Blocked ".concat(n)),console.log("User ".concat(e," has been blocked"))})).catch((e=>{console.error("Error blocking user:",e),c.oR.error("Failed to block user")}))}catch(Ae){console.error("Error initiating block:",Ae),c.oR.error("Failed to block user")}}),[In,N,null===ve||void 0===ve?void 0:ve.uid,ge]),Jn=()=>{setTimeout((()=>{var e;null===(e=Yo.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,t.useEffect)((()=>{Go&&Jn()}),[Mo,Go,Jo]),(0,t.useEffect)((()=>{if(!qo||!Jo)return;let e=0;const o=Jo,n=()=>{e<o.length?(_o((n=>{const t=[...n];if(t.length>0&&"ai"===t[t.length-1].sender){const n=t[t.length-1];t[t.length-1]=(0,r.A)((0,r.A)({},n),{},{text:o.substring(0,e+1)})}return t})),e++,setTimeout(n,$o)):(Qo(!1),Ko(""))};return n(),()=>{Qo(!1)}}),[qo,Jo,$o]);const Kn=e=>{_o((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,n)=>n===e.length-1?(0,r.A)((0,r.A)({},o),{},{text:""}):o))})),Ko(e),Qo(!0)};(0,t.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?_o(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(Ae){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",Ae),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,t.useEffect)((()=>{(Mo.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(Mo))}),[Mo]);const qn=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:No).trim();if(!o)return;const n={sender:"user",text:o};_o((e=>[...e,n])),Vo(""),Zo(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const n="https://sideeye-backend-production.up.railway.app";if(!n)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),Kn("Configuration error: Backend URL not set."),void Zo(!1);const t="".concat(n,"/api/sade-ai");if(null===ve||void 0===ve||!ve.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),Kn("Error: Could not identify user."),void Zo(!1);_o((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),l=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),s={message:o,forceSearch:e,userId:ve.uid,contextFlags:{avoidAppInstructions:i&&!l,isGreeting:i,isInstructionQuery:l,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",s);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},d=await fetch(t,a);if(_o((e=>e.filter(((o,n)=>n!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(r){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(_o((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),Kn(c.response)):Kn(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),Kn("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),Kn("Sorry, I got a bit confused there."))}catch(t){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",t),_o((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),Kn("Sorry, there was an error: ".concat(t.message||"Unknown error"))}finally{Zo(!1),Jn()}};(0,t.useEffect)((()=>{const e=So?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(So):null,o=()=>{if(An&&(An.destroy(),wn(null)),e&&document.getElementById(jn)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(jn,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});wn(o)}else!e&&An&&(An.destroy(),wn(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{An&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),An.destroy(),wn(null))}}),[So]);const Qn=e=>(0,je.jsx)("div",{id:jn,style:{width:"100%",height:"100%"}}),$n=async()=>{if(!ve||!ve.uid||!N||!fe)return;const e=(0,d.H9)(a.db,"sideRooms",N,"heartedBy",ve.uid),o=(0,d.H9)(a.db,"sideRooms",N);try{await(0,d.c4)(a.db,(async n=>{var r;const t=await n.get(e);if(!(await n.get(o)).exists())throw"Room does not exist!";const i=await(0,d.x7)((0,d.H9)(a.db,"users",ve.uid)),l=i.exists()?(null===(r=i.data())||void 0===r?void 0:r.username)||ve.displayName:"Someone";t.exists()?(n.delete(e),n.update(o,{heartCount:(0,d.GV)(-1)})):(n.set(e,{userId:ve.uid,username:l,timestamp:(0,d.O5)()}),n.update(o,{heartCount:(0,d.GV)(1)}))}))}catch(Ae){console.error("Error hearting room:",Ae),c.oR.error("Failed to update heart status.")}},er=fe?"".concat(fe.name," - SideEye"):be?"Loading Room...":"Room Not Found - SideEye",or=fe&&fe.description||"Join the conversation on SideEye.",nr="".concat(window.location.origin,"/default-app-logo.png"),rr=(null===fe||void 0===fe?void 0:fe.thumbnailUrl)||nr,tr="".concat(window.location.origin,"/side-room/").concat(N||"");if(be&&!fe)return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Fe.mg,{children:(0,je.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,je.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,je.jsx)(A.A,{})})]});if(Ae&&!fe)return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Fe.mg,{children:(0,je.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,je.jsxs)(m.A,{sx:{p:3,textAlign:"center"},children:[(0,je.jsx)(w.A,{severity:"error",children:Ae}),(0,je.jsxs)(C.A,{onClick:()=>pe("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const ir=async()=>{if(so)if(fn)try{await so.screenShare.toggle();const e=so.screenShare.enabled;xn(e),e?(c.oR.success("Screen sharing started. All participants will see your screen automatically."),Lo&&null!==fe&&void 0!==fe&&fe.id&&null!==ve&&void 0!==ve&&ve.uid&&Lo.emit("start-screen-share",{roomId:fe.id,userId:ve.uid})):(c.oR.success("Screen sharing stopped."),Lo&&null!==fe&&void 0!==fe&&fe.id&&null!==ve&&void 0!==ve&&ve.uid&&Lo.emit("stop-screen-share",{roomId:fe.id,userId:ve.uid}))}catch(Ae){var e,o,n,r;console.error("Error toggling screen share:",Ae),"NotAllowedError"===Ae.name||null!==(e=Ae.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=Ae.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(n=Ae.message)&&void 0!==n&&n.includes("getDisplayMedia is not supported")||null!==(r=Ae.message)&&void 0!==r&&r.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(Ae.message||"Unknown error")),so.screenShare&&xn(so.screenShare.enabled)}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")},lr=async()=>{if(fe&&Be&&ve){We(!0);try{if(fe.password===Be){const e=(0,d.H9)(a.db,"sideRooms",N),o=await(0,d.x7)(e),n=o.data().viewers||[];n.some((e=>e.userId===ve.uid))||await(0,d.mZ)(e,{viewers:[...n,{userId:ve.uid,username:ve.displayName||ve.email||"User",role:"viewer",joinedAt:(0,d.O5)()}]}),c.oR.success("Password correct. Welcome to the room!"),Ge(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(Ae){console.error("Error verifying password:",Ae),c.oR.error("An error occurred. Please try again.")}finally{We(!1)}}else c.oR.error("Missing information. Please try again.")};return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(Fe.mg,{children:[(0,je.jsx)("title",{children:er}),(0,je.jsx)("meta",{name:"description",content:or}),(0,je.jsx)("meta",{property:"og:type",content:"website"}),(0,je.jsx)("meta",{property:"og:url",content:tr}),(0,je.jsx)("meta",{property:"og:title",content:er}),(0,je.jsx)("meta",{property:"og:description",content:or}),(0,je.jsx)("meta",{property:"og:image",content:rr}),(0,je.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,je.jsx)("meta",{property:"og:image:height",content:"630"}),(0,je.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,je.jsx)("meta",{name:"twitter:url",content:tr}),(0,je.jsx)("meta",{name:"twitter:title",content:er}),(0,je.jsx)("meta",{name:"twitter:description",content:or}),(0,je.jsx)("meta",{name:"twitter:image",content:rr})]}),(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===fe||void 0===fe||null===(e=fe.style)||void 0===e?void 0:e.font)||Oe[0],backgroundColor:null!==fe&&void 0!==fe&&null!==(o=fe.style)&&void 0!==o&&o.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===fe||void 0===fe||null===(n=fe.style)||void 0===n?void 0:n.backgroundColor)||xe.palette.background.default,", ").concat((null===fe||void 0===fe||null===(l=fe.style)||void 0===l?void 0:l.accentColor)||xe.palette.secondary.main,")"):(null===fe||void 0===fe||null===(M=fe.style)||void 0===M?void 0:M.backgroundColor)||xe.palette.background.default,color:(null===fe||void 0===fe||null===(_=fe.style)||void 0===_?void 0:_.textColor)||xe.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[fe&&(()=>{var e,o,n,r,t,i,l,s,u,w,j,S,k,R,I,E,F,P,U,T,D,O,z,W;return(0,je.jsxs)(m.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==fe&&void 0!==fe&&null!==(e=fe.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===fe||void 0===fe||null===(o=fe.style)||void 0===o?void 0:o.headerColor)||xe.palette.primary.main,", ").concat((null===fe||void 0===fe||null===(n=fe.style)||void 0===n?void 0:n.accentColor)||xe.palette.secondary.light,")"):(null===fe||void 0===fe||null===(r=fe.style)||void 0===r?void 0:r.headerColor)||xe.palette.background.paper,color:(null===fe||void 0===fe||null===(t=fe.style)||void 0===t?void 0:t.textColor)||"inherit"},children:[(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,je.jsx)(h.A,{variant:"h6",sx:{fontFamily:(null===fe||void 0===fe||null===(i=fe.style)||void 0===i?void 0:i.font)||Oe[0],fontSize:null!==fe&&void 0!==fe&&null!==(l=fe.style)&&void 0!==l&&l.headerFontSize?"".concat(fe.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===fe||void 0===fe?void 0:fe.name}),Un&&(0,je.jsxs)(h.A,{variant:"caption",sx:{opacity:null!==fe&&void 0!==fe&&null!==(s=fe.style)&&void 0!==s&&s.textColor?.85:1,fontFamily:(null===fe||void 0===fe||null===(u=fe.style)||void 0===u?void 0:u.font)||Oe[0]},children:["Host: ",Un.username]})]}),(0,je.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===ve||void 0===ve?void 0:ve.uid)&&(null===fe||void 0===fe?void 0:fe.ownerId)&&ve.uid!==fe.ownerId&&Un&&(0,je.jsx)(p.A,{title:"Follow ".concat(Un.username),children:(0,je.jsx)(v.A,{onClick:async()=>{if(null!==ve&&void 0!==ve&&ve.uid&&null!==fe&&void 0!==fe&&fe.ownerId&&a.db)try{const e=(0,d.H9)(a.db,"users",ve.uid,"following",fe.ownerId),o=await(0,d.x7)(e),n=(0,d.H9)(a.db,"users",fe.ownerId,"followRequests",ve.uid),r=await(0,d.x7)(n),t=(0,d.H9)(a.db,"users",fe.ownerId),i=await(0,d.x7)(t),l=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(a.db,"users",fe.ownerId,"followers",ve.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(Un.username))}else if(r.exists())await(0,d.kd)(n),c.oR.success("Canceled follow request to ".concat(Un.username));else if(l)await(0,d.BN)(n,{userId:ve.uid,username:ve.displayName||ve.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(Un.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(a.db,"users",fe.ownerId,"followers",ve.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(Un.username))}}catch(Ae){console.error("Error toggling follow:",Ae),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===fe||void 0===fe||null===(w=fe.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,je.jsx)(V.A,{})})}),(0,je.jsx)(p.A,{title:go?"Unheart Room":"Heart Room",children:(0,je.jsx)(v.A,{onClick:$n,color:go?"error":"inherit",sx:{color:go?xe.palette.error.main:(null===fe||void 0===fe||null===(j=fe.style)||void 0===j?void 0:j.accentColor)||"inherit"},disabled:on,children:go?(0,je.jsx)(X.A,{}):(0,je.jsx)(Z.A,{})})}),(0,je.jsx)(g.A,{badgeContent:po>0?po:"0",sx:{mr:1,"& .MuiBadge-badge":{backgroundColor:(null===fe||void 0===fe||null===(S=fe.style)||void 0===S?void 0:S.accentColor)||xe.palette.primary.main,color:null!==fe&&void 0!==fe&&null!==(k=fe.style)&&void 0!==k&&k.textColor&&null!==fe&&void 0!==fe&&null!==(R=fe.style)&&void 0!==R&&R.accentColor?xe.palette.getContrastText(fe.style.accentColor):xe.palette.primary.contrastText}}}),(0,je.jsx)(p.A,{title:"Share",children:(0,je.jsx)(v.A,{onClick:Ln,sx:{color:(null===fe||void 0===fe||null===(I=fe.style)||void 0===I?void 0:I.accentColor)||"inherit"},children:(0,je.jsx)(Y.A,{})})}),In&&(0,je.jsx)(p.A,{title:"Share Video Link",children:(0,je.jsx)(v.A,{onClick:Dn,size:"small",color:"secondary",children:(0,je.jsx)(J.A,{})})}),(0,je.jsx)(p.A,{title:"Chat with Sade AI",children:(0,je.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>Bo(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===fe||void 0===fe||null===(E=fe.style)||void 0===E?void 0:E.accentColor)||xe.palette.primary.light)}})}),In&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(p.A,{title:"Room Settings",children:(0,je.jsx)(v.A,{onClick:Hn,sx:{color:(null===fe||void 0===fe||null===(F=fe.style)||void 0===F?void 0:F.accentColor)||"inherit"},children:(0,je.jsx)(K.A,{})})}),(0,je.jsxs)(f.A,{anchorEl:qe,open:Boolean(qe),onClose:Gn,children:[(0,je.jsxs)(y.A,{onClick:Bn,children:[" ",(0,je.jsx)(b.A,{children:(0,je.jsx)(q.A,{fontSize:"small"})}),"Edit Room"]}),(0,je.jsxs)(y.A,{onClick:Mn,children:[" ",(0,je.jsx)(b.A,{children:(0,je.jsx)(Q.A,{fontSize:"small"})}),"Customize"]}),(0,je.jsxs)(y.A,{onClick:_n,children:[" ",(0,je.jsx)(b.A,{children:(0,je.jsx)(V.A,{fontSize:"small"})}),"Invite"]}),(0,je.jsxs)(y.A,{onClick:Vn,sx:{color:"error.main"},children:[(0,je.jsx)(b.A,{children:(0,je.jsx)($.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,je.jsx)(p.A,{title:"Leave Room",children:(0,je.jsx)(v.A,{onClick:()=>{In?vn(!0):pe("/side-rooms")},disabled:Ie,sx:{color:(null===fe||void 0===fe||null===(P=fe.style)||void 0===P?void 0:P.accentColor)||"inherit"},children:(0,je.jsx)(ee.A,{})})}),In&&fn&&so&&(0,je.jsx)(p.A,{title:gn?"Stop Sharing Screen":"Share Screen (Desktop Only)",children:(0,je.jsx)(v.A,{onClick:ir,sx:{color:(null===fe||void 0===fe||null===(U=fe.style)||void 0===U?void 0:U.accentColor)||"inherit"},children:gn?(0,je.jsx)(oe.A,{}):(0,je.jsx)(ne.A,{})})})]})]}),(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,je.jsxs)(h.A,{variant:"caption",sx:{fontFamily:(null===fe||void 0===fe||null===(T=fe.style)||void 0===T?void 0:T.font)||Oe[0]},children:[Pn.length," Online"]}),(0,je.jsxs)(m.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!so&&io&&Fn&&(0,je.jsx)(C.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),so?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):ho(!0)},startIcon:co?(0,je.jsx)(A.A,{size:20,color:"inherit"}):(0,je.jsx)(re.A,{}),disabled:co||!io,sx:{backgroundColor:null===fe||void 0===fe||null===(D=fe.style)||void 0===D?void 0:D.accentColor,fontFamily:(null===fe||void 0===fe||null===(O=fe.style)||void 0===O?void 0:O.font)||Oe[0],color:null!==fe&&void 0!==fe&&null!==(z=fe.style)&&void 0!==z&&z.accentColor?xe.palette.getContrastText(fe.style.accentColor):void 0},children:co?"Connecting...":"Connect Audio (Stream)"}),so&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(p.A,{title:"Toggle Microphone",children:(0,je.jsxs)(v.A,{onClick:async()=>{var e;if(null===so||void 0===so||!so.microphone||null===ve||void 0===ve||!ve.uid||!N)return;const o=$e.find((e=>e.userId===ve.uid)),n=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await so.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(n));const e=(0,d.H9)(a.db,"sideRooms",N,"presence",ve.uid);await(0,d.mZ)(e,{isMuted:n}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(ve.uid," to ").concat(n))}catch(Ae){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",Ae),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==so&&void 0!==so&&so.microphone)||!(null!==ve&&void 0!==ve&&ve.uid)||!N,children:[(0,je.jsx)(te.A,{})," "]})}),(0,je.jsx)(h.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,je.jsx)(C.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===so||void 0===so||so.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),pe("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:co,sx:{fontFamily:(null===fe||void 0===fe||null===(W=fe.style)||void 0===W?void 0:W.font)||Oe[0]},children:"Leave Audio"})]}),!io&&be&&(0,je.jsx)(A.A,{size:24})]})]})]})})(),(0,je.jsx)(m.A,{sx:{flexGrow:1,overflowY:"auto"},children:fe?io?so?(0,je.jsx)(Re.Mf9,{client:io,children:(0,je.jsx)(Re.xwR,{call:so,children:(0,je.jsx)(Le,{room:fe,isRoomOwner:In,isGuest:En,handleOpenShareVideoDialog:Dn,handleClearSharedVideo:zn,currentVideoUrl:So,renderVideoPlayer:Qn,onForceMuteToggle:Xn,onForceRemove:Zn,onForceBan:Yn,theme:xe,navigate:pe})})}):(0,je.jsxs)(m.A,{sx:{flexGrow:1,p:2},children:[So&&(0,je.jsxs)(m.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,je.jsx)(h.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),In&&(0,je.jsx)(p.A,{title:"Clear Shared Video",children:(0,je.jsx)(v.A,{onClick:zn,size:"small",children:(0,je.jsx)(ie.A,{})})})]}),(0,je.jsx)(m.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Qn()})]}),(0,je.jsxs)(h.A,{variant:"h6",gutterBottom:!0,children:["Participants (",Pn.length,")"]}),(0,je.jsx)(j.Ay,{container:!0,spacing:2,children:Pn.map((e=>(0,je.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,je.jsxs)(S.A,{sx:{p:1,textAlign:"center"},children:[(0,je.jsx)(x.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,je.jsx)(h.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,je.jsx)(le.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!so&&!co&&Fn&&(0,je.jsx)(w.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),co&&(0,je.jsx)(w.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===ro&&Fn&&null!==ve&&void 0!==ve&&ve.uid&&N||null!==ro&&!io?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(A.A,{sx:{mb:2}}),(0,je.jsx)(h.A,{children:"Initializing audio components..."}),(0,je.jsx)(h.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!Fn&&null!==ve&&void 0!==ve&&ve.uid?(0,je.jsx)(w.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,je.jsx)(w.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,je.jsx)(C.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[be&&(0,je.jsx)(A.A,{}),!be&&(0,je.jsxs)(w.A,{severity:"error",children:["Room not found. ",(0,je.jsx)(C.A,{onClick:()=>pe("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,je.jsxs)(k.A,{open:Co,onClose:On,fullWidth:!0,maxWidth:"sm",children:[(0,je.jsx)(R.A,{children:"Share a Video"}),(0,je.jsx)(I.A,{children:(0,je.jsx)(E.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:wo,onChange:e=>jo(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,je.jsxs)(F.A,{children:[(0,je.jsx)(C.A,{onClick:On,children:"Cancel"}),(0,je.jsx)(C.A,{onClick:()=>{if(!N)return void c.oR.error("Cannot share video: Room ID is missing.");if(!wo.trim())return void c.oR.error("Please enter a video URL.");if(!wo.startsWith("http://")&&!wo.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(e,{currentSharedVideoUrl:wo,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),ko(wo),c.oR.success("Video shared!"),On()},variant:"contained",children:"Share Video"})]})]}),(0,je.jsxs)(k.A,{open:Je,onClose:()=>Ke(!1),fullWidth:!0,maxWidth:"xs",children:[(0,je.jsx)(R.A,{children:"Share this Room"}),(0,je.jsxs)(I.A,{sx:{textAlign:"center"},children:[(0,je.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,je.jsx)(E.A,{fullWidth:!0,variant:"outlined",value:tr,InputProps:{readOnly:!0},sx:{mb:2}}),(0,je.jsx)(C.A,{variant:"contained",startIcon:(0,je.jsx)(se.A,{}),onClick:()=>{navigator.clipboard.writeText(tr),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,je.jsx)(h.A,{variant:"subtitle2",gutterBottom:!0,children:"Or share on:"}),(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,je.jsx)(v.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(tr),"&text=").concat(encodeURIComponent((null===fe||void 0===fe?void 0:fe.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,je.jsx)(ae.A,{})}),(0,je.jsx)(v.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(tr)),"_blank"),title:"Share on Facebook",children:(0,je.jsx)(de.A,{})}),(0,je.jsx)(v.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===fe||void 0===fe?void 0:fe.name)||"Join my SideEye Room!")+" "+tr)),"_blank"),title:"Share on WhatsApp",children:(0,je.jsx)(ce.A,{})}),(0,je.jsx)(v.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText(tr),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,je.jsx)(ue.A,{})})]})]}),(0,je.jsx)(F.A,{children:(0,je.jsx)(C.A,{onClick:()=>Ke(!1),children:"Close"})})]}),(0,je.jsxs)(k.A,{open:Go,onClose:()=>Bo(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,je.jsxs)(R.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,je.jsx)(p.A,{title:"Clear Chat History",children:(0,je.jsx)(v.A,{onClick:()=>{_o([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,je.jsx)($.A,{})})})]}),(0,je.jsx)(I.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:xe.palette.background.default},children:(0,je.jsxs)(P.A,{sx:{p:0},children:[Mo.map(((e,o)=>(0,je.jsxs)(U.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,je.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,je.jsx)(S.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,je.jsx)(Te.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),Xo&&(0,je.jsxs)(U.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,je.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,je.jsx)(S.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,je.jsx)("div",{ref:Yo})]})}),(0,je.jsxs)(F.A,{sx:{p:1,borderTop:"1px solid ".concat(xe.palette.divider),flexDirection:"column"},children:[Mo.length<=1&&!Xo&&(0,je.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,je.jsx)(T.A,{label:e,onClick:()=>qn(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,je.jsxs)(m.A,{sx:{display:"flex",width:"100%"},children:[(0,je.jsx)(E.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:No,onChange:e=>Vo(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Xo&&qn(),sx:{mr:1},disabled:Xo}),(0,je.jsxs)(v.A,{onClick:()=>!Xo&&qn(No,!1),disabled:Xo||!No.trim(),color:"primary",children:[(0,je.jsx)(Y.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,je.jsxs)(v.A,{onClick:()=>!Xo&&qn(No,!0),disabled:Xo||!No.trim(),color:"secondary",title:"Search the web",children:[(0,je.jsx)(me.A,{})," "]})]})]})]}),_e&&fe&&(0,je.jsx)(Se,{open:_e,onClose:()=>Ne(!1),onSubmit:async(e,o)=>{if(N&&ve){We(!0);try{let n=fe.thumbnailUrl||"";if(o){const e=(0,Ee.KR)(a.IG,"room-thumbnails/".concat(N,"_").concat(Date.now(),"_").concat(o.name));await(0,Ee.D)(e,o),n=await(0,Ee.qk)(e)}const r=(0,d.H9)(a.db,"sideRooms",N),t={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:n,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?t.password=e.password:e.isPrivate||(t.password=(0,d.CL)()),await(0,d.mZ)(r,t),c.oR.success("Room details updated successfully!"),Ne(!1)}catch(n){console.error("Error updating room:",n),c.oR.error("Failed to update room details.")}finally{We(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:fe,title:"Edit Room",submitButtonText:"Save Changes"}),(0,je.jsxs)(k.A,{open:Ze,onClose:()=>Ye(!1),fullWidth:!0,maxWidth:"sm",children:[(0,je.jsx)(R.A,{children:"Customize Room Appearance"}),(0,je.jsx)(I.A,{children:(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,je.jsxs)(D.A,{fullWidth:!0,children:[(0,je.jsx)(O.A,{id:"theme-select-label",children:"Theme"}),(0,je.jsx)(z.A,{labelId:"theme-select-label",value:rn,label:"Theme",onChange:e=>tn(e.target.value),children:De.map((e=>(0,je.jsx)(y.A,{value:e.name,children:e.name},e.name)))})]}),(0,je.jsxs)(D.A,{fullWidth:!0,children:[(0,je.jsx)(O.A,{id:"font-select-label",children:"Font"}),(0,je.jsx)(z.A,{labelId:"font-select-label",value:cn,label:"Font",onChange:e=>un(e.target.value),children:Oe.map((e=>(0,je.jsx)(y.A,{value:e,children:e},e)))})]}),(0,je.jsxs)(D.A,{fullWidth:!0,children:[(0,je.jsx)(O.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,je.jsx)(z.A,{labelId:"text-size-select-label",value:mn.toString(),label:"Header Text Size (px)",onChange:e=>hn(Number(e.target.value)),children:ze.map((e=>(0,je.jsx)(y.A,{value:e.toString(),children:e},e)))})]}),(0,je.jsx)(W.A,{control:(0,je.jsx)(L.A,{checked:ln,onChange:e=>sn(e.target.checked)}),label:"Use Header Gradient"}),(0,je.jsx)(W.A,{control:(0,je.jsx)(L.A,{checked:an,onChange:e=>dn(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,je.jsxs)(F.A,{children:[(0,je.jsx)(C.A,{onClick:()=>Ye(!1),children:"Cancel"}),(0,je.jsx)(C.A,{onClick:async()=>{var e,o,n,r,t;if(!N||!fe)return void c.oR.error("Cannot save style: Room data is missing.");if(!ve)return void c.oR.error("You must be logged in to change the style.");if(!In)return void c.oR.error("Only the room owner can change the style.");const i=De.find((e=>e.name===rn));if(!i){var l,s,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=De[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:cn,headerFontSize:mn,headerGradient:ln,backgroundGradient:an,customCss:(null===(l=fe.style)||void 0===l?void 0:l.customCss)||"",bannerUrl:(null===(s=fe.style)||void 0===s?void 0:s.bannerUrl)||"",stickers:(null===(u=fe.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=fe.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=fe.style)||void 0===h?void 0:h.thumbnailUrl)||fe.thumbnailUrl||""};try{const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),Ye(!1)}catch(Ae){console.error("Error updating room style with default theme:",Ae),c.oR.error("Failed to update room style.")}finally{We(!1)}return}const p={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:cn,headerFontSize:mn,headerGradient:ln,backgroundGradient:an,customCss:(null===(e=fe.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=fe.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(n=fe.style)||void 0===n?void 0:n.stickers)||[],glitterEffect:(null===(r=fe.style)||void 0===r?void 0:r.glitterEffect)||!1,thumbnailUrl:(null===(t=fe.style)||void 0===t?void 0:t.thumbnailUrl)||fe.thumbnailUrl||""};We(!0);try{const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{style:p,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),Ye(!1)}catch(Ae){console.error("Error updating room style:",Ae),c.oR.error("Failed to update room style.")}finally{We(!1)}},variant:"contained",disabled:Ie,children:Ie?(0,je.jsx)(A.A,{size:24}):"Save Style"})]})]}),(0,je.jsxs)(k.A,{open:Ve,onClose:()=>{Xe(!1),Io(""),Do(null),Fo([]),Uo(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,je.jsx)(R.A,{children:"Invite User to Room"}),(0,je.jsxs)(I.A,{children:[(0,je.jsx)(h.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,je.jsxs)(m.A,{ref:Wo,sx:{position:"relative"},children:[(0,je.jsx)(E.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:Ro,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Io(o),Do(null),o.trim().length>=2?(Uo(!0),Wn(o)):(Uo(!1),Fo([]))},sx:{mb:1}}),Po&&Eo.length>0&&(0,je.jsx)(S.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:xe.zIndex.modal+1,mt:.5},children:(0,je.jsx)(H.x,{onClickAway:()=>{Uo(!1)},children:(0,je.jsx)(P.A,{dense:!0,children:Eo.map((e=>(0,je.jsxs)(U.Ay,{button:!0,onClick:()=>{return Do(o=e),Io(o.username),Uo(!1),void Fo([]);var o},children:[(0,je.jsx)(G.A,{children:(0,je.jsx)(x.A,{src:e.profilePic,alt:e.username})}),(0,je.jsx)(B.A,{primary:(0,je.jsxs)(m.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,je.jsx)(he.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),Po&&0===Eo.length&&Ro.length>=2&&(0,je.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',Ro,'".']})]}),To&&(0,je.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",To.username,(0,je.jsx)(he.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,je.jsxs)(F.A,{children:[(0,je.jsx)(C.A,{onClick:()=>{Xe(!1),Io(""),Do(null),Fo([]),Uo(!1)},children:"Cancel"}),(0,je.jsx)(C.A,{onClick:Nn,variant:"contained",disabled:Oo||!To||!Lo,children:Oo?(0,je.jsx)(A.A,{size:24}):"Send Invite"})]})]}),(0,je.jsxs)(k.A,{open:pn,onClose:()=>vn(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,je.jsx)(R.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,je.jsxs)(I.A,{children:[(0,je.jsx)(h.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,je.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,je.jsxs)(F.A,{children:[(0,je.jsx)(C.A,{onClick:()=>vn(!1),disabled:Ie,children:"Cancel"}),(0,je.jsx)(C.A,{onClick:()=>{vn(!1),Vn()},color:"error",variant:"contained",disabled:Ie,autoFocus:!0,children:Ie?(0,je.jsx)(A.A,{size:24}):"End and Delete"})]})]}),(0,je.jsxs)(k.A,{open:He,onClose:()=>{In||Fn||pe("/side-rooms")},children:[(0,je.jsx)(R.A,{children:"Password Required"}),(0,je.jsxs)(I.A,{children:[(0,je.jsx)(h.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,je.jsx)(E.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Be,onChange:e=>Me(e.target.value),onKeyPress:e=>"Enter"===e.key&&lr()})]}),(0,je.jsxs)(F.A,{children:[(0,je.jsx)(C.A,{onClick:()=>pe("/side-rooms"),disabled:Ie,children:"Cancel"}),(0,je.jsx)(C.A,{onClick:lr,disabled:Ie||!Be,variant:"contained",children:Ie?(0,je.jsx)(A.A,{size:24}):"Submit"})]})]})]})]})},Le=e=>{var o,n,i,l,u,f,y,b,w,k,R,I,F,P,U,D,O,z,W,L,H,G,B,V,X,Z,Y,K,q,Q,$,ne,re,se,ae,de,ce,ue,me,he,be,Ce,Ae,we,Se,ke,Ee,Fe,Pe;let{room:Ue,isRoomOwner:Te,isGuest:De,handleOpenShareVideoDialog:Oe,handleClearSharedVideo:ze,currentVideoUrl:We,renderVideoPlayer:Le,onForceMuteToggle:Ge,onForceRemove:Be,onForceBan:Me,theme:_e,navigate:Ne}=e;const Ve=(0,Ie.Gc)(),{useParticipants:Xe,useCallState:Ze,useMicrophoneState:Ye,useCameraState:Je}=(0,Ie.R3)(),Ke=Xe(),{localParticipant:qe}=Ze(),{isMute:Qe}=Ye(),{isEnabled:$e,isTogglePending:eo}=Je(),{currentUser:oo}=(0,s.As)(),[no,ro]=(0,t.useState)(window.innerWidth>1024),[to,io]=(0,t.useState)(!0),[lo,so]=(0,t.useState)(!1),[ao,co]=(0,t.useState)([]),[uo,mo]=(0,t.useState)("participants"),[ho,po]=(0,t.useState)([]),[vo,go]=(0,t.useState)(""),xo=(0,t.useRef)(null),fo=Ke.find((e=>e.screenShareStream)),yo=(null===fo||void 0===fo?void 0:fo.userId)===Ue.ownerId;(0,t.useEffect)((()=>{fo&&(console.log("Screen sharing detected from participant ".concat(fo.name||fo.userId)),yo&&console.log("Room owner is sharing their screen - should be visible to ALL participants"))}),[fo,yo]);(0,t.useEffect)((()=>{yo&&fo&&console.log("Room owner is sharing screen - should be visible to all participants")}),[yo,fo]),(0,t.useEffect)((()=>{fo&&console.log("Screen sharing available from participant: ".concat(fo.name||fo.userId))}),[fo]);const[bo,Co]=(0,t.useState)({}),Ao=(0,t.useCallback)((async e=>{if(bo[e])return bo[e];try{const o=(0,d.H9)(a.db,"users",e),n=await(0,d.x7)(o);if(n.exists()){const o=n.data(),t={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return Co((o=>(0,r.A)((0,r.A)({},o),{},{[e]:t}))),t}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return Co((n=>(0,r.A)((0,r.A)({},n),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[bo,a.db]),wo=(0,t.useCallback)((async()=>{if(!vo.trim()||null===oo||void 0===oo||!oo.uid||null===Ue||void 0===Ue||!Ue.id||!a.db)return;const e=await Ao(oo.uid),o={id:"".concat(Date.now(),"-").concat(oo.uid),userId:oo.uid,userName:e.username,message:vo.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(a.db,"sideRooms",Ue.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(n){console.error("[Chat] Error sending message to Firestore:",n),po((e=>[...e,o]))}go("")}),[vo,null===oo||void 0===oo?void 0:oo.uid,null===Ue||void 0===Ue?void 0:Ue.id,a.db,Ao]);(0,t.useEffect)((()=>{if(null===Ue||void 0===Ue||!Ue.id||!a.db)return;console.log("[Chat] Setting up chat listener for room ".concat(Ue.id));const e=(0,d.P)((0,d.rJ)(a.db,"sideRooms",Ue.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const n=e.data();o.push({id:e.id,userId:n.userId,userName:n.userName,message:n.message,timestamp:n.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),po(o),xo.current&&xo.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===Ue||void 0===Ue?void 0:Ue.id,a.db]);const jo=(0,t.useCallback)((async()=>{if(Ve)if(no)try{await Ve.screenShare.toggle(),Ve.screenShare.enabled?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(t){var e,o,n,r;console.error("Error toggling screen share:",t),"NotAllowedError"===t.name||null!==(e=t.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=t.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(n=t.message)&&void 0!==n&&n.includes("getDisplayMedia is not supported")||null!==(r=t.message)&&void 0!==r&&r.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(t.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[Ve,no]);(0,t.useEffect)((()=>{const e=()=>{ro(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const So=e=>{co((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))},ko=()=>{Ve&&Ve.camera.toggle()};(0,t.useEffect)((()=>{var e;null===(e=xo.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[ho]);const Ro=(0,t.useMemo)((()=>{if(!Ke||null===Ue||void 0===Ue||!Ue.ownerId)return[];const e=Ke.find((e=>e.userId===Ue.ownerId));return[...e?[e]:[],...Ke.filter((e=>ao.includes(e.userId)&&e.userId!==Ue.ownerId)),...Ke.filter((e=>e.userId!==Ue.ownerId&&!ao.includes(e.userId)))].filter(Boolean)}),[Ke,null===Ue||void 0===Ue?void 0:Ue.ownerId,ao]);(0,t.useEffect)((()=>{$e&&io(!0)}),[$e]);const Io=Ro;(0,t.useEffect)((()=>{if(null===Ke||void 0===Ke||!Ke.length)return;(async()=>{const e=Ke.filter((e=>!bo[e.userId])).map((e=>Ao(e.userId)));await Promise.all(e)})()}),[Ke,Ao,bo]);return(0,t.useEffect)((()=>{if(Ve&&null!==oo&&void 0!==oo&&oo.uid&&null!==Ue&&void 0!==Ue&&Ue.id&&"boolean"===typeof Qe&&a.db){const e=(0,d.H9)(a.db,"sideRooms",Ue.id,"presence",oo.uid),o="sideRooms/".concat(Ue.id,"/presence/").concat(oo.uid);console.log("[DEBUG Mute Sync] Attempting updateDoc to path:",o,"with data:",JSON.stringify({isMuted:Qe},null,2)),(0,d.mZ)(e,{isMuted:Qe}).then((()=>{console.log("[InsideStreamCallContent] Synced local mute state (".concat(Qe,") to Firestore for ").concat(oo.uid))})).catch((e=>{console.error("[InsideStreamCallContent] Error syncing local mute state to Firestore for ".concat(oo.uid,":"),e)}))}}),[Qe,Ve,null===oo||void 0===oo?void 0:oo.uid,null===Ue||void 0===Ue?void 0:Ue.id,a.db]),(0,t.useEffect)((()=>{if(!Ve||!Ke||0===Ke.length)return;const e=Ke.find((e=>e.screenShareStream));e&&(console.log("Screen sharing detected from: ".concat(e.name||e.userId)),console.log("Screen share stream should be visible to ALL participants"))}),[Ve,Ke]),Ve?(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===Ue||void 0===Ue||null===(o=Ue.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==Ue&&void 0!==Ue&&null!==(n=Ue.style)&&void 0!==n&&n.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Ue||void 0===Ue||null===(i=Ue.style)||void 0===i?void 0:i.backgroundColor)||_e.palette.background.default,", ").concat((null===Ue||void 0===Ue||null===(l=Ue.style)||void 0===l?void 0:l.accentColor)||_e.palette.secondary.main,")"):(null===Ue||void 0===Ue||null===(u=Ue.style)||void 0===u?void 0:u.backgroundColor)||_e.palette.background.default,color:(null===Ue||void 0===Ue||null===(f=Ue.style)||void 0===f?void 0:f.textColor)||_e.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[(()=>{var e,o,n,r,t,i,l,s,a;return(0,je.jsxs)(m.A,{sx:{p:1,borderBottom:1,borderColor:"divider",textAlign:"center",flexShrink:0,backgroundColor:null!==Ue&&void 0!==Ue&&null!==(e=Ue.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Ue||void 0===Ue||null===(o=Ue.style)||void 0===o?void 0:o.headerColor)||_e.palette.primary.main,", ").concat((null===Ue||void 0===Ue||null===(n=Ue.style)||void 0===n?void 0:n.accentColor)||_e.palette.secondary.light,")"):(null===Ue||void 0===Ue||null===(r=Ue.style)||void 0===r?void 0:r.headerColor)||(0,N.X4)(_e.palette.background.paper,.95),color:(null===Ue||void 0===Ue||null===(t=Ue.style)||void 0===t?void 0:t.textColor)||"inherit"},children:[(0,je.jsx)(h.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===Ue||void 0===Ue||null===(i=Ue.style)||void 0===i?void 0:i.font)||"inherit"},children:Ue.name}),(0,je.jsxs)(h.A,{variant:"caption",color:null!==Ue&&void 0!==Ue&&null!==(l=Ue.style)&&void 0!==l&&l.textColor?(0,N.X4)(null===Ue||void 0===Ue||null===(s=Ue.style)||void 0===s?void 0:s.textColor,.8):"text.secondary",sx:{fontFamily:(null===Ue||void 0===Ue||null===(a=Ue.style)||void 0===a?void 0:a.font)||"inherit"},children:["(Mic: ",Qe?"Muted":"On",")"]})]})})(),(0,je.jsxs)(m.A,{sx:{flexGrow:1,p:2},children:[fo&&(0,je.jsxs)(m.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,je.jsxs)(h.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===Ue||void 0===Ue||null===(y=Ue.style)||void 0===y?void 0:y.accentColor)||_e.palette.primary.main},children:[fo.userId===(null===oo||void 0===oo?void 0:oo.uid)?"You are sharing your screen":"".concat(fo.name||"Someone"," is sharing their screen"),yo&&fo.userId!==(null===oo||void 0===oo?void 0:oo.uid)&&" (Room Owner)"]}),(0,je.jsxs)(m.A,{sx:{m:0,p:0,border:"1px solid",borderColor:"divider",borderRadius:"8px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:"auto",width:"90%",maxWidth:"1200px",margin:"0 auto",marginTop:2,marginBottom:2,overflow:"hidden",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:[!lo&&(0,je.jsx)(m.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none","& .str-video__screen-share-info":{display:"none !important",visibility:"hidden !important",opacity:0,height:0,overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:-9999},'& .str-video__participant-details, & .str-video__participant-bar, & .str-video__loading-indicator, & .str-video__screen-share-text, & .str-video__screen-share-status, & .str-video__participant__name, & .str-video__participant__info, & .str-video__participant-flag, & div[class*="screen-share"], & span[class*="presentation"]':{display:"none !important",visibility:"hidden !important",opacity:0,height:0,width:0,overflow:"hidden",pointerEvents:"none"},"& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"contain",background:"#000"},"& .str-video__participant-details":{display:"none !important"},"& .str-video__participant-status":{display:"none !important"},"& .str-video__participant-flag-container":{display:"none !important"}}},children:(0,je.jsx)(Re.fSl,{participant:fo,trackType:"screenShareTrack"})}),fo&&!lo&&(0,je.jsx)(m.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:-1,opacity:0,pointerEvents:"none"},children:(0,je.jsx)("video",{autoPlay:!0,playsInline:!0,ref:e=>{e&&null!==fo&&void 0!==fo&&fo.screenShareStream&&e.srcObject!==fo.screenShareStream&&(e.srcObject=fo.screenShareStream,e.play().catch((e=>console.error("Error playing screen share:",e))))}})}),lo&&to&&qe&&(0,je.jsxs)(m.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none",backgroundColor:"#000","& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[$e?(0,je.jsx)(Re.fSl,{participant:qe,trackType:"videoTrack"}):(0,je.jsx)(m.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,je.jsx)(pe.A,{sx:{fontSize:"5rem"}})}),(0,je.jsx)(v.A,{size:"medium",onClick:ko,sx:{position:"absolute",top:16,right:80,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:$e?(0,je.jsx)(ve.A,{}):(0,je.jsx)(pe.A,{})}),(0,je.jsx)(v.A,{size:"medium",onClick:()=>so(!1),sx:{position:"absolute",top:16,right:16,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,je.jsx)(ge.A,{})})]}),(0,je.jsx)(m.A,{sx:{position:"absolute",top:10,right:10,zIndex:10},children:Te&&(0,je.jsx)(C.A,{variant:"contained",color:"error",size:"small",startIcon:(0,je.jsx)(oe.A,{}),onClick:jo,sx:{borderRadius:"20px",textTransform:"none",py:.5,px:1.5,bgcolor:"error.main",fontWeight:"bold",minWidth:0,boxShadow:"0 2px 5px rgba(0,0,0,0.3)",fontFamily:(null===Ue||void 0===Ue||null===(b=Ue.style)||void 0===b?void 0:b.font)||"inherit"},children:"Stop"})}),!lo&&to&&qe&&(0,je.jsxs)(m.A,{sx:{position:"absolute",bottom:16,right:16,width:"160px",height:"90px",borderRadius:"8px",overflow:"hidden",border:"2px solid",borderColor:"primary.main",backgroundColor:"#000",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[$e?(0,je.jsx)(Re.fSl,{participant:qe,trackType:"videoTrack"}):(0,je.jsx)(m.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,je.jsx)(pe.A,{sx:{fontSize:"1.5rem"}})}),(0,je.jsx)(v.A,{size:"small",onClick:ko,sx:{position:"absolute",top:2,right:26,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:$e?(0,je.jsx)(ve.A,{sx:{fontSize:"0.9rem"}}):(0,je.jsx)(pe.A,{sx:{fontSize:"0.9rem"}})}),(0,je.jsx)(v.A,{size:"small",onClick:()=>so(!0),sx:{position:"absolute",top:2,right:2,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,je.jsx)(xe.A,{sx:{fontSize:"0.9rem"}})})]})]})]}),We&&(0,je.jsxs)(m.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,je.jsx)(h.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===Ue||void 0===Ue||null===(w=Ue.style)||void 0===w?void 0:w.font)||"inherit",color:(null===Ue||void 0===Ue||null===(k=Ue.style)||void 0===k?void 0:k.textColor)||"inherit"},children:"Shared Video"}),Te&&(0,je.jsx)(p.A,{title:"Clear Shared Video",children:(0,je.jsx)(v.A,{onClick:()=>ze(),size:"small",sx:{color:(null===Ue||void 0===Ue||null===(R=Ue.style)||void 0===R?void 0:R.accentColor)||"inherit"},children:(0,je.jsx)(ie.A,{})})})]}),(0,je.jsx)(m.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Le(We)})]}),(0,je.jsx)(m.A,{sx:{mb:2,borderBottom:1,borderColor:"divider"},children:(0,je.jsxs)(M.A,{value:uo,onChange:(e,o)=>mo(o),"aria-label":"room content tabs",sx:{"& .MuiTab-root":{fontFamily:(null===Ue||void 0===Ue||null===(I=Ue.style)||void 0===I?void 0:I.font)||"inherit",color:(null===Ue||void 0===Ue||null===(F=Ue.style)||void 0===F?void 0:F.textColor)||"inherit",opacity:.7},"& .Mui-selected":{color:"".concat((null===Ue||void 0===Ue||null===(P=Ue.style)||void 0===P?void 0:P.accentColor)||_e.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===Ue||void 0===Ue||null===(U=Ue.style)||void 0===U?void 0:U.accentColor)||_e.palette.primary.main}},children:[(0,je.jsx)(_.A,{label:"Participants (".concat(Io.length,")"),value:"participants"}),(0,je.jsx)(_.A,{label:"Chat",value:"chat",icon:(0,je.jsx)(g.A,{color:"primary",variant:"dot",invisible:"chat"===uo||0===ho.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===Ue||void 0===Ue||null===(D=Ue.style)||void 0===D?void 0:D.accentColor)||_e.palette.primary.main}}}),iconPosition:"end"})]})}),"participants"===uo&&(0,je.jsxs)(je.Fragment,{children:[Io.length>0&&(0,je.jsx)(Re.ncL,{participants:Io}),(0,je.jsx)(j.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Io.map((e=>{const o=e.userId===Ue.ownerId;return(0,je.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,je.jsx)(He,{participant:e,isRoomOwner:Te,isLocalParticipant:e.userId===(null===oo||void 0===oo?void 0:oo.uid),localUserAuthData:oo,onForceMuteToggle:Ge,onForceRemove:Be,onForceBan:Me,call:Ve,localUserIsMute:Qe,isDesignatedHost:o,onPinToggle:So,isPinned:ao.includes(e.userId),roomStyle:null===Ue||void 0===Ue?void 0:Ue.style,navigate:Ne})},e.userId)}))}),0===Io.length&&(0,je.jsx)(h.A,{sx:{width:"100%",textAlign:"center",color:null!==Ue&&void 0!==Ue&&null!==(O=Ue.style)&&void 0!==O&&O.textColor?(0,N.X4)(null===Ue||void 0===Ue||null===(z=Ue.style)||void 0===z?void 0:z.textColor,.7):_e.palette.text.secondary,mt:4,fontFamily:(null===Ue||void 0===Ue||null===(W=Ue.style)||void 0===W?void 0:W.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===uo&&(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==Ue&&void 0!==Ue&&null!==(L=Ue.style)&&void 0!==L&&L.accentColor?(0,N.X4)(null===Ue||void 0===Ue||null===(H=Ue.style)||void 0===H?void 0:H.accentColor,.3):_e.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,je.jsxs)(m.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==Ue&&void 0!==Ue&&null!==(G=Ue.style)&&void 0!==G&&G.accentColor?(0,N.X4)(null===Ue||void 0===Ue||null===(B=Ue.style)||void 0===B?void 0:B.accentColor,.3):_e.palette.divider),bgcolor:null!==Ue&&void 0!==Ue&&null!==(V=Ue.style)&&void 0!==V&&V.headerColor?(0,N.X4)(null===Ue||void 0===Ue||null===(X=Ue.style)||void 0===X?void 0:X.headerColor,.1):(0,N.X4)(_e.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,je.jsxs)(h.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===Ue||void 0===Ue||null===(Z=Ue.style)||void 0===Z?void 0:Z.font)||"inherit",color:(null===Ue||void 0===Ue||null===(Y=Ue.style)||void 0===Y?void 0:Y.textColor)||"inherit"},children:["Users in Room (",Io.length,")"]}),(0,je.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Io.map((e=>{var o,n,r,t,i,l;const s=bo[e.userId],a=(null===s||void 0===s?void 0:s.username)||e.name||e.userId.substring(0,8),d=(null===s||void 0===s?void 0:s.avatar)||e.image;return(0,je.jsx)(T.A,{size:"small",label:a,avatar:(0,je.jsx)(x.A,{src:d,alt:a,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===Ue.ownerId?(0,N.X4)((null===Ue||void 0===Ue||null===(o=Ue.style)||void 0===o?void 0:o.accentColor)||_e.palette.secondary.main,.1):(0,N.X4)((null===Ue||void 0===Ue||null===(n=Ue.style)||void 0===n?void 0:n.headerColor)||_e.palette.primary.main,.05),borderColor:e.userId===Ue.ownerId?(null===Ue||void 0===Ue||null===(r=Ue.style)||void 0===r?void 0:r.accentColor)||_e.palette.secondary.main:(null===Ue||void 0===Ue||null===(t=Ue.style)||void 0===t?void 0:t.headerColor)||_e.palette.primary.main,border:"1px solid",color:(null===Ue||void 0===Ue||null===(i=Ue.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===Ue||void 0===Ue||null===(l=Ue.style)||void 0===l?void 0:l.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,je.jsx)(m.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==Ue&&void 0!==Ue&&null!==(K=Ue.style)&&void 0!==K&&K.backgroundGradient?(0,N.X4)((null===Ue||void 0===Ue||null===(q=Ue.style)||void 0===q?void 0:q.backgroundColor)||_e.palette.background.default,.3):(0,N.X4)(_e.palette.background.paper,.5)},children:0===ho.length?(0,je.jsx)(h.A,{variant:"body2",color:null!==Ue&&void 0!==Ue&&null!==(Q=Ue.style)&&void 0!==Q&&Q.textColor?(0,N.X4)(null===Ue||void 0===Ue||null===($=Ue.style)||void 0===$?void 0:$.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===Ue||void 0===Ue||null===(ne=Ue.style)||void 0===ne?void 0:ne.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,je.jsxs)(je.Fragment,{children:[ho.map((e=>{var o,n,r,t,i,l,s,a,d,c,u;return(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:e.userId===(null===oo||void 0===oo?void 0:oo.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===oo||void 0===oo?void 0:oo.uid)&&(0,je.jsx)(x.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=bo[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,je.jsxs)(m.A,{children:[(0,je.jsx)(h.A,{variant:"caption",color:null!==Ue&&void 0!==Ue&&null!==(n=Ue.style)&&void 0!==n&&n.textColor?(0,N.X4)(null===Ue||void 0===Ue||null===(r=Ue.style)||void 0===r?void 0:r.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===oo||void 0===oo?void 0:oo.uid)?"right":"left",fontFamily:(null===Ue||void 0===Ue||null===(t=Ue.style)||void 0===t?void 0:t.font)||"inherit"},children:e.userName}),(0,je.jsx)(S.A,{sx:{p:1,bgcolor:e.userId===(null===oo||void 0===oo?void 0:oo.uid)?(null===Ue||void 0===Ue||null===(i=Ue.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===oo||void 0===oo?void 0:oo.uid)?null!==Ue&&void 0!==Ue&&null!==(l=Ue.style)&&void 0!==l&&l.accentColor?_e.palette.getContrastText(Ue.style.accentColor):"primary.contrastText":(null===Ue||void 0===Ue||null===(s=Ue.style)||void 0===s?void 0:s.textColor)||"text.primary",borderRadius:e.userId===(null===oo||void 0===oo?void 0:oo.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===Ue||void 0===Ue||null===(a=Ue.style)||void 0===a?void 0:a.font)||"inherit"},children:(0,je.jsx)(h.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,je.jsx)(h.A,{variant:"caption",color:null!==Ue&&void 0!==Ue&&null!==(d=Ue.style)&&void 0!==d&&d.textColor?(0,N.X4)(null===Ue||void 0===Ue||null===(c=Ue.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===oo||void 0===oo?void 0:oo.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===Ue||void 0===Ue||null===(u=Ue.style)||void 0===u?void 0:u.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,je.jsx)("div",{ref:xo})]})}),(0,je.jsx)(m.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==Ue&&void 0!==Ue&&null!==(re=Ue.style)&&void 0!==re&&re.accentColor?(0,N.X4)(null===Ue||void 0===Ue||null===(se=Ue.style)||void 0===se?void 0:se.accentColor,.3):_e.palette.divider),bgcolor:(null===Ue||void 0===Ue||null===(ae=Ue.style)||void 0===ae?void 0:ae.headerColor)||_e.palette.background.paper,display:"flex"},children:(0,je.jsx)(E.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:vo,onChange:e=>go(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),wo())},InputProps:{sx:{fontFamily:(null===Ue||void 0===Ue||null===(de=Ue.style)||void 0===de?void 0:de.font)||"inherit",color:(null===Ue||void 0===Ue||null===(ce=Ue.style)||void 0===ce?void 0:ce.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==Ue&&void 0!==Ue&&null!==(ue=Ue.style)&&void 0!==ue&&ue.accentColor?(0,N.X4)(null===Ue||void 0===Ue||null===(me=Ue.style)||void 0===me?void 0:me.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==Ue&&void 0!==Ue&&null!==(he=Ue.style)&&void 0!==he&&he.accentColor?(0,N.X4)(null===Ue||void 0===Ue||null===(be=Ue.style)||void 0===be?void 0:be.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===Ue||void 0===Ue||null===(Ce=Ue.style)||void 0===Ce?void 0:Ce.accentColor)||_e.palette.primary.main}},endAdornment:(0,je.jsx)(v.A,{size:"small",onClick:wo,disabled:!vo.trim(),color:"primary",sx:{color:(null===Ue||void 0===Ue||null===(Ae=Ue.style)||void 0===Ae?void 0:Ae.accentColor)||"primary"},children:(0,je.jsx)(fe.A,{fontSize:"small"})})}})})]})]}),(0,je.jsxs)(m.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(_e.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===Ue||void 0===Ue||null===(we=Ue.style)||void 0===we?void 0:we.headerColor)||_e.palette.background.paper},children:[(0,je.jsx)(C.A,{variant:"outlined",color:"error",startIcon:(0,je.jsx)(ee.A,{}),onClick:()=>{null===Ve||void 0===Ve||Ve.leave().then((()=>Ne("/side-rooms")))},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===Ue||void 0===Ue||null===(Se=Ue.style)||void 0===Se?void 0:Se.font)||"inherit"},children:"Leave quietly"}),Te&&(0,je.jsx)(p.A,{title:Qe?"Unmute Microphone":"Mute Microphone",children:(0,je.jsx)(v.A,{onClick:()=>null===Ve||void 0===Ve?void 0:Ve.microphone.toggle(),color:Qe?"default":"primary",sx:{ml:2,color:Qe?"default":(null===Ue||void 0===Ue||null===(ke=Ue.style)||void 0===ke?void 0:ke.accentColor)||"primary.main"},disabled:!Ve,children:Qe?(0,je.jsx)(le.A,{}):(0,je.jsx)(te.A,{})})}),Te&&(0,je.jsx)(p.A,{title:$e?"Turn Camera Off":"Turn Camera On",children:(0,je.jsx)(v.A,{onClick:ko,color:$e?"primary":"default",sx:{ml:1,color:$e?(null===Ue||void 0===Ue||null===(Ee=Ue.style)||void 0===Ee?void 0:Ee.accentColor)||"primary.main":"default"},disabled:!Ve,children:$e?(0,je.jsx)(ve.A,{}):(0,je.jsx)(pe.A,{})})}),Te&&(0,je.jsx)(p.A,{title:to?"Hide Camera Window":"Show Camera Window",children:(0,je.jsx)(v.A,{onClick:()=>io(!to),color:to?"primary":"default",sx:{ml:1,color:to?(null===Ue||void 0===Ue||null===(Fe=Ue.style)||void 0===Fe?void 0:Fe.accentColor)||"primary.main":"default"},disabled:!Ve||!$e,children:(0,je.jsx)(ye.A,{})})}),Te&&(0,je.jsx)(p.A,{title:"Share Video Link",children:(0,je.jsx)("span",{children:(0,je.jsx)(v.A,{onClick:()=>Oe(),color:"secondary",sx:{ml:2,color:(null===Ue||void 0===Ue||null===(Pe=Ue.style)||void 0===Pe?void 0:Pe.accentColor)||_e.palette.secondary.main},children:(0,je.jsx)(J.A,{})})})})]})]}):(0,je.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,je.jsx)(A.A,{}),(0,je.jsx)(h.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},He=t.memo((e=>{let{participant:o,isRoomOwner:n,isLocalParticipant:r,onForceMuteToggle:i,onForceRemove:g,onForceBan:A,call:w,localUserAuthData:j,localUserIsMute:S,isDesignatedHost:E,onPinToggle:D,isPinned:O,roomStyle:z,navigate:W}=e;const L=(0,u.A)(),{isSpeaking:H,publishedTracks:G}=o,{blockUser:M,currentUser:_}=(0,s.As)(),V=!G.includes("audio")&&!H,[X,Z]=(0,t.useState)(null),Y=Boolean(X),J=e=>Z(e.currentTarget),q=()=>Z(null),Q=async()=>{if(r&&w)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",S),await w.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),n&&null!==j&&void 0!==j&&j.uid){const e=w.cid,o=(0,d.aU)(),n=(0,d.H9)(o,"sideRooms",e),r=!w.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!r)),await(0,d.mZ)(n,{isLive:!r,lastActive:(0,d.O5)()})}}catch(e){console.error("[StreamParticipantCard] Error toggling local microphone:",e),c.oR.error("Failed to toggle microphone. See console.")}};let $,ee;const oe=o.custom;r&&j?($=j.displayName||j.email||o.userId,ee=j.photoURL||o.image||void 0):oe&&"string"===typeof oe.displayName&&""!==oe.displayName.trim()?($=oe.displayName,ee=oe.customAvatarUrl&&"string"===typeof oe.customAvatarUrl&&""!==oe.customAvatarUrl.trim()?oe.customAvatarUrl:o.image||void 0):($=o.name||o.userId,ee=o.image||void 0),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:n,isLocalParticipant:r,localUserAuthData:j}),console.log("[StreamParticipantCard] Determined values - displayName:",$,"avatarUrl:",ee,"isSpeaking:",H,"participantIsMuted:",V),r&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",j,"Stream participant.userId:",o.userId);const[ne,ie]=(0,t.useState)(!1);return(0,je.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{const e=(0,je.jsx)(x.A,{src:ee,alt:$,sx:{width:64,height:64,mb:.5,border:H?"3px solid ".concat(L.palette.success.main):"2px solid ".concat((0,N.X4)(L.palette.divider,.5)),boxShadow:H?"0 0 8px ".concat(L.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer"}});return r?(0,je.jsx)(m.A,{onClick:Q,sx:{cursor:"pointer"},children:e}):(0,je.jsx)(l.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:e})})(),E&&(0,je.jsx)(T.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(r?null===S||void 0===S||S:V)&&(0,je.jsx)(le.A,{sx:{fontSize:"1rem",color:L.palette.error.contrastText,backgroundColor:(0,N.X4)(L.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),r&&!S&&(0,je.jsx)(te.A,{sx:{fontSize:"1rem",color:L.palette.success.contrastText,backgroundColor:(0,N.X4)(L.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,je.jsx)(h.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:L.palette.text.primary},children:$}),n&&!r&&(0,je.jsxs)(m.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,je.jsx)(p.A,{title:"Manage User",children:(0,je.jsx)(v.A,{onClick:J,size:"small",sx:{backgroundColor:(0,N.X4)(L.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,je.jsx)(K.A,{fontSize:"small"})})}),(0,je.jsxs)(f.A,{anchorEl:X,open:Y,onClose:q,MenuListProps:{dense:!0},children:[(0,je.jsxs)(y.A,{onClick:async()=>{q(),i&&i(o.userId,!o.publishedTracks.includes("audio"))},sx:{fontSize:"0.8rem"},children:[(0,je.jsx)(b.A,{sx:{minWidth:"30px"},children:V?(0,je.jsx)(re.A,{fontSize:"small"}):(0,je.jsx)(be.A,{fontSize:"small"})}),V?"Unmute":"Mute"]}),(0,je.jsxs)(y.A,{onClick:()=>{q(),D(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,je.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,je.jsx)(Ce.A,{fontSize:"small",color:O?"primary":"inherit"})}),O?"Unpin from top":"Pin to top"]}),(0,je.jsxs)(y.A,{onClick:async()=>{if(q(),window.confirm("Are you sure you want to block ".concat(o.name||o.userId,"?")))try{await M(o.userId),c.oR.success("Blocked ".concat(o.name||o.userId)),g&&g(o.userId,o.name||o.userId)}catch(e){console.error("Error blocking user:",e),c.oR.error("Failed to block user")}},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,je.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,je.jsx)(Ae.A,{fontSize:"small",color:"error"})}),"Block"]})]})]}),!n&&!r&&(0,je.jsxs)(m.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,je.jsx)(p.A,{title:"Options",children:(0,je.jsx)(v.A,{onClick:J,size:"small",sx:{backgroundColor:(0,N.X4)(L.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,je.jsx)(K.A,{fontSize:"small"})})}),(0,je.jsx)(f.A,{anchorEl:X,open:Y,onClose:q,MenuListProps:{dense:!0},children:(0,je.jsxs)(y.A,{onClick:()=>{q(),ie(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,je.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,je.jsx)(we.A,{fontSize:"small",color:"warning"})}),"Report User"]})})]}),O&&!E&&(0,je.jsx)(p.A,{title:"Pinned",children:(0,je.jsx)(Ce.A,{sx:{fontSize:"1rem",color:L.palette.primary.contrastText,backgroundColor:(0,N.X4)(L.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,je.jsxs)(k.A,{open:ne,onClose:()=>ie(!1),children:[(0,je.jsx)(R.A,{children:"Report User"}),(0,je.jsxs)(I.A,{children:[(0,je.jsxs)(h.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,je.jsx)(P.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,je.jsx)(U.Ay,{onClick:()=>(async e=>{try{const n={reportedUserId:o.userId,reportedBy:null===_||void 0===_?void 0:_.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)(a.db,"reports"),n),c.oR.success("Report submitted for ".concat(o.name||o.userId)),ie(!1)}catch(n){console.error("Error submitting report:",n),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,N.X4)(L.palette.primary.main,.1)}},children:(0,je.jsx)(B.A,{primary:e})},e)))})]}),(0,je.jsx)(F.A,{children:(0,je.jsx)(C.A,{onClick:()=>ie(!1),children:"Cancel"})})]})]})}))}}]);