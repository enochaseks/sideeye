"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[594],{598:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(3235),n=o(4414);const a=(0,t.A)((0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5m-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11m3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5"}),"InsertEmoticon")},760:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(3235),n=o(4414);const a=(0,t.A)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},1227:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(3235),n=o(4414);const a=(0,t.A)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},2594:(e,r,o)=>{o.r(r),o.d(r,{default:()=>ee});var t=o(9379),n=o(9950),a=o(9254),i=o(4857),s=o(6589),l=o(6080),c=o(6491),d=o(2053),u=o(5277),m=o(8060),p=o(3239),h=o(5333),x=o(1413),g=o(6639),b=o(3274),f=o(226),v=o(3174),y=o(6699),j=o(4745),A=o(8145),w=o(7591),k=o(3266),C=o(6583),S=o(33),R=o(8170),I=o(6493),z=o(9739),M=o(4862),E=o(2362),U=o(249),P=o(6050),D=o(3235),H=o(4414);const L=(0,D.A)((0,H.jsx)("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}),"ThumbUp");var B=o(7443);const T=(0,D.A)([(0,H.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,H.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,H.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m-5-6c.78 2.34 2.72 4 5 4s4.22-1.66 5-4z"},"2")],"SentimentVerySatisfied"),q=(0,D.A)([(0,H.jsx)("circle",{cx:"15.5",cy:"9.5",r:"1.5"},"0"),(0,H.jsx)("circle",{cx:"8.5",cy:"9.5",r:"1.5"},"1"),(0,H.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m0-6c-2.33 0-4.32 1.45-5.12 3.5h1.67c.69-1.19 1.97-2 3.45-2s2.75.81 3.45 2h1.67c-.8-2.05-2.79-3.5-5.12-3.5"},"2")],"SentimentVeryDissatisfied");var O=o(4801),N=o(760),W=o(1227),F=o(9885),Z=o(3256),G=o(598),Y=o(8429),X=o(1367),J=o(6220),V=o(330),_=o(9751),K=o(5887),Q=o(4570);const $=(0,a.Ay)("input")({display:"none"}),ee=()=>{var e,r,o,a;const{conversationId:D,userId:ee}=(0,Y.g)(),{currentUser:re}=(0,X.As)(),oe=(0,Y.Zp)(),[te,ne]=(0,n.useState)(!0),[ae,ie]=(0,n.useState)([]),[se,le]=(0,n.useState)(""),[ce,de]=(0,n.useState)(null),[ue,me]=(0,n.useState)(null),pe=(0,n.useRef)(null),{addNotification:he}=(0,Q.E)(),[xe,ge]=(0,n.useState)(!1),[be,fe]=(0,n.useState)(""),[ve,ye]=(0,n.useState)(!1),[je,Ae]=(0,n.useState)(null),[we,ke]=(0,n.useState)(!1),Ce=(0,n.useRef)(null),[Se,Re]=(0,n.useState)(null),[Ie,ze]=(0,n.useState)(!1),[Me,Ee]=(0,n.useState)(null),[Ue,Pe]=(0,n.useState)(null),[De,He]=(0,n.useState)({anchorEl:null,message:null}),[Le,Be]=(0,n.useState)({anchorEl:null,message:null,emoji:null}),[Te,qe]=(0,n.useState)("recent"),Oe=[{emoji:"\ud83d\udc4d",icon:(0,H.jsx)(L,{}),label:"Like"},{emoji:"\u2764\ufe0f",icon:(0,H.jsx)(B.A,{}),label:"Love"},{emoji:"\ud83d\ude00",icon:(0,H.jsx)(T,{}),label:"Happy"},{emoji:"\ud83d\ude14",icon:(0,H.jsx)(q,{}),label:"Sad"},{emoji:"\ud83d\udc40",icon:null,label:"Eyes"},{emoji:"\ud83e\udd2c",icon:null,label:"Angry"},{emoji:"\ud83e\udd14",icon:null,label:"Thinking"},{emoji:"\ud83e\udd37\u200d\u2642\ufe0f",icon:null,label:"Shrug"},{emoji:"\ud83e\udd37\u200d\u2640\ufe0f",icon:null,label:"Shrug"},{emoji:"\ud83e\udd37",icon:null,label:"Shrug"},{emoji:"\ud83e\udd37\u200d\u2642\ufe0f",icon:null,label:"Shrug"},{emoji:"\ud83e\udd37\u200d\u2640\ufe0f",icon:null,label:"Shrug"},{emoji:"\ud83e\udd37",icon:null,label:"Shrug"},{emoji:"\ud83e\udd22",icon:null,label:"Disgusted"},{emoji:"\ud83e\udd2e",icon:null,label:"Vomit"},{emoji:"\ud83e\udd27",icon:null,label:"Sick"},{emoji:"\ud83e\udd12",icon:null,label:"Sick"},{emoji:"\ud83e\udd15",icon:null,label:"Sick"},{emoji:"\ud83e\udd16",icon:null,label:"Robot"}],Ne=[{id:"recent",name:"Recent",icon:"\ud83d\udd52",emojis:Oe.map((e=>e.emoji)).slice(0,8)},{id:"smileys",name:"Smileys",icon:"\ud83d\ude00",emojis:["\ud83d\ude00","\ud83d\ude03","\ud83d\ude04","\ud83d\ude01","\ud83d\ude06","\ud83d\ude05","\ud83e\udd23","\ud83d\ude02","\ud83d\ude42","\ud83d\ude43","\ud83d\ude09","\ud83d\ude0a","\ud83d\ude07","\ud83d\ude0d","\ud83e\udd70","\ud83d\ude18","\ud83d\ude17","\ud83d\ude19","\ud83d\ude1a","\ud83d\ude0b","\ud83d\ude1b","\ud83d\ude1c","\ud83d\ude1d","\ud83e\udd11","\ud83e\udd17","\ud83e\udd2d","\ud83e\udd2b","\ud83e\udd14","\ud83e\udd10","\ud83e\udd28","\ud83d\ude10","\ud83d\ude11","\ud83d\ude36","\ud83d\ude0f","\ud83d\ude12","\ud83d\ude44","\ud83d\ude2c","\ud83e\udd25","\ud83d\ude0c","\ud83d\ude14","\ud83d\ude2a","\ud83e\udd24","\ud83d\ude34","\ud83d\ude37","\ud83e\udd12","\ud83e\udd15","\ud83e\udd22","\ud83e\udd2e","\ud83e\udd27","\ud83e\udd75","\ud83e\udd76","\ud83e\udd74","\ud83d\ude35","\ud83e\udd2f","\ud83e\udd20","\ud83e\udd73","\ud83d\ude0e","\ud83e\udd13","\ud83e\uddd0","\ud83d\ude15","\ud83d\ude1f","\ud83d\ude41","\u2639\ufe0f","\ud83d\ude2e","\ud83d\ude2f","\ud83d\ude32","\ud83d\ude33","\ud83e\udd7a","\ud83d\ude26","\ud83d\ude27","\ud83d\ude28","\ud83d\ude30","\ud83d\ude25","\ud83d\ude22","\ud83d\ude2d","\ud83d\ude31","\ud83d\ude16","\ud83d\ude23","\ud83d\ude1e","\ud83d\ude13","\ud83d\ude29","\ud83d\ude2b","\ud83e\udd71","\ud83d\ude24","\ud83d\ude21","\ud83d\ude20","\ud83e\udd2c"]},{id:"gestures",name:"Gestures",icon:"\ud83d\udc4d",emojis:["\ud83d\udc4d","\ud83d\udc4e","\ud83d\udc4c","\u270c\ufe0f","\ud83e\udd1e","\ud83e\udd1f","\ud83e\udd18","\ud83d\udc4a","\ud83d\udc4b","\ud83d\ude4c","\ud83d\udc50","\ud83e\udd32","\ud83d\ude4f","\u270b","\ud83e\udd1a","\ud83d\udc46","\ud83d\udc47","\ud83d\udc48","\ud83d\udc49","\ud83d\udcaa","\ud83e\uddbe","\ud83d\udc4f","\ud83d\ude4f","\ud83e\udd1d","\ud83e\udd1c","\ud83e\udd1b","\u270d\ufe0f","\ud83d\udc4b","\ud83d\udc50","\ud83e\udd32","\ud83e\udd1d","\ud83d\ude4f","\ud83d\udc85","\ud83e\udd33"]},{id:"love",name:"Love",icon:"\u2764\ufe0f",emojis:["\u2764\ufe0f","\ud83e\udde1","\ud83d\udc9b","\ud83d\udc9a","\ud83d\udc99","\ud83d\udc9c","\ud83d\udda4","\ud83e\udd0d","\ud83e\udd0e","\ud83d\udc94","\u2763\ufe0f","\ud83d\udc95","\ud83d\udc9e","\ud83d\udc93","\ud83d\udc97","\ud83d\udc96","\ud83d\udc98","\ud83d\udc9d","\ud83d\udc9f","\u2665\ufe0f","\ud83d\udc8c","\ud83d\udc8b","\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68","\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69","\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68"]},{id:"animals",name:"Animals",icon:"\ud83d\udc31",emojis:["\ud83d\udc36","\ud83d\udc31","\ud83d\udc2d","\ud83d\udc39","\ud83d\udc30","\ud83e\udd8a","\ud83d\udc3b","\ud83d\udc3c","\ud83d\udc28","\ud83d\udc2f","\ud83e\udd81","\ud83d\udc2e","\ud83d\udc37","\ud83d\udc38","\ud83d\udc35","\ud83d\ude48","\ud83d\ude49","\ud83d\ude4a","\ud83d\udc14","\ud83d\udc27","\ud83d\udc26","\ud83d\udc24","\ud83e\udd86","\ud83e\udd85","\ud83e\udd89","\ud83e\udd87","\ud83d\udc3a","\ud83d\udc17","\ud83d\udc34","\ud83e\udd84","\ud83d\udc1d","\ud83d\udc1b","\ud83e\udd8b","\ud83d\udc0c","\ud83d\udc1e","\ud83d\udc1c","\ud83e\udd9f","\ud83e\udd97","\ud83d\udd77","\ud83d\udd78","\ud83e\udd82","\ud83d\udc22","\ud83d\udc0d","\ud83e\udd8e","\ud83e\udd96","\ud83e\udd95","\ud83d\udc19","\ud83e\udd91","\ud83e\udd90","\ud83e\udd9e","\ud83e\udd80","\ud83d\udc21","\ud83d\udc20","\ud83d\udc1f","\ud83d\udc2c","\ud83d\udc33","\ud83d\udc0b","\ud83e\udd88","\ud83d\udc0a","\ud83d\udc05","\ud83d\udc06","\ud83e\udd93","\ud83e\udd8d","\ud83e\udda7","\ud83d\udc18","\ud83e\udd9b","\ud83e\udd8f","\ud83d\udc2a","\ud83d\udc2b","\ud83e\udd92","\ud83e\udd98","\ud83d\udc03","\ud83d\udc02","\ud83d\udc04","\ud83d\udc0e","\ud83d\udc16","\ud83d\udc0f","\ud83d\udc11","\ud83e\udd99","\ud83d\udc10","\ud83e\udd8c","\ud83d\udc15","\ud83d\udc29","\ud83e\uddae","\ud83d\udc15\u200d\ud83e\uddba","\ud83d\udc08","\ud83e\udd83","\ud83e\udd9a","\ud83e\udd9c","\ud83e\udda2","\ud83e\udda9","\ud83d\udd4a","\ud83d\udc07","\ud83e\udd9d","\ud83e\udda8","\ud83e\udda1","\ud83e\udda6","\ud83e\udda5","\ud83d\udc01","\ud83d\udc00","\ud83d\udc3f","\ud83e\udd94"]},{id:"food",name:"Food",icon:"\ud83c\udf54",emojis:["\ud83c\udf4f","\ud83c\udf4e","\ud83c\udf50","\ud83c\udf4a","\ud83c\udf4b","\ud83c\udf4c","\ud83c\udf49","\ud83c\udf47","\ud83c\udf53","\ud83c\udf48","\ud83c\udf52","\ud83c\udf51","\ud83e\udd6d","\ud83c\udf4d","\ud83e\udd65","\ud83e\udd5d","\ud83c\udf45","\ud83c\udf46","\ud83e\udd51","\ud83e\udd66","\ud83e\udd6c","\ud83e\udd52","\ud83c\udf36","\ud83c\udf3d","\ud83e\udd55","\ud83e\udd54","\ud83c\udf60","\ud83e\udd50","\ud83e\udd6f","\ud83c\udf5e","\ud83e\udd56","\ud83e\udd68","\ud83e\uddc0","\ud83e\udd5a","\ud83c\udf73","\ud83e\udd5e","\ud83e\uddc7","\ud83e\udd53","\ud83e\udd69","\ud83c\udf57","\ud83c\udf56","\ud83e\uddb4","\ud83c\udf2d","\ud83c\udf54","\ud83c\udf5f","\ud83c\udf55","\ud83e\udd6a","\ud83e\udd59","\ud83e\uddc6","\ud83c\udf2e","\ud83c\udf2f","\ud83e\udd57","\ud83e\udd58","\ud83e\udd6b","\ud83c\udf5d","\ud83c\udf5c","\ud83c\udf72","\ud83c\udf5b","\ud83c\udf63","\ud83c\udf71","\ud83e\udd5f","\ud83e\uddaa","\ud83c\udf64","\ud83c\udf59","\ud83c\udf5a","\ud83c\udf58","\ud83c\udf65","\ud83e\udd60","\ud83e\udd6e","\ud83c\udf62","\ud83c\udf61","\ud83c\udf67","\ud83c\udf68","\ud83c\udf66","\ud83e\udd67","\ud83e\uddc1","\ud83c\udf70","\ud83c\udf82","\ud83c\udf6e","\ud83c\udf6d","\ud83c\udf6c","\ud83c\udf6b","\ud83c\udf7f","\ud83c\udf69","\ud83c\udf6a","\ud83c\udf30","\ud83e\udd5c","\ud83c\udf6f","\ud83e\udd5b","\ud83c\udf7c","\u2615\ufe0f","\ud83c\udf75","\ud83e\uddc3","\ud83e\udd64","\ud83c\udf76","\ud83c\udf7a","\ud83c\udf7b","\ud83e\udd42","\ud83c\udf77","\ud83e\udd43","\ud83c\udf78","\ud83c\udf79","\ud83e\uddc9","\ud83c\udf7e","\ud83e\uddca"]}],[We,Fe]=(0,n.useState)(!1),Ze=["\ud83d\ude00","\ud83d\ude01","\ud83d\ude02","\ud83e\udd23","\ud83d\ude03","\ud83d\ude04","\ud83d\ude05","\ud83d\ude06","\ud83d\ude09","\ud83d\ude0a","\ud83d\ude0b","\ud83d\ude0e","\ud83d\ude0d","\ud83e\udd70","\ud83d\ude18","\ud83d\ude17","\ud83d\ude19","\ud83d\ude1a","\ud83d\ude42","\ud83e\udd17","\ud83e\udd14","\ud83e\udd28","\ud83d\ude10","\ud83d\ude11","\ud83d\ude36","\ud83d\ude44","\ud83d\ude0f","\ud83d\ude23","\ud83d\ude25","\ud83d\ude2e","\ud83d\udc4d","\ud83d\udc4e","\ud83d\udc4c","\u270c\ufe0f","\ud83e\udd1e","\ud83e\udd1f","\ud83e\udd18","\ud83d\udc4a","\ud83d\udc4b","\ud83d\ude4c","\u2764\ufe0f","\ud83d\udc94","\ud83d\udc96","\ud83d\udc99","\ud83d\ude22","\ud83d\ude2d","\ud83d\ude24","\ud83d\ude20","\ud83d\ude21","\ud83e\udd2c"],Ge=(0,i.A)(),Ye=(0,s.A)(Ge.breakpoints.up("md"));(0,n.useEffect)((()=>{if(null===re||void 0===re||!re.uid)return;const e=D||ee;if(!e)return void oe("/messages");let r=null;return(async()=>{if(await(async()=>{if(!ee||D)return null;try{var e;const r=(0,J.rJ)(V.db,"conversations"),o=(0,J.P)(r,(0,J._M)("participants","array-contains",re.uid)),t=await(0,J.GG)(o);let n=null;if(t.docs.forEach((e=>{e.data().participants.includes(ee)&&(n=e.id)})),n)return oe("/chat/conversation/".concat(n),{replace:!0}),n;const a=(0,J.H9)(V.db,"users",ee),i=await(0,J.x7)(a);if(!i.exists())return K.oR.error("User not found"),oe("/messages"),null;const s=(null===(e=i.data().following)||void 0===e?void 0:e.includes(re.uid))||!1;console.log("[Chat] Creating conversation: recipient follows current user? ".concat(s));const l=(0,J.H9)((0,J.rJ)(V.db,"conversations"));return await(0,J.BN)(l,{participants:[re.uid,ee],createdAt:(0,J.O5)(),lastUpdated:(0,J.O5)(),unreadCount:{[re.uid]:0,[ee]:0},status:s?"accepted":"pending"}),console.log("[Chat] Created new conversation with status: ".concat(s?"accepted":"pending")),oe("/chat/conversation/".concat(l.id),{replace:!0}),l.id}catch(r){return console.error("[Chat] Error creating conversation:",r),K.oR.error("Failed to start conversation"),null}})())return;const o=e;try{const e=(0,J.H9)(V.db,"conversations",o),n=await(0,J.x7)(e);if(!n.exists())return K.oR.error("Conversation not found"),void oe("/messages");const a=(0,t.A)({},n.data());me((0,t.A)((0,t.A)({},a),{},{id:n.id}));const i=a.status||"accepted";ge("pending"===i);const s=a.participants.find((e=>e!==re.uid));if(!s)return K.oR.error("Invalid conversation"),void oe("/messages");const l=await(async e=>{try{const r=(0,J.H9)(V.db,"users",e),o=await(0,J.x7)(r);if(o.exists()){const r=o.data(),t=r.profilePic||r.photoURL||r.avatarUrl||void 0;return console.log("User profile debug:",{uid:e,userData:r,profilePic:t}),{id:e,username:r.username||"Unknown User",name:r.name,profilePic:t,followers:r.followers||[]}}return{id:e,username:"Unknown User",followers:[]}}catch(r){return console.error("Error fetching user profile:",r),{id:e,username:"Unknown User",followers:[]}}})(s);de(l),"accepted"===i&&await(0,J.mZ)(e,{["unreadCount.".concat(re.uid)]:0});const c=(0,J.rJ)(V.db,"conversations",o,"messages"),d=(0,J.P)(c,(0,J.My)("timestamp","asc"));r=(0,J.aQ)(d,(e=>{const r=[];if(e.docs.forEach((e=>{r.push((0,t.A)({id:e.id},e.data()))})),ie(r),ne(!1),"accepted"===i){const e=r.filter((e=>!e.read&&e.sender!==re.uid));if(e.length>0){e.forEach((async e=>{const r=(0,J.H9)(V.db,"conversations",o,"messages",e.id);await(0,J.mZ)(r,{read:!0})}));const r=(0,J.H9)(V.db,"conversations",o);(0,J.mZ)(r,{["unreadCount.".concat(re.uid)]:0})}}Xe()}))}catch(n){console.error("Error fetching conversation:",n),K.oR.error("Failed to load conversation")}})(),()=>{r&&r()}}),[null===re||void 0===re?void 0:re.uid,D,ee,oe]);const Xe=()=>{setTimeout((()=>{var e;null===(e=pe.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),100)},Je=async()=>{if(!se.trim()||null===re||void 0===re||!re.uid||!ue)return;if(xe&&ue.participants[0]!==re.uid)return void K.oR.error("You need to accept this message request before you can reply");const e=D||ee;if(e)try{var r;const t=(0,J.rJ)(V.db,"conversations",e,"messages"),n=ue.participants.find((e=>e!==re.uid));if(!n)return void K.oR.error("Cannot find chat partner");await(0,J.gS)(t,{text:se,sender:re.uid,timestamp:(0,J.O5)(),read:!1,reactions:[]});const a=(0,J.H9)(V.db,"conversations",e);if(await(0,J.mZ)(a,{lastMessage:{text:se,sender:re.uid,timestamp:(0,J.O5)()},lastUpdated:(0,J.O5)(),["unreadCount.".concat(n)]:1+((null===(r=ue.lastMessage)||void 0===r?void 0:r.sender)===re.uid?1:0)}),ce&&re)try{const r=(0,J.H9)(V.db,"users",re.uid),o=await(0,J.x7)(r),t=o.exists()?o.data():null,a=(null===t||void 0===t?void 0:t.name)||(null===t||void 0===t?void 0:t.username)||re.displayName||"Someone",i=(null===t||void 0===t?void 0:t.profilePic)||re.photoURL;await he({type:"message",senderId:re.uid,senderName:a,senderAvatar:i,recipientId:n,content:"New message: ".concat(se.slice(0,50)).concat(se.length>50?"...":""),postId:e,roomId:e}),console.log("[Chat] Notification sent for new message to:",n)}catch(o){console.error("[Chat] Error creating message notification:",o)}le(""),Xe()}catch(t){console.error("[Chat] Error sending message:",t),K.oR.error("Failed to send message")}},Ve=e=>{if(!e)return"";return(e.toDate?e.toDate():new Date(e)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},_e=e=>{if(!e)return"";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"})},Ke=async(e,r)=>{if(null===re||void 0===re||!re.uid||!ue)return;if(xe&&ue.participants[0]!==re.uid)return void K.oR.error("You need to accept this message request before you can reply");const o=D||ee;if(o)try{var t;const a=(0,J.rJ)(V.db,"conversations",o,"messages"),i=ue.participants.find((e=>e!==re.uid));if(!i)return void K.oR.error("Cannot find chat partner");const s="image"===r?"Sent an image":"Sent a video";await(0,J.gS)(a,{text:s,sender:re.uid,timestamp:(0,J.O5)(),read:!1,mediaUrl:e,mediaType:r,reactions:[]});const l=(0,J.H9)(V.db,"conversations",o);if(await(0,J.mZ)(l,{lastMessage:{text:s,sender:re.uid,timestamp:(0,J.O5)()},lastUpdated:(0,J.O5)(),["unreadCount.".concat(i)]:1+((null===(t=ue.lastMessage)||void 0===t?void 0:t.sender)===re.uid?1:0)}),ce&&re)try{const e=(0,J.H9)(V.db,"users",re.uid),t=await(0,J.x7)(e),n=t.exists()?t.data():null,a=(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.username)||re.displayName||"Someone",s=(null===n||void 0===n?void 0:n.profilePic)||re.photoURL;await he({type:"message",senderId:re.uid,senderName:a,senderAvatar:s,recipientId:i,content:"image"===r?"Sent you an image":"Sent you a video",postId:o,roomId:o})}catch(n){console.error("[Chat] Error creating media message notification:",n)}Xe()}catch(a){console.error("[Chat] Error sending media message:",a),K.oR.error("Failed to send media")}},Qe=async()=>{if(ue&&re)try{ne(!0);const e=(0,J.H9)(V.db,"conversations",ue.id);await(0,J.mZ)(e,{status:"accepted"}),ge(!1),me((0,t.A)((0,t.A)({},ue),{},{status:"accepted"})),fe("Message request accepted"),ye(!0)}catch(e){console.error("Error accepting message request:",e),K.oR.error("Failed to accept message request")}finally{ne(!1)}},$e=async()=>{if(ue&&re)try{ne(!0);const e=(0,J.wP)(V.db),r=(0,J.rJ)(V.db,"conversations",ue.id,"messages");(await(0,J.GG)(r)).docs.forEach((r=>{e.delete(r.ref)}));const o=(0,J.H9)(V.db,"conversations",ue.id);e.delete(o),await e.commit(),oe("/messages"),fe("Message request declined"),ye(!0)}catch(e){console.error("Error declining message request:",e),K.oR.error("Failed to decline message request")}finally{ne(!1)}},er=(e,r)=>{const o=setTimeout((()=>{if(r.sender===(null===re||void 0===re?void 0:re.uid)){var o;if("clientX"in e)Pe({mouseX:e.clientX-2,mouseY:e.clientY-4,message:r});else if(null!==(o=e.touches)&&void 0!==o&&o.length){const o=e.touches[0];Pe({mouseX:o.clientX-2,mouseY:o.clientY-4,message:r})}Re(r)}else"currentTarget"in e&&or(e,r)}),500);Ee(o)},rr=()=>{Me&&(clearTimeout(Me),Ee(null))},or=(e,r)=>{Me&&(clearTimeout(Me),Ee(null)),He({anchorEl:e.currentTarget,message:r}),Ue&&Pe(null)},tr=()=>{He({anchorEl:null,message:null})},nr=()=>{Be({anchorEl:null,message:null,emoji:null})},ar=async e=>{if(!De.message||null===re||void 0===re||!re.uid||!ue)return;const r=D||ee;if(r)try{const o=De.message.id,n=(0,J.H9)(V.db,"conversations",r,"messages",o),a=De.message.reactions||[],i=a.findIndex((r=>r.userId===re.uid&&r.emoji===e));if(-1!==i){const e=[...a];e.splice(i,1),await(0,J.mZ)(n,{reactions:e}),ie((r=>r.map((r=>r.id===o?(0,t.A)((0,t.A)({},r),{},{reactions:e}):r))))}else{const r={emoji:e,userId:re.uid,username:re.displayName||""},i=[...a,r];await(0,J.mZ)(n,{reactions:i}),ie((e=>e.map((e=>e.id===o?(0,t.A)((0,t.A)({},e),{},{reactions:i}):e))))}tr()}catch(o){console.error("[Chat] Error adding reaction:",o),K.oR.error("Failed to add reaction"),tr()}},ir=e=>{const r=/(https?:\/\/[^\s]+\/side-room\/[^\s]+)/g;return e.split(r).map(((e,o)=>{if(e.match(r)){const r=new URL(e).pathname.split("/"),t=r[r.length-1];return(0,H.jsx)(l.A,{component:"button",onClick:e=>{e.stopPropagation(),oe("/side-room/".concat(t))},sx:{color:"inherit",textDecoration:"underline",background:"none",border:"none",padding:0,font:"inherit",cursor:"pointer","&:hover":{opacity:.8}},children:e},o)}return(0,H.jsx)("span",{children:e},o)}))},sr=e=>{const r=e.sender===(null===re||void 0===re?void 0:re.uid);return(0,H.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",alignItems:r?"flex-end":"flex-start",mb:.5,px:1},children:[(0,H.jsxs)(c.A,{sx:{maxWidth:e.mediaUrl?"80%":"70%",backgroundColor:r?"primary.main":e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.15)":"background.paper",color:r?"primary.contrastText":e=>"dark"===e.palette.mode?"common.white":"text.primary",borderRadius:r?"20px 20px 0 20px":"20px 20px 20px 0",p:e.mediaUrl?1:2,position:"relative",boxShadow:1,"& .timestamp":{position:"absolute",bottom:2,right:r?8:"auto",left:r?"auto":8,fontSize:"0.7rem",color:r?"rgba(255,255,255,0.7)":e=>"dark"===e.palette.mode?"rgba(255,255,255,0.7)":"text.secondary"},transition:"opacity 0.2s ease","&:hover":{opacity:.9,cursor:"pointer"},"&:active":{opacity:.7}},onMouseDown:r=>er(r,e),onMouseUp:rr,onMouseLeave:rr,onTouchStart:r=>er(r,e),onTouchEnd:rr,onTouchCancel:rr,onClick:r=>or(r,e),children:[e.mediaUrl&&"image"===e.mediaType&&(0,H.jsx)(c.A,{sx:{mb:1},children:(0,H.jsx)("img",{src:e.mediaUrl,alt:"Shared image",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"16px",display:"block"}})}),e.mediaUrl&&"video"===e.mediaType&&(0,H.jsx)(c.A,{sx:{mb:1},children:(0,H.jsx)("video",{src:e.mediaUrl,controls:!0,style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"16px",display:"block"}})}),(0,H.jsx)(d.A,{variant:"body1",children:ir(e.text)}),(0,H.jsx)(d.A,{variant:"caption",className:"timestamp",children:Ve(e.timestamp)})]}),e.reactions&&e.reactions.length>0&&(0,H.jsx)(c.A,{sx:{display:"flex",flexDirection:r?"row-reverse":"row",flexWrap:"wrap",gap:.5,mt:.5,maxWidth:"70%"},children:Object.entries(e.reactions.reduce(((e,r)=>(e[r.emoji]=(e[r.emoji]||0)+1,e)),{})).map((r=>{var o;let[t,n]=r;const a=null===(o=e.reactions)||void 0===o?void 0:o.some((e=>e.emoji===t&&e.userId===(null===re||void 0===re?void 0:re.uid)));return(0,H.jsx)(u.A,{label:"".concat(t," ").concat(n),size:"small",variant:"outlined",onClick:r=>((e,r,o)=>{e.stopPropagation(),Be({anchorEl:e.currentTarget,message:r,emoji:o})})(r,e,t),sx:{borderRadius:"12px",height:"24px",fontSize:"0.75rem",cursor:"pointer",backgroundColor:e=>a?"dark"===e.palette.mode?"rgba(25, 118, 210, 0.2)":"rgba(25, 118, 210, 0.1)":"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",border:e=>a?"1px solid ".concat(e.palette.primary.main):void 0,"&:hover":{backgroundColor:e=>a?"dark"===e.palette.mode?"rgba(25, 118, 210, 0.3)":"rgba(25, 118, 210, 0.2)":"dark"===e.palette.mode?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)"}}},t)}))})]},e.id)},lr=e=>{le((r=>r+e))};return(0,H.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[(0,H.jsx)(m.A,{position:"static",color:"default",elevation:0,sx:{borderBottom:"1px solid",borderColor:"divider"},children:(0,H.jsxs)(p.A,{children:[(0,H.jsx)(h.A,{edge:"start",onClick:()=>oe("/messages"),sx:{mr:2},children:(0,H.jsx)(O.A,{})}),ce?(0,H.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",cursor:"pointer","&:hover":{opacity:.8},transition:"opacity 0.2s ease"},onClick:()=>oe("/profile/".concat(ce.id)),children:[(0,H.jsx)(x.A,{src:ce.profilePic||void 0,alt:ce.name||ce.username,sx:{mr:2,width:40,height:40,bgcolor:ce.profilePic?void 0:"primary.main"},children:!ce.profilePic&&(null===(e=ce.name||ce.username)||void 0===e?void 0:e.charAt(0).toUpperCase())}),(0,H.jsxs)(c.A,{children:[(0,H.jsx)(d.A,{variant:"subtitle1",fontWeight:"medium",children:ce.name||ce.username}),ce.name&&(0,H.jsxs)(d.A,{variant:"caption",color:"text.secondary",children:["@",ce.username]})]})]}):(0,H.jsx)(g.A,{size:24,sx:{mr:2}}),(0,H.jsx)(b.A,{title:"Tip: Long-press on your messages to delete them",placement:"bottom",children:(0,H.jsxs)(d.A,{variant:"caption",color:"text.secondary",sx:{ml:"auto",mr:xe?2:0,display:{xs:"none",sm:"block"}},children:[(0,H.jsx)(N.A,{fontSize:"inherit",sx:{fontSize:"1rem",verticalAlign:"middle",mr:.5}}),"Long-press to delete"]})}),xe&&(0,H.jsxs)(c.A,{sx:{ml:"auto",display:"flex",gap:1},children:[(0,H.jsx)(f.A,{variant:"contained",color:"success",startIcon:(0,H.jsx)(W.A,{}),onClick:Qe,size:"small",children:"Accept"}),(0,H.jsx)(f.A,{variant:"outlined",color:"error",startIcon:(0,H.jsx)(F.A,{}),onClick:$e,size:"small",children:"Decline"})]})]})}),xe&&(0,H.jsx)(c.A,{sx:{bgcolor:"info.light",p:2},children:(0,H.jsx)(v.A,{severity:"info",icon:!1,children:(0,H.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,H.jsxs)(d.A,{variant:"body2",children:["This is a message request from ",(null===ce||void 0===ce?void 0:ce.name)||(null===ce||void 0===ce?void 0:ce.username)||"a user",".",(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid)?" You can read their message, but must accept to respond.":" Waiting for them to accept your request before they can read your message."]}),(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid)&&(0,H.jsxs)(c.A,{sx:{display:"flex",gap:1,ml:2},children:[(0,H.jsx)(f.A,{variant:"contained",color:"success",size:"small",onClick:Qe,children:"Accept"}),(0,H.jsx)(f.A,{variant:"outlined",color:"error",size:"small",onClick:$e,children:"Decline"})]})]})})}),we&&(0,H.jsxs)(c.A,{sx:{width:"100%",px:2,py:1,bgcolor:"background.paper"},children:[(0,H.jsxs)(d.A,{variant:"caption",gutterBottom:!0,children:["Uploading media... ",je?Math.round(je):0,"%"]}),(0,H.jsx)(y.A,{variant:"determinate",value:je||0,sx:{height:6,borderRadius:3}})]}),(0,H.jsx)(c.A,{sx:{flexGrow:1,overflowY:"auto",bgcolor:e=>"dark"===e.palette.mode?"grey.900":"grey.50",p:2,pb:2},children:te?(0,H.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,H.jsx)(g.A,{})}):0===ae.length?(0,H.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50%"},children:(0,H.jsx)(d.A,{color:"text.secondary",children:"No messages yet. Start the conversation!"})}):(0,H.jsxs)(c.A,{sx:{mb:"60px"},children:[" ",Object.entries((()=>{const e={};return ae.forEach((r=>{if(!r.timestamp)return;const o=(r.timestamp.toDate?r.timestamp.toDate():new Date(r.timestamp)).toISOString().split("T")[0];e[o]||(e[o]=[]),e[o].push(r)})),e})()).map((e=>{let[r,o]=e;return(0,H.jsxs)(c.A,{sx:{mb:2},children:[(0,H.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,H.jsx)(j.A,{sx:{flexGrow:1,mr:2,borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.12)":"inherit"}}),(0,H.jsx)(d.A,{variant:"caption",sx:{color:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.7)":"text.secondary"},children:_e(o[0].timestamp)}),(0,H.jsx)(j.A,{sx:{flexGrow:1,ml:2,borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.12)":"inherit"}})]}),o.map(sr)]},r)})),(0,H.jsx)("div",{ref:pe,style:{height:"4px"}})]})}),(0,H.jsx)(c.A,{sx:{position:"fixed",bottom:0,left:0,right:0,pt:1,pb:1.5,px:1.5,backgroundColor:e=>"dark"===e.palette.mode?"background.paper":"white",borderTop:e=>"1px solid ".concat("dark"===e.palette.mode?"rgba(255,255,255,0.1)":"#ddd"),boxShadow:e=>"dark"===e.palette.mode?"0px -2px 10px rgba(0,0,0,0.3)":"0px -2px 10px rgba(0,0,0,0.1)",zIndex:9999},children:xe&&(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid)?(0,H.jsx)(c.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:1},children:(0,H.jsx)(u.A,{label:"Accept message request to reply",color:"primary",variant:"outlined",sx:{fontSize:"0.9rem"}})}):(0,H.jsxs)(H.Fragment,{children:[Ye&&!we&&(0,H.jsx)(c.A,{sx:{display:"flex",overflowX:"auto",mb:1,pb:1,"&::-webkit-scrollbar":{height:"4px"},"&::-webkit-scrollbar-track":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"},"&::-webkit-scrollbar-thumb":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)",borderRadius:"2px"}},children:Ze.map((e=>(0,H.jsx)(b.A,{title:e,placement:"top",children:(0,H.jsx)(c.A,{component:"button",onClick:()=>lr(e),sx:{border:"none",background:"none",cursor:"pointer",fontSize:"1.5rem",mx:.5,p:.5,borderRadius:"4px",minWidth:"40px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s","&:hover":{transform:"scale(1.2)",background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"}},children:e})},e)))}),(0,H.jsxs)(c.A,{sx:{display:"flex",width:"100%"},children:[(0,H.jsx)($,{ref:Ce,accept:"image/*,video/*",id:"file-upload-input",type:"file",onChange:async e=>{var r;const o=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!o||!re||!ue)return;const t=D||ee;if(!t)return;if(o.size>10485760)return void K.oR.error("File too large. Maximum size is 10MB.");const n=o.type.split("/")[0];if("image"===n||"video"===n){try{ke(!0),Ae(0),console.log("[Chat] Starting upload for file ".concat(o.name," to conversation ").concat(t));const e=(0,_.KR)(V.IG,"chat-media/".concat(t,"/").concat(Date.now(),"_").concat(o.name)),r=(0,_.bp)(e,o);r.on("state_changed",(e=>{const r=e.bytesTransferred/e.totalBytes*100;Ae(r),console.log("[Chat] Upload progress: ".concat(r.toFixed(2),"%"))}),(e=>{console.error("Error uploading file:",e);const r="storage/unauthorized"===e.code?"Permission denied. Cannot upload file (storage rules need to be updated).":"Upload failed: ".concat(e.message);K.oR.error(r),ke(!1),Ae(null)}),(async()=>{console.log("[Chat] Upload completed successfully, getting download URL");try{const e=await(0,_.qk)(r.snapshot.ref);console.log("[Chat] Download URL obtained: ".concat(e)),await Ke(e,n),ke(!1),Ae(null)}catch(e){console.error("Error getting download URL:",e);const r=e instanceof Error?e.message:"Unknown error occurred";K.oR.error("Failed to process uploaded file: ".concat(r)),ke(!1),Ae(null)}}))}catch(a){console.error("Error handling file upload:",a);const e=a instanceof Error?a.message:"Unknown error occurred";K.oR.error("Failed to upload file: ".concat(e)),ke(!1),Ae(null)}Ce.current&&(Ce.current.value="")}else K.oR.error("Only image and video files are supported.")},disabled:we||xe&&(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid)}),(0,H.jsx)(h.A,{onClick:()=>{var e;null===(e=Ce.current)||void 0===e||e.click()},disabled:we||xe&&(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid),color:"primary",sx:{mr:1},"aria-label":"attach image or video",children:(0,H.jsx)(Z.A,{})}),!Ye&&(0,H.jsx)(h.A,{onClick:()=>{Fe((e=>!e))},disabled:we||xe&&(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid),color:"primary",sx:{mr:1},"aria-label":"add emoji",children:(0,H.jsx)(G.A,{})}),(0,H.jsx)(A.A,{fullWidth:!0,variant:"outlined",placeholder:"Type a message...",value:se,onChange:e=>le(e.target.value),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&Je(),disabled:we||xe&&(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid),sx:{mr:1,"& .MuiInputBase-root":{bgcolor:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"white"}}}),(0,H.jsx)(f.A,{variant:"contained",color:"primary",disabled:we||!se.trim()&&!we||xe&&(null===ue||void 0===ue?void 0:ue.participants[0])!==(null===re||void 0===re?void 0:re.uid),onClick:Je,children:"Send"})]})]})}),(0,H.jsx)(w.A,{open:null!==Ue,onClose:()=>{Pe(null)},anchorReference:"anchorPosition",anchorPosition:null!==Ue?{top:Ue.mouseY,left:Ue.mouseX}:void 0,children:(0,H.jsxs)(k.A,{onClick:()=>{ze(!0),Pe(null)},children:[(0,H.jsx)(N.A,{fontSize:"small",sx:{mr:1}}),"Delete Message"]})}),(0,H.jsxs)(C.A,{open:Ie,onClose:()=>ze(!1),"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,H.jsx)(S.A,{id:"delete-dialog-title",children:"Delete Message?"}),(0,H.jsx)(R.A,{children:(0,H.jsx)(I.A,{id:"delete-dialog-description",children:"Are you sure you want to delete this message? This action cannot be undone."})}),(0,H.jsxs)(z.A,{children:[(0,H.jsx)(f.A,{onClick:()=>ze(!1),color:"primary",children:"Cancel"}),(0,H.jsx)(f.A,{onClick:async()=>{if(!Se||null===re||void 0===re||!re.uid||!ue)return void ze(!1);if(Se.sender!==(null===re||void 0===re?void 0:re.uid))return K.oR.error("You can only delete your own messages"),void ze(!1);const e=D||ee;if(e)try{var r;ne(!0);const o=(0,J.H9)(V.db,"conversations",e,"messages",Se.id);if(await(0,J.kd)(o),null!==(r=ue.lastMessage)&&void 0!==r&&r.timestamp&&Se.timestamp&&ue.lastMessage.timestamp.seconds===Se.timestamp.seconds){const r=(0,J.rJ)(V.db,"conversations",e,"messages"),o=(0,J.P)(r,(0,J.My)("timestamp","desc"),(0,J.AB)(1)),t=await(0,J.GG)(o),n=(0,J.H9)(V.db,"conversations",e);if(t.empty)await(0,J.mZ)(n,{lastMessage:null});else{const e=t.docs[0].data();await(0,J.mZ)(n,{lastMessage:{text:e.text,sender:e.sender,timestamp:e.timestamp}})}}fe("Message deleted"),ye(!0),ie((e=>e.filter((e=>e.id!==Se.id))))}catch(o){console.error("Error deleting message:",o),K.oR.error("Failed to delete message")}finally{ne(!1),ze(!1),Re(null),Pe(null)}else ze(!1)},color:"error",variant:"contained",children:"Delete"})]})]}),(0,H.jsx)(M.A,{open:ve,autoHideDuration:4e3,onClose:()=>{ye(!1)},message:be}),(0,H.jsx)(E.Ay,{open:Boolean(De.anchorEl),anchorEl:De.anchorEl,onClose:tr,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},PaperProps:{sx:{width:"320px",maxWidth:"90vw",maxHeight:"350px",overflow:"hidden"}},children:(0,H.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",bgcolor:e=>"dark"===e.palette.mode?"grey.800":"background.paper",borderRadius:2},children:[(0,H.jsx)(c.A,{sx:{display:"flex",p:1,borderBottom:1,borderColor:"divider",justifyContent:"center"},children:Oe.slice(0,7).map((e=>(0,H.jsx)(h.A,{onClick:()=>ar(e.emoji),sx:{mx:.5,"&:hover":{bgcolor:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.04)"}},"aria-label":e.label,children:(0,H.jsx)(d.A,{variant:"body1",sx:{fontSize:"1.4rem"},children:e.emoji})},e.emoji)))}),(0,H.jsx)(c.A,{sx:{display:"flex",overflowX:"auto",py:1,borderBottom:1,borderColor:"divider","&::-webkit-scrollbar":{height:"4px"},"&::-webkit-scrollbar-track":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"},"&::-webkit-scrollbar-thumb":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)",borderRadius:"2px"}},children:Ne.map((e=>(0,H.jsxs)(c.A,{onClick:()=>qe(e.id),sx:{minWidth:"auto",mx:1.5,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",opacity:Te===e.id?1:.6,borderBottom:Te===e.id?2:0,borderColor:"primary.main",transition:"all 0.2s ease","&:hover":{opacity:.8}},children:[(0,H.jsx)(d.A,{sx:{fontSize:"1.4rem"},children:e.icon}),(0,H.jsx)(d.A,{variant:"caption",sx:{fontSize:"0.7rem"},children:e.name})]},e.id)))}),(0,H.jsx)(c.A,{sx:{height:"200px",overflowY:"auto",p:1,display:"flex",flexWrap:"wrap",justifyContent:"flex-start","&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"},"&::-webkit-scrollbar-thumb":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)",borderRadius:"2px"}},children:null===(r=Ne.find((e=>e.id===Te)))||void 0===r?void 0:r.emojis.map((e=>(0,H.jsx)(c.A,{component:"button",onClick:()=>ar(e),sx:{border:"none",background:"none",cursor:"pointer",fontSize:"1.6rem",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s",borderRadius:"4px","&:hover":{transform:"scale(1.2)",background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"}},children:e},e)))})]})}),!Ye&&(0,H.jsx)(E.Ay,{open:We,onClose:()=>Fe(!1),anchorReference:"anchorPosition",anchorPosition:{top:window.innerHeight-300,left:window.innerWidth/2},transformOrigin:{vertical:"bottom",horizontal:"center"},children:(0,H.jsx)(c.A,{sx:{p:1,width:"300px",maxWidth:"90vw",height:"200px",overflow:"auto",display:"flex",flexWrap:"wrap",justifyContent:"center"},children:Ze.map((e=>(0,H.jsx)(c.A,{component:"button",onClick:()=>{lr(e),Fe(!1)},sx:{border:"none",background:"none",cursor:"pointer",fontSize:"1.8rem",m:.5,p:.5,borderRadius:"4px",minWidth:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"}},children:e},e)))})}),(0,H.jsx)(E.Ay,{open:Boolean(Le.anchorEl),anchorEl:Le.anchorEl,onClose:nr,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},PaperProps:{sx:{width:"250px",maxWidth:"90vw",maxHeight:"300px"}},children:(0,H.jsxs)(c.A,{sx:{p:2,bgcolor:e=>"dark"===e.palette.mode?"grey.800":"background.paper"},children:[(0,H.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5,pb:1,borderBottom:1,borderColor:"divider"},children:[(0,H.jsxs)(d.A,{variant:"h6",sx:{display:"flex",alignItems:"center"},children:[(0,H.jsx)(c.A,{component:"span",sx:{fontSize:"1.6rem",mr:1},children:Le.emoji}),"Reactions"]}),Le.message&&Le.emoji&&(null===(o=Le.message.reactions)||void 0===o?void 0:o.some((e=>e.emoji===Le.emoji&&e.userId===(null===re||void 0===re?void 0:re.uid))))&&(0,H.jsx)(f.A,{variant:"outlined",color:"error",size:"small",onClick:()=>{var e;return(async(e,r)=>{if(null===re||void 0===re||!re.uid||!ue)return;const o=D||ee;if(o)try{const n=(0,J.H9)(V.db,"conversations",o,"messages",e),a=await(0,J.x7)(n);if(!a.exists())return void K.oR.error("Message not found");const i=(a.data().reactions||[]).filter((e=>!(e.userId===re.uid&&e.emoji===r)));await(0,J.mZ)(n,{reactions:i}),ie((r=>r.map((r=>r.id===e?(0,t.A)((0,t.A)({},r),{},{reactions:i}):r)))),nr()}catch(n){console.error("[Chat] Error removing reaction:",n),K.oR.error("Failed to remove reaction")}})((null===(e=Le.message)||void 0===e?void 0:e.id)||"",Le.emoji||"")},children:"Remove"})]}),(0,H.jsx)(U.A,{sx:{py:0},children:Le.message&&Le.emoji&&(null===(a=Le.message.reactions)||void 0===a?void 0:a.filter((e=>e.emoji===Le.emoji)).map(((e,r)=>(0,H.jsx)(P.Ay,{sx:{py:.5,px:1,borderRadius:1,my:.3,bgcolor:e.userId===(null===re||void 0===re?void 0:re.uid)?e=>"dark"===e.palette.mode?"rgba(25, 118, 210, 0.15)":"rgba(25, 118, 210, 0.05)":"transparent"},children:(0,H.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,H.jsxs)(d.A,{children:[e.username||"User",e.userId===(null===re||void 0===re?void 0:re.uid)&&(0,H.jsx)(d.A,{component:"span",color:"text.secondary",sx:{ml:.5,fontSize:"0.8rem"},children:"(you)"})]}),(0,H.jsx)(d.A,{fontSize:"1.2rem",children:e.emoji})]})},"".concat(e.userId,"-").concat(r)))))})]})})]})}},4801:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(3235),n=o(4414);const a=(0,t.A)((0,n.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},6699:(e,r,o)=>{o.d(r,{A:()=>O});var t=o(7528),n=o(8587),a=o(8168),i=o(9950),s=o(2004),l=o(8465),c=o(8283),d=o(9269),u=o(4730),m=o(1676),p=o(9254),h=o(8463),x=o(1763),g=o(423);function b(e){return(0,g.Ay)("MuiLinearProgress",e)}(0,x.A)("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);var f,v,y,j,A,w,k=o(4414);const C=["className","color","value","valueBuffer","variant"];let S,R,I,z,M,E;const U=(0,c.i7)(S||(S=f||(f=(0,t.A)(["\n  0% {\n    left: -35%;\n    right: 100%;\n  }\n\n  60% {\n    left: 100%;\n    right: -90%;\n  }\n\n  100% {\n    left: 100%;\n    right: -90%;\n  }\n"])))),P=(0,c.i7)(R||(R=v||(v=(0,t.A)(["\n  0% {\n    left: -200%;\n    right: 100%;\n  }\n\n  60% {\n    left: 107%;\n    right: -8%;\n  }\n\n  100% {\n    left: 107%;\n    right: -8%;\n  }\n"])))),D=(0,c.i7)(I||(I=y||(y=(0,t.A)(["\n  0% {\n    opacity: 1;\n    background-position: 0 -23px;\n  }\n\n  60% {\n    opacity: 0;\n    background-position: 0 -23px;\n  }\n\n  100% {\n    opacity: 1;\n    background-position: -200px -23px;\n  }\n"])))),H=(e,r)=>"inherit"===r?"currentColor":e.vars?e.vars.palette.LinearProgress["".concat(r,"Bg")]:"light"===e.palette.mode?(0,d.a)(e.palette[r].main,.62):(0,d.e$)(e.palette[r].main,.5),L=(0,p.Ay)("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.root,r["color".concat((0,m.A)(o.color))],r[o.variant]]}})((e=>{let{ownerState:r,theme:o}=e;return(0,a.A)({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:H(o,r.color)},"inherit"===r.color&&"buffer"!==r.variant&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},"buffer"===r.variant&&{backgroundColor:"transparent"},"query"===r.variant&&{transform:"rotate(180deg)"})})),B=(0,p.Ay)("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.dashed,r["dashedColor".concat((0,m.A)(o.color))]]}})((e=>{let{ownerState:r,theme:o}=e;const t=H(o,r.color);return(0,a.A)({position:"absolute",marginTop:0,height:"100%",width:"100%"},"inherit"===r.color&&{opacity:.3},{backgroundImage:"radial-gradient(".concat(t," 0%, ").concat(t," 16%, transparent 42%)"),backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})}),(0,c.AH)(z||(z=j||(j=(0,t.A)(["\n    animation: "," 3s infinite linear;\n  "]))),D)),T=(0,p.Ay)("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.bar,r["barColor".concat((0,m.A)(o.color))],("indeterminate"===o.variant||"query"===o.variant)&&r.bar1Indeterminate,"determinate"===o.variant&&r.bar1Determinate,"buffer"===o.variant&&r.bar1Buffer]}})((e=>{let{ownerState:r,theme:o}=e;return(0,a.A)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:"inherit"===r.color?"currentColor":(o.vars||o).palette[r.color].main},"determinate"===r.variant&&{transition:"transform .".concat(4,"s linear")},"buffer"===r.variant&&{zIndex:1,transition:"transform .".concat(4,"s linear")})}),(e=>{let{ownerState:r}=e;return("indeterminate"===r.variant||"query"===r.variant)&&(0,c.AH)(M||(M=A||(A=(0,t.A)(["\n      width: auto;\n      animation: "," 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;\n    "]))),U)})),q=(0,p.Ay)("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.bar,r["barColor".concat((0,m.A)(o.color))],("indeterminate"===o.variant||"query"===o.variant)&&r.bar2Indeterminate,"buffer"===o.variant&&r.bar2Buffer]}})((e=>{let{ownerState:r,theme:o}=e;return(0,a.A)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},"buffer"!==r.variant&&{backgroundColor:"inherit"===r.color?"currentColor":(o.vars||o).palette[r.color].main},"inherit"===r.color&&{opacity:.3},"buffer"===r.variant&&{backgroundColor:H(o,r.color),transition:"transform .".concat(4,"s linear")})}),(e=>{let{ownerState:r}=e;return("indeterminate"===r.variant||"query"===r.variant)&&(0,c.AH)(E||(E=w||(w=(0,t.A)(["\n      width: auto;\n      animation: "," 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;\n    "]))),P)})),O=i.forwardRef((function(e,r){const o=(0,h.b)({props:e,name:"MuiLinearProgress"}),{className:t,color:i="primary",value:c,valueBuffer:d,variant:p="indeterminate"}=o,x=(0,n.A)(o,C),g=(0,a.A)({},o,{color:i,variant:p}),f=(e=>{const{classes:r,variant:o,color:t}=e,n={root:["root","color".concat((0,m.A)(t)),o],dashed:["dashed","dashedColor".concat((0,m.A)(t))],bar1:["bar","barColor".concat((0,m.A)(t)),("indeterminate"===o||"query"===o)&&"bar1Indeterminate","determinate"===o&&"bar1Determinate","buffer"===o&&"bar1Buffer"],bar2:["bar","buffer"!==o&&"barColor".concat((0,m.A)(t)),"buffer"===o&&"color".concat((0,m.A)(t)),("indeterminate"===o||"query"===o)&&"bar2Indeterminate","buffer"===o&&"bar2Buffer"]};return(0,l.A)(n,b,r)})(g),v=(0,u.I)(),y={},j={bar1:{},bar2:{}};if("determinate"===p||"buffer"===p)if(void 0!==c){y["aria-valuenow"]=Math.round(c),y["aria-valuemin"]=0,y["aria-valuemax"]=100;let e=c-100;v&&(e=-e),j.bar1.transform="translateX(".concat(e,"%)")}else 0;if("buffer"===p)if(void 0!==d){let e=(d||0)-100;v&&(e=-e),j.bar2.transform="translateX(".concat(e,"%)")}else 0;return(0,k.jsxs)(L,(0,a.A)({className:(0,s.A)(f.root,t),ownerState:g,role:"progressbar"},y,{ref:r},x,{children:["buffer"===p?(0,k.jsx)(B,{className:f.dashed,ownerState:g}):null,(0,k.jsx)(T,{className:f.bar1,ownerState:g,style:j.bar1}),"determinate"===p?null:(0,k.jsx)(q,{className:f.bar2,ownerState:g,style:j.bar2})]}))}))},7443:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(3235),n=o(4414);const a=(0,t.A)((0,n.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite")},9885:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(3235),n=o(4414);const a=(0,t.A)((0,n.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")}}]);