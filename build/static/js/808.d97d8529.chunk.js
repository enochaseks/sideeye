"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[808],{4454:(e,o,t)=>{t.d(o,{A:()=>s});t(9950);var r=t(6491),n=t(2053),i=t(5277),l=t(4414);const s=e=>{let{links:o}=e;return o&&0!==o.length?(0,l.jsxs)(r.A,{mt:1,children:[(0,l.jsx)(n.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,l.jsx)(r.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,l.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},7808:(e,o,t)=>{t.r(o),t.d(o,{default:()=>Ro});var r=t(9379),n=t(9950),i=t(8429),l=t(2074),s=t(1367),a=t(330),d=t(6220),c=t(5887),u=t(6491),m=t(4857),h=t(3274),x=t(5333),p=t(2053),v=t(1413),g=t(7591),f=t(3266),b=t(4195),y=t(226),A=t(6639),C=t(3174),j=t(899),w=t(2235),S=t(6583),k=t(33),I=t(8170),R=t(8145),E=t(9739),F=t(4745),P=t(5277),D=t(249),U=t(6050),T=t(5979),z=t(3788),O=t(6101),M=t(6497),G=t(7324),H=t(9325),W=t(8614),N=t(3563),L=t(2236),B=t(4142),X=t(4447),V=t(7497),_=t(7443),J=t(5965),Y=t(2682),Z=t(9316),q=t(227),K=t(6904),Q=t(7565),$=t(9575),ee=t(1679),oe=t(7341),te=t(5204),re=t(6281),ne=t(379),ie=t(1300),le=t(760),se=t(7319),ae=t(4756),de=t(4767),ce=t(492),ue=t(8008),me=t(1902),he=t(5855),xe=t(9939),pe=t(529),ve=t(9404),ge=t(5379),fe=t(361),be=t(1675),ye=t(9715),Ae=t(6164),Ce=t(6835),je=t(1311),we=t(6117),Se=t(2960),ke=t(1673),Ie=t(6487),Re=t(9460),Ee=t(2600),Fe=t(1770),Pe=t(4414);const De=e=>{var o;let{open:t,onClose:i,onSubmit:l,initialData:s,title:a="Create Room",submitButtonText:d="Create"}=e;const[c,m]=(0,n.useState)({name:(null===s||void 0===s?void 0:s.name)||"",description:(null===s||void 0===s?void 0:s.description)||"",isPrivate:(null===s||void 0===s?void 0:s.isPrivate)||!1,password:(null===s||void 0===s?void 0:s.password)||"",tags:(null===s||void 0===s?void 0:s.tags)||[]}),[h,x]=(0,n.useState)(null);return(0,Pe.jsx)(S.A,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,Pe.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(c,h)},children:[(0,Pe.jsx)(k.A,{children:a}),(0,Pe.jsx)(I.A,{children:(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Pe.jsx)(R.A,{label:"Name",value:c.name,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,Pe.jsx)(R.A,{label:"Description",value:c.description,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,Pe.jsx)(M.A,{control:(0,Pe.jsx)(G.A,{checked:c.isPrivate,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,Pe.jsx)(R.A,{label:"Password",type:"password",value:c.password,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,Pe.jsxs)(u.A,{sx:{mt:1},children:[(0,Pe.jsxs)(y.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,Pe.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?x(e.target.files[0]):x(null)}})]}),h&&(0,Pe.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",h.name]}),!h&&(null===s||void 0===s?void 0:s.thumbnailUrl)&&(0,Pe.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",s.thumbnailUrl.substring(s.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,Pe.jsx)(R.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:i,children:"Cancel"}),(0,Pe.jsx)(y.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var Ue=t(7493),Te=t(9317),ze=t(6932),Oe=t(9751),Me=t(2856),Ge=t(1397),He=t(3422),We=t(4454),Ne=t(4862);const Le=[{value:"harassment",label:"Harassment"},{value:"hate_speech",label:"Hate Speech"},{value:"spam",label:"Spam"},{value:"inappropriate",label:"Inappropriate Content"},{value:"misinformation",label:"Misinformation"},{value:"copyright",label:"Copyright Violation"},{value:"privacy",label:"Privacy Violation"},{value:"other",label:"Other"}],Be=e=>{let{contentId:o,contentType:t,onClose:i,open:l,ownerUsername:c}=e;const{currentUser:m}=(0,s.As)(),[h,x]=(0,n.useState)(null),[v,g]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[P,D]=(0,n.useState)(null),[U,T]=(0,n.useState)(!1),[z,O]=(0,n.useState)({open:!1,message:""});(0,n.useEffect)((()=>{l&&M()}),[l]);const M=async()=>{try{let l="";switch(t){case"sideRoom":l="sideRooms";break;case"message":l="messages";break;case"chatRoom":l="chatRooms";break;case"sadeAI":l="sadeAIChats";break;case"user":l="users";break;default:l="unknown"}if("unknown"===l)return console.error("Unknown content type:",t),void D("Failed to determine content type");const s=(0,d.H9)(a.db,l,o),u=await(0,d.x7)(s);if(u.exists()){var e,r,n,i;const o=u.data();x({title:(null===o||void 0===o?void 0:o.title)||(null===o||void 0===o?void 0:o.name)||(null===o||void 0===o?void 0:o.username),content:(null===o||void 0===o?void 0:o.content)||(null===o||void 0===o?void 0:o.text)||(null===o||void 0===o?void 0:o.description),author:c||(null===o||void 0===o?void 0:o.authorName)||(null===o||void 0===o?void 0:o.username)||"Unknown",timestamp:null!==o&&void 0!==o&&null!==(e=o.timestamp)&&void 0!==e&&null!==(r=e.toDate)&&void 0!==r&&r.call(e)?o.timestamp.toDate().toISOString():null!==o&&void 0!==o&&null!==(n=o.createdAt)&&void 0!==n&&null!==(i=n.toDate)&&void 0!==i&&i.call(n)?o.createdAt.toDate().toISOString():(new Date).toISOString()})}else console.log("Preview document does not exist!"),x(null)}catch(P){console.error("Error fetching content:",P),D("Failed to fetch content")}};return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsxs)(S.A,{open:l,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,Pe.jsxs)(k.A,{children:["Report ",(()=>{switch(t){case"sideRoom":return"Side Room";case"message":return"Message";case"chatRoom":return"Chat Room";case"sadeAI":return"Sade AI Chat";case"user":return"User";default:return"Content"}})()]}),(0,Pe.jsx)(I.A,{children:(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:3,pt:2},children:[h&&(0,Pe.jsxs)(w.A,{elevation:1,sx:{p:2},children:[(0,Pe.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Content Preview"}),h.title&&(0,Pe.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:h.title}),h.content&&(0,Pe.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:h.content}),h.author&&(0,Pe.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:["By: ",h.author]})]}),(0,Pe.jsx)(F.A,{}),(0,Pe.jsx)(R.A,{select:!0,label:"Report Type",value:v,onChange:e=>g(e.target.value),fullWidth:!0,required:!0,children:Le.map((e=>(0,Pe.jsx)(f.A,{value:e.value,children:e.label},e.value)))}),(0,Pe.jsx)(R.A,{label:"Description",value:b,onChange:e=>j(e.target.value),multiline:!0,rows:4,fullWidth:!0,required:!0,placeholder:"Please provide details about why you are reporting this content..."}),P&&(0,Pe.jsx)(C.A,{severity:"error",sx:{mt:2},children:P})]})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:i,disabled:U,children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:async()=>{if(m&&a.db)try{T(!0),D("");let e="";switch(t){case"sideRoom":e="sideRooms";break;case"message":e="messages";break;case"chatRoom":e="chatRooms";break;case"sadeAI":e="sadeAIChats";break;case"user":e="users";break;default:e="unknown"}const r=(0,d.rJ)(a.db,"reports");await(0,d.gS)(r,{type:v,description:b,reporterId:m.uid,contentId:o,contentType:t,collectionName:e,timestamp:(0,d.O5)()});const n=(0,d.rJ)(a.db,"notifications","admin","reports");await(0,d.gS)(n,{contentId:o,contentType:t,collectionName:e,reporterId:m.uid,timestamp:(0,d.O5)()}),O({open:!0,message:"Report submitted successfully. Our team will review it shortly."}),i()}catch(P){console.error("Error submitting report:",P),D("Failed to submit report")}finally{T(!1)}},variant:"contained",color:"primary",disabled:U,children:U?(0,Pe.jsx)(A.A,{size:24}):"Submit Report"})]})]}),(0,Pe.jsx)(Ne.A,{open:z.open,autoHideDuration:6e3,onClose:()=>O((0,r.A)((0,r.A)({},z),{},{open:!1})),children:(0,Pe.jsx)(C.A,{onClose:()=>O((0,r.A)((0,r.A)({},z),{},{open:!1})),severity:"success",sx:{width:"100%"},children:z.message})})]})},Xe=e=>{var o;let{open:t,onClose:r,roomName:i,roomLink:l,onSend:s,currentUserId:m}=e;const[h,x]=(0,n.useState)(""),[g,f]=(0,n.useState)([]),[b,C]=(0,n.useState)(!1),[j,w]=(0,n.useState)(null),[T,z]=(0,n.useState)([]),[O,M]=(0,n.useState)(!1),G=(0,n.useCallback)((async()=>{if(m&&a.db){M(!0);try{const e=(0,d.rJ)(a.db,"rooms"),o=(0,d.P)(e,(0,d._M)("members","array-contains",m)),t=await(0,d.GG)(o),r=[];t.forEach((e=>{const o=e.data();r.push({id:e.id,name:o.name||"Chat Room"})})),z(r)}catch(e){console.error("Error fetching server chat rooms:",e),c.oR.error("Failed to load server chat rooms")}finally{M(!1)}}}),[m]);(0,n.useEffect)((()=>{t&&G()}),[t,G]);const H=(0,n.useCallback)((async e=>{if(!e.trim()||e.length<2)f([]);else{C(!0);try{const o=(0,d.rJ)(a.db,"users"),t=(0,d.P)(o,(0,d.AB)(50)),r=await(0,d.GG)(t),n=[],i=e.toLowerCase();r.forEach((e=>{if(e.id!==m){var o;const t=e.data();null!==(o=t.username)&&void 0!==o&&o.toLowerCase().includes(i)&&n.push({id:e.id,username:t.username||"",displayName:t.displayName,photoURL:t.photoURL||t.profilePic,email:t.email})}})),f(n)}catch(o){console.error("Error searching users:",o),c.oR.error("Failed to search users"),f([])}finally{C(!1)}}}),[m]);(0,n.useEffect)((()=>{const e=setTimeout((()=>{H(h)}),500);return()=>clearTimeout(e)}),[h,H]);return(0,Pe.jsxs)(S.A,{open:t,onClose:r,fullWidth:!0,maxWidth:"xs",children:[(0,Pe.jsx)(k.A,{children:"Share Room via Message"}),(0,Pe.jsx)(I.A,{children:(0,Pe.jsxs)(u.A,{sx:{mt:2},children:[(0,Pe.jsx)(R.A,{fullWidth:!0,label:"Search Users",variant:"outlined",value:h,onChange:e=>x(e.target.value),placeholder:"Type username to search...",disabled:!!j}),b&&(0,Pe.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Pe.jsx)(A.A,{size:24})}),!b&&g.length>0&&!j&&(0,Pe.jsx)(D.A,{sx:{mt:2,maxHeight:300,overflow:"auto"},children:g.map((e=>{var o;return(0,Pe.jsxs)(U.Ay,{button:!0,onClick:()=>(e=>{w(e),x(""),f([])})(e),children:[(0,Pe.jsx)(W.A,{children:(0,Pe.jsx)(v.A,{src:e.photoURL||void 0,alt:e.username,sx:{width:40,height:40},children:null===(o=e.username[0])||void 0===o?void 0:o.toUpperCase()})}),(0,Pe.jsx)(N.A,{primary:e.username,secondary:e.displayName||e.email})]},e.id)}))}),j&&(0,Pe.jsxs)(u.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",children:"Selected User:"}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,Pe.jsx)(v.A,{src:j.photoURL||void 0,alt:j.username,sx:{width:40,height:40},children:null===(o=j.username[0])||void 0===o?void 0:o.toUpperCase()}),(0,Pe.jsx)(p.A,{sx:{ml:1},children:j.username}),(0,Pe.jsx)(y.A,{size:"small",onClick:()=>w(null),sx:{ml:"auto"},children:"Change"})]})]}),!b&&h.length>=2&&0===g.length&&(0,Pe.jsx)(p.A,{color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"No users found"}),(0,Pe.jsx)(F.A,{sx:{mt:3,mb:2},children:(0,Pe.jsx)(P.A,{label:"Room + Server Chat"})}),O?(0,Pe.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Pe.jsx)(A.A,{size:24})}):T.length>0?(0,Pe.jsx)(D.A,{sx:{mt:2},children:T.map((e=>(0,Pe.jsx)(U.Ay,{button:!0,onClick:()=>(async(e,o)=>{try{const t=(0,d.H9)(a.db,"rooms",e);if(!(await(0,d.x7)(t)).exists())return void c.oR.error("Room not found");const n="Check out this room".concat(o?": ".concat(o):"","! ").concat(l);await s(e,n),c.oR.success("Message sent to ".concat(o)),r()}catch(t){console.error("Error sending message to server chat:",t),c.oR.error("Failed to send message to server chat")}})(e.id,e.name),sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover"}},children:(0,Pe.jsx)(N.A,{primary:e.name,secondary:"Room + Server Chat"})},e.id)))}):(0,Pe.jsx)(p.A,{color:"text.secondary",sx:{textAlign:"center"},children:"No Room + Server Chats available"})]})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:r,children:"Cancel"}),(0,Pe.jsx)(y.A,{variant:"contained",onClick:async()=>{if(j)try{const e="Check out this room".concat(i?": ".concat(i):"","! ").concat(l);await s(j.id,e),c.oR.success("Message sent to ".concat(j.username)),r()}catch(e){console.error("Error sending message:",e),c.oR.error("Failed to send message")}else c.oR.error("Please select a user first")},disabled:!j,children:"Send"})]})]})};var Ve,_e,Je,Ye,Ze,qe=t(7528),Ke=t(6319),Qe=t(8713),$e=t(2183),eo=t(2375),oo=t(2631),to=t(6389),ro=t(8283);const no=(0,ro.i7)(Ve||(Ve=(0,qe.A)(["\n  0% { transform: translateY(0) scale(1); }\n  50% { transform: translateY(-20px) scale(1.2); }\n  100% { transform: translateY(-40px) scale(0.8); opacity: 0; }\n"]))),io=(0,ro.i7)(_e||(_e=(0,qe.A)(["\n  0% { transform: scale(1); opacity: 1; }\n  50% { transform: scale(1.3); opacity: 0.7; }\n  100% { transform: scale(1); opacity: 1; }\n"]))),lo=(0,ro.i7)(Je||(Je=(0,qe.A)(["\n  0% { transform: translateX(0); }\n  20% { transform: translateX(-15px); }\n  40% { transform: translateX(15px); }\n  60% { transform: translateX(-15px); }\n  80% { transform: translateX(15px); }\n  100% { transform: translateX(0); }\n"]))),so=(0,ro.i7)(Ye||(Ye=(0,qe.A)(["\n  0% { transform: translateY(20px) scale(0.5); opacity: 0; }\n  20% { transform: translateY(0) scale(1.2); opacity: 1; }\n  40% { transform: translateY(-10px) scale(1.0); }\n  60% { transform: rotate(-10deg); }\n  80% { transform: rotate(10deg); }\n  100% { transform: rotate(0) scale(1.1); }\n"]))),ao=(0,ro.i7)(Ze||(Ze=(0,qe.A)(["\n  0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }\n  100% { transform: translate(var(--x-end), var(--y-end)) rotate(var(--rotation)); opacity: 0; }\n"]))),co=e=>{let{color:o,delay:t,size:r}=e;const n=300*Math.random()-150,i=200*Math.random()-50,l=360*Math.random();return(0,Pe.jsx)(u.A,{sx:{position:"absolute",width:r,height:r,backgroundColor:o,borderRadius:"2px",opacity:1,animation:"".concat(ao," 2s forwards ease-out"),animationDelay:"".concat(t,"ms"),"--x-end":"".concat(n,"px"),"--y-end":"".concat(i,"px"),"--rotation":"".concat(l,"deg")}})},uo=()=>{const e=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ff9900","#9900ff"],o=[];for(let t=0;t<100;t++){const r=e[Math.floor(Math.random()*e.length)],n=500*Math.random(),i=6*Math.random()+4;o.push((0,Pe.jsx)(co,{color:r,delay:n,size:i},t))}return(0,Pe.jsx)(u.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:0,height:0},children:o})},mo=e=>{let{color:o}=e;return(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",gap:3,animation:"".concat(lo," 1.5s ease-in-out infinite")},children:[(0,Pe.jsx)(u.A,{sx:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"white",display:"flex",justifyContent:"flex-end",alignItems:"center",border:"2px solid black",overflow:"hidden"},children:(0,Pe.jsx)(u.A,{sx:{width:"25px",height:"25px",borderRadius:"50%",backgroundColor:o,marginRight:"2px"}})}),(0,Pe.jsx)(u.A,{sx:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"white",display:"flex",justifyContent:"flex-end",alignItems:"center",border:"2px solid black",overflow:"hidden"},children:(0,Pe.jsx)(u.A,{sx:{width:"25px",height:"25px",borderRadius:"50%",backgroundColor:o,marginRight:"2px"}})})]})},ho=e=>{let{gift:o,onAnimationComplete:t}=e;(0,n.useEffect)((()=>{const e=setTimeout((()=>{t()}),2500);return()=>clearTimeout(e)}),[t]);return(0,Pe.jsx)(u.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,pointerEvents:"none",bgcolor:"rgba(0, 0, 0, 0.3)"},children:(()=>{switch(o.id){case"side-eye-gift":return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",animation:"".concat(no," 2.5s ease-out forwards")},children:[(0,Pe.jsx)(mo,{color:o.color}),(0,Pe.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:"Side Eye!"})]});case"crown-gift":return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Pe.jsx)(u.A,{sx:{color:o.color,fontSize:120,filter:"drop-shadow(0 0 20px rgba(255,215,0,0.8))",animation:"".concat(so," 2s ease-out forwards"),transformOrigin:"center bottom"},children:(0,Pe.jsx)(to.A,{fontSize:"inherit"})}),(0,Pe.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:"Crown!"})]});case"confetti-gift":return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[(0,Pe.jsx)(uo,{}),(0,Pe.jsx)(u.A,{sx:{color:o.color,fontSize:100,animation:"".concat(io," 0.5s ease-in-out infinite"),filter:"drop-shadow(0 0 10px rgba(255,255,255,0.7))",zIndex:1},children:(0,Pe.jsx)(oo.A,{fontSize:"inherit"})}),(0,Pe.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2,zIndex:1},children:"Confetti!"})]});default:return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",animation:"".concat(no," 2.5s ease-out forwards")},children:[(0,Pe.jsx)(u.A,{sx:{color:o.color,fontSize:100,animation:"".concat(io," 0.5s ease-in-out infinite"),filter:"drop-shadow(0 0 10px rgba(255,255,255,0.7))"},children:o.icon}),(0,Pe.jsxs)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:[o.name,"!"]})]})}})()})},xo=e=>{let{roomId:o,roomOwnerId:t,theme:r,roomStyle:i}=e;const{currentUser:l}=(0,s.As)(),[c,m]=(0,n.useState)([{id:"side-eye-gift",type:"basic",name:"Side Eye",icon:(0,Pe.jsx)(eo.A,{}),value:5,color:"#9C27B0"},{id:"heart-gift",type:"basic",name:"Heart",icon:(0,Pe.jsx)($e.A,{}),value:10,color:"#FF5C8D"},{id:"confetti-gift",type:"basic",name:"Confetti",icon:(0,Pe.jsx)(oo.A,{}),value:15,color:"#FF9800"},{id:"crown-gift",type:"basic",name:"Crown",icon:(0,Pe.jsx)(to.A,{}),value:20,color:"#FFC107"}]),[h,v]=(0,n.useState)([]),g=(0,n.useMemo)((()=>[...c,...h]),[c,h]),[f,b]=(0,n.useState)([]),[A,C]=(0,n.useState)(null),[R,F]=(0,n.useState)(!1),[D,U]=(0,n.useState)(!1),[T,z]=(0,n.useState)(!1),[O,M]=(0,n.useState)(null),G=(null===l||void 0===l?void 0:l.uid)===t,H=(0,n.useRef)(new Set),W=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(!o)return;const e=(0,d.rJ)(a.db,"sideRooms",o,"gifts"),r=(0,d.P)(e,(0,d.My)("timestamp","desc")),n=(0,d.aQ)(r,(e=>{const o=[];(null===l||void 0===l?void 0:l.uid)===t&&!W.current&&e.docChanges().length>0&&e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data(),t=e.doc.id;if(!H.current.has(t)){H.current.add(t);const e=g.find((e=>e.id===o.giftId));o.senderId!==l.uid&&e&&(M(e),z(!0))}}})),W.current&&(e.forEach((e=>{H.current.add(e.id)})),W.current=!1),e.forEach((e=>{const t=e.data();o.push({id:e.id,giftId:t.giftId,giftType:t.giftType,giftName:t.giftName,senderId:t.senderId,senderName:t.senderName,receiverId:t.receiverId,timestamp:t.timestamp,value:t.value})})),b(o)}));return()=>n()}),[o,l,t,g]),(0,n.useEffect)((()=>{}),[O]);const N=()=>{F(!1)};return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),borderRadius:1,overflow:"hidden"},children:[T&&O&&(0,Pe.jsx)(ho,{gift:O,onAnimationComplete:()=>{z(!1),M(null)}}),(0,Pe.jsxs)(u.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:(0,V.X4)(r.palette.background.paper,.1)},"&::-webkit-scrollbar-thumb":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.3),borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.5)}},children:[!G&&(0,Pe.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(r.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Free Gifts"}),(0,Pe.jsx)(j.Ay,{container:!0,spacing:2,sx:{mt:.5},children:c.map((e=>(0,Pe.jsx)(j.Ay,{item:!0,xs:6,sm:3,children:(0,Pe.jsxs)(w.A,{elevation:2,sx:{p:1.5,textAlign:"center",cursor:"pointer",transition:"all 0.2s",bgcolor:(0,V.X4)(e.color,.1),border:"1px solid ".concat((0,V.X4)(e.color,.3)),"&:hover":{transform:"translateY(-3px)",boxShadow:3}},onClick:()=>(e=>{G||(C(e),F(!0))})(e),children:[(0,Pe.jsx)(u.A,{sx:{color:e.color,mb:1,fontSize:30,display:"flex",justifyContent:"center"},children:e.icon}),(0,Pe.jsx)(p.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary},children:e.name}),(0,Pe.jsx)(P.A,{size:"small",label:"Gift",sx:{mt:1,bgcolor:(0,V.X4)(e.color,.2),color:e.color,fontWeight:"bold"}})]})},e.id)))})]}),!G&&(0,Pe.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),bgcolor:(0,V.X4)(r.palette.background.paper,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Premium Gifts"}),(0,Pe.jsx)(P.A,{size:"small",label:"Coming Soon",sx:{bgcolor:(0,V.X4)(r.palette.primary.main,.1),color:r.palette.primary.main,fontWeight:"bold"}})]}),(0,Pe.jsxs)(u.A,{sx:{p:3,textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary,.6),fontStyle:"italic"},children:[(0,Pe.jsx)(Qe.A,{sx:{fontSize:40,mb:1,opacity:.4}}),(0,Pe.jsx)(p.A,{variant:"body2",children:"Premium gifts will be available soon! Stay tuned for exciting new ways to show your support."})]})]}),G&&(0,Pe.jsxs)(u.A,{sx:{p:3,textAlign:"center",bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(r.palette.background.paper,.7),borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider)},children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit",mb:1},children:"Room Owner View"}),(0,Pe.jsx)(p.A,{variant:"body2",sx:{color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:"As the room owner, you can view gifts that others have sent to you."})]}),(0,Pe.jsxs)(u.A,{sx:{p:2,bgcolor:null!==i&&void 0!==i&&i.backgroundGradient?(0,V.X4)((null===i||void 0===i?void 0:i.backgroundColor)||r.palette.background.default,.3):(0,V.X4)(r.palette.background.paper,.5)},children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{mb:2,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:G?"Gifts Received":"Recent Gifts"}),0===f.length?(0,Pe.jsx)(p.A,{variant:"body2",color:null!==i&&void 0!==i&&i.textColor?(0,V.X4)(null===i||void 0===i?void 0:i.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:G?"You haven't received any gifts yet.":"No gifts have been sent yet. Be the first to send a gift!"}):(0,Pe.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:f.map((e=>{const o=g.find((o=>o.id===e.giftId))||{id:e.giftId,type:e.giftType,name:e.giftName,icon:(0,Pe.jsx)(Qe.A,{}),value:e.value,color:"#757575"};return(0,Pe.jsxs)(w.A,{elevation:1,sx:{p:1.5,display:"flex",alignItems:"center",bgcolor:(0,V.X4)(o.color,.05),border:"1px solid ".concat((0,V.X4)(o.color,.2))},children:[(0,Pe.jsx)(u.A,{sx:{color:o.color,mr:1.5,display:"flex"},children:o.icon}),(0,Pe.jsxs)(u.A,{sx:{flexGrow:1},children:[(0,Pe.jsxs)(p.A,{variant:"body2",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary},children:[(0,Pe.jsx)("strong",{children:e.senderName})," sent a ",(0,Pe.jsx)("strong",{children:e.giftName})]}),(0,Pe.jsx)(p.A,{variant:"caption",sx:{color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:e.timestamp?new Date(e.timestamp.toDate()).toLocaleString():"Just now"})]})]},e.id)}))})]})]}),(0,Pe.jsxs)(S.A,{open:R,onClose:N,maxWidth:"xs",fullWidth:!0,children:[(0,Pe.jsxs)(k.A,{children:["Send Gift",(0,Pe.jsx)(x.A,{"aria-label":"close",onClick:N,sx:{position:"absolute",right:8,top:8},children:(0,Pe.jsx)(Ke.A,{})})]}),(0,Pe.jsx)(I.A,{children:A&&(0,Pe.jsxs)(u.A,{sx:{textAlign:"center",py:2},children:[(0,Pe.jsx)(u.A,{sx:{color:A.color,fontSize:60,mb:2,display:"flex",justifyContent:"center"},children:A.icon}),(0,Pe.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:A.name}),(0,Pe.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Are you sure you want to send this gift to the room owner?"})]})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:N,color:"inherit",children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:async()=>{if(l&&A&&o&&t){U(!0);try{await(0,d.gS)((0,d.rJ)(a.db,"sideRooms",o,"gifts"),{giftId:A.id,giftType:A.type,giftName:A.name,senderId:l.uid,senderName:l.displayName||"Anonymous",receiverId:t,timestamp:d.Dc.now(),value:A.value});const e=(0,d.H9)(a.db,"users",t);await(0,d.mZ)(e,{giftCount:(0,d.GV)(1),giftValue:(0,d.GV)(A.value)}),F(!1),U(!1),M(A),z(!0)}catch(e){console.error("Error sending gift:",e),U(!1)}}},variant:"contained",color:"primary",disabled:D,sx:{bgcolor:null===A||void 0===A?void 0:A.color,"&:hover":{bgcolor:(0,V.X4)((null===A||void 0===A?void 0:A.color)||"#000",.8)}},children:"Send Gift"})]})]})]})};var po=t(3125),vo=t(9919),go=t(2917),fo=t(2289),bo=t(8692),yo=t(4066);const Ao=e=>{let{rank:o}=e;const t=()=>{switch(o){case 1:return"#FFD700";case 2:return"#C0C0C0";case 3:return"#CD7F32";default:return"#A0A0A0"}};return(0,Pe.jsx)(P.A,{icon:(()=>{switch(o){case 1:return(0,Pe.jsx)(fo.A,{fontSize:"small"});case 2:case 3:return(0,Pe.jsx)(Se.A,{fontSize:"small"});default:return(0,Pe.jsx)(we.A,{fontSize:"small"})}})(),label:"#".concat(o),size:"small",sx:{bgcolor:(0,V.X4)(t(),.15),color:t(),border:"1px solid ".concat(t()),fontWeight:"bold","& .MuiChip-icon":{color:t()}}})},Co=e=>{let{roomId:o,roomOwnerId:t,theme:r,roomStyle:i}=e;const[s,c]=(0,n.useState)([]),[m,h]=(0,n.useState)(!0),[x,g]=(0,n.useState)("all"),[f,b]=(0,n.useState)("all"),[y,A]=(0,n.useState)(new Set);(0,n.useEffect)((()=>{t&&(async()=>{try{let n;if(h(!0),"room"===f){const e=(0,d.rJ)(a.db,"sideRooms",o,"gifts");let r=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d.My)("timestamp","desc"));if("all"!==x){const o=new Date;"month"===x?o.setMonth(o.getMonth()-1):"week"===x&&o.setDate(o.getDate()-7),r=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d._M)("timestamp",">=",o),(0,d.My)("timestamp","desc"))}n=(0,d.GG)(r)}else{const e=(0,d.Cs)(a.db,"gifts");let o=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d.My)("timestamp","desc"));if("all"!==x){const r=new Date;"month"===x?r.setMonth(r.getMonth()-1):"week"===x&&r.setDate(r.getDate()-7),o=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d._M)("timestamp",">=",r),(0,d.My)("timestamp","desc"))}n=(0,d.GG)(o)}const i=await n,l=new Map;for(const o of i.docs){var e;const t=o.data(),n=t.senderId,i=(null===(e=t.timestamp)||void 0===e?void 0:e.toDate())||new Date,s=o.ref.path.split("/")[1];if(l.has(n)){const e=l.get(n);e.totalGifts+=1,e.totalValue+=t.value||0,i>e.lastGiftDate&&(e.lastGiftDate=i),s&&e.roomsGiftedIn&&e.roomsGiftedIn.add(s)}else try{const e=(0,d.H9)(a.db,"users",n),o=(await(0,d.x7)(e)).data();console.log("Fetched user data for ".concat(n,":"),o);const r=new Set;s&&r.add(s);let c="?";null!==o&&void 0!==o&&o.displayName?c=o.displayName.charAt(0).toUpperCase():null!==o&&void 0!==o&&o.name?c=o.name.charAt(0).toUpperCase():null!==o&&void 0!==o&&o.username?c=o.username.charAt(0).toUpperCase():t.senderName&&(c=t.senderName.charAt(0).toUpperCase());const u=(null===o||void 0===o?void 0:o.profilePic)||(null===o||void 0===o?void 0:o.photoURL)||(null===o||void 0===o?void 0:o.avatarUrl)||(null===o||void 0===o?void 0:o.avatar)||"";console.log("Avatar URL for ".concat(n,":"),u),l.set(n,{userId:n,username:(null===o||void 0===o?void 0:o.username)||(null===o||void 0===o?void 0:o.name)||t.senderName||"Unknown User",displayName:(null===o||void 0===o?void 0:o.displayName)||(null===o||void 0===o?void 0:o.name),avatar:u,totalGifts:1,totalValue:t.value||0,lastGiftDate:i,roomsGiftedIn:r})}catch(r){console.error("Error fetching user data",r);const e=new Set;s&&e.add(s),l.set(n,{userId:n,username:t.senderName||"Unknown User",avatar:"",totalGifts:1,totalValue:t.value||0,lastGiftDate:i,roomsGiftedIn:e})}}const s=Array.from(l.values()).sort(((e,o)=>{const t=o.totalValue-e.totalValue;if(0!==t)return t;if("all"===f){var r,n;const t=(null===(r=e.roomsGiftedIn)||void 0===r?void 0:r.size)||0,i=((null===(n=o.roomsGiftedIn)||void 0===n?void 0:n.size)||0)-t;if(0!==i)return i}return o.totalGifts-e.totalGifts}));c(s)}catch(r){console.error("Error fetching top gifters:",r)}finally{h(!1)}})()}),[o,t,x,f]);return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Pe.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(r.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Top Gifters"}),(0,Pe.jsxs)(po.A,{value:f,exclusive:!0,onChange:(e,o)=>{null!==o&&b(o)},size:"small","aria-label":"gift scope",sx:{"& .MuiToggleButton-root":{color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary,fontSize:"0.7rem",py:.5,px:1,"&.Mui-selected":{color:(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.1)}}},children:[(0,Pe.jsxs)(vo.A,{value:"room",children:[(0,Pe.jsx)(bo.A,{fontSize:"small",sx:{mr:.5}}),"This Room"]}),(0,Pe.jsxs)(vo.A,{value:"all",children:[(0,Pe.jsx)(yo.A,{fontSize:"small",sx:{mr:.5}}),"All Rooms"]})]})]}),(0,Pe.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[{value:"all",label:"All Time"},{value:"month",label:"This Month"},{value:"week",label:"This Week"}].map((e=>(0,Pe.jsx)(P.A,{label:e.label,clickable:!0,size:"small",color:x===e.value?"primary":"default",onClick:()=>g(e.value),sx:{bgcolor:x===e.value?(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.2):(0,V.X4)(r.palette.background.paper,.5),color:x===e.value?(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary,borderColor:x===e.value?(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main:r.palette.divider,border:"1px solid"}},e.value)))})]}),(0,Pe.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:0,bgcolor:null!==i&&void 0!==i&&i.backgroundGradient?(0,V.X4)((null===i||void 0===i?void 0:i.backgroundColor)||r.palette.background.default,.3):(0,V.X4)(r.palette.background.paper,.5),"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:(0,V.X4)(r.palette.background.paper,.1)},"&::-webkit-scrollbar-thumb":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.3),borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.5)}},children:m?(0,Pe.jsx)(D.A,{children:[...Array(5)].map(((e,o)=>(0,Pe.jsxs)(n.Fragment,{children:[(0,Pe.jsxs)(U.Ay,{children:[(0,Pe.jsx)(W.A,{children:(0,Pe.jsx)(go.A,{variant:"circular",width:40,height:40})}),(0,Pe.jsx)(N.A,{primary:(0,Pe.jsx)(go.A,{width:"60%"}),secondary:(0,Pe.jsx)(go.A,{width:"40%"})}),(0,Pe.jsx)(go.A,{variant:"rounded",width:60,height:24,sx:{ml:1}})]}),o<4&&(0,Pe.jsx)(F.A,{variant:"inset",component:"li"})]},o)))}):s.length>0?(0,Pe.jsx)(D.A,{sx:{py:0},children:s.map(((e,o)=>(0,Pe.jsxs)(n.Fragment,{children:[(0,Pe.jsxs)(U.Ay,{component:l.N_,to:"/profile/".concat(e.userId),alignItems:"center",sx:{transition:"background-color 0.2s",bgcolor:o<3?(0,V.X4)(0===o?"#FFD700":1===o?"#C0C0C0":"#CD7F32",.05):"transparent","&:hover":{bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.1),textDecoration:"none"},textDecoration:"none"},children:[(0,Pe.jsx)(W.A,{children:(0,Pe.jsx)(v.A,{src:y.has(e.userId)?"":e.avatar,alt:e.displayName||e.username,onError:()=>{return o=e.userId,void A((e=>new Set(e).add(o)));var o},sx:{border:o<3?"2px solid ".concat(0===o?"#FFD700":1===o?"#C0C0C0":"#CD7F32"):void 0},children:(y.has(e.userId)||!e.avatar)&&(e.displayName||e.username||"?").charAt(0).toUpperCase()})}),(0,Pe.jsx)(N.A,{primary:(0,Pe.jsx)(p.A,{variant:"body2",fontWeight:o<3?"bold":"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary},children:e.displayName||e.username}),secondary:(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,Pe.jsxs)(p.A,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5,color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:[(0,Pe.jsx)(we.A,{fontSize:"inherit"}),e.totalGifts," gift",1!==e.totalGifts?"s":""]}),"all"===f&&e.roomsGiftedIn&&e.roomsGiftedIn.size>1&&(0,Pe.jsx)(P.A,{size:"small",label:"".concat(e.roomsGiftedIn.size," rooms"),sx:{height:16,fontSize:"0.6rem",ml:1,bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.secondary.main,.1),color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary}})]})}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Pe.jsxs)(p.A,{variant:"body2",sx:{fontWeight:"bold",color:(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:[e.totalValue," pts"]}),(0,Pe.jsx)(Ao,{rank:o+1})]})]}),o<s.length-1&&(0,Pe.jsx)(F.A,{variant:"inset",component:"li"})]},e.userId)))}):(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:3},children:[(0,Pe.jsx)(we.A,{sx:{fontSize:40,color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.5),mb:2}}),(0,Pe.jsx)(p.A,{variant:"body1",sx:{textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:"room"===f?"No gifts have been sent in this room yet":"No gifts have been sent to this creator yet"}),(0,Pe.jsx)(p.A,{variant:"caption",sx:{textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.5),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",mt:1},children:"Send a gift to show your appreciation!"})]})})]})},jo=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],wo=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],So=[12,14,16,18,20,24,28,32],ko=e=>{let{icon:o,color:t}=e;const[i,l]=(0,n.useState)({left:"".concat(80*Math.random()+10,"%"),top:"".concat(20*Math.random()+40,"%"),animationDuration:"".concat(3*Math.random()+2,"s"),opacity:1});return(0,n.useEffect)((()=>{const e=setTimeout((()=>{l((e=>(0,r.A)((0,r.A)({},e),{},{opacity:0})))}),2e3);return()=>clearTimeout(e)}),[]),(0,Pe.jsx)(u.A,{sx:(0,r.A)({position:"fixed",fontSize:"28px",color:t,pointerEvents:"none",zIndex:1e3,transition:"opacity 1s ease-out",animation:"float-around 3s ease-out forwards","@keyframes float-around":{"0%":{transform:"scale(0.5) rotate(0deg) translate(0, 0)"},"25%":{transform:"scale(1.2) rotate(10deg) translate(20px, -30px)"},"50%":{transform:"scale(1.4) rotate(-5deg) translate(-15px, -60px)"},"75%":{transform:"scale(1.1) rotate(15deg) translate(25px, -90px)"},"100%":{transform:"scale(0.8) rotate(-10deg) translate(0, -120px)"}}},i),children:o})},Io=e=>{let{handleHeartRoom:o,handleHeartbreakRoom:t,currentUserHearted:r,currentUserHeartbroken:n,roomHeartCount:i,roomHeartbreakCount:l,isHearting:s,isHeartbreaking:a,accentColor:d,textColor:c}=e;const v=(0,m.A)();return(0,Pe.jsxs)(u.A,{sx:{position:"fixed",right:20,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:1,backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)",borderRadius:2,padding:1,zIndex:100,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Pe.jsx)(h.A,{title:r?"Unheart Room":"Heart Room",children:(0,Pe.jsx)(x.A,{onClick:o,color:r?"error":"inherit",sx:{color:r?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:s,children:r?(0,Pe.jsx)(_.A,{}):(0,Pe.jsx)(J.A,{})})}),(0,Pe.jsx)(p.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:i||0})]}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Pe.jsx)(h.A,{title:n?"Remove Heartbreak":"Heartbreak Room",children:(0,Pe.jsx)(x.A,{onClick:t,color:n?"error":"inherit",sx:{color:n?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:a,children:n?(0,Pe.jsx)(Y.A,{}):(0,Pe.jsx)(Z.A,{})})}),(0,Pe.jsx)(p.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:l||0})]})]})},Ro=()=>{var e,o,t,l,L,B,X,V;const{roomId:J}=(0,i.g)(),Z=(0,i.Zp)(),{currentUser:Ce,blockUser:je}=(0,s.As)(),we=(0,m.A)(),[Se,ke]=(0,n.useState)(null),[Ie,Re]=(0,n.useState)(!1),[Ee,Fe]=(0,n.useState)(!0),[ze,Ne]=(0,n.useState)(null),[Le,Ve]=(0,n.useState)(!1),[_e,Je]=(0,n.useState)(!1),[Ye,Ze]=(0,n.useState)(""),[qe,Ke]=(0,n.useState)(!1),[Qe,$e]=(0,n.useState)(!1),[eo,oo]=(0,n.useState)(!1),[to,ro]=(0,n.useState)(!1),[no,io]=(0,n.useState)(null),[lo,so]=(0,n.useState)([]),[ao,co]=(0,n.useState)(null),[uo,mo]=((0,n.useRef)(null),(0,n.useState)(null)),[ho,xo]=(0,n.useState)(null),[po,vo]=(0,n.useState)(null),[go,fo]=(0,n.useState)(!1),[bo,yo]=(0,n.useState)(!1),[Ao,Co]=(0,n.useState)(0),[Ro,Fo]=(0,n.useState)(!1),[Po,Do]=(0,n.useState)(null),Uo=(0,n.useRef)(null),[To,zo]=(0,n.useState)(0),[Oo,Mo]=(0,n.useState)(!1),[Go,Ho]=(0,n.useState)(!1),[Wo,No]=(0,n.useState)(!1),[Lo,Bo]=(0,n.useState)(""),[Xo,Vo]=(0,n.useState)(null),[_o,Jo]=(0,n.useState)(""),[Yo,Zo]=(0,n.useState)([]),[qo,Ko]=(0,n.useState)(!1),[Qo,$o]=(0,n.useState)(null),[et,ot]=(0,n.useState)(!1),tt=(0,n.useRef)(null),[rt,nt]=(0,n.useState)(null),[it,lt]=(0,n.useState)(!1),[st,at]=(0,n.useState)([]),[dt,ct]=(0,n.useState)(""),[ut,mt]=(0,n.useState)(!1),ht=(0,n.useRef)(null),[xt,pt]=(0,n.useState)(""),[vt,gt]=(0,n.useState)(!1),[ft,bt]=(0,n.useState)(30),[yt,At]=(0,n.useState)(!1),[Ct,jt]=(0,n.useState)(jo[0].name),[wt,St]=(0,n.useState)(!1),[kt,It]=(0,n.useState)(!1),[Rt,Et]=(0,n.useState)(wo[0]),[Ft,Pt]=(0,n.useState)(So[2]),[Dt,Ut]=((0,n.useRef)(null),(0,n.useState)(!1)),[Tt,zt]=(0,n.useState)(!1),[Ot,Mt]=(0,n.useState)(window.innerWidth>1024),[Gt,Ht]=(0,n.useState)(null),[Wt,Nt]=(0,n.useState)(!1),[Lt,Bt]=(0,n.useState)(null),[Xt,Vt]=(0,n.useState)(null),_t=(0,n.useRef)([]),[Jt,Yt]=(0,n.useState)(!1),[Zt,qt]=(0,n.useState)(null),Kt="youtube-player-placeholder",[Qt,$t]=(0,n.useState)(!1),[er,or]=(0,n.useState)(null),[tr,rr]=(0,n.useState)([]),[nr,ir]=(0,n.useState)([]),[lr,sr]=(0,n.useState)(!1),ar=(0,n.useCallback)((()=>{po&&(console.log("Camera state before toggle:",po.camera.state),"enabled"!==po.camera.state.status?(c.oR.loading("Enabling camera..."),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((e=>(console.log("Camera access granted:",e),e.getTracks().forEach((e=>e.stop())),po.camera.enable()))).then((()=>{Yt(!0),c.oR.dismiss(),c.oR.success("Camera enabled")})).catch((e=>{console.error("Error enabling camera:",e),c.oR.dismiss(),c.oR.error("Could not enable camera. Please check camera permissions in your browser settings.")}))):po.camera.disable().then((()=>{Yt(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)})))}),[po]),dr=(0,n.useRef)(0),cr=(0,n.useRef)(0),ur=(0,n.useRef)(0);(0,n.useEffect)((()=>{const e=()=>{Mt(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,n.useEffect)((()=>{if(po){const e="enabled"===po.camera.state.status;Yt(e);const o=setInterval((()=>{const e="enabled"===po.camera.state.status;Yt(e)}),1e3);return()=>{clearInterval(o)}}}),[po]),(0,n.useEffect)((()=>{po&&navigator.mediaDevices.getUserMedia({video:!0}).then((()=>{console.log("Camera permissions granted")})).catch((e=>{console.error("Camera permission denied:",e),c.oR.error("Camera permissions denied. You won't be able to share video.")}))}),[po]),(0,n.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,He.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),nt(o)})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),nt(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),nt(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),nt(null)}}),[]),(0,n.useEffect)((()=>{if(eo)if(null!==Se&&void 0!==Se&&Se.style){const e=Se.style,o=jo.find((o=>o.name===e.themeName));jt(o?e.themeName:jo[0].name);const t=o||jo[0];St(void 0!==e.headerGradient?e.headerGradient:t.headerGradient||!1),It(void 0!==e.backgroundGradient?e.backgroundGradient:t.backgroundGradient||!1),Et(wo.includes(e.font)?e.font:wo[0]),Pt(So.includes(e.headerFontSize)?e.headerFontSize:So[2])}else jt(jo[0].name),St(jo[0].headerGradient||!1),It(jo[0].backgroundGradient||!1),Et(wo[0]),Pt(So[2])}),[eo,Se]),(0,n.useEffect)((()=>{if(!J||!a.db||0===lo.length)return;const e=lo.filter((e=>e.isOnline)).length,o=Date.now(),t=o-cr.current;if(e!==dr.current&&t>1e4){console.log("[Active Users Update] Updating count from ".concat(dr.current," to ").concat(e));const t=(0,d.H9)(a.db,"sideRooms",J);(0,d.mZ)(t,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{dr.current=e,cr.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}dr.current=e}),[J,a.db,lo.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===Ce||void 0===Ce?void 0:Ce.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===Se||void 0===Se?void 0:Se.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===Se||void 0===Se?void 0:Se.viewers)||"null/undefined");const mr=(0,n.useMemo)((()=>{if(null===Ce||void 0===Ce||!Ce.uid||null===Se||void 0===Se||!Se.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=Ce.uid===Se.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===Ce||void 0===Ce?void 0:Ce.uid,null===Se||void 0===Se?void 0:Se.ownerId]),hr=(0,n.useMemo)((()=>{if(null===Se||void 0===Se||!Se.viewers||null===Ce||void 0===Ce||!Ce.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=Se.viewers.some((e=>e.userId===Ce.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===Se||void 0===Se?void 0:Se.viewers,null===Ce||void 0===Ce?void 0:Ce.uid]),xr=!!Se&&(mr||!0),pr=(0,n.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",lo);const e=new Map;lo.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[lo]),vr=(0,n.useMemo)((()=>{if(!Se||!Se.viewers||!Array.isArray(Se.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(Se.viewers,null,2));const e=Se.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[Se]),gr=(0,n.useCallback)((async(e,o,t,r,n)=>{if(!e||null===o||void 0===o||!o.uid||!n)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var l,s;const a=(0,d.H9)(t,"users",i),c=await(0,d.x7)(a);let u="",m="",h=(null===(l=o.email)||void 0===l?void 0:l.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let x="viewer";r?x="owner":null!==(s=n.viewers)&&void 0!==s&&s.some((e=>e.userId===i&&"guest"===e.role))&&(x="guest");const p=(0,d.H9)(t,"sideRooms",e,"presence",i),v={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:x,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(v,null,2)),await(0,d.BN)(p,v,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(a){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),a)}}),[]);(0,n.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(J,", HasAccess: ").concat(xr,", CurrentUserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid,", IsRoomOwner: ").concat(mr,", RoomExists: ").concat(!!Se)),xr&&J&&Ce&&Se?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(Ce.uid," in room ").concat(J,".")),gr(J,Ce,a.db,mr,Se)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(xr,", RoomId: ").concat(!!J,", CurrentUser: ").concat(!!Ce,", Room: ").concat(!!Se))}),[J,Ce,a.db,mr,Se,xr,gr]),(0,n.useEffect)((()=>{const e=null===Ce||void 0===Ce?void 0:Ce.uid,o=J;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const t=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(t,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[J,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]);const fr=()=>{No(!0)},br=()=>{No(!1),Bo("")},yr=()=>{if(!J)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!mr)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(a.db,"sideRooms",J);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),Vo(null),c.oR.success("Shared video cleared.")};(0,n.useEffect)((()=>{if(null===Ce||void 0===Ce||!Ce.uid||!J||!xr||uo)return;(async()=>{try{console.log("[Stream] Fetching token for user:",Ce.uid),console.log("[Stream] Data being sent - User ID:",Ce.uid),console.log("[Stream] Data being sent - Display Name:",Ce.displayName),console.log("[Stream] Data being sent - Photo URL:",Ce.photoURL);const t="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(t));const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:Ce.uid,userName:Ce.displayName||Ce.email||"UnknownUser",userImage:Ce.photoURL||void 0})});console.log("[Stream] Response status: ".concat(r.status));const n={};if(r.headers.forEach(((e,o)=>{n[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(n,null,2)),!r.ok){var e;let t={error:"HTTP error! Status: ".concat(r.status)};try{const e=await r.text();console.log("[Stream] Non-OK response body (text):",e),t=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),t.error=r.statusText||t.error}throw new Error((null===(e=t)||void 0===e?void 0:e.error)||"HTTP status ".concat(r.status))}const{token:i}=await r.json();if(!i)throw new Error("Stream token was not provided by backend.");mo(i),console.log("[Stream] Token fetched successfully.")}catch(ze){console.error("[Stream] Error fetching token:",ze),c.oR.error("Stream Token Error: ".concat(ze.message||"Load failed")),mo(null)}})()}),[Ce,J,xr,uo]),(0,n.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!uo||null===Ce||void 0===Ce||!Ce.uid||ho)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!uo,", currentUser=").concat(!(null===Ce||void 0===Ce||!Ce.uid),", apiKey=").concat(!0,", clientExists=").concat(!!ho));console.log("[Stream] Initializing StreamVideoClient with token.");const t=(null===(e=Ce.profile)||void 0===e?void 0:e.name)||Ce.displayName||Ce.email||Ce.uid,r=(null===(o=Ce.profile)||void 0===o?void 0:o.profilePic)||Ce.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(t,", photoURL: ").concat(r));const n={id:Ce.uid,name:t,image:r};try{const e=new Ue.Hq({apiKey:"2nufecjmzmzh",user:n,token:uo});xo(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(ze){console.error("[Stream] Error initializing StreamVideoClient:",ze),c.oR.error("Failed to initialize Stream video client: ".concat(ze instanceof Error?ze.message:String(ze)))}return()=>{ho&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),xo(null))}}),[uo,Ce,ho]),(0,n.useEffect)((()=>{if(!bo||!ho||!J||null===Ce||void 0===Ce||!Ce.uid)return void(bo&&yo(!1));if(po)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void yo(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(J)),fo(!0);try{const e=ho.call("default",J);if(await e.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(e.cid)),vo(e),mr&&J&&a.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(a.db,"sideRooms",J);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(ze){console.error("[Stream Call] Error joining or creating call:",ze),c.oR.error("Failed to connect to audio: ".concat(ze.message||"Unknown error")),vo(null)}finally{fo(!1),yo(!1)}})(),()=>{yo(!1)}}),[bo,ho,J,null===Ce||void 0===Ce?void 0:Ce.uid,po]),(0,n.useEffect)((()=>()=>{po&&(console.log("[Stream Call] Leaving active call ".concat(po.cid," on component unmount or room change.")),po.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(po.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(po.cid,":"),e))).finally((()=>{if(vo(null),mr&&J&&a.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(a.db,"sideRooms",J);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[po,J,mr,a.db]),(0,n.useEffect)((()=>{if(!J||!Ce)return;const e=(0,d.H9)(a.db,"sideRooms",J),o=(0,d.aQ)(e,(e=>{if(e.exists()){const t=(0,r.A)({id:e.id},e.data());if(ke(t),Co(t.heartCount||0),Fe(!1),t.isPrivate&&t.password&&t.ownerId!==Ce.uid){var o;(null===(o=t.viewers)||void 0===o?void 0:o.some((e=>e.userId===Ce.uid&&"guest"!==e.role)))||Je(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(J,"' reported as non-existent. Current error: '").concat(ze,"'. Setting room state to null.")),Ne("Room not found"),ke(null),Fe(!1)}));let t;if(null!==Ce&&void 0!==Ce&&Ce.uid){const e=(0,d.H9)(a.db,"sideRooms",J,"heartedBy",Ce.uid);t=(0,d.aQ)(e,(e=>{Fo(e.exists())}))}const n=(0,d.P)((0,d.rJ)(a.db,"sideRooms",J,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(n,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===Ce||void 0===Ce?void 0:Ce.uid)&&o.username&&(Do("".concat(o.username," hearted the room!")),Uo.current&&clearTimeout(Uo.current),Uo.current=setTimeout((()=>{Do(null)}),3e3))}}))}));return()=>{o(),t&&t(),i(),Uo.current&&clearTimeout(Uo.current)}}),[J,Ce]),(0,n.useEffect)((()=>{if(!J||!a.db||null===Ce||void 0===Ce||!Ce.uid)return;const e=(0,d.H9)(a.db,"sideRooms",J),o=(0,d.H9)(a.db,"sideRooms",J,"heartbrokenBy",Ce.uid),t=(0,d.aQ)(e,(e=>{if(e.exists()){const o=e.data();zo(o.heartbreakCount||0)}})),r=(0,d.aQ)(o,(e=>{Mo(e.exists())}));return()=>{t(),r()}}),[J,a.db,null===Ce||void 0===Ce?void 0:Ce.uid]),(0,n.useEffect)((()=>{if(tr.length>0){const e=setTimeout((()=>{rr((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[tr]),(0,n.useEffect)((()=>{if(nr.length>0){const e=setTimeout((()=>{ir((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[nr]);const Ar=async e=>{if(!a.db||!e)return null;try{const o=(0,d.rJ)(a.db,"rooms"),t=(0,d.P)(o,(0,d._M)("createdBy","==",e),(0,d._M)("type","==","public")),r=await(0,d.GG)(t);if(!r.empty){const e=r.docs[0];return{id:e.id,name:e.data().name||"Chat Room"}}return null}catch(ze){return console.error("[SideRoomComponent] Error checking for server chat room:",ze),null}};(0,n.useEffect)((()=>{if(null===Ce||void 0===Ce||!Ce.uid||null===Se||void 0===Se||!Se.ownerId)return;(async()=>{try{const e=(0,d.H9)(a.db,"users",Se.ownerId),o=await(0,d.x7)(e);if(!(o.exists()&&!0===o.data().isPrivate))return;const t=(0,d.H9)(a.db,"users",Ce.uid,"following",Se.ownerId),r=(0,d.H9)(a.db,"users",Se.ownerId,"followRequests",Ce.uid),[n,i]=await Promise.all([(0,d.x7)(t),(0,d.x7)(r)]);if(n.exists()&&!i.exists()){const e=await Ar(Se.ownerId);e&&(or(e),$t(!0))}}catch(ze){console.error("Error checking follow status:",ze)}})();const e=(0,d.H9)(a.db,"users",Ce.uid,"following",Se.ownerId),o=(0,d.aQ)(e,(e=>{e.exists()&&Ar(Se.ownerId).then((e=>{e&&(or(e),$t(!0))}))}));return()=>o()}),[Ce,Se,a.db,Z,Ar]),(0,n.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(J,", HasAccess: ").concat(xr,", CurrentUserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid)),!J||!xr||null===Ce||void 0===Ce||!Ce.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(J,", HasAccess: ").concat(xr,", UserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid)),void so([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(J));const e=(0,d.rJ)(a.db,"sideRooms",J,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,r.A)({userId:e.id},e.data()))),t=Date.now();let n=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&t-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((t-e.lastSeen)/1e3)," seconds old).")),!n&&a.db&&e.userId!==(null===Ce||void 0===Ce?void 0:Ce.uid)){const o=(0,d.H9)(a.db,"sideRooms",J,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),n=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),so(i);const l=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(l))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),so([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(J,".")),o()}}),[J,xr,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]),(0,n.useEffect)((()=>{const e=null===Ce||void 0===Ce?void 0:Ce.uid,o=J;return()=>{if(e&&o&&a.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const t=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(t,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[J,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]),(0,n.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(J,", HasAccess: ").concat(xr,", CurrentUserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid,", IsRoomOwner: ").concat(mr,", RoomExists: ").concat(!!Se)),!J||null===Ce||void 0===Ce||!Ce.uid||!Se||!xr){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(J,", UserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid,", HasAccess: ").concat(xr,", RoomExists: ").concat(!!Se)),null!==Ce&&void 0!==Ce&&Ce.uid&&J){const e=(0,d.H9)(a.db,"sideRooms",J,"presence",Ce.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(Ce.uid," in room ").concat(J)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(Ce.uid,":"),e)}))}return}const e=Ce.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(J,"."));let o=null;return(async()=>{try{var t,r;const n=(0,d.H9)(a.db,"users",e),i=await(0,d.x7)(n);let l="",s="",c=(null===(t=Ce.email)||void 0===t?void 0:t.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();l=o.name||o.username||"",s=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(l,"', Pic='").concat(s,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),l=Ce.displayName||"",s=Ce.photoURL||"";let u="viewer";mr?u="owner":null!==(r=Se.viewers)&&void 0!==r&&r.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(a.db,"sideRooms",J,"presence",e),h={userId:e,username:c,avatar:s,lastSeen:Date.now(),isOnline:!0,role:u,displayName:l,photoURL:s},x="sideRooms/".concat(J,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",x,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-ur.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),ur.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(ze){console.error("[Presence Heartbeat] Error updating heartbeat:",ze)}}),6e4))}catch(n){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),n)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(J,". Setting offline."));const t=(0,d.H9)(a.db,"sideRooms",J,"presence",e);(0,d.mZ)(t,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[J,Ce,a.db,mr,Se,xr]),(0,n.useEffect)((()=>{if(J)return()=>{}}),[J]),(0,n.useEffect)((()=>{Se&&Se.currentSharedVideoUrl?Vo(Se.currentSharedVideoUrl):Se&&!Se.currentSharedVideoUrl&&Vo(null)}),[Se]),(0,n.useEffect)((()=>{if(!rt)return;const e=e=>{c.oR.success(e.message),ot(!1),Jo(""),$o(null),Zo([]),$e(!1)},o=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),ot(!1)},t=e=>{e.roomId===J&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},r=e=>{e.error?(c.oR.error(e.error),Zo([])):Zo(e.users)},n=e=>{e===J&&null!==Ce&&void 0!==Ce&&Ce.uid&&((0,c.oR)("The host has removed you from the room."),null===po||void 0===po||po.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{Z("/side-rooms")})))};return rt.on("invite-success",e),rt.on("invite-failed",o),rt.on("guest-joined",t),rt.on("user-search-results-for-invite",r),rt.on("force-remove",n),()=>{rt.off("invite-success",e),rt.off("invite-failed",o),rt.off("guest-joined",t),rt.off("user-search-results-for-invite",r),rt.off("force-remove",n)}}),[rt,J,Z,po,null===Ce||void 0===Ce?void 0:Ce.uid]);const Cr=(0,n.useCallback)((0,Ge.debounce)((e=>{e.trim().length>=2&&(rt?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),rt.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[rt]),jr=(0,n.useCallback)((()=>{ro(!0)}),[]),wr=(0,n.useCallback)((e=>{io(e.currentTarget)}),[]),Sr=(0,n.useCallback)((()=>{io(null)}),[]),kr=(0,n.useCallback)((()=>{Ke(!0),Sr()}),[Sr]),Ir=(0,n.useCallback)((()=>{oo(!0),Sr()}),[Sr]),Rr=(0,n.useCallback)((()=>{$e(!0),Jo(""),$o(null),Zo([]),Ko(!1),Sr()}),[Sr]),Er=(0,n.useCallback)((async()=>{if(ot(!0),rt&&null!==Ce&&void 0!==Ce&&Ce.uid&&J&&null!==Qo&&void 0!==Qo&&Qo.username){console.log("Emitting invite-user-to-room: ".concat(Qo.username));try{var e;const o=(0,d.P)((0,d.rJ)(a.db,"users"),(0,d._M)("username","==",Qo.username)),t=await(0,d.GG)(o);if(t.empty)return c.oR.error("User not found."),void ot(!1);t.docs[0].data();const r=t.docs[0].id,n=(0,d.H9)(a.db,"sideRooms",J),i=await(0,d.x7)(n);if(!i.exists())return c.oR.error("Room not found."),void ot(!1);const l=i.data();if(null===(e=l.viewers)||void 0===e?void 0:e.some((e=>e.userId===r)))return c.oR.error("".concat(Qo.username," is already in this room.")),void ot(!1);rt.emit("invite-user-to-room",{roomId:J,inviterId:Ce.uid,inviteeUsername:Qo.username})}catch(ze){console.error("Error checking if user is in room:",ze),rt.emit("invite-user-to-room",{roomId:J,inviterId:Ce.uid,inviteeUsername:Qo.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!rt,currentUser:!(null===Ce||void 0===Ce||!Ce.uid),roomId:J,selectedInviteeForInvite:Qo}),c.oR.error("Cannot send invite: connection or user data issue."),ot(!1)}),[null===Ce||void 0===Ce?void 0:Ce.uid,J,Qo,rt,a.db]),Fr=(0,n.useCallback)((async()=>{if(J&&mr&&(Sr(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){Ve(!0);try{const e=(0,d.H9)(a.db,"sideRooms",J);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),Z("/side-rooms")}catch(ze){console.error("Error deleting room:",ze),c.oR.error("Failed to delete room")}finally{Ve(!1)}}}),[J,mr,Z]),Pr=(0,n.useCallback)((async(e,o)=>{if(!mr||!J||e===(null===Ce||void 0===Ce?void 0:Ce.uid))return;console.log("Owner toggling mute for ".concat(e,". Currently muted: ").concat(o));const t=!o,r=(0,d.H9)(a.db,"sideRooms",J,"presence",e);try{await(0,d.mZ)(r,{isMuted:t}),console.warn("[SideRoomComponent] handleForceMuteToggle needs to be connected to the correct signaling (e.g., general Socket.IO emit)"),c.oR.success("User ".concat(t?"muted":"unmuted","."))}catch(ze){console.error("Error toggling mute for ".concat(e,":"),ze),c.oR.error("Failed to update mute status.")}}),[mr,J,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]),Dr=(0,n.useCallback)(((e,o)=>{if(!mr||!J||e===(null===Ce||void 0===Ce?void 0:Ce.uid)||!rt)return;const t=o||"this user";window.confirm("Are you sure you want to remove ".concat(t," from the room?"))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(J)),rt.emit("force-remove",{roomId:J,targetUserId:e}),c.oR.success("Removing ".concat(t,"...")))}),[mr,J,null===Ce||void 0===Ce?void 0:Ce.uid,rt]),Ur=(0,n.useCallback)(((e,o)=>{if(!mr||!J||e===(null===Ce||void 0===Ce?void 0:Ce.uid))return;const t=o||"this user";if(window.confirm("Are you sure you want to block ".concat(t,"? They will be removed from the room.")))try{je(e).then((()=>{c.oR.success("Blocked ".concat(t)),console.log("User ".concat(e," has been blocked"))})).catch((e=>{console.error("Error blocking user:",e),c.oR.error("Failed to block user")}))}catch(ze){console.error("Error initiating block:",ze),c.oR.error("Failed to block user")}}),[mr,J,null===Ce||void 0===Ce?void 0:Ce.uid,je]),Tr=()=>{setTimeout((()=>{var e;null===(e=ht.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,n.useEffect)((()=>{it&&Tr()}),[st,it,xt]),(0,n.useEffect)((()=>{if(!vt||!xt)return;let e=0;const o=xt,t=()=>{e<o.length?(at((t=>{const n=[...t];if(n.length>0&&"ai"===n[n.length-1].sender){const t=n[n.length-1];n[n.length-1]=(0,r.A)((0,r.A)({},t),{},{text:o.substring(0,e+1)})}return n})),e++,setTimeout(t,ft)):(gt(!1),pt(""))};return t(),()=>{gt(!1)}}),[vt,xt,ft]);const zr=e=>{at((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,t)=>t===e.length-1?(0,r.A)((0,r.A)({},o),{},{text:""}):o))})),pt(e),gt(!0)};(0,n.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?at(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(ze){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",ze),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,n.useEffect)((()=>{(st.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(st))}),[st]);const Or=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt).trim();if(!o)return;const t={sender:"user",text:o};at((e=>[...e,t])),ct(""),mt(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const t="https://sideeye-backend-production.up.railway.app";if(!t)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),zr("Configuration error: Backend URL not set."),void mt(!1);const n="".concat(t,"/api/sade-ai");if(null===Ce||void 0===Ce||!Ce.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),zr("Error: Could not identify user."),void mt(!1);at((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),l=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),s={message:o,forceSearch:e,userId:Ce.uid,contextFlags:{avoidAppInstructions:i&&!l,isGreeting:i,isInstructionQuery:l,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",s);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},d=await fetch(n,a);if(at((e=>e.filter(((o,t)=>t!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(r){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(at((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),zr(c.response)):zr(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),zr("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),zr("Sorry, I got a bit confused there."))}catch(n){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",n),at((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),zr("Sorry, there was an error: ".concat(n.message||"Unknown error"))}finally{mt(!1),Tr()}};(0,n.useEffect)((()=>{const e=Xo?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(Xo):null,o=()=>{if(Zt&&(Zt.destroy(),qt(null)),e&&document.getElementById(Kt)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(Kt,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});qt(o)}else!e&&Zt&&(Zt.destroy(),qt(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{Zt&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),Zt.destroy(),qt(null))}}),[Xo]);const Mr=e=>(0,Pe.jsx)("div",{id:Kt,style:{width:"100%",height:"100%"}}),Gr=Se?"".concat(Se.name," - SideEye"):Ee?"Loading Room...":"Room Not Found - SideEye",Hr=Se&&Se.description||"Join the conversation on SideEye.",Wr="".concat(window.location.origin,"/default-app-logo.png"),Nr=(null===Se||void 0===Se?void 0:Se.thumbnailUrl)||Wr,Lr="".concat(window.location.origin,"/side-room/").concat(J||"");if(Ee&&!Se)return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(Me.mg,{children:(0,Pe.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,Pe.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,Pe.jsx)(A.A,{})})]});if(ze&&!Se)return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(Me.mg,{children:(0,Pe.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,Pe.jsxs)(u.A,{sx:{p:3,textAlign:"center"},children:[(0,Pe.jsx)(C.A,{severity:"error",children:ze}),(0,Pe.jsxs)(y.A,{onClick:()=>Z("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const Br=async()=>{if(po)if(Ot)try{await po.screenShare.toggle();const e=po.screenShare.enabled;zt(e),e?(c.oR.success("Screen sharing started. All participants will see your screen automatically."),rt&&null!==Se&&void 0!==Se&&Se.id&&null!==Ce&&void 0!==Ce&&Ce.uid&&rt.emit("start-screen-share",{roomId:Se.id,userId:Ce.uid})):(c.oR.success("Screen sharing stopped."),rt&&null!==Se&&void 0!==Se&&Se.id&&null!==Ce&&void 0!==Ce&&Ce.uid&&rt.emit("stop-screen-share",{roomId:Se.id,userId:Ce.uid}))}catch(ze){var e,o,t,r;console.error("Error toggling screen share:",ze),"NotAllowedError"===ze.name||null!==(e=ze.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=ze.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(t=ze.message)&&void 0!==t&&t.includes("getDisplayMedia is not supported")||null!==(r=ze.message)&&void 0!==r&&r.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(ze.message||"Unknown error")),po.screenShare&&zt(po.screenShare.enabled)}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")},Xr=async()=>{if(Se&&Ye&&Ce){Ve(!0);try{if(Se.password===Ye){const e=(0,d.H9)(a.db,"sideRooms",J),o=await(0,d.x7)(e),t=o.data().viewers||[];t.some((e=>e.userId===Ce.uid))||await(0,d.mZ)(e,{viewers:[...t,{userId:Ce.uid,username:Ce.displayName||Ce.email||"User",role:"viewer",joinedAt:(0,d.O5)()}]}),c.oR.success("Password correct. Welcome to the room!"),Je(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(ze){console.error("Error verifying password:",ze),c.oR.error("An error occurred. Please try again.")}finally{Ve(!1)}}else c.oR.error("Missing information. Please try again.")},Vr=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))c.oR.error("Screen recording is not fully supported on mobile devices. Please use a desktop browser for this feature.");else try{var e;if(null===(e=navigator.mediaDevices)||void 0===e||!e.getDisplayMedia)return void c.oR.error("Screen recording is not supported in your browser.");const o=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),t=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaStream;o.getVideoTracks().forEach((e=>{r.addTrack(e)})),o.getAudioTracks().forEach((e=>{r.addTrack(e)})),t.getAudioTracks().forEach((e=>{r.addTrack(e)}));const n=new MediaRecorder(r,{mimeType:"video/webm"});n.ondataavailable=e=>{e.data.size>0&&_t.current.push(e.data)},n.onstop=()=>{const e=new Blob(_t.current,{type:"video/webm"}),o=URL.createObjectURL(e),t=document.createElement("a");t.style.display="none",t.href=o,t.download="sideeye-room-recording-".concat((new Date).toISOString(),".webm"),document.body.appendChild(t),t.click(),setTimeout((()=>{document.body.removeChild(t),window.URL.revokeObjectURL(o),_t.current=[]}),100),r.getTracks().forEach((e=>e.stop())),Bt(null),Vt(null),Nt(!1),c.oR.success("Recording saved to your device")},n.start(),Bt(r),Vt(n),Nt(!0),c.oR.success("Screen recording started with audio"),o.getVideoTracks()[0].onended=()=>{"inactive"!==n.state&&n.stop()}}catch(ze){console.error("Error starting screen recording:",ze),c.oR.error("Could not start screen recording. Please make sure you've granted the necessary permissions.")}},_r=()=>{Xt&&"inactive"!==Xt.state&&Xt.stop(),Lt&&Lt.getTracks().forEach((e=>e.stop()))},Jr=()=>{$t(!1)},Yr=()=>{sr(!0)};return(0,Pe.jsxs)(Pe.Fragment,{children:[tr.map((e=>(0,Pe.jsx)(ko,{icon:(0,Pe.jsx)(_.A,{}),color:we.palette.error.main},"heart-".concat(e)))),nr.map((e=>(0,Pe.jsx)(ko,{icon:(0,Pe.jsx)(Y.A,{}),color:we.palette.error.main},"heartbreak-".concat(e)))),Se&&(0,Pe.jsx)(Io,{handleHeartRoom:async()=>{if(!Ce||!Ce.uid||!J||!Se)return;rr((e=>[...e,Date.now()])),At(!0);const e=(0,d.H9)(a.db,"sideRooms",J,"heartedBy",Ce.uid),o=(0,d.H9)(a.db,"sideRooms",J,"heartbrokenBy",Ce.uid),t=(0,d.H9)(a.db,"sideRooms",J);try{await(0,d.c4)(a.db,(async r=>{var n;const i=await r.get(e),l=await r.get(o);if(!(await r.get(t)).exists())throw"Room does not exist!";const s=await(0,d.x7)((0,d.H9)(a.db,"users",Ce.uid)),c=s.exists()?(null===(n=s.data())||void 0===n?void 0:n.username)||Ce.displayName:"Someone";l.exists()&&(r.delete(o),r.update(t,{heartbreakCount:(0,d.GV)(-1)}),Mo(!1)),i.exists()?(r.delete(e),r.update(t,{heartCount:(0,d.GV)(-1)})):(r.set(e,{userId:Ce.uid,username:c,timestamp:(0,d.O5)()}),r.update(t,{heartCount:(0,d.GV)(1)}))}))}catch(ze){console.error("Error hearting room:",ze),c.oR.error("Failed to update heart status.")}finally{At(!1)}},handleHeartbreakRoom:async()=>{if(!Ce||!Ce.uid||!J||!Se)return;ir((e=>[...e,Date.now()])),Ho(!0);const e=(0,d.H9)(a.db,"sideRooms",J,"heartbrokenBy",Ce.uid),o=(0,d.H9)(a.db,"sideRooms",J,"heartedBy",Ce.uid),t=(0,d.H9)(a.db,"sideRooms",J);try{await(0,d.c4)(a.db,(async r=>{var n;const i=await r.get(e),l=await r.get(o);if(!(await r.get(t)).exists())throw"Room does not exist!";const s=await(0,d.x7)((0,d.H9)(a.db,"users",Ce.uid)),c=s.exists()?(null===(n=s.data())||void 0===n?void 0:n.username)||Ce.displayName:"Someone";l.exists()&&(r.delete(o),r.update(t,{heartCount:(0,d.GV)(-1)}),Fo(!1)),i.exists()?(r.delete(e),r.update(t,{heartbreakCount:(0,d.GV)(-1)})):(r.set(e,{userId:Ce.uid,username:c,timestamp:(0,d.O5)()}),r.update(t,{heartbreakCount:(0,d.GV)(1)}))}))}catch(ze){console.error("Error heartbreaking room:",ze),c.oR.error("Failed to update heartbreak status.")}finally{Ho(!1)}},currentUserHearted:Ro,currentUserHeartbroken:Oo,roomHeartCount:Ao,roomHeartbreakCount:To,isHearting:yt,isHeartbreaking:Go,accentColor:null===Se||void 0===Se||null===(e=Se.style)||void 0===e?void 0:e.accentColor,textColor:null===Se||void 0===Se||null===(o=Se.style)||void 0===o?void 0:o.textColor}),(0,Pe.jsxs)(Me.mg,{children:[(0,Pe.jsx)("title",{children:Gr}),(0,Pe.jsx)("meta",{name:"description",content:Hr}),(0,Pe.jsx)("meta",{property:"og:type",content:"website"}),(0,Pe.jsx)("meta",{property:"og:url",content:Lr}),(0,Pe.jsx)("meta",{property:"og:title",content:Gr}),(0,Pe.jsx)("meta",{property:"og:description",content:Hr}),(0,Pe.jsx)("meta",{property:"og:image",content:Nr}),(0,Pe.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,Pe.jsx)("meta",{property:"og:image:height",content:"630"}),(0,Pe.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,Pe.jsx)("meta",{name:"twitter:url",content:Lr}),(0,Pe.jsx)("meta",{name:"twitter:title",content:Gr}),(0,Pe.jsx)("meta",{name:"twitter:description",content:Hr}),(0,Pe.jsx)("meta",{name:"twitter:image",content:Nr})]}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===Se||void 0===Se||null===(t=Se.style)||void 0===t?void 0:t.font)||wo[0],backgroundColor:null!==Se&&void 0!==Se&&null!==(l=Se.style)&&void 0!==l&&l.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Se||void 0===Se||null===(L=Se.style)||void 0===L?void 0:L.backgroundColor)||we.palette.background.default,", ").concat((null===Se||void 0===Se||null===(B=Se.style)||void 0===B?void 0:B.accentColor)||we.palette.secondary.main,")"):(null===Se||void 0===Se||null===(X=Se.style)||void 0===X?void 0:X.backgroundColor)||we.palette.background.default,color:(null===Se||void 0===Se||null===(V=Se.style)||void 0===V?void 0:V.textColor)||we.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[Se&&(()=>{var e,o,t,r,n,i,l,s,m,C,j,w,S,k,I,R,E,F,P,D,U,T,z;return(0,Pe.jsxs)(u.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==Se&&void 0!==Se&&null!==(e=Se.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Se||void 0===Se||null===(o=Se.style)||void 0===o?void 0:o.headerColor)||we.palette.primary.main,", ").concat((null===Se||void 0===Se||null===(t=Se.style)||void 0===t?void 0:t.accentColor)||we.palette.secondary.light,")"):(null===Se||void 0===Se||null===(r=Se.style)||void 0===r?void 0:r.headerColor)||we.palette.background.paper,color:(null===Se||void 0===Se||null===(n=Se.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,Pe.jsx)(p.A,{variant:"h6",sx:{fontFamily:(null===Se||void 0===Se||null===(i=Se.style)||void 0===i?void 0:i.font)||wo[0],fontSize:null!==Se&&void 0!==Se&&null!==(l=Se.style)&&void 0!==l&&l.headerFontSize?"".concat(Se.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===Se||void 0===Se?void 0:Se.name}),vr&&(0,Pe.jsxs)(p.A,{variant:"caption",sx:{opacity:null!==Se&&void 0!==Se&&null!==(s=Se.style)&&void 0!==s&&s.textColor?.85:1,fontFamily:(null===Se||void 0===Se||null===(m=Se.style)||void 0===m?void 0:m.font)||wo[0]},children:["Host: ",vr.username]})]}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===Ce||void 0===Ce?void 0:Ce.uid)&&(null===Se||void 0===Se?void 0:Se.ownerId)&&Ce.uid!==Se.ownerId&&vr&&(0,Pe.jsx)(h.A,{title:"Follow ".concat(vr.username),children:(0,Pe.jsx)(x.A,{onClick:async()=>{if(null!==Ce&&void 0!==Ce&&Ce.uid&&null!==Se&&void 0!==Se&&Se.ownerId&&a.db)try{const e=(0,d.H9)(a.db,"users",Ce.uid,"following",Se.ownerId),o=await(0,d.x7)(e),t=(0,d.H9)(a.db,"users",Se.ownerId,"followRequests",Ce.uid),r=await(0,d.x7)(t),n=(0,d.H9)(a.db,"users",Se.ownerId),i=await(0,d.x7)(n),l=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(a.db,"users",Se.ownerId,"followers",Ce.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(vr.username))}else if(r.exists())await(0,d.kd)(t),c.oR.success("Canceled follow request to ".concat(vr.username));else if(l)await(0,d.BN)(t,{userId:Ce.uid,username:Ce.displayName||Ce.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(vr.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(a.db,"users",Se.ownerId,"followers",Ce.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(vr.username));const t=await Ar(Se.ownerId);t&&(or(t),$t(!0))}}catch(ze){console.error("Error toggling follow:",ze),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===Se||void 0===Se||null===(C=Se.style)||void 0===C?void 0:C.accentColor)||"inherit"},children:(0,Pe.jsx)(q.A,{})})}),(0,Pe.jsx)(h.A,{title:"Share",children:(0,Pe.jsx)(x.A,{onClick:jr,sx:{color:(null===Se||void 0===Se||null===(j=Se.style)||void 0===j?void 0:j.accentColor)||"inherit"},children:(0,Pe.jsx)(K.A,{})})}),(null===Ce||void 0===Ce?void 0:Ce.uid)&&(null===Se||void 0===Se?void 0:Se.ownerId)&&Ce.uid!==Se.ownerId&&(0,Pe.jsx)(h.A,{title:"Report Room",children:(0,Pe.jsx)(x.A,{onClick:Yr,sx:{color:(null===Se||void 0===Se||null===(w=Se.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,Pe.jsx)(Q.A,{})})}),mr&&(0,Pe.jsx)(h.A,{title:"Share Video Link",children:(0,Pe.jsx)(x.A,{onClick:fr,size:"small",color:"secondary",children:(0,Pe.jsx)($.A,{})})}),(0,Pe.jsx)(h.A,{title:"Chat with Sade AI",children:(0,Pe.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>lt(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===Se||void 0===Se||null===(S=Se.style)||void 0===S?void 0:S.accentColor)||we.palette.primary.light)}})}),Ot&&(0,Pe.jsx)(h.A,{title:Wt?"Stop Recording":"Record Room (Desktop Only)",children:(0,Pe.jsx)(x.A,{onClick:Wt?_r:Vr,color:Wt?"error":"inherit",sx:{color:Wt?we.palette.error.main:(null===Se||void 0===Se||null===(k=Se.style)||void 0===k?void 0:k.accentColor)||"inherit"},children:Wt?(0,Pe.jsx)(ee.A,{}):(0,Pe.jsx)(oe.A,{})})}),po&&(0,Pe.jsx)(h.A,{title:Jt?"Turn Camera Off":"Turn Camera On",children:(0,Pe.jsx)(x.A,{onClick:ar,sx:{color:Jt?(null===Se||void 0===Se||null===(I=Se.style)||void 0===I?void 0:I.accentColor)||we.palette.primary.main:"inherit"},children:Jt?(0,Pe.jsx)(oe.A,{}):(0,Pe.jsx)(te.A,{})})}),mr&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(h.A,{title:"Room Settings",children:(0,Pe.jsx)(x.A,{onClick:wr,sx:{color:(null===Se||void 0===Se||null===(R=Se.style)||void 0===R?void 0:R.accentColor)||"inherit"},children:(0,Pe.jsx)(re.A,{})})}),(0,Pe.jsxs)(g.A,{anchorEl:no,open:Boolean(no),onClose:Sr,children:[(0,Pe.jsxs)(f.A,{onClick:kr,children:[" ",(0,Pe.jsx)(b.A,{children:(0,Pe.jsx)(ne.A,{fontSize:"small"})}),"Edit Room"]}),(0,Pe.jsxs)(f.A,{onClick:Ir,children:[" ",(0,Pe.jsx)(b.A,{children:(0,Pe.jsx)(ie.A,{fontSize:"small"})}),"Customize"]}),(0,Pe.jsxs)(f.A,{onClick:Rr,children:[" ",(0,Pe.jsx)(b.A,{children:(0,Pe.jsx)(q.A,{fontSize:"small"})}),"Invite"]}),(0,Pe.jsxs)(f.A,{onClick:Fr,sx:{color:"error.main"},children:[(0,Pe.jsx)(b.A,{children:(0,Pe.jsx)(le.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,Pe.jsx)(h.A,{title:"Leave Room",children:(0,Pe.jsx)(x.A,{onClick:()=>{mr?Ut(!0):Z("/side-rooms")},disabled:Le,sx:{color:(null===Se||void 0===Se||null===(E=Se.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:(0,Pe.jsx)(se.A,{})})}),mr&&Ot&&po&&(0,Pe.jsx)(h.A,{title:Tt?"Stop Sharing Screen":"Share Screen (Desktop Only)",children:(0,Pe.jsx)(x.A,{onClick:Br,sx:{color:(null===Se||void 0===Se||null===(F=Se.style)||void 0===F?void 0:F.accentColor)||"inherit"},children:Tt?(0,Pe.jsx)(ae.A,{}):(0,Pe.jsx)(de.A,{})})})]})]}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Pe.jsxs)(p.A,{variant:"caption",sx:{fontFamily:(null===Se||void 0===Se||null===(P=Se.style)||void 0===P?void 0:P.font)||wo[0]},children:[pr.length," Online"]}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!po&&ho&&xr&&(0,Pe.jsx)(y.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),po?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):yo(!0)},startIcon:go?(0,Pe.jsx)(A.A,{size:20,color:"inherit"}):(0,Pe.jsx)(ce.A,{}),disabled:go||!ho,sx:{backgroundColor:null===Se||void 0===Se||null===(D=Se.style)||void 0===D?void 0:D.accentColor,fontFamily:(null===Se||void 0===Se||null===(U=Se.style)||void 0===U?void 0:U.font)||wo[0],color:null!==Se&&void 0!==Se&&null!==(T=Se.style)&&void 0!==T&&T.accentColor?we.palette.getContrastText(Se.style.accentColor):void 0},children:go?"Connecting...":"Connect Audio (Stream)"}),po&&(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(h.A,{title:"Toggle Microphone",children:(0,Pe.jsxs)(x.A,{onClick:async()=>{var e;if(null===po||void 0===po||!po.microphone||null===Ce||void 0===Ce||!Ce.uid||!J)return;const o=lo.find((e=>e.userId===Ce.uid)),t=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await po.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(t));const e=(0,d.H9)(a.db,"sideRooms",J,"presence",Ce.uid);await(0,d.mZ)(e,{isMuted:t}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(Ce.uid," to ").concat(t))}catch(ze){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",ze),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==po&&void 0!==po&&po.microphone)||!(null!==Ce&&void 0!==Ce&&Ce.uid)||!J,children:[(0,Pe.jsx)(ue.A,{})," "]})}),(0,Pe.jsx)(p.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,Pe.jsx)(y.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===po||void 0===po||po.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),Z("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:go,sx:{fontFamily:(null===Se||void 0===Se||null===(z=Se.style)||void 0===z?void 0:z.font)||wo[0]},children:"Leave Audio"})]}),!ho&&Ee&&(0,Pe.jsx)(A.A,{size:24})]})]})]})})(),(0,Pe.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto"},children:Se?ho?po?(0,Pe.jsx)(Te.Mf9,{client:ho,children:(0,Pe.jsx)(Te.xwR,{call:po,children:(0,Pe.jsx)(Eo,{room:Se,isRoomOwner:mr,isGuest:hr,handleOpenShareVideoDialog:fr,handleClearSharedVideo:yr,currentVideoUrl:Xo,renderVideoPlayer:Mr,onForceMuteToggle:Pr,onForceRemove:Dr,onForceBan:Ur,theme:we,navigate:Z})})}):(0,Pe.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[Xo&&(0,Pe.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Pe.jsx)(p.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),mr&&(0,Pe.jsx)(h.A,{title:"Clear Shared Video",children:(0,Pe.jsx)(x.A,{onClick:yr,size:"small",children:(0,Pe.jsx)(me.A,{})})})]}),(0,Pe.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Mr()})]}),(0,Pe.jsxs)(p.A,{variant:"h6",gutterBottom:!0,children:["Participants (",pr.length,")"]}),(0,Pe.jsx)(j.Ay,{container:!0,spacing:2,children:pr.map((e=>(0,Pe.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,Pe.jsxs)(w.A,{sx:{p:1,textAlign:"center"},children:[(0,Pe.jsx)(v.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,Pe.jsx)(p.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,Pe.jsx)(he.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!po&&!go&&xr&&(0,Pe.jsx)(C.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),go&&(0,Pe.jsx)(C.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===uo&&xr&&null!==Ce&&void 0!==Ce&&Ce.uid&&J||null!==uo&&!ho?(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)(A.A,{sx:{mb:2}}),(0,Pe.jsx)(p.A,{children:"Initializing audio components..."}),(0,Pe.jsx)(p.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!xr&&null!==Ce&&void 0!==Ce&&Ce.uid?(0,Pe.jsx)(C.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,Pe.jsx)(C.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,Pe.jsx)(y.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[Ee&&(0,Pe.jsx)(A.A,{}),!Ee&&(0,Pe.jsxs)(C.A,{severity:"error",children:["Room not found. ",(0,Pe.jsx)(y.A,{onClick:()=>Z("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,Pe.jsxs)(S.A,{open:Wo,onClose:br,fullWidth:!0,maxWidth:"sm",children:[(0,Pe.jsx)(k.A,{children:"Share a Video"}),(0,Pe.jsx)(I.A,{children:(0,Pe.jsx)(R.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:Lo,onChange:e=>Bo(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:br,children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:()=>{if(!J)return void c.oR.error("Cannot share video: Room ID is missing.");if(!Lo.trim())return void c.oR.error("Please enter a video URL.");if(!Lo.startsWith("http://")&&!Lo.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(a.db,"sideRooms",J);(0,d.mZ)(e,{currentSharedVideoUrl:Lo,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),Vo(Lo),c.oR.success("Video shared!"),br()},variant:"contained",children:"Share Video"})]})]}),(0,Pe.jsxs)(S.A,{open:to,onClose:()=>ro(!1),fullWidth:!0,maxWidth:"xs",children:[(0,Pe.jsx)(k.A,{children:"Share this Room"}),(0,Pe.jsxs)(I.A,{sx:{textAlign:"center"},children:[(0,Pe.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,Pe.jsx)(R.A,{fullWidth:!0,variant:"outlined",value:"".concat(window.location.origin,"/side-room/").concat(J),InputProps:{readOnly:!0},sx:{mb:2}}),(0,Pe.jsx)(y.A,{variant:"contained",startIcon:(0,Pe.jsx)(xe.A,{}),onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(J)),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,Pe.jsx)(F.A,{sx:{my:2},children:(0,Pe.jsx)(P.A,{label:"OR"})}),(0,Pe.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share via Direct Message:"}),(0,Pe.jsx)(y.A,{variant:"outlined",startIcon:(0,Pe.jsx)(pe.A,{}),onClick:()=>{ro(!1),Re(!0)},sx:{mb:2,width:"100%"},children:"Send to a Friend"}),(0,Pe.jsx)(F.A,{sx:{my:2},children:(0,Pe.jsx)(P.A,{label:"OR"})}),(0,Pe.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share on social media:"}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,Pe.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(J)),"&text=").concat(encodeURIComponent((null===Se||void 0===Se?void 0:Se.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,Pe.jsx)(ve.A,{})}),(0,Pe.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(J))),"_blank"),title:"Share on Facebook",children:(0,Pe.jsx)(ge.A,{})}),(0,Pe.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===Se||void 0===Se?void 0:Se.name)||"Join my SideEye Room!")+" "+"".concat(window.location.origin,"/side-room/").concat(J))),"_blank"),title:"Share on WhatsApp",children:(0,Pe.jsx)(fe.A,{})}),(0,Pe.jsx)(x.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(J)),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,Pe.jsx)(be.A,{})})]})]}),(0,Pe.jsx)(E.A,{children:(0,Pe.jsx)(y.A,{onClick:()=>ro(!1),children:"Close"})})]}),(0,Pe.jsxs)(S.A,{open:it,onClose:()=>lt(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,Pe.jsxs)(k.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,Pe.jsx)(h.A,{title:"Clear Chat History",children:(0,Pe.jsx)(x.A,{onClick:()=>{at([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,Pe.jsx)(le.A,{})})})]}),(0,Pe.jsx)(I.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:we.palette.background.default},children:(0,Pe.jsxs)(D.A,{sx:{p:0},children:[st.map(((e,o)=>(0,Pe.jsxs)(U.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,Pe.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,Pe.jsx)(w.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,Pe.jsx)(We.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),ut&&(0,Pe.jsxs)(U.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,Pe.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Pe.jsx)(w.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,Pe.jsx)("div",{ref:ht})]})}),(0,Pe.jsxs)(E.A,{sx:{p:1,borderTop:"1px solid ".concat(we.palette.divider),flexDirection:"column"},children:[st.length<=1&&!ut&&(0,Pe.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,Pe.jsx)(P.A,{label:e,onClick:()=>Or(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,Pe.jsxs)(u.A,{sx:{display:"flex",width:"100%"},children:[(0,Pe.jsx)(R.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:dt,onChange:e=>ct(e.target.value),onKeyPress:e=>"Enter"===e.key&&!ut&&Or(),sx:{mr:1},disabled:ut}),(0,Pe.jsxs)(x.A,{onClick:()=>!ut&&Or(dt,!1),disabled:ut||!dt.trim(),color:"primary",children:[(0,Pe.jsx)(K.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,Pe.jsxs)(x.A,{onClick:()=>!ut&&Or(dt,!0),disabled:ut||!dt.trim(),color:"secondary",title:"Search the web",children:[(0,Pe.jsx)(ye.A,{})," "]})]})]})]}),qe&&Se&&(0,Pe.jsx)(De,{open:qe,onClose:()=>Ke(!1),onSubmit:async(e,o)=>{if(J&&Ce){Ve(!0);try{let t=Se.thumbnailUrl||"";if(o){const e=(0,Oe.KR)(a.IG,"room-thumbnails/".concat(J,"_").concat(Date.now(),"_").concat(o.name));await(0,Oe.D)(e,o),t=await(0,Oe.qk)(e)}const r=(0,d.H9)(a.db,"sideRooms",J),n={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:t,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?n.password=e.password:e.isPrivate||(n.password=(0,d.CL)()),await(0,d.mZ)(r,n),c.oR.success("Room details updated successfully!"),Ke(!1)}catch(t){console.error("Error updating room:",t),c.oR.error("Failed to update room details.")}finally{Ve(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:Se,title:"Edit Room",submitButtonText:"Save Changes"}),(0,Pe.jsxs)(S.A,{open:eo,onClose:()=>oo(!1),fullWidth:!0,maxWidth:"sm",children:[(0,Pe.jsx)(k.A,{children:"Customize Room Appearance"}),(0,Pe.jsx)(I.A,{children:(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Pe.jsxs)(T.A,{fullWidth:!0,children:[(0,Pe.jsx)(z.A,{id:"theme-select-label",children:"Theme"}),(0,Pe.jsx)(O.A,{labelId:"theme-select-label",value:Ct,label:"Theme",onChange:e=>jt(e.target.value),children:jo.map((e=>(0,Pe.jsx)(f.A,{value:e.name,children:e.name},e.name)))})]}),(0,Pe.jsxs)(T.A,{fullWidth:!0,children:[(0,Pe.jsx)(z.A,{id:"font-select-label",children:"Font"}),(0,Pe.jsx)(O.A,{labelId:"font-select-label",value:Rt,label:"Font",onChange:e=>Et(e.target.value),children:wo.map((e=>(0,Pe.jsx)(f.A,{value:e,children:e},e)))})]}),(0,Pe.jsxs)(T.A,{fullWidth:!0,children:[(0,Pe.jsx)(z.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,Pe.jsx)(O.A,{labelId:"text-size-select-label",value:Ft.toString(),label:"Header Text Size (px)",onChange:e=>Pt(Number(e.target.value)),children:So.map((e=>(0,Pe.jsx)(f.A,{value:e.toString(),children:e},e)))})]}),(0,Pe.jsx)(M.A,{control:(0,Pe.jsx)(G.A,{checked:wt,onChange:e=>St(e.target.checked)}),label:"Use Header Gradient"}),(0,Pe.jsx)(M.A,{control:(0,Pe.jsx)(G.A,{checked:kt,onChange:e=>It(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:()=>oo(!1),children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:async()=>{var e,o,t,r,n;if(!J||!Se)return void c.oR.error("Cannot save style: Room data is missing.");if(!Ce)return void c.oR.error("You must be logged in to change the style.");if(!mr)return void c.oR.error("Only the room owner can change the style.");const i=jo.find((e=>e.name===Ct));if(!i){var l,s,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=jo[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:Rt,headerFontSize:Ft,headerGradient:wt,backgroundGradient:kt,customCss:(null===(l=Se.style)||void 0===l?void 0:l.customCss)||"",bannerUrl:(null===(s=Se.style)||void 0===s?void 0:s.bannerUrl)||"",stickers:(null===(u=Se.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=Se.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=Se.style)||void 0===h?void 0:h.thumbnailUrl)||Se.thumbnailUrl||""};try{const e=(0,d.H9)(a.db,"sideRooms",J);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),oo(!1)}catch(ze){console.error("Error updating room style with default theme:",ze),c.oR.error("Failed to update room style.")}finally{Ve(!1)}return}const x={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:Rt,headerFontSize:Ft,headerGradient:wt,backgroundGradient:kt,customCss:(null===(e=Se.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=Se.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(t=Se.style)||void 0===t?void 0:t.stickers)||[],glitterEffect:(null===(r=Se.style)||void 0===r?void 0:r.glitterEffect)||!1,thumbnailUrl:(null===(n=Se.style)||void 0===n?void 0:n.thumbnailUrl)||Se.thumbnailUrl||""};Ve(!0);try{const e=(0,d.H9)(a.db,"sideRooms",J);await(0,d.mZ)(e,{style:x,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),oo(!1)}catch(ze){console.error("Error updating room style:",ze),c.oR.error("Failed to update room style.")}finally{Ve(!1)}},variant:"contained",disabled:Le,children:Le?(0,Pe.jsx)(A.A,{size:24}):"Save Style"})]})]}),(0,Pe.jsxs)(S.A,{open:Qe,onClose:()=>{$e(!1),Jo(""),$o(null),Zo([]),Ko(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,Pe.jsx)(k.A,{children:"Invite User to Room"}),(0,Pe.jsxs)(I.A,{children:[(0,Pe.jsx)(p.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,Pe.jsxs)(u.A,{ref:tt,sx:{position:"relative"},children:[(0,Pe.jsx)(R.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:_o,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Jo(o),$o(null),o.trim().length>=2?(Ko(!0),Cr(o)):(Ko(!1),Zo([]))},sx:{mb:1}}),qo&&Yo.length>0&&(0,Pe.jsx)(w.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:we.zIndex.modal+1,mt:.5},children:(0,Pe.jsx)(H.x,{onClickAway:()=>{Ko(!1)},children:(0,Pe.jsx)(D.A,{dense:!0,children:Yo.map((e=>(0,Pe.jsxs)(U.Ay,{button:!0,onClick:()=>{return $o(o=e),Jo(o.username),Ko(!1),void Zo([]);var o},children:[(0,Pe.jsx)(W.A,{children:(0,Pe.jsx)(v.A,{src:e.profilePic,alt:e.username})}),(0,Pe.jsx)(N.A,{primary:(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,Pe.jsx)(Ae.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),qo&&0===Yo.length&&_o.length>=2&&(0,Pe.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',_o,'".']})]}),Qo&&(0,Pe.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",Qo.username,(0,Pe.jsx)(Ae.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:()=>{$e(!1),Jo(""),$o(null),Zo([]),Ko(!1)},children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:Er,variant:"contained",disabled:et||!Qo||!rt,children:et?(0,Pe.jsx)(A.A,{size:24}):"Send Invite"})]})]}),(0,Pe.jsxs)(S.A,{open:Dt,onClose:()=>Ut(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,Pe.jsx)(k.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,Pe.jsxs)(I.A,{children:[(0,Pe.jsx)(p.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,Pe.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:()=>Ut(!1),disabled:Le,children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:()=>{Ut(!1),Fr()},color:"error",variant:"contained",disabled:Le,autoFocus:!0,children:Le?(0,Pe.jsx)(A.A,{size:24}):"End and Delete"})]})]}),(0,Pe.jsxs)(S.A,{open:_e,onClose:()=>{mr||xr||Z("/side-rooms")},children:[(0,Pe.jsx)(k.A,{children:"Password Required"}),(0,Pe.jsxs)(I.A,{children:[(0,Pe.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,Pe.jsx)(R.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Ye,onChange:e=>Ze(e.target.value),onKeyPress:e=>"Enter"===e.key&&Xr()})]}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:()=>Z("/side-rooms"),disabled:Le,children:"Cancel"}),(0,Pe.jsx)(y.A,{onClick:Xr,disabled:Le||!Ye,variant:"contained",children:Le?(0,Pe.jsx)(A.A,{size:24}):"Submit"})]})]}),(0,Pe.jsxs)(S.A,{open:Qt,onClose:Jr,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,Pe.jsx)(k.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,Pe.jsx)(I.A,{children:(0,Pe.jsxs)(p.A,{variant:"body1",children:[(null===vr||void 0===vr?void 0:vr.username)||"This creator",' has a server chat room: "',null===er||void 0===er?void 0:er.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,Pe.jsxs)(E.A,{children:[(0,Pe.jsx)(y.A,{onClick:Jr,children:"Not Now"}),(0,Pe.jsx)(y.A,{onClick:()=>{er&&Z("/chat/room/".concat(er.id)),$t(!1)},variant:"contained",color:"primary",children:"Join Chat Room"})]})]}),Se&&(0,Pe.jsx)(Be,{contentId:Se.id,contentType:"sideRoom",onClose:()=>{sr(!1)},open:lr,ownerUsername:null===vr||void 0===vr?void 0:vr.username}),(0,Pe.jsx)(Xe,{open:Ie,onClose:()=>{Re(!1)},roomName:null===Se||void 0===Se?void 0:Se.name,roomLink:Lr,onSend:async(e,o)=>{if(null!==Ce&&void 0!==Ce&&Ce.uid&&a.db)try{const r=(0,d.H9)(a.db,"rooms",e);if((await(0,d.x7)(r)).exists()){const t=(0,d.rJ)(a.db,"rooms",e,"messages");return void await(0,d.gS)(t,{text:o,sender:Ce.uid,senderName:Ce.displayName||"Unknown User",senderPhoto:Ce.photoURL,timestamp:(0,d.O5)(),type:"chat"})}const n=(0,d.rJ)(a.db,"conversations"),i=(0,d.P)(n,(0,d._M)("participants","array-contains",Ce.uid)),l=await(0,d.GG)(i);let s=null;if(l.docs.forEach((o=>{o.data().participants.includes(e)&&(s=o.id)})),!s){var t;const o=(0,d.H9)(a.db,"users",e),r=await(0,d.x7)(o);if(!r.exists())throw new Error("Recipient user not found");const n=(null===(t=r.data().following)||void 0===t?void 0:t.includes(Ce.uid))||!1,i=(0,d.H9)((0,d.rJ)(a.db,"conversations"));await(0,d.BN)(i,{participants:[Ce.uid,e],createdAt:(0,d.O5)(),lastUpdated:(0,d.O5)(),unreadCount:{[Ce.uid]:0,[e]:1},status:n?"accepted":"pending"}),s=i.id}const c=(0,d.rJ)(a.db,"conversations",s,"messages");await(0,d.gS)(c,{text:o,sender:Ce.uid,timestamp:(0,d.O5)(),read:!1,reactions:[]});const u=(0,d.H9)(a.db,"conversations",s);await(0,d.mZ)(u,{lastMessage:{text:o,sender:Ce.uid,timestamp:(0,d.O5)()},lastUpdated:(0,d.O5)(),["unreadCount.".concat(e)]:(0,d.GV)(1)})}catch(ze){throw console.error("Error sending message:",ze),ze}else c.oR.error("Cannot send message: User not authenticated.")},currentUserId:null===Ce||void 0===Ce?void 0:Ce.uid})]})]})},Eo=e=>{var o,t,i,l,m,g,f,b,C,S,k,I,E,F,D,U,T,z,O,M,G,H,W,N,_,J,Y,Z,q,K,Q,ee,re,ne,ie,le,de,ce,xe,pe,ve,ge,fe,be,ye,Ae,Re,Ee,Fe,De,Ue,Oe,Me;let{room:Ge,isRoomOwner:He,isGuest:We,handleOpenShareVideoDialog:Ne,handleClearSharedVideo:Le,currentVideoUrl:Be,renderVideoPlayer:Xe,onForceMuteToggle:Ve,onForceRemove:_e,onForceBan:Je,theme:Ye,navigate:Ze}=e;(0,n.useRef)(null);const qe=(0,ze.Gc)(),{useParticipants:Ke,useCallState:Qe,useMicrophoneState:$e,useCameraState:eo}=(0,ze.R3)(),oo=Ke(),{localParticipant:to}=Qe(),{isMute:ro}=$e(),{isEnabled:no,isTogglePending:io}=eo(),[lo,so]=(0,n.useState)(0);(0,n.useEffect)((()=>{qe&&qe.camera.disable().catch((e=>{console.error("Error disabling camera:",e)}))}),[qe]);const{currentUser:ao}=(0,s.As)(),[co,uo]=(0,n.useState)(window.innerWidth>1024),[mo,ho]=(0,n.useState)(!0),[po,vo]=(0,n.useState)(!1),[go,fo]=(0,n.useState)([]),[bo,yo]=(0,n.useState)([]),[Ao,jo]=(0,n.useState)("participants"),[wo,So]=(0,n.useState)([]),[ko,Io]=(0,n.useState)(""),Ro=(0,n.useRef)(null),Eo=oo.find((e=>e.screenShareStream)),Po=(null===Eo||void 0===Eo?void 0:Eo.userId)===Ge.ownerId;(0,n.useEffect)((()=>{Eo&&(console.log("Screen sharing detected from participant ".concat(Eo.name||Eo.userId)),Po&&console.log("Room owner is sharing their screen - should be visible to ALL participants"))}),[Eo,Po]);(0,n.useEffect)((()=>{Po&&Eo&&console.log("Room owner is sharing screen - should be visible to all participants")}),[Po,Eo]),(0,n.useEffect)((()=>{Eo&&(console.log("Screen sharing available from participant: ".concat(Eo.name||Eo.userId)),so((e=>e+1)))}),[Eo,oo.length]);const[Do,Uo]=(0,n.useState)({}),To=(0,n.useCallback)((async e=>{if(Do[e])return Do[e];try{const o=(0,d.H9)(a.db,"users",e),t=await(0,d.x7)(o);if(t.exists()){const o=t.data(),n={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return Uo((o=>(0,r.A)((0,r.A)({},o),{},{[e]:n}))),n}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return Uo((t=>(0,r.A)((0,r.A)({},t),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[Do,a.db]),zo=(0,n.useCallback)((async()=>{if(!ko.trim()||null===ao||void 0===ao||!ao.uid||null===Ge||void 0===Ge||!Ge.id||!a.db)return;const e=await To(ao.uid),o={id:"".concat(Date.now(),"-").concat(ao.uid),userId:ao.uid,userName:e.username,message:ko.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(a.db,"sideRooms",Ge.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(t){console.error("[Chat] Error sending message to Firestore:",t),So((e=>[...e,o]))}Io("")}),[ko,null===ao||void 0===ao?void 0:ao.uid,null===Ge||void 0===Ge?void 0:Ge.id,a.db,To]);(0,n.useEffect)((()=>{if(null===Ge||void 0===Ge||!Ge.id||!a.db)return;console.log("[Chat] Setting up chat listener for room ".concat(Ge.id));const e=(0,d.P)((0,d.rJ)(a.db,"sideRooms",Ge.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const t=e.data();o.push({id:e.id,userId:t.userId,userName:t.userName,message:t.message,timestamp:t.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),So(o),Ro.current&&Ro.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===Ge||void 0===Ge?void 0:Ge.id,a.db]);const Oo=(0,n.useCallback)((async()=>{if(qe)if(co)try{await qe.screenShare.toggle(),qe.screenShare.enabled?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(n){var e,o,t,r;console.error("Error toggling screen share:",n),"NotAllowedError"===n.name||null!==(e=n.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=n.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(t=n.message)&&void 0!==t&&t.includes("getDisplayMedia is not supported")||null!==(r=n.message)&&void 0!==r&&r.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(n.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[qe,co]);(0,n.useEffect)((()=>{const e=()=>{uo(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const Mo=e=>{yo((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))},Go=()=>{qe&&("enabled"!==qe.camera.state.status?navigator.mediaDevices.getUserMedia({video:!0}).then((e=>(e.getTracks().forEach((e=>e.stop())),qe.camera.enable()))).then((()=>{ho(!0)})).catch((e=>{console.error("Error enabling camera:",e),c.oR.error("Could not enable camera. Please check permissions.")})):qe.camera.disable().catch((e=>{console.error("Error disabling camera:",e)})))};(0,n.useEffect)((()=>{var e;null===(e=Ro.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[wo]);const Ho=(0,n.useMemo)((()=>{if(!oo||null===Ge||void 0===Ge||!Ge.ownerId)return[];const e=oo.find((e=>e.userId===Ge.ownerId));return[...e?[e]:[],...oo.filter((e=>bo.includes(e.userId)&&e.userId!==Ge.ownerId)),...oo.filter((e=>e.userId!==Ge.ownerId&&!bo.includes(e.userId)))].filter(Boolean)}),[oo,null===Ge||void 0===Ge?void 0:Ge.ownerId,bo]);(0,n.useEffect)((()=>{no&&ho(!0)}),[no]);const Wo=Ho;(0,n.useEffect)((()=>{if(null===oo||void 0===oo||!oo.length)return;(async()=>{const e=oo.filter((e=>!Do[e.userId])).map((e=>To(e.userId)));await Promise.all(e)})()}),[oo,To,Do]);return(0,n.useEffect)((()=>{if(qe&&null!==ao&&void 0!==ao&&ao.uid&&null!==Ge&&void 0!==Ge&&Ge.id&&"boolean"===typeof ro&&a.db){const e=(0,d.H9)(a.db,"sideRooms",Ge.id,"presence",ao.uid),o="sideRooms/".concat(Ge.id,"/presence/").concat(ao.uid);console.log("[DEBUG Mute Sync] Attempting updateDoc to path:",o,"with data:",JSON.stringify({isMuted:ro},null,2)),(0,d.mZ)(e,{isMuted:ro}).then((()=>{console.log("[InsideStreamCallContent] Synced local mute state (".concat(ro,") to Firestore for ").concat(ao.uid))})).catch((e=>{console.error("[InsideStreamCallContent] Error syncing local mute state to Firestore for ".concat(ao.uid,":"),e)}))}}),[ro,qe,null===ao||void 0===ao?void 0:ao.uid,null===Ge||void 0===Ge?void 0:Ge.id,a.db]),(0,n.useEffect)((()=>{if(!qe)return;console.log("Call or force update changed, rechecking screen share in 2 seconds");const e=setTimeout((()=>{const e=document.getElementById("screen-share-container");if(e&&null!==Eo&&void 0!==Eo&&Eo.screenShareStream){let o=e.querySelector("video");o||(o=document.createElement("video"),o.id="screen-share-video",o.autoplay=!0,o.playsInline=!0,o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.objectFit="contain",e.appendChild(o)),o.srcObject!==Eo.screenShareStream&&(o.srcObject=Eo.screenShareStream,o.play().catch((e=>console.error("Error playing screen share:",e))),console.log("Force-updated screen share video with latest stream"))}}),2e3);return()=>{clearTimeout(e)}}),[qe,lo,Eo]),(0,n.useEffect)((()=>{if(!oo||0===oo.length)return;const e=oo.find((e=>e.screenShareStream)),o=document.getElementById("screen-share-container"),t=()=>{if(!o)return;const e=o.querySelector("video");e&&(e.srcObject=null,e.remove(),console.log("Screen share video element removed"));o.querySelectorAll(".gaming-overlay").forEach((e=>{e.remove()}))};return e?(()=>{var t,r;if(null===e||void 0===e||!e.screenShareStream||!o)return;console.log("Screen sharing detected from: ".concat(e.name||e.userId));const n=o.querySelector("video");n&&n.remove();const i=document.createElement("video");i.id="screen-share-video",i.autoplay=!0,i.playsInline=!0,i.muted=!1,i.srcObject=e.screenShareStream,o.appendChild(i);const l=document.createElement("div");l.className="gaming-overlay gamer-name",l.innerHTML="<span>".concat(e.name||"Gamer","</span>"),l.style.cssText="\n                position: absolute;\n                top: 20px;\n                left: 20px;\n                background-color: rgba(0,0,0,0.7);\n                border-radius: 8px;\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                border: 1px solid ".concat((null===Ge||void 0===Ge||null===(t=Ge.style)||void 0===t?void 0:t.accentColor)||"#ff5722",";\n                box-shadow: 0 2px 8px rgba(0,0,0,0.5);\n                z-index: 99;\n                color: white;\n                font-weight: bold;\n            "),o.appendChild(l);const s=document.createElement("div");s.className="gaming-overlay live-indicator",s.innerHTML="<span>LIVE</span>",s.style.cssText="\n                position: absolute;\n                top: 20px;\n                right: 20px;\n                background-color: #f44336;\n                border-radius: 4px;\n                padding: 4px 8px;\n                display: flex;\n                align-items: center;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                z-index: 99;\n                color: white;\n                font-weight: bold;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n                font-size: 0.8rem;\n            ",o.appendChild(s);const a=document.createElement("div");a.className="gaming-overlay viewer-count",a.innerHTML="<span>".concat((null===oo||void 0===oo?void 0:oo.length)||0," viewers</span>"),a.style.cssText="\n                position: absolute;\n                bottom: 20px;\n                left: 20px;\n                background-color: rgba(0,0,0,0.7);\n                border-radius: 8px;\n                padding: 6px 10px;\n                display: flex;\n                align-items: center;\n                z-index: 99;\n                color: white;\n                font-weight: medium;\n                font-size: 0.9rem;\n            ",o.appendChild(a);const d=document.createElement("div");d.className="gaming-overlay bottom-bar",d.innerHTML='<span style="color: '.concat((null===Ge||void 0===Ge||null===(r=Ge.style)||void 0===r?void 0:r.accentColor)||"#ff5722",'; font-weight: bold;">GAMING STREAM</span>'),d.style.cssText="\n                position: absolute;\n                bottom: 0;\n                left: 0;\n                right: 0;\n                background-color: rgba(0,0,0,0.7);\n                padding: 8px 10px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                z-index: 98;\n            ",o.appendChild(d);const c=()=>{const e=i.play();void 0!==e&&e.catch((e=>{console.error("Error playing screen share:",e),setTimeout(c,1e3)}))};c(),console.log("Screen share video element created and playing")})():t(),()=>{t()}}),[oo]),qe?(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===Ge||void 0===Ge||null===(o=Ge.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==Ge&&void 0!==Ge&&null!==(t=Ge.style)&&void 0!==t&&t.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Ge||void 0===Ge||null===(i=Ge.style)||void 0===i?void 0:i.backgroundColor)||Ye.palette.background.default,", ").concat((null===Ge||void 0===Ge||null===(l=Ge.style)||void 0===l?void 0:l.accentColor)||Ye.palette.secondary.main,")"):(null===Ge||void 0===Ge||null===(m=Ge.style)||void 0===m?void 0:m.backgroundColor)||Ye.palette.background.default,color:(null===Ge||void 0===Ge||null===(g=Ge.style)||void 0===g?void 0:g.textColor)||Ye.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[(()=>{var e,o,t,r,n,i,l,s,a;return(0,Pe.jsxs)(u.A,{sx:{p:1,borderBottom:1,borderColor:"divider",textAlign:"center",flexShrink:0,backgroundColor:null!==Ge&&void 0!==Ge&&null!==(e=Ge.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Ge||void 0===Ge||null===(o=Ge.style)||void 0===o?void 0:o.headerColor)||Ye.palette.primary.main,", ").concat((null===Ge||void 0===Ge||null===(t=Ge.style)||void 0===t?void 0:t.accentColor)||Ye.palette.secondary.light,")"):(null===Ge||void 0===Ge||null===(r=Ge.style)||void 0===r?void 0:r.headerColor)||(0,V.X4)(Ye.palette.background.paper,.95),color:(null===Ge||void 0===Ge||null===(n=Ge.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Pe.jsx)(p.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===Ge||void 0===Ge||null===(i=Ge.style)||void 0===i?void 0:i.font)||"inherit"},children:Ge.name}),(0,Pe.jsxs)(p.A,{variant:"caption",color:null!==Ge&&void 0!==Ge&&null!==(l=Ge.style)&&void 0!==l&&l.textColor?(0,V.X4)(null===Ge||void 0===Ge||null===(s=Ge.style)||void 0===s?void 0:s.textColor,.8):"text.secondary",sx:{fontFamily:(null===Ge||void 0===Ge||null===(a=Ge.style)||void 0===a?void 0:a.font)||"inherit"},children:["(Mic: ",ro?"Muted":"On",")"]})]})})(),(0,Pe.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[!Eo&&(0,Pe.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Pe.jsx)(p.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===Ge||void 0===Ge||null===(f=Ge.style)||void 0===f?void 0:f.accentColor)||Ye.palette.primary.main},children:"Live Video"}),(0,Pe.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"},mb:2},children:[no?(0,Pe.jsxs)(u.A,{sx:{border:"3px solid",borderColor:Ye.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(0,Pe.jsx)(x.A,{onClick:Go,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Pe.jsx)(Ce.A,{fontSize:"small"})}),to&&(0,Pe.jsx)(Te.fSl,{participant:to,trackType:"videoTrack"}),(0,Pe.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Pe.jsx)(v.A,{sx:{width:40,height:40,mr:1},children:(null===ao||void 0===ao||null===(b=ao.displayName)||void 0===b?void 0:b[0])||"U"}),(0,Pe.jsxs)(u.A,{children:[(0,Pe.jsx)(p.A,{variant:"subtitle2",fontWeight:"bold",children:(null===ao||void 0===ao?void 0:ao.displayName)||"You"}),(0,Pe.jsx)(p.A,{variant:"caption",children:(null===Ge||void 0===Ge?void 0:Ge.name)||"Live Room"})]})]})}),(0,Pe.jsx)(u.A,{sx:{position:"absolute",right:12,bottom:70,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:(0,Pe.jsx)(h.A,{title:ro?"Unmute":"Mute",children:(0,Pe.jsx)(x.A,{onClick:()=>null===qe||void 0===qe?void 0:qe.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:44,height:44,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:ro?(0,Pe.jsx)(he.A,{}):(0,Pe.jsx)(ue.A,{})})})})]}):(0,Pe.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Pe.jsx)(y.A,{variant:"contained",color:"primary",onClick:Go,startIcon:(0,Pe.jsx)(oe.A,{}),children:"Enable Camera"})}),oo&&oo.filter((e=>e.userId!==(null===ao||void 0===ao?void 0:ao.uid))).length>0&&(mo?(0,Pe.jsxs)(u.A,{sx:{border:"3px solid",borderColor:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(()=>{const e=oo.find((e=>e.userId===Ge.ownerId&&e.userId!==(null===ao||void 0===ao?void 0:ao.uid))),o=oo.filter((e=>e.userId!==(null===ao||void 0===ao?void 0:ao.uid)))[0],t=e||o;return t?(0,Pe.jsx)(Te.fSl,{participant:t,trackType:"videoTrack"}):null})(),(0,Pe.jsx)(x.A,{onClick:()=>{ho(!1),c.oR.success("Video view closed")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Pe.jsx)(Ce.A,{fontSize:"small"})}),(0,Pe.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(e=>{const o=oo.find((e=>e.userId===Ge.ownerId&&e.userId!==(null===ao||void 0===ao?void 0:ao.uid))),t=oo.filter((e=>e.userId!==(null===ao||void 0===ao?void 0:ao.uid)))[0],r=o||t;return r&&(0,Pe.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Pe.jsx)(v.A,{src:null===(e=Do[r.userId])||void 0===e?void 0:e.avatar,sx:{width:40,height:40,mr:1}}),(0,Pe.jsx)(u.A,{children:(0,Pe.jsxs)(p.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===r||void 0===r?void 0:r.name)||"User",r.userId===Ge.ownerId&&" (Host)"]})})]})})()})]}):(0,Pe.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Pe.jsx)(y.A,{variant:"outlined",color:"primary",onClick:()=>ho(!0),startIcon:(0,Pe.jsx)(oe.A,{}),children:"Show Partner Video"})}))]}),oo&&oo.filter((e=>e.userId!==(null===ao||void 0===ao?void 0:ao.uid))).length>1&&(0,Pe.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:1,mt:2,width:"100%",maxWidth:"600px"},children:oo.filter((e=>e.userId!==(null===ao||void 0===ao?void 0:ao.uid))).filter((e=>{const o=oo.find((e=>e.userId===Ge.ownerId&&e.userId!==(null===ao||void 0===ao?void 0:ao.uid)));return!(e.userId===Ge.ownerId&&o===oo.filter((e=>e.userId!==(null===ao||void 0===ao?void 0:ao.uid)))[0])})).filter((e=>!go.includes(e.userId))).map((e=>(0,Pe.jsxs)(u.A,{sx:{width:"100px",height:"150px",borderRadius:"10px",overflow:"hidden",position:"relative",border:"2px solid",borderColor:"divider",backgroundColor:"#000","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[(0,Pe.jsx)(Te.fSl,{participant:e,trackType:"videoTrack"}),(0,Pe.jsx)(x.A,{onClick:()=>{const o=[...go||[]];if(o.includes(e.userId)){const t=o.indexOf(e.userId);t>-1&&o.splice(t,1)}else o.push(e.userId);fo(o),c.oR.success("Video view toggled")},sx:{position:"absolute",top:2,right:2,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:20,height:20,zIndex:10,padding:"2px","& .MuiSvgIcon-root":{fontSize:"14px"},"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Pe.jsx)(Ce.A,{})}),(0,Pe.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"2px 4px",background:"rgba(0,0,0,0.7)",color:"white",fontSize:"10px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name||"User ".concat(e.userId.substring(0,5))})]},e.userId)))})]}),Eo&&(0,Pe.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Pe.jsx)(p.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:700,color:(null===Ge||void 0===Ge||null===(C=Ge.style)||void 0===C?void 0:C.accentColor)||"#ff5722",textTransform:"uppercase",letterSpacing:"1px",textShadow:"0px 1px 2px rgba(0,0,0,0.2)"},children:"\ud83c\udfae LIVE GAMING STREAM \ud83c\udfae"}),(0,Pe.jsxs)(u.A,{sx:{m:0,p:0,border:"2px solid",borderColor:(null===Ge||void 0===Ge||null===(S=Ge.style)||void 0===S?void 0:S.accentColor)||"#ff5722",borderRadius:"8px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:"auto",width:"90%",maxWidth:"1200px",margin:"0 auto",marginTop:2,marginBottom:2,overflow:"hidden",boxShadow:"0 8px 16px rgba(0,0,0,0.3)"},children:[!po&&(0,Pe.jsx)(u.A,{id:"screen-share-container",sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none",background:"#000","& video":{width:"100%",height:"100%",position:"absolute",top:0,left:0,objectFit:"contain"}}}),po&&mo&&to&&(0,Pe.jsxs)(u.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none",backgroundColor:"#000","& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[no?(0,Pe.jsx)(Te.fSl,{participant:to,trackType:"videoTrack"}):(0,Pe.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Pe.jsx)(te.A,{sx:{fontSize:"5rem"}})}),(0,Pe.jsx)(x.A,{size:"medium",onClick:Go,sx:{position:"absolute",top:16,right:80,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:no?(0,Pe.jsx)(oe.A,{}):(0,Pe.jsx)(te.A,{})}),(0,Pe.jsx)(x.A,{size:"medium",onClick:()=>vo(!1),sx:{position:"absolute",top:16,right:16,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Pe.jsx)(Ce.A,{})})]}),(0,Pe.jsx)(u.A,{sx:{position:"absolute",top:10,right:10,zIndex:10},children:He&&(0,Pe.jsx)(y.A,{variant:"contained",color:"error",size:"small",startIcon:(0,Pe.jsx)(ae.A,{}),onClick:Oo,sx:{borderRadius:"20px",textTransform:"none",py:.5,px:1.5,bgcolor:"error.main",fontWeight:"bold",minWidth:0,boxShadow:"0 2px 5px rgba(0,0,0,0.3)",fontFamily:(null===Ge||void 0===Ge||null===(k=Ge.style)||void 0===k?void 0:k.font)||"inherit"},children:"Stop"})}),!po&&mo&&to&&(0,Pe.jsxs)(u.A,{sx:{position:"absolute",bottom:16,right:16,width:"160px",height:"90px",borderRadius:"8px",overflow:"hidden",border:"2px solid",borderColor:"primary.main",backgroundColor:"#000",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[no?(0,Pe.jsx)(Te.fSl,{participant:to,trackType:"videoTrack"}):(0,Pe.jsx)(u.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Pe.jsx)(te.A,{sx:{fontSize:"1.5rem"}})}),(0,Pe.jsx)(x.A,{size:"small",onClick:Go,sx:{position:"absolute",top:2,right:26,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:no?(0,Pe.jsx)(oe.A,{sx:{fontSize:"0.9rem"}}):(0,Pe.jsx)(te.A,{sx:{fontSize:"0.9rem"}})}),(0,Pe.jsx)(x.A,{size:"small",onClick:()=>vo(!0),sx:{position:"absolute",top:2,right:2,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Pe.jsx)(je.A,{sx:{fontSize:"0.9rem"}})})]})]})]}),Be&&(0,Pe.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Pe.jsx)(p.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===Ge||void 0===Ge||null===(I=Ge.style)||void 0===I?void 0:I.font)||"inherit",color:(null===Ge||void 0===Ge||null===(E=Ge.style)||void 0===E?void 0:E.textColor)||"inherit"},children:"Shared Video"}),He&&(0,Pe.jsx)(h.A,{title:"Clear Shared Video",children:(0,Pe.jsx)(x.A,{onClick:()=>Le(),size:"small",sx:{color:(null===Ge||void 0===Ge||null===(F=Ge.style)||void 0===F?void 0:F.accentColor)||"inherit"},children:(0,Pe.jsx)(me.A,{})})})]}),(0,Pe.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Xe(Be)})]}),(0,Pe.jsx)(u.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",overflow:"hidden"},children:(0,Pe.jsx)(u.A,{sx:{maxWidth:"100%",display:"flex",overflowX:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},WebkitOverflowScrolling:"touch"},children:(0,Pe.jsxs)(L.A,{value:Ao,onChange:(e,o)=>jo(o),"aria-label":"room content tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root":{fontFamily:(null===Ge||void 0===Ge||null===(D=Ge.style)||void 0===D?void 0:D.font)||"inherit",color:(null===Ge||void 0===Ge||null===(U=Ge.style)||void 0===U?void 0:U.textColor)||"inherit",opacity:.7,minWidth:"auto",padding:{xs:"6px 8px",sm:"12px 16px"},fontSize:{xs:"0.75rem",sm:"0.875rem"}},"& .Mui-selected":{color:"".concat((null===Ge||void 0===Ge||null===(T=Ge.style)||void 0===T?void 0:T.accentColor)||Ye.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===Ge||void 0===Ge||null===(z=Ge.style)||void 0===z?void 0:z.accentColor)||Ye.palette.primary.main},"& .MuiTabs-scrollButtons":{"&.Mui-disabled":{opacity:.3},"&":{color:(null===Ge||void 0===Ge||null===(O=Ge.style)||void 0===O?void 0:O.textColor)||"inherit"}}},children:[(0,Pe.jsx)(B.A,{label:"Participants (".concat(Wo.length,")"),value:"participants",sx:{flexShrink:0}}),(0,Pe.jsx)(B.A,{label:"Chat",value:"chat",sx:{flexShrink:0},icon:(0,Pe.jsx)(X.A,{color:"primary",variant:"dot",invisible:"chat"===Ao||0===wo.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===Ge||void 0===Ge||null===(M=Ge.style)||void 0===M?void 0:M.accentColor)||Ye.palette.primary.main}}}),iconPosition:"end"}),(0,Pe.jsx)(B.A,{label:"Gifts",value:"gifts",sx:{flexShrink:0},icon:(0,Pe.jsx)(we.A,{fontSize:"small"}),iconPosition:"end"}),(0,Pe.jsx)(B.A,{label:"Top Gifters",value:"topGifters",sx:{flexShrink:0},icon:(0,Pe.jsx)(Se.A,{fontSize:"small"}),iconPosition:"end"})]})})}),"participants"===Ao&&(0,Pe.jsxs)(Pe.Fragment,{children:[Wo.length>0&&(0,Pe.jsx)(Te.ncL,{participants:Wo}),(0,Pe.jsx)(j.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Wo.map((e=>{const o=e.userId===Ge.ownerId;return(0,Pe.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,Pe.jsx)(Fo,{participant:e,isRoomOwner:He,isLocalParticipant:e.userId===(null===ao||void 0===ao?void 0:ao.uid),localUserAuthData:ao,onForceMuteToggle:Ve,onForceRemove:_e,onForceBan:Je,call:qe,localUserIsMute:ro,isDesignatedHost:o,onPinToggle:Mo,isPinned:bo.includes(e.userId),roomStyle:null===Ge||void 0===Ge?void 0:Ge.style,navigate:Ze})},e.userId)}))}),0===Wo.length&&(0,Pe.jsx)(p.A,{sx:{width:"100%",textAlign:"center",color:null!==Ge&&void 0!==Ge&&null!==(G=Ge.style)&&void 0!==G&&G.textColor?(0,V.X4)(null===Ge||void 0===Ge||null===(H=Ge.style)||void 0===H?void 0:H.textColor,.7):Ye.palette.text.secondary,mt:4,fontFamily:(null===Ge||void 0===Ge||null===(W=Ge.style)||void 0===W?void 0:W.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===Ao&&(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==Ge&&void 0!==Ge&&null!==(N=Ge.style)&&void 0!==N&&N.accentColor?(0,V.X4)(null===Ge||void 0===Ge||null===(_=Ge.style)||void 0===_?void 0:_.accentColor,.3):Ye.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Pe.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==Ge&&void 0!==Ge&&null!==(J=Ge.style)&&void 0!==J&&J.accentColor?(0,V.X4)(null===Ge||void 0===Ge||null===(Y=Ge.style)||void 0===Y?void 0:Y.accentColor,.3):Ye.palette.divider),bgcolor:null!==Ge&&void 0!==Ge&&null!==(Z=Ge.style)&&void 0!==Z&&Z.headerColor?(0,V.X4)(null===Ge||void 0===Ge||null===(q=Ge.style)||void 0===q?void 0:q.headerColor,.1):(0,V.X4)(Ye.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Pe.jsxs)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===Ge||void 0===Ge||null===(K=Ge.style)||void 0===K?void 0:K.font)||"inherit",color:(null===Ge||void 0===Ge||null===(Q=Ge.style)||void 0===Q?void 0:Q.textColor)||"inherit"},children:["Users in Room (",Wo.length,")"]}),(0,Pe.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Wo.map((e=>{var o,t,r,n,i,l;const s=Do[e.userId],a=(null===s||void 0===s?void 0:s.username)||e.name||e.userId.substring(0,8),d=(null===s||void 0===s?void 0:s.avatar)||e.image;return(0,Pe.jsx)(P.A,{size:"small",label:a,avatar:(0,Pe.jsx)(v.A,{src:d,alt:a,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===Ge.ownerId?(0,V.X4)((null===Ge||void 0===Ge||null===(o=Ge.style)||void 0===o?void 0:o.accentColor)||Ye.palette.secondary.main,.1):(0,V.X4)((null===Ge||void 0===Ge||null===(t=Ge.style)||void 0===t?void 0:t.headerColor)||Ye.palette.primary.main,.05),borderColor:e.userId===Ge.ownerId?(null===Ge||void 0===Ge||null===(r=Ge.style)||void 0===r?void 0:r.accentColor)||Ye.palette.secondary.main:(null===Ge||void 0===Ge||null===(n=Ge.style)||void 0===n?void 0:n.headerColor)||Ye.palette.primary.main,border:"1px solid",color:(null===Ge||void 0===Ge||null===(i=Ge.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===Ge||void 0===Ge||null===(l=Ge.style)||void 0===l?void 0:l.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,Pe.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==Ge&&void 0!==Ge&&null!==(ee=Ge.style)&&void 0!==ee&&ee.backgroundGradient?(0,V.X4)((null===Ge||void 0===Ge||null===(re=Ge.style)||void 0===re?void 0:re.backgroundColor)||Ye.palette.background.default,.3):(0,V.X4)(Ye.palette.background.paper,.5)},children:0===wo.length?(0,Pe.jsx)(p.A,{variant:"body2",color:null!==Ge&&void 0!==Ge&&null!==(ne=Ge.style)&&void 0!==ne&&ne.textColor?(0,V.X4)(null===Ge||void 0===Ge||null===(ie=Ge.style)||void 0===ie?void 0:ie.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===Ge||void 0===Ge||null===(le=Ge.style)||void 0===le?void 0:le.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,Pe.jsxs)(Pe.Fragment,{children:[wo.map((e=>{var o,t,r,n,i,l,s,a,d,c,m;return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:e.userId===(null===ao||void 0===ao?void 0:ao.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===ao||void 0===ao?void 0:ao.uid)&&(0,Pe.jsx)(v.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=Do[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,Pe.jsxs)(u.A,{children:[(0,Pe.jsx)(p.A,{variant:"caption",color:null!==Ge&&void 0!==Ge&&null!==(t=Ge.style)&&void 0!==t&&t.textColor?(0,V.X4)(null===Ge||void 0===Ge||null===(r=Ge.style)||void 0===r?void 0:r.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===ao||void 0===ao?void 0:ao.uid)?"right":"left",fontFamily:(null===Ge||void 0===Ge||null===(n=Ge.style)||void 0===n?void 0:n.font)||"inherit"},children:e.userName}),(0,Pe.jsx)(w.A,{sx:{p:1,bgcolor:e.userId===(null===ao||void 0===ao?void 0:ao.uid)?(null===Ge||void 0===Ge||null===(i=Ge.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===ao||void 0===ao?void 0:ao.uid)?null!==Ge&&void 0!==Ge&&null!==(l=Ge.style)&&void 0!==l&&l.accentColor?Ye.palette.getContrastText(Ge.style.accentColor):"primary.contrastText":(null===Ge||void 0===Ge||null===(s=Ge.style)||void 0===s?void 0:s.textColor)||"text.primary",borderRadius:e.userId===(null===ao||void 0===ao?void 0:ao.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===Ge||void 0===Ge||null===(a=Ge.style)||void 0===a?void 0:a.font)||"inherit"},children:(0,Pe.jsx)(p.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,Pe.jsx)(p.A,{variant:"caption",color:null!==Ge&&void 0!==Ge&&null!==(d=Ge.style)&&void 0!==d&&d.textColor?(0,V.X4)(null===Ge||void 0===Ge||null===(c=Ge.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===ao||void 0===ao?void 0:ao.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===Ge||void 0===Ge||null===(m=Ge.style)||void 0===m?void 0:m.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,Pe.jsx)("div",{ref:Ro})]})}),(0,Pe.jsx)(u.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==Ge&&void 0!==Ge&&null!==(de=Ge.style)&&void 0!==de&&de.accentColor?(0,V.X4)(null===Ge||void 0===Ge||null===(ce=Ge.style)||void 0===ce?void 0:ce.accentColor,.3):Ye.palette.divider),bgcolor:(null===Ge||void 0===Ge||null===(xe=Ge.style)||void 0===xe?void 0:xe.headerColor)||Ye.palette.background.paper,display:"flex"},children:(0,Pe.jsx)(R.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:ko,onChange:e=>Io(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),zo())},InputProps:{sx:{fontFamily:(null===Ge||void 0===Ge||null===(pe=Ge.style)||void 0===pe?void 0:pe.font)||"inherit",color:(null===Ge||void 0===Ge||null===(ve=Ge.style)||void 0===ve?void 0:ve.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==Ge&&void 0!==Ge&&null!==(ge=Ge.style)&&void 0!==ge&&ge.accentColor?(0,V.X4)(null===Ge||void 0===Ge||null===(fe=Ge.style)||void 0===fe?void 0:fe.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==Ge&&void 0!==Ge&&null!==(be=Ge.style)&&void 0!==be&&be.accentColor?(0,V.X4)(null===Ge||void 0===Ge||null===(ye=Ge.style)||void 0===ye?void 0:ye.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===Ge||void 0===Ge||null===(Ae=Ge.style)||void 0===Ae?void 0:Ae.accentColor)||Ye.palette.primary.main}},endAdornment:(0,Pe.jsx)(x.A,{size:"small",onClick:zo,disabled:!ko.trim(),color:"primary",sx:{color:(null===Ge||void 0===Ge||null===(Re=Ge.style)||void 0===Re?void 0:Re.accentColor)||"primary"},children:(0,Pe.jsx)(ke.A,{fontSize:"small"})})}})})]}),"gifts"===Ao&&(0,Pe.jsx)(xo,{roomId:Ge.id,roomOwnerId:Ge.ownerId,theme:Ye,roomStyle:null===Ge||void 0===Ge?void 0:Ge.style}),"topGifters"===Ao&&Ge&&(0,Pe.jsx)(Co,{roomId:Ge.id,roomOwnerId:Ge.ownerId,theme:Ye,roomStyle:null===Ge||void 0===Ge?void 0:Ge.style})]}),(0,Pe.jsxs)(u.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(Ye.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===Ge||void 0===Ge||null===(Ee=Ge.style)||void 0===Ee?void 0:Ee.headerColor)||Ye.palette.background.paper},children:[(0,Pe.jsx)(y.A,{variant:"outlined",color:"error",startIcon:(0,Pe.jsx)(se.A,{}),onClick:()=>{null===qe||void 0===qe||qe.leave().then((()=>Ze("/side-rooms")))},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===Ge||void 0===Ge||null===(Fe=Ge.style)||void 0===Fe?void 0:Fe.font)||"inherit"},children:"Leave quietly"}),He&&(0,Pe.jsx)(h.A,{title:ro?"Unmute Microphone":"Mute Microphone",children:(0,Pe.jsx)(x.A,{onClick:()=>null===qe||void 0===qe?void 0:qe.microphone.toggle(),color:ro?"default":"primary",sx:{ml:2,color:ro?"default":(null===Ge||void 0===Ge||null===(De=Ge.style)||void 0===De?void 0:De.accentColor)||"primary.main"},disabled:!qe,children:ro?(0,Pe.jsx)(he.A,{}):(0,Pe.jsx)(ue.A,{})})}),He&&(0,Pe.jsx)(h.A,{title:no?"Turn Camera Off":"Turn Camera On",children:(0,Pe.jsx)(x.A,{onClick:Go,color:no?"primary":"default",sx:{ml:1,color:no?(null===Ge||void 0===Ge||null===(Ue=Ge.style)||void 0===Ue?void 0:Ue.accentColor)||"primary.main":"default"},disabled:!qe,children:no?(0,Pe.jsx)(oe.A,{}):(0,Pe.jsx)(te.A,{})})}),He&&(0,Pe.jsx)(h.A,{title:mo?"Hide Camera Window":"Show Camera Window",children:(0,Pe.jsx)(x.A,{onClick:()=>ho(!mo),color:mo?"primary":"default",sx:{ml:1,color:mo?(null===Ge||void 0===Ge||null===(Oe=Ge.style)||void 0===Oe?void 0:Oe.accentColor)||"primary.main":"default"},disabled:!qe||!no,children:(0,Pe.jsx)(Ie.A,{})})}),He&&(0,Pe.jsx)(h.A,{title:"Share Video Link",children:(0,Pe.jsx)("span",{children:(0,Pe.jsx)(x.A,{onClick:()=>Ne(),color:"secondary",sx:{ml:2,color:(null===Ge||void 0===Ge||null===(Me=Ge.style)||void 0===Me?void 0:Me.accentColor)||Ye.palette.secondary.main},children:(0,Pe.jsx)($.A,{})})})})]})]}):(0,Pe.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,Pe.jsx)(A.A,{}),(0,Pe.jsx)(p.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},Fo=n.memo((e=>{let{participant:o,isRoomOwner:t,isLocalParticipant:r,onForceMuteToggle:i,onForceRemove:A,onForceBan:C,call:j,localUserAuthData:w,localUserIsMute:R,isDesignatedHost:F,onPinToggle:T,isPinned:z,roomStyle:O,navigate:M}=e;const G=(0,m.A)(),{isSpeaking:H,publishedTracks:W}=o,{blockUser:L,currentUser:B}=(0,s.As)(),X=!W.includes("audio")&&!H,[_,J]=(0,n.useState)(null),Y=Boolean(_),Z=e=>J(e.currentTarget),q=()=>J(null),K=async()=>{if(r&&j)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",R),await j.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),t&&null!==w&&void 0!==w&&w.uid){const o=j.cid,t=o.includes(":")?o.split(":").pop():o;if(!t)return void console.error("[StreamParticipantCard] Invalid room ID format:",o);const r=(0,d.aU)(),n=(0,d.H9)(r,"sideRooms",t);try{if(!(await(0,d.x7)(n)).exists())return void console.error("[StreamParticipantCard] Room document does not exist:",t);const e=!j.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!e)),await(0,d.mZ)(n,{isLive:!e,lastActive:(0,d.O5)()})}catch(e){console.error("[StreamParticipantCard] Error accessing room document:",e)}}}catch(o){console.error("[StreamParticipantCard] Error toggling local microphone:",o),c.oR.error("Failed to toggle microphone. See console.")}};let $,ee;const oe=o.custom;r&&w?($=w.displayName||w.email||o.userId,ee=w.photoURL||o.image||void 0):oe&&"string"===typeof oe.displayName&&""!==oe.displayName.trim()?($=oe.displayName,ee=oe.customAvatarUrl&&"string"===typeof oe.customAvatarUrl&&""!==oe.customAvatarUrl.trim()?oe.customAvatarUrl:o.image||void 0):($=o.name||o.userId,ee=o.image||void 0),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:t,isLocalParticipant:r,localUserAuthData:w}),console.log("[StreamParticipantCard] Determined values - displayName:",$,"avatarUrl:",ee,"isSpeaking:",H,"participantIsMuted:",X),r&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",w,"Stream participant.userId:",o.userId);const[te,ne]=(0,n.useState)(!1);return(0,Pe.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{const e=(0,Pe.jsx)(v.A,{src:ee,alt:$,sx:{width:64,height:64,mb:.5,border:H?"3px solid ".concat(G.palette.success.main):"2px solid ".concat((0,V.X4)(G.palette.divider,.5)),boxShadow:H?"0 0 8px ".concat(G.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer"}});return r?(0,Pe.jsx)(u.A,{onClick:K,sx:{cursor:"pointer"},children:e}):(0,Pe.jsx)(l.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:e})})(),F&&(0,Pe.jsx)(P.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(r?null===R||void 0===R||R:X)&&(0,Pe.jsx)(he.A,{sx:{fontSize:"1rem",color:G.palette.error.contrastText,backgroundColor:(0,V.X4)(G.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),r&&!R&&(0,Pe.jsx)(ue.A,{sx:{fontSize:"1rem",color:G.palette.success.contrastText,backgroundColor:(0,V.X4)(G.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,Pe.jsx)(p.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:G.palette.text.primary},children:$}),t&&!r&&(0,Pe.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Pe.jsx)(h.A,{title:"Manage User",children:(0,Pe.jsx)(x.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,V.X4)(G.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Pe.jsx)(re.A,{fontSize:"small"})})}),(0,Pe.jsxs)(g.A,{anchorEl:_,open:Y,onClose:q,MenuListProps:{dense:!0},children:[(0,Pe.jsxs)(f.A,{onClick:async()=>{q(),i&&i(o.userId,!o.publishedTracks.includes("audio"))},sx:{fontSize:"0.8rem"},children:[(0,Pe.jsx)(b.A,{sx:{minWidth:"30px"},children:X?(0,Pe.jsx)(ce.A,{fontSize:"small"}):(0,Pe.jsx)(Re.A,{fontSize:"small"})}),X?"Unmute":"Mute"]}),(0,Pe.jsxs)(f.A,{onClick:()=>{q(),T(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,Pe.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Pe.jsx)(Ee.A,{fontSize:"small",color:z?"primary":"inherit"})}),z?"Unpin from top":"Pin to top"]}),(0,Pe.jsxs)(f.A,{onClick:async()=>{if(q(),window.confirm("Are you sure you want to block ".concat(o.name||o.userId,"?")))try{await L(o.userId),c.oR.success("Blocked ".concat(o.name||o.userId)),A&&A(o.userId,o.name||o.userId)}catch(e){console.error("Error blocking user:",e),c.oR.error("Failed to block user")}},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Pe.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Pe.jsx)(Fe.A,{fontSize:"small",color:"error"})}),"Block"]})]})]}),!t&&!r&&(0,Pe.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Pe.jsx)(h.A,{title:"Options",children:(0,Pe.jsx)(x.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,V.X4)(G.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Pe.jsx)(re.A,{fontSize:"small"})})}),(0,Pe.jsx)(g.A,{anchorEl:_,open:Y,onClose:q,MenuListProps:{dense:!0},children:(0,Pe.jsxs)(f.A,{onClick:()=>{q(),ne(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Pe.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Pe.jsx)(Q.A,{fontSize:"small",color:"warning"})}),"Report User"]})})]}),z&&!F&&(0,Pe.jsx)(h.A,{title:"Pinned",children:(0,Pe.jsx)(Ee.A,{sx:{fontSize:"1rem",color:G.palette.primary.contrastText,backgroundColor:(0,V.X4)(G.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,Pe.jsxs)(S.A,{open:te,onClose:()=>ne(!1),children:[(0,Pe.jsx)(k.A,{children:"Report User"}),(0,Pe.jsxs)(I.A,{children:[(0,Pe.jsxs)(p.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,Pe.jsx)(D.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,Pe.jsx)(U.Ay,{onClick:()=>(async e=>{try{const t={reportedUserId:o.userId,reportedBy:null===B||void 0===B?void 0:B.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)(a.db,"reports"),t),c.oR.success("Report submitted for ".concat(o.name||o.userId)),ne(!1)}catch(t){console.error("Error submitting report:",t),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,V.X4)(G.palette.primary.main,.1)}},children:(0,Pe.jsx)(N.A,{primary:e})},e)))})]}),(0,Pe.jsx)(E.A,{children:(0,Pe.jsx)(y.A,{onClick:()=>ne(!1),children:"Cancel"})})]})]})}))}}]);