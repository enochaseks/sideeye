"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[682],{379:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(3235),o=r(4414);const n=(0,s.A)((0,o.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},760:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(3235),o=r(4414);const n=(0,s.A)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},1227:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(3235),o=r(4414);const n=(0,s.A)((0,o.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},4801:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(3235),o=r(4414);const n=(0,s.A)((0,o.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},6281:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(3235),o=r(4414);const n=(0,s.A)((0,o.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},8682:(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});var s=r(9379),o=r(45),n=r(9950),a=r(6491),i=r(2053),c=r(226),l=r(249),d=r(6050),u=r(5333),h=r(8614),m=r(4447),x=r(1413),p=r(3563),A=r(4745),g=r(9808),j=r(2235),y=r(8145),v=r(2046),b=r(2236),f=r(4142),w=r(6639),C=r(3174),S=r(7591),k=r(3266),M=r(4195),P=r(6583),R=r(33),E=r(8170),U=r(6493),I=r(9739),L=r(4862),N=r(379),z=r(1227),G=r(9885),W=r(6281),H=r(9715),B=r(4801),F=r(3235),J=r(4414);const q=(0,F.A)((0,J.jsx)("path",{d:"M7.58 4.08 6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42m12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42M18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-6 11c.14 0 .27-.01.4-.04.65-.14 1.18-.58 1.44-1.18.1-.24.15-.5.15-.78h-4c.01 1.1.9 2 2.01 2"}),"NotificationsActive");var D=r(3256),_=r(760),O=r(8429),T=r(1367),V=r(6220),Y=r(330),K=r(5887);const Q=["children","value","index"];function Z(e){const{children:t,value:r,index:n}=e,i=(0,o.A)(e,Q);return(0,J.jsx)("div",(0,s.A)((0,s.A)({role:"tabpanel",hidden:r!==n,id:"messages-tabpanel-".concat(n),"aria-labelledby":"messages-tab-".concat(n)},i),{},{children:r===n&&(0,J.jsx)(a.A,{sx:{pt:2},children:t})}))}const X=()=>{const{currentUser:e}=(0,T.As)(),t=(0,O.Zp)(),[r,o]=(0,n.useState)(!0),[F,Q]=(0,n.useState)([]),[X,$]=(0,n.useState)([]),[ee,te]=(0,n.useState)(""),[re,se]=(0,n.useState)([]),[oe,ne]=(0,n.useState)(!1),[ae,ie]=(0,n.useState)(!1),[ce,le]=(0,n.useState)(null),[de,ue]=(0,n.useState)(null),[he,me]=(0,n.useState)(0),[xe,pe]=(0,n.useState)([]),[Ae,ge]=(0,n.useState)([]),[je,ye]=(0,n.useState)(""),[ve,be]=(0,n.useState)(!1),[fe,we]=(0,n.useState)(!1),[Ce,Se]=(0,n.useState)(""),[ke,Me]=(0,n.useState)(""),[Pe,Re]=(0,n.useState)(!1),[Ee,Ue]=(0,n.useState)([]);(0,n.useEffect)((()=>{if(!e||!Y.db)return;o(!0);const t=(0,V.rJ)(Y.db,"conversations"),r=(0,V.P)(t,(0,V._M)("participants","array-contains",e.uid)),n=(0,V.aQ)(r,(async t=>{try{const r=(0,V.rJ)(Y.db,"users"),n=await(0,V.GG)(r),a=[];n.forEach((t=>{const r=t.data();r.blockedUsers&&Array.isArray(r.blockedUsers)&&r.blockedUsers.includes(e.uid)&&a.push(t.id)}));const i=[...e.blockedUsers||[],...a],c=t.docs.map((e=>{const t=e.data();return(0,s.A)({id:e.id},t)})).filter((t=>{const r=t.participants.find((t=>t!==e.uid));return r&&!i.includes(r)})),l=await Promise.all(c.map((async t=>{const r=t.participants.find((t=>t!==e.uid));if(!r)return t;try{const e=await(0,V.x7)((0,V.H9)(Y.db,"users",r));if(e.exists()){const r=e.data();return(0,s.A)((0,s.A)({},t),{},{displayName:r.name||r.username,photoURL:r.profilePic||r.photoURL,status:t.status||"accepted"})}}catch(o){console.error("Error fetching user data:",o)}return t}))),d=l.filter((e=>"pending"!==e.status)),u=l.filter((e=>"pending"===e.status));Q(d),$(u),o(!1)}catch(r){console.error("Error loading conversations:",r),o(!1)}}));return()=>n()}),[e,Y.db]),(0,n.useEffect)((()=>{if(!e||!Y.db)return;(async()=>{try{const t=(0,V.rJ)(Y.db,"rooms"),r=(0,V.P)(t,(0,V._M)("members","array-contains",e.uid)),o=(0,V.rJ)(Y.db,"rooms"),n=(0,V.P)(o,(0,V._M)("type","==","public"));return(0,V.aQ)(r,(async t=>{const r=t.docs.map((e=>e.id)),o=await(0,V.GG)(n),a=[...t.docs,...o.docs.filter((e=>!r.includes(e.id)))],i=await Promise.all(a.map((async t=>{const o=t.data();let n="Unknown",a="";try{const e=(0,V.H9)(Y.db,"users",o.createdBy),t=await(0,V.x7)(e);if(t.exists()){const e=t.data();n=e.name||e.username||"Unknown",a=e.profilePic||e.photoURL||""}}catch(i){console.error("Error fetching creator data:",i)}return(0,s.A)((0,s.A)({id:t.id},o),{},{creatorName:n,creatorPhoto:a,isOwner:o.createdBy===e.uid,isMember:r.includes(t.id)})})));Ue(i)}))}catch(t){console.error("Error fetching rooms:",t)}})()}),[e,Y.db]);const Ie=async()=>{if(ee.trim()){o(!0);try{const t=ee.toLowerCase().trim(),r=(0,V.rJ)(Y.db,"users"),o=(0,V.P)(r,(0,V._M)("username",">=",t),(0,V._M)("username","<=",t+"\uf8ff"),(0,V.AB)(10)),n=await(0,V.GG)(o),a=(0,V.P)(r,(0,V._M)("name",">=",ee),(0,V._M)("name","<=",ee+"\uf8ff"),(0,V.AB)(10)),i=await(0,V.GG)(a),c=new Map;n.docs.forEach((e=>{c.set(e.id,(0,s.A)({id:e.id},e.data()))})),i.docs.forEach((e=>{c.set(e.id,(0,s.A)({id:e.id},e.data()))}));const l=Array.from(c.values()).filter((t=>t.id!==(null===e||void 0===e?void 0:e.uid)));se(l)}catch(t){console.error("Error searching users:",t),K.oR.error("Failed to search users")}finally{o(!1)}}else se([])},Le=e=>{if(!e)return"";const t=e.toDate?e.toDate():new Date(e),r=(new Date).getTime()-t.getTime(),s=864e5;return r<s?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):r<2*s?"Yesterday":t.toLocaleDateString([],{month:"short",day:"numeric"})},Ne=()=>{le(null),ue(null)},ze=r=>0===r.length?(0,J.jsxs)(a.A,{sx:{textAlign:"center",mt:4,p:3},children:[(0,J.jsx)(i.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:0===he?"You haven't started any conversations yet":"No message requests"}),0===he&&(0,J.jsx)(c.A,{variant:"contained",startIcon:(0,J.jsx)(N.A,{}),onClick:()=>ne(!0),sx:{mt:2},children:"Start a new chat"})]}):(0,J.jsx)(l.A,{sx:{bgcolor:"background.paper",borderRadius:1},children:r.map(((c,l)=>{var g,j,y;return(0,J.jsxs)(n.Fragment,{children:[(0,J.jsxs)(d.Ay,{alignItems:"flex-start",button:!0,onClick:()=>t("/chat/conversation/".concat(c.id)),sx:{py:2},secondaryAction:"pending"===c.status?(0,J.jsxs)(a.A,{sx:{display:"flex"},children:[(0,J.jsx)(u.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{o(!0);const e=(0,V.H9)(Y.db,"conversations",t.id);await(0,V.mZ)(e,{status:"accepted"}),$((e=>e.filter((e=>e.id!==t.id)))),Q((e=>[(0,s.A)((0,s.A)({},t),{},{status:"accepted"}),...e])),ye("Message request accepted"),be(!0)}catch(r){console.error("Error accepting message request:",r),K.oR.error("Failed to accept message request")}finally{o(!1)}})(c)},color:"success","aria-label":"accept request",title:"Accept",children:(0,J.jsx)(z.A,{})}),(0,J.jsx)(u.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{o(!0);const e=(0,V.wP)(Y.db),r=(0,V.rJ)(Y.db,"conversations",t.id,"messages");(await(0,V.GG)(r)).docs.forEach((t=>{e.delete(t.ref)}));const s=(0,V.H9)(Y.db,"conversations",t.id);e.delete(s),await e.commit(),$((e=>e.filter((e=>e.id!==t.id)))),ye("Message request declined"),be(!0)}catch(r){console.error("Error declining message request:",r),K.oR.error("Failed to decline message request")}finally{o(!1)}})(c)},color:"error","aria-label":"decline request",title:"Decline",children:(0,J.jsx)(G.A,{})})]}):(0,J.jsx)(u.A,{edge:"end",onClick:e=>((e,t)=>{e.stopPropagation(),le(e.currentTarget),ue(t)})(e,c),"aria-label":"more options",children:(0,J.jsx)(W.A,{})}),children:[(0,J.jsx)(h.A,{children:(0,J.jsx)(m.A,{color:"primary",badgeContent:"number"===typeof c.unreadCount?c.unreadCount:0,invisible:!c.unreadCount,children:(0,J.jsx)(x.A,{alt:c.displayName||"User",src:c.photoURL||void 0,sx:{width:40,height:40,bgcolor:c.photoURL?void 0:"primary.main"},children:!c.photoURL&&(null===(g=c.displayName)||void 0===g?void 0:g.charAt(0).toUpperCase())})})}),(0,J.jsx)(p.A,{primary:c.displayName,secondary:(0,J.jsxs)(n.Fragment,{children:[(0,J.jsx)(i.A,{component:"span",variant:"body2",color:"text.primary",sx:{display:"inline",fontWeight:c.unreadCount?"bold":"normal"},children:(null===(j=c.lastMessage)||void 0===j?void 0:j.text)||"Start a conversation"}),(null===(y=c.lastMessage)||void 0===y?void 0:y.timestamp)&&(0,J.jsx)(i.A,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:Le(c.lastMessage.timestamp)})]})})]}),l<r.length-1&&(0,J.jsx)(A.A,{component:"li"})]},c.id)}))});return(0,J.jsxs)(g.A,{maxWidth:"md",sx:{mt:2,mb:8},children:[(0,J.jsxs)(j.A,{elevation:0,sx:{p:2,mb:2},children:[(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,J.jsx)(i.A,{variant:"h5",fontWeight:"bold",children:"Messages"}),(0,J.jsx)(u.A,{onClick:()=>ne(!0),color:"primary",children:(0,J.jsx)(N.A,{})})]}),(0,J.jsx)(y.A,{fullWidth:!0,placeholder:"Search conversations...",variant:"outlined",value:ee,onChange:e=>te(e.target.value),onKeyPress:e=>"Enter"===e.key&&Ie(),InputProps:{startAdornment:(0,J.jsx)(v.A,{position:"start",children:(0,J.jsx)(H.A,{})}),endAdornment:ee?(0,J.jsx)(v.A,{position:"end",children:(0,J.jsx)(u.A,{size:"small",onClick:()=>te(""),children:(0,J.jsx)(B.A,{})})}):null},sx:{mb:2}}),(0,J.jsx)(a.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,J.jsxs)(b.A,{value:he,onChange:(e,t)=>{me(t)},"aria-label":"message tabs",variant:"fullWidth",children:[(0,J.jsx)(f.A,{label:"Inbox",id:"messages-tab-0","aria-controls":"messages-tabpanel-0"}),(0,J.jsx)(f.A,{label:(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center"},children:[(0,J.jsx)("span",{children:"Message Requests"}),X.length>0&&(0,J.jsx)(m.A,{color:"error",badgeContent:X.length,sx:{ml:1}})]}),id:"messages-tab-1","aria-controls":"messages-tabpanel-1",icon:X.length>0?(0,J.jsx)(q,{fontSize:"small"}):void 0,iconPosition:"end"}),(0,J.jsx)(f.A,{label:"Rooms +",id:"messages-tab-1","aria-controls":"messages-tabpanel-1",icon:X.length>0?(0,J.jsx)(q,{fontSize:"small"}):void 0,iconPosition:"end"})]})})]}),r&&0===F.length&&0===X.length?(0,J.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,J.jsx)(w.A,{})}):(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(Z,{value:he,index:0,children:ze(F)}),(0,J.jsxs)(Z,{value:he,index:1,children:[X.length>0&&(0,J.jsx)(C.A,{severity:"info",sx:{mb:2},children:"These are message requests from people you don't follow. Accept to start chatting or decline to remove."}),ze(X)]}),(0,J.jsxs)(Z,{value:he,index:2,children:[(0,J.jsxs)(a.A,{sx:{p:2,mb:3,bgcolor:"background.paper",borderRadius:1},children:[(0,J.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"Rooms + Server Chat"}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Create a room to share announcements, live updates, and polls with your followers. Great for creators who want to engage with their audience, or for anyone who wants to create a community, you can also join other rooms inside the rooms + section."}),(0,J.jsx)(c.A,{variant:"contained",startIcon:(0,J.jsx)(D.A,{}),onClick:()=>we(!0),sx:{mt:1},children:"Create a Room"})]}),0===Ee.length?(0,J.jsx)(a.A,{sx:{textAlign:"center",mt:4,p:3},children:(0,J.jsx)(i.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"No rooms available. Create a room or join someone else's room."})}):(0,J.jsx)(l.A,{sx:{bgcolor:"background.paper",borderRadius:1},children:Ee.map(((e,r)=>{var s,o,l,u;return(0,J.jsxs)(n.Fragment,{children:[(0,J.jsxs)(d.Ay,{alignItems:"flex-start",button:!0,onClick:()=>t("/chat/room/".concat(e.id)),sx:{py:2},children:[(0,J.jsx)(h.A,{children:(0,J.jsx)(m.A,{color:"secondary",variant:"dot",invisible:!e.isOwner,children:(0,J.jsx)(x.A,{alt:e.name,src:e.creatorPhoto,sx:{bgcolor:e.creatorPhoto?void 0:"secondary.main"},children:!e.creatorPhoto&&(null===(s=e.name)||void 0===s?void 0:s.charAt(0).toUpperCase())})})}),(0,J.jsx)(p.A,{primary:(0,J.jsxs)(a.A,{display:"flex",alignItems:"center",children:[(0,J.jsx)(i.A,{variant:"subtitle1",component:"span",children:e.name}),e.isOwner&&(0,J.jsx)(i.A,{variant:"caption",component:"span",sx:{ml:1,bgcolor:"secondary.main",px:1,py:.5,borderRadius:1,color:"white"},children:"Owner"}),!e.isOwner&&e.isMember&&(0,J.jsx)(i.A,{variant:"caption",component:"span",sx:{ml:1,bgcolor:"success.light",px:1,py:.5,borderRadius:1,color:"white"},children:"Joined"})]}),secondary:(0,J.jsxs)(n.Fragment,{children:[(0,J.jsxs)(i.A,{component:"div",variant:"body2",color:"text.primary",sx:{display:"block"},children:[null===(o=e.description)||void 0===o?void 0:o.substring(0,60),(null===(l=e.description)||void 0===l?void 0:l.length)>60?"...":""]}),(0,J.jsxs)(a.A,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mt:.5},children:[(0,J.jsxs)(i.A,{component:"span",variant:"caption",color:"text.secondary",children:["Created by ",e.creatorName," \u2022 ",(null===(u=e.members)||void 0===u?void 0:u.length)||0," members"]}),!e.isMember&&(0,J.jsx)(c.A,{size:"small",variant:"outlined",color:"primary",onClick:r=>{r.stopPropagation(),t("/chat/room/".concat(e.id))},sx:{minWidth:"60px",ml:1},children:"Join"})]})]})})]}),r<Ee.length-1&&(0,J.jsx)(A.A,{component:"li"})]},e.id)}))})]})]}),(0,J.jsx)(S.A,{anchorEl:ce,open:Boolean(ce),onClose:Ne,children:(0,J.jsxs)(k.A,{onClick:async()=>{if(de&&e)try{o(!0);const e=(0,V.wP)(Y.db),t=(0,V.rJ)(Y.db,"conversations",de.id,"messages");(await(0,V.GG)(t)).docs.forEach((t=>{e.delete(t.ref)}));const r=(0,V.H9)(Y.db,"conversations",de.id);e.delete(r),await e.commit(),Q((e=>e.filter((e=>e.id!==de.id)))),$((e=>e.filter((e=>e.id!==de.id)))),ye("Conversation deleted"),be(!0)}catch(t){console.error("Error deleting conversation:",t),K.oR.error("Failed to delete conversation")}finally{o(!1),Ne()}else Ne()},sx:{color:"error.main"},children:[(0,J.jsx)(M.A,{children:(0,J.jsx)(_.A,{fontSize:"small",color:"error"})}),"Delete conversation"]})}),(0,J.jsxs)(P.A,{open:oe,onClose:()=>ne(!1),maxWidth:"sm",fullWidth:!0,children:[(0,J.jsx)(R.A,{children:(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,J.jsx)(i.A,{variant:"h6",children:"Start a new conversation"}),(0,J.jsx)(u.A,{edge:"end",color:"inherit",onClick:()=>ne(!1),"aria-label":"close",children:(0,J.jsx)(B.A,{})})]})}),(0,J.jsxs)(E.A,{children:[(0,J.jsx)(y.A,{autoFocus:!0,margin:"dense",fullWidth:!0,label:"Search for a user",variant:"outlined",value:ee,onChange:e=>te(e.target.value),onKeyPress:e=>"Enter"===e.key&&Ie(),InputProps:{endAdornment:(0,J.jsx)(v.A,{position:"end",children:(0,J.jsx)(u.A,{onClick:Ie,children:(0,J.jsx)(H.A,{})})})},sx:{mb:2}}),re.length>0&&(0,J.jsx)(l.A,{children:re.map((r=>(0,J.jsxs)(d.Ay,{button:!0,onClick:()=>(async r=>{if(null!==e&&void 0!==e&&e.uid){ie(!0);try{var s;const o=(0,V.P)((0,V.rJ)(Y.db,"conversations"),(0,V._M)("participants","array-contains",e.uid)),n=await(0,V.GG)(o);let a=null;if(n.docs.forEach((e=>{e.data().participants.includes(r)&&(a=e.id)})),a)return void t("/chat/conversation/".concat(a));const i=(0,V.H9)(Y.db,"users",r),c=await(0,V.x7)(i);if(!c.exists())return void K.oR.error("User not found");const l=c.data(),d=(null===(s=l.following)||void 0===s?void 0:s.includes(e.uid))||!1;console.log("[Messages] Creating conversation: ".concat(l.username||r," follows current user? ").concat(d));const u=(0,V.H9)((0,V.rJ)(Y.db,"conversations"));await(0,V.BN)(u,{participants:[e.uid,r],createdAt:(0,V.O5)(),lastUpdated:(0,V.O5)(),unreadCount:{[e.uid]:0,[r]:0},status:d?"accepted":"pending"}),t("/chat/conversation/".concat(u.id))}catch(o){console.error("[Messages] Error creating conversation:",o),K.oR.error("Failed to start conversation")}finally{ie(!1),ne(!1)}}})(r.id),disabled:ae,children:[(0,J.jsx)(h.A,{children:(0,J.jsx)(x.A,{src:r.profilePic,alt:r.username||r.name})}),(0,J.jsx)(p.A,{primary:r.name||r.username,secondary:"@".concat(r.username)})]},r.id)))}),ee&&0===re.length&&!r&&(0,J.jsxs)(a.A,{sx:{textAlign:"center",py:3},children:[(0,J.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:['No users found for "',ee,'"']}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try using a different search term"})]}),r&&(0,J.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:3},children:[(0,J.jsx)(w.A,{size:32,sx:{mb:2}}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Searching for users..."})]}),!ee&&!r&&(0,J.jsx)(a.A,{sx:{textAlign:"center",py:3},children:(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Enter a username or name to search"})})]})]}),(0,J.jsxs)(P.A,{open:fe,onClose:()=>we(!1),maxWidth:"sm",fullWidth:!0,children:[(0,J.jsx)(R.A,{children:"Create Server Chat Room"}),(0,J.jsxs)(E.A,{children:[(0,J.jsx)(U.A,{sx:{mb:2},children:"Server chat rooms allow you to broadcast updates to your followers, share announcements, and create polls. Your followers can join these rooms to stay updated with your content."}),(0,J.jsx)(y.A,{autoFocus:!0,margin:"dense",label:"Room Name",fullWidth:!0,variant:"outlined",value:Ce,onChange:e=>Se(e.target.value),required:!0,sx:{mb:2}}),(0,J.jsx)(y.A,{margin:"dense",label:"Description",fullWidth:!0,variant:"outlined",value:ke,onChange:e=>Me(e.target.value),multiline:!0,rows:3,placeholder:"What is this room about? Who should join?"})]}),(0,J.jsxs)(I.A,{children:[(0,J.jsx)(c.A,{onClick:()=>we(!1),disabled:Pe,children:"Cancel"}),(0,J.jsx)(c.A,{onClick:async()=>{if(null!==e&&void 0!==e&&e.uid&&Ce.trim()){Re(!0);try{const s=(0,V.H9)((0,V.rJ)(Y.db,"rooms"));await(0,V.BN)(s,{name:Ce.trim(),description:ke.trim(),createdBy:e.uid,createdAt:(0,V.O5)(),members:[e.uid],type:"public",lastMessage:null});try{const t=(0,V.H9)(Y.db,"users",e.uid),r=await(0,V.x7)(t),o=r.exists()?r.data():null;if(o&&o.followers&&Array.isArray(o.followers)){const t=o.followers,r=(0,V.rJ)(Y.db,"notifications"),n=t.map((t=>(0,V.gS)(r,{type:"room_created",senderId:e.uid,senderName:o.name||o.username||e.displayName||"User",senderAvatar:o.profilePic||e.photoURL||"",recipientId:t,content:"".concat(o.name||o.username||"User"," created a new room: ").concat(Ce.trim()),roomId:s.id,roomName:Ce.trim(),isRead:!1,createdAt:(0,V.O5)()})));await Promise.all(n),console.log("Sent room creation notifications to ".concat(t.length," followers"))}}catch(r){console.error("Error sending room creation notifications:",r)}Se(""),Me(""),we(!1),t("/chat/room/".concat(s.id)),ye("Room created successfully"),be(!0)}catch(s){console.error("Error creating room:",s),K.oR.error("Failed to create room")}finally{Re(!1)}}},variant:"contained",disabled:!Ce.trim()||Pe,children:Pe?(0,J.jsx)(w.A,{size:24}):"Create Room"})]})]}),(0,J.jsx)(L.A,{open:ve,autoHideDuration:4e3,onClose:()=>{be(!1)},message:je})]})}},9885:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(3235),o=r(4414);const n=(0,s.A)((0,o.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")}}]);