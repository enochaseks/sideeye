"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[808],{4454:(e,o,t)=>{t.d(o,{A:()=>l});t(9950);var r=t(6491),n=t(2053),i=t(5277),s=t(4414);const l=e=>{let{links:o}=e;return o&&0!==o.length?(0,s.jsxs)(r.A,{mt:1,children:[(0,s.jsx)(n.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,s.jsx)(r.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,s.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},7808:(e,o,t)=>{t.r(o),t.d(o,{default:()=>So});var r=t(9379),n=t(9950),i=t(8429),s=t(2074),l=t(1367),a=t(330),d=t(6220),c=t(5887),u=t(6491),m=t(4857),h=t(3274),x=t(5333),p=t(2053),v=t(1413),g=t(7591),f=t(3266),b=t(4195),y=t(226),A=t(6639),C=t(3174),j=t(899),w=t(2235),S=t(6583),k=t(33),R=t(8170),I=t(8145),E=t(9739),F=t(4745),U=t(5277),P=t(249),D=t(6050),T=t(5979),z=t(3788),O=t(6101),G=t(6497),H=t(7324),W=t(9325),M=t(8614),N=t(3563),B=t(2236),L=t(4142),X=t(4447),V=t(7497),_=t(7443),Y=t(5965),J=t(2682),Z=t(9316),q=t(227),K=t(6904),Q=t(7565),$=t(9575),ee=t(1679),oe=t(7341),te=t(5204),re=t(6281),ne=t(379),ie=t(1300),se=t(1770),le=t(760),ae=t(7319),de=t(492),ce=t(8008),ue=t(1902),me=t(5855),he=t(9939),xe=t(529),pe=t(9404),ve=t(5379),ge=t(361),fe=t(1675),be=t(9715),ye=t(6164),Ae=t(6835),Ce=t(6117),je=t(2960),we=t(1673),Se=t(6487),ke=t(2600),Re=t(7286),Ie=t(4414);const Ee=e=>{var o;let{open:t,onClose:i,onSubmit:s,initialData:l,title:a="Create Room",submitButtonText:d="Create"}=e;const[c,m]=(0,n.useState)({name:(null===l||void 0===l?void 0:l.name)||"",description:(null===l||void 0===l?void 0:l.description)||"",isPrivate:(null===l||void 0===l?void 0:l.isPrivate)||!1,password:(null===l||void 0===l?void 0:l.password)||"",tags:(null===l||void 0===l?void 0:l.tags)||[]}),[h,x]=(0,n.useState)(null);return(0,Ie.jsx)(S.A,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,Ie.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(c,h)},children:[(0,Ie.jsx)(k.A,{children:a}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Ie.jsx)(I.A,{label:"Name",value:c.name,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,Ie.jsx)(I.A,{label:"Description",value:c.description,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,Ie.jsx)(G.A,{control:(0,Ie.jsx)(H.A,{checked:c.isPrivate,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,Ie.jsx)(I.A,{label:"Password",type:"password",value:c.password,onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,Ie.jsxs)(u.A,{sx:{mt:1},children:[(0,Ie.jsxs)(y.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,Ie.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?x(e.target.files[0]):x(null)}})]}),h&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",h.name]}),!h&&(null===l||void 0===l?void 0:l.thumbnailUrl)&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",l.thumbnailUrl.substring(l.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,Ie.jsx)(I.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>m((o=>(0,r.A)((0,r.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:i,children:"Cancel"}),(0,Ie.jsx)(y.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var Fe=t(7493),Ue=t(9317),Pe=t(6932),De=t(9751),Te=t(2856),ze=t(1397),Oe=t(3422),Ge=t(4454),He=t(4862);const We=[{value:"harassment",label:"Harassment"},{value:"hate_speech",label:"Hate Speech"},{value:"spam",label:"Spam"},{value:"inappropriate",label:"Inappropriate Content"},{value:"misinformation",label:"Misinformation"},{value:"copyright",label:"Copyright Violation"},{value:"privacy",label:"Privacy Violation"},{value:"other",label:"Other"}],Me=e=>{let{contentId:o,contentType:t,onClose:i,open:s,ownerUsername:c}=e;const{currentUser:m}=(0,l.As)(),[h,x]=(0,n.useState)(null),[v,g]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[U,P]=(0,n.useState)(null),[D,T]=(0,n.useState)(!1),[z,O]=(0,n.useState)({open:!1,message:""});(0,n.useEffect)((()=>{s&&G()}),[s]);const G=async()=>{try{let s="";switch(t){case"sideRoom":s="sideRooms";break;case"message":s="messages";break;case"chatRoom":s="chatRooms";break;case"sadeAI":s="sadeAIChats";break;case"user":s="users";break;default:s="unknown"}if("unknown"===s)return console.error("Unknown content type:",t),void P("Failed to determine content type");const l=(0,d.H9)(a.db,s,o),u=await(0,d.x7)(l);if(u.exists()){var e,r,n,i;const o=u.data();x({title:(null===o||void 0===o?void 0:o.title)||(null===o||void 0===o?void 0:o.name)||(null===o||void 0===o?void 0:o.username),content:(null===o||void 0===o?void 0:o.content)||(null===o||void 0===o?void 0:o.text)||(null===o||void 0===o?void 0:o.description),author:c||(null===o||void 0===o?void 0:o.authorName)||(null===o||void 0===o?void 0:o.username)||"Unknown",timestamp:null!==o&&void 0!==o&&null!==(e=o.timestamp)&&void 0!==e&&null!==(r=e.toDate)&&void 0!==r&&r.call(e)?o.timestamp.toDate().toISOString():null!==o&&void 0!==o&&null!==(n=o.createdAt)&&void 0!==n&&null!==(i=n.toDate)&&void 0!==i&&i.call(n)?o.createdAt.toDate().toISOString():(new Date).toISOString()})}else console.log("Preview document does not exist!"),x(null)}catch(U){console.error("Error fetching content:",U),P("Failed to fetch content")}};return(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsxs)(S.A,{open:s,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,Ie.jsxs)(k.A,{children:["Report ",(()=>{switch(t){case"sideRoom":return"Side Room";case"message":return"Message";case"chatRoom":return"Chat Room";case"sadeAI":return"Sade AI Chat";case"user":return"User";default:return"Content"}})()]}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:3,pt:2},children:[h&&(0,Ie.jsxs)(w.A,{elevation:1,sx:{p:2},children:[(0,Ie.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Content Preview"}),h.title&&(0,Ie.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:h.title}),h.content&&(0,Ie.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:h.content}),h.author&&(0,Ie.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:["By: ",h.author]})]}),(0,Ie.jsx)(F.A,{}),(0,Ie.jsx)(I.A,{select:!0,label:"Report Type",value:v,onChange:e=>g(e.target.value),fullWidth:!0,required:!0,children:We.map((e=>(0,Ie.jsx)(f.A,{value:e.value,children:e.label},e.value)))}),(0,Ie.jsx)(I.A,{label:"Description",value:b,onChange:e=>j(e.target.value),multiline:!0,rows:4,fullWidth:!0,required:!0,placeholder:"Please provide details about why you are reporting this content..."}),U&&(0,Ie.jsx)(C.A,{severity:"error",sx:{mt:2},children:U})]})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:i,disabled:D,children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:async()=>{if(m&&a.db)try{T(!0),P("");let e="";switch(t){case"sideRoom":e="sideRooms";break;case"message":e="messages";break;case"chatRoom":e="chatRooms";break;case"sadeAI":e="sadeAIChats";break;case"user":e="users";break;default:e="unknown"}const r=(0,d.rJ)(a.db,"reports");await(0,d.gS)(r,{type:v,description:b,reporterId:m.uid,contentId:o,contentType:t,collectionName:e,timestamp:(0,d.O5)()});const n=(0,d.rJ)(a.db,"notifications","admin","reports");await(0,d.gS)(n,{contentId:o,contentType:t,collectionName:e,reporterId:m.uid,timestamp:(0,d.O5)()}),O({open:!0,message:"Report submitted successfully. Our team will review it shortly."}),i()}catch(U){console.error("Error submitting report:",U),P("Failed to submit report")}finally{T(!1)}},variant:"contained",color:"primary",disabled:D,children:D?(0,Ie.jsx)(A.A,{size:24}):"Submit Report"})]})]}),(0,Ie.jsx)(He.A,{open:z.open,autoHideDuration:6e3,onClose:()=>O((0,r.A)((0,r.A)({},z),{},{open:!1})),children:(0,Ie.jsx)(C.A,{onClose:()=>O((0,r.A)((0,r.A)({},z),{},{open:!1})),severity:"success",sx:{width:"100%"},children:z.message})})]})},Ne=e=>{var o;let{open:t,onClose:r,roomName:i,roomLink:s,onSend:l,currentUserId:m}=e;const[h,x]=(0,n.useState)(""),[g,f]=(0,n.useState)([]),[b,C]=(0,n.useState)(!1),[j,w]=(0,n.useState)(null),[T,z]=(0,n.useState)([]),[O,G]=(0,n.useState)(!1),H=(0,n.useCallback)((async()=>{if(m&&a.db){G(!0);try{const e=(0,d.rJ)(a.db,"rooms"),o=(0,d.P)(e,(0,d._M)("members","array-contains",m)),t=await(0,d.GG)(o),r=[];t.forEach((e=>{const o=e.data();r.push({id:e.id,name:o.name||"Chat Room"})})),z(r)}catch(e){console.error("Error fetching server chat rooms:",e),c.oR.error("Failed to load server chat rooms")}finally{G(!1)}}}),[m]);(0,n.useEffect)((()=>{t&&H()}),[t,H]);const W=(0,n.useCallback)((async e=>{if(!e.trim()||e.length<2)f([]);else{C(!0);try{const o=(0,d.rJ)(a.db,"users"),t=(0,d.P)(o,(0,d.AB)(50)),r=await(0,d.GG)(t),n=[],i=e.toLowerCase();r.forEach((e=>{if(e.id!==m){var o;const t=e.data();null!==(o=t.username)&&void 0!==o&&o.toLowerCase().includes(i)&&n.push({id:e.id,username:t.username||"",displayName:t.displayName,photoURL:t.photoURL||t.profilePic,email:t.email})}})),f(n)}catch(o){console.error("Error searching users:",o),c.oR.error("Failed to search users"),f([])}finally{C(!1)}}}),[m]);(0,n.useEffect)((()=>{const e=setTimeout((()=>{W(h)}),500);return()=>clearTimeout(e)}),[h,W]);return(0,Ie.jsxs)(S.A,{open:t,onClose:r,fullWidth:!0,maxWidth:"xs",children:[(0,Ie.jsx)(k.A,{children:"Share Room via Message"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{mt:2},children:[(0,Ie.jsx)(I.A,{fullWidth:!0,label:"Search Users",variant:"outlined",value:h,onChange:e=>x(e.target.value),placeholder:"Type username to search...",disabled:!!j}),b&&(0,Ie.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Ie.jsx)(A.A,{size:24})}),!b&&g.length>0&&!j&&(0,Ie.jsx)(P.A,{sx:{mt:2,maxHeight:300,overflow:"auto"},children:g.map((e=>{var o;return(0,Ie.jsxs)(D.Ay,{button:!0,onClick:()=>(e=>{w(e),x(""),f([])})(e),children:[(0,Ie.jsx)(M.A,{children:(0,Ie.jsx)(v.A,{src:e.photoURL||void 0,alt:e.username,sx:{width:40,height:40},children:null===(o=e.username[0])||void 0===o?void 0:o.toUpperCase()})}),(0,Ie.jsx)(N.A,{primary:e.username,secondary:e.displayName||e.email})]},e.id)}))}),j&&(0,Ie.jsxs)(u.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",children:"Selected User:"}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,Ie.jsx)(v.A,{src:j.photoURL||void 0,alt:j.username,sx:{width:40,height:40},children:null===(o=j.username[0])||void 0===o?void 0:o.toUpperCase()}),(0,Ie.jsx)(p.A,{sx:{ml:1},children:j.username}),(0,Ie.jsx)(y.A,{size:"small",onClick:()=>w(null),sx:{ml:"auto"},children:"Change"})]})]}),!b&&h.length>=2&&0===g.length&&(0,Ie.jsx)(p.A,{color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"No users found"}),(0,Ie.jsx)(F.A,{sx:{mt:3,mb:2},children:(0,Ie.jsx)(U.A,{label:"Room + Server Chat"})}),O?(0,Ie.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Ie.jsx)(A.A,{size:24})}):T.length>0?(0,Ie.jsx)(P.A,{sx:{mt:2},children:T.map((e=>(0,Ie.jsx)(D.Ay,{button:!0,onClick:()=>(async(e,o)=>{try{const t=(0,d.H9)(a.db,"rooms",e);if(!(await(0,d.x7)(t)).exists())return void c.oR.error("Room not found");const n="Check out this room".concat(o?": ".concat(o):"","! ").concat(s);await l(e,n),c.oR.success("Message sent to ".concat(o)),r()}catch(t){console.error("Error sending message to server chat:",t),c.oR.error("Failed to send message to server chat")}})(e.id,e.name),sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover"}},children:(0,Ie.jsx)(N.A,{primary:e.name,secondary:"Room + Server Chat"})},e.id)))}):(0,Ie.jsx)(p.A,{color:"text.secondary",sx:{textAlign:"center"},children:"No Room + Server Chats available"})]})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:r,children:"Cancel"}),(0,Ie.jsx)(y.A,{variant:"contained",onClick:async()=>{if(j)try{const e="Check out this room".concat(i?": ".concat(i):"","! ").concat(s);await l(j.id,e),c.oR.success("Message sent to ".concat(j.username)),r()}catch(e){console.error("Error sending message:",e),c.oR.error("Failed to send message")}else c.oR.error("Please select a user first")},disabled:!j,children:"Send"})]})]})};var Be,Le,Xe,Ve,_e,Ye=t(7528),Je=t(6319),Ze=t(8713),qe=t(2183),Ke=t(2375),Qe=t(2631),$e=t(6389),eo=t(8283);const oo=(0,eo.i7)(Be||(Be=(0,Ye.A)(["\n  0% { transform: translateY(0) scale(1); }\n  50% { transform: translateY(-20px) scale(1.2); }\n  100% { transform: translateY(-40px) scale(0.8); opacity: 0; }\n"]))),to=(0,eo.i7)(Le||(Le=(0,Ye.A)(["\n  0% { transform: scale(1); opacity: 1; }\n  50% { transform: scale(1.3); opacity: 0.7; }\n  100% { transform: scale(1); opacity: 1; }\n"]))),ro=(0,eo.i7)(Xe||(Xe=(0,Ye.A)(["\n  0% { transform: translateX(0); }\n  20% { transform: translateX(-15px); }\n  40% { transform: translateX(15px); }\n  60% { transform: translateX(-15px); }\n  80% { transform: translateX(15px); }\n  100% { transform: translateX(0); }\n"]))),no=(0,eo.i7)(Ve||(Ve=(0,Ye.A)(["\n  0% { transform: translateY(20px) scale(0.5); opacity: 0; }\n  20% { transform: translateY(0) scale(1.2); opacity: 1; }\n  40% { transform: translateY(-10px) scale(1.0); }\n  60% { transform: rotate(-10deg); }\n  80% { transform: rotate(10deg); }\n  100% { transform: rotate(0) scale(1.1); }\n"]))),io=(0,eo.i7)(_e||(_e=(0,Ye.A)(["\n  0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }\n  100% { transform: translate(var(--x-end), var(--y-end)) rotate(var(--rotation)); opacity: 0; }\n"]))),so=e=>{let{color:o,delay:t,size:r}=e;const n=300*Math.random()-150,i=200*Math.random()-50,s=360*Math.random();return(0,Ie.jsx)(u.A,{sx:{position:"absolute",width:r,height:r,backgroundColor:o,borderRadius:"2px",opacity:1,animation:"".concat(io," 2s forwards ease-out"),animationDelay:"".concat(t,"ms"),"--x-end":"".concat(n,"px"),"--y-end":"".concat(i,"px"),"--rotation":"".concat(s,"deg")}})},lo=()=>{const e=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ff9900","#9900ff"],o=[];for(let t=0;t<100;t++){const r=e[Math.floor(Math.random()*e.length)],n=500*Math.random(),i=6*Math.random()+4;o.push((0,Ie.jsx)(so,{color:r,delay:n,size:i},t))}return(0,Ie.jsx)(u.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:0,height:0},children:o})},ao=e=>{let{color:o}=e;return(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",gap:3,animation:"".concat(ro," 1.5s ease-in-out infinite")},children:[(0,Ie.jsx)(u.A,{sx:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"white",display:"flex",justifyContent:"flex-end",alignItems:"center",border:"2px solid black",overflow:"hidden"},children:(0,Ie.jsx)(u.A,{sx:{width:"25px",height:"25px",borderRadius:"50%",backgroundColor:o,marginRight:"2px"}})}),(0,Ie.jsx)(u.A,{sx:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"white",display:"flex",justifyContent:"flex-end",alignItems:"center",border:"2px solid black",overflow:"hidden"},children:(0,Ie.jsx)(u.A,{sx:{width:"25px",height:"25px",borderRadius:"50%",backgroundColor:o,marginRight:"2px"}})})]})},co=e=>{let{gift:o,onAnimationComplete:t}=e;(0,n.useEffect)((()=>{const e=setTimeout((()=>{t()}),2500);return()=>clearTimeout(e)}),[t]);return(0,Ie.jsx)(u.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,pointerEvents:"none",bgcolor:"rgba(0, 0, 0, 0.3)"},children:(()=>{switch(o.id){case"side-eye-gift":return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",animation:"".concat(oo," 2.5s ease-out forwards")},children:[(0,Ie.jsx)(ao,{color:o.color}),(0,Ie.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:"Side Eye!"})]});case"crown-gift":return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(u.A,{sx:{color:o.color,fontSize:120,filter:"drop-shadow(0 0 20px rgba(255,215,0,0.8))",animation:"".concat(no," 2s ease-out forwards"),transformOrigin:"center bottom"},children:(0,Ie.jsx)($e.A,{fontSize:"inherit"})}),(0,Ie.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:"Crown!"})]});case"confetti-gift":return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[(0,Ie.jsx)(lo,{}),(0,Ie.jsx)(u.A,{sx:{color:o.color,fontSize:100,animation:"".concat(to," 0.5s ease-in-out infinite"),filter:"drop-shadow(0 0 10px rgba(255,255,255,0.7))",zIndex:1},children:(0,Ie.jsx)(Qe.A,{fontSize:"inherit"})}),(0,Ie.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2,zIndex:1},children:"Confetti!"})]});default:return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",animation:"".concat(oo," 2.5s ease-out forwards")},children:[(0,Ie.jsx)(u.A,{sx:{color:o.color,fontSize:100,animation:"".concat(to," 0.5s ease-in-out infinite"),filter:"drop-shadow(0 0 10px rgba(255,255,255,0.7))"},children:o.icon}),(0,Ie.jsxs)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:[o.name,"!"]})]})}})()})},uo=e=>{let{roomId:o,roomOwnerId:t,theme:r,roomStyle:i}=e;const{currentUser:s}=(0,l.As)(),[c,m]=(0,n.useState)([{id:"side-eye-gift",type:"basic",name:"Side Eye",icon:(0,Ie.jsx)(Ke.A,{}),value:5,color:"#9C27B0"},{id:"heart-gift",type:"basic",name:"Heart",icon:(0,Ie.jsx)(qe.A,{}),value:10,color:"#FF5C8D"},{id:"confetti-gift",type:"basic",name:"Confetti",icon:(0,Ie.jsx)(Qe.A,{}),value:15,color:"#FF9800"},{id:"crown-gift",type:"basic",name:"Crown",icon:(0,Ie.jsx)($e.A,{}),value:20,color:"#FFC107"}]),[h,v]=(0,n.useState)([]),g=(0,n.useMemo)((()=>[...c,...h]),[c,h]),[f,b]=(0,n.useState)([]),[A,C]=(0,n.useState)(null),[I,F]=(0,n.useState)(!1),[P,D]=(0,n.useState)(!1),[T,z]=(0,n.useState)(!1),[O,G]=(0,n.useState)(null),H=(null===s||void 0===s?void 0:s.uid)===t,W=(0,n.useRef)(new Set),M=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(!o)return;const e=(0,d.rJ)(a.db,"sideRooms",o,"gifts"),r=(0,d.P)(e,(0,d.My)("timestamp","desc")),n=(0,d.aQ)(r,(e=>{const o=[];(null===s||void 0===s?void 0:s.uid)===t&&!M.current&&e.docChanges().length>0&&e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data(),t=e.doc.id;if(!W.current.has(t)){W.current.add(t);const e=g.find((e=>e.id===o.giftId));o.senderId!==s.uid&&e&&(G(e),z(!0))}}})),M.current&&(e.forEach((e=>{W.current.add(e.id)})),M.current=!1),e.forEach((e=>{const t=e.data();o.push({id:e.id,giftId:t.giftId,giftType:t.giftType,giftName:t.giftName,senderId:t.senderId,senderName:t.senderName,receiverId:t.receiverId,timestamp:t.timestamp,value:t.value})})),b(o)}));return()=>n()}),[o,s,t,g]),(0,n.useEffect)((()=>{}),[O]);const N=()=>{F(!1)};return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),borderRadius:1,overflow:"hidden"},children:[T&&O&&(0,Ie.jsx)(co,{gift:O,onAnimationComplete:()=>{z(!1),G(null)}}),(0,Ie.jsxs)(u.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:(0,V.X4)(r.palette.background.paper,.1)},"&::-webkit-scrollbar-thumb":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.3),borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.5)}},children:[!H&&(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(r.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Free Gifts"}),(0,Ie.jsx)(j.Ay,{container:!0,spacing:2,sx:{mt:.5},children:c.map((e=>(0,Ie.jsx)(j.Ay,{item:!0,xs:6,sm:3,children:(0,Ie.jsxs)(w.A,{elevation:2,sx:{p:1.5,textAlign:"center",cursor:"pointer",transition:"all 0.2s",bgcolor:(0,V.X4)(e.color,.1),border:"1px solid ".concat((0,V.X4)(e.color,.3)),"&:hover":{transform:"translateY(-3px)",boxShadow:3}},onClick:()=>(e=>{H||(C(e),F(!0))})(e),children:[(0,Ie.jsx)(u.A,{sx:{color:e.color,mb:1,fontSize:30,display:"flex",justifyContent:"center"},children:e.icon}),(0,Ie.jsx)(p.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary},children:e.name}),(0,Ie.jsx)(U.A,{size:"small",label:"Gift",sx:{mt:1,bgcolor:(0,V.X4)(e.color,.2),color:e.color,fontWeight:"bold"}})]})},e.id)))})]}),!H&&(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),bgcolor:(0,V.X4)(r.palette.background.paper,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Premium Gifts"}),(0,Ie.jsx)(U.A,{size:"small",label:"Coming Soon",sx:{bgcolor:(0,V.X4)(r.palette.primary.main,.1),color:r.palette.primary.main,fontWeight:"bold"}})]}),(0,Ie.jsxs)(u.A,{sx:{p:3,textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary,.6),fontStyle:"italic"},children:[(0,Ie.jsx)(Ze.A,{sx:{fontSize:40,mb:1,opacity:.4}}),(0,Ie.jsx)(p.A,{variant:"body2",children:"Premium gifts will be available soon! Stay tuned for exciting new ways to show your support."})]})]}),H&&(0,Ie.jsxs)(u.A,{sx:{p:3,textAlign:"center",bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(r.palette.background.paper,.7),borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider)},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit",mb:1},children:"Room Owner View"}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:"As the room owner, you can view gifts that others have sent to you."})]}),(0,Ie.jsxs)(u.A,{sx:{p:2,bgcolor:null!==i&&void 0!==i&&i.backgroundGradient?(0,V.X4)((null===i||void 0===i?void 0:i.backgroundColor)||r.palette.background.default,.3):(0,V.X4)(r.palette.background.paper,.5)},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{mb:2,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:H?"Gifts Received":"Recent Gifts"}),0===f.length?(0,Ie.jsx)(p.A,{variant:"body2",color:null!==i&&void 0!==i&&i.textColor?(0,V.X4)(null===i||void 0===i?void 0:i.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:H?"You haven't received any gifts yet.":"No gifts have been sent yet. Be the first to send a gift!"}):(0,Ie.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:f.map((e=>{const o=g.find((o=>o.id===e.giftId))||{id:e.giftId,type:e.giftType,name:e.giftName,icon:(0,Ie.jsx)(Ze.A,{}),value:e.value,color:"#757575"};return(0,Ie.jsxs)(w.A,{elevation:1,sx:{p:1.5,display:"flex",alignItems:"center",bgcolor:(0,V.X4)(o.color,.05),border:"1px solid ".concat((0,V.X4)(o.color,.2))},children:[(0,Ie.jsx)(u.A,{sx:{color:o.color,mr:1.5,display:"flex"},children:o.icon}),(0,Ie.jsxs)(u.A,{sx:{flexGrow:1},children:[(0,Ie.jsxs)(p.A,{variant:"body2",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary},children:[(0,Ie.jsx)("strong",{children:e.senderName})," sent a ",(0,Ie.jsx)("strong",{children:e.giftName})]}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:e.timestamp?new Date(e.timestamp.toDate()).toLocaleString():"Just now"})]})]},e.id)}))})]})]}),(0,Ie.jsxs)(S.A,{open:I,onClose:N,maxWidth:"xs",fullWidth:!0,children:[(0,Ie.jsxs)(k.A,{children:["Send Gift",(0,Ie.jsx)(x.A,{"aria-label":"close",onClick:N,sx:{position:"absolute",right:8,top:8},children:(0,Ie.jsx)(Je.A,{})})]}),(0,Ie.jsx)(R.A,{children:A&&(0,Ie.jsxs)(u.A,{sx:{textAlign:"center",py:2},children:[(0,Ie.jsx)(u.A,{sx:{color:A.color,fontSize:60,mb:2,display:"flex",justifyContent:"center"},children:A.icon}),(0,Ie.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:A.name}),(0,Ie.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Are you sure you want to send this gift to the room owner?"})]})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:N,color:"inherit",children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:async()=>{if(s&&A&&o&&t){D(!0);try{await(0,d.gS)((0,d.rJ)(a.db,"sideRooms",o,"gifts"),{giftId:A.id,giftType:A.type,giftName:A.name,senderId:s.uid,senderName:s.displayName||"Anonymous",receiverId:t,timestamp:d.Dc.now(),value:A.value});const e=(0,d.H9)(a.db,"users",t);await(0,d.mZ)(e,{giftCount:(0,d.GV)(1),giftValue:(0,d.GV)(A.value)}),F(!1),D(!1),G(A),z(!0)}catch(e){console.error("Error sending gift:",e),D(!1)}}},variant:"contained",color:"primary",disabled:P,sx:{bgcolor:null===A||void 0===A?void 0:A.color,"&:hover":{bgcolor:(0,V.X4)((null===A||void 0===A?void 0:A.color)||"#000",.8)}},children:"Send Gift"})]})]})]})};var mo=t(3125),ho=t(9919),xo=t(2917),po=t(2289),vo=t(8692),go=t(4066);const fo=e=>{let{rank:o}=e;const t=()=>{switch(o){case 1:return"#FFD700";case 2:return"#C0C0C0";case 3:return"#CD7F32";default:return"#A0A0A0"}};return(0,Ie.jsx)(U.A,{icon:(()=>{switch(o){case 1:return(0,Ie.jsx)(po.A,{fontSize:"small"});case 2:case 3:return(0,Ie.jsx)(je.A,{fontSize:"small"});default:return(0,Ie.jsx)(Ce.A,{fontSize:"small"})}})(),label:"#".concat(o),size:"small",sx:{bgcolor:(0,V.X4)(t(),.15),color:t(),border:"1px solid ".concat(t()),fontWeight:"bold","& .MuiChip-icon":{color:t()}}})},bo=e=>{let{roomId:o,roomOwnerId:t,theme:r,roomStyle:i}=e;const[l,c]=(0,n.useState)([]),[m,h]=(0,n.useState)(!0),[x,g]=(0,n.useState)("all"),[f,b]=(0,n.useState)("all"),[y,A]=(0,n.useState)(new Set);(0,n.useEffect)((()=>{t&&(async()=>{try{let n;if(h(!0),"room"===f){const e=(0,d.rJ)(a.db,"sideRooms",o,"gifts");let r=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d.My)("timestamp","desc"));if("all"!==x){const o=new Date;"month"===x?o.setMonth(o.getMonth()-1):"week"===x&&o.setDate(o.getDate()-7),r=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d._M)("timestamp",">=",o),(0,d.My)("timestamp","desc"))}n=(0,d.GG)(r)}else{const e=(0,d.Cs)(a.db,"gifts");let o=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d.My)("timestamp","desc"));if("all"!==x){const r=new Date;"month"===x?r.setMonth(r.getMonth()-1):"week"===x&&r.setDate(r.getDate()-7),o=(0,d.P)(e,(0,d._M)("receiverId","==",t),(0,d._M)("timestamp",">=",r),(0,d.My)("timestamp","desc"))}n=(0,d.GG)(o)}const i=await n,s=new Map;for(const o of i.docs){var e;const t=o.data(),n=t.senderId,i=(null===(e=t.timestamp)||void 0===e?void 0:e.toDate())||new Date,l=o.ref.path.split("/")[1];if(s.has(n)){const e=s.get(n);e.totalGifts+=1,e.totalValue+=t.value||0,i>e.lastGiftDate&&(e.lastGiftDate=i),l&&e.roomsGiftedIn&&e.roomsGiftedIn.add(l)}else try{const e=(0,d.H9)(a.db,"users",n),o=(await(0,d.x7)(e)).data();console.log("Fetched user data for ".concat(n,":"),o);const r=new Set;l&&r.add(l);let c="?";null!==o&&void 0!==o&&o.displayName?c=o.displayName.charAt(0).toUpperCase():null!==o&&void 0!==o&&o.name?c=o.name.charAt(0).toUpperCase():null!==o&&void 0!==o&&o.username?c=o.username.charAt(0).toUpperCase():t.senderName&&(c=t.senderName.charAt(0).toUpperCase());const u=(null===o||void 0===o?void 0:o.profilePic)||(null===o||void 0===o?void 0:o.photoURL)||(null===o||void 0===o?void 0:o.avatarUrl)||(null===o||void 0===o?void 0:o.avatar)||"";console.log("Avatar URL for ".concat(n,":"),u),s.set(n,{userId:n,username:(null===o||void 0===o?void 0:o.username)||(null===o||void 0===o?void 0:o.name)||t.senderName||"Unknown User",displayName:(null===o||void 0===o?void 0:o.displayName)||(null===o||void 0===o?void 0:o.name),avatar:u,totalGifts:1,totalValue:t.value||0,lastGiftDate:i,roomsGiftedIn:r})}catch(r){console.error("Error fetching user data",r);const e=new Set;l&&e.add(l),s.set(n,{userId:n,username:t.senderName||"Unknown User",avatar:"",totalGifts:1,totalValue:t.value||0,lastGiftDate:i,roomsGiftedIn:e})}}const l=Array.from(s.values()).sort(((e,o)=>{const t=o.totalValue-e.totalValue;if(0!==t)return t;if("all"===f){var r,n;const t=(null===(r=e.roomsGiftedIn)||void 0===r?void 0:r.size)||0,i=((null===(n=o.roomsGiftedIn)||void 0===n?void 0:n.size)||0)-t;if(0!==i)return i}return o.totalGifts-e.totalGifts}));c(l)}catch(r){console.error("Error fetching top gifters:",r)}finally{h(!1)}})()}),[o,t,x,f]);return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):r.palette.divider),bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(r.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Top Gifters"}),(0,Ie.jsxs)(mo.A,{value:f,exclusive:!0,onChange:(e,o)=>{null!==o&&b(o)},size:"small","aria-label":"gift scope",sx:{"& .MuiToggleButton-root":{color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary,fontSize:"0.7rem",py:.5,px:1,"&.Mui-selected":{color:(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.1)}}},children:[(0,Ie.jsxs)(ho.A,{value:"room",children:[(0,Ie.jsx)(vo.A,{fontSize:"small",sx:{mr:.5}}),"This Room"]}),(0,Ie.jsxs)(ho.A,{value:"all",children:[(0,Ie.jsx)(go.A,{fontSize:"small",sx:{mr:.5}}),"All Rooms"]})]})]}),(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[{value:"all",label:"All Time"},{value:"month",label:"This Month"},{value:"week",label:"This Week"}].map((e=>(0,Ie.jsx)(U.A,{label:e.label,clickable:!0,size:"small",color:x===e.value?"primary":"default",onClick:()=>g(e.value),sx:{bgcolor:x===e.value?(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.2):(0,V.X4)(r.palette.background.paper,.5),color:x===e.value?(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary,borderColor:x===e.value?(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main:r.palette.divider,border:"1px solid"}},e.value)))})]}),(0,Ie.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:0,bgcolor:null!==i&&void 0!==i&&i.backgroundGradient?(0,V.X4)((null===i||void 0===i?void 0:i.backgroundColor)||r.palette.background.default,.3):(0,V.X4)(r.palette.background.paper,.5),"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:(0,V.X4)(r.palette.background.paper,.1)},"&::-webkit-scrollbar-thumb":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.3),borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.5)}},children:m?(0,Ie.jsx)(P.A,{children:[...Array(5)].map(((e,o)=>(0,Ie.jsxs)(n.Fragment,{children:[(0,Ie.jsxs)(D.Ay,{children:[(0,Ie.jsx)(M.A,{children:(0,Ie.jsx)(xo.A,{variant:"circular",width:40,height:40})}),(0,Ie.jsx)(N.A,{primary:(0,Ie.jsx)(xo.A,{width:"60%"}),secondary:(0,Ie.jsx)(xo.A,{width:"40%"})}),(0,Ie.jsx)(xo.A,{variant:"rounded",width:60,height:24,sx:{ml:1}})]}),o<4&&(0,Ie.jsx)(F.A,{variant:"inset",component:"li"})]},o)))}):l.length>0?(0,Ie.jsx)(P.A,{sx:{py:0},children:l.map(((e,o)=>(0,Ie.jsxs)(n.Fragment,{children:[(0,Ie.jsxs)(D.Ay,{component:s.N_,to:"/profile/".concat(e.userId),alignItems:"center",sx:{transition:"background-color 0.2s",bgcolor:o<3?(0,V.X4)(0===o?"#FFD700":1===o?"#C0C0C0":"#CD7F32",.05):"transparent","&:hover":{bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,.1),textDecoration:"none"},textDecoration:"none"},children:[(0,Ie.jsx)(M.A,{children:(0,Ie.jsx)(v.A,{src:y.has(e.userId)?"":e.avatar,alt:e.displayName||e.username,onError:()=>{return o=e.userId,void A((e=>new Set(e).add(o)));var o},sx:{border:o<3?"2px solid ".concat(0===o?"#FFD700":1===o?"#C0C0C0":"#CD7F32"):void 0},children:(y.has(e.userId)||!e.avatar)&&(e.displayName||e.username||"?").charAt(0).toUpperCase()})}),(0,Ie.jsx)(N.A,{primary:(0,Ie.jsx)(p.A,{variant:"body2",fontWeight:o<3?"bold":"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.primary},children:e.displayName||e.username}),secondary:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5,color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:[(0,Ie.jsx)(Ce.A,{fontSize:"inherit"}),e.totalGifts," gift",1!==e.totalGifts?"s":""]}),"all"===f&&e.roomsGiftedIn&&e.roomsGiftedIn.size>1&&(0,Ie.jsx)(U.A,{size:"small",label:"".concat(e.roomsGiftedIn.size," rooms"),sx:{height:16,fontSize:"0.6rem",ml:1,bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||r.palette.secondary.main,.1),color:(null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary}})]})}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Ie.jsxs)(p.A,{variant:"body2",sx:{fontWeight:"bold",color:(null===i||void 0===i?void 0:i.accentColor)||r.palette.primary.main,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:[e.totalValue," pts"]}),(0,Ie.jsx)(fo,{rank:o+1})]})]}),o<l.length-1&&(0,Ie.jsx)(F.A,{variant:"inset",component:"li"})]},e.userId)))}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:3},children:[(0,Ie.jsx)(Ce.A,{sx:{fontSize:40,color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.5),mb:2}}),(0,Ie.jsx)(p.A,{variant:"body1",sx:{textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:"room"===f?"No gifts have been sent in this room yet":"No gifts have been sent to this creator yet"}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||r.palette.text.secondary,.5),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",mt:1},children:"Send a gift to show your appreciation!"})]})})]})},yo=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],Ao=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],Co=[12,14,16,18,20,24,28,32],jo=e=>{let{icon:o,color:t}=e;const[i,s]=(0,n.useState)({left:"".concat(80*Math.random()+10,"%"),top:"".concat(20*Math.random()+40,"%"),animationDuration:"".concat(3*Math.random()+2,"s"),opacity:1});return(0,n.useEffect)((()=>{const e=setTimeout((()=>{s((e=>(0,r.A)((0,r.A)({},e),{},{opacity:0})))}),2e3);return()=>clearTimeout(e)}),[]),(0,Ie.jsx)(u.A,{sx:(0,r.A)({position:"fixed",fontSize:"28px",color:t,pointerEvents:"none",zIndex:1e3,transition:"opacity 1s ease-out",animation:"float-around 3s ease-out forwards","@keyframes float-around":{"0%":{transform:"scale(0.5) rotate(0deg) translate(0, 0)"},"25%":{transform:"scale(1.2) rotate(10deg) translate(20px, -30px)"},"50%":{transform:"scale(1.4) rotate(-5deg) translate(-15px, -60px)"},"75%":{transform:"scale(1.1) rotate(15deg) translate(25px, -90px)"},"100%":{transform:"scale(0.8) rotate(-10deg) translate(0, -120px)"}}},i),children:o})},wo=e=>{let{handleHeartRoom:o,handleHeartbreakRoom:t,currentUserHearted:r,currentUserHeartbroken:n,roomHeartCount:i,roomHeartbreakCount:s,isHearting:l,isHeartbreaking:a,accentColor:d,textColor:c}=e;const v=(0,m.A)();return(0,Ie.jsxs)(u.A,{sx:{position:"fixed",right:20,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:1,backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)",borderRadius:2,padding:1,zIndex:100,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(h.A,{title:r?"Unheart Room":"Heart Room",children:(0,Ie.jsx)(x.A,{onClick:o,color:r?"error":"inherit",sx:{color:r?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:l,children:r?(0,Ie.jsx)(_.A,{}):(0,Ie.jsx)(Y.A,{})})}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:i||0})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(h.A,{title:n?"Remove Heartbreak":"Heartbreak Room",children:(0,Ie.jsx)(x.A,{onClick:t,color:n?"error":"inherit",sx:{color:n?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:a,children:n?(0,Ie.jsx)(J.A,{}):(0,Ie.jsx)(Z.A,{})})}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:s||0})]})]})},So=()=>{var e,o,t,s,B,L,X,V;const{roomId:Y}=(0,i.g)(),Z=(0,i.Zp)(),{currentUser:Ce,blockUser:je}=(0,l.As)(),we=(0,m.A)(),[Se,ke]=(0,n.useState)(null),[Re,Pe]=(0,n.useState)(!1),[He,We]=(0,n.useState)(!0),[Be,Le]=(0,n.useState)(null),[Xe,Ve]=(0,n.useState)(!1),[_e,Ye]=(0,n.useState)(!1),[Je,Ze]=(0,n.useState)(""),[qe,Ke]=(0,n.useState)(!1),[Qe,$e]=(0,n.useState)(!1),[eo,oo]=(0,n.useState)(!1),[to,ro]=(0,n.useState)(!1),[no,io]=(0,n.useState)(null),[so,lo]=(0,n.useState)([]),[ao,co]=(0,n.useState)(null),[uo,mo]=((0,n.useRef)(null),(0,n.useState)(null)),[ho,xo]=(0,n.useState)(null),[po,vo]=(0,n.useState)(null),[go,fo]=(0,n.useState)(!1),[bo,So]=(0,n.useState)(!1),[Ro,Io]=(0,n.useState)(0),[Eo,Fo]=(0,n.useState)(!1),[Uo,Po]=(0,n.useState)(null),Do=(0,n.useRef)(null),[To,zo]=(0,n.useState)(0),[Oo,Go]=(0,n.useState)(!1),[Ho,Wo]=(0,n.useState)(!1),[Mo,No]=(0,n.useState)(!1),[Bo,Lo]=(0,n.useState)(""),[Xo,Vo]=(0,n.useState)(null),[_o,Yo]=(0,n.useState)(""),[Jo,Zo]=(0,n.useState)([]),[qo,Ko]=(0,n.useState)(!1),[Qo,$o]=(0,n.useState)(null),[et,ot]=(0,n.useState)(!1),tt=(0,n.useRef)(null),[rt,nt]=(0,n.useState)(null),[it,st]=(0,n.useState)(!1),[lt,at]=(0,n.useState)([]),[dt,ct]=(0,n.useState)(""),[ut,mt]=(0,n.useState)(!1),ht=(0,n.useRef)(null),[xt,pt]=(0,n.useState)(""),[vt,gt]=(0,n.useState)(!1),[ft,bt]=(0,n.useState)(30),[yt,At]=(0,n.useState)(!1),[Ct,jt]=(0,n.useState)(yo[0].name),[wt,St]=(0,n.useState)(!1),[kt,Rt]=(0,n.useState)(!1),[It,Et]=(0,n.useState)(Ao[0]),[Ft,Ut]=(0,n.useState)(Co[2]),[Pt,Dt]=((0,n.useRef)(null),(0,n.useState)(!1)),[Tt,zt]=(0,n.useState)(!1),[Ot,Gt]=(0,n.useState)(window.innerWidth>1024),[Ht,Wt]=(0,n.useState)(null),[Mt,Nt]=(0,n.useState)(!1),[Bt,Lt]=(0,n.useState)(null),[Xt,Vt]=(0,n.useState)(null),_t=(0,n.useRef)([]),[Yt,Jt]=(0,n.useState)(!1),[Zt,qt]=(0,n.useState)(null),Kt="youtube-player-placeholder",[Qt,$t]=(0,n.useState)(!1),[er,or]=(0,n.useState)(null),[tr,rr]=(0,n.useState)([]),[nr,ir]=(0,n.useState)([]),[sr,lr]=(0,n.useState)(!1),[ar,dr]=(0,n.useState)(!1),[cr,ur]=(0,n.useState)([]),mr=(0,n.useCallback)((()=>{po&&(console.log("Camera state before toggle:",po.camera.state),"enabled"!==po.camera.state.status?(c.oR.loading("Enabling camera..."),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((e=>(console.log("Camera access granted:",e),e.getTracks().forEach((e=>e.stop())),po.camera.enable()))).then((()=>{Jt(!0),c.oR.dismiss(),c.oR.success("Camera enabled")})).catch((e=>{console.error("Error enabling camera:",e),c.oR.dismiss(),c.oR.error("Could not enable camera. Please check camera permissions in your browser settings.")}))):po.camera.disable().then((()=>{Jt(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)})))}),[po]),hr=(0,n.useRef)(0),xr=(0,n.useRef)(0),pr=(0,n.useRef)(0);(0,n.useEffect)((()=>{const e=()=>{Gt(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,n.useEffect)((()=>{if(po){const e="enabled"===po.camera.state.status;Jt(e);const o=setInterval((()=>{const e="enabled"===po.camera.state.status;Jt(e)}),1e3);return()=>{clearInterval(o)}}}),[po]),(0,n.useEffect)((()=>{po&&navigator.mediaDevices.getUserMedia({video:!0}).then((()=>{console.log("Camera permissions granted")})).catch((e=>{console.error("Camera permission denied:",e),c.oR.error("Camera permissions denied. You won't be able to share video.")}))}),[po]),(0,n.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,Oe.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),nt(o)})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),nt(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),nt(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),nt(null)}}),[]),(0,n.useEffect)((()=>{if(eo)if(null!==Se&&void 0!==Se&&Se.style){const e=Se.style,o=yo.find((o=>o.name===e.themeName));jt(o?e.themeName:yo[0].name);const t=o||yo[0];St(void 0!==e.headerGradient?e.headerGradient:t.headerGradient||!1),Rt(void 0!==e.backgroundGradient?e.backgroundGradient:t.backgroundGradient||!1),Et(Ao.includes(e.font)?e.font:Ao[0]),Ut(Co.includes(e.headerFontSize)?e.headerFontSize:Co[2])}else jt(yo[0].name),St(yo[0].headerGradient||!1),Rt(yo[0].backgroundGradient||!1),Et(Ao[0]),Ut(Co[2])}),[eo,Se]),(0,n.useEffect)((()=>{if(!Y||!a.db||0===so.length)return;const e=so.filter((e=>e.isOnline)).length,o=Date.now(),t=o-xr.current;if(e!==hr.current&&t>1e4){console.log("[Active Users Update] Updating count from ".concat(hr.current," to ").concat(e));const t=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(t,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{hr.current=e,xr.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}hr.current=e}),[Y,a.db,so.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===Ce||void 0===Ce?void 0:Ce.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===Se||void 0===Se?void 0:Se.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===Se||void 0===Se?void 0:Se.viewers)||"null/undefined");const vr=(0,n.useMemo)((()=>{if(null===Ce||void 0===Ce||!Ce.uid||null===Se||void 0===Se||!Se.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=Ce.uid===Se.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===Ce||void 0===Ce?void 0:Ce.uid,null===Se||void 0===Se?void 0:Se.ownerId]),gr=(0,n.useMemo)((()=>{if(null===Se||void 0===Se||!Se.viewers||null===Ce||void 0===Ce||!Ce.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=Se.viewers.some((e=>e.userId===Ce.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===Se||void 0===Se?void 0:Se.viewers,null===Ce||void 0===Ce?void 0:Ce.uid]),fr=!!Se&&(vr||!0),br=(0,n.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",so);const e=new Map;so.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[so]),yr=(0,n.useMemo)((()=>{if(!Se||!Se.viewers||!Array.isArray(Se.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(Se.viewers,null,2));const e=Se.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[Se]),Ar=(0,n.useCallback)((async()=>{if(null!==Se&&void 0!==Se&&Se.bannedUsers&&0!==Se.bannedUsers.length)try{const e=await Promise.all(Se.bannedUsers.map((async e=>{try{const o=await(0,d.x7)((0,d.H9)(a.db,"users",e));if(o.exists()){const t=o.data();return{id:e,username:t.username||"Unknown User",name:t.name,profilePic:t.profilePic}}return{id:e,username:"Unknown User",name:"Unknown",profilePic:""}}catch(Be){return console.error("Error fetching user data for ".concat(e,":"),Be),{id:e,username:"Unknown User",name:"Unknown",profilePic:""}}})));ur(e)}catch(Be){console.error("Error loading banned users:",Be),c.oR.error("Failed to load banned users")}else ur([])}),[null===Se||void 0===Se?void 0:Se.bannedUsers,a.db]),Cr=(0,n.useCallback)((async(e,o)=>{if(vr&&Y&&window.confirm("Are you sure you want to unban ".concat(o,"? They will be able to rejoin the room.")))try{const t=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(t,{bannedUsers:(0,d.C3)(e),lastActive:(0,d.O5)()}),ur((o=>o.filter((o=>o.id!==e)))),c.oR.success("".concat(o," has been unbanned"))}catch(Be){console.error("Error unbanning user:",Be),c.oR.error("Failed to unban user")}}),[vr,Y,a.db]);(0,n.useEffect)((()=>{ar&&Ar()}),[ar,Ar]);const jr=(0,n.useCallback)((async(e,o,t,r,n)=>{if(!e||null===o||void 0===o||!o.uid||!n)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var s,l;const a=(0,d.H9)(t,"users",i),c=await(0,d.x7)(a);let u="",m="",h=(null===(s=o.email)||void 0===s?void 0:s.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let x="viewer";r?x="owner":null!==(l=n.viewers)&&void 0!==l&&l.some((e=>e.userId===i&&"guest"===e.role))&&(x="guest");const p=(0,d.H9)(t,"sideRooms",e,"presence",i),v={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:x,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(v,null,2)),await(0,d.BN)(p,v,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(a){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),a)}}),[]);(0,n.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(fr,", CurrentUserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid,", IsRoomOwner: ").concat(vr,", RoomExists: ").concat(!!Se)),fr&&Y&&Ce&&Se?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(Ce.uid," in room ").concat(Y,".")),jr(Y,Ce,a.db,vr,Se)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(fr,", RoomId: ").concat(!!Y,", CurrentUser: ").concat(!!Ce,", Room: ").concat(!!Se))}),[Y,Ce,a.db,vr,Se,fr,jr]),(0,n.useEffect)((()=>{const e=null===Ce||void 0===Ce?void 0:Ce.uid,o=Y;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const t=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(t,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[Y,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]);const wr=()=>{No(!0)},Sr=()=>{No(!1),Lo("")},kr=()=>{if(!Y)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!vr)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),Vo(null),c.oR.success("Shared video cleared.")};(0,n.useEffect)((()=>{if(null===Ce||void 0===Ce||!Ce.uid||!Y||!fr||uo)return;(async()=>{try{console.log("[Stream] Fetching token for user:",Ce.uid),console.log("[Stream] Data being sent - User ID:",Ce.uid),console.log("[Stream] Data being sent - Display Name:",Ce.displayName),console.log("[Stream] Data being sent - Photo URL:",Ce.photoURL);const t="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(t));const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:Ce.uid,userName:Ce.displayName||Ce.email||"UnknownUser",userImage:Ce.photoURL||void 0})});console.log("[Stream] Response status: ".concat(r.status));const n={};if(r.headers.forEach(((e,o)=>{n[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(n,null,2)),!r.ok){var e;let t={error:"HTTP error! Status: ".concat(r.status)};try{const e=await r.text();console.log("[Stream] Non-OK response body (text):",e),t=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),t.error=r.statusText||t.error}throw new Error((null===(e=t)||void 0===e?void 0:e.error)||"HTTP status ".concat(r.status))}const{token:i}=await r.json();if(!i)throw new Error("Stream token was not provided by backend.");mo(i),console.log("[Stream] Token fetched successfully.")}catch(Be){console.error("[Stream] Error fetching token:",Be),c.oR.error("Stream Token Error: ".concat(Be.message||"Load failed")),mo(null)}})()}),[Ce,Y,fr,uo]),(0,n.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!uo||null===Ce||void 0===Ce||!Ce.uid||ho)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!uo,", currentUser=").concat(!(null===Ce||void 0===Ce||!Ce.uid),", apiKey=").concat(!0,", clientExists=").concat(!!ho));console.log("[Stream] Initializing StreamVideoClient with token.");const t=(null===(e=Ce.profile)||void 0===e?void 0:e.name)||Ce.displayName||Ce.email||Ce.uid,r=(null===(o=Ce.profile)||void 0===o?void 0:o.profilePic)||Ce.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(t,", photoURL: ").concat(r));const n={id:Ce.uid,name:t,image:r};try{const e=new Fe.Hq({apiKey:"2nufecjmzmzh",user:n,token:uo});xo(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(Be){console.error("[Stream] Error initializing StreamVideoClient:",Be),c.oR.error("Failed to initialize Stream video client: ".concat(Be instanceof Error?Be.message:String(Be)))}return()=>{ho&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),xo(null))}}),[uo,Ce,ho]),(0,n.useEffect)((()=>{if(!bo||!ho||!Y||null===Ce||void 0===Ce||!Ce.uid)return void(bo&&So(!1));if(po)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void So(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(Y)),fo(!0);try{const e=ho.call("default",Y);if(await e.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(e.cid)),vo(e),vr&&Y&&a.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(Be){console.error("[Stream Call] Error joining or creating call:",Be),c.oR.error("Failed to connect to audio: ".concat(Be.message||"Unknown error")),vo(null)}finally{fo(!1),So(!1)}})(),()=>{So(!1)}}),[bo,ho,Y,null===Ce||void 0===Ce?void 0:Ce.uid,po]),(0,n.useEffect)((()=>()=>{po&&(console.log("[Stream Call] Leaving active call ".concat(po.cid," on component unmount or room change.")),po.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(po.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(po.cid,":"),e))).finally((()=>{if(vo(null),vr&&Y&&a.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[po,Y,vr,a.db]),(0,n.useEffect)((()=>{if(!Y||!Ce)return;const e=(0,d.H9)(a.db,"sideRooms",Y),o=(0,d.aQ)(e,(e=>{if(e.exists()){const t=(0,r.A)({id:e.id},e.data());if((t.bannedUsers||[]).includes(Ce.uid))return Le("You have been banned from this room"),ke(null),We(!1),c.oR.error("You have been banned from this room by the owner"),void Z("/side-rooms");if(ke(t),Io(t.heartCount||0),We(!1),t.isPrivate&&t.password&&t.ownerId!==Ce.uid){var o;(null===(o=t.viewers)||void 0===o?void 0:o.some((e=>e.userId===Ce.uid&&"guest"!==e.role)))||Ye(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(Y,"' reported as non-existent. Current error: '").concat(Be,"'. Setting room state to null.")),Le("Room not found"),ke(null),We(!1)}));let t;if(null!==Ce&&void 0!==Ce&&Ce.uid){const e=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",Ce.uid);t=(0,d.aQ)(e,(e=>{Fo(e.exists())}))}const n=(0,d.P)((0,d.rJ)(a.db,"sideRooms",Y,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(n,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===Ce||void 0===Ce?void 0:Ce.uid)&&o.username&&(Po("".concat(o.username," hearted the room!")),Do.current&&clearTimeout(Do.current),Do.current=setTimeout((()=>{Po(null)}),3e3))}}))}));return()=>{o(),t&&t(),i(),Do.current&&clearTimeout(Do.current)}}),[Y,Ce]),(0,n.useEffect)((()=>{if(!Y||!a.db||null===Ce||void 0===Ce||!Ce.uid)return;const e=(0,d.H9)(a.db,"sideRooms",Y),o=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",Ce.uid),t=(0,d.aQ)(e,(e=>{if(e.exists()){const o=e.data();zo(o.heartbreakCount||0)}})),r=(0,d.aQ)(o,(e=>{Go(e.exists())}));return()=>{t(),r()}}),[Y,a.db,null===Ce||void 0===Ce?void 0:Ce.uid]),(0,n.useEffect)((()=>{if(tr.length>0){const e=setTimeout((()=>{rr((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[tr]),(0,n.useEffect)((()=>{if(nr.length>0){const e=setTimeout((()=>{ir((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[nr]);const Rr=async e=>{if(!a.db||!e)return null;try{const o=(0,d.rJ)(a.db,"rooms"),t=(0,d.P)(o,(0,d._M)("createdBy","==",e),(0,d._M)("type","==","public")),r=await(0,d.GG)(t);if(!r.empty){const e=r.docs[0];return{id:e.id,name:e.data().name||"Chat Room"}}return null}catch(Be){return console.error("[SideRoomComponent] Error checking for server chat room:",Be),null}};(0,n.useEffect)((()=>{if(null===Ce||void 0===Ce||!Ce.uid||null===Se||void 0===Se||!Se.ownerId)return;(async()=>{try{const e=(0,d.H9)(a.db,"users",Se.ownerId),o=await(0,d.x7)(e);if(!(o.exists()&&!0===o.data().isPrivate))return;const t=(0,d.H9)(a.db,"users",Ce.uid,"following",Se.ownerId),r=(0,d.H9)(a.db,"users",Se.ownerId,"followRequests",Ce.uid),[n,i]=await Promise.all([(0,d.x7)(t),(0,d.x7)(r)]);if(n.exists()&&!i.exists()){const e=await Rr(Se.ownerId);e&&(or(e),$t(!0))}}catch(Be){console.error("Error checking follow status:",Be)}})();const e=(0,d.H9)(a.db,"users",Ce.uid,"following",Se.ownerId),o=(0,d.aQ)(e,(e=>{e.exists()&&Rr(Se.ownerId).then((e=>{e&&(or(e),$t(!0))}))}));return()=>o()}),[Ce,Se,a.db,Z,Rr]),(0,n.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(fr,", CurrentUserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid)),!Y||!fr||null===Ce||void 0===Ce||!Ce.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(Y,", HasAccess: ").concat(fr,", UserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid)),void lo([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(Y));const e=(0,d.rJ)(a.db,"sideRooms",Y,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,r.A)({userId:e.id},e.data()))),t=Date.now();let n=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&t-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((t-e.lastSeen)/1e3)," seconds old).")),!n&&a.db&&e.userId!==(null===Ce||void 0===Ce?void 0:Ce.uid)){const o=(0,d.H9)(a.db,"sideRooms",Y,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),n=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),lo(i);const s=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(s))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),lo([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(Y,".")),o()}}),[Y,fr,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]),(0,n.useEffect)((()=>{const e=null===Ce||void 0===Ce?void 0:Ce.uid,o=Y;return()=>{if(e&&o&&a.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const t=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(t,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[Y,null===Ce||void 0===Ce?void 0:Ce.uid,a.db]),(0,n.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(Y,", HasAccess: ").concat(fr,", CurrentUserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid,", IsRoomOwner: ").concat(vr,", RoomExists: ").concat(!!Se)),!Y||null===Ce||void 0===Ce||!Ce.uid||!Se||!fr){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(Y,", UserUID: ").concat(null===Ce||void 0===Ce?void 0:Ce.uid,", HasAccess: ").concat(fr,", RoomExists: ").concat(!!Se)),null!==Ce&&void 0!==Ce&&Ce.uid&&Y){const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",Ce.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(Ce.uid," in room ").concat(Y)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(Ce.uid,":"),e)}))}return}const e=Ce.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(Y,"."));let o=null;return(async()=>{try{var t,r;const n=(0,d.H9)(a.db,"users",e),i=await(0,d.x7)(n);let s="",l="",c=(null===(t=Ce.email)||void 0===t?void 0:t.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();s=o.name||o.username||"",l=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(s,"', Pic='").concat(l,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),s=Ce.displayName||"",l=Ce.photoURL||"";let u="viewer";vr?u="owner":null!==(r=Se.viewers)&&void 0!==r&&r.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(a.db,"sideRooms",Y,"presence",e),h={userId:e,username:c,avatar:l,lastSeen:Date.now(),isOnline:!0,role:u,displayName:s,photoURL:l},x="sideRooms/".concat(Y,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",x,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-pr.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),pr.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(Be){console.error("[Presence Heartbeat] Error updating heartbeat:",Be)}}),6e4))}catch(n){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),n)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(Y,". Setting offline."));const t=(0,d.H9)(a.db,"sideRooms",Y,"presence",e);(0,d.mZ)(t,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[Y,Ce,a.db,vr,Se,fr]),(0,n.useEffect)((()=>{if(Y)return()=>{}}),[Y]),(0,n.useEffect)((()=>{Se&&Se.currentSharedVideoUrl?Vo(Se.currentSharedVideoUrl):Se&&!Se.currentSharedVideoUrl&&Vo(null)}),[Se]),(0,n.useEffect)((()=>{if(!rt)return;const e=e=>{c.oR.success(e.message),ot(!1),Yo(""),$o(null),Zo([]),$e(!1)},o=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),ot(!1)},t=e=>{e.roomId===Y&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},r=e=>{e.error?(c.oR.error(e.error),Zo([])):Zo(e.users)},n=e=>{const o="string"===typeof e?e:e.roomId,t="object"===typeof e?e.reason:"removed";if(o===Y&&null!==Ce&&void 0!==Ce&&Ce.uid){let e="The host has removed you from the room.";"blocked"===t&&(e="You have been blocked by the room owner and removed from the room."),c.oR.error(e),null===po||void 0===po||po.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{Z("/side-rooms")}))}},i=e=>{e.roomId===Y&&null!==Ce&&void 0!==Ce&&Ce.uid&&(c.oR.error("You have been banned from this room. ".concat(e.reason||"")),null===po||void 0===po||po.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being banned:",e))).finally((()=>{Z("/side-rooms")})))},s=e=>{e.roomId===Y&&e.targetUserId===(null===Ce||void 0===Ce?void 0:Ce.uid)&&po&&(console.log("[SideRoomComponent] Received force-mute from room owner"),po.microphone.disable().then((async()=>{try{const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",Ce.uid);await(0,d.mZ)(e,{forceMuted:!0})}catch(Be){console.error("[SideRoomComponent] Error updating presence after force-mute:",Be)}c.oR.error("You have been muted by the room owner"),console.log("[SideRoomComponent] Successfully muted user via force-mute")})).catch((e=>{console.error("[SideRoomComponent] Error force-muting user:",e),c.oR.error("Failed to mute microphone")})))},l=e=>{e.roomId===Y&&e.targetUserId===(null===Ce||void 0===Ce?void 0:Ce.uid)&&po&&(console.log("[SideRoomComponent] Received force-unmute from room owner"),po.microphone.enable().then((async()=>{try{const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",Ce.uid);await(0,d.mZ)(e,{forceMuted:!1})}catch(Be){console.error("[SideRoomComponent] Error updating presence after force-unmute:",Be)}c.oR.success("You have been unmuted by the room owner"),console.log("[SideRoomComponent] Successfully unmuted user via force-unmute")})).catch((e=>{console.error("[SideRoomComponent] Error force-unmuting user:",e),c.oR.error("Failed to unmute microphone")})))};return rt.on("invite-success",e),rt.on("invite-failed",o),rt.on("guest-joined",t),rt.on("user-search-results-for-invite",r),rt.on("force-remove",n),rt.on("force-ban",i),rt.on("force-mute",s),rt.on("force-unmute",l),()=>{rt.off("invite-success",e),rt.off("invite-failed",o),rt.off("guest-joined",t),rt.off("user-search-results-for-invite",r),rt.off("force-remove",n),rt.off("force-ban",i),rt.off("force-mute",s),rt.off("force-unmute",l)}}),[rt,Y,Z,po,null===Ce||void 0===Ce?void 0:Ce.uid]);const Ir=(0,n.useCallback)((0,ze.debounce)((e=>{e.trim().length>=2&&(rt?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),rt.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[rt]),Er=(0,n.useCallback)((()=>{ro(!0)}),[]),Fr=(0,n.useCallback)((e=>{io(e.currentTarget)}),[]),Ur=(0,n.useCallback)((()=>{io(null)}),[]),Pr=(0,n.useCallback)((()=>{Ke(!0),Ur()}),[Ur]),Dr=(0,n.useCallback)((()=>{oo(!0),Ur()}),[Ur]),Tr=(0,n.useCallback)((()=>{$e(!0),Yo(""),$o(null),Zo([]),Ko(!1),Ur()}),[Ur]),zr=(0,n.useCallback)((async()=>{if(ot(!0),rt&&null!==Ce&&void 0!==Ce&&Ce.uid&&Y&&null!==Qo&&void 0!==Qo&&Qo.username){console.log("Emitting invite-user-to-room: ".concat(Qo.username));try{var e;const o=(0,d.P)((0,d.rJ)(a.db,"users"),(0,d._M)("username","==",Qo.username)),t=await(0,d.GG)(o);if(t.empty)return c.oR.error("User not found."),void ot(!1);t.docs[0].data();const r=t.docs[0].id,n=(0,d.H9)(a.db,"sideRooms",Y),i=await(0,d.x7)(n);if(!i.exists())return c.oR.error("Room not found."),void ot(!1);const s=i.data();if(null===(e=s.viewers)||void 0===e?void 0:e.some((e=>e.userId===r)))return c.oR.error("".concat(Qo.username," is already in this room.")),void ot(!1);rt.emit("invite-user-to-room",{roomId:Y,inviterId:Ce.uid,inviteeUsername:Qo.username})}catch(Be){console.error("Error checking if user is in room:",Be),rt.emit("invite-user-to-room",{roomId:Y,inviterId:Ce.uid,inviteeUsername:Qo.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!rt,currentUser:!(null===Ce||void 0===Ce||!Ce.uid),roomId:Y,selectedInviteeForInvite:Qo}),c.oR.error("Cannot send invite: connection or user data issue."),ot(!1)}),[null===Ce||void 0===Ce?void 0:Ce.uid,Y,Qo,rt,a.db]),Or=(0,n.useCallback)((async()=>{if(Y&&vr&&(Ur(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){Ve(!0);try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),Z("/side-rooms")}catch(Be){console.error("Error deleting room:",Be),c.oR.error("Failed to delete room")}finally{Ve(!1)}}}),[Y,vr,Z]),Gr=(0,n.useCallback)((async(e,o)=>{if(!vr||!Y||e===(null===Ce||void 0===Ce?void 0:Ce.uid)||!rt)return;console.log("Owner toggling force-mute for ".concat(e,". Currently force-muted: ").concat(o));const t=!o,r=(0,d.H9)(a.db,"sideRooms",Y,"presence",e);try{await(0,d.mZ)(r,{forceMuted:t}),t?(rt.emit("force-mute",{roomId:Y,targetUserId:e}),console.log("[SideRoomComponent] Emitted force-mute for user ".concat(e))):(rt.emit("force-unmute",{roomId:Y,targetUserId:e}),console.log("[SideRoomComponent] Emitted force-unmute for user ".concat(e))),c.oR.success("User ".concat(t?"muted":"unmuted","."))}catch(Be){console.error("Error toggling force-mute for ".concat(e,":"),Be),c.oR.error("Failed to update mute status.")}}),[vr,Y,null===Ce||void 0===Ce?void 0:Ce.uid,a.db,rt]),Hr=(0,n.useCallback)(((e,o,t)=>{if(!vr||!Y||e===(null===Ce||void 0===Ce?void 0:Ce.uid)||!rt)return;const r=o||"this user",n="blocked"===t;(n||window.confirm("Are you sure you want to remove ".concat(r," from the room?")))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(Y," - reason: ").concat(t||"removed")),rt.emit("force-remove",{roomId:Y,targetUserId:e,reason:t||"removed"}),n||c.oR.success("Removing ".concat(r,"...")))}),[vr,Y,null===Ce||void 0===Ce?void 0:Ce.uid,rt]),Wr=(0,n.useCallback)((async(e,o)=>{if(!vr||!Y||e===(null===Ce||void 0===Ce?void 0:Ce.uid))return;const t=o||"this user";if(window.confirm("Are you sure you want to ban ".concat(t,"? They will be banned from this room and cannot rejoin.")))try{const o=(0,d.H9)(a.db,"sideRooms",Y),r=await(0,d.x7)(o);if(r.exists()){const n=r.data();if((n.bannedUsers||[]).includes(e))c.oR.error("".concat(t," is already banned from this room"));else{await(0,d.mZ)(o,{bannedUsers:(0,d.hq)(e),lastActive:(0,d.O5)()});const r=(n.viewers||[]).filter((o=>o.userId!==e));await(0,d.mZ)(o,{viewers:r}),console.log("[SideRoomComponent] User ".concat(e," banned from room ").concat(Y)),rt&&rt.emit("force-ban",{roomId:Y,targetUserId:e,reason:"Banned by room owner"}),c.oR.success("".concat(t," has been banned from the room"))}}else c.oR.error("Room not found")}catch(Be){console.error("Error banning user:",Be),c.oR.error("Failed to ban user")}}),[vr,Y,null===Ce||void 0===Ce?void 0:Ce.uid,rt,a.db]),Mr=()=>{setTimeout((()=>{var e;null===(e=ht.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,n.useEffect)((()=>{it&&Mr()}),[lt,it,xt]),(0,n.useEffect)((()=>{if(!vt||!xt)return;let e=0;const o=xt,t=()=>{e<o.length?(at((t=>{const n=[...t];if(n.length>0&&"ai"===n[n.length-1].sender){const t=n[n.length-1];n[n.length-1]=(0,r.A)((0,r.A)({},t),{},{text:o.substring(0,e+1)})}return n})),e++,setTimeout(t,ft)):(gt(!1),pt(""))};return t(),()=>{gt(!1)}}),[vt,xt,ft]);const Nr=e=>{at((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,t)=>t===e.length-1?(0,r.A)((0,r.A)({},o),{},{text:""}):o))})),pt(e),gt(!0)};(0,n.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?at(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(Be){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",Be),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,n.useEffect)((()=>{(lt.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(lt))}),[lt]);const Br=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt).trim();if(!o)return;const t={sender:"user",text:o};at((e=>[...e,t])),ct(""),mt(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const t="https://sideeye-backend-production.up.railway.app";if(!t)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),Nr("Configuration error: Backend URL not set."),void mt(!1);const n="".concat(t,"/api/sade-ai");if(null===Ce||void 0===Ce||!Ce.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),Nr("Error: Could not identify user."),void mt(!1);at((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),s=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),l={message:o,forceSearch:e,userId:Ce.uid,contextFlags:{avoidAppInstructions:i&&!s,isGreeting:i,isInstructionQuery:s,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",l);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)},d=await fetch(n,a);if(at((e=>e.filter(((o,t)=>t!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(r){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(at((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),Nr(c.response)):Nr(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),Nr("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),Nr("Sorry, I got a bit confused there."))}catch(n){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",n),at((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),Nr("Sorry, there was an error: ".concat(n.message||"Unknown error"))}finally{mt(!1),Mr()}};(0,n.useEffect)((()=>{const e=Xo?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(Xo):null,o=()=>{if(Zt&&(Zt.destroy(),qt(null)),e&&document.getElementById(Kt)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(Kt,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});qt(o)}else!e&&Zt&&(Zt.destroy(),qt(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{Zt&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),Zt.destroy(),qt(null))}}),[Xo]);const Lr=e=>(0,Ie.jsx)("div",{id:Kt,style:{width:"100%",height:"100%"}}),Xr=((0,n.useCallback)((async()=>{if(po)if(Ot)try{await po.screenShare.toggle();const e=po.screenShare.enabled;zt(e),e?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(Be){console.error("Error toggling screen share:",Be),c.oR.error("Failed to toggle screen sharing: ".concat(Be.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[po,Ot]),Se?"".concat(Se.name," - SideEye"):He?"Loading Room...":"Room Not Found - SideEye"),Vr=Se&&Se.description||"Join the conversation on SideEye.",_r="".concat(window.location.origin,"/default-app-logo.png"),Yr=(null===Se||void 0===Se?void 0:Se.thumbnailUrl)||_r,Jr="".concat(window.location.origin,"/side-room/").concat(Y||"");if(He&&!Se)return(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(Te.mg,{children:(0,Ie.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,Ie.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,Ie.jsx)(A.A,{})})]});if(Be&&!Se)return(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(Te.mg,{children:(0,Ie.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,Ie.jsxs)(u.A,{sx:{p:3,textAlign:"center"},children:[(0,Ie.jsx)(C.A,{severity:"error",children:Be}),(0,Ie.jsxs)(y.A,{onClick:()=>Z("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const Zr=async()=>{if(Se&&Je&&Ce){Ve(!0);try{if(Se.password===Je){const e=(0,d.H9)(a.db,"sideRooms",Y),o=await(0,d.x7)(e),t=o.data().viewers||[];t.some((e=>e.userId===Ce.uid))||await(0,d.mZ)(e,{viewers:[...t,{userId:Ce.uid,username:Ce.displayName||Ce.email||"User",role:"viewer",joinedAt:(0,d.O5)()}]}),c.oR.success("Password correct. Welcome to the room!"),Ye(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(Be){console.error("Error verifying password:",Be),c.oR.error("An error occurred. Please try again.")}finally{Ve(!1)}}else c.oR.error("Missing information. Please try again.")},qr=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))c.oR.error("Screen recording is not fully supported on mobile devices. Please use a desktop browser for this feature.");else try{var e;if(null===(e=navigator.mediaDevices)||void 0===e||!e.getDisplayMedia)return void c.oR.error("Screen recording is not supported in your browser.");const o=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),t=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaStream;o.getVideoTracks().forEach((e=>{r.addTrack(e)})),o.getAudioTracks().forEach((e=>{r.addTrack(e)})),t.getAudioTracks().forEach((e=>{r.addTrack(e)}));const n=new MediaRecorder(r,{mimeType:"video/webm"});n.ondataavailable=e=>{e.data.size>0&&_t.current.push(e.data)},n.onstop=()=>{const e=new Blob(_t.current,{type:"video/webm"}),o=URL.createObjectURL(e),t=document.createElement("a");t.style.display="none",t.href=o,t.download="sideeye-room-recording-".concat((new Date).toISOString(),".webm"),document.body.appendChild(t),t.click(),setTimeout((()=>{document.body.removeChild(t),window.URL.revokeObjectURL(o),_t.current=[]}),100),r.getTracks().forEach((e=>e.stop())),Lt(null),Vt(null),Nt(!1),c.oR.success("Recording saved to your device")},n.start(),Lt(r),Vt(n),Nt(!0),c.oR.success("Screen recording started with audio"),o.getVideoTracks()[0].onended=()=>{"inactive"!==n.state&&n.stop()}}catch(Be){console.error("Error starting screen recording:",Be),c.oR.error("Could not start screen recording. Please make sure you've granted the necessary permissions.")}},Kr=()=>{Xt&&"inactive"!==Xt.state&&Xt.stop(),Bt&&Bt.getTracks().forEach((e=>e.stop()))},Qr=()=>{$t(!1)},$r=()=>{lr(!0)};return(0,Ie.jsxs)(Ie.Fragment,{children:[tr.map((e=>(0,Ie.jsx)(jo,{icon:(0,Ie.jsx)(_.A,{}),color:we.palette.error.main},"heart-".concat(e)))),nr.map((e=>(0,Ie.jsx)(jo,{icon:(0,Ie.jsx)(J.A,{}),color:we.palette.error.main},"heartbreak-".concat(e)))),Se&&(0,Ie.jsx)(wo,{handleHeartRoom:async()=>{if(!Ce||!Ce.uid||!Y||!Se)return;rr((e=>[...e,Date.now()])),At(!0);const e=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",Ce.uid),o=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",Ce.uid),t=(0,d.H9)(a.db,"sideRooms",Y);try{await(0,d.c4)(a.db,(async r=>{var n;const i=await r.get(e),s=await r.get(o);if(!(await r.get(t)).exists())throw"Room does not exist!";const l=await(0,d.x7)((0,d.H9)(a.db,"users",Ce.uid)),c=l.exists()?(null===(n=l.data())||void 0===n?void 0:n.username)||Ce.displayName:"Someone";s.exists()&&(r.delete(o),r.update(t,{heartbreakCount:(0,d.GV)(-1)}),Go(!1)),i.exists()?(r.delete(e),r.update(t,{heartCount:(0,d.GV)(-1)})):(r.set(e,{userId:Ce.uid,username:c,timestamp:(0,d.O5)()}),r.update(t,{heartCount:(0,d.GV)(1)}))}))}catch(Be){console.error("Error hearting room:",Be),c.oR.error("Failed to update heart status.")}finally{At(!1)}},handleHeartbreakRoom:async()=>{if(!Ce||!Ce.uid||!Y||!Se)return;ir((e=>[...e,Date.now()])),Wo(!0);const e=(0,d.H9)(a.db,"sideRooms",Y,"heartbrokenBy",Ce.uid),o=(0,d.H9)(a.db,"sideRooms",Y,"heartedBy",Ce.uid),t=(0,d.H9)(a.db,"sideRooms",Y);try{await(0,d.c4)(a.db,(async r=>{var n;const i=await r.get(e),s=await r.get(o);if(!(await r.get(t)).exists())throw"Room does not exist!";const l=await(0,d.x7)((0,d.H9)(a.db,"users",Ce.uid)),c=l.exists()?(null===(n=l.data())||void 0===n?void 0:n.username)||Ce.displayName:"Someone";s.exists()&&(r.delete(o),r.update(t,{heartCount:(0,d.GV)(-1)}),Fo(!1)),i.exists()?(r.delete(e),r.update(t,{heartbreakCount:(0,d.GV)(-1)})):(r.set(e,{userId:Ce.uid,username:c,timestamp:(0,d.O5)()}),r.update(t,{heartbreakCount:(0,d.GV)(1)}))}))}catch(Be){console.error("Error heartbreaking room:",Be),c.oR.error("Failed to update heartbreak status.")}finally{Wo(!1)}},currentUserHearted:Eo,currentUserHeartbroken:Oo,roomHeartCount:Ro,roomHeartbreakCount:To,isHearting:yt,isHeartbreaking:Ho,accentColor:null===Se||void 0===Se||null===(e=Se.style)||void 0===e?void 0:e.accentColor,textColor:null===Se||void 0===Se||null===(o=Se.style)||void 0===o?void 0:o.textColor}),(0,Ie.jsxs)(Te.mg,{children:[(0,Ie.jsx)("title",{children:Xr}),(0,Ie.jsx)("meta",{name:"description",content:Vr}),(0,Ie.jsx)("meta",{property:"og:type",content:"website"}),(0,Ie.jsx)("meta",{property:"og:url",content:Jr}),(0,Ie.jsx)("meta",{property:"og:title",content:Xr}),(0,Ie.jsx)("meta",{property:"og:description",content:Vr}),(0,Ie.jsx)("meta",{property:"og:image",content:Yr}),(0,Ie.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,Ie.jsx)("meta",{property:"og:image:height",content:"630"}),(0,Ie.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,Ie.jsx)("meta",{name:"twitter:url",content:Jr}),(0,Ie.jsx)("meta",{name:"twitter:title",content:Xr}),(0,Ie.jsx)("meta",{name:"twitter:description",content:Vr}),(0,Ie.jsx)("meta",{name:"twitter:image",content:Yr})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===Se||void 0===Se||null===(t=Se.style)||void 0===t?void 0:t.font)||Ao[0],backgroundColor:null!==Se&&void 0!==Se&&null!==(s=Se.style)&&void 0!==s&&s.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Se||void 0===Se||null===(B=Se.style)||void 0===B?void 0:B.backgroundColor)||we.palette.background.default,", ").concat((null===Se||void 0===Se||null===(L=Se.style)||void 0===L?void 0:L.accentColor)||we.palette.secondary.main,")"):(null===Se||void 0===Se||null===(X=Se.style)||void 0===X?void 0:X.backgroundColor)||we.palette.background.default,color:(null===Se||void 0===Se||null===(V=Se.style)||void 0===V?void 0:V.textColor)||we.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[Se&&(()=>{var e,o,t,r,n,i,s,l,m,C,j,w,S,k,R,I,E,F,U,P,D,T;return(0,Ie.jsxs)(u.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==Se&&void 0!==Se&&null!==(e=Se.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Se||void 0===Se||null===(o=Se.style)||void 0===o?void 0:o.headerColor)||we.palette.primary.main,", ").concat((null===Se||void 0===Se||null===(t=Se.style)||void 0===t?void 0:t.accentColor)||we.palette.secondary.light,")"):(null===Se||void 0===Se||null===(r=Se.style)||void 0===r?void 0:r.headerColor)||we.palette.background.paper,color:(null===Se||void 0===Se||null===(n=Se.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,Ie.jsx)(p.A,{variant:"h6",sx:{fontFamily:(null===Se||void 0===Se||null===(i=Se.style)||void 0===i?void 0:i.font)||Ao[0],fontSize:null!==Se&&void 0!==Se&&null!==(s=Se.style)&&void 0!==s&&s.headerFontSize?"".concat(Se.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===Se||void 0===Se?void 0:Se.name}),yr&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{opacity:null!==Se&&void 0!==Se&&null!==(l=Se.style)&&void 0!==l&&l.textColor?.85:1,fontFamily:(null===Se||void 0===Se||null===(m=Se.style)||void 0===m?void 0:m.font)||Ao[0]},children:["Host: ",yr.username]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===Ce||void 0===Ce?void 0:Ce.uid)&&(null===Se||void 0===Se?void 0:Se.ownerId)&&Ce.uid!==Se.ownerId&&yr&&(0,Ie.jsx)(h.A,{title:"Follow ".concat(yr.username),children:(0,Ie.jsx)(x.A,{onClick:async()=>{if(null!==Ce&&void 0!==Ce&&Ce.uid&&null!==Se&&void 0!==Se&&Se.ownerId&&a.db)try{const e=(0,d.H9)(a.db,"users",Ce.uid,"following",Se.ownerId),o=await(0,d.x7)(e),t=(0,d.H9)(a.db,"users",Se.ownerId,"followRequests",Ce.uid),r=await(0,d.x7)(t),n=(0,d.H9)(a.db,"users",Se.ownerId),i=await(0,d.x7)(n),s=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(a.db,"users",Se.ownerId,"followers",Ce.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(yr.username))}else if(r.exists())await(0,d.kd)(t),c.oR.success("Canceled follow request to ".concat(yr.username));else if(s)await(0,d.BN)(t,{userId:Ce.uid,username:Ce.displayName||Ce.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(yr.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(a.db,"users",Se.ownerId,"followers",Ce.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(yr.username));const t=await Rr(Se.ownerId);t&&(or(t),$t(!0))}}catch(Be){console.error("Error toggling follow:",Be),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===Se||void 0===Se||null===(C=Se.style)||void 0===C?void 0:C.accentColor)||"inherit"},children:(0,Ie.jsx)(q.A,{})})}),(0,Ie.jsx)(h.A,{title:"Share",children:(0,Ie.jsx)(x.A,{onClick:Er,sx:{color:(null===Se||void 0===Se||null===(j=Se.style)||void 0===j?void 0:j.accentColor)||"inherit"},children:(0,Ie.jsx)(K.A,{})})}),(null===Ce||void 0===Ce?void 0:Ce.uid)&&(null===Se||void 0===Se?void 0:Se.ownerId)&&Ce.uid!==Se.ownerId&&(0,Ie.jsx)(h.A,{title:"Report Room",children:(0,Ie.jsx)(x.A,{onClick:$r,sx:{color:(null===Se||void 0===Se||null===(w=Se.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,Ie.jsx)(Q.A,{})})}),vr&&(0,Ie.jsx)(h.A,{title:"Share Video Link",children:(0,Ie.jsx)(x.A,{onClick:wr,size:"small",color:"secondary",children:(0,Ie.jsx)($.A,{})})}),(0,Ie.jsx)(h.A,{title:"Chat with Sade AI",children:(0,Ie.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>st(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===Se||void 0===Se||null===(S=Se.style)||void 0===S?void 0:S.accentColor)||we.palette.primary.light)}})}),Ot&&(0,Ie.jsx)(h.A,{title:Mt?"Stop Recording":"Record Room (Desktop Only)",children:(0,Ie.jsx)(x.A,{onClick:Mt?Kr:qr,color:Mt?"error":"inherit",sx:{color:Mt?we.palette.error.main:(null===Se||void 0===Se||null===(k=Se.style)||void 0===k?void 0:k.accentColor)||"inherit"},children:Mt?(0,Ie.jsx)(ee.A,{}):(0,Ie.jsx)(oe.A,{})})}),po&&(0,Ie.jsx)(h.A,{title:Yt?"Turn Camera Off":"Turn Camera On",children:(0,Ie.jsx)(x.A,{onClick:mr,sx:{color:Yt?(null===Se||void 0===Se||null===(R=Se.style)||void 0===R?void 0:R.accentColor)||we.palette.primary.main:"inherit"},children:Yt?(0,Ie.jsx)(oe.A,{}):(0,Ie.jsx)(te.A,{})})}),vr&&(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(h.A,{title:"Room Settings",children:(0,Ie.jsx)(x.A,{onClick:Fr,sx:{color:(null===Se||void 0===Se||null===(I=Se.style)||void 0===I?void 0:I.accentColor)||"inherit"},children:(0,Ie.jsx)(re.A,{})})}),(0,Ie.jsxs)(g.A,{anchorEl:no,open:Boolean(no),onClose:Ur,children:[(0,Ie.jsxs)(f.A,{onClick:Pr,children:[" ",(0,Ie.jsx)(b.A,{children:(0,Ie.jsx)(ne.A,{fontSize:"small"})}),"Edit Room"]}),(0,Ie.jsxs)(f.A,{onClick:Dr,children:[" ",(0,Ie.jsx)(b.A,{children:(0,Ie.jsx)(ie.A,{fontSize:"small"})}),"Customize"]}),(0,Ie.jsxs)(f.A,{onClick:Tr,children:[" ",(0,Ie.jsx)(b.A,{children:(0,Ie.jsx)(q.A,{fontSize:"small"})}),"Invite"]}),(0,Ie.jsxs)(f.A,{onClick:()=>{dr(!0),Ur()},children:[(0,Ie.jsx)(b.A,{children:(0,Ie.jsx)(se.A,{fontSize:"small"})}),"View Banned Users"]}),(0,Ie.jsxs)(f.A,{onClick:Or,sx:{color:"error.main"},children:[(0,Ie.jsx)(b.A,{children:(0,Ie.jsx)(le.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,Ie.jsx)(h.A,{title:"Leave Room",children:(0,Ie.jsx)(x.A,{onClick:()=>{vr?Dt(!0):Z("/side-rooms")},disabled:Xe,sx:{color:(null===Se||void 0===Se||null===(E=Se.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:(0,Ie.jsx)(ae.A,{})})})]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ie.jsxs)(p.A,{variant:"caption",sx:{fontFamily:(null===Se||void 0===Se||null===(F=Se.style)||void 0===F?void 0:F.font)||Ao[0]},children:[br.length," Online"]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!po&&ho&&fr&&(0,Ie.jsx)(y.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),po?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):So(!0)},startIcon:go?(0,Ie.jsx)(A.A,{size:20,color:"inherit"}):(0,Ie.jsx)(de.A,{}),disabled:go||!ho,sx:{backgroundColor:null===Se||void 0===Se||null===(U=Se.style)||void 0===U?void 0:U.accentColor,fontFamily:(null===Se||void 0===Se||null===(P=Se.style)||void 0===P?void 0:P.font)||Ao[0],color:null!==Se&&void 0!==Se&&null!==(D=Se.style)&&void 0!==D&&D.accentColor?we.palette.getContrastText(Se.style.accentColor):void 0},children:go?"Connecting...":"Connect Audio (Stream)"}),po&&(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(h.A,{title:"Toggle Microphone",children:(0,Ie.jsxs)(x.A,{onClick:async()=>{var e;if(null===po||void 0===po||!po.microphone||null===Ce||void 0===Ce||!Ce.uid||!Y)return;const o=so.find((e=>e.userId===Ce.uid)),t=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await po.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(t));const e=(0,d.H9)(a.db,"sideRooms",Y,"presence",Ce.uid);await(0,d.mZ)(e,{isMuted:t}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(Ce.uid," to ").concat(t))}catch(Be){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",Be),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==po&&void 0!==po&&po.microphone)||!(null!==Ce&&void 0!==Ce&&Ce.uid)||!Y,children:[(0,Ie.jsx)(ce.A,{})," "]})}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,Ie.jsx)(y.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===po||void 0===po||po.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),Z("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:go,sx:{fontFamily:(null===Se||void 0===Se||null===(T=Se.style)||void 0===T?void 0:T.font)||Ao[0]},children:"Leave Audio"})]}),!ho&&He&&(0,Ie.jsx)(A.A,{size:24})]})]})]})})(),(0,Ie.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto"},children:Se?ho?po?(0,Ie.jsx)(Ue.Mf9,{client:ho,children:(0,Ie.jsx)(Ue.xwR,{call:po,children:(0,Ie.jsx)(ko,{room:Se,isRoomOwner:vr,isGuest:gr,handleOpenShareVideoDialog:wr,handleClearSharedVideo:kr,currentVideoUrl:Xo,renderVideoPlayer:Lr,onForceMuteToggle:Gr,onForceRemove:Hr,onForceBan:Wr,theme:we,navigate:Z})})}):(0,Ie.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[Xo&&(0,Ie.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),vr&&(0,Ie.jsx)(h.A,{title:"Clear Shared Video",children:(0,Ie.jsx)(x.A,{onClick:kr,size:"small",children:(0,Ie.jsx)(ue.A,{})})})]}),(0,Ie.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Lr()})]}),(0,Ie.jsxs)(p.A,{variant:"h6",gutterBottom:!0,children:["Participants (",br.length,")"]}),(0,Ie.jsx)(j.Ay,{container:!0,spacing:2,children:br.map((e=>(0,Ie.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,Ie.jsxs)(w.A,{sx:{p:1,textAlign:"center"},children:[(0,Ie.jsx)(v.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,Ie.jsx)(p.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,Ie.jsx)(me.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!po&&!go&&fr&&(0,Ie.jsx)(C.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),go&&(0,Ie.jsx)(C.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===uo&&fr&&null!==Ce&&void 0!==Ce&&Ce.uid&&Y||null!==uo&&!ho?(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(A.A,{sx:{mb:2}}),(0,Ie.jsx)(p.A,{children:"Initializing audio components..."}),(0,Ie.jsx)(p.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!fr&&null!==Ce&&void 0!==Ce&&Ce.uid?(0,Ie.jsx)(C.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,Ie.jsx)(C.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,Ie.jsx)(y.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[He&&(0,Ie.jsx)(A.A,{}),!He&&(0,Ie.jsxs)(C.A,{severity:"error",children:["Room not found. ",(0,Ie.jsx)(y.A,{onClick:()=>Z("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,Ie.jsxs)(S.A,{open:Mo,onClose:Sr,fullWidth:!0,maxWidth:"sm",children:[(0,Ie.jsx)(k.A,{children:"Share a Video"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsx)(I.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:Bo,onChange:e=>Lo(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:Sr,children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:()=>{if(!Y)return void c.oR.error("Cannot share video: Room ID is missing.");if(!Bo.trim())return void c.oR.error("Please enter a video URL.");if(!Bo.startsWith("http://")&&!Bo.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(a.db,"sideRooms",Y);(0,d.mZ)(e,{currentSharedVideoUrl:Bo,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),Vo(Bo),c.oR.success("Video shared!"),Sr()},variant:"contained",children:"Share Video"})]})]}),(0,Ie.jsxs)(S.A,{open:to,onClose:()=>ro(!1),fullWidth:!0,maxWidth:"xs",children:[(0,Ie.jsx)(k.A,{children:"Share this Room"}),(0,Ie.jsxs)(R.A,{sx:{textAlign:"center"},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,Ie.jsx)(I.A,{fullWidth:!0,variant:"outlined",value:"".concat(window.location.origin,"/side-room/").concat(Y),InputProps:{readOnly:!0},sx:{mb:2}}),(0,Ie.jsx)(y.A,{variant:"contained",startIcon:(0,Ie.jsx)(he.A,{}),onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(Y)),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,Ie.jsx)(F.A,{sx:{my:2},children:(0,Ie.jsx)(U.A,{label:"OR"})}),(0,Ie.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share via Direct Message:"}),(0,Ie.jsx)(y.A,{variant:"outlined",startIcon:(0,Ie.jsx)(xe.A,{}),onClick:()=>{ro(!1),Pe(!0)},sx:{mb:2,width:"100%"},children:"Send to a Friend"}),(0,Ie.jsx)(F.A,{sx:{my:2},children:(0,Ie.jsx)(U.A,{label:"OR"})}),(0,Ie.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share on social media:"}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(Y)),"&text=").concat(encodeURIComponent((null===Se||void 0===Se?void 0:Se.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,Ie.jsx)(pe.A,{})}),(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(Y))),"_blank"),title:"Share on Facebook",children:(0,Ie.jsx)(ve.A,{})}),(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===Se||void 0===Se?void 0:Se.name)||"Join my SideEye Room!")+" "+"".concat(window.location.origin,"/side-room/").concat(Y))),"_blank"),title:"Share on WhatsApp",children:(0,Ie.jsx)(ge.A,{})}),(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(Y)),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,Ie.jsx)(fe.A,{})})]})]}),(0,Ie.jsx)(E.A,{children:(0,Ie.jsx)(y.A,{onClick:()=>ro(!1),children:"Close"})})]}),(0,Ie.jsxs)(S.A,{open:it,onClose:()=>st(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,Ie.jsxs)(k.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,Ie.jsx)(h.A,{title:"Clear Chat History",children:(0,Ie.jsx)(x.A,{onClick:()=>{at([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,Ie.jsx)(le.A,{})})})]}),(0,Ie.jsx)(R.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:we.palette.background.default},children:(0,Ie.jsxs)(P.A,{sx:{p:0},children:[lt.map(((e,o)=>(0,Ie.jsxs)(D.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,Ie.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,Ie.jsx)(w.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,Ie.jsx)(Ge.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),ut&&(0,Ie.jsxs)(D.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,Ie.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Ie.jsx)(w.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,Ie.jsx)("div",{ref:ht})]})}),(0,Ie.jsxs)(E.A,{sx:{p:1,borderTop:"1px solid ".concat(we.palette.divider),flexDirection:"column"},children:[lt.length<=1&&!ut&&(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,Ie.jsx)(U.A,{label:e,onClick:()=>Br(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",width:"100%"},children:[(0,Ie.jsx)(I.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:dt,onChange:e=>ct(e.target.value),onKeyPress:e=>"Enter"===e.key&&!ut&&Br(),sx:{mr:1},disabled:ut}),(0,Ie.jsxs)(x.A,{onClick:()=>!ut&&Br(dt,!1),disabled:ut||!dt.trim(),color:"primary",children:[(0,Ie.jsx)(K.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,Ie.jsxs)(x.A,{onClick:()=>!ut&&Br(dt,!0),disabled:ut||!dt.trim(),color:"secondary",title:"Search the web",children:[(0,Ie.jsx)(be.A,{})," "]})]})]})]}),qe&&Se&&(0,Ie.jsx)(Ee,{open:qe,onClose:()=>Ke(!1),onSubmit:async(e,o)=>{if(Y&&Ce){Ve(!0);try{let t=Se.thumbnailUrl||"";if(o){const e=(0,De.KR)(a.IG,"room-thumbnails/".concat(Y,"_").concat(Date.now(),"_").concat(o.name));await(0,De.D)(e,o),t=await(0,De.qk)(e)}const r=(0,d.H9)(a.db,"sideRooms",Y),n={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:t,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?n.password=e.password:e.isPrivate||(n.password=(0,d.CL)()),await(0,d.mZ)(r,n),c.oR.success("Room details updated successfully!"),Ke(!1)}catch(t){console.error("Error updating room:",t),c.oR.error("Failed to update room details.")}finally{Ve(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:Se,title:"Edit Room",submitButtonText:"Save Changes"}),(0,Ie.jsxs)(S.A,{open:eo,onClose:()=>oo(!1),fullWidth:!0,maxWidth:"sm",children:[(0,Ie.jsx)(k.A,{children:"Customize Room Appearance"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Ie.jsxs)(T.A,{fullWidth:!0,children:[(0,Ie.jsx)(z.A,{id:"theme-select-label",children:"Theme"}),(0,Ie.jsx)(O.A,{labelId:"theme-select-label",value:Ct,label:"Theme",onChange:e=>jt(e.target.value),children:yo.map((e=>(0,Ie.jsx)(f.A,{value:e.name,children:e.name},e.name)))})]}),(0,Ie.jsxs)(T.A,{fullWidth:!0,children:[(0,Ie.jsx)(z.A,{id:"font-select-label",children:"Font"}),(0,Ie.jsx)(O.A,{labelId:"font-select-label",value:It,label:"Font",onChange:e=>Et(e.target.value),children:Ao.map((e=>(0,Ie.jsx)(f.A,{value:e,children:e},e)))})]}),(0,Ie.jsxs)(T.A,{fullWidth:!0,children:[(0,Ie.jsx)(z.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,Ie.jsx)(O.A,{labelId:"text-size-select-label",value:Ft.toString(),label:"Header Text Size (px)",onChange:e=>Ut(Number(e.target.value)),children:Co.map((e=>(0,Ie.jsx)(f.A,{value:e.toString(),children:e},e)))})]}),(0,Ie.jsx)(G.A,{control:(0,Ie.jsx)(H.A,{checked:wt,onChange:e=>St(e.target.checked)}),label:"Use Header Gradient"}),(0,Ie.jsx)(G.A,{control:(0,Ie.jsx)(H.A,{checked:kt,onChange:e=>Rt(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:()=>oo(!1),children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:async()=>{var e,o,t,r,n;if(!Y||!Se)return void c.oR.error("Cannot save style: Room data is missing.");if(!Ce)return void c.oR.error("You must be logged in to change the style.");if(!vr)return void c.oR.error("Only the room owner can change the style.");const i=yo.find((e=>e.name===Ct));if(!i){var s,l,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=yo[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:It,headerFontSize:Ft,headerGradient:wt,backgroundGradient:kt,customCss:(null===(s=Se.style)||void 0===s?void 0:s.customCss)||"",bannerUrl:(null===(l=Se.style)||void 0===l?void 0:l.bannerUrl)||"",stickers:(null===(u=Se.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=Se.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=Se.style)||void 0===h?void 0:h.thumbnailUrl)||Se.thumbnailUrl||""};try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),oo(!1)}catch(Be){console.error("Error updating room style with default theme:",Be),c.oR.error("Failed to update room style.")}finally{Ve(!1)}return}const x={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:It,headerFontSize:Ft,headerGradient:wt,backgroundGradient:kt,customCss:(null===(e=Se.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=Se.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(t=Se.style)||void 0===t?void 0:t.stickers)||[],glitterEffect:(null===(r=Se.style)||void 0===r?void 0:r.glitterEffect)||!1,thumbnailUrl:(null===(n=Se.style)||void 0===n?void 0:n.thumbnailUrl)||Se.thumbnailUrl||""};Ve(!0);try{const e=(0,d.H9)(a.db,"sideRooms",Y);await(0,d.mZ)(e,{style:x,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),oo(!1)}catch(Be){console.error("Error updating room style:",Be),c.oR.error("Failed to update room style.")}finally{Ve(!1)}},variant:"contained",disabled:Xe,children:Xe?(0,Ie.jsx)(A.A,{size:24}):"Save Style"})]})]}),(0,Ie.jsxs)(S.A,{open:Qe,onClose:()=>{$e(!1),Yo(""),$o(null),Zo([]),Ko(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,Ie.jsx)(k.A,{children:"Invite User to Room"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsx)(p.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,Ie.jsxs)(u.A,{ref:tt,sx:{position:"relative"},children:[(0,Ie.jsx)(I.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:_o,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Yo(o),$o(null),o.trim().length>=2?(Ko(!0),Ir(o)):(Ko(!1),Zo([]))},sx:{mb:1}}),qo&&Jo.length>0&&(0,Ie.jsx)(w.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:we.zIndex.modal+1,mt:.5},children:(0,Ie.jsx)(W.x,{onClickAway:()=>{Ko(!1)},children:(0,Ie.jsx)(P.A,{dense:!0,children:Jo.map((e=>(0,Ie.jsxs)(D.Ay,{button:!0,onClick:()=>{return $o(o=e),Yo(o.username),Ko(!1),void Zo([]);var o},children:[(0,Ie.jsx)(M.A,{children:(0,Ie.jsx)(v.A,{src:e.profilePic,alt:e.username})}),(0,Ie.jsx)(N.A,{primary:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,Ie.jsx)(ye.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),qo&&0===Jo.length&&_o.length>=2&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',_o,'".']})]}),Qo&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",Qo.username,(0,Ie.jsx)(ye.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:()=>{$e(!1),Yo(""),$o(null),Zo([]),Ko(!1)},children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:zr,variant:"contained",disabled:et||!Qo||!rt,children:et?(0,Ie.jsx)(A.A,{size:24}):"Send Invite"})]})]}),(0,Ie.jsxs)(S.A,{open:Pt,onClose:()=>Dt(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,Ie.jsx)(k.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsx)(p.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,Ie.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:()=>Dt(!1),disabled:Xe,children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:()=>{Dt(!1),Or()},color:"error",variant:"contained",disabled:Xe,autoFocus:!0,children:Xe?(0,Ie.jsx)(A.A,{size:24}):"End and Delete"})]})]}),(0,Ie.jsxs)(S.A,{open:_e,onClose:()=>{vr||fr||Z("/side-rooms")},children:[(0,Ie.jsx)(k.A,{children:"Password Required"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,Ie.jsx)(I.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Je,onChange:e=>Ze(e.target.value),onKeyPress:e=>"Enter"===e.key&&Zr()})]}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:()=>Z("/side-rooms"),disabled:Xe,children:"Cancel"}),(0,Ie.jsx)(y.A,{onClick:Zr,disabled:Xe||!Je,variant:"contained",children:Xe?(0,Ie.jsx)(A.A,{size:24}):"Submit"})]})]}),(0,Ie.jsxs)(S.A,{open:Qt,onClose:Qr,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,Ie.jsx)(k.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(p.A,{variant:"body1",children:[(null===yr||void 0===yr?void 0:yr.username)||"This creator",' has a server chat room: "',null===er||void 0===er?void 0:er.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,Ie.jsxs)(E.A,{children:[(0,Ie.jsx)(y.A,{onClick:Qr,children:"Not Now"}),(0,Ie.jsx)(y.A,{onClick:()=>{er&&Z("/chat/room/".concat(er.id)),$t(!1)},variant:"contained",color:"primary",children:"Join Chat Room"})]})]}),Se&&(0,Ie.jsx)(Me,{contentId:Se.id,contentType:"sideRoom",onClose:()=>{lr(!1)},open:sr,ownerUsername:null===yr||void 0===yr?void 0:yr.username}),(0,Ie.jsx)(Ne,{open:Re,onClose:()=>{Pe(!1)},roomName:null===Se||void 0===Se?void 0:Se.name,roomLink:Jr,onSend:async(e,o)=>{if(null!==Ce&&void 0!==Ce&&Ce.uid&&a.db)try{const r=(0,d.H9)(a.db,"rooms",e);if((await(0,d.x7)(r)).exists()){const t=(0,d.rJ)(a.db,"rooms",e,"messages");return void await(0,d.gS)(t,{text:o,sender:Ce.uid,senderName:Ce.displayName||"Unknown User",senderPhoto:Ce.photoURL,timestamp:(0,d.O5)(),type:"chat"})}const n=(0,d.rJ)(a.db,"conversations"),i=(0,d.P)(n,(0,d._M)("participants","array-contains",Ce.uid)),s=await(0,d.GG)(i);let l=null;if(s.docs.forEach((o=>{o.data().participants.includes(e)&&(l=o.id)})),!l){var t;const o=(0,d.H9)(a.db,"users",e),r=await(0,d.x7)(o);if(!r.exists())throw new Error("Recipient user not found");const n=(null===(t=r.data().following)||void 0===t?void 0:t.includes(Ce.uid))||!1,i=(0,d.H9)((0,d.rJ)(a.db,"conversations"));await(0,d.BN)(i,{participants:[Ce.uid,e],createdAt:(0,d.O5)(),lastUpdated:(0,d.O5)(),unreadCount:{[Ce.uid]:0,[e]:1},status:n?"accepted":"pending"}),l=i.id}const c=(0,d.rJ)(a.db,"conversations",l,"messages");await(0,d.gS)(c,{text:o,sender:Ce.uid,timestamp:(0,d.O5)(),read:!1,reactions:[]});const u=(0,d.H9)(a.db,"conversations",l);await(0,d.mZ)(u,{lastMessage:{text:o,sender:Ce.uid,timestamp:(0,d.O5)()},lastUpdated:(0,d.O5)(),["unreadCount.".concat(e)]:(0,d.GV)(1)})}catch(Be){throw console.error("Error sending message:",Be),Be}else c.oR.error("Cannot send message: User not authenticated.")},currentUserId:null===Ce||void 0===Ce?void 0:Ce.uid}),(0,Ie.jsxs)(S.A,{open:ar,onClose:()=>dr(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Ie.jsx)(k.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsx)(p.A,{variant:"h6",children:"Banned Users"}),(0,Ie.jsx)(x.A,{onClick:()=>dr(!1),children:(0,Ie.jsx)(Ae.A,{})})]})}),(0,Ie.jsx)(R.A,{children:0===cr.length?(0,Ie.jsx)(u.A,{sx:{textAlign:"center",py:3},children:(0,Ie.jsx)(p.A,{variant:"body1",color:"text.secondary",children:"No users are currently banned from this room"})}):(0,Ie.jsx)(P.A,{children:cr.map((e=>(0,Ie.jsxs)(D.Ay,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1},secondaryAction:(0,Ie.jsx)(y.A,{variant:"outlined",color:"success",size:"small",onClick:()=>Cr(e.id,e.username),children:"Unban"}),children:[(0,Ie.jsx)(M.A,{children:(0,Ie.jsx)(v.A,{src:e.profilePic,alt:e.username,children:e.username.charAt(0).toUpperCase()})}),(0,Ie.jsx)(N.A,{primary:e.name||e.username,secondary:"@".concat(e.username)})]},e.id)))})})]})]})]})},ko=e=>{var o,t,i,s,m,g,f,b,C,S,k,R,E,F,P,D,T,z,O,G,H,W,M,N,_,Y,J,Z,q,K,Q,ee,re,ne,ie,se,le,de,he,xe,pe,ve,ge,fe,be,ye,ke,Re,Ee,Fe,De,Te;let{room:ze,isRoomOwner:Oe,isGuest:Ge,handleOpenShareVideoDialog:He,handleClearSharedVideo:We,currentVideoUrl:Me,renderVideoPlayer:Ne,onForceMuteToggle:Be,onForceRemove:Le,onForceBan:Xe,theme:Ve,navigate:_e}=e;(0,n.useRef)(null);const Ye=(0,Pe.Gc)(),{useParticipants:Je,useCallState:Ze,useMicrophoneState:qe,useCameraState:Ke}=(0,Pe.R3)(),Qe=Je(),{localParticipant:$e}=Ze(),{isMute:eo}=qe(),{isEnabled:oo,isTogglePending:to}=Ke();(0,n.useEffect)((()=>{Ye&&Ye.camera.disable().catch((e=>{console.error("Error disabling camera:",e)}))}),[Ye]);const{currentUser:ro}=(0,l.As)(),[no,io]=(0,n.useState)(window.innerWidth>1024),[so,lo]=(0,n.useState)(!0),[ao,co]=(0,n.useState)(!1),[mo,ho]=(0,n.useState)([]),[xo,po]=(0,n.useState)([]),[vo,go]=(0,n.useState)("participants"),[fo,yo]=(0,n.useState)([]),[Ao,Co]=(0,n.useState)(""),jo=(0,n.useRef)(null),[wo,So]=(0,n.useState)({}),ko=Qe.find((e=>e.screenShareStream)),Io=(0,n.useCallback)((async e=>{if(wo[e])return wo[e];try{const o=(0,d.H9)(a.db,"users",e),t=await(0,d.x7)(o);if(t.exists()){const o=t.data(),n={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return So((o=>(0,r.A)((0,r.A)({},o),{},{[e]:n}))),n}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return So((t=>(0,r.A)((0,r.A)({},t),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[wo,a.db]),Eo=(0,n.useCallback)((async()=>{if(!Ao.trim()||null===ro||void 0===ro||!ro.uid||null===ze||void 0===ze||!ze.id||!a.db)return;const e=await Io(ro.uid),o={id:"".concat(Date.now(),"-").concat(ro.uid),userId:ro.uid,userName:e.username,message:Ao.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(a.db,"sideRooms",ze.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(t){console.error("[Chat] Error sending message to Firestore:",t),yo((e=>[...e,o]))}Co("")}),[Ao,null===ro||void 0===ro?void 0:ro.uid,null===ze||void 0===ze?void 0:ze.id,a.db,Io]);(0,n.useEffect)((()=>{if(null===ze||void 0===ze||!ze.id||!a.db)return;console.log("[Chat] Setting up chat listener for room ".concat(ze.id));const e=(0,d.P)((0,d.rJ)(a.db,"sideRooms",ze.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const t=e.data();o.push({id:e.id,userId:t.userId,userName:t.userName,message:t.message,timestamp:t.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),yo(o),jo.current&&jo.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===ze||void 0===ze?void 0:ze.id,a.db]);(0,n.useCallback)((async()=>{if(Ye)if(no)try{console.log("Current screen share state:",Ye.screenShare.enabled),Ye.screenShare.enabled?(await Ye.screenShare.disable(),console.log("Screen share disabled successfully"),c.oR.success("Screen sharing stopped.")):(c.oR.loading("Starting screen share..."),await Ye.screenShare.enable(),console.log("Screen share enabled successfully"),c.oR.dismiss(),c.oR.success("Screen sharing started! Everyone should see your screen now."))}catch(t){var e,o;c.oR.dismiss(),console.error("Screen share error:",t),"NotAllowedError"===t.name||null!==(e=t.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access when prompted by your browser."):null!==(o=t.message)&&void 0!==o&&o.includes("getDisplayMedia is not supported")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(t.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[Ye,no]);(0,n.useEffect)((()=>{const e=()=>{io(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const Fo=e=>{po((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))},Uo=()=>{Ye&&("enabled"!==Ye.camera.state.status?navigator.mediaDevices.getUserMedia({video:!0}).then((e=>(e.getTracks().forEach((e=>e.stop())),Ye.camera.enable()))).then((()=>{lo(!0)})).catch((e=>{console.error("Error enabling camera:",e),c.oR.error("Could not enable camera. Please check permissions.")})):Ye.camera.disable().catch((e=>{console.error("Error disabling camera:",e)})))};(0,n.useEffect)((()=>{var e;null===(e=jo.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[fo]);const Po=(0,n.useMemo)((()=>{if(!Qe||null===ze||void 0===ze||!ze.ownerId)return[];const e=Qe.find((e=>e.userId===ze.ownerId));return[...e?[e]:[],...Qe.filter((e=>xo.includes(e.userId)&&e.userId!==ze.ownerId)),...Qe.filter((e=>e.userId!==ze.ownerId&&!xo.includes(e.userId)))].filter(Boolean)}),[Qe,null===ze||void 0===ze?void 0:ze.ownerId,xo]);(0,n.useEffect)((()=>{oo&&lo(!0)}),[oo]);const Do=Po;return Ye?(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===ze||void 0===ze||null===(o=ze.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==ze&&void 0!==ze&&null!==(t=ze.style)&&void 0!==t&&t.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===ze||void 0===ze||null===(i=ze.style)||void 0===i?void 0:i.backgroundColor)||Ve.palette.background.default,", ").concat((null===ze||void 0===ze||null===(s=ze.style)||void 0===s?void 0:s.accentColor)||Ve.palette.secondary.main,")"):(null===ze||void 0===ze||null===(m=ze.style)||void 0===m?void 0:m.backgroundColor)||Ve.palette.background.default,color:(null===ze||void 0===ze||null===(g=ze.style)||void 0===g?void 0:g.textColor)||Ve.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[null,(0,Ie.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[ko&&(0,Ie.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[(0,Ie.jsxs)(p.A,{variant:"h6",align:"center",sx:{mt:2,mb:2,fontWeight:700,color:(null===ze||void 0===ze||null===(f=ze.style)||void 0===f?void 0:f.accentColor)||Ve.palette.primary.main},children:["\ud83d\udda5\ufe0f ",ko.name||"Someone"," is sharing their screen"]}),(0,Ie.jsx)(u.A,{sx:{width:"100%",maxWidth:"1200px",position:"relative",paddingTop:"56.25%",backgroundColor:"#000",borderRadius:2,overflow:"hidden",border:"2px solid ".concat((null===ze||void 0===ze||null===(b=ze.style)||void 0===b?void 0:b.accentColor)||Ve.palette.primary.main),"& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"contain"}}},children:(0,Ie.jsx)(Ue.fSl,{participant:ko,trackType:"screenShareTrack"})})]}),!ko&&(0,Ie.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(p.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===ze||void 0===ze||null===(C=ze.style)||void 0===C?void 0:C.accentColor)||Ve.palette.primary.main},children:"Live Video"}),(0,Ie.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"},mb:2},children:[oo?(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:Ve.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(0,Ie.jsx)(x.A,{onClick:Uo,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ie.jsx)(Ae.A,{fontSize:"small"})}),$e&&(0,Ie.jsx)(Ue.fSl,{participant:$e,trackType:"videoTrack"}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{sx:{width:40,height:40,mr:1},children:(null===ro||void 0===ro||null===(S=ro.displayName)||void 0===S?void 0:S[0])||"U"}),(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"bold",children:(null===ro||void 0===ro?void 0:ro.displayName)||"You"}),(0,Ie.jsx)(p.A,{variant:"caption",children:(null===ze||void 0===ze?void 0:ze.name)||"Live Room"})]})]})}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",right:12,bottom:70,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:(0,Ie.jsx)(h.A,{title:eo?"Unmute":"Mute",children:(0,Ie.jsx)(x.A,{onClick:()=>null===Ye||void 0===Ye?void 0:Ye.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:44,height:44,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:eo?(0,Ie.jsx)(me.A,{}):(0,Ie.jsx)(ce.A,{})})})})]}):(0,Ie.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Ie.jsx)(y.A,{variant:"contained",color:"primary",onClick:Uo,startIcon:(0,Ie.jsx)(oe.A,{}),children:"Enable Camera"})}),Qe&&Qe.filter((e=>e.userId!==(null===ro||void 0===ro?void 0:ro.uid))).length>0&&(so?(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(()=>{const e=Qe.find((e=>e.userId===ze.ownerId&&e.userId!==(null===ro||void 0===ro?void 0:ro.uid))),o=Qe.filter((e=>e.userId!==(null===ro||void 0===ro?void 0:ro.uid)))[0],t=e||o;return t?(0,Ie.jsx)(Ue.fSl,{participant:t,trackType:"videoTrack"}):null})(),(0,Ie.jsx)(x.A,{onClick:()=>{lo(!1),c.oR.success("Video view closed")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ie.jsx)(Ae.A,{fontSize:"small"})}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(e=>{const o=Qe.find((e=>e.userId===ze.ownerId&&e.userId!==(null===ro||void 0===ro?void 0:ro.uid))),t=Qe.filter((e=>e.userId!==(null===ro||void 0===ro?void 0:ro.uid)))[0],r=o||t;return r&&(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{src:null===(e=wo[r.userId])||void 0===e?void 0:e.avatar,sx:{width:40,height:40,mr:1}}),(0,Ie.jsx)(u.A,{children:(0,Ie.jsxs)(p.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===r||void 0===r?void 0:r.name)||"User",r.userId===ze.ownerId&&" (Host)"]})})]})})()})]}):(0,Ie.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Ie.jsx)(y.A,{variant:"outlined",color:"primary",onClick:()=>lo(!0),startIcon:(0,Ie.jsx)(oe.A,{}),children:"Show Partner Video"})}))]}),Qe&&Qe.filter((e=>e.userId!==(null===ro||void 0===ro?void 0:ro.uid))).length>1&&(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:1,mt:2,width:"100%",maxWidth:"600px"},children:Qe.filter((e=>e.userId!==(null===ro||void 0===ro?void 0:ro.uid))).filter((e=>{const o=Qe.find((e=>e.userId===ze.ownerId&&e.userId!==(null===ro||void 0===ro?void 0:ro.uid)));return!(e.userId===ze.ownerId&&o===Qe.filter((e=>e.userId!==(null===ro||void 0===ro?void 0:ro.uid)))[0])})).filter((e=>!mo.includes(e.userId))).map((e=>(0,Ie.jsxs)(u.A,{sx:{width:"100px",height:"150px",borderRadius:"10px",overflow:"hidden",position:"relative",border:"2px solid",borderColor:"divider",backgroundColor:"#000","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[(0,Ie.jsx)(Ue.fSl,{participant:e,trackType:"videoTrack"}),(0,Ie.jsx)(x.A,{onClick:()=>{const o=[...mo||[]];if(o.includes(e.userId)){const t=o.indexOf(e.userId);t>-1&&o.splice(t,1)}else o.push(e.userId);ho(o),c.oR.success("Video view toggled")},sx:{position:"absolute",top:2,right:2,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:20,height:20,zIndex:10,padding:"2px","& .MuiSvgIcon-root":{fontSize:"14px"},"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ie.jsx)(Ae.A,{})}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"2px 4px",background:"rgba(0,0,0,0.7)",color:"white",fontSize:"10px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name||"User ".concat(e.userId.substring(0,5))})]},e.userId)))})]}),Me&&(0,Ie.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===ze||void 0===ze||null===(k=ze.style)||void 0===k?void 0:k.font)||"inherit",color:(null===ze||void 0===ze||null===(R=ze.style)||void 0===R?void 0:R.textColor)||"inherit"},children:"Shared Video"}),Oe&&(0,Ie.jsx)(h.A,{title:"Clear Shared Video",children:(0,Ie.jsx)(x.A,{onClick:()=>We(),size:"small",sx:{color:(null===ze||void 0===ze||null===(E=ze.style)||void 0===E?void 0:E.accentColor)||"inherit"},children:(0,Ie.jsx)(ue.A,{})})})]}),(0,Ie.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Ne(Me)})]}),(0,Ie.jsx)(u.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",overflow:"hidden"},children:(0,Ie.jsx)(u.A,{sx:{maxWidth:"100%",display:"flex",overflowX:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},WebkitOverflowScrolling:"touch"},children:(0,Ie.jsxs)(B.A,{value:vo,onChange:(e,o)=>go(o),"aria-label":"room content tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root":{fontFamily:(null===ze||void 0===ze||null===(F=ze.style)||void 0===F?void 0:F.font)||"inherit",color:(null===ze||void 0===ze||null===(P=ze.style)||void 0===P?void 0:P.textColor)||"inherit",opacity:.7,minWidth:"auto",padding:{xs:"6px 8px",sm:"12px 16px"},fontSize:{xs:"0.75rem",sm:"0.875rem"}},"& .Mui-selected":{color:"".concat((null===ze||void 0===ze||null===(D=ze.style)||void 0===D?void 0:D.accentColor)||Ve.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===ze||void 0===ze||null===(T=ze.style)||void 0===T?void 0:T.accentColor)||Ve.palette.primary.main},"& .MuiTabs-scrollButtons":{"&.Mui-disabled":{opacity:.3},"&":{color:(null===ze||void 0===ze||null===(z=ze.style)||void 0===z?void 0:z.textColor)||"inherit"}}},children:[(0,Ie.jsx)(L.A,{label:"Participants (".concat(Do.length,")"),value:"participants",sx:{flexShrink:0}}),(0,Ie.jsx)(L.A,{label:"Chat",value:"chat",sx:{flexShrink:0},icon:(0,Ie.jsx)(X.A,{color:"primary",variant:"dot",invisible:"chat"===vo||0===fo.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===ze||void 0===ze||null===(O=ze.style)||void 0===O?void 0:O.accentColor)||Ve.palette.primary.main}}}),iconPosition:"end"}),(0,Ie.jsx)(L.A,{label:"Gifts",value:"gifts",sx:{flexShrink:0},icon:(0,Ie.jsx)(Ce.A,{fontSize:"small"}),iconPosition:"end"}),(0,Ie.jsx)(L.A,{label:"Top Gifters",value:"topGifters",sx:{flexShrink:0},icon:(0,Ie.jsx)(je.A,{fontSize:"small"}),iconPosition:"end"})]})})}),"participants"===vo&&(0,Ie.jsxs)(Ie.Fragment,{children:[Do.length>0&&(0,Ie.jsx)(Ue.ncL,{participants:Do}),(0,Ie.jsx)(j.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Do.map((e=>{const o=e.userId===ze.ownerId;return(0,Ie.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,Ie.jsx)(Ro,{participant:e,isRoomOwner:Oe,isLocalParticipant:e.userId===(null===ro||void 0===ro?void 0:ro.uid),localUserAuthData:ro,onForceMuteToggle:Be,onForceRemove:Le,onForceBan:Xe,call:Ye,localUserIsMute:eo,isDesignatedHost:o,onPinToggle:Fo,isPinned:xo.includes(e.userId),roomStyle:null===ze||void 0===ze?void 0:ze.style,navigate:_e})},e.userId)}))}),0===Do.length&&(0,Ie.jsx)(p.A,{sx:{width:"100%",textAlign:"center",color:null!==ze&&void 0!==ze&&null!==(G=ze.style)&&void 0!==G&&G.textColor?(0,V.X4)(null===ze||void 0===ze||null===(H=ze.style)||void 0===H?void 0:H.textColor,.7):Ve.palette.text.secondary,mt:4,fontFamily:(null===ze||void 0===ze||null===(W=ze.style)||void 0===W?void 0:W.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===vo&&(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==ze&&void 0!==ze&&null!==(M=ze.style)&&void 0!==M&&M.accentColor?(0,V.X4)(null===ze||void 0===ze||null===(N=ze.style)||void 0===N?void 0:N.accentColor,.3):Ve.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==ze&&void 0!==ze&&null!==(_=ze.style)&&void 0!==_&&_.accentColor?(0,V.X4)(null===ze||void 0===ze||null===(Y=ze.style)||void 0===Y?void 0:Y.accentColor,.3):Ve.palette.divider),bgcolor:null!==ze&&void 0!==ze&&null!==(J=ze.style)&&void 0!==J&&J.headerColor?(0,V.X4)(null===ze||void 0===ze||null===(Z=ze.style)||void 0===Z?void 0:Z.headerColor,.1):(0,V.X4)(Ve.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsxs)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===ze||void 0===ze||null===(q=ze.style)||void 0===q?void 0:q.font)||"inherit",color:(null===ze||void 0===ze||null===(K=ze.style)||void 0===K?void 0:K.textColor)||"inherit"},children:["Users in Room (",Do.length,")"]}),(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Do.map((e=>{var o,t,r,n,i,s;const l=wo[e.userId],a=(null===l||void 0===l?void 0:l.username)||e.name||e.userId.substring(0,8),d=(null===l||void 0===l?void 0:l.avatar)||e.image;return(0,Ie.jsx)(U.A,{size:"small",label:a,avatar:(0,Ie.jsx)(v.A,{src:d,alt:a,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===ze.ownerId?(0,V.X4)((null===ze||void 0===ze||null===(o=ze.style)||void 0===o?void 0:o.accentColor)||Ve.palette.secondary.main,.1):(0,V.X4)((null===ze||void 0===ze||null===(t=ze.style)||void 0===t?void 0:t.headerColor)||Ve.palette.primary.main,.05),borderColor:e.userId===ze.ownerId?(null===ze||void 0===ze||null===(r=ze.style)||void 0===r?void 0:r.accentColor)||Ve.palette.secondary.main:(null===ze||void 0===ze||null===(n=ze.style)||void 0===n?void 0:n.headerColor)||Ve.palette.primary.main,border:"1px solid",color:(null===ze||void 0===ze||null===(i=ze.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===ze||void 0===ze||null===(s=ze.style)||void 0===s?void 0:s.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,Ie.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==ze&&void 0!==ze&&null!==(Q=ze.style)&&void 0!==Q&&Q.backgroundGradient?(0,V.X4)((null===ze||void 0===ze||null===(ee=ze.style)||void 0===ee?void 0:ee.backgroundColor)||Ve.palette.background.default,.3):(0,V.X4)(Ve.palette.background.paper,.5)},children:0===fo.length?(0,Ie.jsx)(p.A,{variant:"body2",color:null!==ze&&void 0!==ze&&null!==(re=ze.style)&&void 0!==re&&re.textColor?(0,V.X4)(null===ze||void 0===ze||null===(ne=ze.style)||void 0===ne?void 0:ne.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===ze||void 0===ze||null===(ie=ze.style)||void 0===ie?void 0:ie.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,Ie.jsxs)(Ie.Fragment,{children:[fo.map((e=>{var o,t,r,n,i,s,l,a,d,c,m;return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:e.userId===(null===ro||void 0===ro?void 0:ro.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===ro||void 0===ro?void 0:ro.uid)&&(0,Ie.jsx)(v.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=wo[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsx)(p.A,{variant:"caption",color:null!==ze&&void 0!==ze&&null!==(t=ze.style)&&void 0!==t&&t.textColor?(0,V.X4)(null===ze||void 0===ze||null===(r=ze.style)||void 0===r?void 0:r.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===ro||void 0===ro?void 0:ro.uid)?"right":"left",fontFamily:(null===ze||void 0===ze||null===(n=ze.style)||void 0===n?void 0:n.font)||"inherit"},children:e.userName}),(0,Ie.jsx)(w.A,{sx:{p:1,bgcolor:e.userId===(null===ro||void 0===ro?void 0:ro.uid)?(null===ze||void 0===ze||null===(i=ze.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===ro||void 0===ro?void 0:ro.uid)?null!==ze&&void 0!==ze&&null!==(s=ze.style)&&void 0!==s&&s.accentColor?Ve.palette.getContrastText(ze.style.accentColor):"primary.contrastText":(null===ze||void 0===ze||null===(l=ze.style)||void 0===l?void 0:l.textColor)||"text.primary",borderRadius:e.userId===(null===ro||void 0===ro?void 0:ro.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===ze||void 0===ze||null===(a=ze.style)||void 0===a?void 0:a.font)||"inherit"},children:(0,Ie.jsx)(p.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,Ie.jsx)(p.A,{variant:"caption",color:null!==ze&&void 0!==ze&&null!==(d=ze.style)&&void 0!==d&&d.textColor?(0,V.X4)(null===ze||void 0===ze||null===(c=ze.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===ro||void 0===ro?void 0:ro.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===ze||void 0===ze||null===(m=ze.style)||void 0===m?void 0:m.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,Ie.jsx)("div",{ref:jo})]})}),(0,Ie.jsx)(u.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==ze&&void 0!==ze&&null!==(se=ze.style)&&void 0!==se&&se.accentColor?(0,V.X4)(null===ze||void 0===ze||null===(le=ze.style)||void 0===le?void 0:le.accentColor,.3):Ve.palette.divider),bgcolor:(null===ze||void 0===ze||null===(de=ze.style)||void 0===de?void 0:de.headerColor)||Ve.palette.background.paper,display:"flex"},children:(0,Ie.jsx)(I.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:Ao,onChange:e=>Co(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Eo())},InputProps:{sx:{fontFamily:(null===ze||void 0===ze||null===(he=ze.style)||void 0===he?void 0:he.font)||"inherit",color:(null===ze||void 0===ze||null===(xe=ze.style)||void 0===xe?void 0:xe.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==ze&&void 0!==ze&&null!==(pe=ze.style)&&void 0!==pe&&pe.accentColor?(0,V.X4)(null===ze||void 0===ze||null===(ve=ze.style)||void 0===ve?void 0:ve.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==ze&&void 0!==ze&&null!==(ge=ze.style)&&void 0!==ge&&ge.accentColor?(0,V.X4)(null===ze||void 0===ze||null===(fe=ze.style)||void 0===fe?void 0:fe.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===ze||void 0===ze||null===(be=ze.style)||void 0===be?void 0:be.accentColor)||Ve.palette.primary.main}},endAdornment:(0,Ie.jsx)(x.A,{size:"small",onClick:Eo,disabled:!Ao.trim(),color:"primary",sx:{color:(null===ze||void 0===ze||null===(ye=ze.style)||void 0===ye?void 0:ye.accentColor)||"primary"},children:(0,Ie.jsx)(we.A,{fontSize:"small"})})}})})]}),"gifts"===vo&&(0,Ie.jsx)(uo,{roomId:ze.id,roomOwnerId:ze.ownerId,theme:Ve,roomStyle:null===ze||void 0===ze?void 0:ze.style}),"topGifters"===vo&&ze&&(0,Ie.jsx)(bo,{roomId:ze.id,roomOwnerId:ze.ownerId,theme:Ve,roomStyle:null===ze||void 0===ze?void 0:ze.style})]}),(0,Ie.jsxs)(u.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(Ve.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===ze||void 0===ze||null===(ke=ze.style)||void 0===ke?void 0:ke.headerColor)||Ve.palette.background.paper},children:[(0,Ie.jsx)(y.A,{variant:"outlined",color:"error",startIcon:(0,Ie.jsx)(ae.A,{}),onClick:()=>{Ye?Ye.leave().then((()=>{console.log("Successfully left call"),_e("/side-rooms")})).catch((e=>{console.error("Error leaving call:",e),_e("/side-rooms")})):_e("/side-rooms")},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===ze||void 0===ze||null===(Re=ze.style)||void 0===Re?void 0:Re.font)||"inherit"},children:"Leave quietly"}),Oe&&(0,Ie.jsx)(h.A,{title:eo?"Unmute Microphone":"Mute Microphone",children:(0,Ie.jsx)(x.A,{onClick:()=>null===Ye||void 0===Ye?void 0:Ye.microphone.toggle(),color:eo?"default":"primary",sx:{ml:2,color:eo?"default":(null===ze||void 0===ze||null===(Ee=ze.style)||void 0===Ee?void 0:Ee.accentColor)||"primary.main"},disabled:!Ye,children:eo?(0,Ie.jsx)(me.A,{}):(0,Ie.jsx)(ce.A,{})})}),Oe&&(0,Ie.jsx)(h.A,{title:oo?"Turn Camera Off":"Turn Camera On",children:(0,Ie.jsx)(x.A,{onClick:Uo,color:oo?"primary":"default",sx:{ml:1,color:oo?(null===ze||void 0===ze||null===(Fe=ze.style)||void 0===Fe?void 0:Fe.accentColor)||"primary.main":"default"},disabled:!Ye,children:oo?(0,Ie.jsx)(oe.A,{}):(0,Ie.jsx)(te.A,{})})}),Oe&&(0,Ie.jsx)(h.A,{title:so?"Hide Camera Window":"Show Camera Window",children:(0,Ie.jsx)(x.A,{onClick:()=>lo(!so),color:so?"primary":"default",sx:{ml:1,color:so?(null===ze||void 0===ze||null===(De=ze.style)||void 0===De?void 0:De.accentColor)||"primary.main":"default"},disabled:!Ye||!oo,children:(0,Ie.jsx)(Se.A,{})})}),Oe&&(0,Ie.jsx)(h.A,{title:"Share Video Link",children:(0,Ie.jsx)("span",{children:(0,Ie.jsx)(x.A,{onClick:()=>He(),color:"secondary",sx:{ml:2,color:(null===ze||void 0===ze||null===(Te=ze.style)||void 0===Te?void 0:Te.accentColor)||Ve.palette.secondary.main},children:(0,Ie.jsx)($.A,{})})})})]})]}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,Ie.jsx)(A.A,{}),(0,Ie.jsx)(p.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},Ro=n.memo((e=>{let{participant:o,isRoomOwner:t,isLocalParticipant:r,onForceMuteToggle:i,onForceRemove:a,onForceBan:A,call:C,localUserAuthData:j,localUserIsMute:w,isDesignatedHost:I,onPinToggle:F,isPinned:T,roomStyle:z,navigate:O}=e;const G=(0,m.A)(),{isSpeaking:H,publishedTracks:W}=o,{blockUser:M,currentUser:B}=(0,l.As)(),L=W.includes("audio"),X=r?null===w||void 0===w||w:!L&&!H,[_,Y]=(0,n.useState)(null),J=Boolean(_),Z=e=>Y(e.currentTarget),q=()=>Y(null),K=async()=>{if(r&&C)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",w),await C.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),t&&null!==j&&void 0!==j&&j.uid){const o=C.cid,t=o.includes(":")?o.split(":").pop():o;if(!t)return void console.error("[StreamParticipantCard] Invalid room ID format:",o);const r=(0,d.aU)(),n=(0,d.H9)(r,"sideRooms",t);try{if(!(await(0,d.x7)(n)).exists())return void console.error("[StreamParticipantCard] Room document does not exist:",t);const e=!C.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!e)),await(0,d.mZ)(n,{isLive:!e,lastActive:(0,d.O5)()})}catch(e){console.error("[StreamParticipantCard] Error accessing room document:",e)}}}catch(o){console.error("[StreamParticipantCard] Error toggling local microphone:",o),c.oR.error("Failed to toggle microphone. See console.")}};let $,ee;const oe=o.custom;r&&j?($=j.displayName||j.email||o.userId,ee=j.photoURL||o.image||void 0):oe&&"string"===typeof oe.displayName&&""!==oe.displayName.trim()?($=oe.displayName,ee=oe.customAvatarUrl&&"string"===typeof oe.customAvatarUrl&&""!==oe.customAvatarUrl.trim()?oe.customAvatarUrl:o.image||void 0):($=o.name||o.userId,ee=o.image||void 0),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:t,isLocalParticipant:r,localUserAuthData:j}),console.log("[StreamParticipantCard] Determined values - displayName:",$,"avatarUrl:",ee,"isSpeaking:",H,"participantIsMuted:",X),r&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",j,"Stream participant.userId:",o.userId);const[te,ne]=(0,n.useState)(!1),[ie,le]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(null!==B&&void 0!==B&&B.blockedUsers&&o.userId&&!r&&!I){const e=B.blockedUsers.includes(o.userId);le(e)}}),[null===B||void 0===B?void 0:B.blockedUsers,o.userId,r,I]),(0,n.useEffect)((()=>{var e;if(!C||r||I)return;const t=null===(e=o.audioStream)||void 0===e?void 0:e.getAudioTracks()[0];t&&ie?(t.enabled=!1,console.log("[StreamParticipantCard] Audio disabled for blocked user: ".concat(o.userId))):t&&!ie&&(t.enabled=!0)}),[ie,o.audioStream,C,r,I,o.userId]);return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{var e,t;const n=ie&&!I?null:ee,i=ie&&!I?"?":$,l=H&&!(ie&&!I),a=(0,Ie.jsx)(v.A,{src:n||void 0,alt:i,sx:{width:64,height:64,mb:.5,border:l?"3px solid ".concat(G.palette.success.main):"2px solid ".concat((0,V.X4)(G.palette.divider,.5)),boxShadow:l?"0 0 8px ".concat(G.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer",backgroundColor:ie&&!I?G.palette.grey[400]:"inherit",opacity:ie&&!I?.6:1},children:ie&&!I?"?":null===(e=$)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.toUpperCase()});return r?(0,Ie.jsx)(u.A,{onClick:K,sx:{cursor:"pointer"},children:a}):(0,Ie.jsx)(s.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:a})})(),I&&(0,Ie.jsx)(U.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(r?null===w||void 0===w||w:X)&&(0,Ie.jsx)(me.A,{sx:{fontSize:"1rem",color:G.palette.error.contrastText,backgroundColor:(0,V.X4)(G.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),r&&!w&&(0,Ie.jsx)(ce.A,{sx:{fontSize:"1rem",color:G.palette.success.contrastText,backgroundColor:(0,V.X4)(G.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,Ie.jsx)(p.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:G.palette.text.primary},children:ie&&!I?"Blocked User":$}),t&&!r&&(0,Ie.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Ie.jsx)(h.A,{title:"Manage User",children:(0,Ie.jsx)(x.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,V.X4)(G.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Ie.jsx)(re.A,{fontSize:"small"})})}),(0,Ie.jsxs)(g.A,{anchorEl:_,open:J,onClose:q,MenuListProps:{dense:!0},children:[(0,Ie.jsxs)(f.A,{onClick:()=>{q(),F(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,Ie.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(ke.A,{fontSize:"small",color:T?"primary":"inherit"})}),T?"Unpin from top":"Pin to top"]}),(0,Ie.jsxs)(f.A,{onClick:()=>{q(),ne(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Q.A,{fontSize:"small",color:"warning"})}),"Report User"]}),(0,Ie.jsxs)(f.A,{onClick:()=>{q(),M&&o.userId&&(M(o.userId),a&&a(o.userId,o.name||o.userId,"blocked"),c.oR.success("".concat(o.name||o.userId," has been blocked and removed from the room")))},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Re.A,{fontSize:"small",color:"error"})}),"Block & Remove"]}),(0,Ie.jsxs)(f.A,{onClick:()=>{q(),A&&A(o.userId,o.name||o.userId)},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(se.A,{fontSize:"small",color:"error"})}),"Ban"]})]})]}),!t&&!r&&(0,Ie.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Ie.jsx)(h.A,{title:"Options",children:(0,Ie.jsx)(x.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,V.X4)(G.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Ie.jsx)(re.A,{fontSize:"small"})})}),(0,Ie.jsxs)(g.A,{anchorEl:_,open:J,onClose:q,MenuListProps:{dense:!0},children:[(0,Ie.jsxs)(f.A,{onClick:()=>{q(),ne(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Q.A,{fontSize:"small",color:"warning"})}),"Report User"]}),(0,Ie.jsxs)(f.A,{onClick:()=>{q(),M&&o.userId&&(ie?(le(!1),c.oR.success("".concat(o.name||o.userId," has been unblocked."))):I?(M(o.userId),c.oR.error("You cannot block the room owner. You will be removed from the room."),setTimeout((()=>{C?C.leave().then((()=>O("/side-rooms"))).catch((e=>{console.error("Error leaving call:",e),O("/side-rooms")})):O("/side-rooms")}),2e3)):(M(o.userId),le(!0),c.oR.success("".concat(o.name||o.userId," has been blocked. You won't hear them or see their profile picture."))))},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Re.A,{fontSize:"small",color:"error"})}),ie?"Unblock User":I?"Block Owner (Leave Room)":"Block User"]})]})]}),T&&!I&&(0,Ie.jsx)(h.A,{title:"Pinned",children:(0,Ie.jsx)(ke.A,{sx:{fontSize:"1rem",color:G.palette.primary.contrastText,backgroundColor:(0,V.X4)(G.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,Ie.jsxs)(S.A,{open:te,onClose:()=>ne(!1),children:[(0,Ie.jsx)(k.A,{children:"Report User"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsxs)(p.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,Ie.jsx)(P.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,Ie.jsx)(D.Ay,{onClick:()=>(async e=>{try{const t={reportedUserId:o.userId,reportedBy:null===B||void 0===B?void 0:B.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)((0,d.aU)(),"reports"),t),c.oR.success("Report submitted for ".concat(o.name||o.userId)),ne(!1)}catch(t){console.error("Error submitting report:",t),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,V.X4)(G.palette.primary.main,.1)}},children:(0,Ie.jsx)(N.A,{primary:e})},e)))})]}),(0,Ie.jsx)(E.A,{children:(0,Ie.jsx)(y.A,{onClick:()=>ne(!1),children:"Cancel"})})]})]})}))}}]);