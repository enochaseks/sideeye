"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[112],{4454:(e,o,r)=>{r.d(o,{A:()=>s});r(9950);var n=r(6491),t=r(2053),i=r(5277),l=r(4414);const s=e=>{let{links:o}=e;return o&&0!==o.length?(0,l.jsxs)(n.A,{mt:1,children:[(0,l.jsx)(t.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,l.jsx)(n.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,l.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},7112:(e,o,r)=>{r.r(o),r.d(o,{default:()=>Me});var n=r(9379),t=r(9950),i=r(8429),l=r(2074),s=r(1367),a=r(330),d=r(6220),c=r(5887),u=r(4857),m=r(6491),h=r(2053),p=r(3274),v=r(5333),g=r(4447),x=r(1413),f=r(7591),y=r(3266),b=r(4195),C=r(226),A=r(6639),w=r(3174),j=r(899),S=r(2235),k=r(6583),I=r(33),R=r(8170),E=r(8145),F=r(9739),P=r(249),U=r(6050),T=r(5277),D=r(5979),O=r(3788),z=r(6101),W=r(6497),M=r(7324),L=r(9325),H=r(8614),_=r(3563),B=r(2236),G=r(4142),N=r(7497),V=r(227),Y=r(7443),J=r(5965),X=r(6904),Z=r(9575),K=r(1679),q=r(7341),Q=r(5204),$=r(6281),ee=r(379),oe=r(1300),re=r(760),ne=r(7319),te=r(4756),ie=r(4767),le=r(492),se=r(8008),ae=r(1902),de=r(5855),ce=r(9939),ue=r(9404),me=r(5379),he=r(361),pe=r(1675),ve=r(9715),ge=r(6164),xe=r(6835),fe=r(1311),ye=r(1673),be=r(6487),Ce=r(9460),Ae=r(2600),we=r(1770),je=r(7565),Se=r(4414);const ke=e=>{var o;let{open:r,onClose:i,onSubmit:l,initialData:s,title:a="Create Room",submitButtonText:d="Create"}=e;const[c,u]=(0,t.useState)({name:(null===s||void 0===s?void 0:s.name)||"",description:(null===s||void 0===s?void 0:s.description)||"",isPrivate:(null===s||void 0===s?void 0:s.isPrivate)||!1,password:(null===s||void 0===s?void 0:s.password)||"",tags:(null===s||void 0===s?void 0:s.tags)||[]}),[p,v]=(0,t.useState)(null);return(0,Se.jsx)(k.A,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,Se.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(c,p)},children:[(0,Se.jsx)(I.A,{children:a}),(0,Se.jsx)(R.A,{children:(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Se.jsx)(E.A,{label:"Name",value:c.name,onChange:e=>u((o=>(0,n.A)((0,n.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,Se.jsx)(E.A,{label:"Description",value:c.description,onChange:e=>u((o=>(0,n.A)((0,n.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,Se.jsx)(W.A,{control:(0,Se.jsx)(M.A,{checked:c.isPrivate,onChange:e=>u((o=>(0,n.A)((0,n.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,Se.jsx)(E.A,{label:"Password",type:"password",value:c.password,onChange:e=>u((o=>(0,n.A)((0,n.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,Se.jsxs)(m.A,{sx:{mt:1},children:[(0,Se.jsxs)(C.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,Se.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?v(e.target.files[0]):v(null)}})]}),p&&(0,Se.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",p.name]}),!p&&(null===s||void 0===s?void 0:s.thumbnailUrl)&&(0,Se.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",s.thumbnailUrl.substring(s.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,Se.jsx)(E.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>u((o=>(0,n.A)((0,n.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:i,children:"Cancel"}),(0,Se.jsx)(C.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var Ie=r(7493),Re=r(9317),Ee=r(6932),Fe=r(9751),Pe=r(2856),Ue=r(1397),Te=r(3422),De=r(4454);const Oe=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],ze=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],We=[12,14,16,18,20,24,28,32],Me=()=>{var e,o,r,l,B,G;const{roomId:N}=(0,i.g)(),xe=(0,i.Zp)(),{currentUser:fe,blockUser:ye}=(0,s.As)(),be=(0,u.A)(),[Ce,Ae]=(0,t.useState)(null),[we,je]=(0,t.useState)(!0),[Ee,Me]=(0,t.useState)(null),[He,_e]=(0,t.useState)(!1),[Be,Ge]=(0,t.useState)(!1),[Ne,Ve]=(0,t.useState)(""),[Ye,Je]=(0,t.useState)(!1),[Xe,Ze]=(0,t.useState)(!1),[Ke,qe]=(0,t.useState)(!1),[Qe,$e]=(0,t.useState)(!1),[eo,oo]=(0,t.useState)(null),[ro,no]=(0,t.useState)([]),[to,io]=(0,t.useState)(null),[lo,so]=((0,t.useRef)(null),(0,t.useState)(null)),[ao,co]=(0,t.useState)(null),[uo,mo]=(0,t.useState)(null),[ho,po]=(0,t.useState)(!1),[vo,go]=(0,t.useState)(!1),[xo,fo]=(0,t.useState)(0),[yo,bo]=(0,t.useState)(!1),[Co,Ao]=(0,t.useState)(null),wo=(0,t.useRef)(null),[jo,So]=(0,t.useState)(!1),[ko,Io]=(0,t.useState)(""),[Ro,Eo]=(0,t.useState)(null),[Fo,Po]=(0,t.useState)(""),[Uo,To]=(0,t.useState)([]),[Do,Oo]=(0,t.useState)(!1),[zo,Wo]=(0,t.useState)(null),[Mo,Lo]=(0,t.useState)(!1),Ho=(0,t.useRef)(null),[_o,Bo]=(0,t.useState)(null),[Go,No]=(0,t.useState)(!1),[Vo,Yo]=(0,t.useState)([]),[Jo,Xo]=(0,t.useState)(""),[Zo,Ko]=(0,t.useState)(!1),qo=(0,t.useRef)(null),[Qo,$o]=(0,t.useState)(""),[er,or]=(0,t.useState)(!1),[rr,nr]=(0,t.useState)(30),[tr,ir]=(0,t.useState)(!1),[lr,sr]=(0,t.useState)(Oe[0].name),[ar,dr]=(0,t.useState)(!1),[cr,ur]=(0,t.useState)(!1),[mr,hr]=(0,t.useState)(ze[0]),[pr,vr]=(0,t.useState)(We[2]),[gr,xr]=((0,t.useRef)(null),(0,t.useState)(!1)),[fr,yr]=(0,t.useState)(!1),[br,Cr]=(0,t.useState)(window.innerWidth>1024),[Ar,wr]=(0,t.useState)(null),[jr,Sr]=(0,t.useState)(!1),[kr,Ir]=(0,t.useState)(null),[Rr,Er]=(0,t.useState)(null),Fr=(0,t.useRef)([]),[Pr,Ur]=(0,t.useState)(!1),[Tr,Dr]=(0,t.useState)(null),Or="youtube-player-placeholder",[zr,Wr]=(0,t.useState)(!1),[Mr,Lr]=(0,t.useState)(null),Hr=(0,t.useCallback)((()=>{uo&&(console.log("Camera state before toggle:",uo.camera.state),"enabled"!==uo.camera.state.status?(c.oR.loading("Enabling camera..."),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((e=>(console.log("Camera access granted:",e),e.getTracks().forEach((e=>e.stop())),uo.camera.enable()))).then((()=>{Ur(!0),c.oR.dismiss(),c.oR.success("Camera enabled")})).catch((e=>{console.error("Error enabling camera:",e),c.oR.dismiss(),c.oR.error("Could not enable camera. Please check camera permissions in your browser settings.")}))):uo.camera.disable().then((()=>{Ur(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)})))}),[uo]),_r=(0,t.useRef)(0),Br=(0,t.useRef)(0),Gr=(0,t.useRef)(0);(0,t.useEffect)((()=>{const e=()=>{Cr(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,t.useEffect)((()=>{if(uo){const e="enabled"===uo.camera.state.status;Ur(e);const o=setInterval((()=>{const e="enabled"===uo.camera.state.status;Ur(e)}),1e3);return()=>{clearInterval(o)}}}),[uo]),(0,t.useEffect)((()=>{uo&&navigator.mediaDevices.getUserMedia({video:!0}).then((()=>{console.log("Camera permissions granted")})).catch((e=>{console.error("Camera permission denied:",e),c.oR.error("Camera permissions denied. You won't be able to share video.")}))}),[uo]),(0,t.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,Te.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),Bo(o)})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),Bo(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),Bo(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),Bo(null)}}),[]),(0,t.useEffect)((()=>{if(Ke)if(null!==Ce&&void 0!==Ce&&Ce.style){const e=Ce.style,o=Oe.find((o=>o.name===e.themeName));sr(o?e.themeName:Oe[0].name);const r=o||Oe[0];dr(void 0!==e.headerGradient?e.headerGradient:r.headerGradient||!1),ur(void 0!==e.backgroundGradient?e.backgroundGradient:r.backgroundGradient||!1),hr(ze.includes(e.font)?e.font:ze[0]),vr(We.includes(e.headerFontSize)?e.headerFontSize:We[2])}else sr(Oe[0].name),dr(Oe[0].headerGradient||!1),ur(Oe[0].backgroundGradient||!1),hr(ze[0]),vr(We[2])}),[Ke,Ce]),(0,t.useEffect)((()=>{if(!N||!a.db||0===ro.length)return;const e=ro.filter((e=>e.isOnline)).length,o=Date.now(),r=o-Br.current;if(e!==_r.current&&r>1e4){console.log("[Active Users Update] Updating count from ".concat(_r.current," to ").concat(e));const r=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(r,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{_r.current=e,Br.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}_r.current=e}),[N,a.db,ro.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===fe||void 0===fe?void 0:fe.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===Ce||void 0===Ce?void 0:Ce.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===Ce||void 0===Ce?void 0:Ce.viewers)||"null/undefined");const Nr=(0,t.useMemo)((()=>{if(null===fe||void 0===fe||!fe.uid||null===Ce||void 0===Ce||!Ce.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=fe.uid===Ce.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===fe||void 0===fe?void 0:fe.uid,null===Ce||void 0===Ce?void 0:Ce.ownerId]),Vr=(0,t.useMemo)((()=>{if(null===Ce||void 0===Ce||!Ce.viewers||null===fe||void 0===fe||!fe.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=Ce.viewers.some((e=>e.userId===fe.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===Ce||void 0===Ce?void 0:Ce.viewers,null===fe||void 0===fe?void 0:fe.uid]),Yr=!!Ce&&(Nr||!0),Jr=(0,t.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",ro);const e=new Map;ro.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[ro]),Xr=(0,t.useMemo)((()=>{if(!Ce||!Ce.viewers||!Array.isArray(Ce.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(Ce.viewers,null,2));const e=Ce.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[Ce]),Zr=(0,t.useCallback)((async(e,o,r,n,t)=>{if(!e||null===o||void 0===o||!o.uid||!t)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var l,s;const a=(0,d.H9)(r,"users",i),c=await(0,d.x7)(a);let u="",m="",h=(null===(l=o.email)||void 0===l?void 0:l.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let p="viewer";n?p="owner":null!==(s=t.viewers)&&void 0!==s&&s.some((e=>e.userId===i&&"guest"===e.role))&&(p="guest");const v=(0,d.H9)(r,"sideRooms",e,"presence",i),g={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:p,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(g,null,2)),await(0,d.BN)(v,g,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(a){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),a)}}),[]);(0,t.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(N,", HasAccess: ").concat(Yr,", CurrentUserUID: ").concat(null===fe||void 0===fe?void 0:fe.uid,", IsRoomOwner: ").concat(Nr,", RoomExists: ").concat(!!Ce)),Yr&&N&&fe&&Ce?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(fe.uid," in room ").concat(N,".")),Zr(N,fe,a.db,Nr,Ce)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(Yr,", RoomId: ").concat(!!N,", CurrentUser: ").concat(!!fe,", Room: ").concat(!!Ce))}),[N,fe,a.db,Nr,Ce,Yr,Zr]),(0,t.useEffect)((()=>{const e=null===fe||void 0===fe?void 0:fe.uid,o=N;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const r=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[N,null===fe||void 0===fe?void 0:fe.uid,a.db]);const Kr=()=>{So(!0)},qr=()=>{So(!1),Io("")},Qr=()=>{if(!N)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!Nr)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),Eo(null),c.oR.success("Shared video cleared.")};(0,t.useEffect)((()=>{if(null===fe||void 0===fe||!fe.uid||!N||!Yr||lo)return;(async()=>{try{console.log("[Stream] Fetching token for user:",fe.uid),console.log("[Stream] Data being sent - User ID:",fe.uid),console.log("[Stream] Data being sent - Display Name:",fe.displayName),console.log("[Stream] Data being sent - Photo URL:",fe.photoURL);const r="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(r));const n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:fe.uid,userName:fe.displayName||fe.email||"UnknownUser",userImage:fe.photoURL||void 0})});console.log("[Stream] Response status: ".concat(n.status));const t={};if(n.headers.forEach(((e,o)=>{t[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(t,null,2)),!n.ok){var e;let r={error:"HTTP error! Status: ".concat(n.status)};try{const e=await n.text();console.log("[Stream] Non-OK response body (text):",e),r=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),r.error=n.statusText||r.error}throw new Error((null===(e=r)||void 0===e?void 0:e.error)||"HTTP status ".concat(n.status))}const{token:i}=await n.json();if(!i)throw new Error("Stream token was not provided by backend.");so(i),console.log("[Stream] Token fetched successfully.")}catch(Ee){console.error("[Stream] Error fetching token:",Ee),c.oR.error("Stream Token Error: ".concat(Ee.message||"Load failed")),so(null)}})()}),[fe,N,Yr,lo]),(0,t.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!lo||null===fe||void 0===fe||!fe.uid||ao)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!lo,", currentUser=").concat(!(null===fe||void 0===fe||!fe.uid),", apiKey=").concat(!0,", clientExists=").concat(!!ao));console.log("[Stream] Initializing StreamVideoClient with token.");const r=(null===(e=fe.profile)||void 0===e?void 0:e.name)||fe.displayName||fe.email||fe.uid,n=(null===(o=fe.profile)||void 0===o?void 0:o.profilePic)||fe.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(r,", photoURL: ").concat(n));const t={id:fe.uid,name:r,image:n};try{const e=new Ie.Hq({apiKey:"2nufecjmzmzh",user:t,token:lo});co(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(Ee){console.error("[Stream] Error initializing StreamVideoClient:",Ee),c.oR.error("Failed to initialize Stream video client: ".concat(Ee instanceof Error?Ee.message:String(Ee)))}return()=>{ao&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),co(null))}}),[lo,fe,ao]),(0,t.useEffect)((()=>{if(!vo||!ao||!N||null===fe||void 0===fe||!fe.uid)return void(vo&&go(!1));if(uo)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void go(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(N)),po(!0);try{const e=ao.call("default",N);if(await e.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(e.cid)),mo(e),Nr&&N&&a.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(Ee){console.error("[Stream Call] Error joining or creating call:",Ee),c.oR.error("Failed to connect to audio: ".concat(Ee.message||"Unknown error")),mo(null)}finally{po(!1),go(!1)}})(),()=>{go(!1)}}),[vo,ao,N,null===fe||void 0===fe?void 0:fe.uid,uo]),(0,t.useEffect)((()=>()=>{uo&&(console.log("[Stream Call] Leaving active call ".concat(uo.cid," on component unmount or room change.")),uo.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(uo.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(uo.cid,":"),e))).finally((()=>{if(mo(null),Nr&&N&&a.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[uo,N,Nr,a.db]),(0,t.useEffect)((()=>{if(!N||!fe)return;const e=(0,d.H9)(a.db,"sideRooms",N),o=(0,d.aQ)(e,(e=>{if(e.exists()){const r=(0,n.A)({id:e.id},e.data());if(Ae(r),fo(r.heartCount||0),je(!1),r.isPrivate&&r.password&&r.ownerId!==fe.uid){var o;(null===(o=r.viewers)||void 0===o?void 0:o.some((e=>e.userId===fe.uid&&"guest"!==e.role)))||Ge(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(N,"' reported as non-existent. Current error: '").concat(Ee,"'. Setting room state to null.")),Me("Room not found"),Ae(null),je(!1)}));let r;if(null!==fe&&void 0!==fe&&fe.uid){const e=(0,d.H9)(a.db,"sideRooms",N,"heartedBy",fe.uid);r=(0,d.aQ)(e,(e=>{bo(e.exists())}))}const t=(0,d.P)((0,d.rJ)(a.db,"sideRooms",N,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(t,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===fe||void 0===fe?void 0:fe.uid)&&o.username&&(Ao("".concat(o.username," hearted the room!")),wo.current&&clearTimeout(wo.current),wo.current=setTimeout((()=>{Ao(null)}),3e3))}}))}));return()=>{o(),r&&r(),i(),wo.current&&clearTimeout(wo.current)}}),[N,fe]);const $r=async e=>{if(!a.db||!e)return null;try{const o=(0,d.rJ)(a.db,"rooms"),r=(0,d.P)(o,(0,d._M)("createdBy","==",e),(0,d._M)("type","==","public")),n=await(0,d.GG)(r);if(!n.empty){const e=n.docs[0];return{id:e.id,name:e.data().name||"Chat Room"}}return null}catch(Ee){return console.error("[SideRoomComponent] Error checking for server chat room:",Ee),null}};(0,t.useEffect)((()=>{if(null===fe||void 0===fe||!fe.uid||null===Ce||void 0===Ce||!Ce.ownerId)return;(async()=>{try{const e=(0,d.H9)(a.db,"users",Ce.ownerId),o=await(0,d.x7)(e);if(!(o.exists()&&!0===o.data().isPrivate))return;const r=(0,d.H9)(a.db,"users",fe.uid,"following",Ce.ownerId),n=(0,d.H9)(a.db,"users",Ce.ownerId,"followRequests",fe.uid),[t,i]=await Promise.all([(0,d.x7)(r),(0,d.x7)(n)]);if(t.exists()&&!i.exists()){const e=await $r(Ce.ownerId);e&&(Lr(e),Wr(!0))}}catch(Ee){console.error("Error checking follow status:",Ee)}})();const e=(0,d.H9)(a.db,"users",fe.uid,"following",Ce.ownerId),o=(0,d.aQ)(e,(e=>{e.exists()&&$r(Ce.ownerId).then((e=>{e&&(Lr(e),Wr(!0))}))}));return()=>o()}),[fe,Ce,a.db,xe,$r]),(0,t.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(N,", HasAccess: ").concat(Yr,", CurrentUserUID: ").concat(null===fe||void 0===fe?void 0:fe.uid)),!N||!Yr||null===fe||void 0===fe||!fe.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(N,", HasAccess: ").concat(Yr,", UserUID: ").concat(null===fe||void 0===fe?void 0:fe.uid)),void no([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(N));const e=(0,d.rJ)(a.db,"sideRooms",N,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,n.A)({userId:e.id},e.data()))),r=Date.now();let t=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&r-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((r-e.lastSeen)/1e3)," seconds old).")),!t&&a.db&&e.userId!==(null===fe||void 0===fe?void 0:fe.uid)){const o=(0,d.H9)(a.db,"sideRooms",N,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),t=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),no(i);const l=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(l))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),no([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(N,".")),o()}}),[N,Yr,null===fe||void 0===fe?void 0:fe.uid,a.db]),(0,t.useEffect)((()=>{const e=null===fe||void 0===fe?void 0:fe.uid,o=N;return()=>{if(e&&o&&a.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const r=(0,d.H9)(a.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[N,null===fe||void 0===fe?void 0:fe.uid,a.db]),(0,t.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(N,", HasAccess: ").concat(Yr,", CurrentUserUID: ").concat(null===fe||void 0===fe?void 0:fe.uid,", IsRoomOwner: ").concat(Nr,", RoomExists: ").concat(!!Ce)),!N||null===fe||void 0===fe||!fe.uid||!Ce||!Yr){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(N,", UserUID: ").concat(null===fe||void 0===fe?void 0:fe.uid,", HasAccess: ").concat(Yr,", RoomExists: ").concat(!!Ce)),null!==fe&&void 0!==fe&&fe.uid&&N){const e=(0,d.H9)(a.db,"sideRooms",N,"presence",fe.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(fe.uid," in room ").concat(N)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(fe.uid,":"),e)}))}return}const e=fe.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(N,"."));let o=null;return(async()=>{try{var r,n;const t=(0,d.H9)(a.db,"users",e),i=await(0,d.x7)(t);let l="",s="",c=(null===(r=fe.email)||void 0===r?void 0:r.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();l=o.name||o.username||"",s=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(l,"', Pic='").concat(s,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),l=fe.displayName||"",s=fe.photoURL||"";let u="viewer";Nr?u="owner":null!==(n=Ce.viewers)&&void 0!==n&&n.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(a.db,"sideRooms",N,"presence",e),h={userId:e,username:c,avatar:s,lastSeen:Date.now(),isOnline:!0,role:u,displayName:l,photoURL:s},p="sideRooms/".concat(N,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",p,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-Gr.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),Gr.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(Ee){console.error("[Presence Heartbeat] Error updating heartbeat:",Ee)}}),6e4))}catch(t){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),t)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(N,". Setting offline."));const r=(0,d.H9)(a.db,"sideRooms",N,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[N,fe,a.db,Nr,Ce,Yr]),(0,t.useEffect)((()=>{if(N)return()=>{}}),[N]),(0,t.useEffect)((()=>{Ce&&Ce.currentSharedVideoUrl?Eo(Ce.currentSharedVideoUrl):Ce&&!Ce.currentSharedVideoUrl&&Eo(null)}),[Ce]),(0,t.useEffect)((()=>{if(!_o)return;const e=e=>{c.oR.success(e.message),Lo(!1),Po(""),Wo(null),To([]),Ze(!1)},o=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),Lo(!1)},r=e=>{e.roomId===N&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},n=e=>{e.error?(c.oR.error(e.error),To([])):To(e.users)},t=e=>{e===N&&null!==fe&&void 0!==fe&&fe.uid&&((0,c.oR)("The host has removed you from the room."),null===uo||void 0===uo||uo.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{xe("/side-rooms")})))};return _o.on("invite-success",e),_o.on("invite-failed",o),_o.on("guest-joined",r),_o.on("user-search-results-for-invite",n),_o.on("force-remove",t),()=>{_o.off("invite-success",e),_o.off("invite-failed",o),_o.off("guest-joined",r),_o.off("user-search-results-for-invite",n),_o.off("force-remove",t)}}),[_o,N,xe,uo,null===fe||void 0===fe?void 0:fe.uid]);const en=(0,t.useCallback)((0,Ue.debounce)((e=>{e.trim().length>=2&&(_o?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),_o.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[_o]),on=(0,t.useCallback)((()=>{$e(!0)}),[]),rn=(0,t.useCallback)((e=>{oo(e.currentTarget)}),[]),nn=(0,t.useCallback)((()=>{oo(null)}),[]),tn=(0,t.useCallback)((()=>{Je(!0),nn()}),[nn]),ln=(0,t.useCallback)((()=>{qe(!0),nn()}),[nn]),sn=(0,t.useCallback)((()=>{Ze(!0),Po(""),Wo(null),To([]),Oo(!1),nn()}),[nn]),an=(0,t.useCallback)((async()=>{if(Lo(!0),_o&&null!==fe&&void 0!==fe&&fe.uid&&N&&null!==zo&&void 0!==zo&&zo.username){console.log("Emitting invite-user-to-room: ".concat(zo.username));try{var e;const o=(0,d.P)((0,d.rJ)(a.db,"users"),(0,d._M)("username","==",zo.username)),r=await(0,d.GG)(o);if(r.empty)return c.oR.error("User not found."),void Lo(!1);r.docs[0].data();const n=r.docs[0].id,t=(0,d.H9)(a.db,"sideRooms",N),i=await(0,d.x7)(t);if(!i.exists())return c.oR.error("Room not found."),void Lo(!1);const l=i.data();if(null===(e=l.viewers)||void 0===e?void 0:e.some((e=>e.userId===n)))return c.oR.error("".concat(zo.username," is already in this room.")),void Lo(!1);_o.emit("invite-user-to-room",{roomId:N,inviterId:fe.uid,inviteeUsername:zo.username})}catch(Ee){console.error("Error checking if user is in room:",Ee),_o.emit("invite-user-to-room",{roomId:N,inviterId:fe.uid,inviteeUsername:zo.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!_o,currentUser:!(null===fe||void 0===fe||!fe.uid),roomId:N,selectedInviteeForInvite:zo}),c.oR.error("Cannot send invite: connection or user data issue."),Lo(!1)}),[null===fe||void 0===fe?void 0:fe.uid,N,zo,_o,a.db]),dn=(0,t.useCallback)((async()=>{if(N&&Nr&&(nn(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){_e(!0);try{const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),xe("/side-rooms")}catch(Ee){console.error("Error deleting room:",Ee),c.oR.error("Failed to delete room")}finally{_e(!1)}}}),[N,Nr,xe]),cn=(0,t.useCallback)((async(e,o)=>{if(!Nr||!N||e===(null===fe||void 0===fe?void 0:fe.uid))return;console.log("Owner toggling mute for ".concat(e,". Currently muted: ").concat(o));const r=!o,n=(0,d.H9)(a.db,"sideRooms",N,"presence",e);try{await(0,d.mZ)(n,{isMuted:r}),console.warn("[SideRoomComponent] handleForceMuteToggle needs to be connected to the correct signaling (e.g., general Socket.IO emit)"),c.oR.success("User ".concat(r?"muted":"unmuted","."))}catch(Ee){console.error("Error toggling mute for ".concat(e,":"),Ee),c.oR.error("Failed to update mute status.")}}),[Nr,N,null===fe||void 0===fe?void 0:fe.uid,a.db]),un=(0,t.useCallback)(((e,o)=>{if(!Nr||!N||e===(null===fe||void 0===fe?void 0:fe.uid)||!_o)return;const r=o||"this user";window.confirm("Are you sure you want to remove ".concat(r," from the room?"))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(N)),_o.emit("force-remove",{roomId:N,targetUserId:e}),c.oR.success("Removing ".concat(r,"...")))}),[Nr,N,null===fe||void 0===fe?void 0:fe.uid,_o]),mn=(0,t.useCallback)(((e,o)=>{if(!Nr||!N||e===(null===fe||void 0===fe?void 0:fe.uid))return;const r=o||"this user";if(window.confirm("Are you sure you want to block ".concat(r,"? They will be removed from the room.")))try{ye(e).then((()=>{c.oR.success("Blocked ".concat(r)),console.log("User ".concat(e," has been blocked"))})).catch((e=>{console.error("Error blocking user:",e),c.oR.error("Failed to block user")}))}catch(Ee){console.error("Error initiating block:",Ee),c.oR.error("Failed to block user")}}),[Nr,N,null===fe||void 0===fe?void 0:fe.uid,ye]),hn=()=>{setTimeout((()=>{var e;null===(e=qo.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,t.useEffect)((()=>{Go&&hn()}),[Vo,Go,Qo]),(0,t.useEffect)((()=>{if(!er||!Qo)return;let e=0;const o=Qo,r=()=>{e<o.length?(Yo((r=>{const t=[...r];if(t.length>0&&"ai"===t[t.length-1].sender){const r=t[t.length-1];t[t.length-1]=(0,n.A)((0,n.A)({},r),{},{text:o.substring(0,e+1)})}return t})),e++,setTimeout(r,rr)):(or(!1),$o(""))};return r(),()=>{or(!1)}}),[er,Qo,rr]);const pn=e=>{Yo((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,r)=>r===e.length-1?(0,n.A)((0,n.A)({},o),{},{text:""}):o))})),$o(e),or(!0)};(0,t.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?Yo(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(Ee){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",Ee),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,t.useEffect)((()=>{(Vo.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(Vo))}),[Vo]);const vn=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jo).trim();if(!o)return;const r={sender:"user",text:o};Yo((e=>[...e,r])),Xo(""),Ko(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const r="https://sideeye-backend-production.up.railway.app";if(!r)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),pn("Configuration error: Backend URL not set."),void Ko(!1);const t="".concat(r,"/api/sade-ai");if(null===fe||void 0===fe||!fe.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),pn("Error: Could not identify user."),void Ko(!1);Yo((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),l=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),s={message:o,forceSearch:e,userId:fe.uid,contextFlags:{avoidAppInstructions:i&&!l,isGreeting:i,isInstructionQuery:l,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",s);const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},d=await fetch(t,a);if(Yo((e=>e.filter(((o,r)=>r!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(n){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(Yo((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),pn(c.response)):pn(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),pn("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),pn("Sorry, I got a bit confused there."))}catch(t){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",t),Yo((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),pn("Sorry, there was an error: ".concat(t.message||"Unknown error"))}finally{Ko(!1),hn()}};(0,t.useEffect)((()=>{const e=Ro?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(Ro):null,o=()=>{if(Tr&&(Tr.destroy(),Dr(null)),e&&document.getElementById(Or)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(Or,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});Dr(o)}else!e&&Tr&&(Tr.destroy(),Dr(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{Tr&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),Tr.destroy(),Dr(null))}}),[Ro]);const gn=e=>(0,Se.jsx)("div",{id:Or,style:{width:"100%",height:"100%"}}),xn=async()=>{if(!fe||!fe.uid||!N||!Ce)return;const e=(0,d.H9)(a.db,"sideRooms",N,"heartedBy",fe.uid),o=(0,d.H9)(a.db,"sideRooms",N);try{await(0,d.c4)(a.db,(async r=>{var n;const t=await r.get(e);if(!(await r.get(o)).exists())throw"Room does not exist!";const i=await(0,d.x7)((0,d.H9)(a.db,"users",fe.uid)),l=i.exists()?(null===(n=i.data())||void 0===n?void 0:n.username)||fe.displayName:"Someone";t.exists()?(r.delete(e),r.update(o,{heartCount:(0,d.GV)(-1)})):(r.set(e,{userId:fe.uid,username:l,timestamp:(0,d.O5)()}),r.update(o,{heartCount:(0,d.GV)(1)}))}))}catch(Ee){console.error("Error hearting room:",Ee),c.oR.error("Failed to update heart status.")}},fn=Ce?"".concat(Ce.name," - SideEye"):we?"Loading Room...":"Room Not Found - SideEye",yn=Ce&&Ce.description||"Join the conversation on SideEye.",bn="".concat(window.location.origin,"/default-app-logo.png"),Cn=(null===Ce||void 0===Ce?void 0:Ce.thumbnailUrl)||bn,An="".concat(window.location.origin,"/side-room/").concat(N||"");if(we&&!Ce)return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(Pe.mg,{children:(0,Se.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,Se.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,Se.jsx)(A.A,{})})]});if(Ee&&!Ce)return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(Pe.mg,{children:(0,Se.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,Se.jsxs)(m.A,{sx:{p:3,textAlign:"center"},children:[(0,Se.jsx)(w.A,{severity:"error",children:Ee}),(0,Se.jsxs)(C.A,{onClick:()=>xe("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const wn=async()=>{if(uo)if(br)try{await uo.screenShare.toggle();const e=uo.screenShare.enabled;yr(e),e?(c.oR.success("Screen sharing started. All participants will see your screen automatically."),_o&&null!==Ce&&void 0!==Ce&&Ce.id&&null!==fe&&void 0!==fe&&fe.uid&&_o.emit("start-screen-share",{roomId:Ce.id,userId:fe.uid})):(c.oR.success("Screen sharing stopped."),_o&&null!==Ce&&void 0!==Ce&&Ce.id&&null!==fe&&void 0!==fe&&fe.uid&&_o.emit("stop-screen-share",{roomId:Ce.id,userId:fe.uid}))}catch(Ee){var e,o,r,n;console.error("Error toggling screen share:",Ee),"NotAllowedError"===Ee.name||null!==(e=Ee.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=Ee.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(r=Ee.message)&&void 0!==r&&r.includes("getDisplayMedia is not supported")||null!==(n=Ee.message)&&void 0!==n&&n.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(Ee.message||"Unknown error")),uo.screenShare&&yr(uo.screenShare.enabled)}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")},jn=async()=>{if(Ce&&Ne&&fe){_e(!0);try{if(Ce.password===Ne){const e=(0,d.H9)(a.db,"sideRooms",N),o=await(0,d.x7)(e),r=o.data().viewers||[];r.some((e=>e.userId===fe.uid))||await(0,d.mZ)(e,{viewers:[...r,{userId:fe.uid,username:fe.displayName||fe.email||"User",role:"viewer",joinedAt:(0,d.O5)()}]}),c.oR.success("Password correct. Welcome to the room!"),Ge(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(Ee){console.error("Error verifying password:",Ee),c.oR.error("An error occurred. Please try again.")}finally{_e(!1)}}else c.oR.error("Missing information. Please try again.")},Sn=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))c.oR.error("Screen recording is not fully supported on mobile devices. Please use a desktop browser for this feature.");else try{var e;if(null===(e=navigator.mediaDevices)||void 0===e||!e.getDisplayMedia)return void c.oR.error("Screen recording is not supported in your browser.");const o=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),r=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaStream;o.getVideoTracks().forEach((e=>{n.addTrack(e)})),o.getAudioTracks().forEach((e=>{n.addTrack(e)})),r.getAudioTracks().forEach((e=>{n.addTrack(e)}));const t=new MediaRecorder(n,{mimeType:"video/webm"});t.ondataavailable=e=>{e.data.size>0&&Fr.current.push(e.data)},t.onstop=()=>{const e=new Blob(Fr.current,{type:"video/webm"}),o=URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=o,r.download="sideeye-room-recording-".concat((new Date).toISOString(),".webm"),document.body.appendChild(r),r.click(),setTimeout((()=>{document.body.removeChild(r),window.URL.revokeObjectURL(o),Fr.current=[]}),100),n.getTracks().forEach((e=>e.stop())),Ir(null),Er(null),Sr(!1),c.oR.success("Recording saved to your device")},t.start(),Ir(n),Er(t),Sr(!0),c.oR.success("Screen recording started with audio"),o.getVideoTracks()[0].onended=()=>{"inactive"!==t.state&&t.stop()}}catch(Ee){console.error("Error starting screen recording:",Ee),c.oR.error("Could not start screen recording. Please make sure you've granted the necessary permissions.")}},kn=()=>{Rr&&"inactive"!==Rr.state&&Rr.stop(),kr&&kr.getTracks().forEach((e=>e.stop()))},In=()=>{Wr(!1)};return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)(Pe.mg,{children:[(0,Se.jsx)("title",{children:fn}),(0,Se.jsx)("meta",{name:"description",content:yn}),(0,Se.jsx)("meta",{property:"og:type",content:"website"}),(0,Se.jsx)("meta",{property:"og:url",content:An}),(0,Se.jsx)("meta",{property:"og:title",content:fn}),(0,Se.jsx)("meta",{property:"og:description",content:yn}),(0,Se.jsx)("meta",{property:"og:image",content:Cn}),(0,Se.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,Se.jsx)("meta",{property:"og:image:height",content:"630"}),(0,Se.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,Se.jsx)("meta",{name:"twitter:url",content:An}),(0,Se.jsx)("meta",{name:"twitter:title",content:fn}),(0,Se.jsx)("meta",{name:"twitter:description",content:yn}),(0,Se.jsx)("meta",{name:"twitter:image",content:Cn})]}),(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===Ce||void 0===Ce||null===(e=Ce.style)||void 0===e?void 0:e.font)||ze[0],backgroundColor:null!==Ce&&void 0!==Ce&&null!==(o=Ce.style)&&void 0!==o&&o.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Ce||void 0===Ce||null===(r=Ce.style)||void 0===r?void 0:r.backgroundColor)||be.palette.background.default,", ").concat((null===Ce||void 0===Ce||null===(l=Ce.style)||void 0===l?void 0:l.accentColor)||be.palette.secondary.main,")"):(null===Ce||void 0===Ce||null===(B=Ce.style)||void 0===B?void 0:B.backgroundColor)||be.palette.background.default,color:(null===Ce||void 0===Ce||null===(G=Ce.style)||void 0===G?void 0:G.textColor)||be.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[Ce&&(()=>{var e,o,r,n,t,i,l,s,u,w,j,S,k,I,R,E,F,P,U,T,D,O,z,W,M,L;return(0,Se.jsxs)(m.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==Ce&&void 0!==Ce&&null!==(e=Ce.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Ce||void 0===Ce||null===(o=Ce.style)||void 0===o?void 0:o.headerColor)||be.palette.primary.main,", ").concat((null===Ce||void 0===Ce||null===(r=Ce.style)||void 0===r?void 0:r.accentColor)||be.palette.secondary.light,")"):(null===Ce||void 0===Ce||null===(n=Ce.style)||void 0===n?void 0:n.headerColor)||be.palette.background.paper,color:(null===Ce||void 0===Ce||null===(t=Ce.style)||void 0===t?void 0:t.textColor)||"inherit"},children:[(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,Se.jsx)(h.A,{variant:"h6",sx:{fontFamily:(null===Ce||void 0===Ce||null===(i=Ce.style)||void 0===i?void 0:i.font)||ze[0],fontSize:null!==Ce&&void 0!==Ce&&null!==(l=Ce.style)&&void 0!==l&&l.headerFontSize?"".concat(Ce.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===Ce||void 0===Ce?void 0:Ce.name}),Xr&&(0,Se.jsxs)(h.A,{variant:"caption",sx:{opacity:null!==Ce&&void 0!==Ce&&null!==(s=Ce.style)&&void 0!==s&&s.textColor?.85:1,fontFamily:(null===Ce||void 0===Ce||null===(u=Ce.style)||void 0===u?void 0:u.font)||ze[0]},children:["Host: ",Xr.username]})]}),(0,Se.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===fe||void 0===fe?void 0:fe.uid)&&(null===Ce||void 0===Ce?void 0:Ce.ownerId)&&fe.uid!==Ce.ownerId&&Xr&&(0,Se.jsx)(p.A,{title:"Follow ".concat(Xr.username),children:(0,Se.jsx)(v.A,{onClick:async()=>{if(null!==fe&&void 0!==fe&&fe.uid&&null!==Ce&&void 0!==Ce&&Ce.ownerId&&a.db)try{const e=(0,d.H9)(a.db,"users",fe.uid,"following",Ce.ownerId),o=await(0,d.x7)(e),r=(0,d.H9)(a.db,"users",Ce.ownerId,"followRequests",fe.uid),n=await(0,d.x7)(r),t=(0,d.H9)(a.db,"users",Ce.ownerId),i=await(0,d.x7)(t),l=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(a.db,"users",Ce.ownerId,"followers",fe.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(Xr.username))}else if(n.exists())await(0,d.kd)(r),c.oR.success("Canceled follow request to ".concat(Xr.username));else if(l)await(0,d.BN)(r,{userId:fe.uid,username:fe.displayName||fe.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(Xr.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(a.db,"users",Ce.ownerId,"followers",fe.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(Xr.username));const r=await $r(Ce.ownerId);r&&(Lr(r),Wr(!0))}}catch(Ee){console.error("Error toggling follow:",Ee),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===Ce||void 0===Ce||null===(w=Ce.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,Se.jsx)(V.A,{})})}),(0,Se.jsx)(p.A,{title:yo?"Unheart Room":"Heart Room",children:(0,Se.jsx)(v.A,{onClick:xn,color:yo?"error":"inherit",sx:{color:yo?be.palette.error.main:(null===Ce||void 0===Ce||null===(j=Ce.style)||void 0===j?void 0:j.accentColor)||"inherit"},disabled:tr,children:yo?(0,Se.jsx)(Y.A,{}):(0,Se.jsx)(J.A,{})})}),(0,Se.jsx)(g.A,{badgeContent:xo>0?xo:"0",sx:{mr:1,"& .MuiBadge-badge":{backgroundColor:(null===Ce||void 0===Ce||null===(S=Ce.style)||void 0===S?void 0:S.accentColor)||be.palette.primary.main,color:null!==Ce&&void 0!==Ce&&null!==(k=Ce.style)&&void 0!==k&&k.textColor&&null!==Ce&&void 0!==Ce&&null!==(I=Ce.style)&&void 0!==I&&I.accentColor?be.palette.getContrastText(Ce.style.accentColor):be.palette.primary.contrastText}}}),(0,Se.jsx)(p.A,{title:"Share",children:(0,Se.jsx)(v.A,{onClick:on,sx:{color:(null===Ce||void 0===Ce||null===(R=Ce.style)||void 0===R?void 0:R.accentColor)||"inherit"},children:(0,Se.jsx)(X.A,{})})}),Nr&&(0,Se.jsx)(p.A,{title:"Share Video Link",children:(0,Se.jsx)(v.A,{onClick:Kr,size:"small",color:"secondary",children:(0,Se.jsx)(Z.A,{})})}),(0,Se.jsx)(p.A,{title:"Chat with Sade AI",children:(0,Se.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>No(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===Ce||void 0===Ce||null===(E=Ce.style)||void 0===E?void 0:E.accentColor)||be.palette.primary.light)}})}),br&&(0,Se.jsx)(p.A,{title:jr?"Stop Recording":"Record Room (Desktop Only)",children:(0,Se.jsx)(v.A,{onClick:jr?kn:Sn,color:jr?"error":"inherit",sx:{color:jr?be.palette.error.main:(null===Ce||void 0===Ce||null===(F=Ce.style)||void 0===F?void 0:F.accentColor)||"inherit"},children:jr?(0,Se.jsx)(K.A,{}):(0,Se.jsx)(q.A,{})})}),uo&&(0,Se.jsx)(p.A,{title:Pr?"Turn Camera Off":"Turn Camera On",children:(0,Se.jsx)(v.A,{onClick:Hr,sx:{color:Pr?(null===Ce||void 0===Ce||null===(P=Ce.style)||void 0===P?void 0:P.accentColor)||be.palette.primary.main:"inherit"},children:Pr?(0,Se.jsx)(q.A,{}):(0,Se.jsx)(Q.A,{})})}),Nr&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(p.A,{title:"Room Settings",children:(0,Se.jsx)(v.A,{onClick:rn,sx:{color:(null===Ce||void 0===Ce||null===(U=Ce.style)||void 0===U?void 0:U.accentColor)||"inherit"},children:(0,Se.jsx)($.A,{})})}),(0,Se.jsxs)(f.A,{anchorEl:eo,open:Boolean(eo),onClose:nn,children:[(0,Se.jsxs)(y.A,{onClick:tn,children:[" ",(0,Se.jsx)(b.A,{children:(0,Se.jsx)(ee.A,{fontSize:"small"})}),"Edit Room"]}),(0,Se.jsxs)(y.A,{onClick:ln,children:[" ",(0,Se.jsx)(b.A,{children:(0,Se.jsx)(oe.A,{fontSize:"small"})}),"Customize"]}),(0,Se.jsxs)(y.A,{onClick:sn,children:[" ",(0,Se.jsx)(b.A,{children:(0,Se.jsx)(V.A,{fontSize:"small"})}),"Invite"]}),(0,Se.jsxs)(y.A,{onClick:dn,sx:{color:"error.main"},children:[(0,Se.jsx)(b.A,{children:(0,Se.jsx)(re.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,Se.jsx)(p.A,{title:"Leave Room",children:(0,Se.jsx)(v.A,{onClick:()=>{Nr?xr(!0):xe("/side-rooms")},disabled:He,sx:{color:(null===Ce||void 0===Ce||null===(T=Ce.style)||void 0===T?void 0:T.accentColor)||"inherit"},children:(0,Se.jsx)(ne.A,{})})}),Nr&&br&&uo&&(0,Se.jsx)(p.A,{title:fr?"Stop Sharing Screen":"Share Screen (Desktop Only)",children:(0,Se.jsx)(v.A,{onClick:wn,sx:{color:(null===Ce||void 0===Ce||null===(D=Ce.style)||void 0===D?void 0:D.accentColor)||"inherit"},children:fr?(0,Se.jsx)(te.A,{}):(0,Se.jsx)(ie.A,{})})})]})]}),(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Se.jsxs)(h.A,{variant:"caption",sx:{fontFamily:(null===Ce||void 0===Ce||null===(O=Ce.style)||void 0===O?void 0:O.font)||ze[0]},children:[Jr.length," Online"]}),(0,Se.jsxs)(m.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!uo&&ao&&Yr&&(0,Se.jsx)(C.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),uo?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):go(!0)},startIcon:ho?(0,Se.jsx)(A.A,{size:20,color:"inherit"}):(0,Se.jsx)(le.A,{}),disabled:ho||!ao,sx:{backgroundColor:null===Ce||void 0===Ce||null===(z=Ce.style)||void 0===z?void 0:z.accentColor,fontFamily:(null===Ce||void 0===Ce||null===(W=Ce.style)||void 0===W?void 0:W.font)||ze[0],color:null!==Ce&&void 0!==Ce&&null!==(M=Ce.style)&&void 0!==M&&M.accentColor?be.palette.getContrastText(Ce.style.accentColor):void 0},children:ho?"Connecting...":"Connect Audio (Stream)"}),uo&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(p.A,{title:"Toggle Microphone",children:(0,Se.jsxs)(v.A,{onClick:async()=>{var e;if(null===uo||void 0===uo||!uo.microphone||null===fe||void 0===fe||!fe.uid||!N)return;const o=ro.find((e=>e.userId===fe.uid)),r=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await uo.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(r));const e=(0,d.H9)(a.db,"sideRooms",N,"presence",fe.uid);await(0,d.mZ)(e,{isMuted:r}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(fe.uid," to ").concat(r))}catch(Ee){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",Ee),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==uo&&void 0!==uo&&uo.microphone)||!(null!==fe&&void 0!==fe&&fe.uid)||!N,children:[(0,Se.jsx)(se.A,{})," "]})}),(0,Se.jsx)(h.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,Se.jsx)(C.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===uo||void 0===uo||uo.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),xe("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:ho,sx:{fontFamily:(null===Ce||void 0===Ce||null===(L=Ce.style)||void 0===L?void 0:L.font)||ze[0]},children:"Leave Audio"})]}),!ao&&we&&(0,Se.jsx)(A.A,{size:24})]})]})]})})(),(0,Se.jsx)(m.A,{sx:{flexGrow:1,overflowY:"auto"},children:Ce?ao?uo?(0,Se.jsx)(Re.Mf9,{client:ao,children:(0,Se.jsx)(Re.xwR,{call:uo,children:(0,Se.jsx)(Le,{room:Ce,isRoomOwner:Nr,isGuest:Vr,handleOpenShareVideoDialog:Kr,handleClearSharedVideo:Qr,currentVideoUrl:Ro,renderVideoPlayer:gn,onForceMuteToggle:cn,onForceRemove:un,onForceBan:mn,theme:be,navigate:xe})})}):(0,Se.jsxs)(m.A,{sx:{flexGrow:1,p:2},children:[Ro&&(0,Se.jsxs)(m.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Se.jsx)(h.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),Nr&&(0,Se.jsx)(p.A,{title:"Clear Shared Video",children:(0,Se.jsx)(v.A,{onClick:Qr,size:"small",children:(0,Se.jsx)(ae.A,{})})})]}),(0,Se.jsx)(m.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:gn()})]}),(0,Se.jsxs)(h.A,{variant:"h6",gutterBottom:!0,children:["Participants (",Jr.length,")"]}),(0,Se.jsx)(j.Ay,{container:!0,spacing:2,children:Jr.map((e=>(0,Se.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,Se.jsxs)(S.A,{sx:{p:1,textAlign:"center"},children:[(0,Se.jsx)(x.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,Se.jsx)(h.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,Se.jsx)(de.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!uo&&!ho&&Yr&&(0,Se.jsx)(w.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),ho&&(0,Se.jsx)(w.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===lo&&Yr&&null!==fe&&void 0!==fe&&fe.uid&&N||null!==lo&&!ao?(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(A.A,{sx:{mb:2}}),(0,Se.jsx)(h.A,{children:"Initializing audio components..."}),(0,Se.jsx)(h.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!Yr&&null!==fe&&void 0!==fe&&fe.uid?(0,Se.jsx)(w.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,Se.jsx)(w.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,Se.jsx)(C.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[we&&(0,Se.jsx)(A.A,{}),!we&&(0,Se.jsxs)(w.A,{severity:"error",children:["Room not found. ",(0,Se.jsx)(C.A,{onClick:()=>xe("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,Se.jsxs)(k.A,{open:jo,onClose:qr,fullWidth:!0,maxWidth:"sm",children:[(0,Se.jsx)(I.A,{children:"Share a Video"}),(0,Se.jsx)(R.A,{children:(0,Se.jsx)(E.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:ko,onChange:e=>Io(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:qr,children:"Cancel"}),(0,Se.jsx)(C.A,{onClick:()=>{if(!N)return void c.oR.error("Cannot share video: Room ID is missing.");if(!ko.trim())return void c.oR.error("Please enter a video URL.");if(!ko.startsWith("http://")&&!ko.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(a.db,"sideRooms",N);(0,d.mZ)(e,{currentSharedVideoUrl:ko,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),Eo(ko),c.oR.success("Video shared!"),qr()},variant:"contained",children:"Share Video"})]})]}),(0,Se.jsxs)(k.A,{open:Qe,onClose:()=>$e(!1),fullWidth:!0,maxWidth:"xs",children:[(0,Se.jsx)(I.A,{children:"Share this Room"}),(0,Se.jsxs)(R.A,{sx:{textAlign:"center"},children:[(0,Se.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,Se.jsx)(E.A,{fullWidth:!0,variant:"outlined",value:An,InputProps:{readOnly:!0},sx:{mb:2}}),(0,Se.jsx)(C.A,{variant:"contained",startIcon:(0,Se.jsx)(ce.A,{}),onClick:()=>{navigator.clipboard.writeText(An),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,Se.jsx)(h.A,{variant:"subtitle2",gutterBottom:!0,children:"Or share on:"}),(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,Se.jsx)(v.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(An),"&text=").concat(encodeURIComponent((null===Ce||void 0===Ce?void 0:Ce.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,Se.jsx)(ue.A,{})}),(0,Se.jsx)(v.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent(An)),"_blank"),title:"Share on Facebook",children:(0,Se.jsx)(me.A,{})}),(0,Se.jsx)(v.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===Ce||void 0===Ce?void 0:Ce.name)||"Join my SideEye Room!")+" "+An)),"_blank"),title:"Share on WhatsApp",children:(0,Se.jsx)(he.A,{})}),(0,Se.jsx)(v.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText(An),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,Se.jsx)(pe.A,{})})]})]}),(0,Se.jsx)(F.A,{children:(0,Se.jsx)(C.A,{onClick:()=>$e(!1),children:"Close"})})]}),(0,Se.jsxs)(k.A,{open:Go,onClose:()=>No(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,Se.jsxs)(I.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,Se.jsx)(p.A,{title:"Clear Chat History",children:(0,Se.jsx)(v.A,{onClick:()=>{Yo([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,Se.jsx)(re.A,{})})})]}),(0,Se.jsx)(R.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:be.palette.background.default},children:(0,Se.jsxs)(P.A,{sx:{p:0},children:[Vo.map(((e,o)=>(0,Se.jsxs)(U.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,Se.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,Se.jsx)(S.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,Se.jsx)(De.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),Zo&&(0,Se.jsxs)(U.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,Se.jsx)(x.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Se.jsx)(S.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,Se.jsx)("div",{ref:qo})]})}),(0,Se.jsxs)(F.A,{sx:{p:1,borderTop:"1px solid ".concat(be.palette.divider),flexDirection:"column"},children:[Vo.length<=1&&!Zo&&(0,Se.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,Se.jsx)(T.A,{label:e,onClick:()=>vn(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,Se.jsxs)(m.A,{sx:{display:"flex",width:"100%"},children:[(0,Se.jsx)(E.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:Jo,onChange:e=>Xo(e.target.value),onKeyPress:e=>"Enter"===e.key&&!Zo&&vn(),sx:{mr:1},disabled:Zo}),(0,Se.jsxs)(v.A,{onClick:()=>!Zo&&vn(Jo,!1),disabled:Zo||!Jo.trim(),color:"primary",children:[(0,Se.jsx)(X.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,Se.jsxs)(v.A,{onClick:()=>!Zo&&vn(Jo,!0),disabled:Zo||!Jo.trim(),color:"secondary",title:"Search the web",children:[(0,Se.jsx)(ve.A,{})," "]})]})]})]}),Ye&&Ce&&(0,Se.jsx)(ke,{open:Ye,onClose:()=>Je(!1),onSubmit:async(e,o)=>{if(N&&fe){_e(!0);try{let r=Ce.thumbnailUrl||"";if(o){const e=(0,Fe.KR)(a.IG,"room-thumbnails/".concat(N,"_").concat(Date.now(),"_").concat(o.name));await(0,Fe.D)(e,o),r=await(0,Fe.qk)(e)}const n=(0,d.H9)(a.db,"sideRooms",N),t={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:r,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?t.password=e.password:e.isPrivate||(t.password=(0,d.CL)()),await(0,d.mZ)(n,t),c.oR.success("Room details updated successfully!"),Je(!1)}catch(r){console.error("Error updating room:",r),c.oR.error("Failed to update room details.")}finally{_e(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:Ce,title:"Edit Room",submitButtonText:"Save Changes"}),(0,Se.jsxs)(k.A,{open:Ke,onClose:()=>qe(!1),fullWidth:!0,maxWidth:"sm",children:[(0,Se.jsx)(I.A,{children:"Customize Room Appearance"}),(0,Se.jsx)(R.A,{children:(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Se.jsxs)(D.A,{fullWidth:!0,children:[(0,Se.jsx)(O.A,{id:"theme-select-label",children:"Theme"}),(0,Se.jsx)(z.A,{labelId:"theme-select-label",value:lr,label:"Theme",onChange:e=>sr(e.target.value),children:Oe.map((e=>(0,Se.jsx)(y.A,{value:e.name,children:e.name},e.name)))})]}),(0,Se.jsxs)(D.A,{fullWidth:!0,children:[(0,Se.jsx)(O.A,{id:"font-select-label",children:"Font"}),(0,Se.jsx)(z.A,{labelId:"font-select-label",value:mr,label:"Font",onChange:e=>hr(e.target.value),children:ze.map((e=>(0,Se.jsx)(y.A,{value:e,children:e},e)))})]}),(0,Se.jsxs)(D.A,{fullWidth:!0,children:[(0,Se.jsx)(O.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,Se.jsx)(z.A,{labelId:"text-size-select-label",value:pr.toString(),label:"Header Text Size (px)",onChange:e=>vr(Number(e.target.value)),children:We.map((e=>(0,Se.jsx)(y.A,{value:e.toString(),children:e},e)))})]}),(0,Se.jsx)(W.A,{control:(0,Se.jsx)(M.A,{checked:ar,onChange:e=>dr(e.target.checked)}),label:"Use Header Gradient"}),(0,Se.jsx)(W.A,{control:(0,Se.jsx)(M.A,{checked:cr,onChange:e=>ur(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:()=>qe(!1),children:"Cancel"}),(0,Se.jsx)(C.A,{onClick:async()=>{var e,o,r,n,t;if(!N||!Ce)return void c.oR.error("Cannot save style: Room data is missing.");if(!fe)return void c.oR.error("You must be logged in to change the style.");if(!Nr)return void c.oR.error("Only the room owner can change the style.");const i=Oe.find((e=>e.name===lr));if(!i){var l,s,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=Oe[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:mr,headerFontSize:pr,headerGradient:ar,backgroundGradient:cr,customCss:(null===(l=Ce.style)||void 0===l?void 0:l.customCss)||"",bannerUrl:(null===(s=Ce.style)||void 0===s?void 0:s.bannerUrl)||"",stickers:(null===(u=Ce.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=Ce.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=Ce.style)||void 0===h?void 0:h.thumbnailUrl)||Ce.thumbnailUrl||""};try{const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),qe(!1)}catch(Ee){console.error("Error updating room style with default theme:",Ee),c.oR.error("Failed to update room style.")}finally{_e(!1)}return}const p={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:mr,headerFontSize:pr,headerGradient:ar,backgroundGradient:cr,customCss:(null===(e=Ce.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=Ce.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(r=Ce.style)||void 0===r?void 0:r.stickers)||[],glitterEffect:(null===(n=Ce.style)||void 0===n?void 0:n.glitterEffect)||!1,thumbnailUrl:(null===(t=Ce.style)||void 0===t?void 0:t.thumbnailUrl)||Ce.thumbnailUrl||""};_e(!0);try{const e=(0,d.H9)(a.db,"sideRooms",N);await(0,d.mZ)(e,{style:p,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),qe(!1)}catch(Ee){console.error("Error updating room style:",Ee),c.oR.error("Failed to update room style.")}finally{_e(!1)}},variant:"contained",disabled:He,children:He?(0,Se.jsx)(A.A,{size:24}):"Save Style"})]})]}),(0,Se.jsxs)(k.A,{open:Xe,onClose:()=>{Ze(!1),Po(""),Wo(null),To([]),Oo(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,Se.jsx)(I.A,{children:"Invite User to Room"}),(0,Se.jsxs)(R.A,{children:[(0,Se.jsx)(h.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,Se.jsxs)(m.A,{ref:Ho,sx:{position:"relative"},children:[(0,Se.jsx)(E.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:Fo,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Po(o),Wo(null),o.trim().length>=2?(Oo(!0),en(o)):(Oo(!1),To([]))},sx:{mb:1}}),Do&&Uo.length>0&&(0,Se.jsx)(S.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:be.zIndex.modal+1,mt:.5},children:(0,Se.jsx)(L.x,{onClickAway:()=>{Oo(!1)},children:(0,Se.jsx)(P.A,{dense:!0,children:Uo.map((e=>(0,Se.jsxs)(U.Ay,{button:!0,onClick:()=>{return Wo(o=e),Po(o.username),Oo(!1),void To([]);var o},children:[(0,Se.jsx)(H.A,{children:(0,Se.jsx)(x.A,{src:e.profilePic,alt:e.username})}),(0,Se.jsx)(_.A,{primary:(0,Se.jsxs)(m.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,Se.jsx)(ge.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),Do&&0===Uo.length&&Fo.length>=2&&(0,Se.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',Fo,'".']})]}),zo&&(0,Se.jsxs)(h.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",zo.username,(0,Se.jsx)(ge.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:()=>{Ze(!1),Po(""),Wo(null),To([]),Oo(!1)},children:"Cancel"}),(0,Se.jsx)(C.A,{onClick:an,variant:"contained",disabled:Mo||!zo||!_o,children:Mo?(0,Se.jsx)(A.A,{size:24}):"Send Invite"})]})]}),(0,Se.jsxs)(k.A,{open:gr,onClose:()=>xr(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,Se.jsx)(I.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,Se.jsxs)(R.A,{children:[(0,Se.jsx)(h.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,Se.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:()=>xr(!1),disabled:He,children:"Cancel"}),(0,Se.jsx)(C.A,{onClick:()=>{xr(!1),dn()},color:"error",variant:"contained",disabled:He,autoFocus:!0,children:He?(0,Se.jsx)(A.A,{size:24}):"End and Delete"})]})]}),(0,Se.jsxs)(k.A,{open:Be,onClose:()=>{Nr||Yr||xe("/side-rooms")},children:[(0,Se.jsx)(I.A,{children:"Password Required"}),(0,Se.jsxs)(R.A,{children:[(0,Se.jsx)(h.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,Se.jsx)(E.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Ne,onChange:e=>Ve(e.target.value),onKeyPress:e=>"Enter"===e.key&&jn()})]}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:()=>xe("/side-rooms"),disabled:He,children:"Cancel"}),(0,Se.jsx)(C.A,{onClick:jn,disabled:He||!Ne,variant:"contained",children:He?(0,Se.jsx)(A.A,{size:24}):"Submit"})]})]}),(0,Se.jsxs)(k.A,{open:zr,onClose:In,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,Se.jsx)(I.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,Se.jsx)(R.A,{children:(0,Se.jsxs)(h.A,{variant:"body1",children:[(null===Xr||void 0===Xr?void 0:Xr.username)||"This creator",' has a server chat room: "',null===Mr||void 0===Mr?void 0:Mr.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,Se.jsxs)(F.A,{children:[(0,Se.jsx)(C.A,{onClick:In,children:"Not Now"}),(0,Se.jsx)(C.A,{onClick:()=>{Mr&&xe("/chat/room/".concat(Mr.id)),Wr(!1)},variant:"contained",color:"primary",children:"Join Chat Room"})]})]})]})]})},Le=e=>{var o,r,i,l,u,f,y,b,w,k,I,R,F,P,U,D,O,z,W,M,L,H,_,V,Y,J,X,K,$,ee,oe,re,ie,le,ce,ue,me,he,pe,ve,ge,Ce,Ae,we,je,ke,Ie,Fe,Pe,Ue,Te;let{room:De,isRoomOwner:Oe,isGuest:ze,handleOpenShareVideoDialog:We,handleClearSharedVideo:Me,currentVideoUrl:Le,renderVideoPlayer:_e,onForceMuteToggle:Be,onForceRemove:Ge,onForceBan:Ne,theme:Ve,navigate:Ye}=e;const Je=(0,Ee.Gc)(),{useParticipants:Xe,useCallState:Ze,useMicrophoneState:Ke,useCameraState:qe}=(0,Ee.R3)(),Qe=Xe(),{localParticipant:$e}=Ze(),{isMute:eo}=Ke(),{isEnabled:oo,isTogglePending:ro}=qe(),{currentUser:no}=(0,s.As)(),[to,io]=(0,t.useState)(window.innerWidth>1024),[lo,so]=(0,t.useState)(!0),[ao,co]=(0,t.useState)(!1),[uo,mo]=(0,t.useState)([]),[ho,po]=(0,t.useState)([]),[vo,go]=(0,t.useState)("participants"),[xo,fo]=(0,t.useState)([]),[yo,bo]=(0,t.useState)(""),Co=(0,t.useRef)(null),Ao=Qe.find((e=>e.screenShareStream)),wo=(null===Ao||void 0===Ao?void 0:Ao.userId)===De.ownerId;(0,t.useEffect)((()=>{Ao&&(console.log("Screen sharing detected from participant ".concat(Ao.name||Ao.userId)),wo&&console.log("Room owner is sharing their screen - should be visible to ALL participants"))}),[Ao,wo]);(0,t.useEffect)((()=>{wo&&Ao&&console.log("Room owner is sharing screen - should be visible to all participants")}),[wo,Ao]),(0,t.useEffect)((()=>{Ao&&console.log("Screen sharing available from participant: ".concat(Ao.name||Ao.userId))}),[Ao]);const[jo,So]=(0,t.useState)({}),ko=(0,t.useCallback)((async e=>{if(jo[e])return jo[e];try{const o=(0,d.H9)(a.db,"users",e),r=await(0,d.x7)(o);if(r.exists()){const o=r.data(),t={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return So((o=>(0,n.A)((0,n.A)({},o),{},{[e]:t}))),t}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return So((r=>(0,n.A)((0,n.A)({},r),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[jo,a.db]),Io=(0,t.useCallback)((async()=>{if(!yo.trim()||null===no||void 0===no||!no.uid||null===De||void 0===De||!De.id||!a.db)return;const e=await ko(no.uid),o={id:"".concat(Date.now(),"-").concat(no.uid),userId:no.uid,userName:e.username,message:yo.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(a.db,"sideRooms",De.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(r){console.error("[Chat] Error sending message to Firestore:",r),fo((e=>[...e,o]))}bo("")}),[yo,null===no||void 0===no?void 0:no.uid,null===De||void 0===De?void 0:De.id,a.db,ko]);(0,t.useEffect)((()=>{if(null===De||void 0===De||!De.id||!a.db)return;console.log("[Chat] Setting up chat listener for room ".concat(De.id));const e=(0,d.P)((0,d.rJ)(a.db,"sideRooms",De.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const r=e.data();o.push({id:e.id,userId:r.userId,userName:r.userName,message:r.message,timestamp:r.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),fo(o),Co.current&&Co.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===De||void 0===De?void 0:De.id,a.db]);const Ro=(0,t.useCallback)((async()=>{if(Je)if(to)try{await Je.screenShare.toggle(),Je.screenShare.enabled?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(t){var e,o,r,n;console.error("Error toggling screen share:",t),"NotAllowedError"===t.name||null!==(e=t.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access in your browser."):null!==(o=t.message)&&void 0!==o&&o.includes("InvalidStateError")?c.oR.error("Cannot toggle screen share: an operation is already in progress or call state is invalid."):null!==(r=t.message)&&void 0!==r&&r.includes("getDisplayMedia is not supported")||null!==(n=t.message)&&void 0!==n&&n.includes("getDisplayMedia API is not available")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(t.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[Je,to]);(0,t.useEffect)((()=>{const e=()=>{io(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const Eo=e=>{po((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))},Fo=()=>{Je&&("enabled"!==Je.camera.state.status?navigator.mediaDevices.getUserMedia({video:!0}).then((e=>(e.getTracks().forEach((e=>e.stop())),Je.camera.enable()))).then((()=>{so(!0)})).catch((e=>{console.error("Error enabling camera:",e),c.oR.error("Could not enable camera. Please check permissions.")})):Je.camera.disable().catch((e=>{console.error("Error disabling camera:",e)})))};(0,t.useEffect)((()=>{var e;null===(e=Co.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[xo]);const Po=(0,t.useMemo)((()=>{if(!Qe||null===De||void 0===De||!De.ownerId)return[];const e=Qe.find((e=>e.userId===De.ownerId));return[...e?[e]:[],...Qe.filter((e=>ho.includes(e.userId)&&e.userId!==De.ownerId)),...Qe.filter((e=>e.userId!==De.ownerId&&!ho.includes(e.userId)))].filter(Boolean)}),[Qe,null===De||void 0===De?void 0:De.ownerId,ho]);(0,t.useEffect)((()=>{oo&&so(!0)}),[oo]);const Uo=Po;(0,t.useEffect)((()=>{if(null===Qe||void 0===Qe||!Qe.length)return;(async()=>{const e=Qe.filter((e=>!jo[e.userId])).map((e=>ko(e.userId)));await Promise.all(e)})()}),[Qe,ko,jo]);return(0,t.useEffect)((()=>{if(Je&&null!==no&&void 0!==no&&no.uid&&null!==De&&void 0!==De&&De.id&&"boolean"===typeof eo&&a.db){const e=(0,d.H9)(a.db,"sideRooms",De.id,"presence",no.uid),o="sideRooms/".concat(De.id,"/presence/").concat(no.uid);console.log("[DEBUG Mute Sync] Attempting updateDoc to path:",o,"with data:",JSON.stringify({isMuted:eo},null,2)),(0,d.mZ)(e,{isMuted:eo}).then((()=>{console.log("[InsideStreamCallContent] Synced local mute state (".concat(eo,") to Firestore for ").concat(no.uid))})).catch((e=>{console.error("[InsideStreamCallContent] Error syncing local mute state to Firestore for ".concat(no.uid,":"),e)}))}}),[eo,Je,null===no||void 0===no?void 0:no.uid,null===De||void 0===De?void 0:De.id,a.db]),(0,t.useEffect)((()=>{if(!Je||!Qe||0===Qe.length)return;const e=Qe.find((e=>e.screenShareStream));e&&(console.log("Screen sharing detected from: ".concat(e.name||e.userId)),console.log("Screen share stream should be visible to ALL participants"))}),[Je,Qe]),Je?(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==De&&void 0!==De&&null!==(r=De.style)&&void 0!==r&&r.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.backgroundColor)||Ve.palette.background.default,", ").concat((null===De||void 0===De||null===(l=De.style)||void 0===l?void 0:l.accentColor)||Ve.palette.secondary.main,")"):(null===De||void 0===De||null===(u=De.style)||void 0===u?void 0:u.backgroundColor)||Ve.palette.background.default,color:(null===De||void 0===De||null===(f=De.style)||void 0===f?void 0:f.textColor)||Ve.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[(()=>{var e,o,r,n,t,i,l,s,a;return(0,Se.jsxs)(m.A,{sx:{p:1,borderBottom:1,borderColor:"divider",textAlign:"center",flexShrink:0,backgroundColor:null!==De&&void 0!==De&&null!==(e=De.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.headerColor)||Ve.palette.primary.main,", ").concat((null===De||void 0===De||null===(r=De.style)||void 0===r?void 0:r.accentColor)||Ve.palette.secondary.light,")"):(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.headerColor)||(0,N.X4)(Ve.palette.background.paper,.95),color:(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.textColor)||"inherit"},children:[(0,Se.jsx)(h.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.font)||"inherit"},children:De.name}),(0,Se.jsxs)(h.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(l=De.style)&&void 0!==l&&l.textColor?(0,N.X4)(null===De||void 0===De||null===(s=De.style)||void 0===s?void 0:s.textColor,.8):"text.secondary",sx:{fontFamily:(null===De||void 0===De||null===(a=De.style)||void 0===a?void 0:a.font)||"inherit"},children:["(Mic: ",eo?"Muted":"On",")"]})]})})(),(0,Se.jsxs)(m.A,{sx:{flexGrow:1,p:2},children:[!Ao&&(0,Se.jsxs)(m.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Se.jsx)(h.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===De||void 0===De||null===(y=De.style)||void 0===y?void 0:y.accentColor)||Ve.palette.primary.main},children:"Live Video"}),(0,Se.jsxs)(m.A,{sx:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"},mb:2},children:[oo?(0,Se.jsxs)(m.A,{sx:{border:"3px solid",borderColor:Ve.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(0,Se.jsx)(v.A,{onClick:Fo,sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Se.jsx)(xe.A,{fontSize:"small"})}),$e&&(0,Se.jsx)(Re.fSl,{participant:$e,trackType:"videoTrack"}),(0,Se.jsx)(m.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Se.jsxs)(m.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Se.jsx)(x.A,{sx:{width:40,height:40,mr:1},children:(null===no||void 0===no||null===(b=no.displayName)||void 0===b?void 0:b[0])||"U"}),(0,Se.jsxs)(m.A,{children:[(0,Se.jsx)(h.A,{variant:"subtitle2",fontWeight:"bold",children:(null===no||void 0===no?void 0:no.displayName)||"You"}),(0,Se.jsx)(h.A,{variant:"caption",children:(null===De||void 0===De?void 0:De.name)||"Live Room"})]})]})}),(0,Se.jsx)(m.A,{sx:{position:"absolute",right:12,bottom:70,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:(0,Se.jsx)(p.A,{title:eo?"Unmute":"Mute",children:(0,Se.jsx)(v.A,{onClick:()=>null===Je||void 0===Je?void 0:Je.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:44,height:44,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:eo?(0,Se.jsx)(de.A,{}):(0,Se.jsx)(se.A,{})})})})]}):(0,Se.jsx)(m.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Se.jsx)(C.A,{variant:"contained",color:"primary",onClick:Fo,startIcon:(0,Se.jsx)(q.A,{}),children:"Enable Camera"})}),Qe&&Qe.filter((e=>e.userId!==(null===no||void 0===no?void 0:no.uid))).length>0&&(lo?(0,Se.jsxs)(m.A,{sx:{border:"3px solid",borderColor:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:{xs:"40vh",sm:"60vh"},maxHeight:"400px",width:{xs:"90%",sm:"45%"},maxWidth:"350px",overflow:"hidden",boxShadow:"0 10px 20px rgba(0,0,0,0.4)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[(()=>{const e=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===no||void 0===no?void 0:no.uid))),o=Qe.filter((e=>e.userId!==(null===no||void 0===no?void 0:no.uid)))[0],r=e||o;return r?(0,Se.jsx)(Re.fSl,{participant:r,trackType:"videoTrack"}):null})(),(0,Se.jsx)(v.A,{onClick:()=>{so(!1),c.oR.success("Video view closed")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:32,height:32,zIndex:10,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Se.jsx)(xe.A,{fontSize:"small"})}),(0,Se.jsx)(m.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(e=>{const o=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===no||void 0===no?void 0:no.uid))),r=Qe.filter((e=>e.userId!==(null===no||void 0===no?void 0:no.uid)))[0],n=o||r;return n&&(0,Se.jsxs)(m.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Se.jsx)(x.A,{sx:{width:40,height:40,mr:1},children:(null===n||void 0===n||null===(e=n.name)||void 0===e?void 0:e[0])||"U"}),(0,Se.jsx)(m.A,{children:(0,Se.jsxs)(h.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===n||void 0===n?void 0:n.name)||"User",n.userId===De.ownerId&&" (Host)"]})})]})})()})]}):(0,Se.jsx)(m.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:{xs:"90%",sm:"45%"},maxWidth:"350px"},children:(0,Se.jsx)(C.A,{variant:"outlined",color:"primary",onClick:()=>so(!0),startIcon:(0,Se.jsx)(q.A,{}),children:"Show Partner Video"})}))]}),Qe&&Qe.filter((e=>e.userId!==(null===no||void 0===no?void 0:no.uid))).length>1&&(0,Se.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:1,mt:2,width:"100%",maxWidth:"600px"},children:Qe.filter((e=>e.userId!==(null===no||void 0===no?void 0:no.uid))).filter((e=>{const o=Qe.find((e=>e.userId===De.ownerId&&e.userId!==(null===no||void 0===no?void 0:no.uid)));return!(e.userId===De.ownerId&&o===Qe.filter((e=>e.userId!==(null===no||void 0===no?void 0:no.uid)))[0])})).filter((e=>!uo.includes(e.userId))).map((e=>(0,Se.jsxs)(m.A,{sx:{width:"100px",height:"150px",borderRadius:"10px",overflow:"hidden",position:"relative",border:"2px solid",borderColor:"divider",backgroundColor:"#000","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[(0,Se.jsx)(Re.fSl,{participant:e,trackType:"videoTrack"}),(0,Se.jsx)(v.A,{onClick:()=>{const o=[...uo||[]];if(o.includes(e.userId)){const r=o.indexOf(e.userId);r>-1&&o.splice(r,1)}else o.push(e.userId);mo(o),c.oR.success("Video view toggled")},sx:{position:"absolute",top:2,right:2,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:20,height:20,zIndex:10,padding:"2px","& .MuiSvgIcon-root":{fontSize:"14px"},"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Se.jsx)(xe.A,{})}),(0,Se.jsx)(m.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"2px 4px",background:"rgba(0,0,0,0.7)",color:"white",fontSize:"10px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name||"User ".concat(e.userId.substring(0,5))})]},e.userId)))})]}),Ao&&(0,Se.jsxs)(m.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Se.jsxs)(h.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===De||void 0===De||null===(w=De.style)||void 0===w?void 0:w.accentColor)||Ve.palette.primary.main},children:[Ao.userId===(null===no||void 0===no?void 0:no.uid)?"You are sharing your screen":"".concat(Ao.name||"Someone"," is sharing their screen"),wo&&Ao.userId!==(null===no||void 0===no?void 0:no.uid)&&" (Room Owner)"]}),(0,Se.jsxs)(m.A,{sx:{m:0,p:0,border:"1px solid",borderColor:"divider",borderRadius:"8px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",height:"auto",width:"90%",maxWidth:"1200px",margin:"0 auto",marginTop:2,marginBottom:2,overflow:"hidden",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},children:[!ao&&(0,Se.jsx)(m.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none","& .str-video__screen-share-info":{display:"none !important",visibility:"hidden !important",opacity:0,height:0,overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:-9999},'& .str-video__participant-details, & .str-video__participant-bar, & .str-video__loading-indicator, & .str-video__screen-share-text, & .str-video__screen-share-status, & .str-video__participant__name, & .str-video__participant__info, & .str-video__participant-flag, & div[class*="screen-share"], & span[class*="presentation"]':{display:"none !important",visibility:"hidden !important",opacity:0,height:0,width:0,overflow:"hidden",pointerEvents:"none"},"& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"contain",background:"#000"},"& .str-video__participant-details":{display:"none !important"},"& .str-video__participant-status":{display:"none !important"},"& .str-video__participant-flag-container":{display:"none !important"}}},children:(0,Se.jsx)(Re.fSl,{participant:Ao,trackType:"screenShareTrack"})}),Ao&&!ao&&(0,Se.jsx)(m.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:-1,opacity:0,pointerEvents:"none"},children:(0,Se.jsx)("video",{autoPlay:!0,playsInline:!0,ref:e=>{e&&null!==Ao&&void 0!==Ao&&Ao.screenShareStream&&e.srcObject!==Ao.screenShareStream&&(e.srcObject=Ao.screenShareStream,e.play().catch((e=>console.error("Error playing screen share:",e))))}})}),ao&&lo&&$e&&(0,Se.jsxs)(m.A,{sx:{width:"100%",paddingTop:"56.25%",overflow:"hidden",position:"relative",border:"none",backgroundColor:"#000","& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100% !important",height:"100% !important",border:"none",display:"flex",justifyContent:"center",alignItems:"center","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[oo?(0,Se.jsx)(Re.fSl,{participant:$e,trackType:"videoTrack"}):(0,Se.jsx)(m.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Se.jsx)(Q.A,{sx:{fontSize:"5rem"}})}),(0,Se.jsx)(v.A,{size:"medium",onClick:Fo,sx:{position:"absolute",top:16,right:80,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:oo?(0,Se.jsx)(q.A,{}):(0,Se.jsx)(Q.A,{})}),(0,Se.jsx)(v.A,{size:"medium",onClick:()=>co(!1),sx:{position:"absolute",top:16,right:16,padding:"8px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Se.jsx)(xe.A,{})})]}),(0,Se.jsx)(m.A,{sx:{position:"absolute",top:10,right:10,zIndex:10},children:Oe&&(0,Se.jsx)(C.A,{variant:"contained",color:"error",size:"small",startIcon:(0,Se.jsx)(te.A,{}),onClick:Ro,sx:{borderRadius:"20px",textTransform:"none",py:.5,px:1.5,bgcolor:"error.main",fontWeight:"bold",minWidth:0,boxShadow:"0 2px 5px rgba(0,0,0,0.3)",fontFamily:(null===De||void 0===De||null===(k=De.style)||void 0===k?void 0:k.font)||"inherit"},children:"Stop"})}),!ao&&lo&&$e&&(0,Se.jsxs)(m.A,{sx:{position:"absolute",bottom:16,right:16,width:"160px",height:"90px",borderRadius:"8px",overflow:"hidden",border:"2px solid",borderColor:"primary.main",backgroundColor:"#000",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[oo?(0,Se.jsx)(Re.fSl,{participant:$e,trackType:"videoTrack"}):(0,Se.jsx)(m.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:"white",backgroundColor:"rgba(0,0,0,0.8)"},children:(0,Se.jsx)(Q.A,{sx:{fontSize:"1.5rem"}})}),(0,Se.jsx)(v.A,{size:"small",onClick:Fo,sx:{position:"absolute",top:2,right:26,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:oo?(0,Se.jsx)(q.A,{sx:{fontSize:"0.9rem"}}):(0,Se.jsx)(Q.A,{sx:{fontSize:"0.9rem"}})}),(0,Se.jsx)(v.A,{size:"small",onClick:()=>co(!0),sx:{position:"absolute",top:2,right:2,padding:"2px",color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,Se.jsx)(fe.A,{sx:{fontSize:"0.9rem"}})})]})]})]}),Le&&(0,Se.jsxs)(m.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Se.jsx)(h.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===De||void 0===De||null===(I=De.style)||void 0===I?void 0:I.font)||"inherit",color:(null===De||void 0===De||null===(R=De.style)||void 0===R?void 0:R.textColor)||"inherit"},children:"Shared Video"}),Oe&&(0,Se.jsx)(p.A,{title:"Clear Shared Video",children:(0,Se.jsx)(v.A,{onClick:()=>Me(),size:"small",sx:{color:(null===De||void 0===De||null===(F=De.style)||void 0===F?void 0:F.accentColor)||"inherit"},children:(0,Se.jsx)(ae.A,{})})})]}),(0,Se.jsx)(m.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:_e(Le)})]}),(0,Se.jsx)(m.A,{sx:{mb:2,borderBottom:1,borderColor:"divider"},children:(0,Se.jsxs)(B.A,{value:vo,onChange:(e,o)=>go(o),"aria-label":"room content tabs",sx:{"& .MuiTab-root":{fontFamily:(null===De||void 0===De||null===(P=De.style)||void 0===P?void 0:P.font)||"inherit",color:(null===De||void 0===De||null===(U=De.style)||void 0===U?void 0:U.textColor)||"inherit",opacity:.7},"& .Mui-selected":{color:"".concat((null===De||void 0===De||null===(D=De.style)||void 0===D?void 0:D.accentColor)||Ve.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===De||void 0===De||null===(O=De.style)||void 0===O?void 0:O.accentColor)||Ve.palette.primary.main}},children:[(0,Se.jsx)(G.A,{label:"Participants (".concat(Uo.length,")"),value:"participants"}),(0,Se.jsx)(G.A,{label:"Chat",value:"chat",icon:(0,Se.jsx)(g.A,{color:"primary",variant:"dot",invisible:"chat"===vo||0===xo.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===De||void 0===De||null===(z=De.style)||void 0===z?void 0:z.accentColor)||Ve.palette.primary.main}}}),iconPosition:"end"})]})}),"participants"===vo&&(0,Se.jsxs)(Se.Fragment,{children:[Uo.length>0&&(0,Se.jsx)(Re.ncL,{participants:Uo}),(0,Se.jsx)(j.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Uo.map((e=>{const o=e.userId===De.ownerId;return(0,Se.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,Se.jsx)(He,{participant:e,isRoomOwner:Oe,isLocalParticipant:e.userId===(null===no||void 0===no?void 0:no.uid),localUserAuthData:no,onForceMuteToggle:Be,onForceRemove:Ge,onForceBan:Ne,call:Je,localUserIsMute:eo,isDesignatedHost:o,onPinToggle:Eo,isPinned:ho.includes(e.userId),roomStyle:null===De||void 0===De?void 0:De.style,navigate:Ye})},e.userId)}))}),0===Uo.length&&(0,Se.jsx)(h.A,{sx:{width:"100%",textAlign:"center",color:null!==De&&void 0!==De&&null!==(W=De.style)&&void 0!==W&&W.textColor?(0,N.X4)(null===De||void 0===De||null===(M=De.style)||void 0===M?void 0:M.textColor,.7):Ve.palette.text.secondary,mt:4,fontFamily:(null===De||void 0===De||null===(L=De.style)||void 0===L?void 0:L.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===vo&&(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==De&&void 0!==De&&null!==(H=De.style)&&void 0!==H&&H.accentColor?(0,N.X4)(null===De||void 0===De||null===(_=De.style)||void 0===_?void 0:_.accentColor,.3):Ve.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Se.jsxs)(m.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==De&&void 0!==De&&null!==(V=De.style)&&void 0!==V&&V.accentColor?(0,N.X4)(null===De||void 0===De||null===(Y=De.style)||void 0===Y?void 0:Y.accentColor,.3):Ve.palette.divider),bgcolor:null!==De&&void 0!==De&&null!==(J=De.style)&&void 0!==J&&J.headerColor?(0,N.X4)(null===De||void 0===De||null===(X=De.style)||void 0===X?void 0:X.headerColor,.1):(0,N.X4)(Ve.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Se.jsxs)(h.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===De||void 0===De||null===(K=De.style)||void 0===K?void 0:K.font)||"inherit",color:(null===De||void 0===De||null===($=De.style)||void 0===$?void 0:$.textColor)||"inherit"},children:["Users in Room (",Uo.length,")"]}),(0,Se.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Uo.map((e=>{var o,r,n,t,i,l;const s=jo[e.userId],a=(null===s||void 0===s?void 0:s.username)||e.name||e.userId.substring(0,8),d=(null===s||void 0===s?void 0:s.avatar)||e.image;return(0,Se.jsx)(T.A,{size:"small",label:a,avatar:(0,Se.jsx)(x.A,{src:d,alt:a,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===De.ownerId?(0,N.X4)((null===De||void 0===De||null===(o=De.style)||void 0===o?void 0:o.accentColor)||Ve.palette.secondary.main,.1):(0,N.X4)((null===De||void 0===De||null===(r=De.style)||void 0===r?void 0:r.headerColor)||Ve.palette.primary.main,.05),borderColor:e.userId===De.ownerId?(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.accentColor)||Ve.palette.secondary.main:(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.headerColor)||Ve.palette.primary.main,border:"1px solid",color:(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===De||void 0===De||null===(l=De.style)||void 0===l?void 0:l.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,Se.jsx)(m.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==De&&void 0!==De&&null!==(ee=De.style)&&void 0!==ee&&ee.backgroundGradient?(0,N.X4)((null===De||void 0===De||null===(oe=De.style)||void 0===oe?void 0:oe.backgroundColor)||Ve.palette.background.default,.3):(0,N.X4)(Ve.palette.background.paper,.5)},children:0===xo.length?(0,Se.jsx)(h.A,{variant:"body2",color:null!==De&&void 0!==De&&null!==(re=De.style)&&void 0!==re&&re.textColor?(0,N.X4)(null===De||void 0===De||null===(ie=De.style)||void 0===ie?void 0:ie.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===De||void 0===De||null===(le=De.style)||void 0===le?void 0:le.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,Se.jsxs)(Se.Fragment,{children:[xo.map((e=>{var o,r,n,t,i,l,s,a,d,c,u;return(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:e.userId===(null===no||void 0===no?void 0:no.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===no||void 0===no?void 0:no.uid)&&(0,Se.jsx)(x.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=jo[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,Se.jsxs)(m.A,{children:[(0,Se.jsx)(h.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(r=De.style)&&void 0!==r&&r.textColor?(0,N.X4)(null===De||void 0===De||null===(n=De.style)||void 0===n?void 0:n.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===no||void 0===no?void 0:no.uid)?"right":"left",fontFamily:(null===De||void 0===De||null===(t=De.style)||void 0===t?void 0:t.font)||"inherit"},children:e.userName}),(0,Se.jsx)(S.A,{sx:{p:1,bgcolor:e.userId===(null===no||void 0===no?void 0:no.uid)?(null===De||void 0===De||null===(i=De.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===no||void 0===no?void 0:no.uid)?null!==De&&void 0!==De&&null!==(l=De.style)&&void 0!==l&&l.accentColor?Ve.palette.getContrastText(De.style.accentColor):"primary.contrastText":(null===De||void 0===De||null===(s=De.style)||void 0===s?void 0:s.textColor)||"text.primary",borderRadius:e.userId===(null===no||void 0===no?void 0:no.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===De||void 0===De||null===(a=De.style)||void 0===a?void 0:a.font)||"inherit"},children:(0,Se.jsx)(h.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,Se.jsx)(h.A,{variant:"caption",color:null!==De&&void 0!==De&&null!==(d=De.style)&&void 0!==d&&d.textColor?(0,N.X4)(null===De||void 0===De||null===(c=De.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===no||void 0===no?void 0:no.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===De||void 0===De||null===(u=De.style)||void 0===u?void 0:u.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,Se.jsx)("div",{ref:Co})]})}),(0,Se.jsx)(m.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==De&&void 0!==De&&null!==(ce=De.style)&&void 0!==ce&&ce.accentColor?(0,N.X4)(null===De||void 0===De||null===(ue=De.style)||void 0===ue?void 0:ue.accentColor,.3):Ve.palette.divider),bgcolor:(null===De||void 0===De||null===(me=De.style)||void 0===me?void 0:me.headerColor)||Ve.palette.background.paper,display:"flex"},children:(0,Se.jsx)(E.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:yo,onChange:e=>bo(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Io())},InputProps:{sx:{fontFamily:(null===De||void 0===De||null===(he=De.style)||void 0===he?void 0:he.font)||"inherit",color:(null===De||void 0===De||null===(pe=De.style)||void 0===pe?void 0:pe.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==De&&void 0!==De&&null!==(ve=De.style)&&void 0!==ve&&ve.accentColor?(0,N.X4)(null===De||void 0===De||null===(ge=De.style)||void 0===ge?void 0:ge.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==De&&void 0!==De&&null!==(Ce=De.style)&&void 0!==Ce&&Ce.accentColor?(0,N.X4)(null===De||void 0===De||null===(Ae=De.style)||void 0===Ae?void 0:Ae.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===De||void 0===De||null===(we=De.style)||void 0===we?void 0:we.accentColor)||Ve.palette.primary.main}},endAdornment:(0,Se.jsx)(v.A,{size:"small",onClick:Io,disabled:!yo.trim(),color:"primary",sx:{color:(null===De||void 0===De||null===(je=De.style)||void 0===je?void 0:je.accentColor)||"primary"},children:(0,Se.jsx)(ye.A,{fontSize:"small"})})}})})]})]}),(0,Se.jsxs)(m.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(Ve.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===De||void 0===De||null===(ke=De.style)||void 0===ke?void 0:ke.headerColor)||Ve.palette.background.paper},children:[(0,Se.jsx)(C.A,{variant:"outlined",color:"error",startIcon:(0,Se.jsx)(ne.A,{}),onClick:()=>{null===Je||void 0===Je||Je.leave().then((()=>Ye("/side-rooms")))},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===De||void 0===De||null===(Ie=De.style)||void 0===Ie?void 0:Ie.font)||"inherit"},children:"Leave quietly"}),Oe&&(0,Se.jsx)(p.A,{title:eo?"Unmute Microphone":"Mute Microphone",children:(0,Se.jsx)(v.A,{onClick:()=>null===Je||void 0===Je?void 0:Je.microphone.toggle(),color:eo?"default":"primary",sx:{ml:2,color:eo?"default":(null===De||void 0===De||null===(Fe=De.style)||void 0===Fe?void 0:Fe.accentColor)||"primary.main"},disabled:!Je,children:eo?(0,Se.jsx)(de.A,{}):(0,Se.jsx)(se.A,{})})}),Oe&&(0,Se.jsx)(p.A,{title:oo?"Turn Camera Off":"Turn Camera On",children:(0,Se.jsx)(v.A,{onClick:Fo,color:oo?"primary":"default",sx:{ml:1,color:oo?(null===De||void 0===De||null===(Pe=De.style)||void 0===Pe?void 0:Pe.accentColor)||"primary.main":"default"},disabled:!Je,children:oo?(0,Se.jsx)(q.A,{}):(0,Se.jsx)(Q.A,{})})}),Oe&&(0,Se.jsx)(p.A,{title:lo?"Hide Camera Window":"Show Camera Window",children:(0,Se.jsx)(v.A,{onClick:()=>so(!lo),color:lo?"primary":"default",sx:{ml:1,color:lo?(null===De||void 0===De||null===(Ue=De.style)||void 0===Ue?void 0:Ue.accentColor)||"primary.main":"default"},disabled:!Je||!oo,children:(0,Se.jsx)(be.A,{})})}),Oe&&(0,Se.jsx)(p.A,{title:"Share Video Link",children:(0,Se.jsx)("span",{children:(0,Se.jsx)(v.A,{onClick:()=>We(),color:"secondary",sx:{ml:2,color:(null===De||void 0===De||null===(Te=De.style)||void 0===Te?void 0:Te.accentColor)||Ve.palette.secondary.main},children:(0,Se.jsx)(Z.A,{})})})})]})]}):(0,Se.jsxs)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,Se.jsx)(A.A,{}),(0,Se.jsx)(h.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},He=t.memo((e=>{let{participant:o,isRoomOwner:r,isLocalParticipant:n,onForceMuteToggle:i,onForceRemove:g,onForceBan:A,call:w,localUserAuthData:j,localUserIsMute:S,isDesignatedHost:E,onPinToggle:D,isPinned:O,roomStyle:z,navigate:W}=e;const M=(0,u.A)(),{isSpeaking:L,publishedTracks:H}=o,{blockUser:B,currentUser:G}=(0,s.As)(),V=!H.includes("audio")&&!L,[Y,J]=(0,t.useState)(null),X=Boolean(Y),Z=e=>J(e.currentTarget),K=()=>J(null),q=async()=>{if(n&&w)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",S),await w.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),r&&null!==j&&void 0!==j&&j.uid){const e=w.cid,o=(0,d.aU)(),r=(0,d.H9)(o,"sideRooms",e),n=!w.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!n)),await(0,d.mZ)(r,{isLive:!n,lastActive:(0,d.O5)()})}}catch(e){console.error("[StreamParticipantCard] Error toggling local microphone:",e),c.oR.error("Failed to toggle microphone. See console.")}};let Q,ee;const oe=o.custom;n&&j?(Q=j.displayName||j.email||o.userId,ee=j.photoURL||o.image||void 0):oe&&"string"===typeof oe.displayName&&""!==oe.displayName.trim()?(Q=oe.displayName,ee=oe.customAvatarUrl&&"string"===typeof oe.customAvatarUrl&&""!==oe.customAvatarUrl.trim()?oe.customAvatarUrl:o.image||void 0):(Q=o.name||o.userId,ee=o.image||void 0),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:r,isLocalParticipant:n,localUserAuthData:j}),console.log("[StreamParticipantCard] Determined values - displayName:",Q,"avatarUrl:",ee,"isSpeaking:",L,"participantIsMuted:",V),n&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",j,"Stream participant.userId:",o.userId);const[re,ne]=(0,t.useState)(!1);return(0,Se.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{const e=(0,Se.jsx)(x.A,{src:ee,alt:Q,sx:{width:64,height:64,mb:.5,border:L?"3px solid ".concat(M.palette.success.main):"2px solid ".concat((0,N.X4)(M.palette.divider,.5)),boxShadow:L?"0 0 8px ".concat(M.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer"}});return n?(0,Se.jsx)(m.A,{onClick:q,sx:{cursor:"pointer"},children:e}):(0,Se.jsx)(l.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:e})})(),E&&(0,Se.jsx)(T.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(n?null===S||void 0===S||S:V)&&(0,Se.jsx)(de.A,{sx:{fontSize:"1rem",color:M.palette.error.contrastText,backgroundColor:(0,N.X4)(M.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),n&&!S&&(0,Se.jsx)(se.A,{sx:{fontSize:"1rem",color:M.palette.success.contrastText,backgroundColor:(0,N.X4)(M.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,Se.jsx)(h.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:M.palette.text.primary},children:Q}),r&&!n&&(0,Se.jsxs)(m.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Se.jsx)(p.A,{title:"Manage User",children:(0,Se.jsx)(v.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,N.X4)(M.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Se.jsx)($.A,{fontSize:"small"})})}),(0,Se.jsxs)(f.A,{anchorEl:Y,open:X,onClose:K,MenuListProps:{dense:!0},children:[(0,Se.jsxs)(y.A,{onClick:async()=>{K(),i&&i(o.userId,!o.publishedTracks.includes("audio"))},sx:{fontSize:"0.8rem"},children:[(0,Se.jsx)(b.A,{sx:{minWidth:"30px"},children:V?(0,Se.jsx)(le.A,{fontSize:"small"}):(0,Se.jsx)(Ce.A,{fontSize:"small"})}),V?"Unmute":"Mute"]}),(0,Se.jsxs)(y.A,{onClick:()=>{K(),D(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,Se.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Se.jsx)(Ae.A,{fontSize:"small",color:O?"primary":"inherit"})}),O?"Unpin from top":"Pin to top"]}),(0,Se.jsxs)(y.A,{onClick:async()=>{if(K(),window.confirm("Are you sure you want to block ".concat(o.name||o.userId,"?")))try{await B(o.userId),c.oR.success("Blocked ".concat(o.name||o.userId)),g&&g(o.userId,o.name||o.userId)}catch(e){console.error("Error blocking user:",e),c.oR.error("Failed to block user")}},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Se.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Se.jsx)(we.A,{fontSize:"small",color:"error"})}),"Block"]})]})]}),!r&&!n&&(0,Se.jsxs)(m.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Se.jsx)(p.A,{title:"Options",children:(0,Se.jsx)(v.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,N.X4)(M.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Se.jsx)($.A,{fontSize:"small"})})}),(0,Se.jsx)(f.A,{anchorEl:Y,open:X,onClose:K,MenuListProps:{dense:!0},children:(0,Se.jsxs)(y.A,{onClick:()=>{K(),ne(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Se.jsx)(b.A,{sx:{minWidth:"30px"},children:(0,Se.jsx)(je.A,{fontSize:"small",color:"warning"})}),"Report User"]})})]}),O&&!E&&(0,Se.jsx)(p.A,{title:"Pinned",children:(0,Se.jsx)(Ae.A,{sx:{fontSize:"1rem",color:M.palette.primary.contrastText,backgroundColor:(0,N.X4)(M.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,Se.jsxs)(k.A,{open:re,onClose:()=>ne(!1),children:[(0,Se.jsx)(I.A,{children:"Report User"}),(0,Se.jsxs)(R.A,{children:[(0,Se.jsxs)(h.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,Se.jsx)(P.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,Se.jsx)(U.Ay,{onClick:()=>(async e=>{try{const r={reportedUserId:o.userId,reportedBy:null===G||void 0===G?void 0:G.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)(a.db,"reports"),r),c.oR.success("Report submitted for ".concat(o.name||o.userId)),ne(!1)}catch(r){console.error("Error submitting report:",r),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,N.X4)(M.palette.primary.main,.1)}},children:(0,Se.jsx)(_.A,{primary:e})},e)))})]}),(0,Se.jsx)(F.A,{children:(0,Se.jsx)(C.A,{onClick:()=>ne(!1),children:"Cancel"})})]})]})}))}}]);