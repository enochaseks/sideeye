"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[682],{379:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3235),o=s(4414);const n=(0,r.A)((0,o.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},760:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3235),o=s(4414);const n=(0,r.A)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},1227:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3235),o=s(4414);const n=(0,r.A)((0,o.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},2814:(e,t,s)=>{s.d(t,{x:()=>i});var r=s(9950),o=s(6220),n=s(330),a=s(1367);const i=()=>{const{currentUser:e}=(0,a.As)(),[t,s]=(0,r.useState)(new Set);(0,r.useEffect)((()=>{if(null===e||void 0===e||!e.uid)return;const t=async()=>{try{const t=(0,o.H9)(n.db,"users",e.uid);await(0,o.mZ)(t,{lastSeen:(0,o.O5)(),isOnline:!0})}catch(t){console.error("Error updating presence:",t)}};t();const r=setInterval(t,3e4),a=async()=>{try{const t=(0,o.H9)(n.db,"users",e.uid);await(0,o.mZ)(t,{isOnline:!1,lastSeen:(0,o.O5)()})}catch(t){console.error("Error setting offline status:",t)}};window.addEventListener("beforeunload",a);const i=(0,o.rJ)(n.db,"users"),l=(0,o.aQ)(i,(e=>{const t=new Set,r=new Date;e.docs.forEach((e=>{const s=e.data(),o=e.id;if(s.isOnline)t.add(o);else if(s.lastSeen){const e=s.lastSeen.toDate?s.lastSeen.toDate():new Date(s.lastSeen);(r.getTime()-e.getTime())/6e4<2&&t.add(o)}})),s(t)}));return()=>{clearInterval(r),window.removeEventListener("beforeunload",a),l(),a()}}),[null===e||void 0===e?void 0:e.uid]);return{isUserOnline:e=>t.has(e),onlineUsers:t}}},4801:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3235),o=s(4414);const n=(0,r.A)((0,o.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},6281:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3235),o=s(4414);const n=(0,r.A)((0,o.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},6493:(e,t,s)=>{s.d(t,{A:()=>b});var r=s(8587),o=s(8168),n=s(9950),a=s(2004),i=s(8465),l=s(9254),c=s(9608),d=s(8463),u=s(2053),m=s(1763),h=s(423);function x(e){return(0,h.Ay)("MuiDialogContentText",e)}(0,m.A)("MuiDialogContentText",["root"]);var p=s(4414);const A=["children","className"],g=(0,l.Ay)(u.A,{shouldForwardProp:e=>(0,c.A)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),b=n.forwardRef((function(e,t){const s=(0,d.b)({props:e,name:"MuiDialogContentText"}),{className:n}=s,l=(0,r.A)(s,A),c=(e=>{const{classes:t}=e,s=(0,i.A)({root:["root"]},x,t);return(0,o.A)({},t,s)})(l);return(0,p.jsx)(g,(0,o.A)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:l,className:(0,a.A)(c.root,n)},s,{classes:c}))}))},7016:(e,t,s)=>{s.d(t,{A:()=>a});s(9950);var r=s(6491),o=s(3274),n=s(4414);const a=e=>{let{isOnline:t,size:s="small",showTooltip:a=!0}=e;const i={small:10,medium:14,large:18},l=(0,n.jsx)(r.A,{sx:{width:i[s],height:i[s],borderRadius:"50%",backgroundColor:t?"#4caf50":"#bdbdbd",border:"2px solid white",boxShadow:"0 0 0 1px rgba(0,0,0,0.1)",transition:"background-color 0.3s ease"}});return a?(0,n.jsx)(o.A,{title:t?"Online":"Offline",placement:"top",children:l}):l}},8682:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ee});var r=s(9379),o=s(45),n=s(9950),a=s(6491),i=s(2053),l=s(226),c=s(249),d=s(6050),u=s(5333),m=s(8614),h=s(4447),x=s(1413),p=s(3563),A=s(4745),g=s(9808),b=s(2235),j=s(8145),v=s(2046),y=s(2236),f=s(4142),w=s(6639),C=s(3174),S=s(7591),k=s(3266),M=s(4195),R=s(6583),E=s(33),P=s(8170),U=s(6493),z=s(9739),I=s(4862),O=s(7016),D=s(2814),N=s(379),L=s(1227),H=s(9885),W=s(6281),G=s(9715),B=s(4801),F=s(3235),J=s(4414);const T=(0,F.A)((0,J.jsx)("path",{d:"M7.58 4.08 6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42m12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42M18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-6 11c.14 0 .27-.01.4-.04.65-.14 1.18-.58 1.44-1.18.1-.24.15-.5.15-.78h-4c.01 1.1.9 2 2.01 2"}),"NotificationsActive");var q=s(3256),_=s(760),V=s(8429),Z=s(1367),Q=s(6220),Y=s(330),K=s(5887);const X=["children","value","index"];function $(e){const{children:t,value:s,index:n}=e,i=(0,o.A)(e,X);return(0,J.jsx)("div",(0,r.A)((0,r.A)({role:"tabpanel",hidden:s!==n,id:"messages-tabpanel-".concat(n),"aria-labelledby":"messages-tab-".concat(n)},i),{},{children:s===n&&(0,J.jsx)(a.A,{sx:{pt:2},children:t})}))}const ee=()=>{const{currentUser:e}=(0,Z.As)(),t=(0,V.Zp)(),{isUserOnline:s}=(0,D.x)(),[o,F]=(0,n.useState)(!0),[X,ee]=(0,n.useState)([]),[te,se]=(0,n.useState)([]),[re,oe]=(0,n.useState)(""),[ne,ae]=(0,n.useState)([]),[ie,le]=(0,n.useState)(!1),[ce,de]=(0,n.useState)(!1),[ue,me]=(0,n.useState)(null),[he,xe]=(0,n.useState)(null),[pe,Ae]=(0,n.useState)(0),[ge,be]=(0,n.useState)([]),[je,ve]=(0,n.useState)([]),[ye,fe]=(0,n.useState)(""),[we,Ce]=(0,n.useState)(!1),[Se,ke]=(0,n.useState)(!1),[Me,Re]=(0,n.useState)(""),[Ee,Pe]=(0,n.useState)(""),[Ue,ze]=(0,n.useState)([""]),[Ie,Oe]=(0,n.useState)(!1),[De,Ne]=(0,n.useState)([]);(0,n.useEffect)((()=>{if(!e||!Y.db)return;F(!0);const t=(0,Q.rJ)(Y.db,"conversations"),s=(0,Q.P)(t,(0,Q._M)("participants","array-contains",e.uid)),o=(0,Q.aQ)(s,(async t=>{try{const s=(0,Q.rJ)(Y.db,"users"),o=await(0,Q.GG)(s),n=[];o.forEach((t=>{const s=t.data();s.blockedUsers&&Array.isArray(s.blockedUsers)&&s.blockedUsers.includes(e.uid)&&n.push(t.id)}));const a=[...e.blockedUsers||[],...n],i=t.docs.map((e=>{const t=e.data();return(0,r.A)({id:e.id},t)})).filter((t=>{const s=t.participants.find((t=>t!==e.uid));return s&&!a.includes(s)})),l=await Promise.all(i.map((async t=>{const s=t.participants.find((t=>t!==e.uid));if(!s)return t;try{const e=await(0,Q.x7)((0,Q.H9)(Y.db,"users",s));if(e.exists()){const s=e.data();return(0,r.A)((0,r.A)({},t),{},{displayName:s.name||s.username,photoURL:s.profilePic||s.photoURL,status:t.status||"accepted"})}}catch(o){console.error("Error fetching user data:",o)}return t}))),c=l.filter((e=>"pending"!==e.status)),d=l.filter((e=>"pending"===e.status));ee(c),se(d),F(!1)}catch(s){console.error("Error loading conversations:",s),F(!1)}}));return()=>o()}),[e,Y.db]),(0,n.useEffect)((()=>{if(!e||!Y.db)return;(async()=>{try{const t=(0,Q.rJ)(Y.db,"rooms"),s=(0,Q.P)(t,(0,Q._M)("members","array-contains",e.uid)),o=(0,Q.rJ)(Y.db,"rooms"),n=(0,Q.P)(o,(0,Q._M)("type","==","public"));return(0,Q.aQ)(s,(async t=>{const s=t.docs.map((e=>e.id)),o=await(0,Q.GG)(n),a=[...t.docs,...o.docs.filter((e=>!s.includes(e.id)))],i=await Promise.all(a.map((async t=>{const o=t.data();let n="Unknown",a="";try{const e=(0,Q.H9)(Y.db,"users",o.createdBy),t=await(0,Q.x7)(e);if(t.exists()){const e=t.data();n=e.name||e.username||"Unknown",a=e.profilePic||e.photoURL||""}}catch(i){console.error("Error fetching creator data:",i)}return(0,r.A)((0,r.A)({id:t.id},o),{},{creatorName:n,creatorPhoto:a,isOwner:o.createdBy===e.uid,isMember:s.includes(t.id)})})));Ne(i)}))}catch(t){console.error("Error fetching rooms:",t)}})()}),[e,Y.db]);const Le=async()=>{if(re.trim()){F(!0);try{const t=re.toLowerCase().trim(),s=(0,Q.rJ)(Y.db,"users"),o=(0,Q.P)(s,(0,Q._M)("username",">=",t),(0,Q._M)("username","<=",t+"\uf8ff"),(0,Q.AB)(10)),n=await(0,Q.GG)(o),a=(0,Q.P)(s,(0,Q._M)("name",">=",re),(0,Q._M)("name","<=",re+"\uf8ff"),(0,Q.AB)(10)),i=await(0,Q.GG)(a),l=new Map;n.docs.forEach((e=>{l.set(e.id,(0,r.A)({id:e.id},e.data()))})),i.docs.forEach((e=>{l.set(e.id,(0,r.A)({id:e.id},e.data()))}));const c=Array.from(l.values()).filter((t=>t.id!==(null===e||void 0===e?void 0:e.uid)));ae(c)}catch(t){console.error("Error searching users:",t),K.oR.error("Failed to search users")}finally{F(!1)}}else ae([])},He=e=>{if(!e)return"";const t=e.toDate?e.toDate():new Date(e),s=(new Date).getTime()-t.getTime(),r=864e5;return s<r?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<2*r?"Yesterday":t.toLocaleDateString([],{month:"short",day:"numeric"})},We=()=>{me(null),xe(null)},Ge=o=>0===o.length?(0,J.jsxs)(a.A,{sx:{textAlign:"center",mt:4,p:3},children:[(0,J.jsx)(i.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:0===pe?"You haven't started any conversations yet":"No message requests"}),0===pe&&(0,J.jsx)(l.A,{variant:"contained",startIcon:(0,J.jsx)(N.A,{}),onClick:()=>le(!0),sx:{mt:2},children:"Start a new chat"})]}):(0,J.jsx)(c.A,{sx:{bgcolor:"background.paper",borderRadius:1},children:o.map(((l,c)=>{var g,b,j;return(0,J.jsxs)(n.Fragment,{children:[(0,J.jsxs)(d.Ay,{alignItems:"flex-start",button:!0,onClick:()=>t("/chat/conversation/".concat(l.id)),sx:{py:2},secondaryAction:"pending"===l.status?(0,J.jsxs)(a.A,{sx:{display:"flex"},children:[(0,J.jsx)(u.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{F(!0);const e=(0,Q.H9)(Y.db,"conversations",t.id);await(0,Q.mZ)(e,{status:"accepted"}),se((e=>e.filter((e=>e.id!==t.id)))),ee((e=>[(0,r.A)((0,r.A)({},t),{},{status:"accepted"}),...e])),fe("Message request accepted"),Ce(!0)}catch(s){console.error("Error accepting message request:",s),K.oR.error("Failed to accept message request")}finally{F(!1)}})(l)},color:"success","aria-label":"accept request",title:"Accept",children:(0,J.jsx)(L.A,{})}),(0,J.jsx)(u.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{F(!0);const e=(0,Q.wP)(Y.db),s=(0,Q.rJ)(Y.db,"conversations",t.id,"messages");(await(0,Q.GG)(s)).docs.forEach((t=>{e.delete(t.ref)}));const r=(0,Q.H9)(Y.db,"conversations",t.id);e.delete(r),await e.commit(),se((e=>e.filter((e=>e.id!==t.id)))),fe("Message request declined"),Ce(!0)}catch(s){console.error("Error declining message request:",s),K.oR.error("Failed to decline message request")}finally{F(!1)}})(l)},color:"error","aria-label":"decline request",title:"Decline",children:(0,J.jsx)(H.A,{})})]}):(0,J.jsx)(u.A,{edge:"end",onClick:e=>((e,t)=>{e.stopPropagation(),me(e.currentTarget),xe(t)})(e,l),"aria-label":"more options",children:(0,J.jsx)(W.A,{})}),children:[(0,J.jsx)(m.A,{children:(0,J.jsxs)(a.A,{sx:{position:"relative"},children:[(0,J.jsx)(h.A,{color:"primary",badgeContent:"number"===typeof l.unreadCount?l.unreadCount:0,invisible:!l.unreadCount,children:(0,J.jsx)(x.A,{alt:l.displayName||"User",src:l.photoURL||void 0,sx:{width:40,height:40,bgcolor:l.photoURL?void 0:"primary.main"},children:!l.photoURL&&(null===(g=l.displayName)||void 0===g?void 0:g.charAt(0).toUpperCase())})}),(0,J.jsx)(a.A,{sx:{position:"absolute",bottom:12,right:12,zIndex:4},children:(0,J.jsx)(O.A,{isOnline:l.participants.some((t=>t!==(null===e||void 0===e?void 0:e.uid)&&s(t))),size:"small"})})]})}),(0,J.jsx)(p.A,{primary:l.displayName,secondary:(0,J.jsxs)(n.Fragment,{children:[(0,J.jsx)(i.A,{component:"span",variant:"body2",color:"text.primary",sx:{display:"inline",fontWeight:l.unreadCount?"bold":"normal"},children:(null===(b=l.lastMessage)||void 0===b?void 0:b.text)||"Start a conversation"}),(null===(j=l.lastMessage)||void 0===j?void 0:j.timestamp)&&(0,J.jsx)(i.A,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:He(l.lastMessage.timestamp)})]})})]}),c<o.length-1&&(0,J.jsx)(A.A,{component:"li"})]},l.id)}))});return(0,J.jsxs)(g.A,{maxWidth:"md",sx:{mt:2,mb:8},children:[(0,J.jsxs)(b.A,{elevation:0,sx:{p:2,mb:2},children:[(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,J.jsx)(i.A,{variant:"h5",fontWeight:"bold",children:"Messages"}),(0,J.jsx)(u.A,{onClick:()=>le(!0),color:"primary",children:(0,J.jsx)(N.A,{})})]}),(0,J.jsx)(j.A,{fullWidth:!0,placeholder:"Search conversations...",variant:"outlined",value:re,onChange:e=>oe(e.target.value),onKeyPress:e=>"Enter"===e.key&&Le(),InputProps:{startAdornment:(0,J.jsx)(v.A,{position:"start",children:(0,J.jsx)(G.A,{})}),endAdornment:re?(0,J.jsx)(v.A,{position:"end",children:(0,J.jsx)(u.A,{size:"small",onClick:()=>oe(""),children:(0,J.jsx)(B.A,{})})}):null},sx:{mb:2}}),(0,J.jsx)(a.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,J.jsxs)(y.A,{value:pe,onChange:(e,t)=>{Ae(t)},"aria-label":"message tabs",variant:"fullWidth",children:[(0,J.jsx)(f.A,{label:"Inbox",id:"messages-tab-0","aria-controls":"messages-tabpanel-0"}),(0,J.jsx)(f.A,{label:(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center"},children:[(0,J.jsx)("span",{children:"Message Requests"}),te.length>0&&(0,J.jsx)(h.A,{color:"error",badgeContent:te.length,sx:{ml:1}})]}),id:"messages-tab-1","aria-controls":"messages-tabpanel-1",icon:te.length>0?(0,J.jsx)(T,{fontSize:"small"}):void 0,iconPosition:"end"}),(0,J.jsx)(f.A,{label:"Rooms +",id:"messages-tab-1","aria-controls":"messages-tabpanel-1",icon:te.length>0?(0,J.jsx)(T,{fontSize:"small"}):void 0,iconPosition:"end"})]})})]}),o&&0===X.length&&0===te.length?(0,J.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,J.jsx)(w.A,{})}):(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)($,{value:pe,index:0,children:Ge(X)}),(0,J.jsxs)($,{value:pe,index:1,children:[te.length>0&&(0,J.jsx)(C.A,{severity:"info",sx:{mb:2},children:"These are message requests from people you don't follow. Accept to start chatting or decline to remove."}),Ge(te)]}),(0,J.jsxs)($,{value:pe,index:2,children:[(0,J.jsxs)(a.A,{sx:{p:2,mb:3,bgcolor:"background.paper",borderRadius:1},children:[(0,J.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"Rooms + Server Chat"}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Create a room to share announcements, live updates, and polls with your followers. Great for creators who want to engage with their audience, or for anyone who wants to create a community, you can also join other rooms inside the rooms + section."}),(0,J.jsx)(l.A,{variant:"contained",startIcon:(0,J.jsx)(q.A,{}),onClick:()=>ke(!0),sx:{mt:1},children:"Create a Room"})]}),0===De.length?(0,J.jsx)(a.A,{sx:{textAlign:"center",mt:4,p:3},children:(0,J.jsx)(i.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"No rooms available. Create a room or join someone else's room."})}):(0,J.jsx)(c.A,{sx:{bgcolor:"background.paper",borderRadius:1},children:De.map(((e,s)=>{var r,o,c,u;return(0,J.jsxs)(n.Fragment,{children:[(0,J.jsxs)(d.Ay,{alignItems:"flex-start",button:!0,onClick:()=>t("/chat/room/".concat(e.id)),sx:{py:2},children:[(0,J.jsx)(m.A,{children:(0,J.jsx)(h.A,{color:"secondary",variant:"dot",invisible:!e.isOwner,children:(0,J.jsx)(x.A,{alt:e.name,src:e.creatorPhoto,sx:{bgcolor:e.creatorPhoto?void 0:"secondary.main"},children:!e.creatorPhoto&&(null===(r=e.name)||void 0===r?void 0:r.charAt(0).toUpperCase())})})}),(0,J.jsx)(p.A,{primary:(0,J.jsxs)(a.A,{display:"flex",alignItems:"center",children:[(0,J.jsx)(i.A,{variant:"subtitle1",component:"span",children:e.name}),e.isOwner&&(0,J.jsx)(i.A,{variant:"caption",component:"span",sx:{ml:1,bgcolor:"secondary.main",px:1,py:.5,borderRadius:1,color:"white"},children:"Owner"}),!e.isOwner&&e.isMember&&(0,J.jsx)(i.A,{variant:"caption",component:"span",sx:{ml:1,bgcolor:"success.light",px:1,py:.5,borderRadius:1,color:"white"},children:"Joined"})]}),secondary:(0,J.jsxs)(n.Fragment,{children:[(0,J.jsxs)(i.A,{component:"div",variant:"body2",color:"text.primary",sx:{display:"block"},children:[null===(o=e.description)||void 0===o?void 0:o.substring(0,60),(null===(c=e.description)||void 0===c?void 0:c.length)>60?"...":""]}),(0,J.jsxs)(a.A,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mt:.5},children:[(0,J.jsxs)(i.A,{component:"span",variant:"caption",color:"text.secondary",children:["Created by ",e.creatorName," \u2022 ",(null===(u=e.members)||void 0===u?void 0:u.length)||0," members"]}),!e.isMember&&(0,J.jsx)(l.A,{size:"small",variant:"outlined",color:"primary",onClick:s=>{s.stopPropagation(),t("/chat/room/".concat(e.id))},sx:{minWidth:"60px",ml:1},children:"Join"})]})]})})]}),s<De.length-1&&(0,J.jsx)(A.A,{component:"li"})]},e.id)}))})]})]}),(0,J.jsx)(S.A,{anchorEl:ue,open:Boolean(ue),onClose:We,children:(0,J.jsxs)(k.A,{onClick:async()=>{if(he&&e)try{F(!0);const e=(0,Q.wP)(Y.db),t=(0,Q.rJ)(Y.db,"conversations",he.id,"messages");(await(0,Q.GG)(t)).docs.forEach((t=>{e.delete(t.ref)}));const s=(0,Q.H9)(Y.db,"conversations",he.id);e.delete(s),await e.commit(),ee((e=>e.filter((e=>e.id!==he.id)))),se((e=>e.filter((e=>e.id!==he.id)))),fe("Conversation deleted"),Ce(!0)}catch(t){console.error("Error deleting conversation:",t),K.oR.error("Failed to delete conversation")}finally{F(!1),We()}else We()},sx:{color:"error.main"},children:[(0,J.jsx)(M.A,{children:(0,J.jsx)(_.A,{fontSize:"small",color:"error"})}),"Delete conversation"]})}),(0,J.jsxs)(R.A,{open:ie,onClose:()=>le(!1),maxWidth:"sm",fullWidth:!0,children:[(0,J.jsx)(E.A,{children:(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,J.jsx)(i.A,{variant:"h6",children:"Start a new conversation"}),(0,J.jsx)(u.A,{edge:"end",color:"inherit",onClick:()=>le(!1),"aria-label":"close",children:(0,J.jsx)(B.A,{})})]})}),(0,J.jsxs)(P.A,{children:[(0,J.jsx)(j.A,{autoFocus:!0,margin:"dense",fullWidth:!0,label:"Search for a user",variant:"outlined",value:re,onChange:e=>oe(e.target.value),onKeyPress:e=>"Enter"===e.key&&Le(),InputProps:{endAdornment:(0,J.jsx)(v.A,{position:"end",children:(0,J.jsx)(u.A,{onClick:Le,children:(0,J.jsx)(G.A,{})})})},sx:{mb:2}}),ne.length>0&&(0,J.jsx)(c.A,{children:ne.map((r=>(0,J.jsxs)(d.Ay,{button:!0,onClick:()=>(async s=>{if(null!==e&&void 0!==e&&e.uid){de(!0);try{var r;const o=(0,Q.P)((0,Q.rJ)(Y.db,"conversations"),(0,Q._M)("participants","array-contains",e.uid)),n=await(0,Q.GG)(o);let a=null;if(n.docs.forEach((e=>{e.data().participants.includes(s)&&(a=e.id)})),a)return void t("/chat/conversation/".concat(a));const i=(0,Q.H9)(Y.db,"users",s),l=await(0,Q.x7)(i);if(!l.exists())return void K.oR.error("User not found");const c=l.data(),d=(null===(r=c.following)||void 0===r?void 0:r.includes(e.uid))||!1;console.log("[Messages] Creating conversation: ".concat(c.username||s," follows current user? ").concat(d));const u=(0,Q.H9)((0,Q.rJ)(Y.db,"conversations"));await(0,Q.BN)(u,{participants:[e.uid,s],createdAt:(0,Q.O5)(),lastUpdated:(0,Q.O5)(),unreadCount:{[e.uid]:0,[s]:0},status:d?"accepted":"pending"}),t("/chat/conversation/".concat(u.id))}catch(o){console.error("[Messages] Error creating conversation:",o),K.oR.error("Failed to start conversation")}finally{de(!1),le(!1)}}})(r.id),disabled:ce,children:[(0,J.jsx)(m.A,{children:(0,J.jsxs)(a.A,{sx:{position:"relative"},children:[(0,J.jsx)(x.A,{src:r.profilePic,alt:r.username||r.name}),(0,J.jsx)(a.A,{sx:{position:"absolute",bottom:2,top:10,right:10,transform:"translate(50%, 50%)",zIndex:4},children:(0,J.jsx)(O.A,{isOnline:s(r.id),size:"small"})})]})}),(0,J.jsx)(p.A,{primary:r.name||r.username,secondary:"@".concat(r.username)})]},r.id)))}),re&&0===ne.length&&!o&&(0,J.jsxs)(a.A,{sx:{textAlign:"center",py:3},children:[(0,J.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:['No users found for "',re,'"']}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try using a different search term"})]}),o&&(0,J.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:3},children:[(0,J.jsx)(w.A,{size:32,sx:{mb:2}}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Searching for users..."})]}),!re&&!o&&(0,J.jsx)(a.A,{sx:{textAlign:"center",py:3},children:(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Enter a username or name to search"})})]})]}),(0,J.jsxs)(R.A,{open:Se,onClose:()=>ke(!1),maxWidth:"sm",fullWidth:!0,children:[(0,J.jsx)(E.A,{children:"Create Server Chat Room"}),(0,J.jsxs)(P.A,{children:[(0,J.jsx)(U.A,{sx:{mb:2},children:"Server chat rooms allow you to broadcast updates to your followers, share announcements, and create polls. Your followers can join these rooms to stay updated with your content."}),(0,J.jsx)(j.A,{autoFocus:!0,margin:"dense",label:"Room Name",fullWidth:!0,variant:"outlined",value:Me,onChange:e=>Re(e.target.value),required:!0,sx:{mb:2}}),(0,J.jsx)(j.A,{margin:"dense",label:"Description",fullWidth:!0,variant:"outlined",value:Ee,onChange:e=>Pe(e.target.value),multiline:!0,rows:3,placeholder:"What is this room about? Who should join?",sx:{mb:2}}),(0,J.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Room Rules (Optional)"}),(0,J.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Set guidelines for your room members to follow"}),Ue.map(((e,t)=>(0,J.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,J.jsx)(j.A,{fullWidth:!0,variant:"outlined",placeholder:"Rule ".concat(t+1),value:e,onChange:e=>((e,t)=>{const s=[...Ue];s[e]=t,ze(s)})(t,e.target.value),size:"small"}),Ue.length>1&&(0,J.jsx)(u.A,{onClick:()=>(e=>{const t=Ue.filter(((t,s)=>s!==e));ze(0===t.length?[""]:t)})(t),sx:{ml:1},size:"small",color:"error",children:(0,J.jsx)(_.A,{fontSize:"small"})})]},t))),(0,J.jsx)(l.A,{variant:"outlined",startIcon:(0,J.jsx)(q.A,{}),onClick:()=>{ze([...Ue,""])},size:"small",sx:{mt:1},children:"Add Rule"})]}),(0,J.jsxs)(z.A,{children:[(0,J.jsx)(l.A,{onClick:()=>{ke(!1),Re(""),Pe(""),ze([""])},disabled:Ie,children:"Cancel"}),(0,J.jsx)(l.A,{onClick:async()=>{if(null!==e&&void 0!==e&&e.uid&&Me.trim()){Oe(!0);try{const r=Ue.filter((e=>""!==e.trim())),o=(0,Q.H9)((0,Q.rJ)(Y.db,"rooms"));await(0,Q.BN)(o,{name:Me.trim(),description:Ee.trim(),rules:r,createdBy:e.uid,createdAt:(0,Q.O5)(),members:[e.uid],type:"public",lastMessage:null});try{const t=(0,Q.H9)(Y.db,"users",e.uid),s=await(0,Q.x7)(t),r=s.exists()?s.data():null;if(r&&r.followers&&Array.isArray(r.followers)){const t=r.followers,s=(0,Q.rJ)(Y.db,"notifications"),n=t.map((t=>(0,Q.gS)(s,{type:"room_created",senderId:e.uid,senderName:r.name||r.username||e.displayName||"User",senderAvatar:r.profilePic||e.photoURL||"",recipientId:t,content:"".concat(r.name||r.username||"User"," created a new room: ").concat(Me.trim()),roomId:o.id,roomName:Me.trim(),isRead:!1,createdAt:(0,Q.O5)()})));await Promise.all(n),console.log("Sent room creation notifications to ".concat(t.length," followers"))}}catch(s){console.error("Error sending room creation notifications:",s)}Re(""),Pe(""),ze([""]),ke(!1),t("/chat/room/".concat(o.id)),fe("Room created successfully"),Ce(!0)}catch(r){console.error("Error creating room:",r),K.oR.error("Failed to create room")}finally{Oe(!1)}}},variant:"contained",disabled:!Me.trim()||Ie,children:Ie?(0,J.jsx)(w.A,{size:24}):"Create Room"})]})]}),(0,J.jsx)(I.A,{open:we,autoHideDuration:4e3,onClose:()=>{Ce(!1)},message:ye})]})}},9885:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(3235),o=s(4414);const n=(0,r.A)((0,o.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")}}]);