"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[951],{5951:(e,o,t)=>{t.r(o),t.d(o,{default:()=>Ae});var r=t(9379),i=t(9950),s=t(4857),a=t(6589),n=t(6491),l=t(6639),d=t(9808),c=t(5333),u=t(2053),x=t(8145),h=t(2046),p=t(2235),m=t(249),b=t(6050),g=t(8614),v=t(1413),f=t(3563),A=t(4745),y=t(2236),j=t(4142),w=t(1378),C=t(899),k=t(470),S=t(3569),P=t(5277),I=t(704),z=t(226),R=t(6583),U=t(33),E=t(8170),M=t(9739),F=t(9715),W=t(6835),D=t(6164),L=t(7092),G=t(227),T=t(4066),H=t(7920),B=t(2960),O=t(9874),N=t(1082),_=t(8786),V=t(4517),J=t(8429),q=t(6220),Y=t(330),K=t(1367),Z=t(5887),X=t(7081);const Q=e=>{try{return(0,X.A)(e)}catch(o){return e instanceof Date?e.toLocaleString():new Date(e).toLocaleString()}},$=e=>{if(!e)return"";try{return e.toDate?Q(e.toDate()):e instanceof Date?Q(e):Q(new Date(e))}catch(o){return console.error("Error formatting timestamp:",o),""}};var ee=t(9325),oe=t(1849),te=t(2472),re=t(4862),ie=t(3174),se=t(3256),ae=t(5788),ne=t(6052),le=t(7222),de=t(7341),ce=t(9751),ue=t(4414);const xe=()=>{var e,o,t,d,h,p;const{currentUser:m,blockUser:b}=(0,K.As)(),g=(0,J.Zp)(),f=(0,s.A)(),A=(0,a.A)(f.breakpoints.down("sm")),[y,j]=(0,i.useState)([]),[w,C]=(0,i.useState)(!0),[S,U]=(0,i.useState)(null),[M,F]=(0,i.useState)(0),[D,L]=(0,i.useState)(0),[G,T]=(0,i.useState)(""),[H,B]=(0,i.useState)(null),[O,N]=(0,i.useState)(!1),[_,V]=(0,i.useState)(null),[Z,X]=(0,i.useState)(null),[Q,$]=(0,i.useState)(!1),[ee,oe]=(0,i.useState)(!1),[xe,he]=(0,i.useState)(null),[pe,me]=(0,i.useState)(null),[be,ge]=(0,i.useState)(null),[ve,fe]=(0,i.useState)(null),[Ae,ye]=(0,i.useState)(!1),[je,we]=(0,i.useState)([]),[Ce,ke]=(0,i.useState)(null),[Se,Pe]=(0,i.useState)(""),[Ie,ze]=(0,i.useState)(!1),[Re,Ue]=(0,i.useState)(!1),[Ee,Me]=(0,i.useState)(!1),[Fe,We]=(0,i.useState)([]),[De,Le]=(0,i.useState)(!1),[Ge,Te]=(0,i.useState)(null),[He,Be]=(0,i.useState)(!1),[Oe,Ne]=(0,i.useState)(null),[_e,Ve]=(0,i.useState)(!1),Je=async()=>{if(m)try{const e=(0,q.H9)(Y.db,"users",m.uid),o=await(0,q.x7)(e);o.exists()&&Ne(o.data())}catch(_){console.error("Error fetching user profile:",_)}};(0,i.useEffect)((()=>{console.log("State update:",{previewMode:Re,showPostDrawer:Ie,hasSelectedFile:!!H,hasCapturedPhoto:!!pe,hasRecordedVideo:!!xe,showCameraView:Q})}),[Re,Ie,H,pe,xe,Q]);const qe=(0,i.useRef)(null),Ye=(0,i.useRef)(null),Ke=(0,i.useRef)(null),Ze=(0,i.useRef)(null),Xe=async()=>{if(m)try{C(!0),console.log("Fetching stories for user:",m.uid);const t=(0,q.P)((0,q.rJ)(Y.db,"users/".concat(m.uid,"/following"))),r=(await(0,q.GG)(t)).docs.map((e=>e.id));console.log("Following list from subcollection:",r);const i=[m.uid,...r];console.log("All user IDs to fetch stories for:",i);const s=new Date;let a;s.setHours(s.getHours()-24);try{if(i.length<=10){const e=(0,q.P)((0,q.rJ)(Y.db,"stories"),(0,q._M)("userId","in",i),(0,q._M)("expiresAt",">",q.Dc.fromDate(s)),(0,q.My)("expiresAt"),(0,q.My)("createdAt","desc"));console.log("Executing stories query for",i.length,"users..."),a=await(0,q.GG)(e),console.log("Found",a.docs.length,"stories")}else{console.log("More than 10 users, batching queries...");const e=[];for(let t=0;t<i.length;t+=10){const o=i.slice(t,t+10),r=(0,q.P)((0,q.rJ)(Y.db,"stories"),(0,q._M)("userId","in",o),(0,q._M)("expiresAt",">",q.Dc.fromDate(s)),(0,q.My)("expiresAt"),(0,q.My)("createdAt","desc"));e.push((0,q.GG)(r))}const o=(await Promise.all(e)).flatMap((e=>e.docs));a={docs:o},console.log("Found",o.length,"stories from batched queries")}}catch(o){console.error("Error with compound query, trying simpler approach:",o);const e=(0,q.P)((0,q.rJ)(Y.db,"stories"),(0,q._M)("userId","==",m.uid),(0,q._M)("expiresAt",">",q.Dc.fromDate(s)),(0,q.My)("expiresAt","desc"));a=await(0,q.GG)(e),console.log("Fallback query found",a.docs.length,"user stories")}const n=[];for(const o of a.docs){var e;const t=o.data();console.log("Processing story:",o.id,t);const r=(0,q.H9)(Y.db,"users",t.userId),i=(await(0,q.x7)(r)).data();n.push({id:o.id,userId:t.userId,username:(null===i||void 0===i?void 0:i.username)||(null===i||void 0===i?void 0:i.name)||"Unknown User",userAvatar:(null===i||void 0===i?void 0:i.profilePic)||(null===i||void 0===i?void 0:i.photoURL)||"",content:t.content||"",mediaUrl:t.mediaUrl,mediaType:t.mediaType,createdAt:t.createdAt,expiresAt:t.expiresAt,views:t.views||[],isViewed:(null===(e=t.views)||void 0===e?void 0:e.includes(m.uid))||!1})}console.log("Processed stories:",n);const l={};n.forEach((e=>{l[e.userId]||(l[e.userId]={userId:e.userId,username:e.username,userAvatar:e.userAvatar,stories:[],hasUnviewed:!1}),l[e.userId].stories.push(e),e.isViewed||e.userId===m.uid||(l[e.userId].hasUnviewed=!0)}));const d=Object.values(l).sort(((e,o)=>e.userId===m.uid?-1:o.userId===m.uid?1:e.hasUnviewed&&!o.hasUnviewed?-1:!e.hasUnviewed&&o.hasUnviewed?1:0));console.log("Final story groups:",d),j(d)}catch(_){console.error("Error fetching stories:",_),V("Failed to load stories")}finally{C(!1)}else console.log("No current user, skipping story fetch")},Qe=async e=>{if(m)try{const o=(0,q.H9)(Y.db,"stories",e);await(0,q.mZ)(o,{views:(0,q.hq)(m.uid)})}catch(_){console.error("Error marking story as viewed:",_)}},$e=async e=>{if(m)try{const o=(0,q.H9)(Y.db,"stories",e),t=await(0,q.x7)(o);if(t.exists()){const e=t.data().views||[],o=[];for(const t of e){const e=(0,q.H9)(Y.db,"users",t),r=await(0,q.x7)(e);if(r.exists()){const e=r.data();o.push({id:t,username:e.username||e.name||"Unknown User",avatar:e.profilePic||e.photoURL||""})}}We(o),Me(!0)}}catch(_){console.error("Error getting story viewers:",_),V("Failed to load viewers")}};(0,i.useEffect)((()=>(S&&S.stories.length>0&&!Ee&&(Ze.current=setInterval((()=>{L((e=>{if(e>=100){const e=M+1;return e<S.stories.length?(F(e),S.stories[e].userId!==(null===m||void 0===m?void 0:m.uid)&&Qe(S.stories[e].id),0):(U(null),0)}return e+2}))}),100)),()=>{Ze.current&&clearInterval(Ze.current)})),[S,M,m,Ee]);const eo=()=>{if(!S)return;const e=M+1;e<S.stories.length?(F(e),L(0),S.stories[e].userId!==(null===m||void 0===m?void 0:m.uid)&&Qe(S.stories[e].id)):U(null)},oo=()=>{M>0&&(F(M-1),L(0))},to=async()=>{try{const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?{facingMode:"user",width:{ideal:720},height:{ideal:1280}}:{facingMode:"user",width:{ideal:1280},height:{ideal:720}},o=await navigator.mediaDevices.getUserMedia({video:e,audio:!0});ge(o),$(!0),setTimeout((()=>{Ke.current&&o&&(Ke.current.srcObject=o,Ke.current.play().catch(console.error))}),100)}catch(_){console.error("Error accessing camera:",_),V("Could not access camera. Please check permissions.")}},ro=()=>{be&&(be.getTracks().forEach((e=>e.stop())),ge(null)),$(!1),oe(!1),he(null),me(null),Ue(!1),ze(!1),we([]),T(""),B(null)},io=()=>{const e={id:Date.now().toString(),text:Se||"Tap to edit",x:50,y:50,fontSize:24,color:"#ffffff"};we((o=>[...o,e])),Pe(""),ye(!1)},so=(e,o)=>{we((t=>t.map((t=>t.id===e?(0,r.A)((0,r.A)({},t),o):t))))};return(0,i.useEffect)((()=>{Q&&be&&Ke.current&&(Ke.current.srcObject=be,Ke.current.play().catch(console.error))}),[Q,be]),(0,i.useEffect)((()=>()=>{be&&be.getTracks().forEach((e=>e.stop()))}),[be]),(0,i.useEffect)((()=>{Xe(),Je()}),[m]),w?(0,ue.jsx)(n.A,{sx:{display:"flex",justifyContent:"center",py:2},children:(0,ue.jsx)(l.A,{size:24})}):(0,ue.jsxs)(n.A,{sx:{py:1,"& @keyframes pulse":{"0%":{transform:"scale(1)",boxShadow:"0 8px 30px rgba(0, 122, 255, 0.6)"},"50%":{transform:"scale(1.05)",boxShadow:"0 12px 40px rgba(0, 122, 255, 0.8)"},"100%":{transform:"scale(1)",boxShadow:"0 8px 30px rgba(0, 122, 255, 0.6)"}}},children:[(0,ue.jsx)(u.A,{variant:"h6",sx:{mb:1,fontWeight:600},children:"Peeks"}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:2,overflowX:"auto",pb:1,"&::-webkit-scrollbar":{height:6},"&::-webkit-scrollbar-track":{backgroundColor:"rgba(0,0,0,0.1)",borderRadius:3},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0,0,0,0.3)",borderRadius:3}},children:[m&&(0,ue.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:80,cursor:"pointer"},onClick:to,children:[(0,ue.jsxs)(n.A,{sx:{position:"relative"},children:[(0,ue.jsx)(v.A,{src:(null===Oe||void 0===Oe?void 0:Oe.profilePic)||(null===Oe||void 0===Oe?void 0:Oe.photoURL)||m.photoURL||"",sx:{width:64,height:64,border:"2px solid",borderColor:"divider"},children:null===(e=(null===Oe||void 0===Oe?void 0:Oe.username)||(null===Oe||void 0===Oe?void 0:Oe.name)||m.displayName||m.email)||void 0===e||null===(o=e[0])||void 0===o?void 0:o.toUpperCase()}),(0,ue.jsx)(te.A,{size:"small",color:"primary",sx:{position:"absolute",bottom:-4,right:-4,width:24,height:24,minHeight:24},children:(0,ue.jsx)(se.A,{sx:{fontSize:16}})})]}),(0,ue.jsx)(u.A,{variant:"caption",sx:{mt:1,textAlign:"center"},children:"Your Story"})]}),y.map((e=>{var o;return(0,ue.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:80,cursor:"pointer"},onClick:()=>function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_e||(Ve(!0),U(e),F(o),L(0),e.stories[o]&&e.stories[o].userId!==(null===m||void 0===m?void 0:m.uid)&&Qe(e.stories[o].id),setTimeout((()=>{Ve(!1)}),500))}(e),children:[(0,ue.jsx)(v.A,{src:e.userAvatar,sx:{width:64,height:64,border:"3px solid",borderColor:e.hasUnviewed?"primary.main":"divider",p:e.hasUnviewed?.5:0},children:null===(o=e.username[0])||void 0===o?void 0:o.toUpperCase()}),(0,ue.jsx)(u.A,{variant:"caption",sx:{mt:1,textAlign:"center"},children:e.userId===(null===m||void 0===m?void 0:m.uid)?"You":e.username}),e.hasUnviewed&&(0,ue.jsx)(P.A,{label:"New",size:"small",color:"primary",sx:{mt:.5,height:16,fontSize:"0.7rem"}})]},e.userId)})),0===y.length&&(0,ue.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{py:4},children:"No stories available. Follow users to see their stories here!"})]}),(0,ue.jsx)(R.A,{open:!!S,onClose:()=>U(null),fullScreen:!0,PaperProps:{sx:{bgcolor:"black",color:"white",margin:0,maxHeight:"100vh",maxWidth:"100vw"}},TransitionProps:{timeout:300},children:S&&S.stories[M]&&(0,ue.jsxs)(n.A,{sx:{position:"relative",height:"100vh",width:"100vw",overflow:"hidden",bgcolor:"black"},children:[(0,ue.jsx)(n.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1},children:S.stories[M].mediaUrl?"video"===S.stories[M].mediaType?(0,ue.jsx)("video",{src:S.stories[M].mediaUrl,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}):(0,ue.jsx)("img",{src:S.stories[M].mediaUrl,alt:"Story",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}):(0,ue.jsx)(n.A,{sx:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center"}})}),(0,ue.jsx)(n.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 80%, rgba(0,0,0,0.3) 100%)",zIndex:2}}),(0,ue.jsx)(n.A,{sx:{position:"absolute",top:20,left:16,right:16,zIndex:10,display:"flex",gap:4},children:S.stories.map(((e,o)=>(0,ue.jsx)(n.A,{sx:{flex:1,height:3,bgcolor:"rgba(255,255,255,0.3)",borderRadius:2,overflow:"hidden"},children:(0,ue.jsx)(n.A,{sx:{height:"100%",width:o<M?"100%":o===M?"".concat(D,"%"):"0%",bgcolor:"white",transition:o===M?"none":"width 0.3s ease"}})},o)))}),(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:40,left:16,right:16,zIndex:10,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,ue.jsx)(v.A,{src:S.userAvatar,sx:{width:40,height:40,border:"2px solid white"},children:null===(t=S.username[0])||void 0===t?void 0:t.toUpperCase()}),(0,ue.jsxs)(n.A,{children:[(0,ue.jsx)(u.A,{variant:"subtitle1",sx:{fontWeight:600,fontSize:16,textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},children:S.username}),(0,ue.jsx)(u.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.8)",fontSize:12,textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},children:null===(d=S.stories[M].createdAt)||void 0===d?void 0:d.toDate().toLocaleTimeString()})]})]}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1},children:[S.stories[M].userId===(null===m||void 0===m?void 0:m.uid)&&(0,ue.jsx)(c.A,{onClick:()=>Le(!0),sx:{color:"white",bgcolor:"rgba(0,0,0,0.3)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(255,0,0,0.5)"}},children:(0,ue.jsx)(u.A,{sx:{fontSize:18},children:"\ud83d\uddd1\ufe0f"})}),(0,ue.jsx)(c.A,{onClick:()=>U(null),sx:{color:"white",bgcolor:"rgba(0,0,0,0.3)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(0,0,0,0.5)"}},children:(0,ue.jsx)(W.A,{})})]})]}),S.stories[M].content&&(0,ue.jsx)(n.A,{sx:{position:"absolute",bottom:100,left:20,right:20,zIndex:10,textAlign:"center"},children:(0,ue.jsx)(u.A,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:20,sm:24},textShadow:"2px 2px 8px rgba(0,0,0,0.8)",lineHeight:1.3,wordBreak:"break-word"},children:S.stories[M].content})}),S.stories[M].userId===(null===m||void 0===m?void 0:m.uid)&&!Ee&&(0,ue.jsxs)(n.A,{onClick:()=>$e(S.stories[M].id),sx:{position:"absolute",bottom:0,left:0,right:0,height:120,zIndex:15,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",pb:3,background:"linear-gradient(to top, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 100%)"},children:[(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1,bgcolor:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:3,backdropFilter:"blur(10px)"},children:[(0,ue.jsx)(u.A,{sx:{fontSize:16},children:"\ud83d\udc41\ufe0f"}),(0,ue.jsxs)(u.A,{variant:"body2",sx:{color:"white",fontWeight:500},children:[(null===(h=S.stories[M].views)||void 0===h?void 0:h.length)||0," views"]})]}),(0,ue.jsx)(u.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.8)",mt:1,textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},children:"Tap to see who viewed your story"})]}),Ee&&S.stories[M].userId===(null===m||void 0===m?void 0:m.uid)&&(0,ue.jsxs)(n.A,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"50vh",bgcolor:"rgba(0,0,0,0.9)",backdropFilter:"blur(20px)",zIndex:20,borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column"},children:[(0,ue.jsx)(n.A,{sx:{width:36,height:5,bgcolor:"rgba(255,255,255,0.3)",borderRadius:3,mx:"auto",mt:1,mb:2}}),(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,pb:2},children:[(0,ue.jsxs)(u.A,{variant:"h6",sx:{color:"white",fontWeight:600},children:["Viewed by ",Fe.length]}),(0,ue.jsx)(c.A,{onClick:()=>Me(!1),sx:{color:"white"},children:(0,ue.jsx)(W.A,{})})]}),(0,ue.jsx)(n.A,{sx:{flex:1,overflow:"auto",px:3},children:0===Fe.length?(0,ue.jsxs)(n.A,{sx:{textAlign:"center",py:4,color:"rgba(255,255,255,0.7)"},children:[(0,ue.jsx)(u.A,{sx:{fontSize:48,mb:2},children:"\ud83d\udc41\ufe0f"}),(0,ue.jsx)(u.A,{variant:"body1",sx:{color:"white"},children:"No views yet"}),(0,ue.jsx)(u.A,{variant:"body2",children:"When people view your story, you'll see them here"})]}):(0,ue.jsx)(n.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:Fe.map((e=>{var o;return(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:2,py:1,position:"relative"},children:[(0,ue.jsx)(v.A,{src:e.avatar,sx:{width:50,height:50},children:null===(o=e.username[0])||void 0===o?void 0:o.toUpperCase()}),(0,ue.jsx)(n.A,{sx:{flex:1},children:(0,ue.jsx)(u.A,{variant:"body1",sx:{fontWeight:500,color:"white"},children:e.username})}),(0,ue.jsx)(c.A,{onClick:()=>{Te(e),Be(!0)},sx:{color:"rgba(255,255,255,0.7)","&:hover":{color:"white",bgcolor:"rgba(255,255,255,0.1)"}},children:(0,ue.jsx)(u.A,{sx:{fontSize:20,fontWeight:"bold"},children:"\u22ef"})})]},e.id)}))})})]}),S.stories[M].userId!==(null===m||void 0===m?void 0:m.uid)&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(n.A,{sx:{position:"absolute",left:0,top:0,bottom:0,width:"40%",cursor:"pointer",zIndex:5,display:"flex",alignItems:"center",justifyContent:"flex-start",pl:2},onClick:oo,children:M>0&&(0,ue.jsx)(ae.A,{sx:{color:"rgba(255,255,255,0.0)",fontSize:40,transition:"color 0.2s ease","&:hover":{color:"rgba(255,255,255,0.7)"}}})}),(0,ue.jsx)(n.A,{sx:{position:"absolute",right:0,top:0,bottom:0,width:"40%",cursor:"pointer",zIndex:5,display:"flex",alignItems:"center",justifyContent:"flex-end",pr:2},onClick:eo,children:(0,ue.jsx)(ne.A,{sx:{color:"rgba(255,255,255,0.0)",fontSize:40,transition:"color 0.2s ease","&:hover":{color:"rgba(255,255,255,0.7)"}}})})]}),S.stories[M].userId===(null===m||void 0===m?void 0:m.uid)&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(n.A,{sx:{position:"absolute",left:0,top:100,bottom:150,width:"25%",cursor:"pointer",zIndex:5,display:"flex",alignItems:"center",justifyContent:"flex-start",pl:2},onClick:oo,children:M>0&&(0,ue.jsx)(ae.A,{sx:{color:"rgba(255,255,255,0.0)",fontSize:40,transition:"color 0.2s ease","&:hover":{color:"rgba(255,255,255,0.7)"}}})}),(0,ue.jsx)(n.A,{sx:{position:"absolute",right:0,top:100,bottom:150,width:"25%",cursor:"pointer",zIndex:5,display:"flex",alignItems:"center",justifyContent:"flex-end",pr:2},onClick:eo,children:(0,ue.jsx)(ne.A,{sx:{color:"rgba(255,255,255,0.0)",fontSize:40,transition:"color 0.2s ease","&:hover":{color:"rgba(255,255,255,0.7)"}}})})]})]})}),(0,ue.jsx)(R.A,{open:Q,onClose:ro,maxWidth:"md",fullWidth:!0,fullScreen:A,PaperProps:{sx:{bgcolor:"black",color:"white",height:A?"100vh":"90vh"}},children:(0,ue.jsxs)(E.A,{sx:{p:0,position:"relative",height:"100%",display:"flex"},children:[(0,ue.jsxs)(n.A,{sx:{flex:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"black",width:"100%",height:"100%"},children:[Re?(0,ue.jsx)(n.A,{sx:{width:"100%",height:"100%",position:"relative"},children:pe?(0,ue.jsx)("img",{src:pe,alt:"Captured",style:{width:"100%",height:"100%",objectFit:"cover"}}):xe?(0,ue.jsx)("video",{src:URL.createObjectURL(xe),controls:!0,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"},onLoadedData:()=>console.log("Recorded video loaded for preview"),onError:e=>console.error("Error loading recorded video:",e)}):null}):(0,ue.jsx)("video",{ref:Ke,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)"},onLoadedMetadata:()=>{Ke.current&&Ke.current.play().catch(console.error)}}),(0,ue.jsx)(n.A,{sx:{position:"absolute",bottom:20,left:0,right:0,display:"flex",justifyContent:"space-between",alignItems:"center",px:3},children:Re?(0,ue.jsx)(n.A,{sx:{display:"flex",gap:2,width:"100%",justifyContent:"center"},children:(0,ue.jsx)(z.A,{onClick:()=>{he(null),B(null),me(null),we([]),Ue(!1),ze(!1),T(""),be&&Ke.current?(Ke.current.srcObject=be,Ke.current.play().catch(console.error)):be||to()},variant:"outlined",sx:{color:"white",borderColor:"white",px:4,py:1.5,borderRadius:3},children:"Retake"})}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(c.A,{onClick:()=>{if(!Ke.current||!be)return;const e=document.createElement("canvas"),o=Ke.current;e.width=o.videoWidth,e.height=o.videoHeight;const t=e.getContext("2d");if(t){t.scale(-1,1),t.drawImage(o,-e.width,0,e.width,e.height);const r=e.toDataURL("image/jpeg",.8);me(r),e.toBlob((e=>{if(e){const o=new File([e],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg"});B(o),Ue(!0)}}),"image/jpeg",.8)}},sx:{width:60,height:60,bgcolor:"rgba(255,255,255,0.2)",color:"white",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(255,255,255,0.3)"}},children:(0,ue.jsx)(le.A,{sx:{fontSize:28}})}),(0,ue.jsx)(c.A,{onClick:ee?()=>{if(console.log("Stopping recording...",{mediaRecorder:!!ve,isRecording:ee}),ve&&ee)try{ve.stop(),oe(!1),fe(null),console.log("Recording stop requested")}catch(_){console.error("Error stopping recording:",_),V("Error stopping recording")}}:()=>{if(be)try{if(console.log("Starting video recording..."),!MediaRecorder.isTypeSupported("video/webm")&&(console.warn("video/webm not supported, trying video/mp4"),!MediaRecorder.isTypeSupported("video/mp4")))return void V("Video recording not supported on this device");const e=MediaRecorder.isTypeSupported("video/webm")?"video/webm":"video/mp4",o=new MediaRecorder(be,{mimeType:e,videoBitsPerSecond:25e5}),t=[];o.ondataavailable=e=>{console.log("Data available:",e.data.size,"bytes"),e.data.size>0&&t.push(e.data)},o.onstop=()=>{console.log("Recording stopped, creating blob from",t.length,"chunks");const o=new Blob(t,{type:e});if(console.log("Created blob:",o.size,"bytes"),0===o.size)return console.error("Recorded blob is empty!"),void V("Recording failed - no data captured");he(o);const r="video/webm"===e?"webm":"mp4",i=new File([o],"story_".concat(Date.now(),".").concat(r),{type:e});B(i),console.log("Switching to preview mode..."),Ue(!0)},o.onerror=e=>{console.error("MediaRecorder error:",e),V("Recording error occurred")},o.start(1e3),fe(o),oe(!0),console.log("Recording started successfully")}catch(_){console.error("Error starting recording:",_),V("Could not start recording")}else console.error("No camera stream available for recording")},sx:{width:80,height:80,bgcolor:ee?"error.main":"white",color:ee?"white":"primary.main",border:ee?"none":"4px solid white","&:hover":{bgcolor:ee?"error.dark":"rgba(255,255,255,0.9)"}},children:ee?(0,ue.jsx)(n.A,{sx:{width:30,height:30,bgcolor:"white",borderRadius:1}}):(0,ue.jsx)(n.A,{sx:{width:30,height:30,bgcolor:"error.main",borderRadius:"50%"}})}),(0,ue.jsx)(c.A,{onClick:()=>{qe.current&&qe.current.click()},sx:{width:60,height:60,bgcolor:"rgba(255,255,255,0.2)",color:"white",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(255,255,255,0.3)"}},children:(0,ue.jsx)(de.A,{sx:{fontSize:28}})})]})}),Re&&(H||pe||xe)&&(0,ue.jsx)(te.A,{onClick:()=>{console.log("Next button clicked - posting story directly!"),(async()=>{if(console.log("Creating story...",{hasUser:!!m,hasContent:!!G.trim(),hasFile:!!H}),m&&(G.trim()||H))try{N(!0),V(null);let o,t="";if(H){var e;console.log("Uploading file:",H.name,H.type);const r=null===(e=H.name.split(".").pop())||void 0===e?void 0:e.toLowerCase();o=["jpg","jpeg","png","gif","webp"].includes(r||"")?"image":"video";const i=(0,ce.KR)(Y.IG,"stories/".concat(m.uid,"/").concat(Date.now(),"_").concat(H.name));console.log("Storage ref created:",i.fullPath);const s=await(0,ce.D)(i,H);console.log("Upload completed:",s),t=await(0,ce.qk)(s.ref),console.log("Download URL obtained:",t)}const r=new Date;r.setHours(r.getHours()+24);const i={userId:m.uid,content:G.trim(),mediaUrl:t,mediaType:o,createdAt:(0,q.O5)(),expiresAt:q.Dc.fromDate(r),views:[]};console.log("Creating story document:",i);const s=await(0,q.gS)((0,q.rJ)(Y.db,"stories"),i);console.log("Story created with ID:",s.id);const a=await(0,q.x7)(s);a.exists()?console.log("Story verified in database:",a.data()):console.error("Story was not found after creation!"),X("Story created successfully!"),ze(!1),$(!1),Ue(!1),T(""),B(null),he(null),me(null),we([]),be&&(be.getTracks().forEach((e=>e.stop())),ge(null)),console.log("Refreshing stories..."),setTimeout((async()=>{await Xe(),await Je(),console.log("Stories refreshed")}),1e3)}catch(_){console.error("Error creating story:",_),V("Failed to create story: ".concat(_ instanceof Error?_.message:"Unknown error"))}finally{N(!1)}else V("Please add content or select a file")})()},sx:{position:"absolute",bottom:100,right:30,bgcolor:"#007aff",color:"white",width:70,height:70,zIndex:1e5,boxShadow:"0 8px 30px rgba(0, 122, 255, 0.6)",border:"3px solid white","&:hover":{bgcolor:"#0056b3",transform:"scale(1.1)",boxShadow:"0 12px 40px rgba(0, 122, 255, 0.8)"},transition:"all 0.3s ease-in-out"},children:(0,ue.jsx)(ne.A,{sx:{fontSize:28}})}),A&&Ae&&(0,ue.jsxs)(n.A,{sx:{position:"absolute",bottom:120,left:16,right:16,bgcolor:"rgba(0,0,0,0.8)",borderRadius:2,p:2,zIndex:15},children:[(0,ue.jsx)(x.A,{fullWidth:!0,placeholder:"Add text to your story...",value:Se,onChange:e=>Pe(e.target.value),autoFocus:!0,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.3)"},"&:hover fieldset":{borderColor:"rgba(255,255,255,0.5)"},"&.Mui-focused fieldset":{borderColor:"primary.main"}}}}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1,mt:1,justifyContent:"flex-end"},children:[(0,ue.jsx)(z.A,{onClick:()=>{ye(!1),Pe(""),ke(null)},size:"small",sx:{color:"white"},children:"Cancel"}),(0,ue.jsx)(z.A,{onClick:()=>{Ce?(so(Ce,{text:Se}),ke(null)):io(),ye(!1)},variant:"contained",size:"small",disabled:!Se.trim(),children:Ce?"Update":"Add"})]})]}),je.map((e=>(0,ue.jsx)(n.A,{sx:{position:"absolute",left:"".concat(e.x,"%"),top:"".concat(e.y,"%"),transform:"translate(-50%, -50%)",color:e.color,fontSize:e.fontSize,fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.8)",cursor:"pointer",userSelect:"none",zIndex:5},onClick:()=>{ke(e.id),Pe(e.text),ye(!0)},children:e.text},e.id))),(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:16,left:16,right:16,display:"flex",justifyContent:"space-between",alignItems:"center",zIndex:10},children:[(0,ue.jsx)(c.A,{onClick:()=>ye(!0),sx:{color:"white",bgcolor:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},children:(0,ue.jsx)(u.A,{sx:{fontSize:20,fontWeight:"bold"},children:"Aa"})}),(0,ue.jsx)(c.A,{onClick:ro,sx:{color:"white",bgcolor:"rgba(0,0,0,0.5)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},children:(0,ue.jsx)(W.A,{})})]}),ee&&(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:70,left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:1,bgcolor:"rgba(0,0,0,0.7)",px:2,py:1,borderRadius:2,zIndex:10},children:[(0,ue.jsx)(n.A,{sx:{width:8,height:8,bgcolor:"error.main",borderRadius:"50%",animation:"pulse 1s infinite"}}),(0,ue.jsx)(u.A,{variant:"body2",sx:{color:"white",fontWeight:"bold"},children:"Recording..."})]})]}),!A&&(0,ue.jsxs)(n.A,{sx:{width:300,position:"relative",height:"100%",bgcolor:"rgba(0,0,0,0.8)",p:2,display:"flex",flexDirection:"column",gap:2},children:[(0,ue.jsx)(u.A,{variant:"h6",sx:{color:"white",mb:2},children:"Create Your Peek"}),(0,ue.jsx)(x.A,{fullWidth:!0,multiline:!0,rows:3,placeholder:"Add a caption...",value:G,onChange:e=>T(e.target.value),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.3)"},"&:hover fieldset":{borderColor:"rgba(255,255,255,0.5)"},"&.Mui-focused fieldset":{borderColor:"primary.main"}},"& .MuiInputLabel-root":{color:"rgba(255,255,255,0.7)"}}}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,ue.jsx)(z.A,{startIcon:(0,ue.jsx)(le.A,{}),onClick:()=>{var e;return null===(e=qe.current)||void 0===e?void 0:e.click()},variant:"outlined",size:"small",sx:{color:"white",borderColor:"white"},children:"Photo"}),(0,ue.jsx)(z.A,{startIcon:(0,ue.jsx)(de.A,{}),onClick:()=>{var e;return null===(e=qe.current)||void 0===e?void 0:e.click()},variant:"outlined",size:"small",sx:{color:"white",borderColor:"white"},children:"Gallery"})]}),H&&(0,ue.jsx)(k.A,{sx:{bgcolor:"rgba(255,255,255,0.1)"},children:(0,ue.jsx)(I.A,{children:(0,ue.jsx)(u.A,{variant:"body2",sx:{color:"white"},children:H.name})})})]}),(0,ue.jsx)("input",{ref:qe,type:"file",accept:"image/*,video/*",onChange:e=>{var o;const t=null===(o=e.target.files)||void 0===o?void 0:o[0];if(t){if(t.size>52428800)return void V("File size must be less than 50MB");B(t),Ue(!0),$(!0)}e.target.value=""},style:{display:"none"}}),(0,ue.jsx)("input",{ref:Ye,type:"file",accept:"image/*",onChange:e=>{var o;const t=null===(o=e.target.files)||void 0===o?void 0:o[0];if(t&&t.type.startsWith("image/")){if(t.size>52428800)return void V("File size must be less than 50MB");B(t),Ue(!0),$(!0)}e.target.value=""},style:{display:"none"}})]})}),!A&&(0,ue.jsx)(R.A,{open:Ae,onClose:()=>{ye(!1),ke(null),Pe("")},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"rgba(0,0,0,0.9)",color:"white",backdropFilter:"blur(20px)"}},children:(0,ue.jsxs)(E.A,{sx:{p:3},children:[(0,ue.jsx)(u.A,{variant:"h6",sx:{mb:2,color:"white"},children:Ce?"Edit Text":"Add Text"}),(0,ue.jsx)(x.A,{fullWidth:!0,multiline:!0,rows:3,placeholder:"Enter your text...",value:Se,onChange:e=>Pe(e.target.value),autoFocus:!0,sx:{mb:3,"& .MuiOutlinedInput-root":{color:"white",fontSize:"1.2rem","& fieldset":{borderColor:"rgba(255,255,255,0.3)"},"&:hover fieldset":{borderColor:"rgba(255,255,255,0.5)"},"&.Mui-focused fieldset":{borderColor:"primary.main"}}}}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[Ce&&(0,ue.jsx)(z.A,{onClick:()=>{var e;e=Ce,we((o=>o.filter((o=>o.id!==e)))),ke(null),ye(!1)},color:"error",variant:"outlined",children:"Delete"}),(0,ue.jsx)(z.A,{onClick:()=>{ye(!1),ke(null),Pe("")},sx:{color:"white"},children:"Cancel"}),(0,ue.jsx)(z.A,{onClick:()=>{Ce?(so(Ce,{text:Se}),ke(null)):io(),ye(!1)},variant:"contained",color:"primary",disabled:!Se.trim(),children:Ce?"Update":"Add"})]})]})}),(0,ue.jsx)(R.A,{open:He,onClose:()=>{Be(!1),Te(null)},PaperProps:{sx:{borderRadius:3,bgcolor:"#1c1c1e",color:"white",minWidth:300}},children:Ge&&(0,ue.jsxs)(n.A,{sx:{p:2},children:[(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,pb:2,borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[(0,ue.jsx)(v.A,{src:Ge.avatar,sx:{width:50,height:50},children:null===(p=Ge.username[0])||void 0===p?void 0:p.toUpperCase()}),(0,ue.jsxs)(n.A,{children:[(0,ue.jsx)(u.A,{variant:"h6",sx:{fontWeight:600},children:Ge.username}),(0,ue.jsx)(u.A,{variant:"body2",sx:{color:"rgba(255,255,255,0.7)"},children:"Story viewer"})]})]}),(0,ue.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,ue.jsxs)(z.A,{onClick:()=>{return e=Ge.id,Be(!1),Te(null),Me(!1),U(null),void g("/profile/".concat(e));var e},sx:{justifyContent:"flex-start",color:"white",textTransform:"none",py:1.5,px:2,borderRadius:2,"&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[(0,ue.jsx)(u.A,{sx:{fontSize:18,mr:2},children:"\ud83d\udc64"}),"View Profile"]}),(0,ue.jsxs)(z.A,{onClick:()=>{S&&(async(e,o)=>{if(m)try{const t=(0,q.H9)(Y.db,"stories",o);await(0,q.mZ)(t,{hiddenFrom:(0,q.hq)(e)}),X("Story hidden from user"),Be(!1),Te(null),S&&await $e(S.stories[M].id)}catch(_){console.error("Error hiding story:",_),V("Failed to hide story")}})(Ge.id,S.stories[M].id)},sx:{justifyContent:"flex-start",color:"white",textTransform:"none",py:1.5,px:2,borderRadius:2,"&:hover":{bgcolor:"rgba(255,255,255,0.1)"}},children:[(0,ue.jsx)(u.A,{sx:{fontSize:18,mr:2},children:"\ud83d\ude48"}),"Hide Story From This User"]}),(0,ue.jsxs)(z.A,{onClick:()=>(async e=>{if(m)try{await b(e),X("User blocked successfully"),Be(!1),Te(null),S&&await $e(S.stories[M].id)}catch(_){console.error("Error blocking user:",_),V("Failed to block user")}})(Ge.id),sx:{justifyContent:"flex-start",color:"#ff3b30",textTransform:"none",py:1.5,px:2,borderRadius:2,"&:hover":{bgcolor:"rgba(255, 59, 48, 0.1)"}},children:[(0,ue.jsx)(u.A,{sx:{fontSize:18,mr:2},children:"\ud83d\udeab"}),"Block User"]})]}),(0,ue.jsx)(n.A,{sx:{mt:3,pt:2,borderTop:"1px solid rgba(255,255,255,0.1)"},children:(0,ue.jsx)(z.A,{onClick:()=>{Be(!1),Te(null)},fullWidth:!0,variant:"outlined",sx:{color:"white",borderColor:"rgba(255,255,255,0.3)",py:1.5,borderRadius:2,"&:hover":{borderColor:"rgba(255,255,255,0.5)",bgcolor:"rgba(255,255,255,0.05)"}},children:"Cancel"})})]})}),(0,ue.jsx)(R.A,{open:De,onClose:()=>Le(!1),PaperProps:{sx:{borderRadius:3,bgcolor:"#1c1c1e",color:"white"}},children:(0,ue.jsxs)(n.A,{sx:{p:3,textAlign:"center"},children:[(0,ue.jsx)(u.A,{sx:{fontSize:48,mb:2},children:"\ud83d\uddd1\ufe0f"}),(0,ue.jsx)(u.A,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Delete Story?"}),(0,ue.jsx)(u.A,{variant:"body2",sx:{color:"rgba(255,255,255,0.7)",mb:3,lineHeight:1.5},children:"This story will be permanently deleted and removed from your profile."}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[(0,ue.jsx)(z.A,{onClick:()=>Le(!1),variant:"outlined",sx:{color:"white",borderColor:"rgba(255,255,255,0.3)",px:3,py:1,borderRadius:2,"&:hover":{borderColor:"rgba(255,255,255,0.5)",bgcolor:"rgba(255,255,255,0.05)"}},children:"Cancel"}),(0,ue.jsx)(z.A,{onClick:()=>{S&&S.stories[M]&&(async e=>{if(m)try{await(0,q.kd)((0,q.H9)(Y.db,"stories",e)),Me(!1),U(null),Le(!1),X("Story deleted successfully!"),setTimeout((async()=>{await Xe()}),500)}catch(_){console.error("Error deleting story:",_),V("Failed to delete story")}})(S.stories[M].id)},variant:"contained",sx:{bgcolor:"#ff3b30",color:"white",px:3,py:1,borderRadius:2,"&:hover":{bgcolor:"#d70015"}},children:"Delete"})]})]})}),(0,ue.jsx)(re.A,{open:!!_,autoHideDuration:6e3,onClose:()=>V(null),children:(0,ue.jsx)(ie.A,{severity:"error",onClose:()=>V(null),children:_})}),(0,ue.jsx)(re.A,{open:!!Z,autoHideDuration:6e3,onClose:()=>X(null),children:(0,ue.jsx)(ie.A,{severity:"success",onClose:()=>X(null),children:Z})})]})};var he=t(5861),pe=t(7493),me=t(9317),be=t(6932),ge=t(5491),ve=t.n(ge);const fe=()=>{const{useParticipants:e}=(0,be.R3)(),o=e();return(0,ue.jsx)(me.ncL,{participants:o})},Ae=()=>{var e;const[o,t]=(0,i.useState)(0),[X,Q]=(0,i.useState)(""),[te,re]=(0,i.useState)([]),[ie,se]=(0,i.useState)([]),[ae,ne]=(0,i.useState)(!0),[le,de]=(0,i.useState)(new Set),[ce,be]=(0,i.useState)(new Set),ge=(0,J.Zp)(),{currentUser:Ae}=(0,K.As)(),[ye,je]=(0,i.useState)(null),we=(0,s.A)(),Ce=(0,a.A)(we.breakpoints.down("sm")),[ke,Se]=(0,i.useState)(!1),[Pe,Ie]=(0,i.useState)([]),[ze,Re]=(0,i.useState)(!1),Ue=i.useRef(null),[Ee,Me]=(0,i.useState)("All"),[Fe,We]=(0,i.useState)(!1),[De,Le]=(0,i.useState)(!1),[Ge,Te]=(0,i.useState)(null),[He,Be]=(0,i.useState)(null),[Oe,Ne]=(0,i.useState)([]),[_e,Ve]=(0,i.useState)([]),[Je,qe]=(0,i.useState)(""),[Ye,Ke]=(0,i.useState)("All"),[Ze,Xe]=(0,i.useState)(!1),[Qe,$e]=(0,i.useState)([]),[eo,oo]=(0,i.useState)([]),[to,ro]=(0,i.useState)(""),[io,so]=(0,i.useState)("All"),[ao,no]=(0,i.useState)(!1),[lo,co]=(0,i.useState)(!1),[uo,xo]=(0,i.useState)(!1),[ho,po]=(0,i.useState)(0),[mo,bo]=(0,i.useState)(!1),[go,vo]=(0,i.useState)(null),fo=i.useRef(null),[Ao,yo]=(0,i.useState)(null),[jo,wo]=(0,i.useState)(null),[Co,ko]=(0,i.useState)(!1),[So,Po]=(0,i.useState)(null),[Io,zo]=(0,i.useState)(!1),[Ro,Uo]=(0,i.useState)(0),Eo=["ASMR","Just Chatting","Music","Gossip","Podcasts","Shows","Social","Other"],Mo=async()=>{try{const e=(0,q.rJ)(Y.db,"users"),o=(0,q.P)(e,(0,q.My)("createdAt","desc"),(0,q.AB)(20)),t=(await(0,q.GG)(o)).docs.filter((e=>"sideeye"!==e.id&&"contact-team"!==e.id)).map((e=>({id:e.id,username:e.data().username||"",name:e.data().name||"",profilePic:e.data().profilePic,bio:e.data().bio,coverPhoto:e.data().coverPhoto,isPublic:e.data().isPublic,isAuthenticated:e.data().isAuthenticated,createdAt:e.data().createdAt,isActive:e.data().isActive,isVerified:!0,email:e.data().email})));se(t)}catch(ye){console.error("Error fetching users:",ye)}finally{ne(!1)}},Fo=async()=>{try{if(ne(!0),!Y.db)return;const e=await(async()=>{if(!Ae||!Y.db)return[];try{const e=(0,q.rJ)(Y.db,"users"),o=await(0,q.GG)(e),t=[];return o.forEach((e=>{const o=e.data();o.blockedUsers&&Array.isArray(o.blockedUsers)&&o.blockedUsers.includes(Ae.uid)&&t.push(e.id)})),[...Ae.blockedUsers||[],...t]}catch(ye){return console.error("Error fetching blocked users:",ye),[]}})(),o=(0,q.rJ)(Y.db,"sideRooms"),t=(0,q.P)(o,(0,q._M)("deleted","!=",!0)),i=await(0,q.GG)(t),s=i.docs.map((e=>{const o=e.data();return(0,r.A)({id:e.id},o)})).filter((o=>!e.includes(o.ownerId))),a=await Promise.all(s.map((async e=>{try{var o,t;const r=await(0,q.x7)((0,q.H9)(Y.db,"users",e.ownerId)),i=r.exists()?r.data():null;return{id:e.id,name:e.name||"",description:e.description||"",memberCount:e.memberCount||0,shareCount:0,isPrivate:e.isPrivate||!1,createdAt:(null===(o=e.createdAt)||void 0===o?void 0:o.toDate())||new Date,creatorName:(null===i||void 0===i?void 0:i.username)||"Unknown",creatorId:e.ownerId,creatorAvatar:(null===i||void 0===i?void 0:i.profilePic)||"",tags:e.tags||[],lastActive:(null===(t=e.lastActive)||void 0===t?void 0:t.toDate())||new Date,maxMembers:e.maxMembers||100,activeUsers:e.activeUsers||0,isLive:e.isLive||!1,thumbnailUrl:e.thumbnailUrl||"",isPopular:(e.activeUsers||0)>=200}}catch(ye){return console.error("Error fetching owner data for room ".concat(e.id,":"),ye),null}}))),n=a.filter((e=>null!==e)).sort(((e,o)=>e.isPopular&&!o.isPopular?-1:!e.isPopular&&o.isPopular?1:(o.activeUsers||0)-(e.activeUsers||0))),l=Eo.reduce(((e,o)=>(e[o]=n.filter((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.includes(o)})),e)),{});l.All=n,re(n),Object.entries(l).forEach((e=>{let[o,t]=e;console.log("Category ".concat(o,": ").concat(t.length," rooms"))}))}catch(ye){console.error("Error fetching rooms:",ye)}finally{ne(!1)}};(0,i.useEffect)((()=>{Mo(),Fo(),(async()=>{try{const e=(0,q.rJ)(Y.db,"sideRooms"),o=await(0,q.GG)(e),t=new Map;o.docs.forEach((e=>{const o=e.data(),r=o.ownerId,i=o.activeUsers||0;if(t.has(r)){const e=t.get(r);e.totalViews+=i,e.activeRooms+=1}else t.set(r,{totalViews:i,activeRooms:1})}));const r=Array.from(t.entries()).filter((e=>{let[o,t]=e;return t.totalViews>=200})).map((e=>{let[o]=e;return o})),i=await Promise.all(r.map((async e=>{const o=(0,q.H9)(Y.db,"users",e),r=await(0,q.x7)(o);if(r.exists()){var i;const o=r.data(),s=t.get(e);return{id:e,username:o.username||"",name:o.name||"",profilePic:o.profilePic,bio:o.bio,isPublic:null===(i=o.isPublic)||void 0===i||i,isAuthenticated:o.isAuthenticated,createdAt:o.createdAt,isActive:o.isActive,isVerified:!0,isTopHost:!0,totalViews:s.totalViews,activeRooms:s.activeRooms}}return null})));Ne(i.filter(Boolean))}catch(ye){console.error("Error fetching top hosts:",ye)}})(),(async()=>{try{const e=(0,q.rJ)(Y.db,"sideRooms"),o=(0,q.P)(e,(0,q._M)("deleted","!=",!0)),t=(await(0,q.GG)(o)).docs.map((e=>{const o=e.data();return(0,r.A)({id:e.id},o)})).filter((e=>(e.activeUsers||0)>=200)),i=await Promise.all(t.map((async e=>{try{var o,t;const r=await(0,q.x7)((0,q.H9)(Y.db,"users",e.ownerId)),i=r.exists()?r.data():null;return{id:e.id,name:e.name||"",description:e.description||"",memberCount:e.memberCount||0,shareCount:0,isPrivate:e.isPrivate||!1,createdAt:(null===(o=e.createdAt)||void 0===o?void 0:o.toDate())||new Date,creatorName:(null===i||void 0===i?void 0:i.username)||"Unknown",creatorId:e.ownerId,creatorAvatar:(null===i||void 0===i?void 0:i.profilePic)||"",tags:e.tags||[],lastActive:(null===(t=e.lastActive)||void 0===t?void 0:t.toDate())||new Date,maxMembers:e.maxMembers||100,activeUsers:e.activeUsers||0,isLive:e.isLive||!1,thumbnailUrl:e.thumbnailUrl||"",isPopular:!0}}catch(ye){return console.error("Error fetching owner data for room ".concat(e.id,":"),ye),null}}))),s=i.filter((e=>null!==e));$e(s),oo(s)}catch(ye){console.error("Error fetching popular rooms:",ye)}})();const e=async()=>{Ae&&(await Wo(),await Do())};e();const o=()=>{e()};return window.addEventListener("focus",o),()=>{window.removeEventListener("focus",o)}}),[Ae]),(0,i.useEffect)((()=>{Ae&&le.size>0&&Do()}),[le]);const Wo=async()=>{if(Ae&&Y.db)try{const e=(0,q.P)((0,q.rJ)(Y.db,"users/".concat(Ae.uid,"/following"))),o=await(0,q.GG)(e),t=new Set(o.docs.map((e=>e.id))),r=(0,q.P)((0,q.rJ)(Y.db,"users")),i=await(0,q.GG)(r);await Promise.all(i.docs.map((async e=>{if(t.has(e.id))return;const o=(0,q.H9)(Y.db,"users/".concat(e.id,"/followers/").concat(Ae.uid));if((await(0,q.x7)(o)).exists()){t.add(e.id);const o=(0,q.H9)(Y.db,"users/".concat(Ae.uid,"/following/").concat(e.id));(await(0,q.x7)(o)).exists()||(await(0,q.BN)(o,{timestamp:(0,q.O5)()}),console.log("Fixed inconsistent follow status for user ".concat(e.id)))}}))),de(t)}catch(ye){console.error("Error fetching following:",ye)}},Do=async()=>{if(Ae&&Y.db)try{const e=new Set,o=(0,q.P)((0,q.rJ)(Y.db,"users"),(0,q._M)("isPrivate","==",!0)),t=await(0,q.GG)(o);await Promise.all(t.docs.map((async o=>{if(le.has(o.id))return;const t=(0,q.H9)(Y.db,"users/".concat(o.id,"/followRequests/").concat(Ae.uid));(await(0,q.x7)(t)).exists()&&e.add(o.id)})));const r=(0,q.P)((0,q.rJ)(Y.db,"users"),(0,q._M)("isPublic","==",!1)),i=await(0,q.GG)(r);await Promise.all(i.docs.map((async o=>{if(le.has(o.id)||e.has(o.id))return;const t=(0,q.H9)(Y.db,"users/".concat(o.id,"/followRequests/").concat(Ae.uid));(await(0,q.x7)(t)).exists()&&e.add(o.id)}))),be(e)}catch(ye){console.error("Error fetching pending requests:",ye)}},Lo=async e=>{if(!Y.db||!e)return null;try{const o=(0,q.rJ)(Y.db,"rooms"),t=(0,q.P)(o,(0,q._M)("createdBy","==",e),(0,q._M)("type","==","public")),r=await(0,q.GG)(t);if(!r.empty){const o=r.docs[0],t=(0,q.H9)(Y.db,"users",e),i=await(0,q.x7)(t);return i.exists()&&Be({username:i.data().username||i.data().name}),{id:o.id,name:o.data().name||"Chat Room"}}return null}catch(ye){return console.error("[Discover] Error checking for server chat room:",ye),null}},Go=()=>{Le(!1)},To=async e=>{if(Ae&&e!==Ae.uid)try{const i=(0,q.H9)(Y.db,"users/".concat(Ae.uid,"/following"),e),s=(0,q.H9)(Y.db,"users/".concat(e,"/followers"),Ae.uid);if(le.has(e))await(0,q.kd)(i),await(0,q.kd)(s),de((o=>{const t=new Set(o);return t.delete(e),t})),Z.oR.success("Unfollowed user");else{const a=await(async e=>{if(!Y.db)return!1;try{const o=(0,q.H9)(Y.db,"users",e),t=await(0,q.x7)(o);if(t.exists()){const e=t.data();return!0===e.isPrivate||!1===e.isPublic}return!1}catch(ye){return console.error("Error checking if account is private:",ye),!1}})(e);if(a){var o;const t=(0,q.H9)(Y.db,"users",e,"followRequests",Ae.uid);await(0,q.BN)(t,{userId:Ae.uid,username:Ae.displayName||(null===(o=Ae.email)||void 0===o?void 0:o.split("@")[0])||"User_".concat(Ae.uid.substring(0,5)),timestamp:(0,q.O5)()}),be((o=>new Set(o).add(e))),Z.oR.success("Follow request sent")}else{var t,r;await(0,q.BN)(i,{timestamp:(0,q.O5)()}),await(0,q.BN)(s,{timestamp:(0,q.O5)()}),de((o=>new Set(o).add(e)));const o={type:"follow",senderId:Ae.uid,senderName:Ae.displayName||(null===(t=Ae.email)||void 0===t?void 0:t.split("@")[0])||"Someone",senderAvatar:Ae.photoURL||"",recipientId:e,content:"".concat(Ae.displayName||(null===(r=Ae.email)||void 0===r?void 0:r.split("@")[0])||"Someone"," started following you"),createdAt:(0,q.O5)(),isRead:!1};await(0,q.gS)((0,q.rJ)(Y.db,"notifications"),o);const a=await Lo(e);a&&(Te(a),Le(!0)),Z.oR.success("Followed user")}}}catch(ye){console.error("Error toggling follow:",ye),Z.oR.error("Failed to update follow status")}},Ho=e=>{ge("/side-room/".concat(e))},Bo=async function(e){if(Q(e),""===e.trim())return se([]),re([]),void Se(!1);try{ne(!0),Se(!0);const o=(null===Ae||void 0===Ae?void 0:Ae.blockedUsers)||[],t=[];if(Ae&&Y.db){(await(0,q.GG)((0,q.rJ)(Y.db,"users"))).forEach((e=>{const o=e.data();o.blockedUsers&&Array.isArray(o.blockedUsers)&&o.blockedUsers.includes(Ae.uid)&&t.push(e.id)}))}const i=[...o,...t];let s=[];const a=(0,q.rJ)(Y.db,"users"),n=e.toLowerCase();try{const e=(0,q.P)(a,(0,q.My)("username_lower"),(0,q.EO)(n),(0,q.FD)(n+"\uf8ff"),(0,q.AB)(20)),o=await(0,q.GG)(e);s=o.docs.map((e=>{var o;return{id:e.id,username:e.data().username||"",name:e.data().name||"",bio:e.data().bio||"",profilePic:e.data().profilePic||"",isPublic:null===(o=e.data().isPublic)||void 0===o||o,isAuthenticated:e.data().isAuthenticated,createdAt:e.data().createdAt,isActive:e.data().isActive,isVerified:!0,email:e.data().email}})).filter((e=>!i.includes(e.id)&&"sideeye"!==e.id&&"contact-team"!==e.id))}catch(ye){console.error("Error searching by username_lower:",ye)}if(s.length<10)try{const e=(0,q.P)(a,(0,q.My)("name_lower"),(0,q.EO)(n),(0,q.FD)(n+"\uf8ff"),(0,q.AB)(20)),o=(await(0,q.GG)(e)).docs.map((e=>{var o;return{id:e.id,username:e.data().username||"",name:e.data().name||"",bio:e.data().bio||"",profilePic:e.data().profilePic||"",isPublic:null===(o=e.data().isPublic)||void 0===o||o,isAuthenticated:e.data().isAuthenticated,createdAt:e.data().createdAt,isActive:e.data().isActive,isVerified:!0,email:e.data().email}})).filter((e=>!i.includes(e.id)&&"sideeye"!==e.id&&"contact-team"!==e.id&&!s.some((o=>o.id===e.id))));s=[...s,...o]}catch(ye){console.error("Error searching by name_lower:",ye)}if(0===s.length){console.log("Falling back to simple search approach");const e=(0,q.P)(a,(0,q.AB)(50)),o=await(0,q.GG)(e);s=o.docs.map((e=>{var o;return{id:e.id,username:e.data().username||"",name:e.data().name||"",bio:e.data().bio||"",profilePic:e.data().profilePic||"",isPublic:null===(o=e.data().isPublic)||void 0===o||o,isAuthenticated:e.data().isAuthenticated,createdAt:e.data().createdAt,isActive:e.data().isActive,isVerified:!0,email:e.data().email}})).filter((e=>!i.includes(e.id)&&"sideeye"!==e.id&&"contact-team"!==e.id&&(e.username.toLowerCase().includes(n)||e.name.toLowerCase().includes(n))))}const l=(0,q.rJ)(Y.db,"sideRooms");let d=[];try{const o=(0,q.P)(l,(0,q._M)("name",">=",e),(0,q._M)("name","<=",e+"\uf8ff"),(0,q.AB)(20)),t=await(0,q.GG)(o);if(d=t.docs.map((e=>(0,r.A)({id:e.id},e.data()))),d.length<5){const e=(0,q.P)(l,(0,q._M)("deleted","!=",!0),(0,q.AB)(50)),o=(await(0,q.GG)(e)).docs.map((e=>(0,r.A)({id:e.id},e.data()))).filter((e=>!d.some((o=>o.id===e.id))&&(e.name.toLowerCase().includes(n)||e.description&&e.description.toLowerCase().includes(n)||e.tags&&e.tags.some((e=>e.toLowerCase().includes(n))))));d=[...d,...o]}}catch(ye){console.error("Error searching rooms:",ye)}d=d.filter((e=>e.ownerId&&!i.includes(e.ownerId)));const c=await Promise.all(d.map((async e=>{try{var o,t;const r=await(0,q.x7)((0,q.H9)(Y.db,"users",e.ownerId)),i=r.exists()?r.data():null;return{id:e.id,name:e.name,description:e.description,memberCount:e.memberCount||0,shareCount:0,isPrivate:e.isPrivate||!1,createdAt:(null===(o=e.createdAt)||void 0===o?void 0:o.toDate())||new Date,creatorName:(null===i||void 0===i?void 0:i.username)||"Unknown",creatorId:e.ownerId,creatorAvatar:(null===i||void 0===i?void 0:i.profilePic)||"",tags:e.tags||[],lastActive:(null===(t=e.lastActive)||void 0===t?void 0:t.toDate())||new Date,maxMembers:e.maxMembers||100,activeUsers:e.activeUsers||0,isLive:e.isLive||!1,thumbnailUrl:e.thumbnailUrl||""}}catch(ye){var r,i;return console.error("Error fetching owner data for room ".concat(e.id,":"),ye),{id:e.id,name:e.name,description:e.description,memberCount:e.memberCount||0,shareCount:0,isPrivate:e.isPrivate||!1,createdAt:(null===(r=e.createdAt)||void 0===r?void 0:r.toDate())||new Date,creatorName:"Unknown",creatorId:e.ownerId,creatorAvatar:"",tags:e.tags||[],lastActive:(null===(i=e.lastActive)||void 0===i?void 0:i.toDate())||new Date,maxMembers:e.maxMembers||100,activeUsers:e.activeUsers||0,isLive:e.isLive||!1,thumbnailUrl:e.thumbnailUrl||""}}})));se(s),re(c)}catch(ye){console.error("Error searching:",ye)}finally{ne(!1)}},Oo=(e,o)=>{Me(o),ke&&Se(!1)};(0,i.useEffect)((()=>{if(null===Ae||void 0===Ae||!Ae.uid||!Y.db)return;const e=(0,q.rJ)(Y.db,"users",Ae.uid,"following"),o=(0,q.aQ)(e,(async e=>{e.docChanges().forEach((async e=>{if("added"===e.type){const o=e.doc.id;if(ce.has(o)){const e=await Lo(o);e&&(Te(e),Le(!0),be((e=>{const t=new Set(e);return t.delete(o),t})))}}}))}));return()=>o()}),[null===Ae||void 0===Ae?void 0:Ae.uid,Y.db,ce]);(0,i.useEffect)((()=>{Ve(Oe)}),[Oe]);(0,i.useEffect)((()=>()=>{fo.current&&clearTimeout(fo.current)}),[]),(0,i.useEffect)((()=>(uo&&te.length>0&&(fo.current=setTimeout((()=>{bo(!0),vo(te[ho])}),6e4)),()=>{fo.current&&clearTimeout(fo.current)})),[ho,uo,te]),(0,i.useEffect)((()=>{console.log("Current rooms:",te),console.log("Current index:",ho),console.log("Is swipe view active:",uo)}),[te,ho,uo]),(0,i.useEffect)((()=>{if(!Ae)return;return(async e=>{try{if(Io)return void console.log("Already attempting to initialize Stream client...");zo(!0);const o="https://sideeye-backend-production.up.railway.app",t=await fetch("".concat(o,"/api/stream-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.uid,displayName:e.displayName||"Anonymous",photoURL:e.photoURL||""})});if(!t.ok){const e=await t.json().catch((()=>({})));throw console.error("Stream token fetch failed:",{status:t.status,statusText:t.statusText,error:e}),new Error("Failed to get stream token: ".concat(t.statusText))}const{token:r}=await t.json();if(!r)throw new Error("Stream token not found in response");yo(r);const i={apiKey:"2nufecjmzmzh",token:r,user:{id:e.uid,name:e.displayName||"Anonymous",image:e.photoURL||""}};So&&await So.disconnectUser();const s=new pe.Hq(i);Po(s),Uo(0)}catch(ye){console.error("Error initializing Stream client:",ye),Z.oR.error("Failed to initialize audio service. Please try again later."),Uo((e=>e+1))}finally{zo(!1)}})(Ae),()=>{So&&(So.disconnectUser(),Po(null)),Uo(0)}}),[Ae]);const No=async e=>{if(Ae&&So)if(Io)console.log("Already attempting to connect...");else{if(Ro>=3)return Z.oR.error("Too many connection attempts. Please try again later."),void Uo(0);zo(!0),ko(!0);try{const o=So.call("default",e);await o.join({create:!1,ring:!1}),wo(o),Uo(0),Z.oR.success("Connected to room audio")}catch(ye){console.error("Error joining audio stream:",ye),9===(null===ye||void 0===ye?void 0:ye.code)||429===(null===ye||void 0===ye?void 0:ye.StatusCode)?(Z.oR.error("Too many connection attempts. Please wait a moment before trying again."),Uo((e=>e+1))):Z.oR.error("Failed to join audio stream")}finally{zo(!1),ko(!1)}}else Z.oR.error("Audio service not initialized")},_o=ve()(No,1e3,{leading:!0,trailing:!1});(0,i.useEffect)((()=>()=>{_o.cancel()}),[]);return ae&&!ke?(0,ue.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:(0,ue.jsx)(l.A,{})}):(0,ue.jsxs)(n.A,{sx:{position:"relative",backgroundColor:we.palette.background.default,"& @keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.7},"100%":{opacity:1}}},children:[(0,ue.jsx)(n.A,{sx:{position:"sticky",top:0,backgroundColor:we.palette.background.default,zIndex:1e3,pt:.5,pb:.5,borderBottom:1,borderColor:"divider"},children:(0,ue.jsxs)(d.A,{maxWidth:!1,sx:{maxWidth:"1440px"},children:[(0,ue.jsxs)(n.A,{sx:{mb:.5},children:[!lo&&!ke&&(0,ue.jsx)(n.A,{sx:{display:"flex",justifyContent:"flex-end",mb:.5},children:(0,ue.jsx)(c.A,{onClick:()=>co(!0),sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover"}},children:(0,ue.jsx)(F.A,{})})}),(lo||ke)&&(0,ue.jsx)(ee.x,{onClickAway:()=>{X.trim()||(co(!1),Re(!1))},children:(0,ue.jsxs)(n.A,{sx:{position:"relative",mb:.5,display:"flex",alignItems:"center",gap:1},children:[ke&&(0,ue.jsx)(u.A,{variant:Ce?"h6":"h5",component:"h1",sx:{fontWeight:600,mr:2},children:"Search Results"}),(0,ue.jsxs)(n.A,{ref:Ue,sx:{flex:1},children:[(0,ue.jsx)(x.A,{fullWidth:!0,size:"small",placeholder:"Search rooms and users...",value:X,onChange:e=>{(async e=>{if(Q(e),e.length<1)return Ie([]),void Re(!1);try{const o=e.toLowerCase(),t=(0,q.rJ)(Y.db,"users"),r=e=>{var o,t,r,i,s,a,n,l,d,c;return{id:e.id,username:(null===(o=e.data())||void 0===o?void 0:o.username)||"",name:(null===(t=e.data())||void 0===t?void 0:t.name)||"",bio:null===(r=e.data())||void 0===r?void 0:r.bio,profilePic:null===(i=e.data())||void 0===i?void 0:i.profilePic,isPublic:null===(s=null===(a=e.data())||void 0===a?void 0:a.isPublic)||void 0===s||s,isAuthenticated:null===(n=e.data())||void 0===n?void 0:n.isAuthenticated,createdAt:null===(l=e.data())||void 0===l?void 0:l.createdAt,isActive:null===(d=e.data())||void 0===d?void 0:d.isActive,isVerified:!0,email:null===(c=e.data())||void 0===c?void 0:c.email}};let i=[];try{const e=(0,q.P)(t,(0,q.My)("username_lower"),(0,q.EO)(o),(0,q.FD)(o+"\uf8ff"),(0,q.AB)(10)),s=await(0,q.GG)(e);i=s.docs.filter((e=>"sideeye"!==e.id&&"contact-team"!==e.id)).map(r)}catch(ye){console.log("Error searching by username_lower:",ye)}if(i.length<5)try{const e=(0,q.P)(t,(0,q.My)("name_lower"),(0,q.EO)(o),(0,q.FD)(o+"\uf8ff"),(0,q.AB)(10)),s=(await(0,q.GG)(e)).docs.filter((e=>"sideeye"!==e.id&&"contact-team"!==e.id&&!i.some((o=>o.id===e.id)))).map(r);i=[...i,...s]}catch(ye){console.log("Error searching by name_lower:",ye)}if(i.length<3){const e=(0,q.P)(t,(0,q.AB)(25));try{const t=(await(0,q.GG)(e)).docs.filter((e=>{var t,r;return"sideeye"!==e.id&&"contact-team"!==e.id&&!i.some((o=>o.id===e.id))&&(((null===(t=e.data())||void 0===t?void 0:t.username)||"").toLowerCase().includes(o)||((null===(r=e.data())||void 0===r?void 0:r.name)||"").toLowerCase().includes(o))})).map(r);i=[...i,...t]}catch(ye){console.log("Error with fallback search:",ye)}}null!==Ae&&void 0!==Ae&&Ae.blockedUsers&&(i=i.filter((e=>{var o;return!(null!==(o=Ae.blockedUsers)&&void 0!==o&&o.includes(e.id))}))),Ie(i.slice(0,5)),Re(i.length>0)}catch(ye){console.error("Instant search error:",ye)}})(e.target.value),Bo(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(Bo(X,!0),Re(!1))},autoFocus:lo,InputProps:{startAdornment:(0,ue.jsx)(h.A,{position:"start",children:(0,ue.jsx)(F.A,{})}),endAdornment:(lo||ke)&&(0,ue.jsx)(h.A,{position:"end",children:(0,ue.jsx)(c.A,{size:"small",onClick:()=>{Q(""),co(!1),Se(!1),Re(!1),se([]),re([])},children:(0,ue.jsx)(W.A,{fontSize:"small"})})})},sx:{backgroundColor:"background.paper",borderRadius:2,"& .MuiOutlinedInput-root":{borderRadius:2}}}),(0,ue.jsx)(oe.A,{open:ze&&Pe.length>0,anchorEl:Ue.current,placement:"bottom-start",style:{width:null===(e=Ue.current)||void 0===e?void 0:e.offsetWidth,zIndex:1400},children:(0,ue.jsx)(p.A,{elevation:3,sx:{mt:1,maxHeight:"300px",overflowY:"auto",borderRadius:2},children:(0,ue.jsx)(m.A,{sx:{p:0},children:Pe.map(((e,o)=>{var t,r;return(0,ue.jsxs)(i.Fragment,{children:[(0,ue.jsxs)(b.Ay,{button:!0,onClick:()=>{ge("/profile/".concat(e.id)),Re(!1)},sx:{py:1,px:2,"&:hover":{backgroundColor:"action.hover"}},children:[(0,ue.jsx)(g.A,{children:(0,ue.jsx)(v.A,{src:!1===e.isActive?void 0:e.profilePic,alt:e.name,sx:{width:32,height:32},children:!1===e.isActive||e.profilePic?null:null===(t=e.name)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.toUpperCase()})}),(0,ue.jsx)(f.A,{primary:(0,ue.jsxs)(u.A,{variant:"body1",component:"div",children:[e.name,e.isVerified&&(0,ue.jsx)(D.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.9rem",verticalAlign:"middle"}})]}),secondary:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(u.A,{variant:"body2",component:"span",color:"text.secondary",children:["@",e.username]}),e.bio&&(0,ue.jsx)(u.A,{variant:"body2",component:"span",color:"text.secondary",sx:{mt:.5,display:"block",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.bio})]}),sx:{my:0}}),Ae&&e.id!==Ae.uid&&(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1},children:[(0,ue.jsx)(c.A,{size:"small",onClick:o=>{o.stopPropagation(),ge("/messages/".concat(e.id))},children:(0,ue.jsx)(L.A,{fontSize:"small"})}),(0,ue.jsx)(c.A,{size:"small",onClick:o=>{o.stopPropagation(),ce.has(e.id)||To(e.id)},color:le.has(e.id)?"primary":ce.has(e.id)?"secondary":"default",disabled:ce.has(e.id),children:(0,ue.jsx)(G.A,{fontSize:"small"})})]})]}),o<Pe.length-1&&(0,ue.jsx)(A.A,{})]},e.id)}))})})})]})]})})]}),!ke&&(0,ue.jsx)(xe,{}),!ke&&(0,ue.jsxs)(y.A,{value:o,onChange:(e,o)=>{t(o),1===o&&0===ie.length&&Mo()},variant:Ce?"scrollable":"standard",scrollButtons:!!Ce&&"auto",sx:{mb:.5,"& .MuiTabs-indicator":{height:3}},children:[(0,ue.jsx)(j.A,{icon:(0,ue.jsx)(T.A,{}),label:"ROOMS",iconPosition:"start"}),(0,ue.jsx)(j.A,{icon:(0,ue.jsx)(H.A,{}),label:"PEOPLE",iconPosition:"start"}),(0,ue.jsx)(j.A,{icon:(0,ue.jsx)(B.A,{}),label:"TOP HOSTS",iconPosition:"start"}),(0,ue.jsx)(j.A,{icon:(0,ue.jsx)(O.A,{}),label:"POPULAR",iconPosition:"start"})]}),!ke&&0===o&&!uo&&(0,ue.jsxs)(y.A,{value:Ee,onChange:Oo,variant:"scrollable",scrollButtons:"auto","aria-label":"room categories",sx:{mb:1,borderBottom:1,borderColor:"divider"},children:[(0,ue.jsx)(j.A,{label:"All",value:"All"}),Eo.map((e=>(0,ue.jsx)(j.A,{label:e,value:e},e)))]}),!ke&&0===o&&(0,ue.jsx)(n.A,{sx:{display:"flex",justifyContent:"flex-end",mb:1,mr:2},children:(0,ue.jsx)(c.A,{onClick:()=>{xo(!uo),po(0),fo.current&&(clearTimeout(fo.current),fo.current=null)},color:"primary",sx:{bgcolor:"background.paper",border:"1px solid",borderColor:"divider","&:hover":{bgcolor:"action.hover"}},children:uo?(0,ue.jsx)(N.A,{}):(0,ue.jsx)(_.A,{})})})]})}),(0,ue.jsx)(d.A,{maxWidth:!1,sx:(0,r.A)({pt:1,pb:4,px:Ce?2:3,maxWidth:"1440px"},0===o&&uo&&!ke&&{px:0,py:0,flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",minHeight:"calc(100vh - 64px - 48px - 56px)"}),children:ke?(0,ue.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",gap:4},children:[ie.length>0&&(0,ue.jsxs)(n.A,{children:[(0,ue.jsx)(u.A,{variant:"h6",sx:{mb:2},children:"Users"}),(0,ue.jsx)(m.A,{children:ie.map(((e,o)=>{var t,r;return(0,ue.jsxs)(i.Fragment,{children:[(0,ue.jsxs)(b.Ay,{sx:{py:2,cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>ge("/profile/".concat(e.id)),children:[(0,ue.jsx)(g.A,{children:(0,ue.jsx)(v.A,{src:!1===e.isActive?void 0:e.profilePic,alt:e.name,sx:{width:50,height:50},children:!1===e.isActive||e.profilePic?null:null===(t=e.name)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.toUpperCase()})}),(0,ue.jsx)(f.A,{primary:(0,ue.jsxs)(u.A,{variant:"subtitle1",component:"div",sx:{fontWeight:600},children:[e.name,e.isVerified&&(0,ue.jsx)(D.A,{sx:{ml:.5,color:"primary.main",fontSize:"1rem",verticalAlign:"middle"}})]}),secondary:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(u.A,{variant:"body2",component:"span",color:"text.secondary",children:["@",e.username]}),e.bio&&(0,ue.jsx)(u.A,{variant:"body2",component:"span",color:"text.secondary",sx:{mt:.5,display:"block",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.bio})]})}),Ae&&e.id!==Ae.uid&&(0,ue.jsx)(w.A,{children:(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1},children:[(0,ue.jsx)(c.A,{onClick:o=>{o.stopPropagation(),ge("/chat/".concat(e.id))},size:"small",children:(0,ue.jsx)(L.A,{})}),(0,ue.jsx)(c.A,{onClick:o=>{o.stopPropagation(),ce.has(e.id)||To(e.id)},size:"small",color:le.has(e.id)?"primary":ce.has(e.id)?"secondary":"default",disabled:ce.has(e.id),children:(0,ue.jsx)(G.A,{})})]})})]}),o<ie.length-1&&(0,ue.jsx)(A.A,{})]},e.id)}))})]}),te.length>0&&(0,ue.jsxs)(n.A,{children:[(0,ue.jsx)(u.A,{variant:"h6",sx:{mb:2},children:"Rooms"}),(0,ue.jsx)(C.Ay,{container:!0,spacing:3,children:te.filter((e=>"All"===Ee||e.tags&&e.tags.includes(Ee))).map((e=>(0,ue.jsx)(C.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,ue.jsxs)(k.A,{sx:{display:"flex",flexDirection:"column",cursor:"pointer",borderRadius:2,overflow:"hidden",boxShadow:we.shadows[3],"&:hover":{transform:"translateY(-4px)",transition:"transform 0.2s ease-in-out",boxShadow:we.shadows[6]}},onClick:()=>Ho(e.id),children:[(0,ue.jsxs)(n.A,{sx:{position:"relative"},children:[(0,ue.jsx)(S.A,{component:"img",height:Ce?"160":"200",image:e.thumbnailUrl||e.creatorAvatar||"https://placehold.co/600x400/333/666?text=Room",alt:e.name,sx:{objectFit:"cover",width:"100%",borderRadius:"8px 8px 0 0",filter:"brightness(0.95) contrast(1.05)",transition:"all 0.3s ease","&:hover":{filter:"brightness(1.05) contrast(1.1)",transform:"scale(1.02)"}}}),(0,ue.jsx)(n.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 30%, rgba(0,0,0,0) 70%, rgba(0,0,0,0.2) 100%)",borderRadius:"8px 8px 0 0"}}),(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:.5,zIndex:2},children:[e.isPopular&&(0,ue.jsx)(P.A,{label:"Popular",color:"warning",size:"small",icon:(0,ue.jsx)(O.A,{}),sx:{fontWeight:"bold",fontSize:"0.7rem",height:24,"& .MuiChip-label":{px:1},"& .MuiChip-icon":{fontSize:"0.8rem"},boxShadow:"0 2px 8px rgba(0,0,0,0.3)",backdropFilter:"blur(4px)"}}),e.isLive&&(0,ue.jsx)(P.A,{label:"LIVE",color:"error",size:"small",sx:{fontWeight:"bold",fontSize:"0.7rem",height:24,"& .MuiChip-label":{px:1},boxShadow:"0 2px 8px rgba(0,0,0,0.3)",backdropFilter:"blur(4px)",animation:"pulse 2s infinite"}})]})]}),(0,ue.jsxs)(I.A,{sx:{flexGrow:1,p:3,"&:last-child":{pb:3}},children:[(0,ue.jsxs)(n.A,{sx:{mb:2},children:[(0,ue.jsx)(u.A,{gutterBottom:!0,variant:Ce?"h6":"h5",component:"h2",noWrap:!0,sx:{fontWeight:600,mb:1},children:e.name}),(0,ue.jsx)(u.A,{variant:"body1",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:2,lineHeight:1.5},children:e.description})]}),(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2,flexWrap:"wrap"},children:[(0,ue.jsx)(P.A,{icon:(0,ue.jsx)(V.A,{sx:{fontSize:Ce?"1.1rem":"1.25rem"}}),label:"".concat(e.activeUsers||0," views"),color:"primary",variant:"outlined",sx:{height:"auto",padding:"8px 12px","& .MuiChip-label":{padding:"0 4px",fontSize:Ce?"0.875rem":"1rem"}}}),e.isPrivate&&(0,ue.jsx)(P.A,{label:"Private",color:"secondary",sx:{height:"auto",padding:"8px 12px","& .MuiChip-label":{padding:"0 4px",fontSize:Ce?"0.875rem":"1rem"}}})]}),(0,ue.jsxs)(u.A,{variant:"body2",color:"text.secondary",sx:{fontSize:Ce?"0.75rem":"0.875rem",display:"flex",alignItems:"center",gap:.5},children:["Created by ",e.creatorName||"Anonymous"," \u2022 ",$(e.lastActive)]})]})]})},e.id)))})]}),0===ie.length&&0===te.length&&!ae&&(0,ue.jsxs)(n.A,{sx:{textAlign:"center",py:4},children:[(0,ue.jsx)(u.A,{variant:"h6",color:"text.secondary",children:"No results found"}),(0,ue.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"Try different keywords or check your spelling"})]})]}):0===o?uo&&!ke?(0,ue.jsxs)(n.A,{sx:{height:"calc(100vh - 200px)",width:"100%",position:"relative",overflow:"hidden"},children:[(0,ue.jsxs)(y.A,{value:Ee,onChange:Oo,variant:"scrollable",scrollButtons:"auto","aria-label":"room categories",sx:{mb:1,px:2,"& .MuiTabs-scroller":{height:"40px"},"& .MuiTab-root":{color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",minHeight:"40px",zIndex:3},position:"absolute",top:0,left:0,right:0,zIndex:3,bgcolor:"rgba(0,0,0,0.3)",backdropFilter:"blur(10px)"},children:[(0,ue.jsx)(j.A,{label:"All",value:"All"}),Eo.map((e=>(0,ue.jsx)(j.A,{label:e,value:e},e)))]}),ae?(0,ue.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,ue.jsx)(l.A,{})}):te.length>0?(0,ue.jsxs)(n.A,{sx:{height:"100%",width:"100%",position:"relative"},children:[(0,ue.jsx)(he.P.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"-100%"},transition:{duration:.3},style:{height:"100%",width:"100%",position:"absolute",top:0,left:0,touchAction:"pan-y"},drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:1,onDragEnd:(e,o)=>{const t=te.filter((e=>{var o;return"All"===Ee||(null===(o=e.tags)||void 0===o?void 0:o.includes(Ee))}));o.offset.y<-50&&ho<t.length-1?po((e=>e+1)):o.offset.y>50&&ho>0&&po((e=>e-1))},children:((e,o)=>{const t=te.filter((e=>{var o;return"All"===Ee||(null===(o=e.tags)||void 0===o?void 0:o.includes(Ee))}));if(0===t.length)return(0,ue.jsxs)(n.A,{sx:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:2,bgcolor:"background.paper",color:"text.primary"},children:[(0,ue.jsxs)(u.A,{variant:"h6",children:["No rooms in ",Ee," category"]}),(0,ue.jsx)(z.A,{variant:"outlined",onClick:()=>Me("All"),children:"View All Rooms"})]});const r=t[ho];return(0,ue.jsxs)(n.A,{sx:{height:"100%",width:"100%",position:"relative",backgroundColor:"rgba(0,0,0,0.9)",cursor:"pointer"},onClick:()=>Ho(r.id),children:[null!==r&&void 0!==r&&r.thumbnailUrl?(0,ue.jsx)(n.A,{sx:{height:"100%",width:"100%",position:"absolute",top:0,left:0,backgroundImage:"url(".concat(r.thumbnailUrl,")"),backgroundSize:"cover",backgroundPosition:"center","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 50%, rgba(0,0,0,0.7) 100%)",pointerEvents:"none"}}}):(0,ue.jsx)(n.A,{sx:{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,background:"linear-gradient(45deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%)"},children:(0,ue.jsx)(v.A,{src:null===r||void 0===r?void 0:r.creatorAvatar,sx:{width:"200px",height:"200px",fontSize:"100px",bgcolor:"primary.main"},children:null===r||void 0===r||null===(e=r.name)||void 0===e||null===(o=e[0])||void 0===o?void 0:o.toUpperCase()})}),(null===r||void 0===r?void 0:r.isLive)&&(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:16,left:16,zIndex:3,display:"flex",alignItems:"center",gap:1},children:[(0,ue.jsx)(n.A,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"error.main",animation:"pulse 2s infinite"}}),(0,ue.jsx)(u.A,{sx:{color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",fontWeight:"bold"},children:"LIVE"})]}),(0,ue.jsxs)(n.A,{sx:{position:"absolute",bottom:0,left:0,right:0,p:3,color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.5)",zIndex:2,background:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%)",backdropFilter:"blur(10px)"},children:[(0,ue.jsx)(u.A,{variant:"h5",sx:{mb:1,fontWeight:"bold"},children:null===r||void 0===r?void 0:r.name}),(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,ue.jsx)(v.A,{src:null===r||void 0===r?void 0:r.creatorAvatar,sx:{width:32,height:32,mr:1}}),(0,ue.jsxs)(u.A,{variant:"subtitle1",children:["@",null===r||void 0===r?void 0:r.creatorName]})]}),(0,ue.jsx)(u.A,{variant:"body1",sx:{mb:2,opacity:.9},children:null===r||void 0===r?void 0:r.description}),(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1},children:[(0,ue.jsx)(P.A,{icon:(0,ue.jsx)(V.A,{sx:{color:"white"}}),label:"".concat((null===r||void 0===r?void 0:r.activeUsers)||0," listening"),sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white",backdropFilter:"blur(4px)"}}),(null===r||void 0===r?void 0:r.isLive)&&(0,ue.jsx)(P.A,{label:"LIVE",color:"error",sx:{animation:"pulse 2s infinite"}}),jo&&(0,ue.jsx)(P.A,{label:"Connected",color:"success",sx:{bgcolor:"rgba(76,175,80,0.3)",backdropFilter:"blur(4px)"}})]})]})]})})()},ho),(0,ue.jsx)(n.A,{sx:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:1,zIndex:2},children:te.filter((e=>{var o;return"All"===Ee||(null===(o=e.tags)||void 0===o?void 0:o.includes(Ee))})).map(((e,o)=>(0,ue.jsx)(n.A,{sx:{width:4,height:16,borderRadius:2,bgcolor:o===ho?"primary.main":"rgba(255,255,255,0.5)",transition:"all 0.3s ease"}},o)))})]}):(0,ue.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,ue.jsx)(u.A,{variant:"h6",color:"text.secondary",children:"No rooms found"})})]}):(0,ue.jsx)(C.Ay,{container:!0,spacing:3,children:te.filter((e=>"All"===Ee||e.tags&&e.tags.includes(Ee))).map((e=>(0,ue.jsx)(C.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,ue.jsxs)(k.A,{sx:{display:"flex",flexDirection:"column",cursor:"pointer",borderRadius:2,overflow:"hidden",boxShadow:we.shadows[3],"&:hover":{transform:"translateY(-4px)",transition:"transform 0.2s ease-in-out",boxShadow:we.shadows[6]}},onClick:()=>Ho(e.id),children:[(0,ue.jsxs)(n.A,{sx:{position:"relative"},children:[(0,ue.jsx)(S.A,{component:"img",height:Ce?"160":"200",image:e.thumbnailUrl||e.creatorAvatar||"https://placehold.co/600x400/333/666?text=Room",alt:e.name,sx:{objectFit:"cover",width:"100%",borderRadius:"8px 8px 0 0",filter:"brightness(0.95) contrast(1.05)",transition:"all 0.3s ease","&:hover":{filter:"brightness(1.05) contrast(1.1)",transform:"scale(1.02)"}}}),(0,ue.jsx)(n.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 30%, rgba(0,0,0,0) 70%, rgba(0,0,0,0.2) 100%)",borderRadius:"8px 8px 0 0"}}),(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:.5,zIndex:2},children:[e.isPopular&&(0,ue.jsx)(P.A,{label:"Popular",color:"warning",size:"small",icon:(0,ue.jsx)(O.A,{}),sx:{fontWeight:"bold",fontSize:"0.7rem",height:24,"& .MuiChip-label":{px:1},"& .MuiChip-icon":{fontSize:"0.8rem"},boxShadow:"0 2px 8px rgba(0,0,0,0.3)",backdropFilter:"blur(4px)"}}),e.isLive&&(0,ue.jsx)(P.A,{label:"LIVE",color:"error",size:"small",sx:{fontWeight:"bold",fontSize:"0.7rem",height:24,"& .MuiChip-label":{px:1},boxShadow:"0 2px 8px rgba(0,0,0,0.3)",backdropFilter:"blur(4px)",animation:"pulse 2s infinite"}})]})]}),(0,ue.jsxs)(I.A,{sx:{flexGrow:1,p:3,"&:last-child":{pb:3}},children:[(0,ue.jsxs)(n.A,{sx:{mb:2},children:[(0,ue.jsx)(u.A,{gutterBottom:!0,variant:Ce?"h6":"h5",component:"h2",noWrap:!0,sx:{fontWeight:600,mb:1},children:e.name}),(0,ue.jsx)(u.A,{variant:"body1",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:2,lineHeight:1.5},children:e.description})]}),(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2,flexWrap:"wrap"},children:[(0,ue.jsx)(P.A,{icon:(0,ue.jsx)(V.A,{sx:{fontSize:Ce?"1.1rem":"1.25rem"}}),label:"".concat(e.activeUsers||0," views"),color:"primary",variant:"outlined",sx:{height:"auto",padding:"8px 12px","& .MuiChip-label":{padding:"1 4px",fontSize:Ce?"0.875rem":"1rem"}}}),e.isPrivate&&(0,ue.jsx)(P.A,{label:"Private",color:"secondary",sx:{height:"auto",padding:"8px 12px","& .MuiChip-label":{padding:"0 4px",fontSize:Ce?"0.875rem":"1rem"}}})]}),(0,ue.jsxs)(u.A,{variant:"body2",color:"text.secondary",sx:{fontSize:Ce?"0.75rem":"0.875rem",display:"flex",alignItems:"center",gap:.5},children:["Created by ",e.creatorName||"Anonymous"," \u2022 ",$(e.lastActive)]})]})]})},e.id)))}):1===o?(0,ue.jsx)(n.A,{sx:{mt:2},children:ae?(0,ue.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,ue.jsx)(l.A,{})}):ie.length>0?(0,ue.jsx)(m.A,{children:ie.map(((e,o)=>{var t,r;return(0,ue.jsxs)(i.Fragment,{children:[(0,ue.jsxs)(b.Ay,{sx:{py:3,px:2,cursor:"pointer","&:hover":{backgroundColor:"action.hover"},borderRadius:1,mb:1},onClick:()=>ge("/profile/".concat(e.id)),children:[(0,ue.jsx)(g.A,{children:(0,ue.jsx)(v.A,{src:!1===e.isActive?void 0:e.profilePic,alt:e.name,sx:{width:60,height:60,mr:2},children:!1===e.isActive||e.profilePic?null:null===(t=e.name)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.toUpperCase()})}),(0,ue.jsx)(f.A,{primary:(0,ue.jsxs)(u.A,{variant:"subtitle1",component:"div",sx:{fontWeight:600},children:[e.name,e.isVerified&&(0,ue.jsx)(D.A,{sx:{ml:.5,color:"primary.main",fontSize:"1rem",verticalAlign:"middle"}})]}),secondary:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(u.A,{variant:"body2",component:"span",color:"text.secondary",children:["@",e.username]}),e.bio&&(0,ue.jsx)(u.A,{variant:"body2",component:"span",color:"text.secondary",sx:{mt:.5,display:"block",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.bio})]}),sx:{ml:2}}),Ae&&e.id!==Ae.uid&&(0,ue.jsx)(w.A,{sx:{right:16},children:(0,ue.jsxs)(n.A,{sx:{display:"flex",gap:1,flexWrap:{xs:"wrap",sm:"nowrap"}},children:[(0,ue.jsx)(c.A,{color:"primary",size:"small",onClick:o=>{o.stopPropagation(),ge("/chat/user/".concat(e.id))},sx:{border:"1px solid",borderColor:"primary.main",p:1},children:(0,ue.jsx)(L.A,{fontSize:"small"})}),(0,ue.jsx)(z.A,{variant:le.has(e.id)||ce.has(e.id)?"contained":"outlined",size:"small",startIcon:le.has(e.id)||ce.has(e.id)?null:(0,ue.jsx)(G.A,{}),onClick:o=>{o.stopPropagation(),ce.has(e.id)||To(e.id)},color:ce.has(e.id)?"secondary":"primary",disabled:ce.has(e.id),children:le.has(e.id)?"Following":ce.has(e.id)?"Requested":"Follow"})]})})]}),o<ie.length-1&&(0,ue.jsx)(A.A,{sx:{my:1}})]},e.id)}))}):(0,ue.jsx)(n.A,{sx:{textAlign:"center",py:4},children:(0,ue.jsx)(u.A,{variant:"h6",color:"text.secondary",children:"No users found"})})}):2===o?(0,ue.jsxs)(n.A,{sx:{mt:2},children:[(0,ue.jsx)(n.A,{sx:{mb:3},children:(0,ue.jsxs)(C.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,ue.jsx)(C.Ay,{item:!0,xs:12,md:6,children:(0,ue.jsx)(x.A,{fullWidth:!0,size:"small",placeholder:"Search top hosts...",value:Je,onChange:e=>{qe(e.target.value),(async e=>{if(e.trim()){Xe(!0);try{const o=e.toLowerCase(),t=(0,q.rJ)(Y.db,"users"),i=(0,q.P)(t,(0,q._M)("username_lower",">=",o),(0,q._M)("username_lower","<=",o+"\uf8ff"),(0,q.AB)(20)),s=(await(0,q.GG)(i)).docs.map((e=>(0,r.A)({id:e.id},e.data()))).filter((e=>Oe.some((o=>o.id===e.id))));Ve(s)}catch(ye){console.error("Error searching top hosts:",ye),Ve([])}finally{Xe(!1)}}else Ve(Oe)})(e.target.value)},InputProps:{startAdornment:(0,ue.jsx)(h.A,{position:"start",children:(0,ue.jsx)(F.A,{})})},sx:{backgroundColor:"background.paper",borderRadius:1,"& .MuiOutlinedInput-root":{borderRadius:1}}})}),(0,ue.jsx)(C.Ay,{item:!0,xs:12,md:6,children:(0,ue.jsxs)(y.A,{value:Ye,onChange:(e,o)=>(e=>{if(Ke(e),"All"===e)return void Ve(Oe);const o=Oe.filter((o=>te.filter((e=>e.creatorId===o.id)).some((o=>{var t;return null===(t=o.tags)||void 0===t?void 0:t.includes(e)}))));Ve(o)})(o),variant:"scrollable",scrollButtons:"auto","aria-label":"top host categories",sx:{borderBottom:1,borderColor:"divider"},children:[(0,ue.jsx)(j.A,{label:"All",value:"All"}),Eo.map((e=>(0,ue.jsx)(j.A,{label:e,value:e},e)))]})})]})}),ae||Ze?(0,ue.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,ue.jsx)(l.A,{})}):_e.length>0?(0,ue.jsx)(m.A,{children:_e.map(((e,o)=>{var t,r,s;return(0,ue.jsxs)(i.Fragment,{children:[(0,ue.jsxs)(b.Ay,{sx:{py:3,px:2,cursor:"pointer","&:hover":{backgroundColor:"action.hover"},borderRadius:1,mb:1,position:"relative"},children:[(0,ue.jsx)(g.A,{children:(0,ue.jsx)(v.A,{src:!1===e.isActive?void 0:e.profilePic,alt:e.name,sx:{width:60,height:60,mr:2,cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>ge("/profile/".concat(e.id)),children:!1===e.isActive||e.profilePic?null:null===(t=e.name)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.toUpperCase()})}),(0,ue.jsx)(f.A,{primary:(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ue.jsxs)(u.A,{variant:"subtitle1",component:"div",sx:{fontWeight:600},children:[e.name,e.isVerified&&(0,ue.jsx)(D.A,{sx:{ml:.5,color:"primary.main",fontSize:"1rem",verticalAlign:"middle"}})]}),(0,ue.jsx)(P.A,{label:"Top Host",color:"warning",size:"small",icon:(0,ue.jsx)(B.A,{}),sx:{height:"auto","& .MuiChip-label":{px:1}}})]}),secondary:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(u.A,{variant:"body2",component:"span",color:"text.secondary",children:["@",e.username]}),(0,ue.jsxs)(n.A,{sx:{mt:1,display:"flex",gap:2},children:[(0,ue.jsxs)(u.A,{variant:"body2",color:"text.secondary",children:[null===(s=e.totalViews)||void 0===s?void 0:s.toLocaleString()," total views"]}),(0,ue.jsxs)(u.A,{variant:"body2",color:"text.secondary",children:[e.activeRooms," active rooms"]})]}),e.bio&&(0,ue.jsx)(u.A,{variant:"body2",component:"span",color:"text.secondary",sx:{mt:.5,display:"block",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.bio})]}),sx:{ml:2}}),Ae&&e.id!==Ae.uid&&(0,ue.jsx)(w.A,{sx:{right:16},children:(0,ue.jsx)(z.A,{variant:le.has(e.id)||ce.has(e.id)?"contained":"outlined",size:"small",startIcon:le.has(e.id)||ce.has(e.id)?null:(0,ue.jsx)(G.A,{}),onClick:o=>{o.stopPropagation(),ce.has(e.id)||To(e.id)},color:ce.has(e.id)?"secondary":"primary",disabled:ce.has(e.id),children:le.has(e.id)?"Following":ce.has(e.id)?"Requested":"Follow"})})]}),o<_e.length-1&&(0,ue.jsx)(A.A,{sx:{my:1}})]},e.id)}))}):(0,ue.jsxs)(n.A,{sx:{textAlign:"center",py:4},children:[(0,ue.jsx)(u.A,{variant:"h6",color:"text.secondary",children:Je?"No matching top hosts found":"No top hosts found"}),Je&&(0,ue.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try different keywords or check your spelling"})]})]}):(0,ue.jsxs)(n.A,{sx:{mt:2},children:[(0,ue.jsx)(n.A,{sx:{mb:3},children:(0,ue.jsxs)(C.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,ue.jsx)(C.Ay,{item:!0,xs:12,md:6,children:(0,ue.jsx)(x.A,{fullWidth:!0,size:"small",placeholder:"Search popular rooms...",value:to,onChange:e=>{ro(e.target.value),(async e=>{if(e.trim()){no(!0);try{const o=e.toLowerCase(),t=Qe.filter((e=>e.name.toLowerCase().includes(o)||e.description.toLowerCase().includes(o)||e.creatorName.toLowerCase().includes(o)));oo(t)}catch(ye){console.error("Error searching popular rooms:",ye),oo([])}finally{no(!1)}}else oo(Qe)})(e.target.value)},InputProps:{startAdornment:(0,ue.jsx)(h.A,{position:"start",children:(0,ue.jsx)(F.A,{})})},sx:{backgroundColor:"background.paper",borderRadius:1,"& .MuiOutlinedInput-root":{borderRadius:1}}})}),(0,ue.jsx)(C.Ay,{item:!0,xs:12,md:6,children:(0,ue.jsxs)(y.A,{value:io,onChange:(e,o)=>(e=>{if(so(e),"All"===e)return void oo(Qe);const o=Qe.filter((o=>{var t;return null===(t=o.tags)||void 0===t?void 0:t.includes(e)}));oo(o)})(o),variant:"scrollable",scrollButtons:"auto","aria-label":"popular room categories",sx:{borderBottom:1,borderColor:"divider"},children:[(0,ue.jsx)(j.A,{label:"All",value:"All"}),Eo.map((e=>(0,ue.jsx)(j.A,{label:e,value:e},e)))]})})]})}),ae||ao?(0,ue.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,ue.jsx)(l.A,{})}):eo.length>0?(0,ue.jsx)(C.Ay,{container:!0,spacing:3,children:eo.map((e=>(0,ue.jsx)(C.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,ue.jsxs)(k.A,{sx:{display:"flex",flexDirection:"column",cursor:"pointer",borderRadius:2,overflow:"hidden",boxShadow:we.shadows[3],"&:hover":{transform:"translateY(-4px)",transition:"transform 0.2s ease-in-out",boxShadow:we.shadows[6]}},onClick:()=>Ho(e.id),children:[(0,ue.jsxs)(n.A,{sx:{position:"relative"},children:[(0,ue.jsx)(S.A,{component:"img",height:Ce?"160":"200",image:e.thumbnailUrl||e.creatorAvatar||"https://placehold.co/600x400/333/666?text=Room",alt:e.name,sx:{objectFit:"cover",width:"100%",borderRadius:"8px 8px 0 0",filter:"brightness(0.95) contrast(1.05)",transition:"all 0.3s ease","&:hover":{filter:"brightness(1.05) contrast(1.1)",transform:"scale(1.02)"}}}),(0,ue.jsx)(n.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 30%, rgba(0,0,0,0) 70%, rgba(0,0,0,0.2) 100%)",borderRadius:"8px 8px 0 0"}}),(0,ue.jsxs)(n.A,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:.5,zIndex:2},children:[(0,ue.jsx)(P.A,{label:"Popular",color:"warning",size:"small",icon:(0,ue.jsx)(O.A,{}),sx:{fontWeight:"bold",fontSize:"0.7rem",height:24,"& .MuiChip-label":{px:1},"& .MuiChip-icon":{fontSize:"0.8rem"},boxShadow:"0 2px 8px rgba(0,0,0,0.3)",backdropFilter:"blur(4px)"}}),e.isLive&&(0,ue.jsx)(P.A,{label:"LIVE",color:"error",size:"small",sx:{fontWeight:"bold",fontSize:"0.7rem",height:24,"& .MuiChip-label":{px:1},boxShadow:"0 2px 8px rgba(0,0,0,0.3)",backdropFilter:"blur(4px)",animation:"pulse 2s infinite"}})]})]}),(0,ue.jsxs)(I.A,{sx:{flexGrow:1,p:3,"&:last-child":{pb:3}},children:[(0,ue.jsxs)(n.A,{sx:{mb:2},children:[(0,ue.jsx)(u.A,{gutterBottom:!0,variant:Ce?"h6":"h5",component:"h2",noWrap:!0,sx:{fontWeight:600,mb:1},children:e.name}),(0,ue.jsx)(u.A,{variant:"body1",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:2,lineHeight:1.5},children:e.description})]}),(0,ue.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2,flexWrap:"wrap"},children:[(0,ue.jsx)(P.A,{icon:(0,ue.jsx)(V.A,{sx:{fontSize:Ce?"1.1rem":"1.25rem"}}),label:"".concat(e.activeUsers||0," views"),color:"primary",variant:"outlined",sx:{height:"auto",padding:"8px 12px","& .MuiChip-label":{padding:"1 4px",fontSize:Ce?"0.875rem":"1rem"}}}),e.isPrivate&&(0,ue.jsx)(P.A,{label:"Private",color:"secondary",sx:{height:"auto",padding:"8px 12px","& .MuiChip-label":{padding:"0 4px",fontSize:Ce?"0.875rem":"1rem"}}})]}),(0,ue.jsxs)(u.A,{variant:"body2",color:"text.secondary",sx:{fontSize:Ce?"0.75rem":"0.875rem",display:"flex",alignItems:"center",gap:.5},children:["Created by ",e.creatorName||"Anonymous"," \u2022 ",$(e.lastActive)]})]})]})},e.id)))}):(0,ue.jsxs)(n.A,{sx:{textAlign:"center",py:4},children:[(0,ue.jsx)(u.A,{variant:"h6",color:"text.secondary",children:to?"No matching popular rooms found":"No popular rooms found"}),to&&(0,ue.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try different keywords or check your spelling"})]})]})}),(0,ue.jsxs)(R.A,{open:De,onClose:Go,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,ue.jsx)(U.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,ue.jsx)(E.A,{children:(0,ue.jsxs)(u.A,{children:[(null===He||void 0===He?void 0:He.username)||"This creator",' has a server chat room: "',null===Ge||void 0===Ge?void 0:Ge.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,ue.jsxs)(M.A,{children:[(0,ue.jsx)(z.A,{onClick:Go,children:"Not Now"}),(0,ue.jsx)(z.A,{onClick:()=>{Ge&&ge("/chat/room/".concat(Ge.id)),Le(!1)},variant:"contained",color:"primary",children:"Join"})]})]}),(0,ue.jsxs)(R.A,{open:mo,onClose:()=>bo(!1),PaperProps:{sx:{borderRadius:2,maxWidth:"sm",width:"90%"}},children:[(0,ue.jsx)(U.A,{children:"Keep Listening?"}),(0,ue.jsx)(E.A,{children:(0,ue.jsxs)(u.A,{children:["Would you like to join ",null===go||void 0===go?void 0:go.name," or continue listening from the stream?"]})}),(0,ue.jsxs)(M.A,{children:[(0,ue.jsx)(z.A,{onClick:()=>{bo(!1),(async()=>{if(jo){try{await jo.leave()}catch(ye){console.error("Error leaving audio stream:",ye)}wo(null)}})()},children:"Stop Listening"}),(0,ue.jsx)(z.A,{onClick:()=>{bo(!1),go&&Ho(go.id)},variant:"contained",color:"primary",children:"Join Room"}),(0,ue.jsx)(z.A,{onClick:()=>{bo(!1),go&&No(go.id)},variant:"outlined",color:"primary",disabled:Co,children:Co?"Connecting...":"Keep Listening"})]})]}),jo&&So&&(0,ue.jsx)(me.Mf9,{client:So,children:(0,ue.jsx)(me.xwR,{call:jo,children:(0,ue.jsx)(fe,{})})})]})}}}]);