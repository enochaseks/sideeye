"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[381],{2814:(e,r,o)=>{o.d(r,{x:()=>l});var n=o(9950),s=o(6220),i=o(330),t=o(1367);const l=()=>{const{currentUser:e}=(0,t.As)(),[r,o]=(0,n.useState)(new Set);(0,n.useEffect)((()=>{if(null===e||void 0===e||!e.uid)return;const r=async()=>{try{const r=(0,s.H9)(i.db,"users",e.uid);await(0,s.mZ)(r,{lastSeen:(0,s.O5)(),isOnline:!0})}catch(r){console.error("Error updating presence:",r)}};r();const n=setInterval(r,3e4),t=async()=>{try{const r=(0,s.H9)(i.db,"users",e.uid);await(0,s.mZ)(r,{isOnline:!1,lastSeen:(0,s.O5)()})}catch(r){console.error("Error setting offline status:",r)}};window.addEventListener("beforeunload",t);const l=(0,s.rJ)(i.db,"users"),a=(0,s.aQ)(l,(e=>{const r=new Set,n=new Date;e.docs.forEach((e=>{const o=e.data(),s=e.id;if(o.isOnline)r.add(s);else if(o.lastSeen){const e=o.lastSeen.toDate?o.lastSeen.toDate():new Date(o.lastSeen);(n.getTime()-e.getTime())/6e4<2&&r.add(s)}})),o(r)}));return()=>{clearInterval(n),window.removeEventListener("beforeunload",t),a(),t()}}),[null===e||void 0===e?void 0:e.uid]);return{isUserOnline:e=>r.has(e),onlineUsers:r}}},7016:(e,r,o)=>{o.d(r,{A:()=>t});o(9950);var n=o(6491),s=o(3274),i=o(4414);const t=e=>{let{isOnline:r,size:o="small",showTooltip:t=!0}=e;const l={small:10,medium:14,large:18},a=(0,i.jsx)(n.A,{sx:{width:l[o],height:l[o],borderRadius:"50%",backgroundColor:r?"#4caf50":"#bdbdbd",border:"2px solid white",boxShadow:"0 0 0 1px rgba(0,0,0,0.1)",transition:"background-color 0.3s ease"}});return t?(0,i.jsx)(s.A,{title:r?"Online":"Offline",placement:"top",children:a}):a}},7381:(e,r,o)=>{o.r(r),o.d(r,{default:()=>ve});var n=o(9379),s=o(45),i=o(9950),t=o(8429),l=o(6491),a=o(6639),d=o(9808),c=o(2235),m=o(5333),u=o(2053),x=o(2236),h=o(3274),p=o(4142),A=o(6699),j=o(249),g=o(6050),v=o(8614),f=o(1413),b=o(5277),y=o(8145),w=o(226),C=o(7591),k=o(3266),S=o(4195),R=o(4447),E=o(6583),I=o(33),z=o(8170),P=o(6493),N=o(3563),W=o(9739),F=o(2362),U=o(4862),O=o(3174),H=o(7016),D=o(2814),q=o(4801),B=o(6281),T=o(529),_=o(1071),M=o(9438),L=o(2092),Z=o(4200),G=o(598),J=o(1673),Y=o(3256),V=o(379),Q=o(760),K=o(3759),X=o(6835),$=o(227),ee=o(3248),re=o(7565),oe=o(7319),ne=o(260),se=o(1308),ie=o(1770),te=o(1367),le=o(4570),ae=o(6220),de=o(330),ce=o(5887),me=o(9751),ue=o(4857),xe=o(6589),he=o(4567),pe=o(4414);const Ae=["children","value","index"];function je(e){const{children:r,value:o,index:i}=e,t=(0,s.A)(e,Ae);return(0,pe.jsx)("div",(0,n.A)((0,n.A)({role:"tabpanel",hidden:o!==i,id:"room-tabpanel-".concat(i),"aria-labelledby":"room-tab-".concat(i)},t),{},{children:o===i&&(0,pe.jsx)(l.A,{sx:{p:2},children:r})}))}const ge=(0,he.A)("input")({display:"none"}),ve=()=>{var e,r;const{roomId:o}=(0,t.g)(),{currentUser:s}=(0,te.As)(),{addNotification:he}=(0,le.E)(),Ae=(0,t.Zp)(),{isUserOnline:ve}=(0,D.x)(),[fe,be]=(0,i.useState)(null),[ye,we]=(0,i.useState)(!0),[Ce,ke]=(0,i.useState)(!1),[Se,Re]=(0,i.useState)(0),[Ee,Ie]=(0,i.useState)(null),[ze,Pe]=(0,i.useState)(""),[Ne,We]=(0,i.useState)(""),[Fe,Ue]=(0,i.useState)([]),[Oe,He]=(0,i.useState)([]),[De,qe]=(0,i.useState)([]),[Be,Te]=(0,i.useState)(!1),[_e,Me]=(0,i.useState)(!1),[Le,Ze]=(0,i.useState)(!1),[Ge,Je]=(0,i.useState)(""),[Ye,Ve]=(0,i.useState)([{text:""},{text:""}]),[Qe,Ke]=(0,i.useState)(""),[Xe,$e]=(0,i.useState)([]),[er,rr]=(0,i.useState)(!1),[or,nr]=(0,i.useState)(""),[sr,ir]=(0,i.useState)("success"),tr=(0,i.useRef)(null),[lr,ar]=(0,i.useState)({}),[dr,cr]=(0,i.useState)(null),[mr,ur]=(0,i.useState)(!1),[xr,hr]=(0,i.useState)(null),[pr,Ar]=(0,i.useState)(null),[jr,gr]=(0,i.useState)(!1),vr=(0,i.useRef)(null),[fr,br]=(0,i.useState)(!1),[yr,wr]=(0,i.useState)(null),[Cr,kr]=(0,i.useState)(null),[Sr,Rr]=(0,i.useState)(!1),[Er,Ir]=(0,i.useState)(!1),[zr,Pr]=(0,i.useState)(""),[Nr,Wr]=(0,i.useState)(null),[Fr,Ur]=(0,i.useState)(null),[Or,Hr]=(0,i.useState)(!1),[Dr,qr]=(0,i.useState)(!1),[Br,Tr]=(0,i.useState)([]),[_r,Mr]=(0,i.useState)(!1),[Lr,Zr]=(0,i.useState)([]),[Gr,Jr]=(0,i.useState)(null),[Yr,Vr]=(0,i.useState)(null),[Qr,Kr]=(0,i.useState)(!1),[Xr,$r]=(0,i.useState)(null),[eo,ro]=(0,i.useState)([]),[oo,no]=(0,i.useState)(!1),[so,io]=(0,i.useState)(null),[to,lo]=(0,i.useState)([]),[ao,co]=(0,i.useState)(!1),[mo,uo]=(0,i.useState)(""),[xo,ho]=(0,i.useState)(null),[po,Ao]=(0,i.useState)(""),[jo,go]=(0,i.useState)(!1),[vo,fo]=(0,i.useState)(null),[bo,yo]=(0,i.useState)({anchorEl:null,message:null}),[wo,Co]=(0,i.useState)({anchorEl:null,message:null,emoji:null}),ko=(0,ue.A)(),So=(0,xe.A)(ko.breakpoints.up("md")),Ro=()=>{Ie(null)},Eo=()=>{var e;null===(e=tr.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,i.useEffect)((()=>{Eo()}),[Fe,Oe]),(0,i.useEffect)((()=>{if(!o||!s)return void Ae("/messages");(async()=>{try{const e=(0,ae.H9)(de.db,"rooms",o),r=await(0,ae.x7)(e);if(!r.exists())return ce.oR.error("Room not found"),void Ae("/messages");const i=(0,n.A)({id:r.id},r.data());if(be(i),ke(i.createdBy===s.uid),lo(i.rules||[]),!i.members.includes(s.uid)){if(i.locked&&i.createdBy!==s.uid){if(i.pendingRequests&&i.pendingRequests.includes(s.uid))ce.oR.success("Your request to join this room is pending approval");else{const r=i.pendingRequests||[];await(0,ae.mZ)(e,{pendingRequests:[...r,s.uid]});const n=(0,ae.rJ)(de.db,"notifications");await(0,ae.gS)(n,{type:"room_join_request",senderId:s.uid,senderName:s.displayName||"User",senderAvatar:s.photoURL||"",recipientId:i.createdBy,content:"".concat(s.displayName||"A user",' wants to join your room "').concat(i.name,'"'),roomId:o,roomName:i.name,isRead:!1,createdAt:(0,ae.O5)()}),ce.oR.success("Your request to join this room has been sent to the owner")}return void Ae("/messages")}await(0,ae.mZ)(e,{members:[...i.members,s.uid]})}we(!1)}catch(e){console.error("Error fetching room:",e),ce.oR.error("Failed to load room"),Ae("/messages")}})();const e=(0,ae.rJ)(de.db,"rooms",o,"messages"),r=(0,ae.P)(e,(0,ae._M)("type","==","chat"),(0,ae.My)("timestamp","asc"),(0,ae.AB)(100)),i=(0,ae.aQ)(r,(e=>{const r=e.docs.map((e=>(0,n.A)({id:e.id},e.data())));Ue(r)})),t=(0,ae.P)(e,(0,ae._M)("type","==","announcement"),(0,ae.My)("timestamp","desc"),(0,ae.AB)(20)),l=(0,ae.aQ)(t,(e=>{const r=e.docs.map((e=>(0,n.A)({id:e.id},e.data())));He(r)})),a=(0,ae.P)(e,(0,ae._M)("type","==","poll"),(0,ae.My)("timestamp","desc"),(0,ae.AB)(10)),d=(0,ae.aQ)(a,(e=>{const r=e.docs.map((e=>(0,n.A)({id:e.id},e.data())));qe(r)}));return()=>{i(),l(),d()}}),[o,s,Ae,de.db]),(0,i.useEffect)((()=>{if(!s)return;(async()=>{try{const e=(0,ae.H9)(de.db,"users",s.uid),r=await(0,ae.x7)(e);if(r.exists()){const e=r.data();ar({username:e.username,name:e.name,profilePic:e.profilePic||e.photoURL})}}catch(e){console.error("Error fetching user data:",e)}})()}),[s,de.db]);const Io=async()=>{if(ze.trim()||jr)try{if(jr)return void await Fo();await(0,ae.gS)((0,ae.rJ)(de.db,"rooms",o,"messages"),{text:ze.trim(),sender:null===s||void 0===s?void 0:s.uid,senderName:lr.name||lr.username||(null===s||void 0===s?void 0:s.displayName)||"Anonymous",senderPhoto:lr.profilePic||(null===s||void 0===s?void 0:s.photoURL)||null,timestamp:(0,ae.O5)(),type:"chat",reactions:[]}),Pe(""),Eo()}catch(e){console.error("Error sending message:",e),nr("Failed to send message"),ir("error"),rr(!0)}},zo=async()=>{if(Qe.trim())try{$e([]);const r=Qe.trim().toLowerCase(),o=(0,ae.rJ)(de.db,"users");let i=[];try{const e=(0,ae.P)(o,(0,ae.My)("username_lower"),(0,ae.EO)(r),(0,ae.FD)(r+"\uf8ff"),(0,ae.AB)(20)),s=await(0,ae.GG)(e);i=s.docs.map((e=>(0,n.A)({id:e.id},e.data()))),console.log("Found ".concat(i.length," users by username_lower"))}catch(e){console.error("Error searching by username_lower:",e)}if(i.length<10)try{const e=(0,ae.P)(o,(0,ae.My)("name_lower"),(0,ae.EO)(r),(0,ae.FD)(r+"\uf8ff"),(0,ae.AB)(20)),s=(await(0,ae.GG)(e)).docs.map((e=>(0,n.A)({id:e.id},e.data()))).filter((e=>!i.some((r=>r.id===e.id))));i=[...i,...s],console.log("Added ".concat(s.length," users by name_lower, total: ").concat(i.length))}catch(e){console.error("Error searching by name_lower:",e)}if(0===i.length)try{const e=(0,ae.P)(o,(0,ae._M)("username",">=",r),(0,ae._M)("username","<=",r+"\uf8ff"),(0,ae.AB)(20)),s=(0,ae.P)(o,(0,ae._M)("name",">=",r),(0,ae._M)("name","<=",r+"\uf8ff"),(0,ae.AB)(20)),[t,l]=await Promise.all([(0,ae.GG)(e),(0,ae.GG)(s)]),a=new Map;t.docs.forEach((e=>{a.set(e.id,(0,n.A)({id:e.id},e.data()))})),l.docs.forEach((e=>{a.set(e.id,(0,n.A)({id:e.id},e.data()))})),i=Array.from(a.values()),console.log("Found ".concat(i.length," users using standard fields"))}catch(e){console.error("Error with fallback search:",e)}if(0===i.length)try{console.log("Using last resort search method");const e=(0,ae.P)(o,(0,ae.AB)(50)),s=await(0,ae.GG)(e);i=s.docs.map((e=>{const r=e.data();return(0,n.A)({id:e.id,username:r.username,name:r.name,profilePic:r.profilePic},r)})).filter((e=>e.username&&e.username.toLowerCase().includes(r)||e.name&&e.name.toLowerCase().includes(r))),console.log("Found ".concat(i.length," users with client-side filtering"))}catch(e){console.error("Error with last resort search:",e)}const t=i.filter((e=>e.id!==(null===s||void 0===s?void 0:s.uid)&&!(null!==fe&&void 0!==fe&&fe.members.includes(e.id))));console.log("Returning ".concat(t.length," users after filtering")),$e(t),0===t.length&&(nr("No matching users found"),ir("info"),rr(!0))}catch(e){console.error("Error searching users:",e),nr("Failed to search users"),ir("error"),rr(!0)}},Po=e=>{if(!e)return"";return e.toDate().toLocaleString()},No=()=>{xr&&(clearTimeout(xr),hr(null))},Wo=()=>{xr&&(clearTimeout(xr),hr(null))},Fo=async e=>{var r,n,i;const t=e?null===(r=e.target.files)||void 0===r?void 0:r[0]:null===(n=vr.current)||void 0===n||null===(i=n.files)||void 0===i?void 0:i[0];if(!t||!s||!o)return;if(t.size>10485760)return void ce.oR.error("File too large. Maximum size is 10MB.");const l=t.type.split("/")[0];if("image"===l||"video"===l){try{gr(!0),Ar(0);const e=(0,me.KR)(de.IG,"chat-media/rooms/".concat(o,"/").concat(Date.now(),"_").concat(t.name)),r=(0,me.bp)(e,t);r.on("state_changed",(e=>{const r=e.bytesTransferred/e.totalBytes*100;Ar(r)}),(e=>{console.error("Error uploading file:",e),ce.oR.error("Upload failed: "+e.message),gr(!1),Ar(null)}),(async()=>{try{const e=await(0,me.qk)(r.snapshot.ref);await Uo(e,l),gr(!1),Ar(null)}catch(e){console.error("Error getting download URL:",e),ce.oR.error("Failed to process uploaded file"),gr(!1),Ar(null)}}))}catch(a){console.error("Error handling file upload:",a),ce.oR.error("Failed to upload file"),gr(!1),Ar(null)}vr.current&&(vr.current.value="")}else ce.oR.error("Only image and video files are supported.")},Uo=async(e,r)=>{if(s)try{const n=(0,ae.rJ)(de.db,"rooms",o,"messages"),i="image"===r?"Sent an image":"Sent a video";await(0,ae.gS)(n,{text:i,sender:s.uid,senderName:lr.name||lr.username||s.displayName||"User",senderPhoto:lr.profilePic||s.photoURL||"",timestamp:(0,ae.O5)(),type:"chat",mediaUrl:e,mediaType:r}),Eo()}catch(n){console.error("Error sending media message:",n),ce.oR.error("Failed to send media")}},Oo=()=>{kr(null)},Ho=()=>{Wr(null)},Do=()=>{yo({anchorEl:null,message:null})},qo=()=>{Co({anchorEl:null,message:null,emoji:null})},Bo=()=>{Jr(null),Vr(null)};(0,i.useEffect)((()=>{s&&(async()=>{if(s)try{const e=(0,ae.H9)(de.db,"users",s.uid),r=await(0,ae.x7)(e);if(r.exists()){const e=r.data();ro(e.blockedUsers||[])}}catch(e){console.error("Error fetching blocked users:",e)}})()}),[s]),(0,i.useEffect)((()=>{Lr.length>0&&(()=>{if(!fe||!eo.length)return;const e=Lr.find((e=>eo.includes(e.id)));e&&(io(e),no(!0))})()}),[Lr,eo]);const To=async(e,r,i)=>{if(fe&&s&&Ce)try{const t=fe.members.filter((e=>e!==s.uid)),l=t.map((t=>he((0,n.A)({type:e,senderId:s.uid,senderName:lr.name||lr.username||s.displayName||"Room Owner",senderAvatar:lr.profilePic||s.photoURL||"",recipientId:t,content:r,roomId:o,roomName:fe.name},i))));await Promise.all(l),console.log("Sent ".concat(e," notifications to ").concat(t.length," room members"))}catch(t){console.error("Error sending room notifications:",t)}},_o=e=>{const r=/(https?:\/\/[^\s]+\/side-room\/[^\s]+)/g;return e.split(r).map(((e,o)=>{if(e.match(r)){const r=new URL(e).pathname.split("/"),n=r[r.length-1];return(0,pe.jsx)(l.A,{component:"button",onClick:e=>{e.stopPropagation(),(e=>{Ae("/side-room/".concat(e))})(n)},sx:{color:"inherit",textDecoration:"underline",background:"none",border:"none",padding:0,font:"inherit",cursor:"pointer","&:hover":{opacity:.8}},children:e},o)}return(0,pe.jsx)("span",{children:e},o)}))},Mo=async(e,r)=>{if(null!==s&&void 0!==s&&s.uid&&o)try{const i=(0,ae.H9)(de.db,"rooms",o,"messages",e),t=await(0,ae.x7)(i);if(!t.exists())return nr("Announcement not found"),ir("error"),void rr(!0);const l=t.data().reactions||[],a=l.findIndex((e=>e.userId===s.uid&&e.emoji===r));let d;if(-1!==a)d=[...l],d.splice(a,1);else{const e=l.filter((e=>e.userId!==s.uid)),o={emoji:r,userId:s.uid,username:lr.name||lr.username||s.displayName||""};d=[...e,o]}await(0,ae.mZ)(i,{reactions:d}),He((r=>r.map((r=>r.id===e?(0,n.A)((0,n.A)({},r),{},{reactions:d}):r))))}catch(i){console.error("Error handling announcement reaction:",i),nr("Failed to update reaction"),ir("error"),rr(!0)}};return ye?(0,pe.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,pe.jsx)(a.A,{})}):(0,pe.jsxs)(d.A,{maxWidth:"md",sx:{mt:2,mb:{xs:10,md:8},height:"100%"},children:[(0,pe.jsxs)(c.A,{elevation:0,sx:{p:2},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,pe.jsx)(m.A,{onClick:()=>Ae("/messages"),sx:{mr:1},children:(0,pe.jsx)(q.A,{})}),(0,pe.jsx)(u.A,{variant:"h6",fontWeight:"bold",children:null===fe||void 0===fe?void 0:fe.name})]}),(0,pe.jsx)(m.A,{onClick:e=>{Ie(e.currentTarget)},children:(0,pe.jsx)(B.A,{})})]}),(null===fe||void 0===fe?void 0:fe.description)&&(0,pe.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:fe.description}),(0,pe.jsx)(l.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,pe.jsxs)(x.A,{value:Se,onChange:(e,r)=>{Re(r)},"aria-label":"room tabs",variant:"fullWidth",children:[(0,pe.jsx)(h.A,{title:"General Chat",arrow:!0,children:(0,pe.jsx)(p.A,{icon:(0,pe.jsx)(T.A,{}),id:"room-tab-0","aria-controls":"room-tabpanel-0",sx:{minWidth:"auto"}})}),(0,pe.jsx)(h.A,{title:"Announcements",arrow:!0,children:(0,pe.jsx)(p.A,{icon:(0,pe.jsx)(_.A,{}),id:"room-tab-1","aria-controls":"room-tabpanel-1",sx:{minWidth:"auto"}})}),(0,pe.jsx)(h.A,{title:"Polls",arrow:!0,children:(0,pe.jsx)(p.A,{icon:(0,pe.jsx)(M.A,{}),id:"room-tab-2","aria-controls":"room-tabpanel-2",sx:{minWidth:"auto"}})}),(0,pe.jsx)(h.A,{title:"Rules",arrow:!0,children:(0,pe.jsx)(p.A,{icon:(0,pe.jsx)(L.A,{}),id:"room-tab-3","aria-controls":"room-tabpanel-3",sx:{minWidth:"auto"}})})]})})]}),jr&&(0,pe.jsxs)(l.A,{sx:{width:"100%",px:2,py:1,bgcolor:"background.paper"},children:[(0,pe.jsxs)(u.A,{variant:"caption",gutterBottom:!0,children:["Uploading media... ",pr?Math.round(pr):0,"%"]}),(0,pe.jsx)(A.A,{variant:"determinate",value:pr||0,sx:{height:6,borderRadius:3}})]}),(0,pe.jsxs)(c.A,{elevation:0,sx:{height:{xs:"calc(100vh - 280px)",md:"calc(100vh - 250px)"},mt:2},children:[(0,pe.jsxs)(je,{value:Se,index:0,children:[(0,pe.jsx)(l.A,{sx:{height:"calc(100vh - 350px)",overflowY:"auto",mb:2},children:0===Fe.length?(0,pe.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,pe.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"No messages yet. Start the conversation!"})}):(0,pe.jsxs)(j.A,{children:[Fe.map((e=>{var r,o;const n=e.sender===(null===s||void 0===s?void 0:s.uid);return(0,pe.jsxs)(g.Ay,{alignItems:"flex-start",sx:{flexDirection:n?"row-reverse":"row",px:1},children:[(0,pe.jsx)(v.A,{sx:{minWidth:n?"40px":"56px",ml:n?1:0},children:(0,pe.jsxs)(l.A,{sx:{position:"relative"},children:[(0,pe.jsx)(f.A,{alt:e.senderName,src:e.senderPhoto,sx:{width:40,height:40,bgcolor:e.senderPhoto?void 0:n?"primary.main":"secondary.main",cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>Ae("/profile/".concat(e.sender)),children:!e.senderPhoto&&(null===(r=e.senderName)||void 0===r||null===(o=r.charAt(0))||void 0===o?void 0:o.toUpperCase())}),!n&&(0,pe.jsx)(l.A,{sx:{position:"absolute",bottom:4,right:4,zIndex:1},children:(0,pe.jsx)(H.A,{isOnline:ve(e.sender),size:"small"})})]})}),(0,pe.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:n?"flex-end":"flex-start",maxWidth:"75%"},children:[(0,pe.jsx)(u.A,{variant:"caption",color:"text.secondary",sx:{mb:.5,cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:()=>Ae("/profile/".concat(e.sender)),children:n?"You":e.senderName}),(0,pe.jsxs)(c.A,{elevation:0,sx:{p:1.5,borderRadius:2,bgcolor:n?"primary.light":"background.paper",color:n?"primary.contrastText":"text.primary",cursor:"pointer",position:"relative","&:hover":{opacity:.9}},onClick:r=>((e,r)=>{yo({anchorEl:e.currentTarget,message:r})})(r,e),onMouseDown:()=>n&&(e=>{if(e.sender!==(null===s||void 0===s?void 0:s.uid))return;const r=setTimeout((()=>{cr(e),ur(!0)}),500);hr(r)})(e),onMouseUp:No,onTouchStart:()=>n&&(e=>{if(e.sender!==(null===s||void 0===s?void 0:s.uid))return;const r=setTimeout((()=>{cr(e),ur(!0)}),500);hr(r)})(e),onTouchEnd:Wo,children:[e.mediaUrl&&"image"===e.mediaType&&(0,pe.jsx)(l.A,{sx:{mb:1},children:(0,pe.jsx)("img",{src:e.mediaUrl,alt:"Shared image",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",display:"block"}})}),e.mediaUrl&&"video"===e.mediaType&&(0,pe.jsx)(l.A,{sx:{mb:1},children:(0,pe.jsx)("video",{src:e.mediaUrl,controls:!0,style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",display:"block"}})}),(0,pe.jsx)(u.A,{variant:"body1",children:_o(e.text)}),(0,pe.jsx)(u.A,{variant:"caption",color:n?"primary.contrastText":"text.secondary",sx:{display:"block",opacity:.8,mt:.5,textAlign:"right"},children:Po(e.timestamp)})]}),e.reactions&&e.reactions.length>0&&(0,pe.jsx)(l.A,{sx:{display:"flex",flexDirection:n?"row-reverse":"row",flexWrap:"wrap",gap:.5,mt:.5,maxWidth:"100%"},children:Object.entries(e.reactions.reduce(((e,r)=>(e[r.emoji]=(e[r.emoji]||0)+1,e)),{})).map((r=>{var o;let[n,i]=r;const t=null===(o=e.reactions)||void 0===o?void 0:o.some((e=>e.emoji===n&&e.userId===(null===s||void 0===s?void 0:s.uid)));return(0,pe.jsx)(b.A,{label:"".concat(n," ").concat(i),size:"small",variant:"outlined",onClick:r=>((e,r,o)=>{e.stopPropagation(),Co({anchorEl:e.currentTarget,message:r,emoji:o})})(r,e,n),sx:{borderRadius:"12px",height:"24px",fontSize:"0.75rem",cursor:"pointer",backgroundColor:e=>t?"dark"===e.palette.mode?"rgba(25, 118, 210, 0.2)":"rgba(25, 118, 210, 0.1)":"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",border:e=>t?"1px solid ".concat(e.palette.primary.main):void 0,"&:hover":{backgroundColor:e=>t?"dark"===e.palette.mode?"rgba(25, 118, 210, 0.3)":"rgba(25, 118, 210, 0.2)":"dark"===e.palette.mode?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.1)"}}},n)}))})]})]},e.id)})),(0,pe.jsx)("div",{ref:tr})]})}),(0,pe.jsxs)(l.A,{sx:{display:"flex",p:1},children:[(0,pe.jsx)(ge,{ref:vr,accept:"image/*,video/*",id:"file-upload-input",type:"file",onChange:Fo}),(0,pe.jsx)(m.A,{onClick:()=>{var e;null===(e=vr.current)||void 0===e||e.click()},color:"primary",sx:{mr:1},"aria-label":"attach file",children:(0,pe.jsx)(Z.A,{})}),(0,pe.jsx)(m.A,{onClick:()=>{br(!fr)},color:"primary",sx:{mr:1},"aria-label":"add emoji",children:(0,pe.jsx)(G.A,{})}),(0,pe.jsx)(y.A,{fullWidth:!0,placeholder:"Type a message...",variant:"outlined",value:ze,onChange:e=>Pe(e.target.value),onKeyPress:e=>"Enter"===e.key&&Io(),sx:{mr:1}}),(0,pe.jsx)(w.A,{variant:"contained",endIcon:(0,pe.jsx)(J.A,{}),onClick:Io,disabled:!ze.trim()&&!jr,children:"Send"})]})]}),(0,pe.jsxs)(je,{value:Se,index:1,children:[Ce&&(0,pe.jsxs)(l.A,{sx:{mb:3,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,pe.jsx)(u.A,{variant:"subtitle1",gutterBottom:!0,children:"Create Announcement"}),(0,pe.jsx)(y.A,{fullWidth:!0,placeholder:"Post an announcement to all members...",variant:"outlined",multiline:!0,rows:3,value:Ne,onChange:e=>We(e.target.value),sx:{mb:1}}),(0,pe.jsx)(w.A,{variant:"contained",endIcon:(0,pe.jsx)(_.A,{}),onClick:async()=>{if(Ne.trim()&&s&&Ce)try{const e=(0,ae.rJ)(de.db,"rooms",o,"messages");await(0,ae.gS)(e,{text:Ne.trim(),sender:s.uid,senderName:lr.name||lr.username||s.displayName||"User",senderPhoto:lr.profilePic||s.photoURL||"",timestamp:(0,ae.O5)(),type:"announcement",reactions:[]}),await To("room_announcement",'\ud83d\udce2 New announcement in "'.concat(null===fe||void 0===fe?void 0:fe.name,'": ').concat(Ne.trim().substring(0,100)).concat(Ne.trim().length>100?"...":""),{postId:null}),We(""),nr("Announcement posted"),ir("success"),rr(!0)}catch(e){console.error("Error posting announcement:",e),ce.oR.error("Failed to post announcement")}},disabled:!Ne.trim(),children:"Post Announcement"})]}),(0,pe.jsx)(l.A,{children:0===Oe.length?(0,pe.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:(0,pe.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"No announcements yet."})}):(0,pe.jsx)(j.A,{children:Oe.map((e=>{var r,o,n,i;return(0,pe.jsxs)(c.A,{elevation:0,sx:{mb:2,p:2,bgcolor:"background.default"},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,pe.jsxs)(l.A,{sx:{position:"relative",mr:1},children:[(0,pe.jsx)(f.A,{alt:e.senderName,src:e.senderPhoto}),(0,pe.jsx)(l.A,{sx:{position:"absolute",bottom:4,right:4,zIndex:1},children:(0,pe.jsx)(H.A,{isOnline:ve(e.sender),size:"small"})})]}),(0,pe.jsxs)(l.A,{sx:{flexGrow:1},children:[(0,pe.jsx)(u.A,{variant:"subtitle2",children:e.senderName}),(0,pe.jsx)(u.A,{variant:"caption",color:"text.secondary",children:Po(e.timestamp)})]}),Ce&&(0,pe.jsx)(m.A,{size:"small",onClick:r=>((e,r)=>{e.stopPropagation(),kr(e.currentTarget),wr(r)})(r,e),sx:{ml:1},children:(0,pe.jsx)(B.A,{fontSize:"small"})})]}),(0,pe.jsx)(u.A,{variant:"body1",sx:{mb:2},children:e.text}),(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,pe.jsx)(m.A,{size:"small",onClick:()=>Mo(e.id,"\u2764\ufe0f"),sx:{color:null!==(r=e.reactions)&&void 0!==r&&r.some((e=>"\u2764\ufe0f"===e.emoji&&e.userId===(null===s||void 0===s?void 0:s.uid)))?"red":"text.secondary","&:hover":{color:"red",backgroundColor:"rgba(255, 0, 0, 0.1)"}},children:"\u2764\ufe0f"}),(0,pe.jsx)(u.A,{variant:"caption",color:"text.secondary",children:(null===(o=e.reactions)||void 0===o?void 0:o.filter((e=>"\u2764\ufe0f"===e.emoji)).length)||0})]}),(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,pe.jsx)(m.A,{size:"small",onClick:()=>Mo(e.id,"\ud83d\udc94"),sx:{color:null!==(n=e.reactions)&&void 0!==n&&n.some((e=>"\ud83d\udc94"===e.emoji&&e.userId===(null===s||void 0===s?void 0:s.uid)))?"purple":"text.secondary","&:hover":{color:"purple",backgroundColor:"rgba(128, 0, 128, 0.1)"}},children:"\ud83d\udc94"}),(0,pe.jsx)(u.A,{variant:"caption",color:"text.secondary",children:(null===(i=e.reactions)||void 0===i?void 0:i.filter((e=>"\ud83d\udc94"===e.emoji)).length)||0})]})]})]},e.id)}))})})]}),(0,pe.jsxs)(je,{value:Se,index:2,children:[Ce&&(0,pe.jsxs)(l.A,{sx:{mb:3,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,pe.jsx)(u.A,{variant:"subtitle1",gutterBottom:!0,children:"Create Poll"}),(0,pe.jsx)(w.A,{variant:"contained",startIcon:(0,pe.jsx)(M.A,{}),onClick:()=>Ze(!0),fullWidth:!0,children:"Create New Poll"})]}),(0,pe.jsx)(l.A,{children:0===De.length?(0,pe.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:(0,pe.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"No polls have been created yet."})}):(0,pe.jsx)(j.A,{children:De.map((e=>{var r;return(0,pe.jsxs)(c.A,{elevation:0,sx:{mb:3,p:2,bgcolor:"background.default"},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,pe.jsxs)(l.A,{sx:{position:"relative",mr:1},children:[(0,pe.jsx)(f.A,{alt:e.senderName,src:e.senderPhoto}),(0,pe.jsx)(l.A,{sx:{position:"absolute",bottom:4,right:4,zIndex:1},children:(0,pe.jsx)(H.A,{isOnline:ve(e.sender),size:"small"})})]}),(0,pe.jsxs)(l.A,{sx:{flexGrow:1},children:[(0,pe.jsx)(u.A,{variant:"subtitle2",children:e.senderName}),(0,pe.jsx)(u.A,{variant:"caption",color:"text.secondary",children:Po(e.timestamp)})]}),Ce&&e.sender===(null===s||void 0===s?void 0:s.uid)&&(0,pe.jsx)(m.A,{size:"small",onClick:r=>((e,r)=>{e.stopPropagation(),Wr(e.currentTarget),Ur(r)})(r,e),sx:{ml:1},children:(0,pe.jsx)(B.A,{fontSize:"small"})})]}),(0,pe.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:e.text}),null===(r=e.pollOptions)||void 0===r?void 0:r.map(((r,n)=>{var i;const t=(null===(i=e.pollVotes)||void 0===i?void 0:i[n.toString()])||[],a=t.length,d=Object.values(e.pollVotes||{}).reduce(((e,r)=>e+((null===r||void 0===r?void 0:r.length)||0)),0),c=d>0?Math.round(a/d*100):0,m=t.includes((null===s||void 0===s?void 0:s.uid)||"");return(0,pe.jsxs)(l.A,{sx:{mb:1,p:1.5,borderRadius:1,bgcolor:m?"primary.light":"background.paper",position:"relative",overflow:"hidden",cursor:"pointer","&:hover":{bgcolor:m?"primary.light":"action.hover"}},onClick:()=>(async(e,r)=>{if(s)try{const n=(0,ae.H9)(de.db,"rooms",o,"messages",e),i=await(0,ae.x7)(n);if(!i.exists())return;const t=i.data().pollVotes||{};Object.keys(t).forEach((e=>{var r;null!==(r=t[e])&&void 0!==r&&r.includes(s.uid)&&(t[e]=t[e].filter((e=>e!==s.uid)))}));const l=r.toString();t[l]||(t[l]=[]),t[l]=[...t[l],s.uid],await(0,ae.mZ)(n,{pollVotes:t})}catch(n){console.error("Error voting on poll:",n),ce.oR.error("Failed to submit vote")}})(e.id,n),children:[(0,pe.jsx)(l.A,{sx:{position:"absolute",left:0,top:0,height:"100%",width:"".concat(c,"%"),bgcolor:"primary.main",opacity:.2,zIndex:0}}),(0,pe.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",position:"relative",zIndex:1},children:[(0,pe.jsx)(u.A,{variant:"body1",children:r}),(0,pe.jsxs)(u.A,{variant:"body2",children:[a," ",1===a?"vote":"votes"," (",c,"%)"]})]})]},n)}))]},e.id)}))})})]}),(0,pe.jsx)(je,{value:Se,index:3,children:(0,pe.jsx)(l.A,{sx:{pb:{xs:2,md:0}},children:0===to.length?(0,pe.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:{xs:2,md:4},px:{xs:1,md:2}},children:[(0,pe.jsx)(u.A,{variant:So?"h6":"subtitle1",color:"text.secondary",gutterBottom:!0,sx:{textAlign:"center"},children:Ce?"No rules set":"No rules"}),Ce&&(0,pe.jsx)(h.A,{title:"Add first rule",arrow:!0,children:(0,pe.jsx)(m.A,{color:"primary",onClick:()=>co(!0),sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},width:{xs:48,md:56},height:{xs:48,md:56}},children:(0,pe.jsx)(Y.A,{})})})]}):(0,pe.jsxs)(pe.Fragment,{children:[Ce&&(0,pe.jsx)(l.A,{sx:{mb:{xs:1.5,md:2},px:{xs:1,md:0},display:"flex",justifyContent:{xs:"center",md:"flex-start"}},children:(0,pe.jsx)(h.A,{title:"Add new rule",arrow:!0,children:(0,pe.jsx)(m.A,{color:"primary",onClick:()=>co(!0),sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},width:{xs:44,md:48},height:{xs:44,md:48}},children:(0,pe.jsx)(Y.A,{})})})}),(0,pe.jsx)(j.A,{sx:{bgcolor:"background.paper",borderRadius:1,px:{xs:1,md:0}},children:to.map(((e,r)=>(0,pe.jsxs)(c.A,{elevation:0,sx:{mb:{xs:1.5,md:2},p:{xs:1.5,md:2},bgcolor:"background.default"},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[(0,pe.jsxs)(l.A,{sx:{flexGrow:1,mr:1},children:[(0,pe.jsxs)(u.A,{variant:"subtitle2",sx:{mb:1,color:"primary.main",fontSize:{xs:"0.8rem",md:"0.875rem"}},children:["Rule #",r+1]}),(0,pe.jsx)(u.A,{variant:"body2",sx:{fontSize:{xs:"0.875rem",md:"1rem"},lineHeight:{xs:1.4,md:1.5}},children:e})]}),Ce&&(0,pe.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:{xs:.5,md:1}},children:[(0,pe.jsx)(h.A,{title:"Edit rule",arrow:!0,children:(0,pe.jsx)(m.A,{size:"small",onClick:()=>{ho(r),Ao(e)},sx:{p:{xs:.5,md:1}},children:(0,pe.jsx)(V.A,{fontSize:"small"})})}),(0,pe.jsx)(h.A,{title:"Delete rule",arrow:!0,children:(0,pe.jsx)(m.A,{size:"small",onClick:()=>{fo(r),go(!0)},color:"error",sx:{p:{xs:.5,md:1}},children:(0,pe.jsx)(Q.A,{fontSize:"small"})})})]})]}),xo===r&&(0,pe.jsxs)(l.A,{sx:{mt:{xs:1.5,md:2},pt:{xs:1.5,md:2},borderTop:1,borderColor:"divider"},children:[(0,pe.jsx)(y.A,{fullWidth:!0,multiline:!0,rows:2,value:po,onChange:e=>Ao(e.target.value),sx:{mb:{xs:1.5,md:2}},size:So?"medium":"small"}),(0,pe.jsxs)(l.A,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[(0,pe.jsx)(h.A,{title:"Save changes",arrow:!0,children:(0,pe.jsx)(m.A,{color:"primary",onClick:()=>(async e=>{if(po.trim()&&Ce&&o)try{const r=[...to];r[e]=po.trim();const n=(0,ae.H9)(de.db,"rooms",o);await(0,ae.mZ)(n,{rules:r}),lo(r),ho(null),Ao(""),nr("Rule updated successfully"),ir("success"),rr(!0)}catch(r){console.error("Error updating rule:",r),nr("Failed to update rule"),ir("error"),rr(!0)}})(r),disabled:!po.trim(),sx:{bgcolor:"success.main",color:"white","&:hover":{bgcolor:"success.dark"},"&:disabled":{bgcolor:"action.disabled",color:"action.disabled"},width:{xs:36,md:40},height:{xs:36,md:40}},children:(0,pe.jsx)(K.A,{fontSize:"small"})})}),(0,pe.jsx)(h.A,{title:"Cancel editing",arrow:!0,children:(0,pe.jsx)(m.A,{color:"error",onClick:()=>{ho(null),Ao("")},sx:{bgcolor:"error.main",color:"white","&:hover":{bgcolor:"error.dark"},width:{xs:36,md:40},height:{xs:36,md:40}},children:(0,pe.jsx)(X.A,{fontSize:"small"})})})]})]})]},r)))})]})})})]}),(0,pe.jsx)(C.A,{anchorEl:Ee,open:Boolean(Ee),onClose:Ro,children:Ce?(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsxs)(k.A,{onClick:()=>{Te(!0),Ro()},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)($.A,{fontSize:"small"})}),"Invite People"]}),(0,pe.jsxs)(k.A,{onClick:()=>{Mr(!0),(async()=>{if(fe&&fe.members)try{const e=await Promise.all(fe.members.map((async e=>{const r=(0,ae.H9)(de.db,"users",e),o=await(0,ae.x7)(r);if(o.exists()){const r=o.data();return{id:e,username:r.username||"Unknown user",name:r.name,profilePic:r.profilePic}}return null})));Zr(e.filter(Boolean))}catch(e){console.error("Error fetching room members:",e),nr("Failed to load room members"),ir("error"),rr(!0)}})(),Ro()},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)($.A,{fontSize:"small"})}),"Members"]}),(0,pe.jsxs)(k.A,{onClick:async()=>{if(fe&&Ce)try{const e=!fe.locked,r=(0,ae.H9)(de.db,"rooms",o);await(0,ae.mZ)(r,{locked:e}),be((0,n.A)((0,n.A)({},fe),{},{locked:e})),nr("Room ".concat(e?"locked":"unlocked")),ir("success"),rr(!0),Ro()}catch(e){console.error("Error toggling room lock:",e),nr("Failed to update room settings"),ir("error"),rr(!0)}},children:[(0,pe.jsx)(S.A,{children:null!==fe&&void 0!==fe&&fe.locked?(0,pe.jsx)(ee.A,{fontSize:"small"}):(0,pe.jsx)(L.A,{fontSize:"small"})}),null!==fe&&void 0!==fe&&fe.locked?"Unlock Room":"Lock Room"]}),(null===fe||void 0===fe?void 0:fe.locked)&&(null===fe||void 0===fe?void 0:fe.pendingRequests)&&fe.pendingRequests.length>0&&(0,pe.jsxs)(k.A,{onClick:async()=>{if(fe&&Ce)try{if(fe.pendingRequests&&fe.pendingRequests.length>0){const e=await Promise.all(fe.pendingRequests.map((async e=>{const r=(0,ae.H9)(de.db,"users",e),o=await(0,ae.x7)(r);if(o.exists()){const r=o.data();return{id:e,username:r.username||"Unknown user",profilePic:r.profilePic}}return null})));Tr(e.filter(Boolean))}else Tr([]);qr(!0)}catch(e){console.error("Error fetching pending requests:",e),nr("Failed to load join requests"),ir("error"),rr(!0)}},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)($.A,{fontSize:"small"})}),"View Join Requests",(0,pe.jsx)(R.A,{color:"primary",badgeContent:fe.pendingRequests.length,sx:{ml:1}})]}),(0,pe.jsxs)(k.A,{onClick:()=>{Me(!0),Ro()},sx:{color:"error.main"},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(Q.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]}):(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsxs)(k.A,{onClick:()=>{nr("Room reported to moderators"),ir("info"),rr(!0),Ro()},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(re.A,{fontSize:"small"})}),"Report Room"]}),(0,pe.jsxs)(k.A,{onClick:async()=>{if(fe&&s)try{const e=(0,ae.H9)(de.db,"rooms",o);await(0,ae.mZ)(e,{members:fe.members.filter((e=>e!==s.uid))}),Ae("/messages"),ce.oR.success("You left the room")}catch(e){console.error("Error leaving room:",e),ce.oR.error("Failed to leave room")}},sx:{color:"error.main"},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(oe.A,{fontSize:"small",color:"error"})}),"Leave Room"]})]})}),(0,pe.jsxs)(E.A,{open:Be,onClose:()=>Te(!1),maxWidth:"sm",fullWidth:!0,children:[(0,pe.jsx)(I.A,{children:"Invite People to Room"}),(0,pe.jsxs)(z.A,{children:[(0,pe.jsx)(P.A,{sx:{mb:2},children:"Search for users to add to this room."}),(0,pe.jsxs)(l.A,{sx:{display:"flex",mb:2},children:[(0,pe.jsx)(y.A,{fullWidth:!0,label:"Search by username",variant:"outlined",value:Qe,onChange:e=>Ke(e.target.value),onKeyPress:e=>"Enter"===e.key&&zo(),sx:{mr:1}}),(0,pe.jsx)(w.A,{variant:"contained",onClick:zo,children:"Search"})]}),Xe.length>0?(0,pe.jsx)(j.A,{children:Xe.map((e=>(0,pe.jsxs)(g.Ay,{secondaryAction:(0,pe.jsx)(w.A,{variant:"outlined",size:"small",startIcon:(0,pe.jsx)(ne.A,{}),onClick:()=>(async e=>{if(fe&&s)try{const r=(0,ae.H9)(de.db,"rooms",o);await(0,ae.mZ)(r,{members:[...fe.members,e]});const n=(0,ae.rJ)(de.db,"notifications");await(0,ae.gS)(n,{type:"room_invite",from:s.uid,to:e,roomId:o,roomName:fe.name,read:!1,timestamp:(0,ae.O5)()}),$e((r=>r.filter((r=>r.id!==e)))),nr("User invited to room"),ir("success"),rr(!0)}catch(r){console.error("Error inviting user:",r),ce.oR.error("Failed to invite user")}})(e.id),children:"Invite"}),children:[(0,pe.jsx)(v.A,{children:(0,pe.jsxs)(l.A,{sx:{position:"relative"},children:[(0,pe.jsx)(f.A,{alt:e.username,src:e.profilePic}),(0,pe.jsx)(l.A,{sx:{position:"absolute",bottom:4,right:4,zIndex:1},children:(0,pe.jsx)(H.A,{isOnline:ve(e.id),size:"small"})})]})}),(0,pe.jsx)(N.A,{primary:e.name||e.username,secondary:"@".concat(e.username)})]},e.id)))}):Qe?(0,pe.jsxs)(u.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:['No users found matching "',Qe,'"']}):null]}),(0,pe.jsx)(W.A,{children:(0,pe.jsx)(w.A,{onClick:()=>Te(!1),children:"Close"})})]}),(0,pe.jsxs)(E.A,{open:_e,onClose:()=>Me(!1),children:[(0,pe.jsx)(I.A,{children:"Delete Room?"}),(0,pe.jsx)(z.A,{children:(0,pe.jsx)(P.A,{children:"Are you sure you want to delete this room? This action cannot be undone and all messages will be permanently deleted."})}),(0,pe.jsxs)(W.A,{children:[(0,pe.jsx)(w.A,{onClick:()=>Me(!1),children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(Ce&&o)try{we(!0);const e=(0,ae.rJ)(de.db,"rooms",o,"messages"),r=(await(0,ae.GG)(e)).docs.map((e=>(0,ae.kd)(e.ref)));await Promise.all(r),await(0,ae.kd)((0,ae.H9)(de.db,"rooms",o)),Ae("/messages"),ce.oR.success("Room deleted")}catch(e){console.error("Error deleting room:",e),ce.oR.error("Failed to delete room"),we(!1)}},color:"error",variant:"contained",children:"Delete"})]})]}),(0,pe.jsxs)(E.A,{open:Le,onClose:()=>Ze(!1),maxWidth:"sm",fullWidth:!0,children:[(0,pe.jsx)(I.A,{children:"Create Poll"}),(0,pe.jsxs)(z.A,{children:[(0,pe.jsx)(y.A,{autoFocus:!0,margin:"dense",label:"Poll Question",fullWidth:!0,variant:"outlined",value:Ge,onChange:e=>Je(e.target.value),sx:{mb:3}}),(0,pe.jsx)(u.A,{variant:"subtitle2",gutterBottom:!0,children:"Options"}),Ye.map(((e,r)=>(0,pe.jsx)(y.A,{margin:"dense",label:"Option ".concat(r+1),fullWidth:!0,variant:"outlined",value:e.text,onChange:e=>((e,r)=>{const o=[...Ye];o[e].text=r,Ve(o)})(r,e.target.value),sx:{mb:1}},r))),(0,pe.jsx)(w.A,{variant:"outlined",startIcon:(0,pe.jsx)(ne.A,{}),onClick:()=>{Ve([...Ye,{text:""}])},sx:{mt:1},children:"Add Option"})]}),(0,pe.jsxs)(W.A,{children:[(0,pe.jsx)(w.A,{onClick:()=>Ze(!1),children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(!Ge.trim()||!s||!Ce)return;const e=Ye.map((e=>e.text.trim())).filter(Boolean);if(e.length<2)return nr("A poll needs at least 2 options"),ir("error"),void rr(!0);try{const r=(0,ae.rJ)(de.db,"rooms",o,"messages");await(0,ae.gS)(r,{text:Ge.trim(),sender:s.uid,senderName:lr.name||lr.username||s.displayName||"User",senderPhoto:lr.profilePic||s.photoURL||"",timestamp:(0,ae.O5)(),type:"poll",pollOptions:e,pollVotes:{}}),await To("room_poll",'\ud83d\udcca New poll in "'.concat(null===fe||void 0===fe?void 0:fe.name,'": ').concat(Ge.trim().substring(0,80)).concat(Ge.trim().length>80?"...":""),{postId:null}),Je(""),Ve([{text:""},{text:""}]),Ze(!1),nr("Poll created"),ir("success"),rr(!0)}catch(r){console.error("Error creating poll:",r),ce.oR.error("Failed to create poll")}},variant:"contained",disabled:!Ge.trim()||Ye.filter((e=>e.text.trim())).length<2,children:"Create Poll"})]})]}),(0,pe.jsxs)(E.A,{open:mr,onClose:()=>{ur(!1),cr(null)},children:[(0,pe.jsx)(I.A,{children:"Delete Message?"}),(0,pe.jsxs)(z.A,{children:[(0,pe.jsx)(P.A,{children:"Are you sure you want to delete this message? This action cannot be undone."}),dr&&(0,pe.jsx)(c.A,{elevation:0,sx:{p:2,mt:2,bgcolor:"background.default"},children:(0,pe.jsx)(u.A,{variant:"body1",children:dr.text})})]}),(0,pe.jsxs)(W.A,{children:[(0,pe.jsx)(w.A,{onClick:()=>{ur(!1),cr(null)},children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(!dr||!s||dr.sender!==s.uid)return ur(!1),void cr(null);try{const e=(0,ae.H9)(de.db,"rooms",o,"messages",dr.id);await(0,ae.kd)(e),nr("Message deleted"),ir("success"),rr(!0)}catch(e){console.error("Error deleting message:",e),nr("Failed to delete message"),ir("error"),rr(!0)}finally{ur(!1),cr(null)}},color:"error",startIcon:(0,pe.jsx)(se.A,{}),children:"Delete"})]})]}),(0,pe.jsx)(F.Ay,{open:fr,onClose:()=>br(!1),anchorReference:"anchorPosition",anchorPosition:{top:window.innerHeight-300,left:window.innerWidth/2},transformOrigin:{vertical:"bottom",horizontal:"center"},children:(0,pe.jsx)(l.A,{sx:{p:1,width:"300px",maxWidth:"90vw",height:"200px",overflow:"auto",display:"flex",flexWrap:"wrap",justifyContent:"center"},children:["\ud83d\ude00","\ud83d\ude01","\ud83d\ude02","\ud83e\udd23","\ud83d\ude03","\ud83d\ude04","\ud83d\ude05","\ud83d\ude06","\ud83d\ude09","\ud83d\ude0a","\ud83d\ude0b","\ud83d\ude0e","\ud83d\ude0d","\ud83e\udd70","\ud83d\ude18","\ud83d\ude17","\ud83d\ude19","\ud83d\ude1a","\ud83d\ude42","\ud83e\udd17","\ud83e\udd14","\ud83e\udd28","\ud83d\ude10","\ud83d\ude11","\ud83d\ude36","\ud83d\ude44","\ud83d\ude0f","\ud83d\ude23","\ud83d\ude25","\ud83d\ude2e","\ud83d\udc4d","\ud83d\udc4e","\ud83d\udc4c","\u270c\ufe0f","\ud83e\udd1e","\ud83e\udd1f","\ud83e\udd18","\ud83d\udc4a","\ud83d\udc4b","\ud83d\ude4c","\u2764\ufe0f","\ud83d\udc94","\ud83d\udc96","\ud83d\udc99","\ud83d\ude22","\ud83d\ude2d","\ud83d\ude24","\ud83d\ude20","\ud83d\ude21","\ud83e\udd2c"].map((e=>(0,pe.jsx)(l.A,{component:"button",onClick:()=>{(e=>{Pe((r=>r+e))})(e),br(!1)},sx:{border:"none",background:"none",cursor:"pointer",fontSize:"1.8rem",m:.5,p:.5,borderRadius:"4px",minWidth:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{background:e=>"dark"===e.palette.mode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"}},children:e},e)))})}),(0,pe.jsx)(U.A,{open:er,autoHideDuration:4e3,onClose:()=>rr(!1),children:(0,pe.jsx)(O.A,{onClose:()=>rr(!1),severity:sr,sx:{width:"100%"},children:or})}),(0,pe.jsxs)(C.A,{anchorEl:Cr,open:Boolean(Cr),onClose:Oo,children:[(0,pe.jsxs)(k.A,{onClick:()=>{yr&&(Pr(yr.text),Rr(!0)),Oo()},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(V.A,{fontSize:"small"})}),"Edit Announcement"]}),(0,pe.jsxs)(k.A,{onClick:()=>{Ir(!0),Oo()},sx:{color:"error.main"},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(Q.A,{fontSize:"small",color:"error"})}),"Delete Announcement"]})]}),(0,pe.jsxs)(E.A,{open:Sr,onClose:()=>Rr(!1),fullWidth:!0,maxWidth:"sm",children:[(0,pe.jsx)(I.A,{children:"Edit Announcement"}),(0,pe.jsx)(z.A,{children:(0,pe.jsx)(y.A,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:4,value:zr,onChange:e=>Pr(e.target.value),margin:"dense",variant:"outlined"})}),(0,pe.jsxs)(W.A,{children:[(0,pe.jsx)(w.A,{onClick:()=>Rr(!1),children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(yr&&s&&Ce&&zr.trim())try{const e=(0,ae.H9)(de.db,"rooms",o,"messages",yr.id);await(0,ae.mZ)(e,{text:zr.trim()}),nr("Announcement updated"),ir("success"),rr(!0),Rr(!1)}catch(e){console.error("Error updating announcement:",e),nr("Failed to update announcement"),ir("error"),rr(!0)}},variant:"contained",color:"primary",disabled:!zr.trim(),children:"Save Changes"})]})]}),(0,pe.jsxs)(E.A,{open:Er,onClose:()=>Ir(!1),children:[(0,pe.jsx)(I.A,{children:"Delete Announcement?"}),(0,pe.jsx)(z.A,{children:(0,pe.jsx)(P.A,{children:"Are you sure you want to delete this announcement? This action cannot be undone."})}),(0,pe.jsxs)(W.A,{children:[(0,pe.jsx)(w.A,{onClick:()=>Ir(!1),children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(yr&&s&&Ce)try{const e=(0,ae.H9)(de.db,"rooms",o,"messages",yr.id);await(0,ae.kd)(e),nr("Announcement deleted"),ir("success"),rr(!0),Ir(!1),wr(null)}catch(e){console.error("Error deleting announcement:",e),nr("Failed to delete announcement"),ir("error"),rr(!0)}},color:"error",variant:"contained",children:"Delete"})]})]}),(0,pe.jsxs)(E.A,{open:Or,onClose:()=>Hr(!1),children:[(0,pe.jsx)(I.A,{children:"Delete Poll?"}),(0,pe.jsx)(z.A,{children:(0,pe.jsx)(P.A,{children:"Are you sure you want to delete this poll? This action cannot be undone."})}),(0,pe.jsxs)(W.A,{children:[(0,pe.jsx)(w.A,{onClick:()=>Hr(!1),children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(Fr&&s&&Ce)try{const e=(0,ae.H9)(de.db,"rooms",o,"messages",Fr.id);await(0,ae.kd)(e),nr("Poll deleted"),ir("success"),rr(!0),Hr(!1),Ur(null)}catch(e){console.error("Error deleting poll:",e),nr("Failed to delete poll"),ir("error"),rr(!0)}},color:"error",variant:"contained",children:"Delete"})]})]}),(0,pe.jsx)(C.A,{anchorEl:Nr,open:Boolean(Nr),onClose:Ho,children:(0,pe.jsxs)(k.A,{onClick:()=>{Hr(!0),Ho()},sx:{color:"error.main"},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(Q.A,{fontSize:"small",color:"error"})}),"Delete Poll"]})}),(0,pe.jsx)(F.Ay,{open:Boolean(bo.anchorEl),anchorEl:bo.anchorEl,onClose:Do,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:(0,pe.jsx)(l.A,{sx:{p:1,display:"flex",flexWrap:"wrap",maxWidth:"300px"},children:[{emoji:"\ud83d\udc4d",label:"Like"},{emoji:"\u2764\ufe0f",label:"Love"},{emoji:"\ud83d\ude00",label:"Happy"},{emoji:"\ud83d\ude14",label:"Sad"},{emoji:"\ud83d\udc40",label:"Eyes"},{emoji:"\ud83d\udd25",label:"Fire"},{emoji:"\ud83c\udf89",label:"Celebration"},{emoji:"\ud83e\udd14",label:"Thinking"}].map((e=>(0,pe.jsx)(m.A,{onClick:()=>(async e=>{if(bo.message&&null!==s&&void 0!==s&&s.uid&&o)try{const r=bo.message.id,i=(0,ae.H9)(de.db,"rooms",o,"messages",r),t=bo.message.reactions||[],l=t.findIndex((r=>r.userId===s.uid&&r.emoji===e));if(-1!==l){const e=[...t];e.splice(l,1),await(0,ae.mZ)(i,{reactions:e}),"chat"===bo.message.type?Ue((o=>o.map((o=>o.id===r?(0,n.A)((0,n.A)({},o),{},{reactions:e}):o)))):"announcement"===bo.message.type&&He((o=>o.map((o=>o.id===r?(0,n.A)((0,n.A)({},o),{},{reactions:e}):o))))}else{const o={emoji:e,userId:s.uid,username:s.displayName||""},l=[...t,o];await(0,ae.mZ)(i,{reactions:l}),"chat"===bo.message.type?Ue((e=>e.map((e=>e.id===r?(0,n.A)((0,n.A)({},e),{},{reactions:l}):e)))):"announcement"===bo.message.type&&He((e=>e.map((e=>e.id===r?(0,n.A)((0,n.A)({},e),{},{reactions:l}):e))))}Do()}catch(r){console.error("Error adding reaction:",r),nr("Failed to add reaction"),ir("error"),rr(!0),Do()}})(e.emoji),sx:{m:.5,"&:hover":{bgcolor:"rgba(0,0,0,0.04)"}},"aria-label":e.label,children:(0,pe.jsx)(u.A,{variant:"body1",sx:{fontSize:"1.4rem"},children:e.emoji})},e.emoji)))})}),(0,pe.jsx)(F.Ay,{open:Boolean(wo.anchorEl),anchorEl:wo.anchorEl,onClose:qo,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:(0,pe.jsxs)(l.A,{sx:{p:2,maxWidth:"250px"},children:[(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5,pb:1,borderBottom:1,borderColor:"divider"},children:[(0,pe.jsxs)(u.A,{variant:"h6",sx:{display:"flex",alignItems:"center"},children:[(0,pe.jsx)(l.A,{component:"span",sx:{fontSize:"1.6rem",mr:1},children:wo.emoji}),"Reactions"]}),wo.message&&wo.emoji&&(null===(e=wo.message.reactions)||void 0===e?void 0:e.some((e=>e.emoji===wo.emoji&&e.userId===(null===s||void 0===s?void 0:s.uid))))&&(0,pe.jsx)(w.A,{variant:"outlined",color:"error",size:"small",onClick:()=>{var e;return(async(e,r)=>{if(null!==s&&void 0!==s&&s.uid&&o)try{const i=(0,ae.H9)(de.db,"rooms",o,"messages",e),t=await(0,ae.x7)(i);if(!t.exists())return nr("Message not found"),ir("error"),void rr(!0);const l=t.data(),a=(l.reactions||[]).filter((e=>!(e.userId===s.uid&&e.emoji===r)));await(0,ae.mZ)(i,{reactions:a}),"chat"===l.type?Ue((r=>r.map((r=>r.id===e?(0,n.A)((0,n.A)({},r),{},{reactions:a}):r)))):"announcement"===l.type&&He((r=>r.map((r=>r.id===e?(0,n.A)((0,n.A)({},r),{},{reactions:a}):r)))),qo()}catch(i){console.error("Error removing reaction:",i),nr("Failed to remove reaction"),ir("error"),rr(!0)}})((null===(e=wo.message)||void 0===e?void 0:e.id)||"",wo.emoji||"")},children:"Remove"})]}),(0,pe.jsx)(j.A,{sx:{py:0},children:wo.message&&wo.emoji&&(null===(r=wo.message.reactions)||void 0===r?void 0:r.filter((e=>e.emoji===wo.emoji)).map(((e,r)=>(0,pe.jsx)(g.Ay,{sx:{py:.5,px:1,borderRadius:1,my:.3,bgcolor:e.userId===(null===s||void 0===s?void 0:s.uid)?"rgba(25, 118, 210, 0.15)":"transparent"},children:(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,pe.jsxs)(u.A,{children:[e.username||"User",e.userId===(null===s||void 0===s?void 0:s.uid)&&(0,pe.jsx)(u.A,{component:"span",color:"text.secondary",sx:{ml:.5,fontSize:"0.8rem"},children:"(you)"})]}),(0,pe.jsx)(u.A,{fontSize:"1.2rem",children:e.emoji})]})},"".concat(e.userId,"-").concat(r)))))})]})}),(0,pe.jsxs)(E.A,{open:Dr,onClose:()=>qr(!1),maxWidth:"sm",fullWidth:!0,children:[(0,pe.jsx)(I.A,{children:"Join Requests"}),(0,pe.jsx)(z.A,{children:0===Br.length?(0,pe.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No pending join requests"}):(0,pe.jsx)(j.A,{children:Br.map((e=>(0,pe.jsxs)(g.Ay,{secondaryAction:(0,pe.jsxs)(l.A,{children:[(0,pe.jsx)(w.A,{variant:"outlined",color:"primary",size:"small",onClick:()=>(async e=>{if(fe&&Ce)try{const r=(0,ae.H9)(de.db,"rooms",o),i=(fe.pendingRequests||[]).filter((r=>r!==e)),t=[...fe.members,e];await(0,ae.mZ)(r,{pendingRequests:i,members:t}),be((0,n.A)((0,n.A)({},fe),{},{pendingRequests:i,members:t})),Tr((r=>r.filter((r=>r.id!==e))));const l=(0,ae.rJ)(de.db,"notifications");await(0,ae.gS)(l,{type:"room_join_approved",senderId:null===s||void 0===s?void 0:s.uid,senderName:lr.name||lr.username||(null===s||void 0===s?void 0:s.displayName)||"Room owner",senderAvatar:lr.profilePic||(null===s||void 0===s?void 0:s.photoURL)||"",recipientId:e,content:'Your request to join "'.concat(fe.name,'" has been approved'),roomId:o,roomName:fe.name,isRead:!1,createdAt:(0,ae.O5)()}),nr("Join request approved"),ir("success"),rr(!0)}catch(r){console.error("Error approving join request:",r),nr("Failed to approve join request"),ir("error"),rr(!0)}})(e.id),sx:{mr:1},children:"Approve"}),(0,pe.jsx)(w.A,{variant:"outlined",color:"error",size:"small",onClick:()=>(async e=>{if(fe&&Ce)try{const r=(0,ae.H9)(de.db,"rooms",o),i=(fe.pendingRequests||[]).filter((r=>r!==e));await(0,ae.mZ)(r,{pendingRequests:i}),be((0,n.A)((0,n.A)({},fe),{},{pendingRequests:i})),Tr((r=>r.filter((r=>r.id!==e))));const t=(0,ae.rJ)(de.db,"notifications");await(0,ae.gS)(t,{type:"room_join_rejected",senderId:null===s||void 0===s?void 0:s.uid,senderName:lr.name||lr.username||(null===s||void 0===s?void 0:s.displayName)||"Room owner",senderAvatar:lr.profilePic||(null===s||void 0===s?void 0:s.photoURL)||"",recipientId:e,content:'Your request to join "'.concat(fe.name,'" has been declined'),roomId:o,roomName:fe.name,isRead:!1,createdAt:(0,ae.O5)()}),nr("Join request declined"),ir("info"),rr(!0)}catch(r){console.error("Error rejecting join request:",r),nr("Failed to decline join request"),ir("error"),rr(!0)}})(e.id),children:"Decline"})]}),children:[(0,pe.jsx)(v.A,{children:(0,pe.jsx)(f.A,{alt:e.username,src:e.profilePic})}),(0,pe.jsx)(N.A,{primary:e.username,secondary:"Wants to join this room"})]},e.id)))})}),(0,pe.jsx)(W.A,{children:(0,pe.jsx)(w.A,{onClick:()=>qr(!1),children:"Close"})})]}),(0,pe.jsxs)(E.A,{open:_r,onClose:()=>Mr(!1),maxWidth:"sm",fullWidth:!0,children:[(0,pe.jsx)(I.A,{children:"Room Members"}),(0,pe.jsx)(z.A,{children:0===Lr.length?(0,pe.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No members found"}):(0,pe.jsx)(j.A,{children:Lr.map((e=>(0,pe.jsxs)(g.Ay,{secondaryAction:e.id!==(null===s||void 0===s?void 0:s.uid)&&(0,pe.jsx)(m.A,{edge:"end",onClick:r=>((e,r)=>{e.stopPropagation(),Jr(e.currentTarget),Vr(r)})(r,e),children:(0,pe.jsx)(B.A,{})}),sx:{cursor:"pointer",opacity:eo.includes(e.id)?.5:1,"&:hover":{backgroundColor:"action.hover"}},onClick:()=>(e=>{Ae("/profile/".concat(e.id))})(e),children:[(0,pe.jsx)(v.A,{children:(0,pe.jsxs)(l.A,{sx:{position:"relative"},children:[(0,pe.jsx)(f.A,{alt:e.username,src:e.profilePic}),(0,pe.jsx)(l.A,{sx:{position:"absolute",bottom:4,right:4,zIndex:1},children:(0,pe.jsx)(H.A,{isOnline:ve(e.id),size:"small"})})]})}),(0,pe.jsx)(N.A,{primary:(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.name||e.username,eo.includes(e.id)&&(0,pe.jsx)(b.A,{label:"Blocked",size:"small",color:"error",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]}),secondary:"@".concat(e.username)})]},e.id)))})}),(0,pe.jsx)(W.A,{children:(0,pe.jsx)(w.A,{onClick:()=>Mr(!1),children:"Close"})})]}),(0,pe.jsxs)(C.A,{anchorEl:Gr,open:Boolean(Gr),onClose:Bo,children:[Ce&&Yr&&Yr.id!==(null===s||void 0===s?void 0:s.uid)&&(0,pe.jsxs)(k.A,{onClick:async()=>{if(Yr&&fe&&Ce)try{const e=(0,ae.H9)(de.db,"rooms",o),r=fe.members.filter((e=>e!==Yr.id));await(0,ae.mZ)(e,{members:r}),be((0,n.A)((0,n.A)({},fe),{},{members:r})),Zr((e=>e.filter((e=>e.id!==Yr.id))));const i=(0,ae.rJ)(de.db,"notifications");await(0,ae.gS)(i,{type:"room_removed",senderId:null===s||void 0===s?void 0:s.uid,senderName:lr.name||lr.username||(null===s||void 0===s?void 0:s.displayName)||"Room owner",senderAvatar:lr.profilePic||(null===s||void 0===s?void 0:s.photoURL)||"",recipientId:Yr.id,content:'You have been removed from "'.concat(fe.name,'"'),roomId:o,roomName:fe.name,isRead:!1,createdAt:(0,ae.O5)()}),nr("Member removed from room"),ir("success"),rr(!0),Bo()}catch(e){console.error("Error removing member:",e),nr("Failed to remove member"),ir("error"),rr(!0)}},sx:{color:"error.main"},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(Q.A,{fontSize:"small",color:"error"})}),"Remove from Room"]}),Yr&&Yr.id!==(null===s||void 0===s?void 0:s.uid)&&(0,pe.jsxs)(k.A,{onClick:()=>{Yr&&(nr("Reported ".concat(Yr.username)),ir("info"),rr(!0),Bo())},sx:{color:"warning.main"},children:[(0,pe.jsx)(S.A,{children:(0,pe.jsx)(re.A,{fontSize:"small",color:"warning"})}),"Report User"]})]}),(0,pe.jsxs)(E.A,{open:Qr,onClose:()=>Kr(!1),maxWidth:"sm",fullWidth:!0,children:[(0,pe.jsx)(I.A,{children:(0,pe.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,pe.jsx)(f.A,{src:null===Xr||void 0===Xr?void 0:Xr.profilePic,alt:null===Xr||void 0===Xr?void 0:Xr.username,sx:{width:64,height:64}}),(0,pe.jsxs)(l.A,{children:[(0,pe.jsx)(u.A,{variant:"h6",children:(null===Xr||void 0===Xr?void 0:Xr.name)||(null===Xr||void 0===Xr?void 0:Xr.username)}),(0,pe.jsxs)(u.A,{variant:"subtitle2",color:"text.secondary",children:["@",null===Xr||void 0===Xr?void 0:Xr.username]})]})]})}),(0,pe.jsx)(z.A,{children:(0,pe.jsx)(l.A,{sx:{mt:2},children:Xr&&eo.includes(Xr.id)?(0,pe.jsx)(w.A,{variant:"outlined",color:"primary",fullWidth:!0,onClick:async()=>{if(s&&Xr)try{const e=(0,ae.H9)(de.db,"users",s.uid),r=eo.filter((e=>e!==Xr.id));await(0,ae.mZ)(e,{blockedUsers:r}),ro(r),nr("Unblocked ".concat(Xr.username)),ir("success"),rr(!0),Kr(!1)}catch(e){console.error("Error unblocking user:",e),nr("Failed to unblock user"),ir("error"),rr(!0)}},startIcon:(0,pe.jsx)($.A,{}),children:"Unblock User"}):(0,pe.jsx)(w.A,{variant:"outlined",color:"error",fullWidth:!0,onClick:async()=>{if(s&&Xr)try{const e=(0,ae.H9)(de.db,"users",s.uid),r=[...eo,Xr.id];await(0,ae.mZ)(e,{blockedUsers:r}),ro(r),nr("Blocked ".concat(Xr.username)),ir("success"),rr(!0),Kr(!1),null!==fe&&void 0!==fe&&fe.members.includes(Xr.id)&&(io(Xr),no(!0))}catch(e){console.error("Error blocking user:",e),nr("Failed to block user"),ir("error"),rr(!0)}},startIcon:(0,pe.jsx)(ie.A,{}),children:"Block User"})})}),(0,pe.jsx)(W.A,{children:(0,pe.jsx)(w.A,{onClick:()=>Kr(!1),children:"Close"})})]}),(0,pe.jsxs)(E.A,{open:ao,onClose:()=>co(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{m:{xs:1,md:2},maxHeight:{xs:"90vh",md:"none"}}},children:[(0,pe.jsx)(I.A,{sx:{fontSize:{xs:"1.1rem",md:"1.25rem"},pb:{xs:1,md:2}},children:"Add New Rule"}),(0,pe.jsxs)(z.A,{sx:{px:{xs:2,md:3}},children:[(0,pe.jsx)(P.A,{sx:{mb:2,fontSize:{xs:"0.875rem",md:"1rem"}},children:"Add a new rule to help maintain a positive environment in your room."}),(0,pe.jsx)(y.A,{autoFocus:!0,margin:"dense",label:"Rule",fullWidth:!0,variant:"outlined",multiline:!0,rows:So?3:2,value:mo,onChange:e=>uo(e.target.value),placeholder:"Enter a clear and specific rule...",size:So?"medium":"small"})]}),(0,pe.jsxs)(W.A,{sx:{px:{xs:2,md:3},pb:{xs:2,md:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[(0,pe.jsx)(w.A,{onClick:()=>{co(!1),uo("")},size:So?"medium":"small",sx:{order:{xs:2,sm:1},width:{xs:"100%",sm:"auto"}},children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(mo.trim()&&Ce&&o)try{const e=[...to,mo.trim()],r=(0,ae.H9)(de.db,"rooms",o);await(0,ae.mZ)(r,{rules:e}),lo(e),uo(""),co(!1),nr("Rule added successfully"),ir("success"),rr(!0)}catch(e){console.error("Error adding rule:",e),nr("Failed to add rule"),ir("error"),rr(!0)}},variant:"contained",disabled:!mo.trim(),size:So?"medium":"small",sx:{order:{xs:1,sm:2},width:{xs:"100%",sm:"auto"}},children:"Add Rule"})]})]}),(0,pe.jsxs)(E.A,{open:jo,onClose:()=>go(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{m:{xs:1,md:2},maxHeight:{xs:"90vh",md:"none"}}},children:[(0,pe.jsx)(I.A,{sx:{fontSize:{xs:"1.1rem",md:"1.25rem"},pb:{xs:1,md:2}},children:"Delete Rule?"}),(0,pe.jsxs)(z.A,{sx:{px:{xs:2,md:3}},children:[(0,pe.jsx)(P.A,{sx:{fontSize:{xs:"0.875rem",md:"1rem"}},children:"Are you sure you want to delete this rule? This action cannot be undone."}),null!==vo&&to[vo]&&(0,pe.jsxs)(c.A,{elevation:0,sx:{p:{xs:1.5,md:2},mt:2,bgcolor:"background.default"},children:[(0,pe.jsxs)(u.A,{variant:"subtitle2",sx:{mb:1,color:"primary.main",fontSize:{xs:"0.8rem",md:"0.875rem"}},children:["Rule #",vo+1]}),(0,pe.jsx)(u.A,{variant:"body2",sx:{fontSize:{xs:"0.875rem",md:"1rem"}},children:to[vo]})]})]}),(0,pe.jsxs)(W.A,{sx:{px:{xs:2,md:3},pb:{xs:2,md:2},flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:0}},children:[(0,pe.jsx)(w.A,{onClick:()=>{go(!1),fo(null)},size:So?"medium":"small",sx:{order:{xs:2,sm:1},width:{xs:"100%",sm:"auto"}},children:"Cancel"}),(0,pe.jsx)(w.A,{onClick:async()=>{if(null!==vo&&Ce&&o)try{const e=to.filter(((e,r)=>r!==vo)),r=(0,ae.H9)(de.db,"rooms",o);await(0,ae.mZ)(r,{rules:e}),lo(e),fo(null),go(!1),nr("Rule deleted successfully"),ir("success"),rr(!0)}catch(e){console.error("Error deleting rule:",e),nr("Failed to delete rule"),ir("error"),rr(!0)}},color:"error",variant:"contained",size:So?"medium":"small",sx:{order:{xs:1,sm:2},width:{xs:"100%",sm:"auto"}},children:"Delete Rule"})]})]}),(0,pe.jsx)(U.A,{open:oo,autoHideDuration:6e3,onClose:()=>no(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,pe.jsx)(O.A,{onClose:()=>no(!1),severity:"warning",sx:{width:"100%"},children:so&&(0,pe.jsxs)(pe.Fragment,{children:["You have blocked ",so.username,". You can unblock them from their profile."]})})})]})}}}]);