"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[3],{3003:(e,o,n)=>{n.r(o),n.d(o,{default:()=>Y});var r=n(9950),t=n(8429),a=n(9808),s=n(2235),i=n(2053),l=n(3174),c=n(6491),d=n(4745),u=n(226),h=n(6583),g=n(33),m=n(8170),x=n(6493),y=n(9739),w=n(6639),f=n(8145),A=n(3235),p=n(4414);const j=(0,A.A)([(0,p.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,p.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber"),b=(0,A.A)((0,p.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),v=(0,A.A)((0,p.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");var k=n(1367),C=n(6220),D=n(4950),I=n(330),P=n(5887);const Y=()=>{const{currentUser:e,logout:o}=(0,k.As)(),n=(0,t.Zp)(),[A,Y]=(0,r.useState)(!1),[R,S]=(0,r.useState)(!1),[z,H]=(0,r.useState)(!1),[M,F]=(0,r.useState)(""),[G,U]=(0,r.useState)(!1),[E,W]=(0,r.useState)(null),[Z,T]=(0,r.useState)(null),B=async e=>{try{T("Processing side rooms created by you...");const o=(0,C.P)((0,C.rJ)(I.db,"sideRooms"),(0,C._M)("ownerId","==",e)),n=await(0,C.GG)(o);for(const e of n.docs)console.log("Marking room ".concat(e.id," as deleted")),await(0,C.mZ)((0,C.H9)(I.db,"sideRooms",e.id),{deleted:!0,deletedAt:(new Date).toISOString(),deletedBy:"account-deletion"});T("Removing you from all side rooms...");const r=(0,C.P)((0,C.rJ)(I.db,"sideRooms")),t=await(0,C.GG)(r);for(const c of t.docs){const o=c.data();if(o.viewers&&Array.isArray(o.viewers)){if(o.viewers.some((o=>o.userId===e))){console.log("Removing user from room ".concat(c.id," viewers"));const n=o.viewers.filter((o=>o.userId!==e));await(0,C.mZ)((0,C.H9)(I.db,"sideRooms",c.id),{viewers:n,viewerCount:Math.max(0,(o.viewerCount||0)-1)})}}}T("Updating follower relationships...");const a=(0,C.rJ)(I.db,"users",e,"following"),s=await(0,C.GG)(a);for(const c of s.docs){const o=c.id;console.log("Processing followed user: ".concat(o));try{const n=(0,C.H9)(I.db,"users",o,"followers",e);await(0,C.kd)(n),console.log("Deleted follower document: users/".concat(o,"/followers/").concat(e));const r=(0,C.H9)(I.db,"users",o),t=await(0,C.x7)(r);if(t.exists()){const n=t.data();if(n.followers&&Array.isArray(n.followers)){const t=n.followers.filter((o=>o!==e));await(0,C.mZ)(r,{followers:t}),console.log("Updated followers array for user ".concat(o))}}}catch(E){console.error("Error updating followed user ".concat(o,":"),E)}}T("Updating following relationships...");const i=(0,C.rJ)(I.db,"users",e,"followers"),l=await(0,C.GG)(i);for(const c of l.docs){const o=c.id;console.log("Processing follower: ".concat(o));try{const n=(0,C.H9)(I.db,"users",o,"following",e);await(0,C.kd)(n),console.log("Deleted following document: users/".concat(o,"/following/").concat(e));const r=(0,C.H9)(I.db,"users",o),t=await(0,C.x7)(r);if(t.exists()){const n=t.data();if(n.following&&Array.isArray(n.following)){const t=n.following.filter((o=>o!==e));await(0,C.mZ)(r,{following:t}),console.log("Updated following array for user ".concat(o))}}}catch(E){console.error("Error updating follower ".concat(o,":"),E)}}console.log("User data cleanup completed successfully")}catch(E){throw console.error("Error cleaning up user data:",E),new Error("Failed to clean up user data")}};return(0,p.jsxs)(a.A,{maxWidth:"md",sx:{py:4},children:[(0,p.jsxs)(s.A,{elevation:3,sx:{p:4},children:[(0,p.jsxs)(i.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,p.jsx)(j,{color:"warning"})," Account Management"]}),(0,p.jsx)(l.A,{severity:"info",sx:{mt:2,mb:4},children:"You have the right to control your data. You can deactivate your account temporarily or delete it permanently."}),E&&(0,p.jsx)(l.A,{severity:"error",sx:{mt:2,mb:2},children:E}),(0,p.jsxs)(c.A,{sx:{mb:5},children:[(0,p.jsxs)(i.A,{variant:"h5",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium",display:"flex",alignItems:"center",gap:1},children:[(0,p.jsx)(b,{})," Deactivate Account"]}),(0,p.jsx)(d.A,{sx:{mb:3}}),(0,p.jsx)(i.A,{variant:"body1",paragraph:!0,children:"Deactivating your account will temporarily hide your profile, Side Rooms, and messages from other users. Your account will remain in our systems, and you can reactivate it at any time by simply logging in again."}),(0,p.jsx)(i.A,{variant:"body1",paragraph:!0,children:(0,p.jsx)("strong",{children:"What happens when you deactivate:"})}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Your profile becomes hidden from other users"}),(0,p.jsx)("li",{children:"Your Side Rooms and messages are hidden but not deleted"}),(0,p.jsx)("li",{children:"You won't receive notifications"}),(0,p.jsx)("li",{children:"You can reactivate by logging in at any time"})]}),(0,p.jsx)(u.A,{variant:"outlined",color:"warning",startIcon:(0,p.jsx)(b,{}),onClick:()=>Y(!0),sx:{mt:2},disabled:G,children:"Deactivate Account"})]}),(0,p.jsxs)(c.A,{children:[(0,p.jsxs)(i.A,{variant:"h5",gutterBottom:!0,sx:{color:"error.main",fontWeight:"medium",display:"flex",alignItems:"center",gap:1},children:[(0,p.jsx)(v,{})," Delete Account Permanently"]}),(0,p.jsx)(d.A,{sx:{mb:3}}),(0,p.jsx)(i.A,{variant:"body1",paragraph:!0,children:"Deleting your account is permanent. All your data will be wiped from our systems and cannot be recovered."}),(0,p.jsx)(i.A,{variant:"body1",paragraph:!0,children:(0,p.jsx)("strong",{children:"What happens when you delete your account:"})}),(0,p.jsxs)("ul",{children:[(0,p.jsx)("li",{children:"Your profile, Side Rooms, messages, Sade AI chat history, and all other data are permanently deleted"}),(0,p.jsx)("li",{children:"You will lose access to your account history and connections"}),(0,p.jsx)("li",{children:"This action cannot be undone"}),(0,p.jsx)("li",{children:"If you want to use SideEye again, you'll need to create a new account"})]}),(0,p.jsx)(u.A,{variant:"contained",color:"error",startIcon:(0,p.jsx)(v,{}),onClick:()=>S(!0),sx:{mt:2},disabled:G,children:"Delete Account Permanently"})]})]}),(0,p.jsxs)(h.A,{open:A,onClose:()=>Y(!1),children:[(0,p.jsx)(g.A,{children:"Confirm Account Deactivation"}),(0,p.jsx)(m.A,{children:(0,p.jsx)(x.A,{children:"Are you sure you want to deactivate your account? Your profile and content will be hidden until you log in again."})}),(0,p.jsxs)(y.A,{children:[(0,p.jsx)(u.A,{onClick:()=>Y(!1),disabled:G,children:"Cancel"}),(0,p.jsx)(u.A,{onClick:async()=>{if(e){U(!0),W(null);try{const r=(0,C.H9)(I.db,"users",e.uid);await(0,C.mZ)(r,{isActive:!1,deactivatedAt:(new Date).toISOString()}),await o(),P.oR.success("Your account has been deactivated. You can reactivate it by logging in again."),n("/login")}catch(r){console.error("Error deactivating account:",r),W("Failed to deactivate account. Please try again.")}finally{U(!1),Y(!1)}}else W("You must be logged in to deactivate your account")},color:"warning",disabled:G,startIcon:G?(0,p.jsx)(w.A,{size:20}):null,children:G?"Deactivating...":"Deactivate Account"})]})]}),(0,p.jsxs)(h.A,{open:R,onClose:()=>S(!1),children:[(0,p.jsx)(g.A,{children:"Delete Account"}),(0,p.jsxs)(m.A,{children:[(0,p.jsx)(x.A,{sx:{mb:2},children:"To confirm account deletion, please enter your password. This will permanently delete your account and all associated data."}),(0,p.jsx)(f.A,{autoFocus:!0,margin:"dense",label:"Password",type:"password",fullWidth:!0,value:M,onChange:e=>F(e.target.value),variant:"outlined"})]}),(0,p.jsxs)(y.A,{children:[(0,p.jsx)(u.A,{onClick:()=>S(!1),disabled:G,children:"Cancel"}),(0,p.jsx)(u.A,{onClick:()=>H(!0),color:"error",disabled:G||!M,children:"Proceed"})]})]}),(0,p.jsxs)(h.A,{open:z,onClose:()=>!G&&H(!1),children:[(0,p.jsxs)(g.A,{children:[(0,p.jsx)(j,{color:"error"})," Final Warning"]}),(0,p.jsxs)(m.A,{children:[(0,p.jsxs)(x.A,{children:[(0,p.jsx)("strong",{children:"This action cannot be undone."})," Your account and all your data will be permanently deleted from our servers. Are you absolutely sure you want to proceed?"]}),Z&&G&&(0,p.jsxs)(c.A,{sx:{mt:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,p.jsx)(w.A,{size:24,sx:{mb:1}}),(0,p.jsx)(i.A,{variant:"body2",color:"text.secondary",children:Z})]})]}),(0,p.jsxs)(y.A,{children:[(0,p.jsx)(u.A,{onClick:()=>H(!1),disabled:G,children:"No, Keep My Account"}),(0,p.jsx)(u.A,{onClick:async()=>{const e=(0,D.xI)().currentUser;if(!e)return W("You must be logged in to delete your account"),void P.oR.error("Authentication error. Please log in again.");if(M){U(!0),W(null),T("Authenticating...");try{if(!e.email)throw new Error("User email is not available for re-authentication.");const o=D.IX.credential(e.email,M);await(0,D.kZ)(e,o),console.log("Re-authentication successful"),T("Cleaning up your data..."),await B(e.uid),T("Deleting user profile...");const r=(0,C.H9)(I.db,"users",e.uid);await(0,C.kd)(r),console.log("Firestore user document deleted"),T("Finalizing account deletion..."),await(0,D.hG)(e),console.log("Firebase Auth user deleted"),P.oR.success("Your account has been permanently deleted."),n("/login")}catch(o){console.error("Error deleting account:",o),"auth/wrong-password"===o.code||o.message.includes("auth/wrong-password")?(W("Incorrect password. Please try again."),P.oR.error("Incorrect password.")):"auth/requires-recent-login"===o.code||o.message.includes("auth/requires-recent-login")?(W("This operation requires a recent login. Please log out and log back in before deleting."),P.oR.error("Please log out and log back in to delete your account.")):(W("Failed to delete account: ".concat(o.message||o.code||"Unknown error")),P.oR.error("An error occurred during deletion."))}finally{U(!1),T(null),F(""),E?(H(!0),S(!0)):(H(!1),S(!1))}}else W("Please enter your password to confirm deletion")},color:"error",disabled:G,startIcon:G?(0,p.jsx)(w.A,{size:20}):(0,p.jsx)(v,{}),children:G?"Deleting...":"Yes, Delete Permanently"})]})]})]})}}}]);