"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[682],{379:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(3235),n=s(4414);const o=(0,r.A)((0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},760:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(3235),n=s(4414);const o=(0,r.A)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},1227:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(3235),n=s(4414);const o=(0,r.A)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},2814:(e,t,s)=>{s.d(t,{x:()=>i});var r=s(9950),n=s(6220),o=s(330),a=s(1367);const i=()=>{const{currentUser:e}=(0,a.As)(),[t,s]=(0,r.useState)(new Set);(0,r.useEffect)((()=>{if(null===e||void 0===e||!e.uid)return;const t=async()=>{try{const t=(0,n.H9)(o.db,"users",e.uid);await(0,n.mZ)(t,{lastSeen:(0,n.O5)(),isOnline:!0})}catch(t){console.error("Error updating presence:",t)}};t();const r=setInterval(t,3e4),a=async()=>{try{const t=(0,n.H9)(o.db,"users",e.uid);await(0,n.mZ)(t,{isOnline:!1,lastSeen:(0,n.O5)()})}catch(t){console.error("Error setting offline status:",t)}};window.addEventListener("beforeunload",a);const i=(0,n.rJ)(o.db,"users"),c=(0,n.aQ)(i,(e=>{const t=new Set,r=new Date;e.docs.forEach((e=>{const s=e.data(),n=e.id;if(s.isOnline)t.add(n);else if(s.lastSeen){const e=s.lastSeen.toDate?s.lastSeen.toDate():new Date(s.lastSeen);(r.getTime()-e.getTime())/6e4<2&&t.add(n)}})),s(t)}));return()=>{clearInterval(r),window.removeEventListener("beforeunload",a),c(),a()}}),[null===e||void 0===e?void 0:e.uid]);return{isUserOnline:e=>t.has(e),onlineUsers:t}}},4801:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(3235),n=s(4414);const o=(0,r.A)((0,n.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},6281:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(3235),n=s(4414);const o=(0,r.A)((0,n.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},6493:(e,t,s)=>{s.d(t,{A:()=>b});var r=s(8587),n=s(8168),o=s(9950),a=s(2004),i=s(8465),c=s(9254),l=s(9608),d=s(8463),u=s(2053),m=s(1763),h=s(423);function x(e){return(0,h.Ay)("MuiDialogContentText",e)}(0,m.A)("MuiDialogContentText",["root"]);var p=s(4414);const A=["children","className"],g=(0,c.Ay)(u.A,{shouldForwardProp:e=>(0,l.A)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),b=o.forwardRef((function(e,t){const s=(0,d.b)({props:e,name:"MuiDialogContentText"}),{className:o}=s,c=(0,r.A)(s,A),l=(e=>{const{classes:t}=e,s=(0,i.A)({root:["root"]},x,t);return(0,n.A)({},t,s)})(c);return(0,p.jsx)(g,(0,n.A)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:c,className:(0,a.A)(l.root,o)},s,{classes:l}))}))},7016:(e,t,s)=>{s.d(t,{A:()=>a});s(9950);var r=s(6491),n=s(3274),o=s(4414);const a=e=>{let{isOnline:t,size:s="small",showTooltip:a=!0}=e;const i={small:10,medium:14,large:18},c=(0,o.jsx)(r.A,{sx:{width:i[s],height:i[s],borderRadius:"50%",backgroundColor:t?"#4caf50":"#bdbdbd",border:"2px solid white",boxShadow:"0 0 0 1px rgba(0,0,0,0.1)",transition:"background-color 0.3s ease"}});return a?(0,o.jsx)(n.A,{title:t?"Online":"Offline",placement:"top",children:c}):c}},8682:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ee});var r=s(9379),n=s(45),o=s(9950),a=s(6491),i=s(2053),c=s(226),l=s(249),d=s(6050),u=s(5333),m=s(8614),h=s(4447),x=s(1413),p=s(3563),A=s(4745),g=s(9808),b=s(2235),v=s(8145),j=s(2046),y=s(2236),f=s(4142),w=s(6639),C=s(3174),S=s(7591),k=s(3266),M=s(4195),R=s(6583),E=s(33),P=s(8170),U=s(6493),O=s(9739),z=s(4862),I=s(7016),D=s(2814),N=s(379),L=s(1227),H=s(9885),G=s(6281),W=s(9715),F=s(4801),J=s(3235),B=s(4414);const T=(0,J.A)((0,B.jsx)("path",{d:"M7.58 4.08 6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42m12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42M18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-6 11c.14 0 .27-.01.4-.04.65-.14 1.18-.58 1.44-1.18.1-.24.15-.5.15-.78h-4c.01 1.1.9 2 2.01 2"}),"NotificationsActive");var q=s(3256),_=s(760),V=s(8429),Z=s(1367),Q=s(6220),Y=s(330),K=s(5887);const X=["children","value","index"];function $(e){const{children:t,value:s,index:o}=e,i=(0,n.A)(e,X);return(0,B.jsx)("div",(0,r.A)((0,r.A)({role:"tabpanel",hidden:s!==o,id:"messages-tabpanel-".concat(o),"aria-labelledby":"messages-tab-".concat(o)},i),{},{children:s===o&&(0,B.jsx)(a.A,{sx:{pt:2},children:t})}))}const ee=()=>{const{currentUser:e}=(0,Z.As)(),t=(0,V.Zp)(),{isUserOnline:s}=(0,D.x)(),[n,J]=(0,o.useState)(!0),[X,ee]=(0,o.useState)([]),[te,se]=(0,o.useState)([]),[re,ne]=(0,o.useState)(""),[oe,ae]=(0,o.useState)([]),[ie,ce]=(0,o.useState)(!1),[le,de]=(0,o.useState)(!1),[ue,me]=(0,o.useState)(null),[he,xe]=(0,o.useState)(null),[pe,Ae]=(0,o.useState)(0),[ge,be]=(0,o.useState)([]),[ve,je]=(0,o.useState)([]),[ye,fe]=(0,o.useState)(""),[we,Ce]=(0,o.useState)(!1),[Se,ke]=(0,o.useState)(!1),[Me,Re]=(0,o.useState)(""),[Ee,Pe]=(0,o.useState)(""),[Ue,Oe]=(0,o.useState)(!1),[ze,Ie]=(0,o.useState)([]);(0,o.useEffect)((()=>{if(!e||!Y.db)return;J(!0);const t=(0,Q.rJ)(Y.db,"conversations"),s=(0,Q.P)(t,(0,Q._M)("participants","array-contains",e.uid)),n=(0,Q.aQ)(s,(async t=>{try{const s=(0,Q.rJ)(Y.db,"users"),n=await(0,Q.GG)(s),o=[];n.forEach((t=>{const s=t.data();s.blockedUsers&&Array.isArray(s.blockedUsers)&&s.blockedUsers.includes(e.uid)&&o.push(t.id)}));const a=[...e.blockedUsers||[],...o],i=t.docs.map((e=>{const t=e.data();return(0,r.A)({id:e.id},t)})).filter((t=>{const s=t.participants.find((t=>t!==e.uid));return s&&!a.includes(s)})),c=await Promise.all(i.map((async t=>{const s=t.participants.find((t=>t!==e.uid));if(!s)return t;try{const e=await(0,Q.x7)((0,Q.H9)(Y.db,"users",s));if(e.exists()){const s=e.data();return(0,r.A)((0,r.A)({},t),{},{displayName:s.name||s.username,photoURL:s.profilePic||s.photoURL,status:t.status||"accepted"})}}catch(n){console.error("Error fetching user data:",n)}return t}))),l=c.filter((e=>"pending"!==e.status)),d=c.filter((e=>"pending"===e.status));ee(l),se(d),J(!1)}catch(s){console.error("Error loading conversations:",s),J(!1)}}));return()=>n()}),[e,Y.db]),(0,o.useEffect)((()=>{if(!e||!Y.db)return;(async()=>{try{const t=(0,Q.rJ)(Y.db,"rooms"),s=(0,Q.P)(t,(0,Q._M)("members","array-contains",e.uid)),n=(0,Q.rJ)(Y.db,"rooms"),o=(0,Q.P)(n,(0,Q._M)("type","==","public"));return(0,Q.aQ)(s,(async t=>{const s=t.docs.map((e=>e.id)),n=await(0,Q.GG)(o),a=[...t.docs,...n.docs.filter((e=>!s.includes(e.id)))],i=await Promise.all(a.map((async t=>{const n=t.data();let o="Unknown",a="";try{const e=(0,Q.H9)(Y.db,"users",n.createdBy),t=await(0,Q.x7)(e);if(t.exists()){const e=t.data();o=e.name||e.username||"Unknown",a=e.profilePic||e.photoURL||""}}catch(i){console.error("Error fetching creator data:",i)}return(0,r.A)((0,r.A)({id:t.id},n),{},{creatorName:o,creatorPhoto:a,isOwner:n.createdBy===e.uid,isMember:s.includes(t.id)})})));Ie(i)}))}catch(t){console.error("Error fetching rooms:",t)}})()}),[e,Y.db]);const De=async()=>{if(re.trim()){J(!0);try{const t=re.toLowerCase().trim(),s=(0,Q.rJ)(Y.db,"users"),n=(0,Q.P)(s,(0,Q._M)("username",">=",t),(0,Q._M)("username","<=",t+"\uf8ff"),(0,Q.AB)(10)),o=await(0,Q.GG)(n),a=(0,Q.P)(s,(0,Q._M)("name",">=",re),(0,Q._M)("name","<=",re+"\uf8ff"),(0,Q.AB)(10)),i=await(0,Q.GG)(a),c=new Map;o.docs.forEach((e=>{c.set(e.id,(0,r.A)({id:e.id},e.data()))})),i.docs.forEach((e=>{c.set(e.id,(0,r.A)({id:e.id},e.data()))}));const l=Array.from(c.values()).filter((t=>t.id!==(null===e||void 0===e?void 0:e.uid)));ae(l)}catch(t){console.error("Error searching users:",t),K.oR.error("Failed to search users")}finally{J(!1)}}else ae([])},Ne=e=>{if(!e)return"";const t=e.toDate?e.toDate():new Date(e),s=(new Date).getTime()-t.getTime(),r=864e5;return s<r?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<2*r?"Yesterday":t.toLocaleDateString([],{month:"short",day:"numeric"})},Le=()=>{me(null),xe(null)},He=n=>0===n.length?(0,B.jsxs)(a.A,{sx:{textAlign:"center",mt:4,p:3},children:[(0,B.jsx)(i.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:0===pe?"You haven't started any conversations yet":"No message requests"}),0===pe&&(0,B.jsx)(c.A,{variant:"contained",startIcon:(0,B.jsx)(N.A,{}),onClick:()=>ce(!0),sx:{mt:2},children:"Start a new chat"})]}):(0,B.jsx)(l.A,{sx:{bgcolor:"background.paper",borderRadius:1},children:n.map(((c,l)=>{var g,b,v;return(0,B.jsxs)(o.Fragment,{children:[(0,B.jsxs)(d.Ay,{alignItems:"flex-start",button:!0,onClick:()=>t("/chat/conversation/".concat(c.id)),sx:{py:2},secondaryAction:"pending"===c.status?(0,B.jsxs)(a.A,{sx:{display:"flex"},children:[(0,B.jsx)(u.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{J(!0);const e=(0,Q.H9)(Y.db,"conversations",t.id);await(0,Q.mZ)(e,{status:"accepted"}),se((e=>e.filter((e=>e.id!==t.id)))),ee((e=>[(0,r.A)((0,r.A)({},t),{},{status:"accepted"}),...e])),fe("Message request accepted"),Ce(!0)}catch(s){console.error("Error accepting message request:",s),K.oR.error("Failed to accept message request")}finally{J(!1)}})(c)},color:"success","aria-label":"accept request",title:"Accept",children:(0,B.jsx)(L.A,{})}),(0,B.jsx)(u.A,{edge:"end",onClick:t=>{t.stopPropagation(),(async t=>{if(e)try{J(!0);const e=(0,Q.wP)(Y.db),s=(0,Q.rJ)(Y.db,"conversations",t.id,"messages");(await(0,Q.GG)(s)).docs.forEach((t=>{e.delete(t.ref)}));const r=(0,Q.H9)(Y.db,"conversations",t.id);e.delete(r),await e.commit(),se((e=>e.filter((e=>e.id!==t.id)))),fe("Message request declined"),Ce(!0)}catch(s){console.error("Error declining message request:",s),K.oR.error("Failed to decline message request")}finally{J(!1)}})(c)},color:"error","aria-label":"decline request",title:"Decline",children:(0,B.jsx)(H.A,{})})]}):(0,B.jsx)(u.A,{edge:"end",onClick:e=>((e,t)=>{e.stopPropagation(),me(e.currentTarget),xe(t)})(e,c),"aria-label":"more options",children:(0,B.jsx)(G.A,{})}),children:[(0,B.jsx)(m.A,{children:(0,B.jsxs)(a.A,{sx:{position:"relative"},children:[(0,B.jsx)(h.A,{color:"primary",badgeContent:"number"===typeof c.unreadCount?c.unreadCount:0,invisible:!c.unreadCount,children:(0,B.jsx)(x.A,{alt:c.displayName||"User",src:c.photoURL||void 0,sx:{width:40,height:40,bgcolor:c.photoURL?void 0:"primary.main"},children:!c.photoURL&&(null===(g=c.displayName)||void 0===g?void 0:g.charAt(0).toUpperCase())})}),(0,B.jsx)(a.A,{sx:{position:"absolute",bottom:12,right:12,zIndex:4},children:(0,B.jsx)(I.A,{isOnline:c.participants.some((t=>t!==(null===e||void 0===e?void 0:e.uid)&&s(t))),size:"small"})})]})}),(0,B.jsx)(p.A,{primary:c.displayName,secondary:(0,B.jsxs)(o.Fragment,{children:[(0,B.jsx)(i.A,{component:"span",variant:"body2",color:"text.primary",sx:{display:"inline",fontWeight:c.unreadCount?"bold":"normal"},children:(null===(b=c.lastMessage)||void 0===b?void 0:b.text)||"Start a conversation"}),(null===(v=c.lastMessage)||void 0===v?void 0:v.timestamp)&&(0,B.jsx)(i.A,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:Ne(c.lastMessage.timestamp)})]})})]}),l<n.length-1&&(0,B.jsx)(A.A,{component:"li"})]},c.id)}))});return(0,B.jsxs)(g.A,{maxWidth:"md",sx:{mt:2,mb:8},children:[(0,B.jsxs)(b.A,{elevation:0,sx:{p:2,mb:2},children:[(0,B.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,B.jsx)(i.A,{variant:"h5",fontWeight:"bold",children:"Messages"}),(0,B.jsx)(u.A,{onClick:()=>ce(!0),color:"primary",children:(0,B.jsx)(N.A,{})})]}),(0,B.jsx)(v.A,{fullWidth:!0,placeholder:"Search conversations...",variant:"outlined",value:re,onChange:e=>ne(e.target.value),onKeyPress:e=>"Enter"===e.key&&De(),InputProps:{startAdornment:(0,B.jsx)(j.A,{position:"start",children:(0,B.jsx)(W.A,{})}),endAdornment:re?(0,B.jsx)(j.A,{position:"end",children:(0,B.jsx)(u.A,{size:"small",onClick:()=>ne(""),children:(0,B.jsx)(F.A,{})})}):null},sx:{mb:2}}),(0,B.jsx)(a.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,B.jsxs)(y.A,{value:pe,onChange:(e,t)=>{Ae(t)},"aria-label":"message tabs",variant:"fullWidth",children:[(0,B.jsx)(f.A,{label:"Inbox",id:"messages-tab-0","aria-controls":"messages-tabpanel-0"}),(0,B.jsx)(f.A,{label:(0,B.jsxs)(a.A,{sx:{display:"flex",alignItems:"center"},children:[(0,B.jsx)("span",{children:"Message Requests"}),te.length>0&&(0,B.jsx)(h.A,{color:"error",badgeContent:te.length,sx:{ml:1}})]}),id:"messages-tab-1","aria-controls":"messages-tabpanel-1",icon:te.length>0?(0,B.jsx)(T,{fontSize:"small"}):void 0,iconPosition:"end"}),(0,B.jsx)(f.A,{label:"Rooms +",id:"messages-tab-1","aria-controls":"messages-tabpanel-1",icon:te.length>0?(0,B.jsx)(T,{fontSize:"small"}):void 0,iconPosition:"end"})]})})]}),n&&0===X.length&&0===te.length?(0,B.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,B.jsx)(w.A,{})}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)($,{value:pe,index:0,children:He(X)}),(0,B.jsxs)($,{value:pe,index:1,children:[te.length>0&&(0,B.jsx)(C.A,{severity:"info",sx:{mb:2},children:"These are message requests from people you don't follow. Accept to start chatting or decline to remove."}),He(te)]}),(0,B.jsxs)($,{value:pe,index:2,children:[(0,B.jsxs)(a.A,{sx:{p:2,mb:3,bgcolor:"background.paper",borderRadius:1},children:[(0,B.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"Rooms + Server Chat"}),(0,B.jsx)(i.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Create a room to share announcements, live updates, and polls with your followers. Great for creators who want to engage with their audience, or for anyone who wants to create a community, you can also join other rooms inside the rooms + section."}),(0,B.jsx)(c.A,{variant:"contained",startIcon:(0,B.jsx)(q.A,{}),onClick:()=>ke(!0),sx:{mt:1},children:"Create a Room"})]}),0===ze.length?(0,B.jsx)(a.A,{sx:{textAlign:"center",mt:4,p:3},children:(0,B.jsx)(i.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"No rooms available. Create a room or join someone else's room."})}):(0,B.jsx)(l.A,{sx:{bgcolor:"background.paper",borderRadius:1},children:ze.map(((e,s)=>{var r,n,l,u;return(0,B.jsxs)(o.Fragment,{children:[(0,B.jsxs)(d.Ay,{alignItems:"flex-start",button:!0,onClick:()=>t("/chat/room/".concat(e.id)),sx:{py:2},children:[(0,B.jsx)(m.A,{children:(0,B.jsx)(h.A,{color:"secondary",variant:"dot",invisible:!e.isOwner,children:(0,B.jsx)(x.A,{alt:e.name,src:e.creatorPhoto,sx:{bgcolor:e.creatorPhoto?void 0:"secondary.main"},children:!e.creatorPhoto&&(null===(r=e.name)||void 0===r?void 0:r.charAt(0).toUpperCase())})})}),(0,B.jsx)(p.A,{primary:(0,B.jsxs)(a.A,{display:"flex",alignItems:"center",children:[(0,B.jsx)(i.A,{variant:"subtitle1",component:"span",children:e.name}),e.isOwner&&(0,B.jsx)(i.A,{variant:"caption",component:"span",sx:{ml:1,bgcolor:"secondary.main",px:1,py:.5,borderRadius:1,color:"white"},children:"Owner"}),!e.isOwner&&e.isMember&&(0,B.jsx)(i.A,{variant:"caption",component:"span",sx:{ml:1,bgcolor:"success.light",px:1,py:.5,borderRadius:1,color:"white"},children:"Joined"})]}),secondary:(0,B.jsxs)(o.Fragment,{children:[(0,B.jsxs)(i.A,{component:"div",variant:"body2",color:"text.primary",sx:{display:"block"},children:[null===(n=e.description)||void 0===n?void 0:n.substring(0,60),(null===(l=e.description)||void 0===l?void 0:l.length)>60?"...":""]}),(0,B.jsxs)(a.A,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{mt:.5},children:[(0,B.jsxs)(i.A,{component:"span",variant:"caption",color:"text.secondary",children:["Created by ",e.creatorName," \u2022 ",(null===(u=e.members)||void 0===u?void 0:u.length)||0," members"]}),!e.isMember&&(0,B.jsx)(c.A,{size:"small",variant:"outlined",color:"primary",onClick:s=>{s.stopPropagation(),t("/chat/room/".concat(e.id))},sx:{minWidth:"60px",ml:1},children:"Join"})]})]})})]}),s<ze.length-1&&(0,B.jsx)(A.A,{component:"li"})]},e.id)}))})]})]}),(0,B.jsx)(S.A,{anchorEl:ue,open:Boolean(ue),onClose:Le,children:(0,B.jsxs)(k.A,{onClick:async()=>{if(he&&e)try{J(!0);const e=(0,Q.wP)(Y.db),t=(0,Q.rJ)(Y.db,"conversations",he.id,"messages");(await(0,Q.GG)(t)).docs.forEach((t=>{e.delete(t.ref)}));const s=(0,Q.H9)(Y.db,"conversations",he.id);e.delete(s),await e.commit(),ee((e=>e.filter((e=>e.id!==he.id)))),se((e=>e.filter((e=>e.id!==he.id)))),fe("Conversation deleted"),Ce(!0)}catch(t){console.error("Error deleting conversation:",t),K.oR.error("Failed to delete conversation")}finally{J(!1),Le()}else Le()},sx:{color:"error.main"},children:[(0,B.jsx)(M.A,{children:(0,B.jsx)(_.A,{fontSize:"small",color:"error"})}),"Delete conversation"]})}),(0,B.jsxs)(R.A,{open:ie,onClose:()=>ce(!1),maxWidth:"sm",fullWidth:!0,children:[(0,B.jsx)(E.A,{children:(0,B.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,B.jsx)(i.A,{variant:"h6",children:"Start a new conversation"}),(0,B.jsx)(u.A,{edge:"end",color:"inherit",onClick:()=>ce(!1),"aria-label":"close",children:(0,B.jsx)(F.A,{})})]})}),(0,B.jsxs)(P.A,{children:[(0,B.jsx)(v.A,{autoFocus:!0,margin:"dense",fullWidth:!0,label:"Search for a user",variant:"outlined",value:re,onChange:e=>ne(e.target.value),onKeyPress:e=>"Enter"===e.key&&De(),InputProps:{endAdornment:(0,B.jsx)(j.A,{position:"end",children:(0,B.jsx)(u.A,{onClick:De,children:(0,B.jsx)(W.A,{})})})},sx:{mb:2}}),oe.length>0&&(0,B.jsx)(l.A,{children:oe.map((r=>(0,B.jsxs)(d.Ay,{button:!0,onClick:()=>(async s=>{if(null!==e&&void 0!==e&&e.uid){de(!0);try{var r;const n=(0,Q.P)((0,Q.rJ)(Y.db,"conversations"),(0,Q._M)("participants","array-contains",e.uid)),o=await(0,Q.GG)(n);let a=null;if(o.docs.forEach((e=>{e.data().participants.includes(s)&&(a=e.id)})),a)return void t("/chat/conversation/".concat(a));const i=(0,Q.H9)(Y.db,"users",s),c=await(0,Q.x7)(i);if(!c.exists())return void K.oR.error("User not found");const l=c.data(),d=(null===(r=l.following)||void 0===r?void 0:r.includes(e.uid))||!1;console.log("[Messages] Creating conversation: ".concat(l.username||s," follows current user? ").concat(d));const u=(0,Q.H9)((0,Q.rJ)(Y.db,"conversations"));await(0,Q.BN)(u,{participants:[e.uid,s],createdAt:(0,Q.O5)(),lastUpdated:(0,Q.O5)(),unreadCount:{[e.uid]:0,[s]:0},status:d?"accepted":"pending"}),t("/chat/conversation/".concat(u.id))}catch(n){console.error("[Messages] Error creating conversation:",n),K.oR.error("Failed to start conversation")}finally{de(!1),ce(!1)}}})(r.id),disabled:le,children:[(0,B.jsx)(m.A,{children:(0,B.jsxs)(a.A,{sx:{position:"relative"},children:[(0,B.jsx)(x.A,{src:r.profilePic,alt:r.username||r.name}),(0,B.jsx)(a.A,{sx:{position:"absolute",bottom:2,top:10,right:10,transform:"translate(50%, 50%)",zIndex:4},children:(0,B.jsx)(I.A,{isOnline:s(r.id),size:"small"})})]})}),(0,B.jsx)(p.A,{primary:r.name||r.username,secondary:"@".concat(r.username)})]},r.id)))}),re&&0===oe.length&&!n&&(0,B.jsxs)(a.A,{sx:{textAlign:"center",py:3},children:[(0,B.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:['No users found for "',re,'"']}),(0,B.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try using a different search term"})]}),n&&(0,B.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:3},children:[(0,B.jsx)(w.A,{size:32,sx:{mb:2}}),(0,B.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Searching for users..."})]}),!re&&!n&&(0,B.jsx)(a.A,{sx:{textAlign:"center",py:3},children:(0,B.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Enter a username or name to search"})})]})]}),(0,B.jsxs)(R.A,{open:Se,onClose:()=>ke(!1),maxWidth:"sm",fullWidth:!0,children:[(0,B.jsx)(E.A,{children:"Create Server Chat Room"}),(0,B.jsxs)(P.A,{children:[(0,B.jsx)(U.A,{sx:{mb:2},children:"Server chat rooms allow you to broadcast updates to your followers, share announcements, and create polls. Your followers can join these rooms to stay updated with your content."}),(0,B.jsx)(v.A,{autoFocus:!0,margin:"dense",label:"Room Name",fullWidth:!0,variant:"outlined",value:Me,onChange:e=>Re(e.target.value),required:!0,sx:{mb:2}}),(0,B.jsx)(v.A,{margin:"dense",label:"Description",fullWidth:!0,variant:"outlined",value:Ee,onChange:e=>Pe(e.target.value),multiline:!0,rows:3,placeholder:"What is this room about? Who should join?"})]}),(0,B.jsxs)(O.A,{children:[(0,B.jsx)(c.A,{onClick:()=>ke(!1),disabled:Ue,children:"Cancel"}),(0,B.jsx)(c.A,{onClick:async()=>{if(null!==e&&void 0!==e&&e.uid&&Me.trim()){Oe(!0);try{const r=(0,Q.H9)((0,Q.rJ)(Y.db,"rooms"));await(0,Q.BN)(r,{name:Me.trim(),description:Ee.trim(),createdBy:e.uid,createdAt:(0,Q.O5)(),members:[e.uid],type:"public",lastMessage:null});try{const t=(0,Q.H9)(Y.db,"users",e.uid),s=await(0,Q.x7)(t),n=s.exists()?s.data():null;if(n&&n.followers&&Array.isArray(n.followers)){const t=n.followers,s=(0,Q.rJ)(Y.db,"notifications"),o=t.map((t=>(0,Q.gS)(s,{type:"room_created",senderId:e.uid,senderName:n.name||n.username||e.displayName||"User",senderAvatar:n.profilePic||e.photoURL||"",recipientId:t,content:"".concat(n.name||n.username||"User"," created a new room: ").concat(Me.trim()),roomId:r.id,roomName:Me.trim(),isRead:!1,createdAt:(0,Q.O5)()})));await Promise.all(o),console.log("Sent room creation notifications to ".concat(t.length," followers"))}}catch(s){console.error("Error sending room creation notifications:",s)}Re(""),Pe(""),ke(!1),t("/chat/room/".concat(r.id)),fe("Room created successfully"),Ce(!0)}catch(r){console.error("Error creating room:",r),K.oR.error("Failed to create room")}finally{Oe(!1)}}},variant:"contained",disabled:!Me.trim()||Ue,children:Ue?(0,B.jsx)(w.A,{size:24}):"Create Room"})]})]}),(0,B.jsx)(z.A,{open:we,autoHideDuration:4e3,onClose:()=>{Ce(!1)},message:ye})]})}},9885:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(3235),n=s(4414);const o=(0,r.A)((0,n.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")}}]);