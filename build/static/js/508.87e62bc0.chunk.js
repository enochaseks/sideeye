"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[508],{227:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd")},1770:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block")},2289:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M9.68 13.69 12 11.93l2.31 1.76-.88-2.85L15.75 9h-2.84L12 6.19 11.09 9H8.25l2.31 1.84zM20 10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.03.76 3.87 2 5.28V23l6-2 6 2v-7.72c1.24-1.41 2-3.25 2-5.28m-8-6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"}),"WorkspacePremium")},2960:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents")},3531:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12.16 3h-.32L9.21 8.25h5.58zm4.3 5.25h5.16L19 3h-5.16zm4.92 1.5h-8.63V20.1zM11.25 20.1V9.75H2.62zM7.54 8.25 10.16 3H5L2.38 8.25z"}),"Diamond")},5788:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos")},6052:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos")},6117:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1M9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m11 15H4v-2h16zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20z"}),"CardGiftcard")},6164:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"VerifiedUser")},6281:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},6508:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Ae});var o=s(9379),r=s(9950),i=s(9808),n=s(2235),l=s(2053),a=s(4857),c=s(6589),d=s(6491),x=s(6639),u=s(5333),h=s(7591),m=s(3266),p=s(4195),f=s(3563),g=s(4447),v=s(1413),A=s(226),j=s(2236),y=s(4142),b=s(470),w=s(3569),C=s(704),S=s(5277),R=s(5713),E=s(6583),k=s(33),I=s(8170),z=s(8145),M=s(2046),U=s(9739),P=s(249),H=s(6050),F=s(2092),G=s(6164),D=s(6281),T=s(1770),W=s(7565),N=s(3472),B=s(7286),L=s(227),Y=s(7092),V=s(8692),O=s(6117),_=s(6592),q=s(6835),J=s(5788),Z=s(6052),Q=s(330),X=s(6220),$=s(9751),K=s(8429),ee=s(2074),te=s(1367),se=s(301),oe=s(5887),re=s(3174),ie=s(899),ne=s(7497),le=s(7443),ae=s(8179),ce=s(3235),de=s(4414);const xe=(0,ce.A)((0,de.jsx)("path",{d:"m2 22 14-5-9-9zm12.53-9.47 5.59-5.59c.49-.49 1.28-.49 1.77 0l.59.59 1.06-1.06-.59-.59c-1.07-1.07-2.82-1.07-3.89 0l-5.59 5.59zm-4.47-5.65-.59.59 1.06 1.06.59-.59c1.07-1.07 1.07-2.82 0-3.89l-.59-.59-1.06 1.07.59.59c.48.48.48 1.28 0 1.76m7 5-1.59 1.59 1.06 1.06 1.59-1.59c.49-.49 1.28-.49 1.77 0l1.61 1.61 1.06-1.06-1.61-1.61c-1.08-1.07-2.82-1.07-3.89 0m-2-6-3.59 3.59 1.06 1.06 3.59-3.59c1.07-1.07 1.07-2.82 0-3.89l-1.59-1.59-1.06 1.06 1.59 1.59c.48.49.48 1.29 0 1.77"}),"Celebration");var ue=s(2289),he=s(3531),me=s(2960);const pe=e=>{switch(e){case"heart-gift":return(0,de.jsx)(le.A,{});case"side-eye-gift":return(0,de.jsx)(ae.A,{});case"confetti-gift":return(0,de.jsx)(xe,{});case"crown-gift":return(0,de.jsx)(ue.A,{});case"diamond-gift":return(0,de.jsx)(he.A,{});case"trophy-gift":return(0,de.jsx)(me.A,{});default:return(0,de.jsx)(O.A,{})}},fe=e=>{switch(e){case"heart-gift":return"#FF5C8D";case"side-eye-gift":return"#9C27B0";case"confetti-gift":return"#FF9800";case"crown-gift":return"#FFC107";case"diamond-gift":return"#00BCD4";case"trophy-gift":return"#4CAF50";default:return"#757575"}},ge=e=>{let{userId:t,isOwnProfile:s}=e;const{currentUser:o}=(0,te.As)(),i=(0,a.A)(),[c,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null),[g,A]=(0,r.useState)(0),[j,y]=(0,r.useState)(0);(0,r.useEffect)((()=>{let e;return(async()=>{if(t){console.log("[GiftsSent] Setting up real-time listeners for user:",t),m(!0);try{const e=await(0,X.GG)((0,X.rJ)(Q.db,"sideRooms")),s=[];let o=[];const r=()=>{o.sort(((e,t)=>{var s,o;const r="number"===typeof e.timestamp?e.timestamp:null!==(s=e.timestamp)&&void 0!==s&&s.toDate?e.timestamp.toDate().getTime():Date.now();return("number"===typeof t.timestamp?t.timestamp:null!==(o=t.timestamp)&&void 0!==o&&o.toDate?t.timestamp.toDate().getTime():Date.now())-r})),u(o);const e=o.reduce(((e,t)=>e+(t.value||0)),0),t=o.length,s=new Set(o.map((e=>e.hostId))).size;A(e),y(t),console.log("[GiftsSent] Statistics updated:",{totalMoneySpent:e,totalCount:t,uniqueHosts:s})};for(const i of e.docs){const e=i.id,n=i.data(),l=(0,X.P)((0,X.rJ)(Q.db,"sideRooms",e,"gifts"),(0,X._M)("senderId","==",t),(0,X.My)("timestamp","desc")),a=(0,X.aQ)(l,(async t=>{o=o.filter((t=>t.roomId!==e));for(const s of t.docs){const t=s.data();let r="Unknown Host",i="";try{const e=(0,X.H9)(Q.db,"users",t.receiverId),s=await(0,X.x7)(e);if(s.exists()){const e=s.data();r=e.name||e.username||"Host",i=e.profilePic||""}}catch(p){console.warn("[GiftsSent] Could not fetch receiver data for:",t.receiverId)}const l={id:s.id,giftId:t.giftId||"unknown-gift",giftName:t.giftName||"Unknown Gift",giftType:t.giftType||"basic",value:t.value||0,roomId:e,roomName:n.name||"Unknown Room",hostId:t.receiverId,hostName:r,hostAvatar:i,timestamp:t.timestamp||Date.now(),roomDeleted:!0===n.deleted};o.push(l)}r()}));s.push(a)}return m(!1),()=>{console.log("[GiftsSent] Cleaning up listeners"),s.forEach((e=>e()))}}catch(p){console.error("[GiftsSent] Error setting up gift listeners:",p),m(!1)}}else m(!1)})().then((t=>{e=t})),()=>{e&&e()}}),[t]);const w=e=>{if(!e)return"Unknown date";try{return(e.toDate?e.toDate():new Date(e)).toLocaleDateString()}catch(p){return"Unknown date"}};return h?(0,de.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",py:4},children:(0,de.jsx)(x.A,{})}):p?(0,de.jsx)(re.A,{severity:"error",sx:{mt:2},children:p}):0===c.length?(0,de.jsxs)(d.A,{sx:{textAlign:"center",py:4},children:[(0,de.jsx)(O.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,de.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:s?"You haven't sent any gifts yet":"No gifts sent yet"}),(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:s?"Start gifting during live sessions to show your appreciation!":"This user hasn't sent any gifts in live rooms."})]}):(0,de.jsxs)(d.A,{children:[(0,de.jsx)(n.A,{elevation:1,sx:{p:2,mb:3,bgcolor:(0,ne.X4)(i.palette.primary.main,.05)},children:(0,de.jsxs)(ie.Ay,{container:!0,spacing:2,sx:{textAlign:"center"},children:[(0,de.jsxs)(ie.Ay,{item:!0,xs:6,children:[(0,de.jsx)(l.A,{variant:"h4",color:"primary",fontWeight:"bold",children:j}),(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Gifts Sent"})]}),(0,de.jsxs)(ie.Ay,{item:!0,xs:6,children:[(0,de.jsx)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:(0,de.jsxs)(l.A,{variant:"h4",color:"secondary",fontWeight:"bold",children:["\xa3",g.toFixed(2)]})}),(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Money Spent"})]})]})}),(0,de.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:(()=>{const e=c.reduce(((e,t)=>{const s=t.giftId||"unknown-gift";return e[s]||(e[s]=[]),e[s].push(t),e}),{}),t=["heart-gift","side-eye-gift","confetti-gift","crown-gift","diamond-gift","trophy-gift"];return Object.keys(e).sort(((e,s)=>{const o=t.indexOf(e),r=t.indexOf(s);return-1!==o&&-1!==r?o-r:-1!==o?-1:-1!==r?1:e.localeCompare(s)})).map((t=>{const s=e[t],o=s[0],r=s.length,i=s.reduce(((e,t)=>e+("basic"!==t.giftType?t.value:0)),0);return(0,de.jsxs)(n.A,{elevation:2,sx:{p:3,borderRadius:2},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,de.jsx)(d.A,{sx:{color:fe(t),display:"flex",alignItems:"center",justifyContent:"center",width:56,height:56,borderRadius:"50%",bgcolor:(0,ne.X4)(fe(t),.1),border:"2px solid ".concat((0,ne.X4)(fe(t),.3))},children:pe(t)}),(0,de.jsxs)(d.A,{sx:{flexGrow:1},children:[(0,de.jsx)(l.A,{variant:"h5",component:"div",fontWeight:"bold",children:o.giftName}),(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[(0,de.jsx)(S.A,{size:"small",label:"".concat(r," sent"),color:"primary",variant:"outlined"}),(0,de.jsx)(d.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:(0,de.jsxs)(l.A,{variant:"body2",fontWeight:"medium",children:["\xa3",i.toFixed(2)," spent"]})}),(0,de.jsx)(d.A,{sx:{display:"flex",alignItems:"center",gap:.3},children:(0,de.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["(Host earned ~",(.8*i/.005).toFixed(0)," SC)"]})})]})]})]}),(0,de.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:s.map((e=>(0,de.jsx)(b.A,{variant:"outlined",sx:{"&:hover":{boxShadow:2,transform:"translateY(-1px)",transition:"all 0.2s ease-in-out"},opacity:e.roomDeleted?.7:1,bgcolor:(0,ne.X4)(fe(t),.02)},children:(0,de.jsx)(C.A,{sx:{p:2},children:(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,de.jsx)(v.A,{src:e.hostAvatar,alt:e.hostName,sx:{width:32,height:32},children:e.hostName.charAt(0).toUpperCase()}),(0,de.jsxs)(d.A,{sx:{flexGrow:1,minWidth:0},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[(0,de.jsxs)(l.A,{variant:"body1",fontWeight:"medium",noWrap:!0,children:["To: ",e.hostName]}),e.roomDeleted&&(0,de.jsx)(S.A,{size:"small",label:"Deleted Room",color:"error",variant:"outlined"})]}),(0,de.jsxs)(l.A,{variant:"body2",color:"text.secondary",noWrap:!0,children:["Room: ",e.roomName]})]}),(0,de.jsxs)(d.A,{sx:{textAlign:"right"},children:[(0,de.jsx)(d.A,{sx:{display:"flex",alignItems:"center",gap:.5,justifyContent:"flex-end",mb:.5},children:(0,de.jsxs)(l.A,{variant:"body2",fontWeight:"bold",children:["\xa3",e.value.toFixed(2)]})}),(0,de.jsx)(l.A,{variant:"caption",color:"text.secondary",children:w(e.timestamp)})]})]})})},e.id)))})]},t)}))})()})]})},ve=()=>(0,de.jsx)(i.A,{maxWidth:"sm",sx:{mt:4,textAlign:"center"},children:(0,de.jsxs)(n.A,{elevation:2,sx:{p:3},children:[(0,de.jsx)(F.A,{sx:{fontSize:40,mb:2},color:"action"}),(0,de.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Account Deactivated"}),(0,de.jsx)(l.A,{color:"text.secondary",children:"This user's account is currently deactivated."})]})}),Ae=()=>{var e,t,s;const re=(0,a.A)(),{currentUser:ie,user:ne,userProfile:le,loading:ae,setUserProfile:ce,blockUser:xe}=((0,c.A)(re.breakpoints.down("sm")),(0,te.As)()),{db:ue}=(0,se.j)(),{userId:he}=(0,K.g)(),[me,pe]=(0,r.useState)(null),[fe,Ae]=(0,r.useState)(""),[je,ye]=(0,r.useState)(""),[be,we]=(0,r.useState)(""),[Ce,Se]=(0,r.useState)(""),[Re,Ee]=(0,r.useState)(!1),[ke,Ie]=(0,r.useState)(!0),[ze,Me]=(0,r.useState)(null),[Ue,Pe]=(0,r.useState)([]),[He,Fe]=(0,r.useState)([]),[Ge,De]=(0,r.useState)(null),[Te,We]=(0,r.useState)(!1),[Ne,Be]=(0,r.useState)(!1),[Le,Ye]=(0,r.useState)(!1),[Ve,Oe]=(0,r.useState)(!1),[_e,qe]=(0,r.useState)([]),[Je,Ze]=(0,r.useState)(!1),[Qe,Xe]=(0,r.useState)(""),[$e,Ke]=(0,r.useState)(""),[et,tt]=(0,r.useState)(""),[st,ot]=(0,r.useState)([]),[rt,it]=(0,r.useState)([]),[nt,lt]=(0,r.useState)(!1),at=(0,K.Zp)(),[ct,dt]=(0,r.useState)(null),[xt,ut]=(0,r.useState)(!1),[ht,mt]=(0,r.useState)(!1),[pt,ft]=(0,r.useState)(!1),[gt,vt]=(0,r.useState)(!1),[At,jt]=(0,r.useState)(null),[yt,bt]=(0,r.useState)([]),[wt,Ct]=(0,r.useState)(!1),St=(0,r.useRef)(""),[Rt,Et]=(0,r.useState)("sideRooms"),[kt,It]=(0,r.useState)([]),[zt,Mt]=(0,r.useState)(!1),[Ut,Pt]=(0,r.useState)(!1),[Ht,Ft]=(0,r.useState)(0),[Gt,Dt]=(0,r.useState)(0),[Tt,Wt]=(0,r.useState)(!1),[Nt,Bt]=(0,r.useState)([]),[Lt,Yt]=(0,r.useState)(!1),Vt=(0,r.useRef)(null),Ot=(0,r.useRef)(null),[_t,qt]=(0,r.useState)(!1),Jt=me||(null===ie||void 0===ie?void 0:ie.uid)||"",Zt=(0,r.useCallback)((async()=>{if(ue&&me)try{const t=new Date;t.setHours(t.getHours()-24);const s=(0,X.P)((0,X.rJ)(ue,"stories"),(0,X._M)("userId","==",me),(0,X._M)("expiresAt",">",X.Dc.fromDate(t)),(0,X.My)("expiresAt"),(0,X.My)("createdAt","desc")),o=await(0,X.GG)(s),r=[];for(const i of o.docs){var e;const t=i.data(),s=(0,X.H9)(ue,"users",t.userId),o=(await(0,X.x7)(s)).data();r.push({id:i.id,userId:t.userId,username:(null===o||void 0===o?void 0:o.username)||(null===o||void 0===o?void 0:o.name)||"Unknown User",userAvatar:(null===o||void 0===o?void 0:o.profilePic)||(null===o||void 0===o?void 0:o.photoURL)||"",content:t.content||"",mediaUrl:t.mediaUrl,mediaType:t.mediaType,createdAt:t.createdAt,expiresAt:t.expiresAt,views:t.views||[],isViewed:(null===(e=t.views)||void 0===e?void 0:e.includes((null===ie||void 0===ie?void 0:ie.uid)||""))||!1})}It(r),Mt(r.length>0)}catch(ze){console.error("Error fetching user stories:",ze)}}),[ue,me,null===ie||void 0===ie?void 0:ie.uid]),Qt=async e=>{if(ie&&ue)try{const t=(0,X.H9)(ue,"stories",e);await(0,X.mZ)(t,{views:(0,X.hq)(ie.uid)})}catch(ze){console.error("Error marking story as viewed:",ze)}},Xt=async e=>{if(!ue)return!1;try{const t=(0,X.rJ)(ue,"users"),s=(0,X.P)(t,(0,X._M)("username","==",e)),o=await(0,X.GG)(s);if(!o.empty&&1===o.docs.length){if(o.docs[0].id===(null===ie||void 0===ie?void 0:ie.uid))return!1}return!o.empty}catch(ze){return console.error("Error checking username:",ze),!1}};(0,r.useEffect)((()=>{let e=!0;const t=setTimeout((async()=>{if(et&&et!==St.current&&!(et.length<3)&&ie&&/^[a-zA-Z0-9_-]+$/.test(et)){ft(!0);try{const t=await Xt(et);if(!e)return;if(t){vt(!0),jt("Username is already taken");const t=(e=>{const t=[];t.push("".concat(e).concat(Math.floor(100*Math.random())));const s=(new Date).getFullYear();return t.push("".concat(e).concat(s)),t.push("".concat(e,"_").concat(Math.floor(100*Math.random()))),t.push("real_".concat(e)),t.push("".concat(e).concat(Math.floor(1e3*Math.random()))),t})(et),s=[];if((await Promise.all(t.map((async e=>({suggestion:e,exists:await Xt(e)}))))).forEach((e=>{e.exists||s.push(e.suggestion)})),!e)return;bt(s),Ct(s.length>0)}else vt(!1),jt(null),bt([]),Ct(!1)}catch(ze){console.error("Error validating username:",ze)}finally{e&&ft(!1)}}}),500);return()=>{e=!1,clearTimeout(t)}}),[et,ue,null===ie||void 0===ie?void 0:ie.uid]);(0,r.useEffect)((()=>{pe(he||((null===ie||void 0===ie?void 0:ie.uid)||null))}),[he,null===ie||void 0===ie?void 0:ie.uid]),(0,r.useEffect)((()=>{var e;if(!ie||!me||ie.uid===me)return;(async()=>{if(ue)try{const e=(0,X.H9)(ue,"users",me),t=await(0,X.x7)(e);if(t.exists()){const e=t.data();(e.blockedUsers||[]).includes(ie.uid)&&at("/discover")}}catch(ze){console.error("Error checking if blocked by target:",ze),at("/discover")}})();(null===(e=ie.blockedUsers)||void 0===e?void 0:e.includes(me))&&at("/discover")}),[ie,me,ue,at]);const $t=(0,r.useCallback)((async()=>{if(ue&&me)try{Ie(!0),Me(null),lt(!1);const e=(0,X.H9)(ue,"users",me),t=await(0,X.x7)(e);if(!t.exists())return Me("Profile not found"),void Ie(!1);const s=t.data();if(s.isVerified=!0,(null===ie||void 0===ie?void 0:ie.uid)===me&&ce&&le){const e=(0,o.A)((0,o.A)({},le),{},{isVerified:!0});ce(e)}if(!1===s.isActive)return lt(!0),Me(null),void Ie(!1);const r=s.isPrivate||!1,i=(null===ie||void 0===ie?void 0:ie.uid)===me;if(We(r),Ae(s.username||""),ye(s.name||""),Se(s.bio||""),De(s.profilePic||null),we(s.email||""),i||!r)Be(!0),Me(null);else if(null!==ie&&void 0!==ie&&ie.uid){const e=(0,X.H9)(ue,"users/".concat(me,"/followers/").concat(ie.uid)),t=(await(0,X.x7)(e)).exists();Be(t),t||Me("This profile is private")}else Be(!1),Me("This profile is private");const[n,l]=await Promise.all([(0,X.GG)((0,X.rJ)(ue,"users/".concat(me,"/followers"))),(0,X.GG)((0,X.rJ)(ue,"users/".concat(me,"/following")))]);Fe(n.docs.map((e=>e.id))),Pe(l.docs.map((e=>e.id)));const[a,c]=await Promise.all([(0,X.GG)((0,X.P)((0,X.rJ)(ue,"sideRooms"),(0,X._M)("members","array-contains",me))),(0,X.GG)((0,X.P)((0,X.rJ)(ue,"sideRooms"),(0,X._M)("ownerId","==",me),(0,X._M)("deleted","==",!1)))]);ot(a.docs.map((e=>(0,o.A)({id:e.id},e.data())))),it(c.docs.map((e=>(0,o.A)({id:e.id},e.data()))))}catch(ze){console.error("Error in fetchUserData:",ze),Me("Failed to load profile data")}finally{Ie(!1)}else Ie(!1)}),[ue,me,ie,ce]);(0,r.useEffect)((()=>{$t(),Zt()}),[$t,Zt]),(0,r.useEffect)((()=>(Ut&&kt.length>0&&!Tt&&(Vt.current=setInterval((()=>{Dt((e=>{if(e>=100){const e=Ht+1;return e<kt.length?(Ft(e),kt[e].userId!==(null===ie||void 0===ie?void 0:ie.uid)&&Qt(kt[e].id),0):(Pt(!1),0)}return e+2}))}),100)),()=>{Vt.current&&clearInterval(Vt.current)})),[Ut,Ht,ie,Tt,kt]),(0,r.useEffect)((()=>()=>{Vt.current&&clearInterval(Vt.current),Ot.current&&clearTimeout(Ot.current)}),[]),(0,r.useEffect)((()=>{if(!ue||!Jt)return;const e=(0,X.rJ)(ue,"users",Jt,"followers"),t=(0,X.aQ)(e,(e=>{const t=e.docs.map((e=>e.id));Fe(t)}));return(async()=>{try{const e=(0,X.H9)(ue,"users",Jt),t=await(0,X.x7)(e);if(t.exists()){const e=t.data();console.log("DEBUG - User data structure:",e),console.log("DEBUG - Profile pic field:",e.profilePic),console.log("DEBUG - Alternate fields:",{photoURL:e.photoURL,avatarUrl:e.avatarUrl,avatar:e.avatar,photo:e.photo,image:e.image,profileImage:e.profileImage})}}catch(ze){console.error("Error in debug fetch:",ze)}})(),()=>t()}),[ue,Jt]),(0,r.useEffect)((()=>{if(!ue||!Jt)return;const e=(0,X.rJ)(ue,"users",Jt,"following"),t=(0,X.aQ)(e,(e=>{const t=e.docs.map((e=>e.id));Pe(t)}));return()=>t()}),[ue,Jt]),(0,r.useEffect)((()=>{if(!ue||!ie||!Jt)return;(async()=>{console.log("EMERGENCY: Checking follow state for",Jt);try{const e=(0,X.H9)(ue,"users",ie.uid,"following",Jt),t=await(0,X.x7)(e),s=(0,X.H9)(ue,"users",Jt,"followers",ie.uid),o=await(0,X.x7)(s);if(t.exists()||o.exists())return console.log("EMERGENCY: Setting isFollowing to TRUE for",Jt),Ye(!0),Oe(!1),t.exists()||(await(0,X.BN)(e,{timestamp:(0,X.O5)()}),console.log("EMERGENCY: Fixed missing following entry for",Jt)),void(o.exists()||(await(0,X.BN)(s,{timestamp:(0,X.O5)()}),console.log("EMERGENCY: Fixed missing follower entry for",Jt)));const r=(0,X.H9)(ue,"users",Jt,"followRequests",ie.uid);(await(0,X.x7)(r)).exists()?(console.log("EMERGENCY: Setting followRequested to TRUE for",Jt),Oe(!0),Ye(!1)):(Oe(!1),Ye(!1))}catch(ze){console.error("EMERGENCY: Error checking follow state:",ze)}})();const e=(0,X.H9)(ue,"users",ie.uid,"following",Jt),t=(0,X.H9)(ue,"users",Jt,"followers",ie.uid),s=(0,X.H9)(ue,"users",Jt,"followRequests",ie.uid),o=(0,X.aQ)(e,(e=>{e.exists()&&(console.log("EMERGENCY: following doc changed, exists=",e.exists()),Ye(!0),Oe(!1))})),r=(0,X.aQ)(t,(t=>{t.exists()&&(console.log("EMERGENCY: follower doc changed, exists=",t.exists()),Ye(!0),Oe(!1),(0,X.BN)(e,{timestamp:(0,X.O5)()}).catch((e=>console.error("Failed to sync following doc:",e))))})),i=(0,X.aQ)(s,(e=>{e.exists()&&!Le&&(console.log("EMERGENCY: request doc changed, exists=",e.exists()),Oe(!0))}));return()=>{o(),r(),i()}}),[ue,ie,Jt,Le]),(0,r.useEffect)((()=>{Re&&(Xe(je),tt(fe),St.current=fe,Ke(Ce))}),[Re,je,fe,Ce]);const Kt=async e=>{if(!ue)return!1;try{const t=(0,X.H9)(ue,"users",e),s=await(0,X.x7)(t);if(s.exists()){return!0===s.data().isPrivate}return!1}catch(ze){return console.error("Error checking if follow request needed:",ze),!1}};return ae||ke?(0,de.jsx)(i.A,{maxWidth:"lg",children:(0,de.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,de.jsx)(x.A,{})})}):nt?(0,de.jsx)(ve,{}):(0,de.jsxs)(i.A,{maxWidth:"sm",sx:{mt:2,mb:8,px:{xs:1,sm:2}},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,de.jsxs)(n.A,{elevation:0,sx:{p:3,borderRadius:2,backgroundColor:"background.paper"},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:3,position:"relative"},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center"},children:[(0,de.jsx)(l.A,{variant:"h5",sx:{fontWeight:"bold",textAlign:"center"},children:fe||"username"}),(null===le||void 0===le?void 0:le.isVerified)&&(0,de.jsx)(G.A,{sx:{ml:.5,color:"enochaseks@yahoo.com"===be||"contact@sideye.uk"===be?"gold":"primary.main",fontSize:"1.5rem"}}),Te&&(0,de.jsx)(F.A,{sx:{ml:1,fontSize:20,verticalAlign:"middle"}})]}),(null===ie||void 0===ie?void 0:ie.uid)!==me&&(0,de.jsx)(u.A,{onClick:e=>{dt(e.currentTarget)},size:"small",sx:{position:"absolute",right:0},children:(0,de.jsx)(D.A,{})})]}),(0,de.jsxs)(h.A,{anchorEl:ct,open:Boolean(ct),onClose:()=>{dt(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,de.jsxs)(m.A,{onClick:async()=>{ie&&(dt(null),ut(!0))},children:[(0,de.jsx)(p.A,{children:(0,de.jsx)(T.A,{fontSize:"small"})}),(0,de.jsx)(f.A,{children:"Block User"})]}),(0,de.jsxs)(m.A,{onClick:()=>{dt(null),mt(!0)},children:[(0,de.jsx)(p.A,{children:(0,de.jsx)(W.A,{fontSize:"small"})}),(0,de.jsx)(f.A,{children:"Report User"})]})]}),(0,de.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[(0,de.jsx)(d.A,{sx:{position:"relative",display:"flex",justifyContent:"center",width:"100%"},children:(0,de.jsx)(g.A,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:(null===ie||void 0===ie?void 0:ie.uid)===me&&(0,de.jsxs)(u.A,{component:"label",size:"small",sx:{bgcolor:"background.paper",border:"2px solid",borderColor:"background.paper"},children:[(0,de.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:async e=>{var t;if(ie&&null!==(t=e.target.files)&&void 0!==t&&t[0])try{Ie(!0);const t=e.target.files[0],s=(0,$.KR)(Q.IG,"profilePics/".concat(ie.uid,"/").concat(t.name));await(0,$.D)(s,t);const o=await(0,$.qk)(s),r=(0,X.H9)(ue,"users",ie.uid);await(0,X.mZ)(r,{profilePic:o,updatedAt:(0,X.O5)()}),De(o),oe.oR.success("Profile picture updated successfully")}catch(ze){console.error("Error updating profile picture:",ze),Me("Failed to update profile picture"),oe.oR.error("Failed to update profile picture")}finally{Ie(!1)}}}),(0,de.jsx)(N.A,{fontSize:"small"})]}),children:(0,de.jsx)(v.A,{src:Ge||void 0,onClick:zt?e=>{return(t=e)&&(t.preventDefault(),t.stopPropagation()),void(0===kt.length||_t||(qt(!0),Ot.current&&clearTimeout(Ot.current),Ot.current=setTimeout((()=>{Pt(!0),Ft(0),Dt(0),kt[0]&&kt[0].userId!==(null===ie||void 0===ie?void 0:ie.uid)&&Qt(kt[0].id),setTimeout((()=>{qt(!1)}),500)}),100)));var t}:void 0,sx:{width:100,height:100,border:"3px solid",borderColor:zt?"primary.main":"background.paper",cursor:zt?"pointer":"default",transition:"all 0.2s ease-in-out","&:hover":zt?{transform:"scale(1.05)",boxShadow:"0 4px 20px rgba(0, 122, 255, 0.3)"}:{},touchAction:"manipulation"},children:!Ge&&fe?fe.charAt(0).toUpperCase():"?"})})}),(0,de.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,de.jsxs)(d.A,{sx:{mb:2,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:[(0,de.jsx)(l.A,{variant:"h6",component:"h1",sx:{fontWeight:"bold",textAlign:"center"},children:je||fe}),(null===le||void 0===le?void 0:le.isVerified)&&(0,de.jsx)(G.A,{sx:{ml:.5,color:"enochaseks@yahoo.com"===be||"contact@sideye.uk"===be?"gold":"primary.main",fontSize:"1.2rem"}})]}),Ce&&(0,de.jsx)(l.A,{variant:"body1",color:"text.secondary",sx:{mt:1,whiteSpace:"pre-wrap",textAlign:"center",width:"100%"},children:Ce})]}),(0,de.jsxs)(d.A,{sx:{display:"flex",gap:3,mt:2,justifyContent:"center",width:"100%"},children:[(0,de.jsxs)(d.A,{sx:{textAlign:"center"},children:[(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Rooms"}),(0,de.jsx)(l.A,{variant:"h6",children:rt.length})]}),(0,de.jsxs)(d.A,{sx:{textAlign:"center",cursor:"pointer"},component:ee.N_,to:"/profile/".concat(Jt,"/followers"),children:[(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Followers"}),(0,de.jsx)(l.A,{variant:"h6",children:He.length})]}),(0,de.jsxs)(d.A,{sx:{textAlign:"center",cursor:"pointer"},component:ee.N_,to:"/profile/".concat(Jt,"/following"),children:[(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Following"}),(0,de.jsx)(l.A,{variant:"h6",children:Ue.length})]})]}),(0,de.jsx)(d.A,{sx:{mt:3,display:"flex",justifyContent:"center",width:"100%"},children:(null===ie||void 0===ie?void 0:ie.uid)===me?(0,de.jsx)(A.A,{variant:"outlined",onClick:()=>Ee(!0),fullWidth:!0,sx:{borderRadius:8,maxWidth:"300px"},children:"Edit Profile"}):ie?(0,de.jsxs)(d.A,{sx:{display:"flex",gap:2,justifyContent:"center",width:"100%"},children:[Le?(0,de.jsx)(A.A,{variant:"outlined",onClick:async()=>{if(ie&&Jt&&ue)try{Ie(!0),Ye(!1);const s=(0,X.H9)(ue,"users",ie.uid,"following",Jt),o=(0,X.H9)(ue,"users",Jt,"followers",ie.uid);try{const e=(0,X.wP)(ue);e.delete(s),e.delete(o),await e.commit(),console.log("EMERGENCY: Successfully unfollowed user with batch delete")}catch(e){console.error("EMERGENCY: Batch delete failed, trying individual deletes",e);try{await(0,X.kd)(s)}catch(t){console.error("Failed to delete following:",t)}try{await(0,X.kd)(o)}catch(t){console.error("Failed to delete follower:",t)}console.log("EMERGENCY: Individual deletes attempted")}Fe((e=>e.filter((e=>e!==ie.uid)))),Pe((e=>e.filter((e=>e!==Jt)))),oe.oR.success("Unfollowed successfully")}catch(ze){console.error("EMERGENCY: Error in handleUnfollow:",ze),Ye(!0),Me("Failed to unfollow user"),oe.oR.error("Failed to unfollow user. Please try again.")}finally{Ie(!1)}else Me("Database not initialized")},startIcon:(0,de.jsx)(B.A,{}),size:"small",sx:{borderRadius:8,minWidth:"120px",flex:"0 0 auto"},children:"Unfollow"}):Ve?(0,de.jsx)(A.A,{variant:"outlined",color:"secondary",sx:{borderRadius:8,flex:"0 0 auto",minWidth:"120px"},disabled:!0,children:"Requested"}):(0,de.jsx)(A.A,{variant:"contained",onClick:async()=>{if(ie&&Jt&&ue)try{if(Ie(!0),Te?Oe(!0):Ye(!0),Te){const e=(0,X.H9)(ue,"users",Jt,"followRequests",ie.uid);await(0,X.BN)(e,{userId:ie.uid,username:(null===le||void 0===le?void 0:le.username)||(null===ne||void 0===ne?void 0:ne.displayName)||"User_".concat(ie.uid.substring(0,5)),timestamp:(0,X.O5)()}),oe.oR.success("Follow request sent")}else{await Kt(ie.uid)&&oe.oR.success("Your account is private. They will need to send a request to follow you back.");const t=(0,X.H9)(ue,"users",ie.uid,"following",Jt),s=(0,X.H9)(ue,"users",Jt,"followers",ie.uid);try{const e=(0,X.wP)(ue);e.set(t,{timestamp:(0,X.O5)()}),e.set(s,{timestamp:(0,X.O5)()}),await e.commit(),console.log("EMERGENCY: Successfully followed user with batch write"),oe.oR.success("Followed successfully")}catch(e){console.error("EMERGENCY: Batch write failed, trying individual writes",e),await(0,X.BN)(t,{timestamp:(0,X.O5)()}),await(0,X.BN)(s,{timestamp:(0,X.O5)()}),console.log("EMERGENCY: Individual writes succeeded"),oe.oR.success("Followed successfully")}}}catch(ze){console.error("EMERGENCY: Error in handleFollow:",ze),Te?Oe(!1):Ye(!1),Me("Failed to process follow request"),oe.oR.error("Failed to follow user. Please try again.")}finally{Ie(!1)}else Me("Database not initialized")},startIcon:(0,de.jsx)(L.A,{}),sx:{borderRadius:8,flex:"0 0 auto",minWidth:"120px"},children:"Follow"}),(0,de.jsx)(A.A,{variant:"outlined",component:ee.N_,to:"/chat/user/".concat(Jt),startIcon:(0,de.jsx)(Y.A,{}),sx:{borderRadius:8,flex:"0 0 auto"},children:"Message"})]}):null})]})]}),Te&&(null===ie||void 0===ie?void 0:ie.uid)!==me&&!Ne&&(0,de.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",mt:4,p:3,textAlign:"center",borderRadius:2,bgcolor:"background.paper"},children:[(0,de.jsx)(d.A,{sx:{width:60,height:60,borderRadius:"50%",bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:(0,de.jsx)(F.A,{sx:{fontSize:32,color:"text.secondary"}})}),(0,de.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"This account is private"}),(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Follow this account to see their side rooms.  "})]})]}),(!Te||Ne||(null===ie||void 0===ie?void 0:ie.uid)===me)&&(0,de.jsxs)(n.A,{elevation:0,sx:{borderRadius:2,backgroundColor:"background.paper"},children:[(0,de.jsx)(d.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,de.jsxs)(j.A,{value:Rt,onChange:(e,t)=>Et(t),variant:"fullWidth",sx:{"& .MuiTab-root":{textTransform:"none",fontWeight:500}},children:[(0,de.jsx)(y.A,{label:"Side Rooms",value:"sideRooms",icon:(0,de.jsx)(V.A,{}),iconPosition:"start"}),(0,de.jsx)(y.A,{label:"Gifts Sent",value:"giftsSent",icon:(0,de.jsx)(O.A,{}),iconPosition:"start"})]})}),(0,de.jsxs)(d.A,{sx:{p:3},children:["sideRooms"===Rt&&(0,de.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[rt.length>0&&(0,de.jsxs)(d.A,{children:[(0,de.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Created Rooms"}),(0,de.jsx)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:rt.map((e=>(0,de.jsxs)(b.A,{sx:{display:"flex",flexDirection:"column",height:"100%","&:hover":{boxShadow:6,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.thumbnailUrl&&(0,de.jsx)(w.A,{component:"img",height:"140",image:e.thumbnailUrl,alt:e.name,sx:{objectFit:"cover"}}),(0,de.jsxs)(C.A,{sx:{flexGrow:1},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,de.jsx)(l.A,{variant:"h6",component:"div",children:e.name}),(0,de.jsx)(S.A,{size:"small",label:"Owner",color:"primary"})]}),(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,de.jsxs)(d.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,de.jsx)(S.A,{size:"small",label:"".concat(e.memberCount||0," members"),icon:(0,de.jsx)(_.A,{})}),e.category&&(0,de.jsx)(S.A,{size:"small",label:e.category,variant:"outlined"}),e.isPrivate&&(0,de.jsx)(S.A,{size:"small",icon:(0,de.jsx)(F.A,{}),label:"Private",variant:"outlined"})]})]}),(0,de.jsx)(R.A,{children:(0,de.jsx)(A.A,{size:"small",component:ee.N_,to:"/side-room/".concat(e.id),variant:"contained",fullWidth:!0,children:"Enter Room"})})]},e.id)))})]}),st.length>0&&(0,de.jsxs)(d.A,{children:[(0,de.jsx)(l.A,{variant:"h6",sx:{mb:2},children:"Joined Rooms"}),(0,de.jsx)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:st.map((e=>(0,de.jsxs)(b.A,{sx:{display:"flex",flexDirection:"column",height:"100%","&:hover":{boxShadow:6,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.thumbnailUrl&&(0,de.jsx)(w.A,{component:"img",height:"140",image:e.thumbnailUrl,alt:e.name,sx:{objectFit:"cover"}}),(0,de.jsxs)(C.A,{sx:{flexGrow:1},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,de.jsx)(l.A,{variant:"h6",component:"div",children:e.name}),(0,de.jsx)(S.A,{size:"small",label:"Member"})]}),(0,de.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,de.jsxs)(d.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,de.jsx)(S.A,{size:"small",label:"".concat(e.memberCount||0," members"),icon:(0,de.jsx)(_.A,{})}),e.category&&(0,de.jsx)(S.A,{size:"small",label:e.category,variant:"outlined"}),e.isPrivate&&(0,de.jsx)(S.A,{size:"small",icon:(0,de.jsx)(F.A,{}),label:"Private",variant:"outlined"})]})]}),(0,de.jsx)(R.A,{children:(0,de.jsx)(A.A,{size:"small",component:ee.N_,to:"/side-room/".concat(e.id),variant:"contained",fullWidth:!0,children:"Enter Room"})})]},e.id)))})]}),0===rt.length&&0===st.length&&(0,de.jsxs)(d.A,{sx:{textAlign:"center",py:4},children:[(0,de.jsx)(l.A,{variant:"body1",color:"text.secondary",children:(null===ie||void 0===ie?void 0:ie.uid)===me?"You have not created any side rooms yet.":"".concat(je||fe||"This person"," does not have an active room.")}),(null===ie||void 0===ie?void 0:ie.uid)===me&&(0,de.jsx)(A.A,{variant:"contained",color:"primary",component:ee.N_,to:"/side-rooms",sx:{marginTop:2},children:"Create Side Rooms"})]})]}),"giftsSent"===Rt&&(0,de.jsx)(d.A,{children:(0,de.jsx)(ge,{userId:Jt,isOwnProfile:(null===ie||void 0===ie?void 0:ie.uid)===me})})]})]})]}),(0,de.jsxs)(E.A,{open:Re,onClose:()=>Ee(!1),maxWidth:"sm",fullWidth:!0,children:[(0,de.jsx)(k.A,{children:"Edit Profile"}),(0,de.jsx)(I.A,{children:(0,de.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,de.jsx)(z.A,{label:"Name",value:Qe,onChange:e=>Xe(e.target.value),fullWidth:!0,variant:"outlined",placeholder:"Name"}),(0,de.jsxs)(d.A,{children:[(0,de.jsx)(z.A,{label:"Username",value:et,onChange:e=>{const t=e.target.value;if(tt(t),t===St.current)return vt(!1),jt(null),void Ct(!1);/^[a-zA-Z0-9_-]+$/.test(t)?t.length<3?jt("Username must be at least 3 characters long"):jt(null):jt("Username can only contain letters, numbers, underscores, and hyphens")},fullWidth:!0,variant:"outlined",placeholder:"Username",InputProps:{startAdornment:(0,de.jsx)(M.A,{position:"start",children:"@"}),endAdornment:pt&&(0,de.jsx)(M.A,{position:"end",children:(0,de.jsx)(x.A,{size:20})})},error:!!At,helperText:At}),wt&&(0,de.jsxs)(n.A,{elevation:2,sx:{mt:.5,p:1,maxHeight:150,overflow:"auto"},children:[(0,de.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"Suggested alternatives:"}),(0,de.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:.5},children:yt.map((e=>(0,de.jsx)(S.A,{label:e,size:"small",color:"primary",variant:"outlined",onClick:()=>(e=>{tt(e),vt(!1),jt(null),Ct(!1)})(e),sx:{cursor:"pointer"}},e)))})]})]}),(0,de.jsx)(z.A,{label:"Bio",value:$e,onChange:e=>Ke(e.target.value),multiline:!0,rows:4,fullWidth:!0,variant:"outlined",placeholder:"Bio",helperText:"".concat($e.length,"/150 characters"),inputProps:{maxLength:150}})]})}),(0,de.jsxs)(U.A,{sx:{p:3},children:[(0,de.jsx)(A.A,{variant:"outlined",onClick:()=>Ee(!1),sx:{textTransform:"none",minWidth:"100px"},children:"Cancel"}),(0,de.jsx)(A.A,{variant:"contained",onClick:async()=>{if(ie&&ue)if(et!==St.current&&gt)oe.oR.error("Please choose a unique username");else if(/^[a-zA-Z0-9_-]+$/.test(et))if(et.length<3)oe.oR.error("Username must be at least 3 characters long");else try{Ie(!0);const e=(0,X.H9)(ue,"users",ie.uid);await(0,X.mZ)(e,{name:Qe,username:et,bio:$e,updatedAt:(0,X.O5)()}),ye(Qe),Ae(et),Se($e),Ee(!1),oe.oR.success("Profile updated successfully")}catch(ze){console.error("Error updating profile:",ze),Me("Failed to update profile"),oe.oR.error("Failed to update profile")}finally{Ie(!1)}else oe.oR.error("Username can only contain letters, numbers, underscores, and hyphens")},disabled:ke||gt||!!At,sx:{textTransform:"none",minWidth:"100px"},children:ke?"Saving...":"Save"})]})]}),(0,de.jsxs)(E.A,{open:xt,onClose:()=>ut(!1),children:[(0,de.jsx)(k.A,{children:"Block User"}),(0,de.jsxs)(I.A,{children:[(0,de.jsxs)(l.A,{variant:"body1",children:["Are you sure you want to block @",fe,"?"]}),(0,de.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["When you block someone:",(0,de.jsxs)("ul",{children:[(0,de.jsx)("li",{children:"They won't be able to see your profile"}),(0,de.jsx)("li",{children:"They will be removed from your followers"}),(0,de.jsx)("li",{children:"Their rooms won't appear in your discover and side room pages"}),(0,de.jsx)("li",{children:"You won't see their messages"})]})]})]}),(0,de.jsxs)(U.A,{children:[(0,de.jsx)(A.A,{onClick:()=>ut(!1),children:"Cancel"}),(0,de.jsx)(A.A,{onClick:async()=>{if(ie&&Jt)try{await xe(Jt),ut(!1),at("/discover"),oe.oR.success("You have blocked @".concat(fe))}catch(ze){console.error("Error blocking user:",ze),oe.oR.error("Failed to block user")}},color:"error",variant:"contained",children:"Block"})]})]}),(0,de.jsxs)(E.A,{open:ht,onClose:()=>mt(!1),children:[(0,de.jsx)(k.A,{children:"Report User"}),(0,de.jsxs)(I.A,{children:[(0,de.jsxs)(l.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting @",fe,"?"]}),(0,de.jsx)(P.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Misinformation","Impersonation","Other"].map((e=>(0,de.jsx)(H.Ay,{onClick:()=>(async e=>{if(ie&&Jt&&ue)try{const t=(0,X.rJ)(ue,"reports");await(0,X.gS)(t,{reporterId:ie.uid,reportedUserId:Jt,reason:e,timestamp:(0,X.O5)(),status:"pending"}),mt(!1),oe.oR.success("Report submitted")}catch(ze){console.error("Error reporting user:",ze),oe.oR.error("Failed to submit report")}})(e),sx:{borderRadius:1,cursor:"pointer"},children:(0,de.jsx)(f.A,{primary:e})},e)))})]}),(0,de.jsx)(U.A,{children:(0,de.jsx)(A.A,{onClick:()=>mt(!1),children:"Cancel"})})]}),(0,de.jsx)(E.A,{open:Ut,onClose:()=>Pt(!1),fullScreen:!0,PaperProps:{sx:{bgcolor:"black",color:"white",margin:0,maxHeight:"100vh",maxWidth:"100vw"}},TransitionProps:{timeout:300},children:kt.length>0&&kt[Ht]&&(0,de.jsxs)(d.A,{sx:{position:"relative",height:"100vh",width:"100vw",overflow:"hidden",bgcolor:"black"},children:[(0,de.jsx)(d.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1},children:kt[Ht].mediaUrl?"video"===kt[Ht].mediaType?(0,de.jsx)("video",{src:kt[Ht].mediaUrl,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}):(0,de.jsx)("img",{src:kt[Ht].mediaUrl,alt:"Story",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}):(0,de.jsx)(d.A,{sx:{width:"100%",height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center"}})}),(0,de.jsx)(d.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 80%, rgba(0,0,0,0.3) 100%)",zIndex:2}}),(0,de.jsx)(d.A,{sx:{position:"absolute",top:20,left:16,right:16,zIndex:10,display:"flex",gap:4},children:kt.map(((e,t)=>(0,de.jsx)(d.A,{sx:{flex:1,height:3,bgcolor:"rgba(255,255,255,0.3)",borderRadius:2,overflow:"hidden"},children:(0,de.jsx)(d.A,{sx:{height:"100%",width:t<Ht?"100%":t===Ht?"".concat(Gt,"%"):"0%",bgcolor:"white",transition:t===Ht?"none":"width 0.3s ease"}})},t)))}),(0,de.jsxs)(d.A,{sx:{position:"absolute",top:40,left:16,right:16,zIndex:10,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,de.jsx)(v.A,{src:kt[Ht].userAvatar,sx:{width:40,height:40,border:"2px solid white"},children:null===(e=kt[Ht].username[0])||void 0===e?void 0:e.toUpperCase()}),(0,de.jsxs)(d.A,{children:[(0,de.jsx)(l.A,{variant:"subtitle1",sx:{fontWeight:600,fontSize:16,textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},children:kt[Ht].username}),(0,de.jsx)(l.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.8)",fontSize:12,textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},children:null===(t=kt[Ht].createdAt)||void 0===t?void 0:t.toDate().toLocaleTimeString()})]})]}),(0,de.jsxs)(d.A,{sx:{display:"flex",gap:1},children:[kt[Ht].userId===(null===ie||void 0===ie?void 0:ie.uid)&&(0,de.jsx)(u.A,{onClick:()=>Yt(!0),sx:{color:"white",bgcolor:"rgba(0,0,0,0.3)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(255,0,0,0.5)"}},children:(0,de.jsx)(l.A,{sx:{fontSize:18},children:"\ud83d\uddd1\ufe0f"})}),(0,de.jsx)(u.A,{onClick:()=>Pt(!1),sx:{color:"white",bgcolor:"rgba(0,0,0,0.3)",backdropFilter:"blur(10px)","&:hover":{bgcolor:"rgba(0,0,0,0.5)"}},children:(0,de.jsx)(q.A,{})})]})]}),kt[Ht].content&&(0,de.jsx)(d.A,{sx:{position:"absolute",bottom:100,left:20,right:20,zIndex:10,textAlign:"center"},children:(0,de.jsx)(l.A,{variant:"h5",sx:{fontWeight:600,fontSize:{xs:20,sm:24},textShadow:"2px 2px 8px rgba(0,0,0,0.8)",lineHeight:1.3,wordBreak:"break-word"},children:kt[Ht].content})}),kt[Ht].userId===(null===ie||void 0===ie?void 0:ie.uid)&&!Tt&&(0,de.jsxs)(d.A,{onClick:()=>(async e=>{if(ie&&ue)try{const t=(0,X.H9)(ue,"stories",e),s=await(0,X.x7)(t);if(s.exists()){const e=s.data().views||[],t=[];for(const s of e){const e=(0,X.H9)(ue,"users",s),o=await(0,X.x7)(e);if(o.exists()){const e=o.data();t.push({id:s,username:e.username||e.name||"Unknown User",avatar:e.profilePic||e.photoURL||""})}}Bt(t),Wt(!0)}}catch(ze){console.error("Error getting story viewers:",ze),oe.oR.error("Failed to load viewers")}})(kt[Ht].id),sx:{position:"absolute",bottom:0,left:0,right:0,height:120,zIndex:15,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",pb:3,background:"linear-gradient(to top, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 100%)"},children:[(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1,bgcolor:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:3,backdropFilter:"blur(10px)"},children:[(0,de.jsx)(l.A,{sx:{fontSize:16},children:"\ud83d\udc41\ufe0f"}),(0,de.jsxs)(l.A,{variant:"body2",sx:{color:"white",fontWeight:500},children:[(null===(s=kt[Ht].views)||void 0===s?void 0:s.length)||0," views"]})]}),(0,de.jsx)(l.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.8)",mt:1,textShadow:"1px 1px 2px rgba(0,0,0,0.8)"},children:"Tap to see who viewed your story"})]}),Tt&&kt[Ht].userId===(null===ie||void 0===ie?void 0:ie.uid)&&(0,de.jsxs)(d.A,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"50vh",bgcolor:"rgba(0,0,0,0.9)",backdropFilter:"blur(20px)",zIndex:20,borderTopLeftRadius:20,borderTopRightRadius:20,display:"flex",flexDirection:"column"},children:[(0,de.jsx)(d.A,{sx:{width:36,height:5,bgcolor:"rgba(255,255,255,0.3)",borderRadius:3,mx:"auto",mt:1,mb:2}}),(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,pb:2},children:[(0,de.jsxs)(l.A,{variant:"h6",sx:{color:"white",fontWeight:600},children:["Viewed by ",Nt.length]}),(0,de.jsx)(u.A,{onClick:()=>Wt(!1),sx:{color:"white"},children:(0,de.jsx)(q.A,{})})]}),(0,de.jsx)(d.A,{sx:{flex:1,overflow:"auto",px:3},children:0===Nt.length?(0,de.jsxs)(d.A,{sx:{textAlign:"center",py:4,color:"rgba(255,255,255,0.7)"},children:[(0,de.jsx)(l.A,{sx:{fontSize:48,mb:2},children:"\ud83d\udc41\ufe0f"}),(0,de.jsx)(l.A,{variant:"body1",sx:{color:"white"},children:"No views yet"}),(0,de.jsx)(l.A,{variant:"body2",children:"When people view your story, you'll see them here"})]}):(0,de.jsx)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:Nt.map((e=>{var t;return(0,de.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2,py:1},children:[(0,de.jsx)(v.A,{src:e.avatar,sx:{width:50,height:50},children:null===(t=e.username[0])||void 0===t?void 0:t.toUpperCase()}),(0,de.jsx)(d.A,{sx:{flex:1},children:(0,de.jsx)(l.A,{variant:"body1",sx:{fontWeight:500,color:"white"},children:e.username})})]},e.id)}))})})]}),(0,de.jsx)(d.A,{sx:{position:"absolute",left:0,top:100,bottom:Tt?"50vh":150,width:"40%",cursor:"pointer",zIndex:5,display:"flex",alignItems:"center",justifyContent:"flex-start",pl:2},onClick:()=>{Ht>0&&(Ft(Ht-1),Dt(0))},children:Ht>0&&(0,de.jsx)(J.A,{sx:{color:"rgba(255,255,255,0.0)",fontSize:40,transition:"color 0.2s ease","&:hover":{color:"rgba(255,255,255,0.7)"}}})}),(0,de.jsx)(d.A,{sx:{position:"absolute",right:0,top:100,bottom:Tt?"50vh":150,width:"40%",cursor:"pointer",zIndex:5,display:"flex",alignItems:"center",justifyContent:"flex-end",pr:2},onClick:()=>{const e=Ht+1;e<kt.length?(Ft(e),Dt(0),kt[e].userId!==(null===ie||void 0===ie?void 0:ie.uid)&&Qt(kt[e].id)):Pt(!1)},children:(0,de.jsx)(Z.A,{sx:{color:"rgba(255,255,255,0.0)",fontSize:40,transition:"color 0.2s ease","&:hover":{color:"rgba(255,255,255,0.7)"}}})})]})}),(0,de.jsx)(E.A,{open:Lt,onClose:()=>Yt(!1),PaperProps:{sx:{borderRadius:3,bgcolor:"#1c1c1e",color:"white"}},children:(0,de.jsxs)(d.A,{sx:{p:3,textAlign:"center"},children:[(0,de.jsx)(l.A,{sx:{fontSize:48,mb:2},children:"\ud83d\uddd1\ufe0f"}),(0,de.jsx)(l.A,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Delete Story?"}),(0,de.jsx)(l.A,{variant:"body2",sx:{color:"rgba(255,255,255,0.7)",mb:3,lineHeight:1.5},children:"This story will be permanently deleted and removed from your profile."}),(0,de.jsxs)(d.A,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[(0,de.jsx)(A.A,{onClick:()=>Yt(!1),variant:"outlined",sx:{color:"white",borderColor:"rgba(255,255,255,0.3)",px:3,py:1,borderRadius:2,"&:hover":{borderColor:"rgba(255,255,255,0.5)",bgcolor:"rgba(255,255,255,0.05)"}},children:"Cancel"}),(0,de.jsx)(A.A,{onClick:()=>{kt[Ht]&&(async e=>{if(ie&&ue)try{await(0,X.kd)((0,X.H9)(ue,"stories",e)),Wt(!1),Pt(!1),Yt(!1),oe.oR.success("Story deleted successfully!"),setTimeout((async()=>{await Zt()}),500)}catch(ze){console.error("Error deleting story:",ze),oe.oR.error("Failed to delete story")}})(kt[Ht].id)},variant:"contained",sx:{bgcolor:"#ff3b30",color:"white",px:3,py:1,borderRadius:2,"&:hover":{bgcolor:"#d70015"}},children:"Delete"})]})]})})]})}},6592:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group")},7286:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"}),"PersonRemove")},7443:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite")},7565:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3m1-4.3h-2V7h2z"}),"Report")},8692:(e,t,s)=>{s.d(t,{A:()=>i});var o=s(3235),r=s(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home")}}]);