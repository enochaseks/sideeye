"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[736],{3380:(e,o,r)=>{r.d(o,{A:()=>l});var t=r(9379),n=(r(9950),r(6491)),i=r(2053),a=r(7497),s=r(4414);const l=e=>{let{size:o="medium",color:r="#FFD700",value:l,showValue:d=!0,sx:c={}}=e;const{width:u,height:m,fontSize:h,valueSize:x}=(()=>{switch(o){case"small":return{width:20,height:20,fontSize:"0.6rem",valueSize:"0.75rem"};case"large":return{width:32,height:32,fontSize:"0.8rem",valueSize:"1rem"};default:return{width:24,height:24,fontSize:"0.7rem",valueSize:"0.875rem"}}})(),p=(0,s.jsx)(n.A,{sx:{width:u,height:m,borderRadius:"50%",background:"linear-gradient(145deg, ".concat(r,", ").concat((0,a.X4)(r,.7),")"),border:"2px solid ".concat((0,a.X4)(r,.8)),display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxShadow:"\n                    inset 0 2px 4px ".concat((0,a.X4)("#fff",.3),",\n                    inset 0 -2px 4px ").concat((0,a.X4)("#000",.2),",\n                    0 2px 8px ").concat((0,a.X4)(r,.3),"\n                "),"&::before":{content:'""',position:"absolute",top:"15%",left:"15%",right:"15%",bottom:"15%",borderRadius:"50%",border:"1px solid ".concat((0,a.X4)(r,.6)),background:"linear-gradient(145deg, ".concat((0,a.X4)("#fff",.1),", transparent)")}},children:(0,s.jsx)(i.A,{variant:"caption",sx:{fontSize:h,fontWeight:"bold",color:"#000",textShadow:"0 1px 2px ".concat((0,a.X4)("#fff",.8)),zIndex:1,lineHeight:1},children:"SC"})});return void 0!==l&&d?(0,s.jsxs)(n.A,{sx:(0,t.A)({display:"flex",alignItems:"center",gap:.5},c),children:[p,(0,s.jsx)(i.A,{variant:"caption",sx:{fontSize:x,fontWeight:"medium",color:"text.primary"},children:l})]}):(0,s.jsx)(n.A,{sx:c,children:p})}},4454:(e,o,r)=>{r.d(o,{A:()=>s});r(9950);var t=r(6491),n=r(2053),i=r(5277),a=r(4414);const s=e=>{let{links:o}=e;return o&&0!==o.length?(0,a.jsxs)(t.A,{mt:1,children:[(0,a.jsx)(n.A,{variant:"caption",sx:{display:"block",color:"text.secondary",fontStyle:"italic",mb:.5},children:"Sources:"}),(0,a.jsx)(t.A,{display:"flex",flexWrap:"wrap",gap:.5,children:o.map(((e,o)=>(0,a.jsx)(i.A,{size:"small",label:e.title,component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",clickable:!0,sx:{maxWidth:"100%","& .MuiChip-label":{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},fontSize:"0.7rem",backgroundColor:"rgba(0, 0, 0, 0.05)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}},o)))})]}):null}},9736:(e,o,r)=>{r.r(o),r.d(o,{default:()=>Uo});var t=r(9379),n=r(9950),i=r(8429),a=r(2074),s=r(1367),l=r(330),d=r(6220),c=r(5887),u=r(6491),m=r(4857),h=r(3274),x=r(5333),p=r(2053),v=r(1413),g=r(4447),f=r(7591),b=r(3266),y=r(4195),A=r(226),C=r(6639),w=r(3174),j=r(899),S=r(2235),k=r(6583),I=r(33),R=r(8170),E=r(8145),P=r(9739),F=r(4745),U=r(5277),D=r(249),T=r(6050),O=r(5979),N=r(3788),z=r(6101),M=r(6497),W=r(7324),H=r(9325),L=r(8614),G=r(3563),B=r(2236),X=r(4142),V=r(7497),_=r(7443),Y=r(5965),q=r(2682),J=r(9316),Z=r(227),K=r(6904),Q=r(7565),$=r(9575),ee=r(1679),oe=r(7341),re=r(5204),te=r(6281),ne=r(379),ie=r(1300),ae=r(1770),se=r(760),le=r(7319),de=r(492),ce=r(8008),ue=r(1902),me=r(5855),he=r(9939),xe=r(529),pe=r(9404),ve=r(5379),ge=r(361),fe=r(1675),be=r(9715),ye=r(6164),Ae=r(6835),Ce=r(6117),we=r(2960),je=r(1673),Se=r(2600),ke=r(7286),Ie=r(4414);const Re=e=>{var o;let{open:r,onClose:i,onSubmit:a,initialData:s,title:l="Create Room",submitButtonText:d="Create"}=e;const[c,m]=(0,n.useState)({name:(null===s||void 0===s?void 0:s.name)||"",description:(null===s||void 0===s?void 0:s.description)||"",isPrivate:(null===s||void 0===s?void 0:s.isPrivate)||!1,password:(null===s||void 0===s?void 0:s.password)||"",tags:(null===s||void 0===s?void 0:s.tags)||[]}),[h,x]=(0,n.useState)(null);return(0,Ie.jsx)(k.A,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,children:(0,Ie.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(c,h)},children:[(0,Ie.jsx)(I.A,{children:l}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Ie.jsx)(E.A,{label:"Name",value:c.name,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{name:e.target.value}))),required:!0,fullWidth:!0}),(0,Ie.jsx)(E.A,{label:"Description",value:c.description,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{description:e.target.value}))),multiline:!0,rows:3,fullWidth:!0}),(0,Ie.jsx)(M.A,{control:(0,Ie.jsx)(W.A,{checked:c.isPrivate,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{isPrivate:e.target.checked})))}),label:"Private Room"}),c.isPrivate&&(0,Ie.jsx)(E.A,{label:"Password",type:"password",value:c.password,onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{password:e.target.value}))),required:c.isPrivate,fullWidth:!0}),(0,Ie.jsxs)(u.A,{sx:{mt:1},children:[(0,Ie.jsxs)(A.A,{variant:"outlined",component:"label",fullWidth:!0,children:["Upload Thumbnail",(0,Ie.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]?x(e.target.files[0]):x(null)}})]}),h&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1},children:["Selected: ",h.name]}),!h&&(null===s||void 0===s?void 0:s.thumbnailUrl)&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1},children:["Current: ",s.thumbnailUrl.substring(s.thumbnailUrl.lastIndexOf("/")+1)]})]}),(0,Ie.jsx)(E.A,{label:"Tags (comma separated)",value:null===(o=c.tags)||void 0===o?void 0:o.join(", "),onChange:e=>m((o=>(0,t.A)((0,t.A)({},o),{},{tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}))),fullWidth:!0,helperText:"Enter tags separated by commas"})]})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:i,children:"Cancel"}),(0,Ie.jsx)(A.A,{type:"submit",variant:"contained",color:"primary",children:d})]})]})})};var Ee=r(9874),Pe=r(9317),Fe=r(6932),Ue=r(9751),De=r(2856),Te=r(1397),Oe=r(3422),Ne=r(4454),ze=r(4862);const Me=[{value:"harassment",label:"Harassment"},{value:"hate_speech",label:"Hate Speech"},{value:"spam",label:"Spam"},{value:"inappropriate",label:"Inappropriate Content"},{value:"misinformation",label:"Misinformation"},{value:"copyright",label:"Copyright Violation"},{value:"privacy",label:"Privacy Violation"},{value:"other",label:"Other"}],We=e=>{let{contentId:o,contentType:r,onClose:i,open:a,ownerUsername:c}=e;const{currentUser:m}=(0,s.As)(),[h,x]=(0,n.useState)(null),[v,g]=(0,n.useState)(""),[f,y]=(0,n.useState)(""),[j,U]=(0,n.useState)(null),[D,T]=(0,n.useState)(!1),[O,N]=(0,n.useState)({open:!1,message:""});(0,n.useEffect)((()=>{a&&z()}),[a]);const z=async()=>{try{let a="";switch(r){case"sideRoom":a="sideRooms";break;case"message":a="messages";break;case"chatRoom":a="chatRooms";break;case"sadeAI":a="sadeAIChats";break;case"user":a="users";break;default:a="unknown"}if("unknown"===a)return console.error("Unknown content type:",r),void U("Failed to determine content type");const s=(0,d.H9)(l.db,a,o),u=await(0,d.x7)(s);if(u.exists()){var e,t,n,i;const o=u.data();x({title:(null===o||void 0===o?void 0:o.title)||(null===o||void 0===o?void 0:o.name)||(null===o||void 0===o?void 0:o.username),content:(null===o||void 0===o?void 0:o.content)||(null===o||void 0===o?void 0:o.text)||(null===o||void 0===o?void 0:o.description),author:c||(null===o||void 0===o?void 0:o.authorName)||(null===o||void 0===o?void 0:o.username)||"Unknown",timestamp:null!==o&&void 0!==o&&null!==(e=o.timestamp)&&void 0!==e&&null!==(t=e.toDate)&&void 0!==t&&t.call(e)?o.timestamp.toDate().toISOString():null!==o&&void 0!==o&&null!==(n=o.createdAt)&&void 0!==n&&null!==(i=n.toDate)&&void 0!==i&&i.call(n)?o.createdAt.toDate().toISOString():(new Date).toISOString()})}else console.log("Preview document does not exist!"),x(null)}catch(j){console.error("Error fetching content:",j),U("Failed to fetch content")}};return(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsxs)(k.A,{open:a,onClose:i,maxWidth:"md",fullWidth:!0,children:[(0,Ie.jsxs)(I.A,{children:["Report ",(()=>{switch(r){case"sideRoom":return"Side Room";case"message":return"Message";case"chatRoom":return"Chat Room";case"sadeAI":return"Sade AI Chat";case"user":return"User";default:return"Content"}})()]}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:3,pt:2},children:[h&&(0,Ie.jsxs)(S.A,{elevation:1,sx:{p:2},children:[(0,Ie.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Content Preview"}),h.title&&(0,Ie.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:h.title}),h.content&&(0,Ie.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:h.content}),h.author&&(0,Ie.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:["By: ",h.author]})]}),(0,Ie.jsx)(F.A,{}),(0,Ie.jsx)(E.A,{select:!0,label:"Report Type",value:v,onChange:e=>g(e.target.value),fullWidth:!0,required:!0,children:Me.map((e=>(0,Ie.jsx)(b.A,{value:e.value,children:e.label},e.value)))}),(0,Ie.jsx)(E.A,{label:"Description",value:f,onChange:e=>y(e.target.value),multiline:!0,rows:4,fullWidth:!0,required:!0,placeholder:"Please provide details about why you are reporting this content..."}),j&&(0,Ie.jsx)(w.A,{severity:"error",sx:{mt:2},children:j})]})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:i,disabled:D,children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:async()=>{if(m&&l.db)try{T(!0),U("");let e="";switch(r){case"sideRoom":e="sideRooms";break;case"message":e="messages";break;case"chatRoom":e="chatRooms";break;case"sadeAI":e="sadeAIChats";break;case"user":e="users";break;default:e="unknown"}const t=(0,d.rJ)(l.db,"reports");await(0,d.gS)(t,{type:v,description:f,reporterId:m.uid,contentId:o,contentType:r,collectionName:e,timestamp:(0,d.O5)()});const n=(0,d.rJ)(l.db,"notifications","admin","reports");await(0,d.gS)(n,{contentId:o,contentType:r,collectionName:e,reporterId:m.uid,timestamp:(0,d.O5)()}),N({open:!0,message:"Report submitted successfully. Our team will review it shortly."}),i()}catch(j){console.error("Error submitting report:",j),U("Failed to submit report")}finally{T(!1)}},variant:"contained",color:"primary",disabled:D,children:D?(0,Ie.jsx)(C.A,{size:24}):"Submit Report"})]})]}),(0,Ie.jsx)(ze.A,{open:O.open,autoHideDuration:6e3,onClose:()=>N((0,t.A)((0,t.A)({},O),{},{open:!1})),children:(0,Ie.jsx)(w.A,{onClose:()=>N((0,t.A)((0,t.A)({},O),{},{open:!1})),severity:"success",sx:{width:"100%"},children:O.message})})]})},He=e=>{var o;let{open:r,onClose:t,roomName:i,roomLink:a,onSend:s,currentUserId:m}=e;const[h,x]=(0,n.useState)(""),[g,f]=(0,n.useState)([]),[b,y]=(0,n.useState)(!1),[w,j]=(0,n.useState)(null),[S,O]=(0,n.useState)([]),[N,z]=(0,n.useState)(!1),M=(0,n.useCallback)((async()=>{if(m&&l.db){z(!0);try{const e=(0,d.rJ)(l.db,"rooms"),o=(0,d.P)(e,(0,d._M)("members","array-contains",m)),r=await(0,d.GG)(o),t=[];r.forEach((e=>{const o=e.data();t.push({id:e.id,name:o.name||"Chat Room"})})),O(t)}catch(e){console.error("Error fetching server chat rooms:",e),c.oR.error("Failed to load server chat rooms")}finally{z(!1)}}}),[m]);(0,n.useEffect)((()=>{r&&M()}),[r,M]);const W=(0,n.useCallback)((async e=>{if(!e.trim()||e.length<2)f([]);else{y(!0);try{const o=(0,d.rJ)(l.db,"users"),r=(0,d.P)(o,(0,d.AB)(50)),t=await(0,d.GG)(r),n=[],i=e.toLowerCase();t.forEach((e=>{if(e.id!==m){var o;const r=e.data();null!==(o=r.username)&&void 0!==o&&o.toLowerCase().includes(i)&&n.push({id:e.id,username:r.username||"",displayName:r.displayName,photoURL:r.photoURL||r.profilePic,email:r.email})}})),f(n)}catch(o){console.error("Error searching users:",o),c.oR.error("Failed to search users"),f([])}finally{y(!1)}}}),[m]);(0,n.useEffect)((()=>{const e=setTimeout((()=>{W(h)}),500);return()=>clearTimeout(e)}),[h,W]);return(0,Ie.jsxs)(k.A,{open:r,onClose:t,fullWidth:!0,maxWidth:"xs",children:[(0,Ie.jsx)(I.A,{children:"Share Room via Message"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{mt:2},children:[(0,Ie.jsx)(E.A,{fullWidth:!0,label:"Search Users",variant:"outlined",value:h,onChange:e=>x(e.target.value),placeholder:"Type username to search...",disabled:!!w}),b&&(0,Ie.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Ie.jsx)(C.A,{size:24})}),!b&&g.length>0&&!w&&(0,Ie.jsx)(D.A,{sx:{mt:2,maxHeight:300,overflow:"auto"},children:g.map((e=>{var o;return(0,Ie.jsxs)(T.Ay,{button:!0,onClick:()=>(e=>{j(e),x(""),f([])})(e),children:[(0,Ie.jsx)(L.A,{children:(0,Ie.jsx)(v.A,{src:e.photoURL||void 0,alt:e.username,sx:{width:40,height:40},children:null===(o=e.username[0])||void 0===o?void 0:o.toUpperCase()})}),(0,Ie.jsx)(G.A,{primary:e.username,secondary:e.displayName||e.email})]},e.id)}))}),w&&(0,Ie.jsxs)(u.A,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",children:"Selected User:"}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,Ie.jsx)(v.A,{src:w.photoURL||void 0,alt:w.username,sx:{width:40,height:40},children:null===(o=w.username[0])||void 0===o?void 0:o.toUpperCase()}),(0,Ie.jsx)(p.A,{sx:{ml:1},children:w.username}),(0,Ie.jsx)(A.A,{size:"small",onClick:()=>j(null),sx:{ml:"auto"},children:"Change"})]})]}),!b&&h.length>=2&&0===g.length&&(0,Ie.jsx)(p.A,{color:"text.secondary",sx:{mt:2,textAlign:"center"},children:"No users found"}),(0,Ie.jsx)(F.A,{sx:{mt:3,mb:2},children:(0,Ie.jsx)(U.A,{label:"Room + Server Chat"})}),N?(0,Ie.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,Ie.jsx)(C.A,{size:24})}):S.length>0?(0,Ie.jsx)(D.A,{sx:{mt:2},children:S.map((e=>(0,Ie.jsx)(T.Ay,{button:!0,onClick:()=>(async(e,o)=>{try{const r=(0,d.H9)(l.db,"rooms",e);if(!(await(0,d.x7)(r)).exists())return void c.oR.error("Room not found");const n="Check out this room".concat(o?": ".concat(o):"","! ").concat(a);await s(e,n),c.oR.success("Message sent to ".concat(o)),t()}catch(r){console.error("Error sending message to server chat:",r),c.oR.error("Failed to send message to server chat")}})(e.id,e.name),sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover"}},children:(0,Ie.jsx)(G.A,{primary:e.name,secondary:"Room + Server Chat"})},e.id)))}):(0,Ie.jsx)(p.A,{color:"text.secondary",sx:{textAlign:"center"},children:"No Room + Server Chats available"})]})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:t,children:"Cancel"}),(0,Ie.jsx)(A.A,{variant:"contained",onClick:async()=>{if(w)try{const e="Check out this room".concat(i?": ".concat(i):"","! ").concat(a);await s(w.id,e),c.oR.success("Message sent to ".concat(w.username)),t()}catch(e){console.error("Error sending message:",e),c.oR.error("Failed to send message")}else c.oR.error("Please select a user first")},disabled:!w,children:"Send"})]})]})};var Le,Ge,Be,Xe,Ve,_e=r(7528),Ye=r(6319),qe=r(8713),Je=r(2183),Ze=r(2375),Ke=r(2631),Qe=r(6389),$e=r(8283),eo=r(3380);const oo=e=>({"heart-gift":.5,"side-eye-gift":.75,"confetti-gift":1,"crown-gift":2}[e]||.5),ro=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP";return new Intl.NumberFormat("en-GB",{style:"currency",currency:o,minimumFractionDigits:2}).format(e)},to=e=>e.toFixed(2),no=e=>.8*e/.005,io=(0,$e.i7)(Le||(Le=(0,_e.A)(["\n  0% { transform: translateY(0) scale(1); }\n  50% { transform: translateY(-20px) scale(1.2); }\n  100% { transform: translateY(-40px) scale(0.8); opacity: 0; }\n"]))),ao=(0,$e.i7)(Ge||(Ge=(0,_e.A)(["\n  0% { transform: scale(1); opacity: 1; }\n  50% { transform: scale(1.3); opacity: 0.7; }\n  100% { transform: scale(1); opacity: 1; }\n"]))),so=(0,$e.i7)(Be||(Be=(0,_e.A)(["\n  0% { transform: translateX(0); }\n  20% { transform: translateX(-15px); }\n  40% { transform: translateX(15px); }\n  60% { transform: translateX(-15px); }\n  80% { transform: translateX(15px); }\n  100% { transform: translateX(0); }\n"]))),lo=(0,$e.i7)(Xe||(Xe=(0,_e.A)(["\n  0% { transform: translateY(20px) scale(0.5); opacity: 0; }\n  20% { transform: translateY(0) scale(1.2); opacity: 1; }\n  40% { transform: translateY(-10px) scale(1.0); }\n  60% { transform: rotate(-10deg); }\n  80% { transform: rotate(10deg); }\n  100% { transform: rotate(0) scale(1.1); }\n"]))),co=(0,$e.i7)(Ve||(Ve=(0,_e.A)(["\n  0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }\n  100% { transform: translate(var(--x-end), var(--y-end)) rotate(var(--rotation)); opacity: 0; }\n"]))),uo=e=>{let{color:o,delay:r,size:t}=e;const n=300*Math.random()-150,i=200*Math.random()-50,a=360*Math.random();return(0,Ie.jsx)(u.A,{sx:{position:"absolute",width:t,height:t,backgroundColor:o,borderRadius:"2px",opacity:1,animation:"".concat(co," 2s forwards ease-out"),animationDelay:"".concat(r,"ms"),"--x-end":"".concat(n,"px"),"--y-end":"".concat(i,"px"),"--rotation":"".concat(a,"deg")}})},mo=()=>{const e=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#ff9900","#9900ff"],o=[];for(let r=0;r<100;r++){const t=e[Math.floor(Math.random()*e.length)],n=500*Math.random(),i=6*Math.random()+4;o.push((0,Ie.jsx)(uo,{color:t,delay:n,size:i},r))}return(0,Ie.jsx)(u.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:0,height:0},children:o})},ho=e=>{let{color:o}=e;return(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",gap:3,animation:"".concat(so," 1.5s ease-in-out infinite")},children:[(0,Ie.jsx)(u.A,{sx:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"white",display:"flex",justifyContent:"flex-end",alignItems:"center",border:"2px solid black",overflow:"hidden"},children:(0,Ie.jsx)(u.A,{sx:{width:"25px",height:"25px",borderRadius:"50%",backgroundColor:o,marginRight:"2px"}})}),(0,Ie.jsx)(u.A,{sx:{width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"white",display:"flex",justifyContent:"flex-end",alignItems:"center",border:"2px solid black",overflow:"hidden"},children:(0,Ie.jsx)(u.A,{sx:{width:"25px",height:"25px",borderRadius:"50%",backgroundColor:o,marginRight:"2px"}})})]})},xo=e=>{let{gift:o,onAnimationComplete:r}=e;(0,n.useEffect)((()=>{const e=setTimeout((()=>{r()}),2500);return()=>clearTimeout(e)}),[r]);return(0,Ie.jsx)(u.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,pointerEvents:"none",bgcolor:"rgba(0, 0, 0, 0.3)"},children:(()=>{switch(o.id){case"side-eye-gift":return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",animation:"".concat(io," 2.5s ease-out forwards")},children:[(0,Ie.jsx)(ho,{color:o.color}),(0,Ie.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:"Side Eye!"})]});case"crown-gift":return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(u.A,{sx:{color:o.color,fontSize:120,filter:"drop-shadow(0 0 20px rgba(255,215,0,0.8))",animation:"".concat(lo," 2s ease-out forwards"),transformOrigin:"center bottom"},children:(0,Ie.jsx)(Qe.A,{fontSize:"inherit"})}),(0,Ie.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:"Crown!"})]});case"confetti-gift":return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[(0,Ie.jsx)(mo,{}),(0,Ie.jsx)(u.A,{sx:{color:o.color,fontSize:100,animation:"".concat(ao," 0.5s ease-in-out infinite"),filter:"drop-shadow(0 0 10px rgba(255,255,255,0.7))",zIndex:1},children:(0,Ie.jsx)(Ke.A,{fontSize:"inherit"})}),(0,Ie.jsx)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2,zIndex:1},children:"Confetti!"})]});default:return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",animation:"".concat(io," 2.5s ease-out forwards")},children:[(0,Ie.jsx)(u.A,{sx:{color:o.color,fontSize:100,animation:"".concat(ao," 0.5s ease-in-out infinite"),filter:"drop-shadow(0 0 10px rgba(255,255,255,0.7))"},children:o.icon}),(0,Ie.jsxs)(p.A,{variant:"h5",sx:{color:"white",fontWeight:"bold",textShadow:"0 0 10px rgba(0,0,0,0.5)",mt:2},children:[o.name,"!"]})]})}})()})},po=e=>{let{roomId:o,roomOwnerId:r,theme:i,roomStyle:a}=e;const{currentUser:m}=(0,s.As)(),[h,v]=(0,n.useState)([{id:"side-eye-gift",type:"basic",name:"Side Eye",icon:(0,Ie.jsx)(Ze.A,{}),value:oo("side-eye-gift"),color:"#9C27B0"},{id:"heart-gift",type:"basic",name:"Heart",icon:(0,Ie.jsx)(Je.A,{}),value:oo("heart-gift"),color:"#FF5C8D"},{id:"confetti-gift",type:"basic",name:"Confetti",icon:(0,Ie.jsx)(Ke.A,{}),value:oo("confetti-gift"),color:"#FF9800"},{id:"crown-gift",type:"basic",name:"Crown",icon:(0,Ie.jsx)(Qe.A,{}),value:oo("crown-gift"),color:"#FFC107"}]),[g,f]=(0,n.useState)([]),b=(0,n.useMemo)((()=>[...h,...g]),[h,g]),[y,F]=(0,n.useState)([]),[D,T]=(0,n.useState)(null),[O,N]=(0,n.useState)(!1),[z,M]=(0,n.useState)(!1),[W,H]=(0,n.useState)(!1),[L,G]=(0,n.useState)(null),[B,X]=(0,n.useState)(!1),[_,Y]=(0,n.useState)(!1),[q,J]=(0,n.useState)(!1),[Z,K]=(0,n.useState)({cardNumber:"",expiryMonth:"",expiryYear:"",cvc:"",cardholderName:"",email:""}),Q=(null===m||void 0===m?void 0:m.uid)===r,$=(0,n.useRef)(new Set),ee=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(!o)return;const e=(0,d.rJ)(l.db,"sideRooms",o,"gifts"),t=(0,d.P)(e,(0,d.My)("timestamp","desc")),n=(0,d.aQ)(t,(e=>{const o=[];(null===m||void 0===m?void 0:m.uid)===r&&!ee.current&&e.docChanges().length>0&&e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data(),r=e.doc.id;if(!$.current.has(r)){$.current.add(r);const e=b.find((e=>e.id===o.giftId));o.senderId!==m.uid&&e&&(G(e),H(!0))}}})),ee.current&&(e.forEach((e=>{$.current.add(e.id)})),ee.current=!1),e.forEach((e=>{const r=e.data();o.push({id:e.id,giftId:r.giftId,giftType:r.giftType,giftName:r.giftName,senderId:r.senderId,senderName:r.senderName,receiverId:r.receiverId,timestamp:r.timestamp,value:r.value})})),F(o)}));return()=>n()}),[o,m,r,b]),(0,n.useEffect)((()=>{}),[L]);const oe=()=>{N(!1)},re=async()=>{m&&D&&o&&r&&Y(!0)};return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==a&&void 0!==a&&a.accentColor?(0,V.X4)(null===a||void 0===a?void 0:a.accentColor,.3):i.palette.divider),borderRadius:1,overflow:"hidden"},children:[W&&L&&(0,Ie.jsx)(xo,{gift:L,onAnimationComplete:()=>{H(!1),G(null)}}),(0,Ie.jsxs)(u.A,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:(0,V.X4)(i.palette.background.paper,.1)},"&::-webkit-scrollbar-thumb":{backgroundColor:(0,V.X4)((null===a||void 0===a?void 0:a.accentColor)||i.palette.primary.main,.3),borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:(0,V.X4)((null===a||void 0===a?void 0:a.accentColor)||i.palette.primary.main,.5)}},children:[!Q&&(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==a&&void 0!==a&&a.accentColor?(0,V.X4)(null===a||void 0===a?void 0:a.accentColor,.3):i.palette.divider),bgcolor:null!==a&&void 0!==a&&a.headerColor?(0,V.X4)(null===a||void 0===a?void 0:a.headerColor,.1):(0,V.X4)(i.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit",color:(null===a||void 0===a?void 0:a.textColor)||"inherit"},children:"Send Gifts with Real Money"}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{color:(0,V.X4)((null===a||void 0===a?void 0:a.textColor)||i.palette.text.secondary,.8),fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit"},children:"Pay securely with card, Google Pay, Apple Pay, or Flutterwave \u2022 Host earns SideCoins"}),(0,Ie.jsx)(j.Ay,{container:!0,spacing:2,sx:{mt:.5},children:h.map((e=>{const o=oo(e.id);return(0,Ie.jsx)(j.Ay,{item:!0,xs:6,sm:3,children:(0,Ie.jsxs)(S.A,{elevation:2,sx:{p:1.5,textAlign:"center",cursor:"pointer",transition:"all 0.2s",bgcolor:(0,V.X4)(e.color,.1),border:"1px solid ".concat((0,V.X4)(e.color,.3)),"&:hover":{transform:"translateY(-3px)",boxShadow:3}},onClick:()=>(e=>{Q||(T(e),N(!0))})(e),children:[(0,Ie.jsx)(u.A,{sx:{color:e.color,mb:1,fontSize:30,display:"flex",justifyContent:"center"},children:e.icon}),(0,Ie.jsx)(p.A,{variant:"body2",fontWeight:"medium",sx:{fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit",color:(null===a||void 0===a?void 0:a.textColor)||i.palette.text.primary},children:e.name}),(0,Ie.jsx)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,mt:1},children:(0,Ie.jsx)(p.A,{variant:"body2",fontWeight:"bold",sx:{color:i.palette.primary.main},children:ro(o)})}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.3,mt:.5},children:[(0,Ie.jsx)(eo.A,{size:"small"}),(0,Ie.jsxs)(p.A,{variant:"caption",sx:{color:(0,V.X4)((null===a||void 0===a?void 0:a.textColor)||i.palette.text.secondary,.7),fontSize:"0.65rem"},children:["Host gets ",to(no(o))," SC"]})]})]})},e.id)}))})]}),!Q&&(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==a&&void 0!==a&&a.accentColor?(0,V.X4)(null===a||void 0===a?void 0:a.accentColor,.3):i.palette.divider),bgcolor:(0,V.X4)(i.palette.background.paper,.5),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit",color:(null===a||void 0===a?void 0:a.textColor)||"inherit"},children:"Premium Gifts"}),(0,Ie.jsx)(U.A,{size:"small",label:"Coming Soon",sx:{bgcolor:(0,V.X4)(i.palette.primary.main,.1),color:i.palette.primary.main,fontWeight:"bold"}})]}),(0,Ie.jsxs)(u.A,{sx:{p:3,textAlign:"center",color:(0,V.X4)((null===a||void 0===a?void 0:a.textColor)||i.palette.text.primary,.6),fontStyle:"italic"},children:[(0,Ie.jsx)(qe.A,{sx:{fontSize:40,mb:1,opacity:.4}}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{mb:1},children:"Premium gifts will be available soon! Stay tuned for exciting new ways to show your support."}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,mt:1},children:[(0,Ie.jsx)(eo.A,{size:"small"}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{color:(0,V.X4)((null===a||void 0===a?void 0:a.textColor)||i.palette.text.secondary,.8),fontWeight:"medium"},children:"Requires 100.00 SC (10,000 LC) to unlock"})]})]})]}),Q&&(0,Ie.jsxs)(u.A,{sx:{p:3,textAlign:"center",bgcolor:null!==a&&void 0!==a&&a.headerColor?(0,V.X4)(null===a||void 0===a?void 0:a.headerColor,.1):(0,V.X4)(i.palette.background.paper,.7),borderBottom:"1px solid ".concat(null!==a&&void 0!==a&&a.accentColor?(0,V.X4)(null===a||void 0===a?void 0:a.accentColor,.3):i.palette.divider)},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit",color:(null===a||void 0===a?void 0:a.textColor)||"inherit",mb:1},children:"Room Owner View"}),(0,Ie.jsxs)(p.A,{variant:"body2",sx:{color:(0,V.X4)((null===a||void 0===a?void 0:a.textColor)||i.palette.text.secondary,.7),fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit"},children:["As the room owner, you can view gifts that others have sent to you. You earn ",ro(.8)," for each gift received!"]})]}),(0,Ie.jsxs)(u.A,{sx:{p:2,bgcolor:null!==a&&void 0!==a&&a.backgroundGradient?(0,V.X4)((null===a||void 0===a?void 0:a.backgroundColor)||i.palette.background.default,.3):(0,V.X4)(i.palette.background.paper,.5)},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{mb:2,fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit",color:(null===a||void 0===a?void 0:a.textColor)||"inherit"},children:Q?"Gifts Received":"Recent Gifts"}),0===y.length?(0,Ie.jsx)(p.A,{variant:"body2",color:null!==a&&void 0!==a&&a.textColor?(0,V.X4)(null===a||void 0===a?void 0:a.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit"},children:Q?"You haven't received any gifts yet.":"No gifts have been sent yet. Be the first to send a gift!"}):(0,Ie.jsx)(u.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:y.map((e=>{const o=b.find((o=>o.id===e.giftId))||{id:e.giftId,type:e.giftType,name:e.giftName,icon:(0,Ie.jsx)(qe.A,{}),value:e.value,color:"#757575"};return(0,Ie.jsxs)(S.A,{elevation:1,sx:{p:1.5,display:"flex",alignItems:"center",bgcolor:(0,V.X4)(o.color,.05),border:"1px solid ".concat((0,V.X4)(o.color,.2))},children:[(0,Ie.jsx)(u.A,{sx:{color:o.color,mr:1.5,display:"flex"},children:o.icon}),(0,Ie.jsxs)(u.A,{sx:{flexGrow:1},children:[(0,Ie.jsxs)(p.A,{variant:"body2",sx:{fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit",color:(null===a||void 0===a?void 0:a.textColor)||i.palette.text.primary},children:[(0,Ie.jsx)("strong",{children:e.senderName})," sent a ",(0,Ie.jsx)("strong",{children:e.giftName})]}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{color:(0,V.X4)((null===a||void 0===a?void 0:a.textColor)||i.palette.text.secondary,.7),fontFamily:(null===a||void 0===a?void 0:a.font)||"inherit"},children:e.timestamp?new Date(e.timestamp.toDate()).toLocaleString():"Just now"})]})]},e.id)}))})]})]}),(0,Ie.jsxs)(k.A,{open:O,onClose:oe,maxWidth:"xs",fullWidth:!0,children:[(0,Ie.jsxs)(I.A,{children:["Send Gift",(0,Ie.jsx)(x.A,{"aria-label":"close",onClick:oe,sx:{position:"absolute",right:8,top:8},children:(0,Ie.jsx)(Ye.A,{})})]}),(0,Ie.jsx)(R.A,{children:D&&(0,Ie.jsxs)(u.A,{sx:{textAlign:"center",py:2},children:[(0,Ie.jsx)(u.A,{sx:{color:D.color,fontSize:60,mb:2,display:"flex",justifyContent:"center"},children:D.icon}),(0,Ie.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:D.name}),(0,Ie.jsxs)(u.A,{sx:{mt:2,p:1.5,bgcolor:(0,V.X4)(i.palette.primary.main,.1),borderRadius:1,border:"1px solid ".concat((0,V.X4)(i.palette.primary.main,.3))},children:[(0,Ie.jsx)(p.A,{variant:"h5",color:"primary",sx:{fontWeight:"bold",mb:1},children:ro(oo(D.id))}),(0,Ie.jsxs)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:["Host will receive ",to(no(oo(D.id)))," SC"]}),(0,Ie.jsx)(p.A,{variant:"caption",color:"text.secondary",children:"Secure payment via multiple methods available"})]}),(0,Ie.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Your browser will show available payment methods (cards, Apple Pay, Google Pay)"})]})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:oe,color:"inherit",children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:async()=>{m&&D&&o&&r&&(N(!1),await re())},variant:"contained",color:"primary",disabled:z||B,sx:{bgcolor:null===D||void 0===D?void 0:D.color,"&:hover":{bgcolor:(0,V.X4)((null===D||void 0===D?void 0:D.color)||"#000",.8)}},children:z||B?"Processing...":"Send Gift"})]})]}),(0,Ie.jsxs)(k.A,{open:_,onClose:()=>Y(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, ".concat(i.palette.background.paper,", ").concat((0,V.X4)(i.palette.primary.main,.05),")")}},children:[(0,Ie.jsxs)(I.A,{sx:{textAlign:"center",pb:1},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[D&&(0,Ie.jsx)(u.A,{sx:{color:D.color,fontSize:48,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.2))"},children:D.icon}),(0,Ie.jsx)(p.A,{variant:"h5",fontWeight:"bold",children:"Confirm Gift Payment"})]}),(0,Ie.jsx)(x.A,{"aria-label":"close",onClick:()=>Y(!1),sx:{position:"absolute",right:8,top:8},children:(0,Ie.jsx)(Ye.A,{})})]}),(0,Ie.jsx)(R.A,{sx:{pt:0},children:D&&(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsxs)(S.A,{elevation:0,sx:{p:3,mb:3,textAlign:"center",background:(0,V.X4)(D.color,.1),border:"2px solid ".concat((0,V.X4)(D.color,.3)),borderRadius:2},children:[(0,Ie.jsx)(p.A,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:D.name}),(0,Ie.jsxs)(p.A,{variant:"h4",color:"primary",fontWeight:"bold",sx:{mb:1},children:["\xa3",oo(D.id).toFixed(2)]}),(0,Ie.jsx)(p.A,{variant:"body2",color:"text.secondary",children:"One-time payment"})]}),(0,Ie.jsxs)(u.A,{sx:{mb:3},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"What happens when you pay:"}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Ie.jsx)(u.A,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"success.main",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"1"}),(0,Ie.jsxs)(p.A,{variant:"body2",children:["Your payment method will be charged \xa3",oo(D.id).toFixed(2)]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Ie.jsx)(u.A,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"2"}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,Ie.jsxs)(p.A,{variant:"body2",children:["Host receives ",to(no(oo(D.id)))," SC"]}),(0,Ie.jsx)(eo.A,{size:"small"})]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Ie.jsx)(u.A,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:"secondary.main",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"3"}),(0,Ie.jsx)(p.A,{variant:"body2",children:"Gift animation plays in the room"})]})]})]}),(0,Ie.jsx)(w.A,{severity:"info",sx:{mb:2},children:(0,Ie.jsxs)(p.A,{variant:"body2",children:[(0,Ie.jsx)("strong",{children:"Secure Payment:"})," You'll be prompted to pay with your browser's secure payment methods (Apple Pay, Google Pay, or saved cards)."]})}),(0,Ie.jsxs)(u.A,{sx:{p:2,bgcolor:(0,V.X4)(i.palette.success.main,.1),borderRadius:1,border:"1px solid ".concat((0,V.X4)(i.palette.success.main,.3))},children:[(0,Ie.jsx)(p.A,{variant:"body2",color:"success.main",fontWeight:"bold",children:"\ud83d\udcb0 Host can withdraw SideCoins as real money monthly!"}),(0,Ie.jsxs)(p.A,{variant:"caption",color:"text.secondary",children:[to(no(oo(D.id)))," SC = \xa3",(.005*no(oo(D.id))).toFixed(2)," withdrawable"]})]})]})}),(0,Ie.jsxs)(P.A,{sx:{p:3,pt:0},children:[(0,Ie.jsx)(A.A,{onClick:()=>Y(!1),variant:"outlined",size:"large",sx:{minWidth:120},children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:async()=>{if(m&&D&&o&&r){X(!0);try{oo(D.id);Y(!1),J(!0)}catch(t){var e;console.error("Error processing gift payment:",t),"AbortError"===t.name?c.oR.error("Payment was cancelled by user"):"NotSupportedError"===t.name?c.oR.error("Payment method not supported in your browser. Please try a different browser or device."):null!==(e=t.message)&&void 0!==e&&e.includes("No payment methods available")?c.oR.error("No payment methods available. Please add a payment method to your browser or try a different device."):"Payment was cancelled"===(null===t||void 0===t?void 0:t.message)?c.oR.error("Payment was cancelled"):c.oR.error("Payment failed: ".concat((null===t||void 0===t?void 0:t.message)||"Unknown error occurred"))}finally{X(!1)}}},variant:"contained",size:"large",disabled:B,startIcon:B?(0,Ie.jsx)(C.A,{size:20}):null,sx:{minWidth:160,bgcolor:null===D||void 0===D?void 0:D.color,"&:hover":{bgcolor:(0,V.X4)((null===D||void 0===D?void 0:D.color)||"#000",.8)}},children:B?"Processing...":"Pay \xa3".concat(D?oo(D.id).toFixed(2):"0.00")})]})]}),(0,Ie.jsxs)(k.A,{open:q,onClose:()=>J(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Ie.jsxs)(I.A,{children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[D&&(0,Ie.jsx)(u.A,{sx:{color:D.color,fontSize:32},children:D.icon}),(0,Ie.jsx)(p.A,{variant:"h6",children:"Payment Details"})]}),(0,Ie.jsx)(x.A,{"aria-label":"close",onClick:()=>J(!1),sx:{position:"absolute",right:8,top:8},children:(0,Ie.jsx)(Ye.A,{})})]}),(0,Ie.jsx)(R.A,{children:D&&(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsxs)(p.A,{variant:"h6",gutterBottom:!0,children:[D.name," - \xa3",oo(D.id).toFixed(2)]}),(0,Ie.jsxs)(u.A,{component:"form",autoComplete:"on",sx:{mt:3},onSubmit:e=>e.preventDefault(),children:[(0,Ie.jsx)(E.A,{fullWidth:!0,label:"Card Number",name:"cardnumber",value:Z.cardNumber,onChange:e=>K((o=>(0,t.A)((0,t.A)({},o),{},{cardNumber:e.target.value}))),placeholder:"1234 5678 9012 3456",autoComplete:"cc-number",inputProps:{inputMode:"numeric",pattern:"[0-9\\s]{13,19}",maxLength:19},sx:{mb:2}}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,Ie.jsx)(E.A,{label:"Expiry Month",name:"cc-exp-month",value:Z.expiryMonth,onChange:e=>K((o=>(0,t.A)((0,t.A)({},o),{},{expiryMonth:e.target.value}))),placeholder:"MM",autoComplete:"cc-exp-month",inputProps:{inputMode:"numeric",pattern:"[0-9]{2}",maxLength:2},sx:{flex:1}}),(0,Ie.jsx)(E.A,{label:"Expiry Year",name:"cc-exp-year",value:Z.expiryYear,onChange:e=>K((o=>(0,t.A)((0,t.A)({},o),{},{expiryYear:e.target.value}))),placeholder:"YYYY",autoComplete:"cc-exp-year",inputProps:{inputMode:"numeric",pattern:"[0-9]{4}",maxLength:4},sx:{flex:1}}),(0,Ie.jsx)(E.A,{label:"CVC",name:"cvc",value:Z.cvc,onChange:e=>K((o=>(0,t.A)((0,t.A)({},o),{},{cvc:e.target.value}))),placeholder:"123",autoComplete:"cc-csc",inputProps:{inputMode:"numeric",pattern:"[0-9]{3,4}",maxLength:4},sx:{flex:1}})]}),(0,Ie.jsx)(E.A,{fullWidth:!0,label:"Cardholder Name",name:"cc-name",value:Z.cardholderName,onChange:e=>K((o=>(0,t.A)((0,t.A)({},o),{},{cardholderName:e.target.value}))),placeholder:"John Smith",autoComplete:"cc-name",sx:{mb:2}}),(0,Ie.jsx)(E.A,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:Z.email,onChange:e=>K((o=>(0,t.A)((0,t.A)({},o),{},{email:e.target.value}))),placeholder:"your@email.com",autoComplete:"email",sx:{mb:2}})]}),(0,Ie.jsx)(w.A,{severity:"info",sx:{mt:2},children:(0,Ie.jsxs)(p.A,{variant:"body2",children:["Your payment will be processed securely. The host will receive ",to(no(oo(D.id)))," SC."]})})]})}),(0,Ie.jsxs)(P.A,{sx:{p:3},children:[(0,Ie.jsx)(A.A,{onClick:()=>J(!1),variant:"outlined",children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:async()=>{if(m&&D&&o&&r){X(!0);try{const t=oo(D.id);if(!Z.cardNumber||!Z.expiryMonth||!Z.expiryYear||!Z.cvc||!Z.email)throw new Error("Please fill in all card details and email address");const n=Z.cardNumber.replace(/\s/g,"");if(n.length<13||n.length>19)throw new Error("Please enter a valid card number");const i=(new Date).getFullYear(),a=(new Date).getMonth()+1,s=parseInt(Z.expiryYear),l=parseInt(Z.expiryMonth);if(s<i||s===i&&l<a)throw new Error("Card has expired");if(Z.cvc.length<3||Z.cvc.length>4)throw new Error("Please enter a valid CVC");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Z.email))throw new Error("Please enter a valid email address");const d="https://sideeye-backend-production.up.railway.app/api/process-gift-payment";console.log("[Gift Payment] Processing real payment for:",{giftId:D.id,amount:t,currency:"GBP"});const u=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({giftId:D.id,giftName:D.name,amount:t,currency:"GBP",senderId:m.uid,senderName:m.displayName||"Anonymous",receiverId:r,roomId:o,paymentMethod:"card",paymentDetails:{cardNumber:n,expiryMonth:Z.expiryMonth.padStart(2,"0"),expiryYear:Z.expiryYear,cvc:Z.cvc,cardholderName:Z.cardholderName||"Anonymous"},customerEmail:Z.email,description:"SideEye Gift: ".concat(D.name),metadata:{giftId:D.id,senderId:m.uid,receiverId:r,roomId:o,type:"gift_payment"}})});if(!u.ok){const o=await u.text();console.error("Payment API Error:",{status:u.status,statusText:u.statusText,body:o});try{const e=JSON.parse(o);throw new Error(e.error||"Payment failed: ".concat(u.status))}catch(e){throw new Error("Payment failed: ".concat(u.status," ").concat(u.statusText))}}const h=await u.json();if(!h.success)throw new Error(h.error||"Payment processing failed");J(!1),K({cardNumber:"",expiryMonth:"",expiryYear:"",cvc:"",cardholderName:"",email:""});const x=no(t);c.oR.success("\ud83c\udf89 Payment successful! Gift sent and host earned ".concat(to(x)," SC"),{duration:6e3,position:"top-right"}),console.log("[Gift Payment] Payment completed successfully:",h.paymentId)}catch(t){console.error("[Gift Payment] Payment error:",t),c.oR.error(t.message||"Payment failed. Please try again.")}finally{X(!1)}}},variant:"contained",disabled:B,startIcon:B?(0,Ie.jsx)(C.A,{size:20}):null,sx:{bgcolor:null===D||void 0===D?void 0:D.color,"&:hover":{bgcolor:(0,V.X4)((null===D||void 0===D?void 0:D.color)||"#000",.8)}},children:B?"Processing...":"Pay \xa3".concat(D?oo(D.id).toFixed(2):"0.00")})]})]})]})};var vo=r(3125),go=r(9919),fo=r(2917),bo=r(2289),yo=r(8692),Ao=r(4066);const Co=e=>{let{rank:o}=e;const r=()=>{switch(o){case 1:return"#FFD700";case 2:return"#C0C0C0";case 3:return"#CD7F32";default:return"#A0A0A0"}};return(0,Ie.jsx)(U.A,{icon:(()=>{switch(o){case 1:return(0,Ie.jsx)(bo.A,{fontSize:"small"});case 2:case 3:return(0,Ie.jsx)(we.A,{fontSize:"small"});default:return(0,Ie.jsx)(Ce.A,{fontSize:"small"})}})(),label:"#".concat(o),size:"small",sx:{bgcolor:(0,V.X4)(r(),.15),color:r(),border:"1px solid ".concat(r()),fontWeight:"bold","& .MuiChip-icon":{color:r()}}})},wo=e=>{let{roomId:o,roomOwnerId:r,theme:t,roomStyle:i}=e;const[s,c]=(0,n.useState)([]),[m,h]=(0,n.useState)(!0),[x,g]=(0,n.useState)("all"),[f,b]=(0,n.useState)("all"),[y,A]=(0,n.useState)(new Set);(0,n.useEffect)((()=>{r&&(async()=>{try{let n;if(h(!0),"room"===f){const e=(0,d.rJ)(l.db,"sideRooms",o,"gifts");let t=(0,d.P)(e,(0,d._M)("receiverId","==",r),(0,d.My)("timestamp","desc"));if("all"!==x){const o=new Date;"month"===x?o.setMonth(o.getMonth()-1):"week"===x&&o.setDate(o.getDate()-7),t=(0,d.P)(e,(0,d._M)("receiverId","==",r),(0,d._M)("timestamp",">=",o),(0,d.My)("timestamp","desc"))}n=(0,d.GG)(t)}else{const e=(0,d.Cs)(l.db,"gifts");let o=(0,d.P)(e,(0,d._M)("receiverId","==",r),(0,d.My)("timestamp","desc"));if("all"!==x){const t=new Date;"month"===x?t.setMonth(t.getMonth()-1):"week"===x&&t.setDate(t.getDate()-7),o=(0,d.P)(e,(0,d._M)("receiverId","==",r),(0,d._M)("timestamp",">=",t),(0,d.My)("timestamp","desc"))}n=(0,d.GG)(o)}const i=await n,a=new Map;for(const o of i.docs){var e;const r=o.data(),n=r.senderId,i=(null===(e=r.timestamp)||void 0===e?void 0:e.toDate())||new Date,s=o.ref.path.split("/")[1];if(a.has(n)){const e=a.get(n);e.totalGifts+=1,e.totalValue+=r.value||0,i>e.lastGiftDate&&(e.lastGiftDate=i),s&&e.roomsGiftedIn&&e.roomsGiftedIn.add(s)}else try{const e=(0,d.H9)(l.db,"users",n),o=(await(0,d.x7)(e)).data();console.log("Fetched user data for ".concat(n,":"),o);const t=new Set;s&&t.add(s);let c="?";null!==o&&void 0!==o&&o.displayName?c=o.displayName.charAt(0).toUpperCase():null!==o&&void 0!==o&&o.name?c=o.name.charAt(0).toUpperCase():null!==o&&void 0!==o&&o.username?c=o.username.charAt(0).toUpperCase():r.senderName&&(c=r.senderName.charAt(0).toUpperCase());const u=(null===o||void 0===o?void 0:o.profilePic)||(null===o||void 0===o?void 0:o.photoURL)||(null===o||void 0===o?void 0:o.avatarUrl)||(null===o||void 0===o?void 0:o.avatar)||"";console.log("Avatar URL for ".concat(n,":"),u),a.set(n,{userId:n,username:(null===o||void 0===o?void 0:o.username)||(null===o||void 0===o?void 0:o.name)||r.senderName||"Unknown User",displayName:(null===o||void 0===o?void 0:o.displayName)||(null===o||void 0===o?void 0:o.name),avatar:u,totalGifts:1,totalValue:r.value||0,lastGiftDate:i,roomsGiftedIn:t})}catch(t){console.error("Error fetching user data",t);const e=new Set;s&&e.add(s),a.set(n,{userId:n,username:r.senderName||"Unknown User",avatar:"",totalGifts:1,totalValue:r.value||0,lastGiftDate:i,roomsGiftedIn:e})}}const s=Array.from(a.values()).sort(((e,o)=>{const r=o.totalValue-e.totalValue;if(0!==r)return r;if("all"===f){var t,n;const r=(null===(t=e.roomsGiftedIn)||void 0===t?void 0:t.size)||0,i=((null===(n=o.roomsGiftedIn)||void 0===n?void 0:n.size)||0)-r;if(0!==i)return i}return o.totalGifts-e.totalGifts}));c(s)}catch(t){console.error("Error fetching top gifters:",t)}finally{h(!1)}})()}),[o,r,x,f]);return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):t.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==i&&void 0!==i&&i.accentColor?(0,V.X4)(null===i||void 0===i?void 0:i.accentColor,.3):t.palette.divider),bgcolor:null!==i&&void 0!==i&&i.headerColor?(0,V.X4)(null===i||void 0===i?void 0:i.headerColor,.1):(0,V.X4)(t.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ie.jsx)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||"inherit"},children:"Top Gifters"}),(0,Ie.jsxs)(vo.A,{value:f,exclusive:!0,onChange:(e,o)=>{null!==o&&b(o)},size:"small","aria-label":"gift scope",sx:{"& .MuiToggleButton-root":{color:(null===i||void 0===i?void 0:i.textColor)||t.palette.text.primary,fontSize:"0.7rem",py:.5,px:1,"&.Mui-selected":{color:(null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,.1)}}},children:[(0,Ie.jsxs)(go.A,{value:"room",children:[(0,Ie.jsx)(yo.A,{fontSize:"small",sx:{mr:.5}}),"This Room"]}),(0,Ie.jsxs)(go.A,{value:"all",children:[(0,Ie.jsx)(Ao.A,{fontSize:"small",sx:{mr:.5}}),"All Rooms"]})]})]}),(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[{value:"all",label:"All Time"},{value:"month",label:"This Month"},{value:"week",label:"This Week"}].map((e=>(0,Ie.jsx)(U.A,{label:e.label,clickable:!0,size:"small",color:x===e.value?"primary":"default",onClick:()=>g(e.value),sx:{bgcolor:x===e.value?(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,.2):(0,V.X4)(t.palette.background.paper,.5),color:x===e.value?(null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main:(null===i||void 0===i?void 0:i.textColor)||t.palette.text.primary,borderColor:x===e.value?(null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main:t.palette.divider,border:"1px solid"}},e.value)))})]}),(0,Ie.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:0,bgcolor:null!==i&&void 0!==i&&i.backgroundGradient?(0,V.X4)((null===i||void 0===i?void 0:i.backgroundColor)||t.palette.background.default,.3):(0,V.X4)(t.palette.background.paper,.5),"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:(0,V.X4)(t.palette.background.paper,.1)},"&::-webkit-scrollbar-thumb":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,.3),borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,.5)}},children:m?(0,Ie.jsx)(D.A,{children:[...Array(5)].map(((e,o)=>(0,Ie.jsxs)(n.Fragment,{children:[(0,Ie.jsxs)(T.Ay,{children:[(0,Ie.jsx)(L.A,{children:(0,Ie.jsx)(fo.A,{variant:"circular",width:40,height:40})}),(0,Ie.jsx)(G.A,{primary:(0,Ie.jsx)(fo.A,{width:"60%"}),secondary:(0,Ie.jsx)(fo.A,{width:"40%"})}),(0,Ie.jsx)(fo.A,{variant:"rounded",width:60,height:24,sx:{ml:1}})]}),o<4&&(0,Ie.jsx)(F.A,{variant:"inset",component:"li"})]},o)))}):s.length>0?(0,Ie.jsx)(D.A,{sx:{py:0},children:s.map(((e,o)=>(0,Ie.jsxs)(n.Fragment,{children:[(0,Ie.jsxs)(T.Ay,{component:a.N_,to:"/profile/".concat(e.userId),alignItems:"center",sx:{transition:"background-color 0.2s",bgcolor:o<3?(0,V.X4)(0===o?"#FFD700":1===o?"#C0C0C0":"#CD7F32",.05):"transparent","&:hover":{bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,.1),textDecoration:"none"},textDecoration:"none"},children:[(0,Ie.jsx)(L.A,{children:(0,Ie.jsx)(v.A,{src:y.has(e.userId)?"":e.avatar,alt:e.displayName||e.username,onError:()=>{return o=e.userId,void A((e=>new Set(e).add(o)));var o},sx:{border:o<3?"2px solid ".concat(0===o?"#FFD700":1===o?"#C0C0C0":"#CD7F32"):void 0},children:(y.has(e.userId)||!e.avatar)&&(e.displayName||e.username||"?").charAt(0).toUpperCase()})}),(0,Ie.jsx)(G.A,{primary:(0,Ie.jsx)(p.A,{variant:"body2",fontWeight:o<3?"bold":"medium",sx:{fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",color:(null===i||void 0===i?void 0:i.textColor)||t.palette.text.primary},children:e.displayName||e.username}),secondary:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5,color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||t.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:[(0,Ie.jsx)(Ce.A,{fontSize:"inherit"}),e.totalGifts," gift",1!==e.totalGifts?"s":""]}),"all"===f&&e.roomsGiftedIn&&e.roomsGiftedIn.size>1&&(0,Ie.jsx)(U.A,{size:"small",label:"".concat(e.roomsGiftedIn.size," rooms"),sx:{height:16,fontSize:"0.6rem",ml:1,bgcolor:(0,V.X4)((null===i||void 0===i?void 0:i.accentColor)||t.palette.secondary.main,.1),color:(null===i||void 0===i?void 0:i.textColor)||t.palette.text.secondary}})]})}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,Ie.jsx)(p.A,{variant:"body2",sx:{fontWeight:"bold",color:(null===i||void 0===i?void 0:i.accentColor)||t.palette.primary.main,fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:(0,Ie.jsx)(eo.A,{size:"small",value:e.totalValue})}),(0,Ie.jsx)(Co,{rank:o+1})]})]}),o<s.length-1&&(0,Ie.jsx)(F.A,{variant:"inset",component:"li"})]},e.userId)))}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:3},children:[(0,Ie.jsx)(Ce.A,{sx:{fontSize:40,color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||t.palette.text.secondary,.5),mb:2}}),(0,Ie.jsx)(p.A,{variant:"body1",sx:{textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||t.palette.text.secondary,.7),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit"},children:"room"===f?"No gifts have been sent in this room yet":"No gifts have been sent to this creator yet"}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{textAlign:"center",color:(0,V.X4)((null===i||void 0===i?void 0:i.textColor)||t.palette.text.secondary,.5),fontFamily:(null===i||void 0===i?void 0:i.font)||"inherit",mt:1},children:"Send a gift to show your appreciation!"})]})})]})};var jo=r(5634),So=r(4320);const ko=e=>{let{isHostLive:o,roomStyle:r,hostName:t,isCurrentUserHost:i=!1,onStopLive:a}=e;const[s,l]=(0,n.useState)(null),[d,c]=(0,n.useState)("00:00:00");return(0,n.useEffect)((()=>{if(o&&!s){const e=Date.now();l(e),console.log("[TimeFrame] Host went live, starting timer at:",new Date(e).toLocaleTimeString())}else!o&&s&&(l(null),c("00:00:00"),console.log("[TimeFrame] Host went offline, resetting timer"))}),[o,s]),(0,n.useEffect)((()=>{if(!o||!s)return;const e=setInterval((()=>{const e=Date.now()-s,o=Math.floor(e/36e5),r=Math.floor(e%36e5/6e4),t=Math.floor(e%6e4/1e3),n="".concat(o.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"));c(n)}),1e3);return()=>clearInterval(e)}),[o,s]),o?(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1,backgroundColor:null!==r&&void 0!==r&&r.headerColor?(0,V.X4)(r.headerColor,.1):(0,V.X4)("#ff0000",.1),border:"1px solid ".concat((null===r||void 0===r?void 0:r.accentColor)||"#ff0000"),borderRadius:2,backdropFilter:"blur(5px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",fontFamily:(null===r||void 0===r?void 0:r.font)||"inherit",color:(null===r||void 0===r?void 0:r.textColor)||"inherit",mb:2,mx:"auto",maxWidth:"fit-content"},children:[(0,Ie.jsx)(U.A,{icon:(0,Ie.jsx)(jo.A,{sx:{color:"#ff0000",animation:"pulse 1.5s infinite"}}),label:"LIVE",size:"small",sx:{backgroundColor:(0,V.X4)("#ff0000",.1),color:"#ff0000",fontWeight:"bold",fontSize:"0.75rem",border:"1px solid #ff0000","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.6},"100%":{opacity:1}}}}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,Ie.jsx)(So.A,{fontSize:"small",sx:{color:(null===r||void 0===r?void 0:r.accentColor)||"#666"}}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{fontWeight:"bold",fontFamily:"monospace",fontSize:"1rem",color:(null===r||void 0===r?void 0:r.textColor)||"inherit"},children:d})]}),t&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{color:null!==r&&void 0!==r&&r.textColor?(0,V.X4)(r.textColor,.8):"text.secondary",fontFamily:(null===r||void 0===r?void 0:r.font)||"inherit"},children:[t," is live"]}),i&&a&&(0,Ie.jsx)(h.A,{title:"End Live Session",children:(0,Ie.jsx)(x.A,{onClick:a,size:"small",sx:{backgroundColor:(0,V.X4)("#ff0000",.1),color:"#ff0000",border:"1px solid #ff0000","&:hover":{backgroundColor:(0,V.X4)("#ff0000",.2)},ml:1},children:(0,Ie.jsx)(ee.A,{fontSize:"small"})})})]}):null},Io=[{name:"Classic Light",headerColor:"#F5F5F5",backgroundColor:"#FFFFFF",textColor:"#212121",accentColor:"#1976D2",headerGradient:!1,backgroundGradient:!1},{name:"Classic Dark",headerColor:"#303030",backgroundColor:"#212121",textColor:"#E0E0E0",accentColor:"#90CAF9",headerGradient:!1,backgroundGradient:!1},{name:"Midnight Bloom",headerColor:"#4A00E0",backgroundColor:"#1E1E2F",textColor:"#EAEAEA",accentColor:"#8E2DE2",headerGradient:!0,backgroundGradient:!0},{name:"Sunset Vibes",headerColor:"#FF8C00",backgroundColor:"#FFF3E0",textColor:"#4E342E",accentColor:"#FF5722",headerGradient:!0,backgroundGradient:!1},{name:"Oceanic Calm",headerColor:"#0077B6",backgroundColor:"#E0F7FA",textColor:"#01579B",accentColor:"#00B4D8",headerGradient:!1,backgroundGradient:!1},{name:"Sakura Dream",headerColor:"#F8BBD0",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#EC407A",headerGradient:!0,backgroundGradient:!0},{name:"Cyber Neon",headerColor:"#000000",backgroundColor:"#0D0221",textColor:"#00FF9F",accentColor:"#FF00E4",headerGradient:!0,backgroundGradient:!0},{name:"Shonen Hero",headerColor:"#FF9800",backgroundColor:"#FFF9C4",textColor:"#BF360C",accentColor:"#F57F17",headerGradient:!0,backgroundGradient:!1},{name:"Magic Academy",headerColor:"#4527A0",backgroundColor:"#E8EAF6",textColor:"#283593",accentColor:"#7C4DFF",headerGradient:!0,backgroundGradient:!1},{name:"Tokyo Night",headerColor:"#1A237E",backgroundColor:"#0D1117",textColor:"#E1F5FE",accentColor:"#2979FF",headerGradient:!0,backgroundGradient:!0},{name:"Spirit Forest",headerColor:"#2E7D32",backgroundColor:"#E8F5E9",textColor:"#1B5E20",accentColor:"#00C853",headerGradient:!0,backgroundGradient:!1},{name:"Cotton Candy",headerColor:"#F48FB1",backgroundColor:"#F8BBD0",textColor:"#AD1457",accentColor:"#CE93D8",headerGradient:!0,backgroundGradient:!0},{name:"Fairy Tale",headerColor:"#E1BEE7",backgroundColor:"#F3E5F5",textColor:"#6A1B9A",accentColor:"#BA68C8",headerGradient:!0,backgroundGradient:!0},{name:"Pastel Princess",headerColor:"#FFCDD2",backgroundColor:"#FAFAFA",textColor:"#C2185B",accentColor:"#FFB74D",headerGradient:!0,backgroundGradient:!1},{name:"Unicorn Dream",headerColor:"#B39DDB",backgroundColor:"#EDE7F6",textColor:"#512DA8",accentColor:"#81D4FA",headerGradient:!0,backgroundGradient:!0},{name:"Kawaii Kitty",headerColor:"#FFCCBC",backgroundColor:"#FFF3E0",textColor:"#D84315",accentColor:"#FF8A65",headerGradient:!0,backgroundGradient:!1},{name:"Bubblegum Pop",headerColor:"#F06292",backgroundColor:"#FCE4EC",textColor:"#880E4F",accentColor:"#64B5F6",headerGradient:!0,backgroundGradient:!0}],Ro=["Arial","Verdana","Georgia","Times New Roman","Courier New","Roboto","Open Sans","Lato","Montserrat","Comic Sans MS","Comic Neue","Bangers","Kalam","Indie Flower","Permanent Marker","Architects Daughter","Fredoka One","Pacifico","Dancing Script","Satisfy","Great Vibes","Playball","Sacramento","Tangerine","Petit Formal Script"],Eo=[12,14,16,18,20,24,28,32],Po=e=>{let{icon:o,color:r}=e;const[i,a]=(0,n.useState)({left:"".concat(80*Math.random()+10,"%"),top:"".concat(20*Math.random()+40,"%"),animationDuration:"".concat(3*Math.random()+2,"s"),opacity:1});return(0,n.useEffect)((()=>{const e=setTimeout((()=>{a((e=>(0,t.A)((0,t.A)({},e),{},{opacity:0})))}),2e3);return()=>clearTimeout(e)}),[]),(0,Ie.jsx)(u.A,{sx:(0,t.A)({position:"fixed",fontSize:"28px",color:r,pointerEvents:"none",zIndex:1e3,transition:"opacity 1s ease-out",animation:"float-around 3s ease-out forwards","@keyframes float-around":{"0%":{transform:"scale(0.5) rotate(0deg) translate(0, 0)"},"25%":{transform:"scale(1.2) rotate(10deg) translate(20px, -30px)"},"50%":{transform:"scale(1.4) rotate(-5deg) translate(-15px, -60px)"},"75%":{transform:"scale(1.1) rotate(15deg) translate(25px, -90px)"},"100%":{transform:"scale(0.8) rotate(-10deg) translate(0, -120px)"}}},i),children:o})},Fo=e=>{let{handleHeartRoom:o,handleHeartbreakRoom:r,currentUserHearted:t,currentUserHeartbroken:n,roomHeartCount:i,roomHeartbreakCount:a,isHearting:s,isHeartbreaking:l,accentColor:d,textColor:c}=e;const v=(0,m.A)();return(0,Ie.jsxs)(u.A,{sx:{position:"fixed",right:20,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:1,backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(5px)",borderRadius:2,padding:1,zIndex:100,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(h.A,{title:t?"Unheart Room":"Heart Room",children:(0,Ie.jsx)(x.A,{onClick:o,color:t?"error":"inherit",sx:{color:t?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:s,children:t?(0,Ie.jsx)(_.A,{}):(0,Ie.jsx)(Y.A,{})})}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:i||0})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(h.A,{title:n?"Remove Heartbreak":"Heartbreak Room",children:(0,Ie.jsx)(x.A,{onClick:r,color:n?"error":"inherit",sx:{color:n?v.palette.error.main:d||"inherit",backgroundColor:"rgba(255, 255, 255, 0.2)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},disabled:l,children:n?(0,Ie.jsx)(q.A,{}):(0,Ie.jsx)(J.A,{})})}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{color:c||"inherit",fontWeight:"bold"},children:a||0})]})]})},Uo=()=>{var e,o,r,a,B,X,Y,J;const{roomId:Ce}=(0,i.g)(),we=(0,i.Zp)(),{currentUser:je,blockUser:Se}=(0,s.As)(),ke=(0,m.A)(),[Fe,ze]=(0,n.useState)(null),[Me,Le]=(0,n.useState)(!1),[Ge,Be]=(0,n.useState)(!0),[Xe,Ve]=(0,n.useState)(null),[_e,Ye]=(0,n.useState)(!1),[qe,Je]=(0,n.useState)(!1),[Ze,Ke]=(0,n.useState)(""),[Qe,$e]=(0,n.useState)(!1),[eo,oo]=(0,n.useState)(!1),[ro,to]=(0,n.useState)(!1),[no,io]=(0,n.useState)(!1),[ao,so]=(0,n.useState)(null),[lo,co]=(0,n.useState)([]),[uo,mo]=(0,n.useState)(null),[ho,xo]=((0,n.useRef)(null),(0,n.useState)(null)),[po,vo]=(0,n.useState)(null),[go,fo]=(0,n.useState)(null),[bo,yo]=(0,n.useState)(!1),[Ao,Co]=(0,n.useState)(!1),[wo,jo]=(0,n.useState)(0),[So,ko]=(0,n.useState)(!1),[Uo,To]=(0,n.useState)(null),Oo=(0,n.useRef)(null),[No,zo]=(0,n.useState)(0),[Mo,Wo]=(0,n.useState)(!1),[Ho,Lo]=(0,n.useState)(!1),[Go,Bo]=(0,n.useState)(!1),[Xo,Vo]=(0,n.useState)(""),[_o,Yo]=(0,n.useState)(null),[qo,Jo]=(0,n.useState)(""),[Zo,Ko]=(0,n.useState)([]),[Qo,$o]=(0,n.useState)(!1),[er,or]=(0,n.useState)(null),[rr,tr]=(0,n.useState)(!1),nr=(0,n.useRef)(null),[ir,ar]=(0,n.useState)(null),[sr,lr]=(0,n.useState)(!1),[dr,cr]=(0,n.useState)([]),[ur,mr]=(0,n.useState)(""),[hr,xr]=(0,n.useState)(!1),pr=(0,n.useRef)(null),[vr,gr]=(0,n.useState)(""),[fr,br]=(0,n.useState)(!1),[yr,Ar]=(0,n.useState)(30),[Cr,wr]=(0,n.useState)(!1),[jr,Sr]=(0,n.useState)(Io[0].name),[kr,Ir]=(0,n.useState)(!1),[Rr,Er]=(0,n.useState)(!1),[Pr,Fr]=(0,n.useState)(Ro[0]),[Ur,Dr]=(0,n.useState)(Eo[2]),[Tr,Or]=((0,n.useRef)(null),(0,n.useState)(!1)),[Nr,zr]=(0,n.useState)(!1),[Mr,Wr]=(0,n.useState)(window.innerWidth>1024),[Hr,Lr]=(0,n.useState)(null),[Gr,Br]=(0,n.useState)(!1),[Xr,Vr]=(0,n.useState)(null),[_r,Yr]=(0,n.useState)(null),qr=(0,n.useRef)([]),[Jr,Zr]=(0,n.useState)(!1),[Kr,Qr]=(0,n.useState)([]),[$r,et]=(0,n.useState)(!1),[ot,rt]=(0,n.useState)(!1),[tt,nt]=(0,n.useState)(new Set),[it,at]=(0,n.useState)(null),st="youtube-player-placeholder",[lt,dt]=(0,n.useState)(!1),[ct,ut]=(0,n.useState)(null),[mt,ht]=(0,n.useState)(!1),[xt,pt]=(0,n.useState)([]),[vt,gt]=(0,n.useState)([]),[ft,bt]=(0,n.useState)(!1),[yt,At]=(0,n.useState)(!1),[Ct,wt]=(0,n.useState)([]),[jt,St]=(0,n.useState)(!1),[kt,It]=(0,n.useState)(!1),[Rt,Et]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(null===je||void 0===je||!je.uid||!l.db)return;console.log("[SideRoomComponent] Setting up balance listener for user:",je.uid);const e=(0,d.H9)(l.db,"users",je.uid),o=(0,d.aQ)(e,(e=>{if(e.exists()){const o=e.data().sideCoins||0;if(null!==Rt)if(o>Rt){const e=o-Rt;c.oR.success("+".concat(e.toFixed(2)," SideCoins earned from gifts! \ud83c\udf81"),{duration:4e3,position:"top-right"})}else if(o<Rt){const e=Rt-o;console.log("[Balance] User spent ".concat(e," SideCoins"))}Et(o)}}));return()=>{console.log("[SideRoomComponent] Cleaning up balance listener"),o()}}),[null===je||void 0===je?void 0:je.uid,Rt,l.db]);const Pt=(0,n.useCallback)((async()=>{if(je&&Ce&&!ot)try{var e;const o=(0,d.H9)(l.db,"users",je.uid),r=await(0,d.x7)(o);let t=(null===(e=je.email)||void 0===e?void 0:e.split("@")[0])||"Unknown User",n=je.photoURL||"";if(r.exists()){const e=r.data();t=e.username||t,n=e.profilePic||n}const i={userId:je.uid,username:t,avatar:n,timestamp:Date.now()},a=(0,d.H9)(l.db,"sideRooms",Ce,"cameraRequests",je.uid);await(0,d.BN)(a,i),rt(!0),c.oR.success("Camera request sent to host"),ir&&ir.emit("camera-request",{roomId:Ce,userId:je.uid,username:t,avatar:n})}catch(Xe){console.error("Error sending camera request:",Xe),c.oR.error("Failed to send camera request")}}),[ir,je,Ce,ot,l.db]),Ft=(0,n.useCallback)((async(e,o,r)=>{if(Ce){console.log("\ud83d\udcf9 [CAMERA DECISION] Processing decision for ".concat(o," (").concat(e,"): ").concat(r?"APPROVED":"DENIED"));try{const t=(0,d.H9)(l.db,"sideRooms",Ce,"cameraRequests",e);if(await(0,d.kd)(t),console.log("\ud83d\udcf9 [CAMERA DECISION] Removed request from Firestore"),r){const r=(0,d.H9)(l.db,"sideRooms",Ce,"cameraApprovals",e),t={approved:!0,timestamp:Date.now(),approvedBy:null===je||void 0===je?void 0:je.uid,username:o};console.log("\ud83d\udcf9 [CAMERA DECISION] Writing approval to Firestore:",t),await(0,d.BN)(r,t),console.log("\ud83d\udcf9 [CAMERA DECISION] \u2705 Successfully wrote approval for ".concat(o," (").concat(e,")")),nt((o=>{const r=new Set(o);return r.add(e),console.log("\ud83d\udcf9 [CAMERA DECISION] Updated local approved users:",Array.from(r)),r})),c.oR.success("\u2705 Camera approved for ".concat(o))}else{const r=(0,d.H9)(l.db,"sideRooms",Ce,"cameraApprovals",e);await(0,d.kd)(r).catch((()=>{})),console.log("\ud83d\udcf9 [CAMERA DECISION] \u274c Denied camera for ".concat(o," (").concat(e,")")),nt((o=>{const r=new Set(o);return r.delete(e),console.log("\ud83d\udcf9 [CAMERA DECISION] Updated local approved users after denial:",Array.from(r)),r})),c.oR.success("\u274c Camera denied for ".concat(o))}}catch(Xe){console.error("\ud83d\udcf9 [CAMERA DECISION] Error processing decision:",Xe),c.oR.error("Failed to process request")}}}),[Ce,l.db,null===je||void 0===je?void 0:je.uid]),Ut=(0,n.useCallback)((e=>{if(e===(null===je||void 0===je?void 0:je.uid))return!0;if(e===(null===Fe||void 0===Fe?void 0:Fe.ownerId))return!0;const o=tt.has(e);return console.log("\ud83c\udfa5 shouldShowUserVideo for ".concat(e,": ").concat(o)),o}),[null===je||void 0===je?void 0:je.uid,null===Fe||void 0===Fe?void 0:Fe.ownerId,tt]),Dt=(0,n.useCallback)((()=>{go&&zt&&(console.log("Camera state before toggle:",go.camera.state),"enabled"!==go.camera.state.status?(c.oR.loading("Enabling camera..."),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((e=>(console.log("Camera access granted:",e),e.getTracks().forEach((e=>e.stop())),go.camera.enable()))).then((()=>{Zr(!0),c.oR.dismiss(),c.oR.success("Camera enabled")})).catch((e=>{console.error("Error enabling camera:",e),c.oR.dismiss(),c.oR.error("Could not enable camera. Please check camera permissions in your browser settings.")}))):go.camera.disable().then((()=>{Zr(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)})))}),[go]),Tt=(0,n.useRef)(0),Ot=(0,n.useRef)(0),Nt=(0,n.useRef)(0);(0,n.useEffect)((()=>{const e=()=>{Wr(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(0,n.useEffect)((()=>{ht(!1)}),[Ce]),(0,n.useEffect)((()=>()=>{rt(!1),Qr([])}),[Ce]),(0,n.useEffect)((()=>{if(go){const e="enabled"===go.camera.state.status;Zr(e);const o=setInterval((()=>{const e="enabled"===go.camera.state.status;Zr((o=>o!==e?(console.log("\ud83c\udfa5 Camera state changed: ".concat(o," \u2192 ").concat(e)),e):o))}),1e3);return()=>{clearInterval(o)}}}),[go]),(0,n.useEffect)((()=>{go&&navigator.mediaDevices.getUserMedia({video:!0}).then((()=>{console.log("Camera permissions granted")})).catch((e=>{console.error("Camera permission denied:",e),c.oR.error("Camera permissions denied. You won't be able to share video.")}))}),[go]),(0,n.useEffect)((()=>{const e="https://sideeye-backend-production.up.railway.app";console.log("[SideRoomComponent] Connecting Socket.IO to: ".concat(e));const o=(0,Oe.io)(e,{reconnectionAttempts:5,transports:["websocket","polling"]});return o.on("connect",(()=>{console.log("[SideRoomComponent] Socket connected:",o.id),ar(o),Ce&&null!==je&&void 0!==je&&je.uid&&(console.log("[SideRoomComponent] Auto-joining room on socket connect:",Ce),o.emit("join-room",Ce,je.uid))})),o.on("disconnect",(e=>{console.log("[SideRoomComponent] Socket disconnected:",e),ar(null)})),o.on("connect_error",(e=>{console.error("[SideRoomComponent] Socket connection error (raw error object):",e),e&&e.message?(console.error("[SideRoomComponent] Socket connection error message:",e.message),c.oR.error("Chat/Invite connection failed: ".concat(e.message,". Trying to reconnect..."))):c.oR.error("Chat/Invite connection failed. Trying to reconnect..."),ar(null)})),()=>{console.log("[SideRoomComponent] Disconnecting socket..."),o.disconnect(),ar(null)}}),[]),(0,n.useEffect)((()=>{ir&&Ce&&null!==je&&void 0!==je&&je.uid&&(console.log("[SideRoomComponent] Joining room via socket:",Ce),ir.emit("join-room",Ce,je.uid))}),[ir,Ce,null===je||void 0===je?void 0:je.uid]),(0,n.useEffect)((()=>{if(ro)if(null!==Fe&&void 0!==Fe&&Fe.style){const e=Fe.style,o=Io.find((o=>o.name===e.themeName));Sr(o?e.themeName:Io[0].name);const r=o||Io[0];Ir(void 0!==e.headerGradient?e.headerGradient:r.headerGradient||!1),Er(void 0!==e.backgroundGradient?e.backgroundGradient:r.backgroundGradient||!1),Fr(Ro.includes(e.font)?e.font:Ro[0]),Dr(Eo.includes(e.headerFontSize)?e.headerFontSize:Eo[2])}else Sr(Io[0].name),Ir(Io[0].headerGradient||!1),Er(Io[0].backgroundGradient||!1),Fr(Ro[0]),Dr(Eo[2])}),[ro,Fe]),(0,n.useEffect)((()=>{if(!Ce||!l.db||0===lo.length)return;const e=lo.filter((e=>e.isOnline)).length,o=Date.now(),r=o-Ot.current;if(e!==Tt.current&&r>1e4){console.log("[Active Users Update] Updating count from ".concat(Tt.current," to ").concat(e));const r=(0,d.H9)(l.db,"sideRooms",Ce);(0,d.mZ)(r,{activeUsers:e,viewerCount:(0,d.CL)()}).then((()=>{Tt.current=e,Ot.current=o})).catch((e=>{console.error("[Active Users Update] Error updating room active users count:",e)}))}Tt.current=e}),[Ce,l.db,lo.length]),console.log("[SideRoomComponent Debug] Owner check details:"),console.log("  Current User UID:",(null===je||void 0===je?void 0:je.uid)||"null/undefined"),console.log("  Room Owner ID:",(null===Fe||void 0===Fe?void 0:Fe.ownerId)||"null/undefined"),console.log("  Room Viewers:",(null===Fe||void 0===Fe?void 0:Fe.viewers)||"null/undefined");const zt=(0,n.useMemo)((()=>{if(null===je||void 0===je||!je.uid||null===Fe||void 0===Fe||!Fe.ownerId)return console.log("[SideRoomComponent] isRoomOwner = false (missing user or room data)"),!1;const e=je.uid===Fe.ownerId;return console.log("[SideRoomComponent] isRoomOwner = ".concat(e," (direct comparison)")),e}),[null===je||void 0===je?void 0:je.uid,null===Fe||void 0===Fe?void 0:Fe.ownerId]),Mt=(0,n.useMemo)((()=>{if(null===Fe||void 0===Fe||!Fe.viewers||null===je||void 0===je||!je.uid)return console.log("[SideRoomComponent] isGuest = false (missing viewer data or user)"),!1;const e=Fe.viewers.some((e=>e.userId===je.uid&&"guest"===e.role));return console.log("[SideRoomComponent] isGuest = ".concat(e," (found in viewers with role=guest)")),e}),[null===Fe||void 0===Fe?void 0:Fe.viewers,null===je||void 0===je?void 0:je.uid]),Wt=!!Fe&&(zt||!0);(0,n.useEffect)((()=>{if(!Ce||!zt||!l.db)return;const e=(0,d.rJ)(l.db,"sideRooms",Ce,"cameraRequests"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,t.A)({userId:e.id},e.data())));Qr(o)}));return()=>o()}),[Ce,zt,l.db]),(0,n.useEffect)((()=>{if(!Ce||!l.db)return;console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] Setting up listener for room:",Ce);const e=(0,d.rJ)(l.db,"sideRooms",Ce,"cameraApprovals"),o=(0,d.aQ)(e,(e=>{const o=new Set(e.docs.map((e=>e.id)));console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] Firestore update received:"),console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] - Snapshot size:",e.size),console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] - Document IDs:",e.docs.map((e=>e.id))),console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] - Previous approved users:",Array.from(tt)),console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] - New approved users:",Array.from(o)),nt(o),o.size!==tt.size&&console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] Camera permissions changed, forcing layout update")}),(e=>{console.error("\ud83d\udcf9 [CAMERA PERMISSIONS] Error listening to camera approvals:",e)}));return()=>{console.log("\ud83d\udcf9 [CAMERA PERMISSIONS] Cleaning up listener for room:",Ce),o()}}),[Ce,l.db]),(0,n.useEffect)((()=>{if(!Ce||null===je||void 0===je||!je.uid||zt||!l.db)return;const e=(0,d.H9)(l.db,"sideRooms",Ce,"cameraApprovals",je.uid),o=(0,d.aQ)(e,(async e=>{var o;if(e.exists()&&null!==(o=e.data())&&void 0!==o&&o.approved&&go){console.log("\ud83c\udfa5 CAMERA APPROVED! TURNING ON NOW!"),rt(!1);try{await go.camera.enable(),Zr(!0),c.oR.success("\ud83c\udfa5 CAMERA ON!"),console.log("\ud83c\udfa5 Keeping approval document for host visibility")}catch(Xe){console.error("Camera error:",Xe),c.oR.error("Camera failed")}}})),r=(0,d.H9)(l.db,"sideRooms",Ce,"cameraRequests",je.uid),t=(0,d.aQ)(r,(e=>{e.exists()||rt(!1)}));return()=>{o(),t()}}),[Ce,null===je||void 0===je?void 0:je.uid,zt,l.db,go]);const Ht=(0,n.useMemo)((()=>{console.log("[onlineParticipants Memo] Raw presence state:",lo);const e=new Map;lo.forEach((o=>{o.isOnline&&!e.has(o.userId)&&e.set(o.userId,o)}));const o=Array.from(e.values());return console.log("[onlineParticipants Memo] Filtered participants:",o),o}),[lo]),Lt=(0,n.useMemo)((()=>{if(!Fe||!Fe.viewers||!Array.isArray(Fe.viewers))return void console.log("[SideRoomComponent Debug] ownerData: room or room.viewers not available or not an array.");console.log("[SideRoomComponent Debug] Inspecting room.viewers:",JSON.stringify(Fe.viewers,null,2));const e=Fe.viewers.find((e=>(console.log("[SideRoomComponent Debug] Checking viewer: userId=".concat(e.userId,", role=").concat(e.role,', displayName="').concat(e.displayName,'", username="').concat(e.username,'"')),"owner"===e.role)));if(e){console.log("[SideRoomComponent Debug] Owner found in room.viewers:",JSON.stringify(e,null,2));const o=e.displayName;"string"===typeof o&&""!==o.trim()?console.log('[SideRoomComponent Debug] Owner displayName is valid: "'.concat(o,'"')):console.warn("[SideRoomComponent Debug] Owner found, but displayName is missing, empty, or not a string. DisplayName value:",o),"string"===typeof e.username&&""!==e.username.trim()?console.log('[SideRoomComponent Debug] Owner username is valid: "'.concat(e.username,'"')):console.warn("[SideRoomComponent Debug] Owner found, but username is missing, empty, or not a string. Username value:",e.username)}else console.log('[SideRoomComponent Debug] No member with role "owner" found in room.viewers.');return e}),[Fe]);(0,n.useEffect)((()=>{if(Fe&&je&&!zt&&Wt&&!kt&&go){if(console.log("[Owner Live Check] Checking if owner is live in Stream call:",{roomOwnerId:Fe.ownerId,currentUserId:je.uid,hasActiveStreamCall:!!go}),go){console.log("[Owner Live Check] Active stream call found, starting grace period for owner to join...");const e=setTimeout((()=>{console.log("[Owner Live Check] Grace period ended, will check Stream participants"),It(!0)}),1e4);return()=>clearTimeout(e)}}else console.log("[Owner Live Check] Skipping check - conditions not met:",{hasRoom:!!Fe,hasCurrentUser:!!je,isRoomOwner:zt,hasRoomAccess:Wt,hasCheckedOwnerPresence:kt,hasActiveStreamCall:!!go})}),[Fe,je,zt,Wt,kt,go]),(0,n.useEffect)((()=>{const e=()=>{console.log("[Main Component] Received showOwnerNotLiveDialog event from Stream component"),zt||jt||St(!0)};return window.addEventListener("showOwnerNotLiveDialog",e),()=>{window.removeEventListener("showOwnerNotLiveDialog",e)}}),[zt,jt]);const Gt=(0,n.useCallback)((async()=>{if(null!==Fe&&void 0!==Fe&&Fe.bannedUsers&&0!==Fe.bannedUsers.length)try{const e=await Promise.all(Fe.bannedUsers.map((async e=>{try{const o=await(0,d.x7)((0,d.H9)(l.db,"users",e));if(o.exists()){const r=o.data();return{id:e,username:r.username||"Unknown User",name:r.name,profilePic:r.profilePic}}return{id:e,username:"Unknown User",name:"Unknown",profilePic:""}}catch(Xe){return console.error("Error fetching user data for ".concat(e,":"),Xe),{id:e,username:"Unknown User",name:"Unknown",profilePic:""}}})));wt(e)}catch(Xe){console.error("Error loading banned users:",Xe),c.oR.error("Failed to load banned users")}else wt([])}),[null===Fe||void 0===Fe?void 0:Fe.bannedUsers,l.db]),Bt=(0,n.useCallback)((async(e,o)=>{if(zt&&Ce&&window.confirm("Are you sure you want to unban ".concat(o,"? They will be able to rejoin the room.")))try{const r=(0,d.H9)(l.db,"sideRooms",Ce);await(0,d.mZ)(r,{bannedUsers:(0,d.C3)(e),lastActive:(0,d.O5)()}),wt((o=>o.filter((o=>o.id!==e)))),c.oR.success("".concat(o," has been unbanned"))}catch(Xe){console.error("Error unbanning user:",Xe),c.oR.error("Failed to unban user")}}),[zt,Ce,l.db]);(0,n.useEffect)((()=>{yt&&Gt()}),[yt,Gt]);const Xt=(0,n.useCallback)((async(e,o,r,t,n)=>{if(!e||null===o||void 0===o||!o.uid||!n)return void console.warn("[Presence Helper] Missing critical data to write presence.");const i=o.uid;try{var a,s;const l=(0,d.H9)(r,"users",i),c=await(0,d.x7)(l);let u="",m="",h=(null===(a=o.email)||void 0===a?void 0:a.split("@")[0])||"user_".concat(i.substring(0,4));if(c.exists()){const e=c.data();u=e.name||e.username||"",m=e.profilePic||"",h=e.username||h}else console.warn("[Presence Helper] Firestore profile missing for ".concat(i,". Using fallbacks from auth user.")),u=o.displayName||"",m=o.photoURL||"";let x="viewer";t?x="owner":null!==(s=n.viewers)&&void 0!==s&&s.some((e=>e.userId===i&&"guest"===e.role))&&(x="guest");const p=(0,d.H9)(r,"sideRooms",e,"presence",i),v={userId:i,username:h,avatar:m,lastSeen:Date.now(),isOnline:!0,role:x,displayName:u,photoURL:m};console.log("[Presence Helper] Writing presence for ".concat(i," in room ").concat(e,":"),JSON.stringify(v,null,2)),await(0,d.BN)(p,v,{merge:!0}),console.log("[Presence Helper] Presence updated for ".concat(i))}catch(l){console.error("[Presence Helper] Error fetching profile or writing presence for ".concat(i,":"),l)}}),[]);(0,n.useEffect)((()=>{console.log("[Presence Effect A] Initializing. RoomId: ".concat(Ce,", HasAccess: ").concat(Wt,", CurrentUserUID: ").concat(null===je||void 0===je?void 0:je.uid,", IsRoomOwner: ").concat(zt,", RoomExists: ").concat(!!Fe)),Wt&&Ce&&je&&Fe?(console.log("[Presence Effect A] Conditions met. Writing/updating presence for user ".concat(je.uid," in room ").concat(Ce,".")),Xt(Ce,je,l.db,zt,Fe)):console.log("[Presence Effect A] Conditions NOT met. Skipping presence write. HasAccess: ".concat(Wt,", RoomId: ").concat(!!Ce,", CurrentUser: ").concat(!!je,", Room: ").concat(!!Fe))}),[Ce,je,l.db,zt,Fe,Wt,Xt]),(0,n.useEffect)((()=>{const e=null===je||void 0===je?void 0:je.uid,o=Ce;return console.log("[Presence Effect B] Monitoring user ".concat(e," in room ").concat(o," for cleanup.")),()=>{if(e&&o){console.log("[Presence Effect B - Cleanup] Running for user ".concat(e," in room ").concat(o,". Setting offline."));const r=(0,d.H9)(l.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Effect B - Cleanup] Error setting user ".concat(e," offline:"),o)}))}else console.log("[Presence Effect B - Cleanup] Cleanup called but effectUserId or effectRoomId is missing. Skipping Firestore update. UID: ".concat(e,", RoomID: ").concat(o))}}),[Ce,null===je||void 0===je?void 0:je.uid,l.db]);const Vt=()=>{Bo(!0)},_t=()=>{Bo(!1),Vo("")},Yt=()=>{if(!Ce)return void c.oR.error("Cannot clear video: Room ID is missing.");if(!zt)return void c.oR.error("Only the room owner can clear the video.");const e=(0,d.H9)(l.db,"sideRooms",Ce);(0,d.mZ)(e,{currentSharedVideoUrl:null}).catch((e=>console.error("Error clearing video URL in Firestore:",e))),Yo(null),c.oR.success("Shared video cleared.")};(0,n.useEffect)((()=>{if(null===je||void 0===je||!je.uid||!Ce||!Wt||ho)return;(async()=>{try{console.log("[Stream] Fetching token for user:",je.uid),console.log("[Stream] Data being sent - User ID:",je.uid),console.log("[Stream] Data being sent - Display Name:",je.displayName),console.log("[Stream] Data being sent - Photo URL:",je.photoURL);const r="".concat("https://sideeye-backend-production.up.railway.app","/api/stream-token");console.log("[Stream] Fetching token from: ".concat(r));const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:je.uid,userName:je.displayName||je.email||"UnknownUser",userImage:je.photoURL||void 0})});console.log("[Stream] Response status: ".concat(t.status));const n={};if(t.headers.forEach(((e,o)=>{n[o]=e})),console.log("[Stream] Response headers:",JSON.stringify(n,null,2)),!t.ok){var e;let r={error:"HTTP error! Status: ".concat(t.status)};try{const e=await t.text();console.log("[Stream] Non-OK response body (text):",e),r=JSON.parse(e)}catch(o){console.warn("[Stream] Could not parse non-OK response body as JSON.",o),r.error=t.statusText||r.error}throw new Error((null===(e=r)||void 0===e?void 0:e.error)||"HTTP status ".concat(t.status))}const{token:i}=await t.json();if(!i)throw new Error("Stream token was not provided by backend.");xo(i),console.log("[Stream] Token fetched successfully.")}catch(Xe){console.error("[Stream] Error fetching token:",Xe),c.oR.error("Stream Token Error: ".concat(Xe.message||"Load failed")),xo(null)}})()}),[je,Ce,Wt,ho]),(0,n.useEffect)((()=>{var e,o;if(console.log("[Stream Client Init Check] Stream API key configured"),!ho||null===je||void 0===je||!je.uid||po)return void console.log("[Stream Client Init Effect] Skipping client initialization. Conditions: streamToken=".concat(!!ho,", currentUser=").concat(!(null===je||void 0===je||!je.uid),", apiKey=").concat(!0,", clientExists=").concat(!!po));console.log("[Stream] Initializing StreamVideoClient with token.");const r=(null===(e=je.profile)||void 0===e?void 0:e.name)||je.displayName||je.email||je.uid,t=(null===(o=je.profile)||void 0===o?void 0:o.profilePic)||je.photoURL||void 0;console.log("[Stream] Client Init - Using displayName: ".concat(r,", photoURL: ").concat(t));const n={id:je.uid,name:r,image:t};try{const e=new Ee.Hq({apiKey:"2nufecjmzmzh",user:n,token:ho});vo(e),console.log("[Stream] StreamVideoClient initialized for Provider.")}catch(Xe){console.error("[Stream] Error initializing StreamVideoClient:",Xe),c.oR.error("Failed to initialize Stream video client: ".concat(Xe instanceof Error?Xe.message:String(Xe)))}return()=>{po&&(console.log("[Stream] Client will be disconnected by StreamVideo provider or next init."),vo(null))}}),[ho,je,po]),(0,n.useEffect)((()=>{if(!Ao||!po||!Ce||null===je||void 0===je||!je.uid)return void(Ao&&Co(!1));if(go)return console.log("[Stream Call] Call instance already active. Skipping join attempt."),void Co(!1);return(async()=>{console.log("[Stream Call] Attempting to join/create call with ID: ".concat(Ce)),yo(!0);try{const o=po.call("default",Ce);if(await o.join({create:!0}),console.log("[Stream Call] Successfully joined/created call: ".concat(o.cid)),fo(o),zt){console.log("[Stream Call] Host going live - auto-enabling camera");try{await o.camera.enable(),Zr(!0),c.oR.success("\ud83c\udfa5 You're now live with camera!")}catch(e){console.error("[Stream Call] Failed to auto-enable host camera:",e),c.oR.error("Camera failed to start - check permissions")}}if(zt&&Ce&&l.db){console.log("[Stream Call] Current user is room owner, updating isLive status to true");const e=(0,d.H9)(l.db,"sideRooms",Ce);await(0,d.mZ)(e,{isLive:!0,lastActive:(0,d.O5)()})}}catch(Xe){console.error("[Stream Call] Error joining or creating call:",Xe),c.oR.error("Failed to connect to audio: ".concat(Xe.message||"Unknown error")),fo(null)}finally{yo(!1),Co(!1)}})(),()=>{Co(!1)}}),[Ao,po,Ce,null===je||void 0===je?void 0:je.uid,go,zt]);const qt=(0,n.useCallback)((async()=>{if(je&&Fe&&l.db)try{console.log("[Live Notifications] Room owner went live, notifying followers...");const n=(0,d.rJ)(l.db,"users",je.uid,"followers"),i=await(0,d.GG)(n),a=[],s=[];for(const t of i.docs){var e,o;const n=t.id,i=await(0,d.x7)((0,d.H9)(l.db,"users",n));if(!i.exists())continue;const c=i.data(),u={type:"user_went_live",senderId:je.uid,senderName:je.displayName||(null===(e=je.email)||void 0===e?void 0:e.split("@")[0])||"Someone",senderAvatar:je.photoURL||"",recipientId:n,content:"".concat(je.displayName||(null===(o=je.email)||void 0===o?void 0:o.split("@")[0])||"Someone",' is now live in "').concat(Fe.name,'"'),roomId:Fe.id,roomName:Fe.name,createdAt:(0,d.O5)(),isRead:!1};var r;if(a.push((0,d.gS)((0,d.rJ)(l.db,"notifications"),u)),c.email)s.push({to:c.email,recipientName:c.name||c.username||"User",senderName:je.displayName||(null===(r=je.email)||void 0===r?void 0:r.split("@")[0])||"Someone",roomName:Fe.name,roomId:Fe.id})}if(await Promise.all(a),console.log("[Live Notifications] Created ".concat(a.length," in-app notifications")),s.length>0)try{const e="https://sideeye-backend-production.up.railway.app",o=await fetch("".concat(e,"/api/send-live-notifications"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notifications:s})});o.ok?console.log("[Live Notifications] Sent ".concat(s.length," email notifications")):console.error("[Live Notifications] Failed to send email notifications:",await o.text())}catch(t){console.error("[Live Notifications] Error sending email notifications:",t)}}catch(Xe){console.error("[Live Notifications] Error notifying followers:",Xe)}}),[je,Fe,l.db]),[Jt,Zt]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!zt||!go||!Fe||!je||Jt)return;const e=setTimeout((()=>{console.log("[Live Notifications] Room owner joined Stream call, triggering follower notifications"),qt(),Zt(!0)}),2e3);return()=>clearTimeout(e)}),[zt,go,Fe,je,Jt,qt]),(0,n.useEffect)((()=>{!go&&Jt&&Zt(!1)}),[go,Jt]),(0,n.useEffect)((()=>()=>{go&&(console.log("[Stream Call] Leaving active call ".concat(go.cid," on component unmount or room change.")),go.leave().then((()=>console.log("[Stream Call] Successfully left call ".concat(go.cid)))).catch((e=>console.error("[Stream Call] Error leaving call ".concat(go.cid,":"),e))).finally((()=>{if(fo(null),zt&&Ce&&l.db){console.log("[Stream Call] Room owner left call, updating isLive status to false");const e=(0,d.H9)(l.db,"sideRooms",Ce);(0,d.mZ)(e,{isLive:!1,lastActive:(0,d.O5)()}).catch((e=>console.error("[Stream Call] Error updating room isLive status on leave:",e)))}})))}),[go,Ce,zt,l.db]),(0,n.useEffect)((()=>{if(!Ce||!je)return;const e=(0,d.H9)(l.db,"sideRooms",Ce),o=(0,d.aQ)(e,(e=>{if(e.exists()){const r=(0,t.A)({id:e.id},e.data());if((r.bannedUsers||[]).includes(je.uid))return Ve("You have been banned from this room"),ze(null),Be(!1),c.oR.error("You have been banned from this room by the owner"),void we("/side-rooms");if(ze(r),jo(r.heartCount||0),Be(!1),r.isPrivate&&r.password&&r.ownerId!==je.uid){var o;(null===(o=r.viewers)||void 0===o?void 0:o.some((e=>e.userId===je.uid&&"guest"!==e.role)))||Je(!0)}}else console.warn("[SideRoomComponent - Room Listener] Room document for roomId '".concat(Ce,"' reported as non-existent. Current error: '").concat(Xe,"'. Setting room state to null.")),Ve("Room not found"),ze(null),Be(!1)}));let r;if(null!==je&&void 0!==je&&je.uid){const e=(0,d.H9)(l.db,"sideRooms",Ce,"heartedBy",je.uid);r=(0,d.aQ)(e,(e=>{ko(e.exists())}))}const n=(0,d.P)((0,d.rJ)(l.db,"sideRooms",Ce,"heartedBy"),(0,d.My)("timestamp","desc"),(0,d.AB)(1)),i=(0,d.aQ)(n,(e=>{e.docChanges().forEach((e=>{if("added"===e.type){const o=e.doc.data();o.userId!==(null===je||void 0===je?void 0:je.uid)&&o.username&&(To("".concat(o.username," hearted the room!")),Oo.current&&clearTimeout(Oo.current),Oo.current=setTimeout((()=>{To(null)}),3e3))}}))}));return()=>{o(),r&&r(),i(),Oo.current&&clearTimeout(Oo.current)}}),[Ce,je]),(0,n.useEffect)((()=>{if(!Ce||!l.db||null===je||void 0===je||!je.uid)return;const e=(0,d.H9)(l.db,"sideRooms",Ce),o=(0,d.H9)(l.db,"sideRooms",Ce,"heartbrokenBy",je.uid),r=(0,d.aQ)(e,(e=>{if(e.exists()){const o=e.data();zo(o.heartbreakCount||0)}})),t=(0,d.aQ)(o,(e=>{Wo(e.exists())}));return()=>{r(),t()}}),[Ce,l.db,null===je||void 0===je?void 0:je.uid]),(0,n.useEffect)((()=>{if(xt.length>0){const e=setTimeout((()=>{pt((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[xt]),(0,n.useEffect)((()=>{if(vt.length>0){const e=setTimeout((()=>{gt((e=>e.slice(1)))}),3e3);return()=>clearTimeout(e)}}),[vt]);const Kt=async e=>{if(!l.db||!e)return null;try{const o=(0,d.rJ)(l.db,"rooms"),r=(0,d.P)(o,(0,d._M)("createdBy","==",e),(0,d._M)("type","==","public")),t=await(0,d.GG)(r);if(!t.empty){const e=t.docs[0];return{id:e.id,name:e.data().name||"Chat Room"}}return null}catch(Xe){return console.error("[SideRoomComponent] Error checking for server chat room:",Xe),null}};(0,n.useEffect)((()=>{if(null===je||void 0===je||!je.uid||null===Fe||void 0===Fe||!Fe.ownerId||mt)return;(async()=>{try{const e=(0,d.H9)(l.db,"users",Fe.ownerId),o=await(0,d.x7)(e);if(!(o.exists()&&!0===o.data().isPrivate))return;const r=(0,d.H9)(l.db,"users",je.uid,"following",Fe.ownerId),t=(0,d.H9)(l.db,"users",Fe.ownerId,"followRequests",je.uid),[n,i]=await Promise.all([(0,d.x7)(r),(0,d.x7)(t)]);if(n.exists()&&!i.exists()){const e=await Kt(Fe.ownerId);e&&!mt&&(ut(e),dt(!0))}}catch(Xe){console.error("Error checking follow status:",Xe)}})();const e=(0,d.H9)(l.db,"users",je.uid,"following",Fe.ownerId),o=(0,d.aQ)(e,(e=>{e.exists()&&!mt&&Kt(Fe.ownerId).then((e=>{e&&!mt&&(ut(e),dt(!0))}))}));return()=>o()}),[je,Fe,l.db,we,Kt,mt]),(0,n.useEffect)((()=>{if(console.log("[Presence Listener - Others] Initializing. RoomId: ".concat(Ce,", HasAccess: ").concat(Wt,", CurrentUserUID: ").concat(null===je||void 0===je?void 0:je.uid)),!Ce||!Wt||null===je||void 0===je||!je.uid)return console.warn("[Presence Listener - Others] Conditions not met. Clearing presence. RoomId: ".concat(Ce,", HasAccess: ").concat(Wt,", UserUID: ").concat(null===je||void 0===je?void 0:je.uid)),void co([]);console.log("[Presence Listener - Others] Setting up listener for room ".concat(Ce));const e=(0,d.rJ)(l.db,"sideRooms",Ce,"presence"),o=(0,d.aQ)(e,(e=>{const o=e.docs.map((e=>(0,t.A)({userId:e.id},e.data()))),r=Date.now();let n=!1;const i=o.filter((e=>{if(e.isOnline&&e.lastSeen&&r-e.lastSeen>3e5){if(Date.now()%3e5<1e3&&console.log("[Presence Listener] User ".concat(e.userId," has stale presence (").concat(Math.floor((r-e.lastSeen)/1e3)," seconds old).")),!n&&l.db&&e.userId!==(null===je||void 0===je?void 0:je.uid)){const o=(0,d.H9)(l.db,"sideRooms",Ce,"presence",e.userId);(0,d.mZ)(o,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{console.error("[Presence Listener] Error marking stale user ".concat(e.userId," as offline:"),o)})),n=!0}return!1}return e.isOnline}));console.log("[Presence Listener - Others] Received presence snapshot. Users:",i.length,i),co(i);const a=i.length;Date.now()%3e5<1e3&&console.log("[Presence Listener] Current active users: ".concat(a))}),(e=>{console.error("[Presence Listener - Others] CRITICAL: Snapshot error:",e),c.oR.error("Error listening to room presence updates. See console."),co([])}));return()=>{console.log("[Presence Listener - Others] Cleanup for room ".concat(Ce,".")),o()}}),[Ce,Wt,null===je||void 0===je?void 0:je.uid,l.db]),(0,n.useEffect)((()=>{const e=null===je||void 0===je?void 0:je.uid,o=Ce;return()=>{if(e&&o&&l.db){console.log("[Viewers Cleanup] Marking user ".concat(e," as offline in room ").concat(o," on unmount"));const r=(0,d.H9)(l.db,"sideRooms",o,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>{console.log("[Viewers Cleanup] Successfully marked user ".concat(e," as offline"))})).catch((o=>{console.error("[Viewers Cleanup] Error marking user ".concat(e," as offline:"),o),"not-found"===o.code&&console.log("[Viewers Cleanup] No presence document found for user ".concat(e,", which is fine"))}))}}}),[Ce,null===je||void 0===je?void 0:je.uid,l.db]),(0,n.useEffect)((()=>{if(console.log("[Presence Writer - Self] Initializing. RoomId: ".concat(Ce,", HasAccess: ").concat(Wt,", CurrentUserUID: ").concat(null===je||void 0===je?void 0:je.uid,", IsRoomOwner: ").concat(zt,", RoomExists: ").concat(!!Fe)),!Ce||null===je||void 0===je||!je.uid||!Fe||!Wt){if(console.warn("[Presence Writer - Self] Conditions not met. Attempting to set self offline. RoomId: ".concat(Ce,", UserUID: ").concat(null===je||void 0===je?void 0:je.uid,", HasAccess: ").concat(Wt,", RoomExists: ").concat(!!Fe)),null!==je&&void 0!==je&&je.uid&&Ce){const e=(0,d.H9)(l.db,"sideRooms",Ce,"presence",je.uid);(0,d.mZ)(e,{isOnline:!1,lastSeen:(0,d.O5)()}).then((()=>console.log("[Presence Writer - Self] Successfully set self offline due to unmet conditions for user ".concat(je.uid," in room ").concat(Ce)))).catch((e=>{"not-found"!==e.code&&console.error("[Presence Writer - Self] Error setting self offline (unmet conditions) for ".concat(je.uid,":"),e)}))}return}const e=je.uid;console.log("[Presence Writer - Self] Proceeding to write presence for user ".concat(e," in room ").concat(Ce,"."));let o=null;return(async()=>{try{var r,t;const n=(0,d.H9)(l.db,"users",e),i=await(0,d.x7)(n);let a="",s="",c=(null===(r=je.email)||void 0===r?void 0:r.split("@")[0])||"user_".concat(e.substring(0,4));if(i.exists()){const o=i.data();a=o.name||o.username||"",s=o.profilePic||"",c=o.username||c,console.log("[Presence Writer - Self Profile Fetch] Fetched profile for ".concat(e,": Name='").concat(a,"', Pic='").concat(s,"', Username='").concat(c,"'"))}else console.warn("[Presence Writer - Self Profile Fetch] Firestore profile missing for ".concat(e,". Using fallbacks.")),a=je.displayName||"",s=je.photoURL||"";let u="viewer";zt?u="owner":null!==(t=Fe.viewers)&&void 0!==t&&t.some((o=>o.userId===e&&"guest"===o.role))&&(u="guest");const m=(0,d.H9)(l.db,"sideRooms",Ce,"presence",e),h={userId:e,username:c,avatar:s,lastSeen:Date.now(),isOnline:!0,role:u,displayName:a,photoURL:s},x="sideRooms/".concat(Ce,"/presence/").concat(e);console.log("[DEBUG Presence Writer] Attempting setDoc to path:",x,"with data:",JSON.stringify(h,null,2)),console.log("[Presence Writer - Self Debug] Data being written to presence:",h),await(0,d.BN)(m,h,{merge:!0}),console.log("[Presence Writer - Self] Presence updated for ".concat(e)),o||(o=setInterval((async()=>{try{const o=Date.now();o-Nt.current>3e4&&(await(0,d.mZ)(m,{lastSeen:o,isOnline:!0}),Nt.current=o,console.log("[Presence Heartbeat] Updated for ".concat(e)))}catch(Xe){console.error("[Presence Heartbeat] Error updating heartbeat:",Xe)}}),6e4))}catch(n){console.error("[Presence Writer - Self] Error fetching profile or writing presence for ".concat(e,":"),n)}})(),()=>{o&&(clearInterval(o),o=null),console.log("[Presence Writer - Self] Cleanup running for user ".concat(e," in room ").concat(Ce,". Setting offline."));const r=(0,d.H9)(l.db,"sideRooms",Ce,"presence",e);(0,d.mZ)(r,{isOnline:!1,lastSeen:(0,d.O5)()}).catch((o=>{"not-found"!==o.code&&console.error("[Presence Writer - Self] Error setting user ".concat(e," offline during cleanup:"),o)}))}}),[Ce,je,l.db,zt,Fe,Wt]),(0,n.useEffect)((()=>{if(Ce)return()=>{}}),[Ce]),(0,n.useEffect)((()=>{Fe&&Fe.currentSharedVideoUrl?Yo(Fe.currentSharedVideoUrl):Fe&&!Fe.currentSharedVideoUrl&&Yo(null)}),[Fe]),(0,n.useEffect)((()=>{if(!ir)return;const e=e=>{c.oR.success(e.message),tr(!1),Jo(""),or(null),Ko([]),oo(!1)},o=e=>{console.log("[Camera Request] Received camera request:",e),console.log("[Camera Request] Current room ID:",Ce),console.log("[Camera Request] Is room owner:",zt),e.roomId===Ce&&zt?(console.log("[Camera Request] Processing camera request from:",e.username),Qr((o=>{if(o.some((o=>o.userId===e.userId)))return console.log("[Camera Request] Request already exists, ignoring"),o;const r={userId:e.userId,username:e.username,avatar:e.avatar,timestamp:Date.now()};return console.log("[Camera Request] Adding new request:",r),[...o,r]})),c.oR.success("".concat(e.username," requested camera permission"))):console.log("[Camera Request] Ignoring request - not for this room or not room owner")},r=e=>{c.oR.error(e.username?"".concat(e.username,": ").concat(e.reason):e.reason),tr(!1)},t=e=>{e.roomId===Ce&&c.oR.success("".concat(e.guest.displayName||e.guest.username," joined as a guest!"))},n=e=>{e.error?(c.oR.error(e.error),Ko([])):Ko(e.users)},i=e=>{const o="string"===typeof e?e:e.roomId,r="object"===typeof e?e.reason:"removed";if(o===Ce&&null!==je&&void 0!==je&&je.uid){let e="The host has removed you from the room.";"blocked"===r&&(e="You have been blocked by the room owner and removed from the room."),c.oR.error(e),null===go||void 0===go||go.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being removed:",e))).finally((()=>{we("/side-rooms")}))}},a=e=>{e.roomId===Ce&&null!==je&&void 0!==je&&je.uid&&(c.oR.error("You have been banned from this room. ".concat(e.reason||"")),null===go||void 0===go||go.leave().catch((e=>console.error("[SideRoomComponent] Error leaving Stream call after being banned:",e))).finally((()=>{we("/side-rooms")})))},s=e=>{e.roomId===Ce&&e.targetUserId===(null===je||void 0===je?void 0:je.uid)&&go&&(console.log("[SideRoomComponent] Received force-mute from room owner"),go.microphone.disable().then((async()=>{try{const e=(0,d.H9)(l.db,"sideRooms",Ce,"presence",je.uid);await(0,d.mZ)(e,{forceMuted:!0})}catch(Xe){console.error("[SideRoomComponent] Error updating presence after force-mute:",Xe)}c.oR.error("You have been muted by the room owner"),console.log("[SideRoomComponent] Successfully muted user via force-mute")})).catch((e=>{console.error("[SideRoomComponent] Error force-muting user:",e),c.oR.error("Failed to mute microphone")})))},u=e=>{e.roomId===Ce&&e.targetUserId===(null===je||void 0===je?void 0:je.uid)&&go&&(console.log("[SideRoomComponent] Received force-unmute from room owner"),go.microphone.enable().then((async()=>{try{const e=(0,d.H9)(l.db,"sideRooms",Ce,"presence",je.uid);await(0,d.mZ)(e,{forceMuted:!1})}catch(Xe){console.error("[SideRoomComponent] Error updating presence after force-unmute:",Xe)}c.oR.success("You have been unmuted by the room owner"),console.log("[SideRoomComponent] Successfully unmuted user via force-unmute")})).catch((e=>{console.error("[SideRoomComponent] Error force-unmuting user:",e),c.oR.error("Failed to unmute microphone")})))};return ir.on("invite-success",e),ir.on("invite-failed",r),ir.on("guest-joined",t),ir.on("user-search-results-for-invite",n),ir.on("force-remove",i),ir.on("force-ban",a),ir.on("force-mute",s),ir.on("force-unmute",u),ir.on("camera-request",o),()=>{ir.off("invite-success",e),ir.off("invite-failed",r),ir.off("guest-joined",t),ir.off("user-search-results-for-invite",n),ir.off("force-remove",i),ir.off("force-ban",a),ir.off("force-mute",s),ir.off("force-unmute",u),ir.off("camera-request",o)}}),[ir,Ce,we,go,null===je||void 0===je?void 0:je.uid,zt]);const Qt=(0,n.useCallback)((0,Te.debounce)((e=>{e.trim().length>=2&&(ir?(console.log('Emitting search-users-for-invite: "'.concat(e.trim(),'"')),ir.emit("search-users-for-invite",{searchTerm:e.trim()})):(console.warn("[SideRoomComponent] Socket not available for search-users-for-invite."),c.oR.error("Cannot search users: connection issue.")))}),300),[ir]),$t=(0,n.useCallback)((()=>{io(!0)}),[]),en=(0,n.useCallback)((e=>{so(e.currentTarget)}),[]),on=(0,n.useCallback)((()=>{so(null)}),[]),rn=(0,n.useCallback)((()=>{$e(!0),on()}),[on]),tn=(0,n.useCallback)((()=>{to(!0),on()}),[on]),nn=(0,n.useCallback)((()=>{oo(!0),Jo(""),or(null),Ko([]),$o(!1),on()}),[on]),an=(0,n.useCallback)((async()=>{if(tr(!0),ir&&null!==je&&void 0!==je&&je.uid&&Ce&&null!==er&&void 0!==er&&er.username){console.log("Emitting invite-user-to-room: ".concat(er.username));try{var e;const o=(0,d.P)((0,d.rJ)(l.db,"users"),(0,d._M)("username","==",er.username)),r=await(0,d.GG)(o);if(r.empty)return c.oR.error("User not found."),void tr(!1);r.docs[0].data();const t=r.docs[0].id,n=(0,d.H9)(l.db,"sideRooms",Ce),i=await(0,d.x7)(n);if(!i.exists())return c.oR.error("Room not found."),void tr(!1);const a=i.data();if(null===(e=a.viewers)||void 0===e?void 0:e.some((e=>e.userId===t)))return c.oR.error("".concat(er.username," is already in this room.")),void tr(!1);ir.emit("invite-user-to-room",{roomId:Ce,inviterId:je.uid,inviteeUsername:er.username})}catch(Xe){console.error("Error checking if user is in room:",Xe),ir.emit("invite-user-to-room",{roomId:Ce,inviterId:je.uid,inviteeUsername:er.username})}}else console.warn("Could not send invite due to missing socket, user, room, or selected invitee info.",{socket:!!ir,currentUser:!(null===je||void 0===je||!je.uid),roomId:Ce,selectedInviteeForInvite:er}),c.oR.error("Cannot send invite: connection or user data issue."),tr(!1)}),[null===je||void 0===je?void 0:je.uid,Ce,er,ir,l.db]),sn=(0,n.useCallback)((async()=>{if(Ce&&zt&&(on(),window.confirm("Are you sure you want to delete this room? This cannot be undone."))){Ye(!0);try{const e=(0,d.H9)(l.db,"sideRooms",Ce);await(0,d.mZ)(e,{deleted:!0,deletedAt:(0,d.O5)()}),c.oR.success("Room deleted successfully"),we("/side-rooms")}catch(Xe){console.error("Error deleting room:",Xe),c.oR.error("Failed to delete room")}finally{Ye(!1)}}}),[Ce,zt,we]),ln=(0,n.useCallback)((async(e,o)=>{if(!zt||!Ce||e===(null===je||void 0===je?void 0:je.uid)||!ir)return;console.log("Owner toggling force-mute for ".concat(e,". Currently force-muted: ").concat(o));const r=!o,t=(0,d.H9)(l.db,"sideRooms",Ce,"presence",e);try{await(0,d.mZ)(t,{forceMuted:r}),r?(ir.emit("force-mute",{roomId:Ce,targetUserId:e}),console.log("[SideRoomComponent] Emitted force-mute for user ".concat(e))):(ir.emit("force-unmute",{roomId:Ce,targetUserId:e}),console.log("[SideRoomComponent] Emitted force-unmute for user ".concat(e))),c.oR.success("User ".concat(r?"muted":"unmuted","."))}catch(Xe){console.error("Error toggling force-mute for ".concat(e,":"),Xe),c.oR.error("Failed to update mute status.")}}),[zt,Ce,null===je||void 0===je?void 0:je.uid,l.db,ir]),dn=(0,n.useCallback)(((e,o,r)=>{if(!zt||!Ce||e===(null===je||void 0===je?void 0:je.uid)||!ir)return;const t=o||"this user",n="blocked"===r;(n||window.confirm("Are you sure you want to remove ".concat(t," from the room?")))&&(console.log("[SideRoomComponent] Owner removing user ".concat(e," from room ").concat(Ce," - reason: ").concat(r||"removed")),ir.emit("force-remove",{roomId:Ce,targetUserId:e,reason:r||"removed"}),n||c.oR.success("Removing ".concat(t,"...")))}),[zt,Ce,null===je||void 0===je?void 0:je.uid,ir]),cn=(0,n.useCallback)((async(e,o)=>{if(!zt||!Ce||e===(null===je||void 0===je?void 0:je.uid))return;const r=o||"this user";if(window.confirm("Are you sure you want to ban ".concat(r,"? They will be banned from this room and cannot rejoin.")))try{const o=(0,d.H9)(l.db,"sideRooms",Ce),t=await(0,d.x7)(o);if(t.exists()){const n=t.data();if((n.bannedUsers||[]).includes(e))c.oR.error("".concat(r," is already banned from this room"));else{await(0,d.mZ)(o,{bannedUsers:(0,d.hq)(e),lastActive:(0,d.O5)()});const t=(n.viewers||[]).filter((o=>o.userId!==e));await(0,d.mZ)(o,{viewers:t}),console.log("[SideRoomComponent] User ".concat(e," banned from room ").concat(Ce)),ir&&ir.emit("force-ban",{roomId:Ce,targetUserId:e,reason:"Banned by room owner"}),c.oR.success("".concat(r," has been banned from the room"))}}else c.oR.error("Room not found")}catch(Xe){console.error("Error banning user:",Xe),c.oR.error("Failed to ban user")}}),[zt,Ce,null===je||void 0===je?void 0:je.uid,ir,l.db]),un=()=>{setTimeout((()=>{var e;null===(e=pr.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),100)};(0,n.useEffect)((()=>{sr&&un()}),[dr,sr,vr]),(0,n.useEffect)((()=>{if(!fr||!vr)return;let e=0;const o=vr,r=()=>{e<o.length?(cr((r=>{const n=[...r];if(n.length>0&&"ai"===n[n.length-1].sender){const r=n[n.length-1];n[n.length-1]=(0,t.A)((0,t.A)({},r),{},{text:o.substring(0,e+1)})}return n})),e++,setTimeout(r,yr)):(br(!1),gr(""))};return r(),()=>{br(!1)}}),[fr,vr,yr]);const mn=e=>{cr((e=>{const o=e[e.length-1];return!o||"ai"!==o.sender||""!==o.text&&"Thinking..."!==o.text?[...e,{sender:"ai",text:""}]:e.map(((o,r)=>r===e.length-1?(0,t.A)((0,t.A)({},o),{},{text:""}):o))})),gr(e),br(!0)};(0,n.useEffect)((()=>{const e=localStorage.getItem("sideroom_sade_chat_history");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&o.every((e=>"object"===typeof e&&null!==e&&"sender"in e&&"text"in e))?cr(o):(console.warn("[SideRoomComponent - SadeAI History] Invalid data found in localStorage."),localStorage.removeItem("sideroom_sade_chat_history"))}catch(Xe){console.error("[SideRoomComponent - SadeAI History] Error parsing saved history:",Xe),localStorage.removeItem("sideroom_sade_chat_history")}}),[]),(0,n.useEffect)((()=>{(dr.length>0||localStorage.getItem("sideroom_sade_chat_history"))&&localStorage.setItem("sideroom_sade_chat_history",JSON.stringify(dr))}),[dr]);const hn=async function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ur).trim();if(!o)return;const r={sender:"user",text:o};cr((e=>[...e,r])),mr(""),xr(!0);try{console.log("[SideRoomComponent - SadeAI] Sending message to backend.");const r="https://sideeye-backend-production.up.railway.app";if(!r)return console.error("[SideRoomComponent - SadeAI] ERROR: REACT_APP_API_URL is not defined."),mn("Configuration error: Backend URL not set."),void xr(!1);const n="".concat(r,"/api/sade-ai");if(null===je||void 0===je||!je.uid)return console.error("[SideRoomComponent - SadeAI] ERROR: User ID not available."),mn("Error: Could not identify user."),void xr(!1);cr((e=>[...e,{sender:"ai",text:"Thinking..."}]));const i=/^(hi|hello|hey|sup|yo|wagwan|how are you|how's it going|what's up|good morning|good afternoon|good evening)[\s\W]*$/i.test(o),a=/how (do|to|can) (I|you)|help me|guide|tutorial|instructions|steps|feature|profile|settings|add|create|change|modify|update|set up/i.test(o),s={message:o,forceSearch:e,userId:je.uid,contextFlags:{avoidAppInstructions:i&&!a,isGreeting:i,isInstructionQuery:a,useContextFlags:!0}};console.log("[SideRoomComponent - SadeAI] Sending HTTP request body:",s);const l={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)},d=await fetch(n,l);if(cr((e=>e.filter(((o,r)=>r!==e.length-1)))),!d.ok){let e="HTTP error! status: ".concat(d.status);try{e=(await d.json()).error||e}catch(t){}throw new Error(e)}const c=await d.json();console.log("[SideRoomComponent - SadeAI] HTTP Backend response data:",c),c.response?c.sourceLinks&&Array.isArray(c.sourceLinks)&&c.sourceLinks.length>0?(cr((e=>[...e,{sender:"ai",text:"",sourceLinks:c.sourceLinks}])),mn(c.response)):mn(c.response):c.error?(console.error("[SideRoomComponent - SadeAI] Backend returned error:",c.error),mn("Sorry, there was an error: ".concat(c.error))):(console.error("[SideRoomComponent - SadeAI] Received unexpected HTTP response structure:",c),mn("Sorry, I got a bit confused there."))}catch(n){console.error("[SideRoomComponent - SadeAI] sendMessage Error:",n),cr((e=>e.length>0&&"ai"===e[e.length-1].sender&&"Thinking..."===e[e.length-1].text?e.slice(0,-1):e)),mn("Sorry, there was an error: ".concat(n.message||"Unknown error"))}finally{xr(!1),un()}};(0,n.useEffect)((()=>{const e=_o?(e=>{let o=null;return(e=e.trim()).includes("youtube.com/watch?v=")?o=new URL(e).searchParams.get("v"):e.includes("youtu.be/")&&(o=e.substring(e.lastIndexOf("/")+1).split("?")[0]),o||(e.includes("tiktok.com/")||e.includes("instagram.com/reel/")?((0,c.oR)("TikTok/Instagram Reels will be shown as links soon."),null):e.match(/\.(mp4|webm|ogg)$/i)?((0,c.oR)("Direct video files will be shown as links soon."),null):(c.oR.error("Unsupported video URL. Only YouTube links are currently embeddable."),null))})(_o):null,o=()=>{if(it&&(it.destroy(),at(null)),e&&document.getElementById(st)){console.log("[YouTube API] Initializing player for videoId: ".concat(e));const o=new window.YT.Player(st,{videoId:e,width:"100%",height:"100%",playerVars:{autoplay:0,rel:0,controls:1},events:{onReady:e=>{console.log("[YouTube API] Player ready.")},onStateChange:e=>{console.log("[YouTube API] Player state changed:",e.data)}}});at(o)}else!e&&it&&(it.destroy(),at(null))};return window.YT&&window.YT.Player?(console.log("[YouTube API] API already loaded. Initializing player directly."),o()):(console.log("[YouTube API] API not ready yet. Setting up onYouTubeIframeAPIReady."),window.onYouTubeIframeAPIReady=()=>{console.log("[YouTube API] onYouTubeIframeAPIReady called."),o()}),()=>{it&&(console.log("[YouTube API] Cleaning up player on unmount/URL change."),it.destroy(),at(null))}}),[_o]);const xn=e=>(0,Ie.jsx)("div",{id:st,style:{width:"100%",height:"100%"}}),pn=((0,n.useCallback)((async()=>{if(go)if(Mr)try{await go.screenShare.toggle();const e=go.screenShare.enabled;zr(e),e?c.oR.success("Screen sharing started."):c.oR.success("Screen sharing stopped.")}catch(Xe){console.error("Error toggling screen share:",Xe),c.oR.error("Failed to toggle screen sharing: ".concat(Xe.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[go,Mr]),Fe?"".concat(Fe.name," - SideEye"):Ge?"Loading Room...":"Room Not Found - SideEye"),vn=Fe&&Fe.description||"Join the conversation on SideEye.",gn="".concat(window.location.origin,"/default-app-logo.png"),fn=(null===Fe||void 0===Fe?void 0:Fe.thumbnailUrl)||gn,bn="".concat(window.location.origin,"/side-room/").concat(Ce||"");if(Ge&&!Fe)return(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(De.mg,{children:(0,Ie.jsx)("title",{children:"Loading Room... - SideEye"})}),(0,Ie.jsx)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,Ie.jsx)(C.A,{})})]});if(Xe&&!Fe)return(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(De.mg,{children:(0,Ie.jsx)("title",{children:"Error Loading Room - SideEye"})}),(0,Ie.jsxs)(u.A,{sx:{p:3,textAlign:"center"},children:[(0,Ie.jsx)(w.A,{severity:"error",children:Xe}),(0,Ie.jsxs)(A.A,{onClick:()=>we("/discover"),sx:{mt:2},children:[" ","Back to Discover"]})]})]});const yn=async()=>{if(Fe&&Ze&&je){Ye(!0);try{if(Fe.password===Ze){const e=(0,d.H9)(l.db,"sideRooms",Ce),o=await(0,d.x7)(e),r=o.data().viewers||[];r.some((e=>e.userId===je.uid))||await(0,d.mZ)(e,{viewers:[...r,{userId:je.uid,username:je.displayName||je.email||"User",role:"viewer",joinedAt:Date.now()}]}),c.oR.success("Password correct. Welcome to the room!"),Je(!1)}else c.oR.error("Incorrect password. Please try again.")}catch(Xe){console.error("Error verifying password:",Xe),c.oR.error("An error occurred. Please try again.")}finally{Ye(!1)}}else c.oR.error("Missing information. Please try again.")},An=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))c.oR.error("Screen recording is not fully supported on mobile devices. Please use a desktop browser for this feature.");else try{var e;if(null===(e=navigator.mediaDevices)||void 0===e||!e.getDisplayMedia)return void c.oR.error("Screen recording is not supported in your browser.");const o=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),r=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaStream;o.getVideoTracks().forEach((e=>{t.addTrack(e)})),o.getAudioTracks().forEach((e=>{t.addTrack(e)})),r.getAudioTracks().forEach((e=>{t.addTrack(e)}));const n=new MediaRecorder(t,{mimeType:"video/webm"});n.ondataavailable=e=>{e.data.size>0&&qr.current.push(e.data)},n.onstop=()=>{const e=new Blob(qr.current,{type:"video/webm"}),o=URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=o,r.download="sideeye-room-recording-".concat((new Date).toISOString(),".webm"),document.body.appendChild(r),r.click(),setTimeout((()=>{document.body.removeChild(r),window.URL.revokeObjectURL(o),qr.current=[]}),100),t.getTracks().forEach((e=>e.stop())),Vr(null),Yr(null),Br(!1),c.oR.success("Recording saved to your device")},n.start(),Vr(t),Yr(n),Br(!0),c.oR.success("Screen recording started with audio"),o.getVideoTracks()[0].onended=()=>{"inactive"!==n.state&&n.stop()}}catch(Xe){console.error("Error starting screen recording:",Xe),c.oR.error("Could not start screen recording. Please make sure you've granted the necessary permissions.")}},Cn=()=>{_r&&"inactive"!==_r.state&&_r.stop(),Xr&&Xr.getTracks().forEach((e=>e.stop()))},wn=()=>{dt(!1),ht(!0)},jn=()=>{bt(!0)},Sn=()=>{St(!1),go?go.leave().then((()=>{console.log("[Owner Not Live] Successfully left call, navigating away"),we("/side-rooms")})).catch((e=>{console.error("[Owner Not Live] Error leaving call:",e),we("/side-rooms")})):we("/side-rooms")};return(0,Ie.jsxs)(Ie.Fragment,{children:[xt.map((e=>(0,Ie.jsx)(Po,{icon:(0,Ie.jsx)(_.A,{}),color:ke.palette.error.main},"heart-".concat(e)))),vt.map((e=>(0,Ie.jsx)(Po,{icon:(0,Ie.jsx)(q.A,{}),color:ke.palette.error.main},"heartbreak-".concat(e)))),Fe&&(0,Ie.jsx)(Fo,{handleHeartRoom:async()=>{if(!je||!je.uid||!Ce||!Fe)return;pt((e=>[...e,Date.now()])),wr(!0);const e=(0,d.H9)(l.db,"sideRooms",Ce,"heartedBy",je.uid),o=(0,d.H9)(l.db,"sideRooms",Ce,"heartbrokenBy",je.uid),r=(0,d.H9)(l.db,"sideRooms",Ce);try{await(0,d.c4)(l.db,(async t=>{var n;const i=await t.get(e),a=await t.get(o);if(!(await t.get(r)).exists())throw"Room does not exist!";const s=await(0,d.x7)((0,d.H9)(l.db,"users",je.uid)),c=s.exists()?(null===(n=s.data())||void 0===n?void 0:n.username)||je.displayName:"Someone";a.exists()&&(t.delete(o),t.update(r,{heartbreakCount:(0,d.GV)(-1)}),Wo(!1)),i.exists()?(t.delete(e),t.update(r,{heartCount:(0,d.GV)(-1)})):(t.set(e,{userId:je.uid,username:c,timestamp:(0,d.O5)()}),t.update(r,{heartCount:(0,d.GV)(1)}))}))}catch(Xe){console.error("Error hearting room:",Xe),c.oR.error("Failed to update heart status.")}finally{wr(!1)}},handleHeartbreakRoom:async()=>{if(!je||!je.uid||!Ce||!Fe)return;gt((e=>[...e,Date.now()])),Lo(!0);const e=(0,d.H9)(l.db,"sideRooms",Ce,"heartbrokenBy",je.uid),o=(0,d.H9)(l.db,"sideRooms",Ce,"heartedBy",je.uid),r=(0,d.H9)(l.db,"sideRooms",Ce);try{await(0,d.c4)(l.db,(async t=>{var n;const i=await t.get(e),a=await t.get(o);if(!(await t.get(r)).exists())throw"Room does not exist!";const s=await(0,d.x7)((0,d.H9)(l.db,"users",je.uid)),c=s.exists()?(null===(n=s.data())||void 0===n?void 0:n.username)||je.displayName:"Someone";a.exists()&&(t.delete(o),t.update(r,{heartCount:(0,d.GV)(-1)}),ko(!1)),i.exists()?(t.delete(e),t.update(r,{heartbreakCount:(0,d.GV)(-1)})):(t.set(e,{userId:je.uid,username:c,timestamp:(0,d.O5)()}),t.update(r,{heartbreakCount:(0,d.GV)(1)}))}))}catch(Xe){console.error("Error heartbreaking room:",Xe),c.oR.error("Failed to update heartbreak status.")}finally{Lo(!1)}},currentUserHearted:So,currentUserHeartbroken:Mo,roomHeartCount:wo,roomHeartbreakCount:No,isHearting:Cr,isHeartbreaking:Ho,accentColor:null===Fe||void 0===Fe||null===(e=Fe.style)||void 0===e?void 0:e.accentColor,textColor:null===Fe||void 0===Fe||null===(o=Fe.style)||void 0===o?void 0:o.textColor}),(0,Ie.jsxs)(De.mg,{children:[(0,Ie.jsx)("title",{children:pn}),(0,Ie.jsx)("meta",{name:"description",content:vn}),(0,Ie.jsx)("meta",{property:"og:type",content:"website"}),(0,Ie.jsx)("meta",{property:"og:url",content:bn}),(0,Ie.jsx)("meta",{property:"og:title",content:pn}),(0,Ie.jsx)("meta",{property:"og:description",content:vn}),(0,Ie.jsx)("meta",{property:"og:image",content:fn}),(0,Ie.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,Ie.jsx)("meta",{property:"og:image:height",content:"630"}),(0,Ie.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,Ie.jsx)("meta",{name:"twitter:url",content:bn}),(0,Ie.jsx)("meta",{name:"twitter:title",content:pn}),(0,Ie.jsx)("meta",{name:"twitter:description",content:vn}),(0,Ie.jsx)("meta",{name:"twitter:image",content:fn})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",fontFamily:(null===Fe||void 0===Fe||null===(r=Fe.style)||void 0===r?void 0:r.font)||Ro[0],backgroundColor:null!==Fe&&void 0!==Fe&&null!==(a=Fe.style)&&void 0!==a&&a.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Fe||void 0===Fe||null===(B=Fe.style)||void 0===B?void 0:B.backgroundColor)||ke.palette.background.default,", ").concat((null===Fe||void 0===Fe||null===(X=Fe.style)||void 0===X?void 0:X.accentColor)||ke.palette.secondary.main,")"):(null===Fe||void 0===Fe||null===(Y=Fe.style)||void 0===Y?void 0:Y.backgroundColor)||ke.palette.background.default,color:(null===Fe||void 0===Fe||null===(J=Fe.style)||void 0===J?void 0:J.textColor)||ke.palette.text.primary,overflow:"hidden",willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[Fe&&(()=>{var e,o,r,t,n,i,a,s,m,w,j,S,k,I,R,E,P,F,U,D,T,O,N,z,M;return(0,Ie.jsxs)(u.A,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:null!==Fe&&void 0!==Fe&&null!==(e=Fe.style)&&void 0!==e&&e.headerGradient?"linear-gradient(to right, ".concat((null===Fe||void 0===Fe||null===(o=Fe.style)||void 0===o?void 0:o.headerColor)||ke.palette.primary.main,", ").concat((null===Fe||void 0===Fe||null===(r=Fe.style)||void 0===r?void 0:r.accentColor)||ke.palette.secondary.light,")"):(null===Fe||void 0===Fe||null===(t=Fe.style)||void 0===t?void 0:t.headerColor)||ke.palette.background.paper,color:(null===Fe||void 0===Fe||null===(n=Fe.style)||void 0===n?void 0:n.textColor)||"inherit"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,Ie.jsx)(p.A,{variant:"h6",sx:{fontFamily:(null===Fe||void 0===Fe||null===(i=Fe.style)||void 0===i?void 0:i.font)||Ro[0],fontSize:null!==Fe&&void 0!==Fe&&null!==(a=Fe.style)&&void 0!==a&&a.headerFontSize?"".concat(Fe.style.headerFontSize,"px"):"1.25rem",fontWeight:600},children:null===Fe||void 0===Fe?void 0:Fe.name}),Lt&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{opacity:null!==Fe&&void 0!==Fe&&null!==(s=Fe.style)&&void 0!==s&&s.textColor?.85:1,fontFamily:(null===Fe||void 0===Fe||null===(m=Fe.style)||void 0===m?void 0:m.font)||Ro[0]},children:["Host: ",Lt.username]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(null===je||void 0===je?void 0:je.uid)&&(null===Fe||void 0===Fe?void 0:Fe.ownerId)&&je.uid!==Fe.ownerId&&Lt&&(0,Ie.jsx)(h.A,{title:"Follow ".concat(Lt.username),children:(0,Ie.jsx)(x.A,{onClick:async()=>{if(null!==je&&void 0!==je&&je.uid&&null!==Fe&&void 0!==Fe&&Fe.ownerId&&l.db)try{const e=(0,d.H9)(l.db,"users",je.uid,"following",Fe.ownerId),o=await(0,d.x7)(e),r=(0,d.H9)(l.db,"users",Fe.ownerId,"followRequests",je.uid),t=await(0,d.x7)(r),n=(0,d.H9)(l.db,"users",Fe.ownerId),i=await(0,d.x7)(n),a=i.exists()&&!0===i.data().isPrivate;if(o.exists()){await(0,d.kd)(e);const o=(0,d.H9)(l.db,"users",Fe.ownerId,"followers",je.uid);await(0,d.kd)(o),c.oR.success("Unfollowed ".concat(Lt.username))}else if(t.exists())await(0,d.kd)(r),c.oR.success("Canceled follow request to ".concat(Lt.username));else if(a)await(0,d.BN)(r,{userId:je.uid,username:je.displayName||je.email||"Unknown user",timestamp:(0,d.O5)()}),c.oR.success("Follow request sent to ".concat(Lt.username));else{await(0,d.BN)(e,{timestamp:(0,d.O5)()});const o=(0,d.H9)(l.db,"users",Fe.ownerId,"followers",je.uid);await(0,d.BN)(o,{timestamp:(0,d.O5)()}),c.oR.success("Following ".concat(Lt.username));const r=await Kt(Fe.ownerId);r&&!mt&&(ut(r),dt(!0))}}catch(Xe){console.error("Error toggling follow:",Xe),c.oR.error("Failed to follow/unfollow host")}else c.oR.error("Cannot follow host: missing data")},sx:{color:(null===Fe||void 0===Fe||null===(w=Fe.style)||void 0===w?void 0:w.accentColor)||"inherit"},children:(0,Ie.jsx)(Z.A,{})})}),(0,Ie.jsx)(h.A,{title:"Share",children:(0,Ie.jsx)(x.A,{onClick:$t,sx:{color:(null===Fe||void 0===Fe||null===(j=Fe.style)||void 0===j?void 0:j.accentColor)||"inherit"},children:(0,Ie.jsx)(K.A,{})})}),(null===je||void 0===je?void 0:je.uid)&&(null===Fe||void 0===Fe?void 0:Fe.ownerId)&&je.uid!==Fe.ownerId&&(0,Ie.jsx)(h.A,{title:"Report Room",children:(0,Ie.jsx)(x.A,{onClick:jn,sx:{color:(null===Fe||void 0===Fe||null===(S=Fe.style)||void 0===S?void 0:S.accentColor)||"inherit"},children:(0,Ie.jsx)(Q.A,{})})}),zt&&(0,Ie.jsx)(h.A,{title:"Share Video Link",children:(0,Ie.jsx)(x.A,{onClick:Vt,size:"small",color:"secondary",children:(0,Ie.jsx)($.A,{})})}),(0,Ie.jsx)(h.A,{title:"Chat with Sade AI",children:(0,Ie.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI Chat",onClick:()=>lr(!0),sx:{width:32,height:32,cursor:"pointer","&:hover":{opacity:.8},border:"1px solid ".concat((null===Fe||void 0===Fe||null===(k=Fe.style)||void 0===k?void 0:k.accentColor)||ke.palette.primary.light)}})}),Mr&&(0,Ie.jsx)(h.A,{title:Gr?"Stop Recording":"Record Room (Desktop Only)",children:(0,Ie.jsx)(x.A,{onClick:Gr?Cn:An,color:Gr?"error":"inherit",sx:{color:Gr?ke.palette.error.main:(null===Fe||void 0===Fe||null===(I=Fe.style)||void 0===I?void 0:I.accentColor)||"inherit"},children:Gr?(0,Ie.jsx)(ee.A,{}):(0,Ie.jsx)(oe.A,{})})}),go&&(0,Ie.jsx)(Ie.Fragment,{children:zt?(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(h.A,{title:Jr?"Turn Camera Off":"Turn Camera On",children:(0,Ie.jsx)(x.A,{onClick:Dt,sx:{color:Jr?(null===Fe||void 0===Fe||null===(R=Fe.style)||void 0===R?void 0:R.accentColor)||ke.palette.primary.main:"inherit"},children:Jr?(0,Ie.jsx)(oe.A,{}):(0,Ie.jsx)(re.A,{})})}),(0,Ie.jsx)(h.A,{title:Kr.length>0?"".concat(Kr.length," camera request(s) - Click to manage"):"Manage camera requests",children:(0,Ie.jsx)(x.A,{onClick:()=>et(!0),sx:{color:Kr.length>0?ke.palette.warning.main:(null===Fe||void 0===Fe||null===(E=Fe.style)||void 0===E?void 0:E.accentColor)||"inherit",animation:Kr.length>0?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}},children:Kr.length>0?(0,Ie.jsx)(g.A,{badgeContent:Kr.length,color:"error",children:(0,Ie.jsx)(Z.A,{})}):(0,Ie.jsx)(Z.A,{})})})]}):Jr?(0,Ie.jsx)(h.A,{title:"Turn Camera Off",children:(0,Ie.jsx)(x.A,{onClick:()=>{go&&go.camera.disable().then((()=>{Zr(!1),c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)}))},sx:{color:(null===Fe||void 0===Fe||null===(F=Fe.style)||void 0===F?void 0:F.accentColor)||ke.palette.primary.main},children:(0,Ie.jsx)(oe.A,{})})}):(0,Ie.jsx)(h.A,{title:ot?"Camera request pending...":"Request camera permission",children:(0,Ie.jsx)("span",{children:(0,Ie.jsx)(x.A,{onClick:Pt,disabled:ot,sx:{color:ot?ke.palette.warning.main:(null===Fe||void 0===Fe||null===(P=Fe.style)||void 0===P?void 0:P.accentColor)||"inherit"},children:ot?(0,Ie.jsx)(g.A,{variant:"dot",color:"warning",children:(0,Ie.jsx)(oe.A,{})}):(0,Ie.jsx)(re.A,{})})})})}),zt&&(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(h.A,{title:"Room Settings",children:(0,Ie.jsx)(x.A,{onClick:en,sx:{color:(null===Fe||void 0===Fe||null===(U=Fe.style)||void 0===U?void 0:U.accentColor)||"inherit"},children:(0,Ie.jsx)(te.A,{})})}),(0,Ie.jsxs)(f.A,{anchorEl:ao,open:Boolean(ao),onClose:on,children:[(0,Ie.jsxs)(b.A,{onClick:rn,children:[" ",(0,Ie.jsx)(y.A,{children:(0,Ie.jsx)(ne.A,{fontSize:"small"})}),"Edit Room"]}),(0,Ie.jsxs)(b.A,{onClick:tn,children:[" ",(0,Ie.jsx)(y.A,{children:(0,Ie.jsx)(ie.A,{fontSize:"small"})}),"Customize"]}),(0,Ie.jsxs)(b.A,{onClick:nn,children:[" ",(0,Ie.jsx)(y.A,{children:(0,Ie.jsx)(Z.A,{fontSize:"small"})}),"Invite"]}),(0,Ie.jsxs)(b.A,{onClick:()=>{At(!0),on()},children:[(0,Ie.jsx)(y.A,{children:(0,Ie.jsx)(ae.A,{fontSize:"small"})}),"View Banned Users"]}),(0,Ie.jsxs)(b.A,{onClick:sn,sx:{color:"error.main"},children:[(0,Ie.jsx)(y.A,{children:(0,Ie.jsx)(se.A,{fontSize:"small",color:"error"})}),"Delete Room"]})]})]}),(0,Ie.jsx)(h.A,{title:"Leave Room",children:(0,Ie.jsx)(x.A,{onClick:()=>{zt?Or(!0):we("/side-rooms")},disabled:_e,sx:{color:(null===Fe||void 0===Fe||null===(D=Fe.style)||void 0===D?void 0:D.accentColor)||"inherit"},children:(0,Ie.jsx)(le.A,{})})})]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ie.jsxs)(p.A,{variant:"caption",sx:{fontFamily:(null===Fe||void 0===Fe||null===(T=Fe.style)||void 0===T?void 0:T.font)||Ro[0]},children:[Ht.length," Online"]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!go&&po&&Wt&&(0,Ie.jsx)(A.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{console.log("User clicked 'Connect Audio (Stream)' button."),go?(0,c.oR)("Already connected to audio.",{icon:"\u2139\ufe0f"}):Co(!0)},startIcon:bo?(0,Ie.jsx)(C.A,{size:20,color:"inherit"}):(0,Ie.jsx)(de.A,{}),disabled:bo||!po,sx:{backgroundColor:null===Fe||void 0===Fe||null===(O=Fe.style)||void 0===O?void 0:O.accentColor,fontFamily:(null===Fe||void 0===Fe||null===(N=Fe.style)||void 0===N?void 0:N.font)||Ro[0],color:null!==Fe&&void 0!==Fe&&null!==(z=Fe.style)&&void 0!==z&&z.accentColor?ke.palette.getContrastText(Fe.style.accentColor):void 0},children:bo?"Connecting...":"Connect Audio (Stream)"}),go&&(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(h.A,{title:"Toggle Microphone",children:(0,Ie.jsxs)(x.A,{onClick:async()=>{var e;if(null===go||void 0===go||!go.microphone||null===je||void 0===je||!je.uid||!Ce)return;const o=lo.find((e=>e.userId===je.uid)),r=!(null===(e=null===o||void 0===o?void 0:o.isMuted)||void 0===e||e);try{await go.microphone.toggle(),console.log("[Mic Toggle] Stream toggle executed. Intended new state: ".concat(r));const e=(0,d.H9)(l.db,"sideRooms",Ce,"presence",je.uid);await(0,d.mZ)(e,{isMuted:r}),console.log("[Mic Toggle] Updated Firestore isMuted for ".concat(je.uid," to ").concat(r))}catch(Xe){console.error("[Mic Toggle] Error toggling mic or updating Firestore:",Xe),c.oR.error("Failed to toggle microphone status.")}},color:"primary",disabled:!(null!==go&&void 0!==go&&go.microphone)||!(null!==je&&void 0!==je&&je.uid)||!Ce,children:[(0,Ie.jsx)(ce.A,{})," "]})}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{color:"lightgreen",mr:1},children:"Stream Audio Connected"}),(0,Ie.jsx)(A.A,{variant:"outlined",size:"small",color:"error",onClick:()=>{null===go||void 0===go||go.leave().then((()=>{console.log("[Header Leave] Successfully left call, navigating..."),we("/side-rooms")})).catch((e=>{console.error("[Header Leave] Error leaving call:",e),c.oR.error("Error leaving audio call.")}))},disabled:bo,sx:{fontFamily:(null===Fe||void 0===Fe||null===(M=Fe.style)||void 0===M?void 0:M.font)||Ro[0]},children:"Leave Audio"})]}),!po&&Ge&&(0,Ie.jsx)(C.A,{size:24})]})]})]})})(),(0,Ie.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto"},children:Fe?po?go?(0,Ie.jsx)(Pe.Mf9,{client:po,children:(0,Ie.jsx)(Pe.xwR,{call:go,children:(0,Ie.jsx)(Do,{room:Fe,isRoomOwner:zt,isGuest:Mt,handleOpenShareVideoDialog:Vt,handleClearSharedVideo:Yt,currentVideoUrl:_o,renderVideoPlayer:xn,onForceMuteToggle:ln,onForceRemove:dn,onForceBan:cn,theme:ke,navigate:we,requestCameraPermission:Pt,hasPendingCameraRequest:ot,toggleCameraCallback:Dt,shouldShowUserVideo:Ut,approvedCameraUsers:tt})})}):(0,Ie.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[_o&&(0,Ie.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1},children:"Shared Video"}),zt&&(0,Ie.jsx)(h.A,{title:"Clear Shared Video",children:(0,Ie.jsx)(x.A,{onClick:Yt,size:"small",children:(0,Ie.jsx)(ue.A,{})})})]}),(0,Ie.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:xn()})]}),(0,Ie.jsxs)(p.A,{variant:"h6",gutterBottom:!0,children:["Participants (",Ht.length,")"]}),(0,Ie.jsx)(j.Ay,{container:!0,spacing:2,children:Ht.map((e=>(0,Ie.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,lg:2,children:(0,Ie.jsxs)(S.A,{sx:{p:1,textAlign:"center"},children:[(0,Ie.jsx)(v.A,{src:e.avatar,alt:e.displayName||e.username,sx:{width:60,height:60,margin:"auto",mb:1}}),(0,Ie.jsx)(p.A,{variant:"caption",display:"block",noWrap:!0,children:e.displayName||e.username}),e.isMuted&&(0,Ie.jsx)(me.A,{fontSize:"small",color:"error",sx:{mt:.5}})]})},e.userId)))}),!go&&!bo&&Wt&&(0,Ie.jsx)(w.A,{severity:"warning",sx:{mt:2},children:"Audio not connected. Use the button in the header."}),bo&&(0,Ie.jsx)(w.A,{severity:"info",sx:{mt:2},children:"Connecting to room audio..."})]}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",p:2,textAlign:"center"},children:[null===ho&&Wt&&null!==je&&void 0!==je&&je.uid&&Ce||null!==ho&&!po?(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(C.A,{sx:{mb:2}}),(0,Ie.jsx)(p.A,{children:"Initializing audio components..."}),(0,Ie.jsx)(p.A,{variant:"caption",children:"(If this persists, please check your connection or try refreshing.)"})]}):!Wt&&null!==je&&void 0!==je&&je.uid?(0,Ie.jsx)(w.A,{severity:"info",sx:{mb:2},children:"You currently don't have audio access to this room. If this is a private room, ensure you've joined correctly."}):(0,Ie.jsx)(w.A,{severity:"info",sx:{mb:2},children:"Audio service is waiting for user authentication or room access."}),(0,Ie.jsx)(A.A,{onClick:()=>window.location.reload(),sx:{mt:2},variant:"outlined",children:"Refresh Page"})]}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:[Ge&&(0,Ie.jsx)(C.A,{}),!Ge&&(0,Ie.jsxs)(w.A,{severity:"error",children:["Room not found. ",(0,Ie.jsx)(A.A,{onClick:()=>we("/discover"),sx:{ml:1},children:"Back to Discover"})]})]})}),(0,Ie.jsxs)(k.A,{open:Go,onClose:_t,fullWidth:!0,maxWidth:"sm",children:[(0,Ie.jsx)(I.A,{children:"Share a Video"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsx)(E.A,{autoFocus:!0,margin:"dense",id:"videoUrl",label:"Video URL (e.g., YouTube)",type:"url",fullWidth:!0,variant:"standard",value:Xo,onChange:e=>Vo(e.target.value),placeholder:"https://www.youtube.com/watch?v=..."})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:_t,children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:()=>{if(!Ce)return void c.oR.error("Cannot share video: Room ID is missing.");if(!Xo.trim())return void c.oR.error("Please enter a video URL.");if(!Xo.startsWith("http://")&&!Xo.startsWith("https://"))return void c.oR.error("Invalid URL format.");const e=(0,d.H9)(l.db,"sideRooms",Ce);(0,d.mZ)(e,{currentSharedVideoUrl:Xo,lastActive:(0,d.O5)()}).then((()=>{console.warn("[SideRoomComponent] Video sharing part needs review for signaling if not using Firestore listeners for immediate effect")})).catch((e=>console.error("Error directly updating video URL in Firestore:",e))),Yo(Xo),c.oR.success("Video shared!"),_t()},variant:"contained",children:"Share Video"})]})]}),(0,Ie.jsxs)(k.A,{open:no,onClose:()=>io(!1),fullWidth:!0,maxWidth:"xs",children:[(0,Ie.jsx)(I.A,{children:"Share this Room"}),(0,Ie.jsxs)(R.A,{sx:{textAlign:"center"},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",gutterBottom:!0,children:"Share this room link:"}),(0,Ie.jsx)(E.A,{fullWidth:!0,variant:"outlined",value:"".concat(window.location.origin,"/side-room/").concat(Ce),InputProps:{readOnly:!0},sx:{mb:2}}),(0,Ie.jsx)(A.A,{variant:"contained",startIcon:(0,Ie.jsx)(he.A,{}),onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(Ce)),c.oR.success("Room link copied to clipboard!")},sx:{mb:2},children:"Copy Link"}),(0,Ie.jsx)(F.A,{sx:{my:2},children:(0,Ie.jsx)(U.A,{label:"OR"})}),(0,Ie.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share via Direct Message:"}),(0,Ie.jsx)(A.A,{variant:"outlined",startIcon:(0,Ie.jsx)(xe.A,{}),onClick:()=>{io(!1),Le(!0)},sx:{mb:2,width:"100%"},children:"Send to a Friend"}),(0,Ie.jsx)(F.A,{sx:{my:2},children:(0,Ie.jsx)(U.A,{label:"OR"})}),(0,Ie.jsx)(p.A,{variant:"subtitle2",gutterBottom:!0,sx:{mb:1},children:"Share on social media:"}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-around",mt:1},children:[(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(Ce)),"&text=").concat(encodeURIComponent((null===Fe||void 0===Fe?void 0:Fe.name)||"Join my SideEye Room!")),"_blank"),title:"Share on Twitter",children:(0,Ie.jsx)(pe.A,{})}),(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(encodeURIComponent("".concat(window.location.origin,"/side-room/").concat(Ce))),"_blank"),title:"Share on Facebook",children:(0,Ie.jsx)(ve.A,{})}),(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>window.open("https://api.whatsapp.com/send?text=".concat(encodeURIComponent(((null===Fe||void 0===Fe?void 0:Fe.name)||"Join my SideEye Room!")+" "+"".concat(window.location.origin,"/side-room/").concat(Ce))),"_blank"),title:"Share on WhatsApp",children:(0,Ie.jsx)(ge.A,{})}),(0,Ie.jsx)(x.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/side-room/").concat(Ce)),c.oR.success("Room link copied! Paste it on Instagram."),window.open("https://www.instagram.com","_blank")},title:"Copy link & Open Instagram",children:(0,Ie.jsx)(fe.A,{})})]})]}),(0,Ie.jsx)(P.A,{children:(0,Ie.jsx)(A.A,{onClick:()=>io(!1),children:"Close"})})]}),(0,Ie.jsxs)(k.A,{open:sr,onClose:()=>lr(!1),fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[(0,Ie.jsxs)(I.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Chat with Sade AI",(0,Ie.jsx)(h.A,{title:"Clear Chat History",children:(0,Ie.jsx)(x.A,{onClick:()=>{cr([]),localStorage.removeItem("sideroom_sade_chat_history"),c.oR.success("Sade AI chat cleared")},size:"small",children:(0,Ie.jsx)(se.A,{})})})]}),(0,Ie.jsx)(R.A,{sx:{flexGrow:1,overflowY:"auto",p:1,backgroundColor:ke.palette.background.default},children:(0,Ie.jsxs)(D.A,{sx:{p:0},children:[dr.map(((e,o)=>(0,Ie.jsxs)(T.Ay,{sx:{display:"flex",flexDirection:"user"===e.sender?"row-reverse":"row",alignItems:"flex-start",mb:1,p:0},children:["ai"===e.sender&&(0,Ie.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",maxWidth:"75%"},children:[(0,Ie.jsx)(S.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"user"===e.sender?"15px 15px 0 15px":"15px 15px 15px 0",bgcolor:"user"===e.sender?"primary.main":"background.paper",color:"user"===e.sender?"primary.contrastText":"text.primary",maxWidth:"100%",wordBreak:"break-word"},children:e.text}),"ai"===e.sender&&e.sourceLinks&&(0,Ie.jsx)(Ne.A,{links:e.sourceLinks})]})]},"msg-".concat(e.sender,"-").concat(o)))),hr&&(0,Ie.jsxs)(T.Ay,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",mb:1,p:0},children:[(0,Ie.jsx)(v.A,{src:"/images/sade-avatar.jpg",alt:"Sade AI",sx:{width:32,height:32,mr:1,mb:.5}}),(0,Ie.jsx)(S.A,{elevation:1,sx:{p:"6px 12px",borderRadius:"15px 15px 15px 0",bgcolor:"background.paper",color:"text.secondary",maxWidth:"75%",wordBreak:"break-word",animation:"pulseFade 1.5s infinite","@keyframes pulseFade":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:"Thinking..."})]}),(0,Ie.jsx)("div",{ref:pr})]})}),(0,Ie.jsxs)(P.A,{sx:{p:1,borderTop:"1px solid ".concat(ke.palette.divider),flexDirection:"column"},children:[dr.length<=1&&!hr&&(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1,justifyContent:"center",px:1},children:["Tell me a fun fact","What does 'innit' mean?","Play 'Would You Rather?'","Help me relax with a breathing exercise","How's the weather?","What can you do?"].map(((e,o)=>(0,Ie.jsx)(U.A,{label:e,onClick:()=>hn(e),size:"small",variant:"outlined"},"suggestion-".concat(o))))}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",width:"100%"},children:[(0,Ie.jsx)(E.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Talk to Sade...",value:ur,onChange:e=>mr(e.target.value),onKeyPress:e=>"Enter"===e.key&&!hr&&hn(),sx:{mr:1},disabled:hr}),(0,Ie.jsxs)(x.A,{onClick:()=>!hr&&hn(ur,!1),disabled:hr||!ur.trim(),color:"primary",children:[(0,Ie.jsx)(K.A,{sx:{transform:"rotate(-90deg)"}})," "]}),(0,Ie.jsxs)(x.A,{onClick:()=>!hr&&hn(ur,!0),disabled:hr||!ur.trim(),color:"secondary",title:"Search the web",children:[(0,Ie.jsx)(be.A,{})," "]})]})]})]}),Qe&&Fe&&(0,Ie.jsx)(Re,{open:Qe,onClose:()=>$e(!1),onSubmit:async(e,o)=>{if(Ce&&je){Ye(!0);try{let r=Fe.thumbnailUrl||"";if(o){const e=(0,Ue.KR)(l.IG,"room-thumbnails/".concat(Ce,"_").concat(Date.now(),"_").concat(o.name));await(0,Ue.D)(e,o),r=await(0,Ue.qk)(e)}const t=(0,d.H9)(l.db,"sideRooms",Ce),n={name:e.name,description:e.description,isPrivate:e.isPrivate,tags:e.tags||[],thumbnailUrl:r,lastActive:(0,d.O5)()};e.isPrivate&&e.password&&e.password.length>0?n.password=e.password:e.isPrivate||(n.password=(0,d.CL)()),await(0,d.mZ)(t,n),c.oR.success("Room details updated successfully!"),$e(!1)}catch(r){console.error("Error updating room:",r),c.oR.error("Failed to update room details.")}finally{Ye(!1)}}else c.oR.error("Error: Missing room or user data.")},initialData:Fe,title:"Edit Room",submitButtonText:"Save Changes"}),(0,Ie.jsxs)(k.A,{open:ro,onClose:()=>to(!1),fullWidth:!0,maxWidth:"sm",children:[(0,Ie.jsx)(I.A,{children:"Customize Room Appearance"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",gap:2,pt:1},children:[(0,Ie.jsxs)(O.A,{fullWidth:!0,children:[(0,Ie.jsx)(N.A,{id:"theme-select-label",children:"Theme"}),(0,Ie.jsx)(z.A,{labelId:"theme-select-label",value:jr,label:"Theme",onChange:e=>Sr(e.target.value),children:Io.map((e=>(0,Ie.jsx)(b.A,{value:e.name,children:e.name},e.name)))})]}),(0,Ie.jsxs)(O.A,{fullWidth:!0,children:[(0,Ie.jsx)(N.A,{id:"font-select-label",children:"Font"}),(0,Ie.jsx)(z.A,{labelId:"font-select-label",value:Pr,label:"Font",onChange:e=>Fr(e.target.value),children:Ro.map((e=>(0,Ie.jsx)(b.A,{value:e,children:e},e)))})]}),(0,Ie.jsxs)(O.A,{fullWidth:!0,children:[(0,Ie.jsx)(N.A,{id:"text-size-select-label",children:"Header Text Size (px)"}),(0,Ie.jsx)(z.A,{labelId:"text-size-select-label",value:Ur.toString(),label:"Header Text Size (px)",onChange:e=>Dr(Number(e.target.value)),children:Eo.map((e=>(0,Ie.jsx)(b.A,{value:e.toString(),children:e},e)))})]}),(0,Ie.jsx)(M.A,{control:(0,Ie.jsx)(W.A,{checked:kr,onChange:e=>Ir(e.target.checked)}),label:"Use Header Gradient"}),(0,Ie.jsx)(M.A,{control:(0,Ie.jsx)(W.A,{checked:Rr,onChange:e=>Er(e.target.checked)}),label:"Use Background Gradient"})]})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:()=>to(!1),children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:async()=>{var e,o,r,t,n;if(!Ce||!Fe)return void c.oR.error("Cannot save style: Room data is missing.");if(!je)return void c.oR.error("You must be logged in to change the style.");if(!zt)return void c.oR.error("Only the room owner can change the style.");const i=Io.find((e=>e.name===jr));if(!i){var a,s,u,m,h;c.oR.error("Invalid theme selected. Defaulting to first theme.");const e=Io[0],o={themeName:e.name,headerColor:e.headerColor,backgroundColor:e.backgroundColor,textColor:e.textColor,accentColor:e.accentColor,font:Pr,headerFontSize:Ur,headerGradient:kr,backgroundGradient:Rr,customCss:(null===(a=Fe.style)||void 0===a?void 0:a.customCss)||"",bannerUrl:(null===(s=Fe.style)||void 0===s?void 0:s.bannerUrl)||"",stickers:(null===(u=Fe.style)||void 0===u?void 0:u.stickers)||[],glitterEffect:(null===(m=Fe.style)||void 0===m?void 0:m.glitterEffect)||!1,thumbnailUrl:(null===(h=Fe.style)||void 0===h?void 0:h.thumbnailUrl)||Fe.thumbnailUrl||""};try{const e=(0,d.H9)(l.db,"sideRooms",Ce);await(0,d.mZ)(e,{style:o,lastActive:(0,d.O5)()}),c.oR.success("Room style updated (defaulted theme)!"),to(!1)}catch(Xe){console.error("Error updating room style with default theme:",Xe),c.oR.error("Failed to update room style.")}finally{Ye(!1)}return}const x={themeName:i.name,headerColor:i.headerColor,backgroundColor:i.backgroundColor,textColor:i.textColor,accentColor:i.accentColor,font:Pr,headerFontSize:Ur,headerGradient:kr,backgroundGradient:Rr,customCss:(null===(e=Fe.style)||void 0===e?void 0:e.customCss)||"",bannerUrl:(null===(o=Fe.style)||void 0===o?void 0:o.bannerUrl)||"",stickers:(null===(r=Fe.style)||void 0===r?void 0:r.stickers)||[],glitterEffect:(null===(t=Fe.style)||void 0===t?void 0:t.glitterEffect)||!1,thumbnailUrl:(null===(n=Fe.style)||void 0===n?void 0:n.thumbnailUrl)||Fe.thumbnailUrl||""};Ye(!0);try{const e=(0,d.H9)(l.db,"sideRooms",Ce);await(0,d.mZ)(e,{style:x,lastActive:(0,d.O5)()}),c.oR.success("Room style updated successfully!"),to(!1)}catch(Xe){console.error("Error updating room style:",Xe),c.oR.error("Failed to update room style.")}finally{Ye(!1)}},variant:"contained",disabled:_e,children:_e?(0,Ie.jsx)(C.A,{size:24}):"Save Style"})]})]}),(0,Ie.jsxs)(k.A,{open:eo,onClose:()=>{oo(!1),Jo(""),or(null),Ko([]),$o(!1)},fullWidth:!0,maxWidth:"xs",children:[(0,Ie.jsx)(I.A,{children:"Invite User to Room"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsx)(p.A,{variant:"body2",sx:{mb:2},children:"Search for a user by their username to invite them as a guest."}),(0,Ie.jsxs)(u.A,{ref:nr,sx:{position:"relative"},children:[(0,Ie.jsx)(E.A,{fullWidth:!0,label:"Search Username",variant:"outlined",value:qo,onChange:e=>{const o=e.target.value;console.log('[SideRoomComponent] handleInviteSearchChange: "'.concat(o,'"')),Jo(o),or(null),o.trim().length>=2?($o(!0),Qt(o)):($o(!1),Ko([]))},sx:{mb:1}}),Qo&&Zo.length>0&&(0,Ie.jsx)(S.A,{elevation:3,sx:{position:"absolute",width:"100%",maxHeight:200,overflowY:"auto",zIndex:ke.zIndex.modal+1,mt:.5},children:(0,Ie.jsx)(H.x,{onClickAway:()=>{$o(!1)},children:(0,Ie.jsx)(D.A,{dense:!0,children:Zo.map((e=>(0,Ie.jsxs)(T.Ay,{button:!0,onClick:()=>{return or(o=e),Jo(o.username),$o(!1),void Ko([]);var o},children:[(0,Ie.jsx)(L.A,{children:(0,Ie.jsx)(v.A,{src:e.profilePic,alt:e.username})}),(0,Ie.jsx)(G.A,{primary:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[e.username,(0,Ie.jsx)(ye.A,{sx:{ml:.5,color:"primary.main",fontSize:"0.8rem",verticalAlign:"middle"}})]}),secondary:e.name})]},e.id)))})})}),Qo&&0===Zo.length&&qo.length>=2&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1,color:"text.secondary"},children:['No users found matching "',qo,'".']})]}),er&&(0,Ie.jsxs)(p.A,{variant:"caption",sx:{display:"block",mt:1,color:"success.main"},children:["Selected: ",er.username,(0,Ie.jsx)(ye.A,{sx:{ml:.3,color:"primary.main",fontSize:"0.7rem",verticalAlign:"middle"}})]})]}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:()=>{oo(!1),Jo(""),or(null),Ko([]),$o(!1)},children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:an,variant:"contained",disabled:rr||!er||!ir,children:rr?(0,Ie.jsx)(C.A,{size:24}):"Send Invite"})]})]}),(0,Ie.jsxs)(k.A,{open:Tr,onClose:()=>Or(!1),"aria-labelledby":"end-room-dialog-title","aria-describedby":"end-room-dialog-description",children:[(0,Ie.jsx)(I.A,{id:"end-room-dialog-title",children:"End Room?"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsx)(p.A,{variant:"body1",id:"end-room-dialog-description",children:"Are you sure you want to end this room?"}),(0,Ie.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will remove everyone and permanently delete the room. This action cannot be undone."})]}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:()=>Or(!1),disabled:_e,children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:()=>{Or(!1),sn()},color:"error",variant:"contained",disabled:_e,autoFocus:!0,children:_e?(0,Ie.jsx)(C.A,{size:24}):"End and Delete"})]})]}),(0,Ie.jsxs)(k.A,{open:qe,onClose:()=>{zt||Wt||we("/side-rooms")},children:[(0,Ie.jsx)(I.A,{children:"Password Required"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsx)(p.A,{variant:"body1",gutterBottom:!0,children:"This room is password protected. Please enter the password to join."}),(0,Ie.jsx)(E.A,{autoFocus:!0,margin:"dense",id:"password",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Ze,onChange:e=>Ke(e.target.value),onKeyPress:e=>"Enter"===e.key&&yn()})]}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:()=>we("/side-rooms"),disabled:_e,children:"Cancel"}),(0,Ie.jsx)(A.A,{onClick:yn,disabled:_e||!Ze,variant:"contained",children:_e?(0,Ie.jsx)(C.A,{size:24}):"Submit"})]})]}),(0,Ie.jsxs)(k.A,{open:lt,onClose:wn,"aria-labelledby":"join-room-chat-dialog-title",children:[(0,Ie.jsx)(I.A,{id:"join-room-chat-dialog-title",children:"Join Room Chat?"}),(0,Ie.jsx)(R.A,{children:(0,Ie.jsxs)(p.A,{variant:"body1",children:[(null===Lt||void 0===Lt?void 0:Lt.username)||"This creator",' has a server chat room: "',null===ct||void 0===ct?void 0:ct.name,'". Would you like to join it to receive updates and connect with other followers?']})}),(0,Ie.jsxs)(P.A,{children:[(0,Ie.jsx)(A.A,{onClick:wn,children:"Not Now"}),(0,Ie.jsx)(A.A,{onClick:()=>{ct&&we("/chat/room/".concat(ct.id)),dt(!1)},variant:"contained",color:"primary",children:"Join Chat Room"})]})]}),Fe&&(0,Ie.jsx)(We,{contentId:Fe.id,contentType:"sideRoom",onClose:()=>{bt(!1)},open:ft,ownerUsername:null===Lt||void 0===Lt?void 0:Lt.username}),(0,Ie.jsx)(He,{open:Me,onClose:()=>{Le(!1)},roomName:null===Fe||void 0===Fe?void 0:Fe.name,roomLink:bn,onSend:async(e,o)=>{if(null!==je&&void 0!==je&&je.uid&&l.db)try{const t=(0,d.H9)(l.db,"rooms",e);if((await(0,d.x7)(t)).exists()){const r=(0,d.rJ)(l.db,"rooms",e,"messages");return void await(0,d.gS)(r,{text:o,sender:je.uid,senderName:je.displayName||"Unknown User",senderPhoto:je.photoURL,timestamp:(0,d.O5)(),type:"chat"})}const n=(0,d.rJ)(l.db,"conversations"),i=(0,d.P)(n,(0,d._M)("participants","array-contains",je.uid)),a=await(0,d.GG)(i);let s=null;if(a.docs.forEach((o=>{o.data().participants.includes(e)&&(s=o.id)})),!s){var r;const o=(0,d.H9)(l.db,"users",e),t=await(0,d.x7)(o);if(!t.exists())throw new Error("Recipient user not found");const n=(null===(r=t.data().following)||void 0===r?void 0:r.includes(je.uid))||!1,i=(0,d.H9)((0,d.rJ)(l.db,"conversations"));await(0,d.BN)(i,{participants:[je.uid,e],createdAt:(0,d.O5)(),lastUpdated:(0,d.O5)(),unreadCount:{[je.uid]:0,[e]:1},status:n?"accepted":"pending"}),s=i.id}const c=(0,d.rJ)(l.db,"conversations",s,"messages");await(0,d.gS)(c,{text:o,sender:je.uid,timestamp:(0,d.O5)(),read:!1,reactions:[]});const u=(0,d.H9)(l.db,"conversations",s);await(0,d.mZ)(u,{lastMessage:{text:o,sender:je.uid,timestamp:(0,d.O5)()},lastUpdated:(0,d.O5)(),["unreadCount.".concat(e)]:(0,d.GV)(1)})}catch(Xe){throw console.error("Error sending message:",Xe),Xe}else c.oR.error("Cannot send message: User not authenticated.")},currentUserId:null===je||void 0===je?void 0:je.uid}),(0,Ie.jsxs)(k.A,{open:yt,onClose:()=>At(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Ie.jsx)(I.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsx)(p.A,{variant:"h6",children:"Banned Users"}),(0,Ie.jsx)(x.A,{onClick:()=>At(!1),children:(0,Ie.jsx)(Ae.A,{})})]})}),(0,Ie.jsx)(R.A,{children:0===Ct.length?(0,Ie.jsx)(u.A,{sx:{textAlign:"center",py:3},children:(0,Ie.jsx)(p.A,{variant:"body1",color:"text.secondary",children:"No users are currently banned from this room"})}):(0,Ie.jsx)(D.A,{children:Ct.map((e=>(0,Ie.jsxs)(T.Ay,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1},secondaryAction:(0,Ie.jsx)(A.A,{variant:"outlined",color:"success",size:"small",onClick:()=>Bt(e.id,e.username),children:"Unban"}),children:[(0,Ie.jsx)(L.A,{children:(0,Ie.jsx)(v.A,{src:e.profilePic,alt:e.username,children:e.username.charAt(0).toUpperCase()})}),(0,Ie.jsx)(G.A,{primary:e.name||e.username,secondary:"@".concat(e.username)})]},e.id)))})})]}),(0,Ie.jsxs)(k.A,{open:$r,onClose:()=>et(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Ie.jsx)(I.A,{children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsx)(p.A,{variant:"h6",children:"Camera Requests"}),(0,Ie.jsx)(x.A,{onClick:()=>et(!1),children:(0,Ie.jsx)(Ae.A,{})})]})}),(0,Ie.jsx)(R.A,{children:0===Kr.length?(0,Ie.jsx)(u.A,{sx:{textAlign:"center",py:3},children:(0,Ie.jsx)(p.A,{variant:"body1",color:"text.secondary",children:"No pending camera requests"})}):(0,Ie.jsx)(D.A,{children:Kr.map((e=>(0,Ie.jsxs)(T.Ay,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1},children:[(0,Ie.jsx)(L.A,{children:(0,Ie.jsx)(v.A,{src:e.avatar,alt:e.username,children:e.username.charAt(0).toUpperCase()})}),(0,Ie.jsx)(G.A,{primary:e.username,secondary:"Requested ".concat(new Date(e.timestamp).toLocaleTimeString())}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:1},children:[(0,Ie.jsx)(A.A,{variant:"contained",color:"success",size:"small",onClick:()=>Ft(e.userId,e.username,!0),startIcon:(0,Ie.jsx)(oe.A,{}),children:"Approve"}),(0,Ie.jsx)(A.A,{variant:"outlined",color:"error",size:"small",onClick:()=>Ft(e.userId,e.username,!1),startIcon:(0,Ie.jsx)(re.A,{}),children:"Deny"})]})]},e.userId)))})})]}),(0,Ie.jsxs)(k.A,{open:jt,onClose:Sn,"aria-labelledby":"owner-not-live-dialog-title",maxWidth:"sm",fullWidth:!0,disableEscapeKeyDown:!0,sx:{"& .MuiDialog-paper":{borderRadius:2,boxShadow:ke.shadows[10]}},children:[(0,Ie.jsx)(I.A,{id:"owner-not-live-dialog-title",sx:{textAlign:"center",pb:1},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,Ie.jsx)(u.A,{sx:{fontSize:"3rem",color:ke.palette.warning.main},children:"\ud83d\udd34"}),(0,Ie.jsx)(p.A,{variant:"h6",component:"div",sx:{fontWeight:600},children:"Owner Not Live"})]})}),(0,Ie.jsxs)(R.A,{sx:{textAlign:"center",py:3},children:[(0,Ie.jsxs)(p.A,{variant:"body1",sx:{mb:2,fontSize:"1.1rem"},children:["The room owner ",(0,Ie.jsx)("strong",{children:(null===Lt||void 0===Lt?void 0:Lt.username)||"Unknown"})," is currently not in the room."]}),(0,Ie.jsx)(p.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Please come back when they are live to enjoy the full room experience!"}),(0,Ie.jsx)(u.A,{sx:{backgroundColor:(0,V.X4)(ke.palette.info.main,.1),border:"1px solid ".concat((0,V.X4)(ke.palette.info.main,.3)),borderRadius:1,p:2,mt:2},children:(0,Ie.jsx)(p.A,{variant:"body2",color:"info.main",children:'\ud83d\udca1 Tip: You can check the "Discover" page to find rooms with active hosts!'})})]}),(0,Ie.jsx)(P.A,{sx:{justifyContent:"center",pb:3},children:(0,Ie.jsx)(A.A,{onClick:Sn,variant:"contained",size:"large",sx:{minWidth:120,borderRadius:2,textTransform:"none",fontSize:"1rem"},children:"Okay"})})]})]})]})},Do=e=>{var o,r,i,a,m,f,b,y,w,k,I,R,P,F,D,T,O,N,z,M,W,H,L,G,_,Y,q,J,Z,K,Q,ee,te,ne,ie,ae,se,de,he,xe,pe,ve,ge,fe,be,ye,Se,ke,Re,Ee,Ue,De,Te,Oe;let{room:Ne,isRoomOwner:ze,isGuest:Me,handleOpenShareVideoDialog:We,handleClearSharedVideo:He,currentVideoUrl:Le,renderVideoPlayer:Ge,onForceMuteToggle:Be,onForceRemove:Xe,onForceBan:Ve,theme:_e,navigate:Ye,requestCameraPermission:qe,hasPendingCameraRequest:Je,toggleCameraCallback:Ze,shouldShowUserVideo:Ke,approvedCameraUsers:Qe}=e;(0,n.useRef)(null);const $e=(0,Fe.Gc)(),{useParticipants:eo,useCallState:oo,useMicrophoneState:ro,useCameraState:to}=(0,Fe.R3)(),no=eo(),{localParticipant:io}=oo(),{isMute:ao}=ro(),{isEnabled:so,isTogglePending:lo}=to();(0,n.useEffect)((()=>{$e&&$e.camera.disable().catch((e=>{console.error("Error disabling camera:",e)}))}),[$e]);const{currentUser:co}=(0,s.As)(),[uo,mo]=(0,n.useState)(window.innerWidth>1024),[ho,xo]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!Ne||!co||co.uid===Ne.ownerId)return;if(!no)return;console.log("[Stream Owner Live Check] Checking if room owner is in Stream call:",{roomOwnerId:Ne.ownerId,currentUserId:co.uid,streamParticipants:no.map((e=>({userId:e.userId,name:e.name}))),participantCount:no.length,hasTriggeredBefore:ho});const e=no.some((e=>e.userId===Ne.ownerId));if(console.log("[Stream Owner Live Check] Immediate check result:",{ownerInStreamCall:e,roomOwnerId:Ne.ownerId,hasParticipants:no.length>0}),e&&ho)return console.log("[Stream Owner Live Check] Owner joined the call! Resetting trigger flag."),void xo(!1);if(!e&&no.length>0&&!ho){if(no.length>1)return console.log("[Stream Owner Live Check] Multiple participants found, showing dialog IMMEDIATELY"),xo(!0),void window.dispatchEvent(new CustomEvent("showOwnerNotLiveDialog"));console.log("[Stream Owner Live Check] Only 1 participant, starting minimal grace period...");const e=setTimeout((()=>{const e=no||[],o=!e.some((e=>e.userId===Ne.ownerId));console.log("[Stream Owner Live Check] Final check after minimal delay:",{ownerStillNotInCall:o,currentParticipantsCount:e.length,participantIds:e.map((e=>e.userId))}),o&&!ho&&(console.log("[Stream Owner Live Check] Owner confirmed not in Stream call, showing dialog NOW"),xo(!0),window.dispatchEvent(new CustomEvent("showOwnerNotLiveDialog")))}),500);return()=>clearTimeout(e)}e?console.log("[Stream Owner Live Check] Owner IS in Stream call - they are live! No dialog needed."):ho?console.log("[Stream Owner Live Check] Dialog already triggered, not checking again."):console.log("[Stream Owner Live Check] No participants yet, waiting for data...")}),[Ne,co,no,ho]);const[vo,go]=(0,n.useState)(!0),[fo,bo]=(0,n.useState)(!1),[yo,Ao]=(0,n.useState)([]),[Co,jo]=(0,n.useState)([]),[So,Io]=(0,n.useState)("participants"),[Ro,Eo]=(0,n.useState)([]),[Po,Fo]=(0,n.useState)(""),Uo=(0,n.useRef)(null),[Do,Oo]=(0,n.useState)({}),No=no.find((e=>e.screenShareStream)),zo=(0,n.useCallback)((async e=>{if(Do[e])return Do[e];try{const o=(0,d.H9)(l.db,"users",e),r=await(0,d.x7)(o);if(r.exists()){const o=r.data(),n={username:o.username||"user_".concat(e.substring(0,4)),avatar:o.profilePic};return Oo((o=>(0,t.A)((0,t.A)({},o),{},{[e]:n}))),n}{console.warn("[Chat] No Firestore profile found for user ".concat(e));const o={username:"user_".concat(e.substring(0,4)),avatar:void 0};return Oo((r=>(0,t.A)((0,t.A)({},r),{},{[e]:o}))),o}}catch(o){return console.error("[Chat] Error fetching user data for ".concat(e,":"),o),{username:"user_".concat(e.substring(0,4)),avatar:void 0}}}),[Do,l.db]),Mo=(0,n.useCallback)((async()=>{if(!Po.trim()||null===co||void 0===co||!co.uid||null===Ne||void 0===Ne||!Ne.id||!l.db)return;const e=await zo(co.uid),o={id:"".concat(Date.now(),"-").concat(co.uid),userId:co.uid,userName:e.username,message:Po.trim(),timestamp:Date.now()};try{const e=(0,d.rJ)(l.db,"sideRooms",Ne.id,"chatMessages");await(0,d.gS)(e,o),console.log("[Chat] Message sent to Firestore")}catch(r){console.error("[Chat] Error sending message to Firestore:",r),Eo((e=>[...e,o]))}Fo("")}),[Po,null===co||void 0===co?void 0:co.uid,null===Ne||void 0===Ne?void 0:Ne.id,l.db,zo]);(0,n.useEffect)((()=>{if(null===Ne||void 0===Ne||!Ne.id||!l.db)return;console.log("[Chat] Setting up chat listener for room ".concat(Ne.id));const e=(0,d.P)((0,d.rJ)(l.db,"sideRooms",Ne.id,"chatMessages"),(0,d.My)("timestamp","asc")),o=(0,d.aQ)(e,(e=>{const o=[];e.forEach((e=>{const r=e.data();o.push({id:e.id,userId:r.userId,userName:r.userName,message:r.message,timestamp:r.timestamp})})),console.log("[Chat] Received ".concat(o.length," messages from Firestore")),Eo(o),Uo.current&&Uo.current.scrollIntoView({behavior:"smooth"})}),(e=>{console.error("[Chat] Error listening to chat messages:",e)}));return()=>{console.log("[Chat] Cleaning up chat listener"),o()}}),[null===Ne||void 0===Ne?void 0:Ne.id,l.db]);(0,n.useCallback)((async()=>{if($e)if(uo)try{console.log("Current screen share state:",$e.screenShare.enabled),$e.screenShare.enabled?(await $e.screenShare.disable(),console.log("Screen share disabled successfully"),c.oR.success("Screen sharing stopped.")):(c.oR.loading("Starting screen share..."),await $e.screenShare.enable(),console.log("Screen share enabled successfully"),c.oR.dismiss(),c.oR.success("Screen sharing started! Everyone should see your screen now."))}catch(r){var e,o;c.oR.dismiss(),console.error("Screen share error:",r),"NotAllowedError"===r.name||null!==(e=r.message)&&void 0!==e&&e.includes("Permission denied")?c.oR.error("Screen share permission denied. Please allow access when prompted by your browser."):null!==(o=r.message)&&void 0!==o&&o.includes("getDisplayMedia is not supported")?c.oR.error("Screen sharing is not supported by your browser."):c.oR.error("Failed to toggle screen sharing: ".concat(r.message||"Unknown error"))}else c.oR.error("Screen sharing is only available on desktop devices.");else c.oR.error("Audio/video call not active to share screen.")}),[$e,uo]);(0,n.useEffect)((()=>{const e=()=>{mo(window.innerWidth>1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const Wo=e=>{jo((o=>o.includes(e)?o.filter((o=>o!==e)):[...o,e]))};(0,n.useEffect)((()=>{var e;null===(e=Uo.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[Ro]);const Ho=(0,n.useMemo)((()=>{if(!no||null===Ne||void 0===Ne||!Ne.ownerId)return[];const e=no.find((e=>e.userId===Ne.ownerId));return[...e?[e]:[],...no.filter((e=>Co.includes(e.userId)&&e.userId!==Ne.ownerId)),...no.filter((e=>e.userId!==Ne.ownerId&&!Co.includes(e.userId)))].filter(Boolean)}),[no,null===Ne||void 0===Ne?void 0:Ne.ownerId,Co]);(0,n.useEffect)((()=>{no&&0!==no.length&&(console.log("[InsideStreamCallContent] Fetching Firestore data for participants:",no.map((e=>e.userId))),no.forEach((e=>{e.userId&&!Do[e.userId]&&zo(e.userId)})))}),[no,zo,Do]),(0,n.useEffect)((()=>{so&&go(!0)}),[so]);const Lo=Ho;return $e?(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",fontFamily:(null===Ne||void 0===Ne||null===(o=Ne.style)||void 0===o?void 0:o.font)||"inherit",backgroundColor:null!==Ne&&void 0!==Ne&&null!==(r=Ne.style)&&void 0!==r&&r.backgroundGradient?"linear-gradient(to bottom right, ".concat((null===Ne||void 0===Ne||null===(i=Ne.style)||void 0===i?void 0:i.backgroundColor)||_e.palette.background.default,", ").concat((null===Ne||void 0===Ne||null===(a=Ne.style)||void 0===a?void 0:a.accentColor)||_e.palette.secondary.main,")"):(null===Ne||void 0===Ne||null===(m=Ne.style)||void 0===m?void 0:m.backgroundColor)||_e.palette.background.default,color:(null===Ne||void 0===Ne||null===(f=Ne.style)||void 0===f?void 0:f.textColor)||_e.palette.text.primary,willChange:"transform",position:"relative",zIndex:1,animation:"none !important",transition:"none !important",transform:"translateZ(0)"},children:[null,(0,Ie.jsxs)(u.A,{sx:{flexGrow:1,p:2},children:[(0,Ie.jsx)(ko,{isHostLive:no.some((e=>e.userId===Ne.ownerId)),roomStyle:null===Ne||void 0===Ne?void 0:Ne.style,hostName:(null===(b=no.find((e=>e.userId===Ne.ownerId)))||void 0===b?void 0:b.name)||"Host",isCurrentUserHost:ze,onStopLive:()=>{$e?(console.log("[TimeFrame] Host stopping live session..."),$e.leave().then((()=>{console.log("[TimeFrame] Successfully ended live session"),Ye("/side-rooms")})).catch((e=>{console.error("[TimeFrame] Error ending live session:",e),Ye("/side-rooms")}))):Ye("/side-rooms")}}),No&&(0,Ie.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[(0,Ie.jsxs)(p.A,{variant:"h6",align:"center",sx:{mt:2,mb:2,fontWeight:700,color:(null===Ne||void 0===Ne||null===(y=Ne.style)||void 0===y?void 0:y.accentColor)||_e.palette.primary.main},children:["\ud83d\udda5\ufe0f ",No.name||"Someone"," is sharing their screen"]}),(0,Ie.jsx)(u.A,{sx:{width:"100%",maxWidth:"1200px",position:"relative",paddingTop:"56.25%",backgroundColor:"#000",borderRadius:2,overflow:"hidden",border:"2px solid ".concat((null===Ne||void 0===Ne||null===(w=Ne.style)||void 0===w?void 0:w.accentColor)||_e.palette.primary.main),"& .str-video__participant-view":{position:"absolute",top:0,left:0,width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"contain"}}},children:(0,Ie.jsx)(Pe.fSl,{participant:No,trackType:"screenShareTrack"})})]}),!No&&(0,Ie.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ie.jsx)(p.A,{variant:"h6",align:"center",sx:{mt:2,mb:1,fontWeight:500,color:(null===Ne||void 0===Ne||null===(k=Ne.style)||void 0===k?void 0:k.accentColor)||_e.palette.primary.main},children:"Live Video"}),(e=>{const o=no.filter((e=>e.userId!==(null===co||void 0===co?void 0:co.uid))),r=o.length>0;var t;if(ze&&so&&!r)return(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:_e.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",width:{xs:"95%",sm:"80%",md:"70%"},maxWidth:"1080px",aspectRatio:"16/9",overflow:"hidden",boxShadow:"0 15px 30px rgba(0,0,0,0.5)",mb:2,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[io&&(0,Ie.jsx)(Pe.fSl,{participant:io,trackType:"videoTrack"}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"60px 24px 24px 24px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{sx:{width:50,height:50,mr:2},children:(null===co||void 0===co||null===(t=co.displayName)||void 0===t?void 0:t[0])||"H"}),(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsxs)(p.A,{variant:"h6",fontWeight:"bold",children:[(null===co||void 0===co?void 0:co.displayName)||"Host"," (Host)"]}),(0,Ie.jsx)(p.A,{variant:"body2",children:(null===Ne||void 0===Ne?void 0:Ne.name)||"Live Room"})]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:2},children:[(0,Ie.jsx)(h.A,{title:ao?"Unmute":"Mute",children:(0,Ie.jsx)(x.A,{onClick:()=>null===$e||void 0===$e?void 0:$e.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:56,height:56,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:ao?(0,Ie.jsx)(me.A,{fontSize:"large"}):(0,Ie.jsx)(ce.A,{fontSize:"large"})})}),(0,Ie.jsx)(h.A,{title:"Turn Camera Off",children:(0,Ie.jsx)(x.A,{onClick:Ze,sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:56,height:56,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ie.jsx)(re.A,{fontSize:"large"})})})]})]})})]});const n=o.filter((e=>Ke(e.userId))),i=so,a=o.filter((e=>{const o=Ke(e.userId),r=Qe.has(e.userId),t=e.userId===Ne.ownerId;return console.log("[Video Layout] User ".concat(e.userId,": hasPermissionViaFunction=").concat(o,", hasPermissionViaFirestore=").concat(r,", isRoomOwner=").concat(t)),o||r||t}));console.log("[Video Layout] Current user has camera: ".concat(i,", Other users with permission: ").concat(a.length,", Approved camera users: ").concat(Array.from(Qe)));const s=Qe.size>0;var l,d;if(i&&(a.length>0||s))return(0,Ie.jsxs)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"flex-start",gap:2,flexWrap:{xs:"wrap",sm:"nowrap"},mb:2},children:[i&&(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:ze?_e.palette.primary.main:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",width:{xs:"95%",sm:"45%"},aspectRatio:"16/9",overflow:"hidden",boxShadow:"0 15px 30px rgba(0,0,0,0.5)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[io&&(0,Ie.jsx)(Pe.fSl,{participant:io,trackType:"videoTrack"}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{sx:{width:32,height:32,mr:1},children:(null===co||void 0===co||null===(l=co.displayName)||void 0===l?void 0:l[0])||"U"}),(0,Ie.jsx)(u.A,{children:(0,Ie.jsxs)(p.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===co||void 0===co?void 0:co.displayName)||"You"," ",ze&&"(Host)"]})})]})})]}),(a.length>0||s)&&((e,r,t)=>{const i=n[0]||a[0]||o.find((e=>Qe.has(e.userId)));if(!i)return null;const s=n.some((e=>e.userId===i.userId));return(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:i.userId===Ne.ownerId?_e.palette.primary.main:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",width:{xs:"95%",sm:"45%"},aspectRatio:"16/9",overflow:"hidden",boxShadow:"0 15px 30px rgba(0,0,0,0.5)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[s?(0,Ie.jsx)(Pe.fSl,{participant:i,trackType:"videoTrack"}):(0,Ie.jsx)(u.A,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#1a1a1a"},children:(0,Ie.jsxs)(u.A,{sx:{textAlign:"center",color:"white"},children:[(0,Ie.jsx)(v.A,{src:null===(e=Do[i.userId])||void 0===e?void 0:e.avatar,sx:{width:80,height:80,mx:"auto",mb:2},children:(null===i||void 0===i||null===(r=i.name)||void 0===r?void 0:r[0])||"U"}),(0,Ie.jsx)(p.A,{variant:"body2",children:"Camera permission granted"}),(0,Ie.jsx)(p.A,{variant:"caption",sx:{opacity:.7},children:"Waiting for camera to turn on..."})]})}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"40px 16px 16px 16px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{src:null===(t=Do[i.userId])||void 0===t?void 0:t.avatar,sx:{width:32,height:32,mr:1}}),(0,Ie.jsx)(u.A,{children:(0,Ie.jsxs)(p.A,{variant:"subtitle2",fontWeight:"bold",children:[(null===i||void 0===i?void 0:i.name)||"User",i.userId===Ne.ownerId&&" (Host)"]})})]})})]})})()]});if(ze&&i&&0===a.length&&!s)return(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:_e.palette.primary.main,borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",width:{xs:"95%",sm:"80%",md:"70%"},maxWidth:"1080px",aspectRatio:"16/9",overflow:"hidden",boxShadow:"0 15px 30px rgba(0,0,0,0.5)",mb:2,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[io&&(0,Ie.jsx)(Pe.fSl,{participant:io,trackType:"videoTrack"}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"60px 24px 24px 24px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{sx:{width:50,height:50,mr:2},children:(null===co||void 0===co||null===(d=co.displayName)||void 0===d?void 0:d[0])||"H"}),(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsxs)(p.A,{variant:"h6",fontWeight:"bold",children:[(null===co||void 0===co?void 0:co.displayName)||"Host"," (Host)"]}),(0,Ie.jsx)(p.A,{variant:"body2",children:(null===Ne||void 0===Ne?void 0:Ne.name)||"Live Room"})]})]}),(0,Ie.jsxs)(u.A,{sx:{display:"flex",gap:2},children:[(0,Ie.jsx)(h.A,{title:ao?"Unmute":"Mute",children:(0,Ie.jsx)(x.A,{onClick:()=>null===$e||void 0===$e?void 0:$e.microphone.toggle(),sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:56,height:56,"&:hover":{backgroundColor:"rgba(0,0,0,0.8)"}},children:ao?(0,Ie.jsx)(me.A,{fontSize:"large"}):(0,Ie.jsx)(ce.A,{fontSize:"large"})})}),(0,Ie.jsx)(h.A,{title:"Turn Camera Off",children:(0,Ie.jsx)(x.A,{onClick:Ze,sx:{backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:56,height:56,"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ie.jsx)(re.A,{fontSize:"large"})})})]})]})})]});if(!ze&&a.length>0&&!i){var c,m,g;const e=n.find((e=>e.userId===Ne.ownerId))||a.find((e=>e.userId===Ne.ownerId))||n[0]||a[0],o=n.some((o=>o.userId===e.userId));return(0,Ie.jsxs)(u.A,{sx:{border:"3px solid",borderColor:e.userId===Ne.ownerId?_e.palette.primary.main:"divider",borderRadius:"16px",backgroundColor:"#000",position:"relative",display:"flex",flexDirection:"column",width:{xs:"95%",sm:"80%",md:"70%"},maxWidth:"1080px",aspectRatio:"16/9",overflow:"hidden",boxShadow:"0 15px 30px rgba(0,0,0,0.5)",mb:2,"& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover",background:"#000"}}},children:[o?(0,Ie.jsx)(Pe.fSl,{participant:e,trackType:"videoTrack"}):(0,Ie.jsx)(u.A,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#1a1a1a"},children:(0,Ie.jsxs)(u.A,{sx:{textAlign:"center",color:"white"},children:[(0,Ie.jsx)(v.A,{src:null===(c=Do[e.userId])||void 0===c?void 0:c.avatar,sx:{width:120,height:120,mx:"auto",mb:3},children:(null===e||void 0===e||null===(m=e.name)||void 0===m?void 0:m[0])||"U"}),(0,Ie.jsx)(p.A,{variant:"h6",sx:{mb:1},children:"Camera permission granted"}),(0,Ie.jsx)(p.A,{variant:"body2",sx:{opacity:.7},children:"Waiting for camera to turn on..."})]})}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"60px 24px 24px 24px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white",zIndex:2},children:(0,Ie.jsxs)(u.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Ie.jsx)(v.A,{src:null===(g=Do[e.userId])||void 0===g?void 0:g.avatar,sx:{width:50,height:50,mr:2}}),(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsxs)(p.A,{variant:"h6",fontWeight:"bold",children:[(null===e||void 0===e?void 0:e.name)||"User",e.userId===Ne.ownerId&&" (Host)"]}),(0,Ie.jsx)(p.A,{variant:"body2",children:(null===Ne||void 0===Ne?void 0:Ne.name)||"Live Room"})]})]})})]})}return(0,Ie.jsx)(u.A,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",mb:2},children:(0,Ie.jsx)(p.A,{variant:"h6",align:"center",sx:{color:(null===Ne||void 0===Ne||null===(e=Ne.style)||void 0===e?void 0:e.textColor)||_e.palette.text.primary,mb:2},children:ze?"Turn on your camera to go live!":"Waiting for host to enable camera..."})})})(),no&&no.filter((e=>e.userId!==(null===co||void 0===co?void 0:co.uid)&&Ke(e.userId))).length>1&&(0,Ie.jsx)(u.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:1.5,mt:2,width:"100%",maxWidth:"800px",px:2},children:no.filter((e=>e.userId!==(null===co||void 0===co?void 0:co.uid))).filter((e=>Ke(e.userId))).slice(1).filter((e=>!yo.includes(e.userId))).map((e=>(0,Ie.jsxs)(u.A,{sx:{aspectRatio:"3/4",borderRadius:"12px",overflow:"hidden",position:"relative",border:"2px solid",borderColor:e.userId===Ne.ownerId?_e.palette.primary.main:"divider",backgroundColor:"#000",boxShadow:"0 4px 12px rgba(0,0,0,0.3)","& .str-video__participant-view":{width:"100%",height:"100%","& video":{width:"100%",height:"100%",objectFit:"cover"}}},children:[(0,Ie.jsx)(Pe.fSl,{participant:e,trackType:"videoTrack"}),(0,Ie.jsx)(x.A,{onClick:()=>{const o=[...yo||[]];o.push(e.userId),Ao(o),c.oR.success("Video hidden")},sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0,0,0,0.6)",color:"white",width:24,height:24,zIndex:10,"& .MuiSvgIcon-root":{fontSize:"16px"},"&:hover":{backgroundColor:"rgba(255,0,0,0.8)"}},children:(0,Ie.jsx)(Ae.A,{})}),(0,Ie.jsx)(u.A,{sx:{position:"absolute",bottom:0,left:0,right:0,padding:"8px 6px 4px 6px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",color:"white"},children:(0,Ie.jsxs)(p.A,{variant:"caption",sx:{fontSize:"11px",fontWeight:"bold",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:[e.name||"User ".concat(e.userId.substring(0,5)),e.userId===Ne.ownerId&&" (Host)"]})})]},e.userId)))})]}),Le&&(0,Ie.jsxs)(u.A,{sx:{mt:1,mb:3,p:1,border:"1px solid",borderColor:"divider",borderRadius:1,backgroundColor:"action.hover"},children:[(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,Ie.jsx)(p.A,{variant:"subtitle1",sx:{textAlign:"center",flexGrow:1,fontFamily:(null===Ne||void 0===Ne||null===(I=Ne.style)||void 0===I?void 0:I.font)||"inherit",color:(null===Ne||void 0===Ne||null===(R=Ne.style)||void 0===R?void 0:R.textColor)||"inherit"},children:"Shared Video"}),ze&&(0,Ie.jsx)(h.A,{title:"Clear Shared Video",children:(0,Ie.jsx)(x.A,{onClick:()=>He(),size:"small",sx:{color:(null===Ne||void 0===Ne||null===(P=Ne.style)||void 0===P?void 0:P.accentColor)||"inherit"},children:(0,Ie.jsx)(ue.A,{})})})]}),(0,Ie.jsx)(u.A,{sx:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",maxWidth:"100%",background:"#000","& iframe":{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0}},children:Ge(Le)})]}),(0,Ie.jsx)(u.A,{sx:{mb:2,borderBottom:1,borderColor:"divider",overflow:"hidden"},children:(0,Ie.jsx)(u.A,{sx:{maxWidth:"100%",display:"flex",overflowX:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},WebkitOverflowScrolling:"touch"},children:(0,Ie.jsxs)(B.A,{value:So,onChange:(e,o)=>Io(o),"aria-label":"room content tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root":{fontFamily:(null===Ne||void 0===Ne||null===(F=Ne.style)||void 0===F?void 0:F.font)||"inherit",color:(null===Ne||void 0===Ne||null===(D=Ne.style)||void 0===D?void 0:D.textColor)||"inherit",opacity:.7,minWidth:"auto",padding:{xs:"6px 8px",sm:"12px 16px"},fontSize:{xs:"0.75rem",sm:"0.875rem"}},"& .Mui-selected":{color:"".concat((null===Ne||void 0===Ne||null===(T=Ne.style)||void 0===T?void 0:T.accentColor)||_e.palette.primary.main," !important"),opacity:1},"& .MuiTabs-indicator":{backgroundColor:(null===Ne||void 0===Ne||null===(O=Ne.style)||void 0===O?void 0:O.accentColor)||_e.palette.primary.main},"& .MuiTabs-scrollButtons":{"&.Mui-disabled":{opacity:.3},"&":{color:(null===Ne||void 0===Ne||null===(N=Ne.style)||void 0===N?void 0:N.textColor)||"inherit"}}},children:[(0,Ie.jsx)(X.A,{label:"Participants (".concat(Lo.length,")"),value:"participants",sx:{flexShrink:0}}),(0,Ie.jsx)(X.A,{label:"Chat",value:"chat",sx:{flexShrink:0},icon:(0,Ie.jsx)(g.A,{color:"primary",variant:"dot",invisible:"chat"===So||0===Ro.length,sx:{"& .MuiBadge-badge":{backgroundColor:(null===Ne||void 0===Ne||null===(z=Ne.style)||void 0===z?void 0:z.accentColor)||_e.palette.primary.main}}}),iconPosition:"end"}),(0,Ie.jsx)(X.A,{label:"Gifts",value:"gifts",sx:{flexShrink:0},icon:(0,Ie.jsx)(Ce.A,{fontSize:"small"}),iconPosition:"end"}),(0,Ie.jsx)(X.A,{label:"Top Gifters",value:"topGifters",sx:{flexShrink:0},icon:(0,Ie.jsx)(we.A,{fontSize:"small"}),iconPosition:"end"})]})})}),"participants"===So&&(0,Ie.jsxs)(Ie.Fragment,{children:[Lo.length>0&&(0,Ie.jsx)(Pe.ncL,{participants:Lo}),(0,Ie.jsx)(j.Ay,{container:!0,spacing:2,sx:{willChange:"contents",transform:"translateZ(0)"},children:Lo.map((e=>{const o=e.userId===Ne.ownerId;return(0,Ie.jsx)(j.Ay,{item:!0,xs:4,sm:3,md:2,sx:{transition:"none !important"},children:(0,Ie.jsx)(To,{participant:e,isRoomOwner:ze,isLocalParticipant:e.userId===(null===co||void 0===co?void 0:co.uid),localUserAuthData:co,onForceMuteToggle:Be,onForceRemove:Xe,onForceBan:Ve,call:$e,localUserIsMute:ao,isDesignatedHost:o,onPinToggle:Wo,isPinned:Co.includes(e.userId),roomStyle:null===Ne||void 0===Ne?void 0:Ne.style,navigate:Ye,firestoreUserData:Do})},e.userId)}))}),0===Lo.length&&(0,Ie.jsx)(p.A,{sx:{width:"100%",textAlign:"center",color:null!==Ne&&void 0!==Ne&&null!==(M=Ne.style)&&void 0!==M&&M.textColor?(0,V.X4)(null===Ne||void 0===Ne||null===(W=Ne.style)||void 0===W?void 0:W.textColor,.7):_e.palette.text.secondary,mt:4,fontFamily:(null===Ne||void 0===Ne||null===(H=Ne.style)||void 0===H?void 0:H.font)||"inherit"},children:"Waiting for others to join..."})]}),"chat"===So&&(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",height:400,maxHeight:"50vh",border:"1px solid ".concat(null!==Ne&&void 0!==Ne&&null!==(L=Ne.style)&&void 0!==L&&L.accentColor?(0,V.X4)(null===Ne||void 0===Ne||null===(G=Ne.style)||void 0===G?void 0:G.accentColor,.3):_e.palette.divider),borderRadius:1,overflow:"hidden"},children:[(0,Ie.jsxs)(u.A,{sx:{p:1.5,borderBottom:"1px solid ".concat(null!==Ne&&void 0!==Ne&&null!==(_=Ne.style)&&void 0!==_&&_.accentColor?(0,V.X4)(null===Ne||void 0===Ne||null===(Y=Ne.style)||void 0===Y?void 0:Y.accentColor,.3):_e.palette.divider),bgcolor:null!==Ne&&void 0!==Ne&&null!==(q=Ne.style)&&void 0!==q&&q.headerColor?(0,V.X4)(null===Ne||void 0===Ne||null===(J=Ne.style)||void 0===J?void 0:J.headerColor,.1):(0,V.X4)(_e.palette.background.paper,.7),display:"flex",flexDirection:"column",gap:.5},children:[(0,Ie.jsxs)(p.A,{variant:"subtitle2",fontWeight:"medium",sx:{fontFamily:(null===Ne||void 0===Ne||null===(Z=Ne.style)||void 0===Z?void 0:Z.font)||"inherit",color:(null===Ne||void 0===Ne||null===(K=Ne.style)||void 0===K?void 0:K.textColor)||"inherit"},children:["Users in Room (",Lo.length,")"]}),(0,Ie.jsx)(u.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Lo.map((e=>{var o,r,t,n,i,a;const s=Do[e.userId],l=(null===s||void 0===s?void 0:s.username)||e.name||e.userId.substring(0,8),d=(null===s||void 0===s?void 0:s.avatar)||e.image;return(0,Ie.jsx)(U.A,{size:"small",label:l,avatar:(0,Ie.jsx)(v.A,{src:d,alt:l,sx:{width:24,height:24}}),sx:{backgroundColor:e.userId===Ne.ownerId?(0,V.X4)((null===Ne||void 0===Ne||null===(o=Ne.style)||void 0===o?void 0:o.accentColor)||_e.palette.secondary.main,.1):(0,V.X4)((null===Ne||void 0===Ne||null===(r=Ne.style)||void 0===r?void 0:r.headerColor)||_e.palette.primary.main,.05),borderColor:e.userId===Ne.ownerId?(null===Ne||void 0===Ne||null===(t=Ne.style)||void 0===t?void 0:t.accentColor)||_e.palette.secondary.main:(null===Ne||void 0===Ne||null===(n=Ne.style)||void 0===n?void 0:n.headerColor)||_e.palette.primary.main,border:"1px solid",color:(null===Ne||void 0===Ne||null===(i=Ne.style)||void 0===i?void 0:i.textColor)||"inherit",fontFamily:(null===Ne||void 0===Ne||null===(a=Ne.style)||void 0===a?void 0:a.font)||"inherit","& .MuiChip-label":{px:1,fontSize:"0.7rem"}}},e.userId)}))})]}),(0,Ie.jsx)(u.A,{sx:{flexGrow:1,overflowY:"auto",p:2,bgcolor:null!==Ne&&void 0!==Ne&&null!==(Q=Ne.style)&&void 0!==Q&&Q.backgroundGradient?(0,V.X4)((null===Ne||void 0===Ne||null===(ee=Ne.style)||void 0===ee?void 0:ee.backgroundColor)||_e.palette.background.default,.3):(0,V.X4)(_e.palette.background.paper,.5)},children:0===Ro.length?(0,Ie.jsx)(p.A,{variant:"body2",color:null!==Ne&&void 0!==Ne&&null!==(te=Ne.style)&&void 0!==te&&te.textColor?(0,V.X4)(null===Ne||void 0===Ne||null===(ne=Ne.style)||void 0===ne?void 0:ne.textColor,.7):"text.secondary",sx:{textAlign:"center",fontStyle:"italic",mt:4,fontFamily:(null===Ne||void 0===Ne||null===(ie=Ne.style)||void 0===ie?void 0:ie.font)||"inherit"},children:"Chat messages will appear here. Be the first to send a message!"}):(0,Ie.jsxs)(Ie.Fragment,{children:[Ro.map((e=>{var o,r,t,n,i,a,s,l,d,c,m;return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:e.userId===(null===co||void 0===co?void 0:co.uid)?"row-reverse":"row",mb:1.5},children:[e.userId!==(null===co||void 0===co?void 0:co.uid)&&(0,Ie.jsx)(v.A,{sx:{width:28,height:28,mr:1,fontSize:"0.8rem"},src:null===(o=Do[e.userId])||void 0===o?void 0:o.avatar,children:e.userName.charAt(0).toUpperCase()}),(0,Ie.jsxs)(u.A,{children:[(0,Ie.jsx)(p.A,{variant:"caption",color:null!==Ne&&void 0!==Ne&&null!==(r=Ne.style)&&void 0!==r&&r.textColor?(0,V.X4)(null===Ne||void 0===Ne||null===(t=Ne.style)||void 0===t?void 0:t.textColor,.8):"text.secondary",sx:{display:"block",mb:.2,textAlign:e.userId===(null===co||void 0===co?void 0:co.uid)?"right":"left",fontFamily:(null===Ne||void 0===Ne||null===(n=Ne.style)||void 0===n?void 0:n.font)||"inherit"},children:e.userName}),(0,Ie.jsx)(S.A,{sx:{p:1,bgcolor:e.userId===(null===co||void 0===co?void 0:co.uid)?(null===Ne||void 0===Ne||null===(i=Ne.style)||void 0===i?void 0:i.accentColor)||"primary.main":"background.paper",color:e.userId===(null===co||void 0===co?void 0:co.uid)?null!==Ne&&void 0!==Ne&&null!==(a=Ne.style)&&void 0!==a&&a.accentColor?_e.palette.getContrastText(Ne.style.accentColor):"primary.contrastText":(null===Ne||void 0===Ne||null===(s=Ne.style)||void 0===s?void 0:s.textColor)||"text.primary",borderRadius:e.userId===(null===co||void 0===co?void 0:co.uid)?"16px 16px 0 16px":"16px 16px 16px 0",maxWidth:"85%",fontFamily:(null===Ne||void 0===Ne||null===(l=Ne.style)||void 0===l?void 0:l.font)||"inherit"},children:(0,Ie.jsx)(p.A,{variant:"body2",sx:{fontFamily:"inherit"},children:e.message})}),(0,Ie.jsx)(p.A,{variant:"caption",color:null!==Ne&&void 0!==Ne&&null!==(d=Ne.style)&&void 0!==d&&d.textColor?(0,V.X4)(null===Ne||void 0===Ne||null===(c=Ne.style)||void 0===c?void 0:c.textColor,.6):"text.secondary",sx:{display:"block",mt:.2,textAlign:e.userId===(null===co||void 0===co?void 0:co.uid)?"right":"left",fontSize:"0.65rem",fontFamily:(null===Ne||void 0===Ne||null===(m=Ne.style)||void 0===m?void 0:m.font)||"inherit"},children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)})),(0,Ie.jsx)("div",{ref:Uo})]})}),(0,Ie.jsx)(u.A,{sx:{p:1,borderTop:"1px solid ".concat(null!==Ne&&void 0!==Ne&&null!==(ae=Ne.style)&&void 0!==ae&&ae.accentColor?(0,V.X4)(null===Ne||void 0===Ne||null===(se=Ne.style)||void 0===se?void 0:se.accentColor,.3):_e.palette.divider),bgcolor:(null===Ne||void 0===Ne||null===(de=Ne.style)||void 0===de?void 0:de.headerColor)||_e.palette.background.paper,display:"flex"},children:(0,Ie.jsx)(E.A,{fullWidth:!0,placeholder:"Type your message...",variant:"outlined",size:"small",value:Po,onChange:e=>Fo(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Mo())},InputProps:{sx:{fontFamily:(null===Ne||void 0===Ne||null===(he=Ne.style)||void 0===he?void 0:he.font)||"inherit",color:(null===Ne||void 0===Ne||null===(xe=Ne.style)||void 0===xe?void 0:xe.textColor)||"inherit","& .MuiOutlinedInput-notchedOutline":{borderColor:null!==Ne&&void 0!==Ne&&null!==(pe=Ne.style)&&void 0!==pe&&pe.accentColor?(0,V.X4)(null===Ne||void 0===Ne||null===(ve=Ne.style)||void 0===ve?void 0:ve.accentColor,.3):"inherit"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:null!==Ne&&void 0!==Ne&&null!==(ge=Ne.style)&&void 0!==ge&&ge.accentColor?(0,V.X4)(null===Ne||void 0===Ne||null===(fe=Ne.style)||void 0===fe?void 0:fe.accentColor,.5):"inherit"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:(null===Ne||void 0===Ne||null===(be=Ne.style)||void 0===be?void 0:be.accentColor)||_e.palette.primary.main}},endAdornment:(0,Ie.jsx)(x.A,{size:"small",onClick:Mo,disabled:!Po.trim(),color:"primary",sx:{color:(null===Ne||void 0===Ne||null===(ye=Ne.style)||void 0===ye?void 0:ye.accentColor)||"primary"},children:(0,Ie.jsx)(je.A,{fontSize:"small"})})}})})]}),"gifts"===So&&(0,Ie.jsx)(po,{roomId:Ne.id,roomOwnerId:Ne.ownerId,theme:_e,roomStyle:null===Ne||void 0===Ne?void 0:Ne.style}),"topGifters"===So&&Ne&&(0,Ie.jsx)(wo,{roomId:Ne.id,roomOwnerId:Ne.ownerId,theme:_e,roomStyle:null===Ne||void 0===Ne?void 0:Ne.style})]}),(0,Ie.jsxs)(u.A,{sx:{flexShrink:0,p:2,borderTop:"1px solid ".concat(_e.palette.divider),display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:(null===Ne||void 0===Ne||null===(Se=Ne.style)||void 0===Se?void 0:Se.headerColor)||_e.palette.background.paper,gap:2,flexWrap:"wrap"},children:[(0,Ie.jsx)(A.A,{variant:"outlined",color:"error",startIcon:(0,Ie.jsx)(le.A,{}),onClick:()=>{$e?$e.leave().then((()=>{console.log("Successfully left call"),Ye("/side-rooms")})).catch((e=>{console.error("Error leaving call:",e),Ye("/side-rooms")})):Ye("/side-rooms")},sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===Ne||void 0===Ne||null===(ke=Ne.style)||void 0===ke?void 0:ke.font)||"inherit"},children:"Leave quietly"}),ze&&(0,Ie.jsx)(h.A,{title:ao?"Unmute Microphone":"Mute Microphone",children:(0,Ie.jsx)(x.A,{onClick:()=>null===$e||void 0===$e?void 0:$e.microphone.toggle(),color:ao?"default":"primary",sx:{color:ao?"default":(null===Ne||void 0===Ne||null===(Re=Ne.style)||void 0===Re?void 0:Re.accentColor)||"primary.main"},disabled:!$e,children:ao?(0,Ie.jsx)(me.A,{}):(0,Ie.jsx)(ce.A,{})})}),ze?(0,Ie.jsx)(h.A,{title:so?"Turn Camera Off":"Turn Camera On",children:(0,Ie.jsx)(x.A,{onClick:Ze,color:so?"primary":"default",sx:{color:so?(null===Ne||void 0===Ne||null===(Ee=Ne.style)||void 0===Ee?void 0:Ee.accentColor)||"primary.main":"default"},disabled:!$e,children:so?(0,Ie.jsx)(oe.A,{}):(0,Ie.jsx)(re.A,{})})}):so?(0,Ie.jsx)(A.A,{variant:"outlined",color:"error",onClick:()=>{$e&&$e.camera.disable().then((()=>{c.oR.success("Camera disabled")})).catch((e=>{console.error("Error disabling camera:",e)}))},startIcon:(0,Ie.jsx)(re.A,{}),sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===Ne||void 0===Ne||null===(Te=Ne.style)||void 0===Te?void 0:Te.font)||"inherit"},disabled:!$e,children:"Turn Camera Off"}):(0,Ie.jsx)(A.A,{variant:Je?"outlined":"contained",color:Je?"warning":"primary",onClick:qe,disabled:Je,startIcon:(0,Ie.jsx)(oe.A,{}),sx:{borderRadius:"20px",textTransform:"none",fontFamily:(null===Ne||void 0===Ne||null===(Ue=Ne.style)||void 0===Ue?void 0:Ue.font)||"inherit",backgroundColor:Je?"transparent":(null===Ne||void 0===Ne||null===(De=Ne.style)||void 0===De?void 0:De.accentColor)||"primary.main","&:hover":{backgroundColor:Je?"rgba(255, 152, 0, 0.04)":void 0}},children:Je?"Request Pending...":"Request Camera Permission"}),ze&&(0,Ie.jsx)(h.A,{title:"Share Video Link",children:(0,Ie.jsx)(x.A,{onClick:()=>We(),color:"secondary",sx:{color:(null===Ne||void 0===Ne||null===(Oe=Ne.style)||void 0===Oe?void 0:Oe.accentColor)||_e.palette.secondary.main},children:(0,Ie.jsx)($.A,{})})})]})]}):(0,Ie.jsxs)(u.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1,height:"100%"},children:[(0,Ie.jsx)(C.A,{}),(0,Ie.jsx)(p.A,{sx:{ml:1},children:"Loading call infrastructure..."})]})},To=n.memo((e=>{let{participant:o,isRoomOwner:r,isLocalParticipant:t,onForceMuteToggle:i,onForceRemove:l,onForceBan:g,call:C,localUserAuthData:w,localUserIsMute:j,isDesignatedHost:S,onPinToggle:E,isPinned:F,roomStyle:O,navigate:N,firestoreUserData:z}=e;const M=(0,m.A)(),{isSpeaking:W,publishedTracks:H}=o,{blockUser:L,currentUser:B}=(0,s.As)(),X=H.includes("audio"),_=t?null===j||void 0===j||j:!X&&!W,[Y,q]=(0,n.useState)(null),J=Boolean(Y),Z=e=>q(e.currentTarget),K=()=>q(null),$=async()=>{if(t&&C)try{if(console.log("[StreamParticipantCard] Attempting to toggle local microphone. Current SDK mute state (from prop localUserIsMute):",j),await C.microphone.toggle(),console.log("[StreamParticipantCard] Local microphone toggle command completed. SDK state should update."),r&&null!==w&&void 0!==w&&w.uid){const o=C.cid,r=o.includes(":")?o.split(":").pop():o;if(!r)return void console.error("[StreamParticipantCard] Invalid room ID format:",o);const t=(0,d.aU)(),n=(0,d.H9)(t,"sideRooms",r);try{if(!(await(0,d.x7)(n)).exists())return void console.error("[StreamParticipantCard] Room document does not exist:",r);const e=!C.microphone.enabled;console.log("[StreamParticipantCard] Room owner mic toggled, updating isLive to: ".concat(!e)),await(0,d.mZ)(n,{isLive:!e,lastActive:(0,d.O5)()})}catch(e){console.error("[StreamParticipantCard] Error accessing room document:",e)}}}catch(o){console.error("[StreamParticipantCard] Error toggling local microphone:",o),c.oR.error("Failed to toggle microphone. See console.")}};let ee,oe;const re=z[o.userId];re?(ee=re.username,oe=re.avatar||void 0,console.log("[StreamParticipantCard] Using Firestore data for ".concat(o.userId,":"),{displayName:ee,avatarUrl:oe})):t&&w?(ee=w.displayName||w.email||o.userId,oe=w.photoURL||o.image||void 0,console.log("[StreamParticipantCard] Using local auth data for current user:",{displayName:ee,avatarUrl:oe})):(ee=o.name||o.userId,oe=o.image||void 0,console.log("[StreamParticipantCard] Using Stream SDK fallback for ".concat(o.userId,":"),{displayName:ee,avatarUrl:oe})),console.log("[StreamParticipantCard] Rendering with props:",{participant:o,isRoomOwner:r,isLocalParticipant:t,localUserAuthData:w}),console.log("[StreamParticipantCard] Determined values - displayName:",ee,"avatarUrl:",oe,"isSpeaking:",W,"participantIsMuted:",_),t&&console.log("[StreamParticipantCard - LOCAL Focus] localUserAuthData:",w,"Stream participant.userId:",o.userId);const[ne,ie]=(0,n.useState)(!1),[se,le]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(null!==B&&void 0!==B&&B.blockedUsers&&o.userId&&!t&&!S){const e=B.blockedUsers.includes(o.userId);le(e)}}),[null===B||void 0===B?void 0:B.blockedUsers,o.userId,t,S]),(0,n.useEffect)((()=>{var e;if(!C||t||S)return;const r=null===(e=o.audioStream)||void 0===e?void 0:e.getAudioTracks()[0];r&&se?(r.enabled=!1,console.log("[StreamParticipantCard] Audio disabled for blocked user: ".concat(o.userId))):r&&!se&&(r.enabled=!0)}),[se,o.audioStream,C,t,S,o.userId]);return(0,Ie.jsxs)(u.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",textAlign:"center"},children:[(()=>{var e,r;const n=se&&!S?null:oe,i=se&&!S?"?":ee,s=W&&!(se&&!S),l=(0,Ie.jsx)(v.A,{src:n||void 0,alt:i,sx:{width:64,height:64,mb:.5,border:s?"3px solid ".concat(M.palette.success.main):"2px solid ".concat((0,V.X4)(M.palette.divider,.5)),boxShadow:s?"0 0 8px ".concat(M.palette.success.light):"none",transition:"border 0.2s ease-in-out, boxShadow 0.2s ease-in-out",cursor:"pointer",backgroundColor:se&&!S?M.palette.grey[400]:"inherit",opacity:se&&!S?.6:1},children:se&&!S?"?":null===(e=ee)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.toUpperCase()});return t?(0,Ie.jsx)(u.A,{onClick:$,sx:{cursor:"pointer"},children:l}):(0,Ie.jsx)(a.N_,{to:"/profile/".concat(o.userId),style:{textDecoration:"none"},children:l})})(),S&&(0,Ie.jsx)(U.A,{label:"Host",size:"small",color:"secondary",sx:{position:"absolute",bottom:12.5,zIndex:2,fontWeight:"bold",height:"18px",fontSize:"0.65rem"}}),(t?null===j||void 0===j||j:_)&&(0,Ie.jsx)(me.A,{sx:{fontSize:"1rem",color:M.palette.error.contrastText,backgroundColor:(0,V.X4)(M.palette.error.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),t&&!j&&(0,Ie.jsx)(ce.A,{sx:{fontSize:"1rem",color:M.palette.success.contrastText,backgroundColor:(0,V.X4)(M.palette.success.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",bottom:20,right:5}}),(0,Ie.jsx)(p.A,{variant:"caption",noWrap:!0,sx:{width:"100%",lineHeight:1.2,fontSize:"0.75rem",fontWeight:"medium",color:M.palette.text.primary},children:se&&!S?"Blocked User":ee}),r&&!t&&(0,Ie.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Ie.jsx)(h.A,{title:"Manage User",children:(0,Ie.jsx)(x.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,V.X4)(M.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Ie.jsx)(te.A,{fontSize:"small"})})}),(0,Ie.jsxs)(f.A,{anchorEl:Y,open:J,onClose:K,MenuListProps:{dense:!0},children:[(0,Ie.jsxs)(b.A,{onClick:()=>{K(),E(o.userId)},sx:{fontSize:"0.8rem"},children:[(0,Ie.jsx)(y.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Se.A,{fontSize:"small",color:F?"primary":"inherit"})}),F?"Unpin from top":"Pin to top"]}),(0,Ie.jsxs)(b.A,{onClick:()=>{K(),ie(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(y.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Q.A,{fontSize:"small",color:"warning"})}),"Report User"]}),(0,Ie.jsxs)(b.A,{onClick:()=>{K(),L&&o.userId&&(L(o.userId),l&&l(o.userId,o.name||o.userId,"blocked"),c.oR.success("".concat(o.name||o.userId," has been blocked and removed from the room")))},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(y.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(ke.A,{fontSize:"small",color:"error"})}),"Block & Remove"]}),(0,Ie.jsxs)(b.A,{onClick:()=>{K(),g&&g(o.userId,o.name||o.userId)},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(y.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(ae.A,{fontSize:"small",color:"error"})}),"Ban"]})]})]}),!r&&!t&&(0,Ie.jsxs)(u.A,{sx:{position:"absolute",top:-5,right:-5,zIndex:1},children:[(0,Ie.jsx)(h.A,{title:"Options",children:(0,Ie.jsx)(x.A,{onClick:Z,size:"small",sx:{backgroundColor:(0,V.X4)(M.palette.background.default,.7),p:.2,borderRadius:"50%"},children:(0,Ie.jsx)(te.A,{fontSize:"small"})})}),(0,Ie.jsxs)(f.A,{anchorEl:Y,open:J,onClose:K,MenuListProps:{dense:!0},children:[(0,Ie.jsxs)(b.A,{onClick:()=>{K(),ie(!0)},sx:{color:"warning.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(y.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(Q.A,{fontSize:"small",color:"warning"})}),"Report User"]}),(0,Ie.jsxs)(b.A,{onClick:()=>{K(),L&&o.userId&&(se?(le(!1),c.oR.success("".concat(o.name||o.userId," has been unblocked."))):S?(L(o.userId),c.oR.error("You cannot block the room owner. You will be removed from the room."),setTimeout((()=>{C?C.leave().then((()=>N("/side-rooms"))).catch((e=>{console.error("Error leaving call:",e),N("/side-rooms")})):N("/side-rooms")}),2e3)):(L(o.userId),le(!0),c.oR.success("".concat(o.name||o.userId," has been blocked. You won't hear them or see their profile picture."))))},sx:{color:"error.main",fontSize:"0.8rem"},children:[(0,Ie.jsx)(y.A,{sx:{minWidth:"30px"},children:(0,Ie.jsx)(ke.A,{fontSize:"small",color:"error"})}),se?"Unblock User":S?"Block Owner (Leave Room)":"Block User"]})]})]}),F&&!S&&(0,Ie.jsx)(h.A,{title:"Pinned",children:(0,Ie.jsx)(Se.A,{sx:{fontSize:"1rem",color:M.palette.primary.contrastText,backgroundColor:(0,V.X4)(M.palette.primary.main,.8),borderRadius:"50%",padding:"3px",position:"absolute",top:0,left:5,zIndex:2}})}),(0,Ie.jsxs)(k.A,{open:ne,onClose:()=>ie(!1),children:[(0,Ie.jsx)(I.A,{children:"Report User"}),(0,Ie.jsxs)(R.A,{children:[(0,Ie.jsxs)(p.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting ",o.name||o.userId,"?"]}),(0,Ie.jsx)(D.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Inappropriate behavior","Impersonation","Other"].map((e=>(0,Ie.jsx)(T.Ay,{onClick:()=>(async e=>{try{const r={reportedUserId:o.userId,reportedBy:null===B||void 0===B?void 0:B.uid,reason:e,timestamp:(0,d.O5)()};await(0,d.gS)((0,d.rJ)((0,d.aU)(),"reports"),r),c.oR.success("Report submitted for ".concat(o.name||o.userId)),ie(!1)}catch(r){console.error("Error submitting report:",r),c.oR.error("Failed to submit report. Please try again.")}})(e),sx:{borderRadius:1,cursor:"pointer","&:hover":{backgroundColor:(0,V.X4)(M.palette.primary.main,.1)}},children:(0,Ie.jsx)(G.A,{primary:e})},e)))})]}),(0,Ie.jsx)(P.A,{children:(0,Ie.jsx)(A.A,{onClick:()=>ie(!1),children:"Cancel"})})]})]})}))}}]);