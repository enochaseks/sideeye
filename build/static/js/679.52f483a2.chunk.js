"use strict";(self.webpackChunkside_eye=self.webpackChunkside_eye||[]).push([[679],{227:(e,s,t)=>{t.d(s,{A:()=>i});var o=t(3235),r=t(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd")},1770:(e,s,t)=>{t.d(s,{A:()=>i});var o=t(3235),r=t(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block")},6164:(e,s,t)=>{t.d(s,{A:()=>i});var o=t(3235),r=t(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"VerifiedUser")},6281:(e,s,t)=>{t.d(s,{A:()=>i});var o=t(3235),r=t(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert")},7286:(e,s,t)=>{t.d(s,{A:()=>i});var o=t(3235),r=t(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"}),"PersonRemove")},7565:(e,s,t)=>{t.d(s,{A:()=>i});var o=t(3235),r=t(4414);const i=(0,o.A)((0,r.jsx)("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3m1-4.3h-2V7h2z"}),"Report")},7679:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ee});var o=t(9379),r=t(9950),i=t(9808),l=t(2235),n=t(2053),a=t(4857),c=t(6589),d=t(6491),u=t(6639),x=t(5333),h=t(7591),m=t(3266),f=t(4195),p=t(3563),A=t(4447),g=t(1413),v=t(226),j=t(470),y=t(3569),w=t(704),b=t(5277),E=t(5713),C=t(6583),R=t(33),S=t(8170),k=t(8145),M=t(2046),z=t(9739),U=t(249),G=t(6050),P=t(2092),N=t(6164),F=t(6281),I=t(1770),H=t(7565),W=t(3235),Y=t(4414);const B=(0,W.A)([(0,Y.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,Y.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");var T=t(7286),_=t(227),D=t(7092);const O=(0,W.A)((0,Y.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group");var V=t(330),q=t(6220),L=t(9751),J=t(8429),Z=t(2074),Q=t(1367),$=t(301),K=t(5887);const X=()=>(0,Y.jsx)(i.A,{maxWidth:"sm",sx:{mt:4,textAlign:"center"},children:(0,Y.jsxs)(l.A,{elevation:2,sx:{p:3},children:[(0,Y.jsx)(P.A,{sx:{fontSize:40,mb:2},color:"action"}),(0,Y.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Account Deactivated"}),(0,Y.jsx)(n.A,{color:"text.secondary",children:"This user's account is currently deactivated."})]})}),ee=()=>{const e=(0,a.A)(),{currentUser:s,user:t,userProfile:W,loading:ee,setUserProfile:se,blockUser:te}=((0,c.A)(e.breakpoints.down("sm")),(0,Q.As)()),{db:oe}=(0,$.j)(),{userId:re}=(0,J.g)(),[ie,le]=(0,r.useState)(null),[ne,ae]=(0,r.useState)(""),[ce,de]=(0,r.useState)(""),[ue,xe]=(0,r.useState)(""),[he,me]=(0,r.useState)(""),[fe,pe]=(0,r.useState)(!1),[Ae,ge]=(0,r.useState)(!0),[ve,je]=(0,r.useState)(null),[ye,we]=(0,r.useState)([]),[be,Ee]=(0,r.useState)([]),[Ce,Re]=(0,r.useState)(null),[Se,ke]=(0,r.useState)(!1),[Me,ze]=(0,r.useState)(!1),[Ue,Ge]=(0,r.useState)(!1),[Pe,Ne]=(0,r.useState)(!1),[Fe,Ie]=(0,r.useState)([]),[He,We]=(0,r.useState)(!1),[Ye,Be]=(0,r.useState)(""),[Te,_e]=(0,r.useState)(""),[De,Oe]=(0,r.useState)(""),[Ve,qe]=(0,r.useState)([]),[Le,Je]=(0,r.useState)([]),[Ze,Qe]=(0,r.useState)(!1),$e=(0,J.Zp)(),[Ke,Xe]=(0,r.useState)(null),[es,ss]=(0,r.useState)(!1),[ts,os]=(0,r.useState)(!1),[rs,is]=(0,r.useState)(!1),[ls,ns]=(0,r.useState)(!1),[as,cs]=(0,r.useState)(null),[ds,us]=(0,r.useState)([]),[xs,hs]=(0,r.useState)(!1),ms=(0,r.useRef)(""),fs=ie||(null===s||void 0===s?void 0:s.uid)||"",ps=async e=>{if(!oe)return!1;try{const t=(0,q.rJ)(oe,"users"),o=(0,q.P)(t,(0,q._M)("username","==",e)),r=await(0,q.GG)(o);if(!r.empty&&1===r.docs.length){if(r.docs[0].id===(null===s||void 0===s?void 0:s.uid))return!1}return!r.empty}catch(ve){return console.error("Error checking username:",ve),!1}};(0,r.useEffect)((()=>{let e=!0;const t=setTimeout((async()=>{if(De&&De!==ms.current&&!(De.length<3)&&s&&/^[a-zA-Z0-9_-]+$/.test(De)){is(!0);try{const s=await ps(De);if(!e)return;if(s){ns(!0),cs("Username is already taken");const s=(e=>{const s=[];s.push("".concat(e).concat(Math.floor(100*Math.random())));const t=(new Date).getFullYear();return s.push("".concat(e).concat(t)),s.push("".concat(e,"_").concat(Math.floor(100*Math.random()))),s.push("real_".concat(e)),s.push("".concat(e).concat(Math.floor(1e3*Math.random()))),s})(De),t=[];if((await Promise.all(s.map((async e=>({suggestion:e,exists:await ps(e)}))))).forEach((e=>{e.exists||t.push(e.suggestion)})),!e)return;us(t),hs(t.length>0)}else ns(!1),cs(null),us([]),hs(!1)}catch(ve){console.error("Error validating username:",ve)}finally{e&&is(!1)}}}),500);return()=>{e=!1,clearTimeout(t)}}),[De,oe,null===s||void 0===s?void 0:s.uid]);(0,r.useEffect)((()=>{le(re||((null===s||void 0===s?void 0:s.uid)||null))}),[re,null===s||void 0===s?void 0:s.uid]),(0,r.useEffect)((()=>{var e;if(!s||!ie||s.uid===ie)return;(async()=>{if(oe)try{const e=(0,q.H9)(oe,"users",ie),t=await(0,q.x7)(e);if(t.exists()){const e=t.data();(e.blockedUsers||[]).includes(s.uid)&&$e("/discover")}}catch(ve){console.error("Error checking if blocked by target:",ve),$e("/discover")}})();(null===(e=s.blockedUsers)||void 0===e?void 0:e.includes(ie))&&$e("/discover")}),[s,ie,oe,$e]);const As=(0,r.useCallback)((async()=>{if(oe&&ie)try{ge(!0),je(null),Qe(!1);const e=(0,q.H9)(oe,"users",ie),t=await(0,q.x7)(e);if(!t.exists())return je("Profile not found"),void ge(!1);const r=t.data();if(r.isVerified=!0,(null===s||void 0===s?void 0:s.uid)===ie&&se&&W){const e=(0,o.A)((0,o.A)({},W),{},{isVerified:!0});se(e)}if(!1===r.isActive)return Qe(!0),je(null),void ge(!1);const i=r.isPrivate||!1,l=(null===s||void 0===s?void 0:s.uid)===ie;if(ke(i),ae(r.username||""),de(r.name||""),me(r.bio||""),Re(r.profilePic||null),xe(r.email||""),l||!i)ze(!0),je(null);else if(null!==s&&void 0!==s&&s.uid){const e=(0,q.H9)(oe,"users/".concat(ie,"/followers/").concat(s.uid)),t=(await(0,q.x7)(e)).exists();ze(t),t||je("This profile is private")}else ze(!1),je("This profile is private");const[n,a]=await Promise.all([(0,q.GG)((0,q.rJ)(oe,"users/".concat(ie,"/followers"))),(0,q.GG)((0,q.rJ)(oe,"users/".concat(ie,"/following")))]);Ee(n.docs.map((e=>e.id))),we(a.docs.map((e=>e.id)));const[c,d]=await Promise.all([(0,q.GG)((0,q.P)((0,q.rJ)(oe,"sideRooms"),(0,q._M)("members","array-contains",ie))),(0,q.GG)((0,q.P)((0,q.rJ)(oe,"sideRooms"),(0,q._M)("ownerId","==",ie),(0,q._M)("deleted","==",!1)))]);qe(c.docs.map((e=>(0,o.A)({id:e.id},e.data())))),Je(d.docs.map((e=>(0,o.A)({id:e.id},e.data()))))}catch(ve){console.error("Error in fetchUserData:",ve),je("Failed to load profile data")}finally{ge(!1)}else ge(!1)}),[oe,ie,s,se]);(0,r.useEffect)((()=>{As()}),[As]),(0,r.useEffect)((()=>{if(!oe||!fs)return;const e=(0,q.rJ)(oe,"users",fs,"followers"),s=(0,q.aQ)(e,(e=>{const s=e.docs.map((e=>e.id));Ee(s)}));return(async()=>{try{const e=(0,q.H9)(oe,"users",fs),s=await(0,q.x7)(e);if(s.exists()){const e=s.data();console.log("DEBUG - User data structure:",e),console.log("DEBUG - Profile pic field:",e.profilePic),console.log("DEBUG - Alternate fields:",{photoURL:e.photoURL,avatarUrl:e.avatarUrl,avatar:e.avatar,photo:e.photo,image:e.image,profileImage:e.profileImage})}}catch(ve){console.error("Error in debug fetch:",ve)}})(),()=>s()}),[oe,fs]),(0,r.useEffect)((()=>{if(!oe||!fs)return;const e=(0,q.rJ)(oe,"users",fs,"following"),s=(0,q.aQ)(e,(e=>{const s=e.docs.map((e=>e.id));we(s)}));return()=>s()}),[oe,fs]),(0,r.useEffect)((()=>{if(!oe||!s||!fs)return;(async()=>{console.log("EMERGENCY: Checking follow state for",fs);try{const e=(0,q.H9)(oe,"users",s.uid,"following",fs),t=await(0,q.x7)(e),o=(0,q.H9)(oe,"users",fs,"followers",s.uid),r=await(0,q.x7)(o);if(t.exists()||r.exists())return console.log("EMERGENCY: Setting isFollowing to TRUE for",fs),Ge(!0),Ne(!1),t.exists()||(await(0,q.BN)(e,{timestamp:(0,q.O5)()}),console.log("EMERGENCY: Fixed missing following entry for",fs)),void(r.exists()||(await(0,q.BN)(o,{timestamp:(0,q.O5)()}),console.log("EMERGENCY: Fixed missing follower entry for",fs)));const i=(0,q.H9)(oe,"users",fs,"followRequests",s.uid);(await(0,q.x7)(i)).exists()?(console.log("EMERGENCY: Setting followRequested to TRUE for",fs),Ne(!0),Ge(!1)):(Ne(!1),Ge(!1))}catch(ve){console.error("EMERGENCY: Error checking follow state:",ve)}})();const e=(0,q.H9)(oe,"users",s.uid,"following",fs),t=(0,q.H9)(oe,"users",fs,"followers",s.uid),o=(0,q.H9)(oe,"users",fs,"followRequests",s.uid),r=(0,q.aQ)(e,(e=>{e.exists()&&(console.log("EMERGENCY: following doc changed, exists=",e.exists()),Ge(!0),Ne(!1))})),i=(0,q.aQ)(t,(s=>{s.exists()&&(console.log("EMERGENCY: follower doc changed, exists=",s.exists()),Ge(!0),Ne(!1),(0,q.BN)(e,{timestamp:(0,q.O5)()}).catch((e=>console.error("Failed to sync following doc:",e))))})),l=(0,q.aQ)(o,(e=>{e.exists()&&!Ue&&(console.log("EMERGENCY: request doc changed, exists=",e.exists()),Ne(!0))}));return()=>{r(),i(),l()}}),[oe,s,fs,Ue]),(0,r.useEffect)((()=>{fe&&(Be(ce),Oe(ne),ms.current=ne,_e(he))}),[fe,ce,ne,he]);const gs=async e=>{if(!oe)return!1;try{const s=(0,q.H9)(oe,"users",e),t=await(0,q.x7)(s);if(t.exists()){return!0===t.data().isPrivate}return!1}catch(ve){return console.error("Error checking if follow request needed:",ve),!1}};return ee||Ae?(0,Y.jsx)(i.A,{maxWidth:"lg",children:(0,Y.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,Y.jsx)(u.A,{})})}):Ze?(0,Y.jsx)(X,{}):(0,Y.jsxs)(i.A,{maxWidth:"sm",sx:{mt:2,mb:8,px:{xs:1,sm:2}},children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,Y.jsxs)(l.A,{elevation:0,sx:{p:3,borderRadius:2,backgroundColor:"background.paper"},children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:3,position:"relative"},children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)(n.A,{variant:"h5",sx:{fontWeight:"bold",textAlign:"center"},children:ne||"username"}),(null===W||void 0===W?void 0:W.isVerified)&&(0,Y.jsx)(N.A,{sx:{ml:.5,color:"enochaseks@yahoo.com"===ue||"contact@sideye.uk"===ue?"gold":"primary.main",fontSize:"1.5rem"}}),Se&&(0,Y.jsx)(P.A,{sx:{ml:1,fontSize:20,verticalAlign:"middle"}})]}),(null===s||void 0===s?void 0:s.uid)!==ie&&(0,Y.jsx)(x.A,{onClick:e=>{Xe(e.currentTarget)},size:"small",sx:{position:"absolute",right:0},children:(0,Y.jsx)(F.A,{})})]}),(0,Y.jsxs)(h.A,{anchorEl:Ke,open:Boolean(Ke),onClose:()=>{Xe(null)},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,Y.jsxs)(m.A,{onClick:async()=>{s&&(Xe(null),ss(!0))},children:[(0,Y.jsx)(f.A,{children:(0,Y.jsx)(I.A,{fontSize:"small"})}),(0,Y.jsx)(p.A,{children:"Block User"})]}),(0,Y.jsxs)(m.A,{onClick:()=>{Xe(null),os(!0)},children:[(0,Y.jsx)(f.A,{children:(0,Y.jsx)(H.A,{fontSize:"small"})}),(0,Y.jsx)(p.A,{children:"Report User"})]})]}),(0,Y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[(0,Y.jsx)(d.A,{sx:{position:"relative",display:"flex",justifyContent:"center",width:"100%"},children:(0,Y.jsx)(A.A,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:(null===s||void 0===s?void 0:s.uid)===ie&&(0,Y.jsxs)(x.A,{component:"label",size:"small",sx:{bgcolor:"background.paper",border:"2px solid",borderColor:"background.paper"},children:[(0,Y.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:async e=>{var t;if(s&&null!==(t=e.target.files)&&void 0!==t&&t[0])try{ge(!0);const t=e.target.files[0],o=(0,L.KR)(V.IG,"profilePics/".concat(s.uid,"/").concat(t.name));await(0,L.D)(o,t);const r=await(0,L.qk)(o),i=(0,q.H9)(oe,"users",s.uid);await(0,q.mZ)(i,{profilePic:r,updatedAt:(0,q.O5)()}),Re(r),K.oR.success("Profile picture updated successfully")}catch(ve){console.error("Error updating profile picture:",ve),je("Failed to update profile picture"),K.oR.error("Failed to update profile picture")}finally{ge(!1)}}}),(0,Y.jsx)(B,{fontSize:"small"})]}),children:(0,Y.jsx)(g.A,{src:Ce||void 0,sx:{width:100,height:100,border:"3px solid",borderColor:"background.paper"},children:!Ce&&ne?ne.charAt(0).toUpperCase():"?"})})}),(0,Y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,Y.jsxs)(d.A,{sx:{mb:2,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:[(0,Y.jsx)(n.A,{variant:"h6",component:"h1",sx:{fontWeight:"bold",textAlign:"center"},children:ce||ne}),(null===W||void 0===W?void 0:W.isVerified)&&(0,Y.jsx)(N.A,{sx:{ml:.5,color:"enochaseks@yahoo.com"===ue||"contact@sideye.uk"===ue?"gold":"primary.main",fontSize:"1.2rem"}})]}),he&&(0,Y.jsx)(n.A,{variant:"body1",color:"text.secondary",sx:{mt:1,whiteSpace:"pre-wrap",textAlign:"center",width:"100%"},children:he})]}),(0,Y.jsxs)(d.A,{sx:{display:"flex",gap:3,mt:2,justifyContent:"center",width:"100%"},children:[(0,Y.jsxs)(d.A,{sx:{textAlign:"center"},children:[(0,Y.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"Rooms"}),(0,Y.jsx)(n.A,{variant:"h6",children:Le.length})]}),(0,Y.jsxs)(d.A,{sx:{textAlign:"center",cursor:"pointer"},component:Z.N_,to:"/profile/".concat(fs,"/followers"),children:[(0,Y.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"Followers"}),(0,Y.jsx)(n.A,{variant:"h6",children:be.length})]}),(0,Y.jsxs)(d.A,{sx:{textAlign:"center",cursor:"pointer"},component:Z.N_,to:"/profile/".concat(fs,"/following"),children:[(0,Y.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"Following"}),(0,Y.jsx)(n.A,{variant:"h6",children:ye.length})]})]}),(0,Y.jsx)(d.A,{sx:{mt:3,display:"flex",justifyContent:"center",width:"100%"},children:(null===s||void 0===s?void 0:s.uid)===ie?(0,Y.jsx)(v.A,{variant:"outlined",onClick:()=>pe(!0),fullWidth:!0,sx:{borderRadius:8,maxWidth:"300px"},children:"Edit Profile"}):s?(0,Y.jsxs)(d.A,{sx:{display:"flex",gap:2,justifyContent:"center",width:"100%"},children:[Ue?(0,Y.jsx)(v.A,{variant:"outlined",onClick:async()=>{if(s&&fs&&oe)try{ge(!0),Ge(!1);const o=(0,q.H9)(oe,"users",s.uid,"following",fs),r=(0,q.H9)(oe,"users",fs,"followers",s.uid);try{const e=(0,q.wP)(oe);e.delete(o),e.delete(r),await e.commit(),console.log("EMERGENCY: Successfully unfollowed user with batch delete")}catch(e){console.error("EMERGENCY: Batch delete failed, trying individual deletes",e);try{await(0,q.kd)(o)}catch(t){console.error("Failed to delete following:",t)}try{await(0,q.kd)(r)}catch(t){console.error("Failed to delete follower:",t)}console.log("EMERGENCY: Individual deletes attempted")}Ee((e=>e.filter((e=>e!==s.uid)))),we((e=>e.filter((e=>e!==fs)))),K.oR.success("Unfollowed successfully")}catch(ve){console.error("EMERGENCY: Error in handleUnfollow:",ve),Ge(!0),je("Failed to unfollow user"),K.oR.error("Failed to unfollow user. Please try again.")}finally{ge(!1)}else je("Database not initialized")},startIcon:(0,Y.jsx)(T.A,{}),size:"small",sx:{borderRadius:8,minWidth:"120px",flex:"0 0 auto"},children:"Unfollow"}):Pe?(0,Y.jsx)(v.A,{variant:"outlined",color:"secondary",sx:{borderRadius:8,flex:"0 0 auto",minWidth:"120px"},disabled:!0,children:"Requested"}):(0,Y.jsx)(v.A,{variant:"contained",onClick:async()=>{if(s&&fs&&oe)try{if(ge(!0),Se?Ne(!0):Ge(!0),Se){const e=(0,q.H9)(oe,"users",fs,"followRequests",s.uid);await(0,q.BN)(e,{userId:s.uid,username:(null===W||void 0===W?void 0:W.username)||(null===t||void 0===t?void 0:t.displayName)||"User_".concat(s.uid.substring(0,5)),timestamp:(0,q.O5)()}),K.oR.success("Follow request sent")}else{await gs(s.uid)&&K.oR.success("Your account is private. They will need to send a request to follow you back.");const t=(0,q.H9)(oe,"users",s.uid,"following",fs),o=(0,q.H9)(oe,"users",fs,"followers",s.uid);try{const e=(0,q.wP)(oe);e.set(t,{timestamp:(0,q.O5)()}),e.set(o,{timestamp:(0,q.O5)()}),await e.commit(),console.log("EMERGENCY: Successfully followed user with batch write"),K.oR.success("Followed successfully")}catch(e){console.error("EMERGENCY: Batch write failed, trying individual writes",e),await(0,q.BN)(t,{timestamp:(0,q.O5)()}),await(0,q.BN)(o,{timestamp:(0,q.O5)()}),console.log("EMERGENCY: Individual writes succeeded"),K.oR.success("Followed successfully")}}}catch(ve){console.error("EMERGENCY: Error in handleFollow:",ve),Se?Ne(!1):Ge(!1),je("Failed to process follow request"),K.oR.error("Failed to follow user. Please try again.")}finally{ge(!1)}else je("Database not initialized")},startIcon:(0,Y.jsx)(_.A,{}),sx:{borderRadius:8,flex:"0 0 auto",minWidth:"120px"},children:"Follow"}),(0,Y.jsx)(v.A,{variant:"outlined",component:Z.N_,to:"/chat/user/".concat(fs),startIcon:(0,Y.jsx)(D.A,{}),sx:{borderRadius:8,flex:"0 0 auto"},children:"Message"})]}):null})]})]}),Se&&(null===s||void 0===s?void 0:s.uid)!==ie&&!Me&&(0,Y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",mt:4,p:3,textAlign:"center",borderRadius:2,bgcolor:"background.paper"},children:[(0,Y.jsx)(d.A,{sx:{width:60,height:60,borderRadius:"50%",bgcolor:"action.hover",display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:(0,Y.jsx)(P.A,{sx:{fontSize:32,color:"text.secondary"}})}),(0,Y.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"This account is private"}),(0,Y.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"Follow this account to see their side rooms.  "})]})]}),(!Se||Me||(null===s||void 0===s?void 0:s.uid)===ie)&&(0,Y.jsx)(d.A,{sx:{display:"flex",borderTop:1,borderColor:"divider",justifyContent:"center",pt:1,mb:2},children:(0,Y.jsx)(x.A,{component:Z.N_,to:"/profile/".concat(fs),children:(0,Y.jsx)(d.A,{sx:{width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,Y.jsx)("svg",{height:"12",viewBox:"0 0 24 24",width:"12",children:(0,Y.jsx)("path",{d:"M12 1a11 11 0 1 0 11 11A11.013 11.013 0 0 0 12 1zm0 20a9 9 0 1 1 9-9 9.01 9.01 0 0 1-9 9zm3-11a3 3 0 1 1-3-3 3 3 0 0 1 3 3zm-3 5a8.949 8.949 0 0 0-4.951 1.488A3.987 3.987 0 0 1 6 13.1a6 6 0 1 1 12 0 3.987 3.987 0 0 1-1.049 2.688A8.954 8.954 0 0 0 12 15z",fill:"currentColor"})})})})}),(!Se||Me||(null===s||void 0===s?void 0:s.uid)===fs)&&(0,Y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[Le.length>0&&(0,Y.jsxs)(d.A,{children:[(0,Y.jsx)(n.A,{variant:"h6",sx:{mb:2},children:"Created Rooms"}),(0,Y.jsx)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:Le.map((e=>(0,Y.jsxs)(j.A,{sx:{display:"flex",flexDirection:"column",height:"100%","&:hover":{boxShadow:6,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.thumbnailUrl&&(0,Y.jsx)(y.A,{component:"img",height:"140",image:e.thumbnailUrl,alt:e.name,sx:{objectFit:"cover"}}),(0,Y.jsxs)(w.A,{sx:{flexGrow:1},children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,Y.jsx)(n.A,{variant:"h6",component:"div",children:e.name}),(0,Y.jsx)(b.A,{size:"small",label:"Owner",color:"primary"})]}),(0,Y.jsx)(n.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,Y.jsxs)(d.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,Y.jsx)(b.A,{size:"small",label:"".concat(e.memberCount||0," members"),icon:(0,Y.jsx)(O,{})}),e.category&&(0,Y.jsx)(b.A,{size:"small",label:e.category,variant:"outlined"}),e.isPrivate&&(0,Y.jsx)(b.A,{size:"small",icon:(0,Y.jsx)(P.A,{}),label:"Private",variant:"outlined"})]})]}),(0,Y.jsx)(E.A,{children:(0,Y.jsx)(v.A,{size:"small",component:Z.N_,to:"/side-room/".concat(e.id),variant:"contained",fullWidth:!0,children:"Enter Room"})})]},e.id)))})]}),Ve.length>0&&(0,Y.jsxs)(d.A,{children:[(0,Y.jsx)(n.A,{variant:"h6",sx:{mb:2},children:"Joined Rooms"}),(0,Y.jsx)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:Ve.map((e=>(0,Y.jsxs)(j.A,{sx:{display:"flex",flexDirection:"column",height:"100%","&:hover":{boxShadow:6,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.thumbnailUrl&&(0,Y.jsx)(y.A,{component:"img",height:"140",image:e.thumbnailUrl,alt:e.name,sx:{objectFit:"cover"}}),(0,Y.jsxs)(w.A,{sx:{flexGrow:1},children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,Y.jsx)(n.A,{variant:"h6",component:"div",children:e.name}),(0,Y.jsx)(b.A,{size:"small",label:"Member"})]}),(0,Y.jsx)(n.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),(0,Y.jsxs)(d.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,Y.jsx)(b.A,{size:"small",label:"".concat(e.memberCount||0," members"),icon:(0,Y.jsx)(O,{})}),e.category&&(0,Y.jsx)(b.A,{size:"small",label:e.category,variant:"outlined"}),e.isPrivate&&(0,Y.jsx)(b.A,{size:"small",icon:(0,Y.jsx)(P.A,{}),label:"Private",variant:"outlined"})]})]}),(0,Y.jsx)(E.A,{children:(0,Y.jsx)(v.A,{size:"small",component:Z.N_,to:"/side-room/".concat(e.id),variant:"contained",fullWidth:!0,children:"Enter Room"})})]},e.id)))})]}),0===Le.length&&0===Ve.length&&(0,Y.jsxs)(d.A,{sx:{textAlign:"center",py:4},children:[(0,Y.jsx)(n.A,{variant:"body1",color:"text.secondary",children:(null===s||void 0===s?void 0:s.uid)===ie?"You have not created any side rooms yet.":"".concat(ce||ne||"This person"," does not have an active room.")}),(null===s||void 0===s?void 0:s.uid)===ie&&(0,Y.jsx)(v.A,{variant:"contained",color:"primary",component:Z.N_,to:"/side-rooms",sx:{marginTop:2},children:"Create Side Rooms"})]})]})]}),(0,Y.jsxs)(C.A,{open:fe,onClose:()=>pe(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(R.A,{children:"Edit Profile"}),(0,Y.jsx)(S.A,{children:(0,Y.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,Y.jsx)(k.A,{label:"Name",value:Ye,onChange:e=>Be(e.target.value),fullWidth:!0,variant:"outlined",placeholder:"Name"}),(0,Y.jsxs)(d.A,{children:[(0,Y.jsx)(k.A,{label:"Username",value:De,onChange:e=>{const s=e.target.value;if(Oe(s),s===ms.current)return ns(!1),cs(null),void hs(!1);/^[a-zA-Z0-9_-]+$/.test(s)?s.length<3?cs("Username must be at least 3 characters long"):cs(null):cs("Username can only contain letters, numbers, underscores, and hyphens")},fullWidth:!0,variant:"outlined",placeholder:"Username",InputProps:{startAdornment:(0,Y.jsx)(M.A,{position:"start",children:"@"}),endAdornment:rs&&(0,Y.jsx)(M.A,{position:"end",children:(0,Y.jsx)(u.A,{size:20})})},error:!!as,helperText:as}),xs&&(0,Y.jsxs)(l.A,{elevation:2,sx:{mt:.5,p:1,maxHeight:150,overflow:"auto"},children:[(0,Y.jsx)(n.A,{variant:"caption",color:"text.secondary",children:"Suggested alternatives:"}),(0,Y.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:.5},children:ds.map((e=>(0,Y.jsx)(b.A,{label:e,size:"small",color:"primary",variant:"outlined",onClick:()=>(e=>{Oe(e),ns(!1),cs(null),hs(!1)})(e),sx:{cursor:"pointer"}},e)))})]})]}),(0,Y.jsx)(k.A,{label:"Bio",value:Te,onChange:e=>_e(e.target.value),multiline:!0,rows:4,fullWidth:!0,variant:"outlined",placeholder:"Bio",helperText:"".concat(Te.length,"/150 characters"),inputProps:{maxLength:150}})]})}),(0,Y.jsxs)(z.A,{sx:{p:3},children:[(0,Y.jsx)(v.A,{variant:"outlined",onClick:()=>pe(!1),sx:{textTransform:"none",minWidth:"100px"},children:"Cancel"}),(0,Y.jsx)(v.A,{variant:"contained",onClick:async()=>{if(s&&oe)if(De!==ms.current&&ls)K.oR.error("Please choose a unique username");else if(/^[a-zA-Z0-9_-]+$/.test(De))if(De.length<3)K.oR.error("Username must be at least 3 characters long");else try{ge(!0);const e=(0,q.H9)(oe,"users",s.uid);await(0,q.mZ)(e,{name:Ye,username:De,bio:Te,updatedAt:(0,q.O5)()}),de(Ye),ae(De),me(Te),pe(!1),K.oR.success("Profile updated successfully")}catch(ve){console.error("Error updating profile:",ve),je("Failed to update profile"),K.oR.error("Failed to update profile")}finally{ge(!1)}else K.oR.error("Username can only contain letters, numbers, underscores, and hyphens")},disabled:Ae||ls||!!as,sx:{textTransform:"none",minWidth:"100px"},children:Ae?"Saving...":"Save"})]})]}),(0,Y.jsxs)(C.A,{open:es,onClose:()=>ss(!1),children:[(0,Y.jsx)(R.A,{children:"Block User"}),(0,Y.jsxs)(S.A,{children:[(0,Y.jsxs)(n.A,{variant:"body1",children:["Are you sure you want to block @",ne,"?"]}),(0,Y.jsxs)(n.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["When you block someone:",(0,Y.jsxs)("ul",{children:[(0,Y.jsx)("li",{children:"They won't be able to see your profile"}),(0,Y.jsx)("li",{children:"They will be removed from your followers"}),(0,Y.jsx)("li",{children:"Their rooms won't appear in your discover and side room pages"}),(0,Y.jsx)("li",{children:"You won't see their messages"})]})]})]}),(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(v.A,{onClick:()=>ss(!1),children:"Cancel"}),(0,Y.jsx)(v.A,{onClick:async()=>{if(s&&fs)try{await te(fs),ss(!1),$e("/discover"),K.oR.success("You have blocked @".concat(ne))}catch(ve){console.error("Error blocking user:",ve),K.oR.error("Failed to block user")}},color:"error",variant:"contained",children:"Block"})]})]}),(0,Y.jsxs)(C.A,{open:ts,onClose:()=>os(!1),children:[(0,Y.jsx)(R.A,{children:"Report User"}),(0,Y.jsxs)(S.A,{children:[(0,Y.jsxs)(n.A,{variant:"body1",gutterBottom:!0,children:["Why are you reporting @",ne,"?"]}),(0,Y.jsx)(U.A,{children:["Spam or misleading content","Harassment or bullying","Hate speech or symbols","Violent or dangerous content","Misinformation","Impersonation","Other"].map((e=>(0,Y.jsx)(G.Ay,{onClick:()=>(async e=>{if(s&&fs&&oe)try{const t=(0,q.rJ)(oe,"reports");await(0,q.gS)(t,{reporterId:s.uid,reportedUserId:fs,reason:e,timestamp:(0,q.O5)(),status:"pending"}),os(!1),K.oR.success("Report submitted")}catch(ve){console.error("Error reporting user:",ve),K.oR.error("Failed to submit report")}})(e),sx:{borderRadius:1,cursor:"pointer"},children:(0,Y.jsx)(p.A,{primary:e})},e)))})]}),(0,Y.jsx)(z.A,{children:(0,Y.jsx)(v.A,{onClick:()=>os(!1),children:"Cancel"})})]})]})}}}]);